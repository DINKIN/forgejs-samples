( function() {

	function _h( f, c ) {
		return function() {
			var res = f.apply( this, arguments );
			c.apply( this, arguments );
			return res;
		}
	}

	function processErrors( errors, source ) {

		var css = '#shaderReport{ box-sizing: border-box; position: absolute; left: 0; top: 0; \
			right: 0; font-family: monaco, monospace; font-size: 12px; z-index: 1000; \
			background-color: #b70000; color: #ffffff; white-space: normal; \
			text-shadow: 0 -1px 0 rgba(0,0,0,.6); line-height: 1.2em; list-style-type: none; \
			padding: 0; margin: 0; max-height: 300px; overflow: auto; } \
			#shaderReport li{ padding: 10px; border-top: 1px solid rgba( 255, 255, 255, .2 ); \
			border-bottom: 1px solid rgba( 0, 0, 0, .2 ) } \
			#shaderReport li p{ padding: 0; margin: 0 } \
			#shaderReport li:nth-child(odd){ background-color: #c9542b }\
			#shaderReport li p:first-child{ color: #eee }';

		var el = document.createElement( 'style' );
		document.getElementsByTagName( 'head' )[ 0 ].appendChild( el );
		el.textContent = css;

		var report = document.createElement( 'ul' );
		report.setAttribute( 'id', 'shaderReport' );
		document.body.appendChild( report );

		var re = /ERROR: [\d]+:([\d]+): (.+)/gmi; 
		var lines = source.split( '\n' );

		var m;
		while ((m = re.exec( errors )) != null) {
			if (m.index === re.lastIndex) {
				re.lastIndex++;
			}
			var li = document.createElement( 'li' );
			var code = '<p>ERROR "<b>' + m[ 2 ] + '</b>" in line ' + m[ 1 ] + '</p>'
			code += '<p>' + lines[ m[ 1 ] - 1 ].replace( /^[ \t]+/g, '' ) + '</p>';
			li.innerHTML = code;
			report.appendChild( li );
		}
	    
	}

	WebGLRenderingContext.prototype.compileShader = _h( 
		WebGLRenderingContext.prototype.compileShader, 
		function( shader ) {

			if ( !this.getShaderParameter( shader, this.COMPILE_STATUS ) ) {

				var errors = this.getShaderInfoLog( shader );
				var source = this.getShaderSource( shader );

				processErrors( errors, source );

			}
		} 
	);

} )();
// threejs.org/license
(function(h,pa){"object"===typeof exports&&"undefined"!==typeof module?pa(exports):"function"===typeof define&&define.amd?define(["exports"],pa):pa(h.THREE=h.THREE||{})})(this,function(h){function pa(){}function C(a,b){this.x=a||0;this.y=b||0}function ba(a,b,c,d,e,f,g,k,l,m){Object.defineProperty(this,"id",{value:Pd++});this.uuid=h.Math.generateUUID();this.sourceFile=this.name="";this.image=void 0!==a?a:ba.DEFAULT_IMAGE;this.mipmaps=[];this.mapping=void 0!==b?b:ba.DEFAULT_MAPPING;this.wrapS=void 0!==
c?c:1001;this.wrapT=void 0!==d?d:1001;this.magFilter=void 0!==e?e:1006;this.minFilter=void 0!==f?f:1008;this.anisotropy=void 0!==l?l:1;this.format=void 0!==g?g:1023;this.type=void 0!==k?k:1009;this.offset=new C(0,0);this.repeat=new C(1,1);this.generateMipmaps=!0;this.premultiplyAlpha=!1;this.flipY=!0;this.unpackAlignment=4;this.encoding=void 0!==m?m:3E3;this.version=0;this.onUpdate=null}function da(a,b,c,d){this.x=a||0;this.y=b||0;this.z=c||0;this.w=void 0!==d?d:1}function zb(a,b,c){this.uuid=h.Math.generateUUID();
this.width=a;this.height=b;this.scissor=new da(0,0,a,b);this.scissorTest=!1;this.viewport=new da(0,0,a,b);c=c||{};void 0===c.minFilter&&(c.minFilter=1006);this.texture=new ba(void 0,void 0,c.wrapS,c.wrapT,c.magFilter,c.minFilter,c.format,c.type,c.anisotropy,c.encoding);this.depthBuffer=void 0!==c.depthBuffer?c.depthBuffer:!0;this.stencilBuffer=void 0!==c.stencilBuffer?c.stencilBuffer:!0;this.depthTexture=void 0!==c.depthTexture?c.depthTexture:null}function Ab(a,b,c){zb.call(this,a,b,c);this.activeMipMapLevel=
this.activeCubeFace=0}function ca(a,b,c,d){this._x=a||0;this._y=b||0;this._z=c||0;this._w=void 0!==d?d:1}function q(a,b,c){this.x=a||0;this.y=b||0;this.z=c||0}function P(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);0<arguments.length&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}function Ta(a,b,c,d,e,f,g,k,l,m){a=void 0!==a?a:[];ba.call(this,a,void 0!==b?b:301,c,d,e,f,g,k,l,m);this.flipY=!1}function Bb(a,b,c){var d=a[0];if(0>=
d||0<d)return a;var e=b*c,f=Qd[e];void 0===f&&(f=new Float32Array(e),Qd[e]=f);if(0!==b)for(d.toArray(f,0),d=1,e=0;d!==b;++d)e+=c,a[d].toArray(f,e);return f}function Rd(a,b){var c=Sd[b];void 0===c&&(c=new Int32Array(b),Sd[b]=c);for(var d=0;d!==b;++d)c[d]=a.allocTextureUnit();return c}function se(a,b){a.uniform1f(this.addr,b)}function te(a,b){a.uniform1i(this.addr,b)}function ue(a,b){void 0===b.x?a.uniform2fv(this.addr,b):a.uniform2f(this.addr,b.x,b.y)}function ve(a,b){void 0!==b.x?a.uniform3f(this.addr,
b.x,b.y,b.z):void 0!==b.r?a.uniform3f(this.addr,b.r,b.g,b.b):a.uniform3fv(this.addr,b)}function we(a,b){void 0===b.x?a.uniform4fv(this.addr,b):a.uniform4f(this.addr,b.x,b.y,b.z,b.w)}function xe(a,b){a.uniformMatrix2fv(this.addr,!1,b.elements||b)}function ye(a,b){a.uniformMatrix3fv(this.addr,!1,b.elements||b)}function ze(a,b){a.uniformMatrix4fv(this.addr,!1,b.elements||b)}function Ae(a,b,c){var d=c.allocTextureUnit();a.uniform1i(this.addr,d);c.setTexture2D(b||Td,d)}function Be(a,b,c){var d=c.allocTextureUnit();
a.uniform1i(this.addr,d);c.setTextureCube(b||Ud,d)}function Vd(a,b){a.uniform2iv(this.addr,b)}function Wd(a,b){a.uniform3iv(this.addr,b)}function Xd(a,b){a.uniform4iv(this.addr,b)}function Ce(a){switch(a){case 5126:return se;case 35664:return ue;case 35665:return ve;case 35666:return we;case 35674:return xe;case 35675:return ye;case 35676:return ze;case 35678:return Ae;case 35680:return Be;case 5124:case 35670:return te;case 35667:case 35671:return Vd;case 35668:case 35672:return Wd;case 35669:case 35673:return Xd}}
function De(a,b){a.uniform1fv(this.addr,b)}function Ee(a,b){a.uniform1iv(this.addr,b)}function Fe(a,b){a.uniform2fv(this.addr,Bb(b,this.size,2))}function Ge(a,b){a.uniform3fv(this.addr,Bb(b,this.size,3))}function He(a,b){a.uniform4fv(this.addr,Bb(b,this.size,4))}function Ie(a,b){a.uniformMatrix2fv(this.addr,!1,Bb(b,this.size,4))}function Je(a,b){a.uniformMatrix3fv(this.addr,!1,Bb(b,this.size,9))}function Ke(a,b){a.uniformMatrix4fv(this.addr,!1,Bb(b,this.size,16))}function Le(a,b,c){var d=b.length,
e=Rd(c,d);a.uniform1iv(this.addr,e);for(a=0;a!==d;++a)c.setTexture2D(b[a]||Td,e[a])}function Me(a,b,c){var d=b.length,e=Rd(c,d);a.uniform1iv(this.addr,e);for(a=0;a!==d;++a)c.setTextureCube(b[a]||Ud,e[a])}function Ne(a){switch(a){case 5126:return De;case 35664:return Fe;case 35665:return Ge;case 35666:return He;case 35674:return Ie;case 35675:return Je;case 35676:return Ke;case 35678:return Le;case 35680:return Me;case 5124:case 35670:return Ee;case 35667:case 35671:return Vd;case 35668:case 35672:return Wd;
case 35669:case 35673:return Xd}}function Oe(a,b,c){this.id=a;this.addr=c;this.setValue=Ce(b.type)}function Pe(a,b,c){this.id=a;this.addr=c;this.size=b.size;this.setValue=Ne(b.type)}function Yd(a){this.id=a;this.seq=[];this.map={}}function Ga(a,b,c){this.seq=[];this.map={};this.renderer=c;c=a.getProgramParameter(b,a.ACTIVE_UNIFORMS);for(var d=0;d!==c;++d){var e=a.getActiveUniform(b,d),f=a.getUniformLocation(b,e.name),g=this,k=e.name,l=k.length;for(kd.lastIndex=0;;){var m=kd.exec(k),u=kd.lastIndex,
p=m[1],n=m[3];"]"===m[2]&&(p|=0);if(void 0===n||"["===n&&u+2===l){k=g;e=void 0===n?new Oe(p,e,f):new Pe(p,e,f);k.seq.push(e);k.map[e.id]=e;break}else n=g.map[p],void 0===n&&(n=new Yd(p),p=g,g=n,p.seq.push(g),p.map[g.id]=g),g=n}}}function H(a,b,c){return void 0===b&&void 0===c?this.set(a):this.setRGB(a,b,c)}function cc(a,b){this.min=void 0!==a?a:new C(Infinity,Infinity);this.max=void 0!==b?b:new C(-Infinity,-Infinity)}function Qe(a,b){var c,d,e,f,g,k,l,m,u,p,n=a.context,h=a.state,t,v,A,w,x,T;this.render=
function(y,F,G){if(0!==b.length){y=new q;var E=G.w/G.z,J=.5*G.z,Ma=.5*G.w,N=16/G.w,ea=new C(N*E,N),xa=new q(1,1,0),ab=new C(1,1),Ea=new cc;Ea.min.set(0,0);Ea.max.set(G.z-16,G.w-16);if(void 0===w){var N=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]),L=new Uint16Array([0,1,2,0,2,3]);t=n.createBuffer();v=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,t);n.bufferData(n.ARRAY_BUFFER,N,n.STATIC_DRAW);n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,v);n.bufferData(n.ELEMENT_ARRAY_BUFFER,L,n.STATIC_DRAW);x=n.createTexture();
T=n.createTexture();h.bindTexture(n.TEXTURE_2D,x);n.texImage2D(n.TEXTURE_2D,0,n.RGB,16,16,0,n.RGB,n.UNSIGNED_BYTE,null);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST);h.bindTexture(n.TEXTURE_2D,T);n.texImage2D(n.TEXTURE_2D,0,n.RGBA,16,16,0,n.RGBA,n.UNSIGNED_BYTE,null);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,
n.CLAMP_TO_EDGE);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST);var N=A={vertexShader:"uniform lowp int renderType;\nuniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nuniform sampler2D occlusionMap;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif ( renderType == 2 ) {\nvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );\nvVisibility =        visibility.r / 9.0;\nvVisibility *= 1.0 - visibility.g / 9.0;\nvVisibility *=       visibility.b / 9.0;\nvVisibility *= 1.0 - visibility.a / 9.0;\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",
fragmentShader:"uniform lowp int renderType;\nuniform sampler2D map;\nuniform float opacity;\nuniform vec3 color;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nif ( renderType == 0 ) {\ngl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );\n} else if ( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * vVisibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"},L=n.createProgram(),M=n.createShader(n.FRAGMENT_SHADER),
O=n.createShader(n.VERTEX_SHADER),Q="precision "+a.getPrecision()+" float;\n";n.shaderSource(M,Q+N.fragmentShader);n.shaderSource(O,Q+N.vertexShader);n.compileShader(M);n.compileShader(O);n.attachShader(L,M);n.attachShader(L,O);n.linkProgram(L);w=L;u=n.getAttribLocation(w,"position");p=n.getAttribLocation(w,"uv");c=n.getUniformLocation(w,"renderType");d=n.getUniformLocation(w,"map");e=n.getUniformLocation(w,"occlusionMap");f=n.getUniformLocation(w,"opacity");g=n.getUniformLocation(w,"color");k=n.getUniformLocation(w,
"scale");l=n.getUniformLocation(w,"rotation");m=n.getUniformLocation(w,"screenPosition")}n.useProgram(w);h.initAttributes();h.enableAttribute(u);h.enableAttribute(p);h.disableUnusedAttributes();n.uniform1i(e,0);n.uniform1i(d,1);n.bindBuffer(n.ARRAY_BUFFER,t);n.vertexAttribPointer(u,2,n.FLOAT,!1,16,0);n.vertexAttribPointer(p,2,n.FLOAT,!1,16,8);n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,v);h.disable(n.CULL_FACE);h.setDepthWrite(!1);L=0;for(M=b.length;L<M;L++)if(N=16/G.w,ea.set(N*E,N),O=b[L],y.set(O.matrixWorld.elements[12],
O.matrixWorld.elements[13],O.matrixWorld.elements[14]),y.applyMatrix4(F.matrixWorldInverse),y.applyProjection(F.projectionMatrix),xa.copy(y),ab.x=G.x+xa.x*J+J-8,ab.y=G.y+xa.y*Ma+Ma-8,!0===Ea.containsPoint(ab)){h.activeTexture(n.TEXTURE0);h.bindTexture(n.TEXTURE_2D,null);h.activeTexture(n.TEXTURE1);h.bindTexture(n.TEXTURE_2D,x);n.copyTexImage2D(n.TEXTURE_2D,0,n.RGB,ab.x,ab.y,16,16,0);n.uniform1i(c,0);n.uniform2f(k,ea.x,ea.y);n.uniform3f(m,xa.x,xa.y,xa.z);h.disable(n.BLEND);h.enable(n.DEPTH_TEST);n.drawElements(n.TRIANGLES,
6,n.UNSIGNED_SHORT,0);h.activeTexture(n.TEXTURE0);h.bindTexture(n.TEXTURE_2D,T);n.copyTexImage2D(n.TEXTURE_2D,0,n.RGBA,ab.x,ab.y,16,16,0);n.uniform1i(c,1);h.disable(n.DEPTH_TEST);h.activeTexture(n.TEXTURE1);h.bindTexture(n.TEXTURE_2D,x);n.drawElements(n.TRIANGLES,6,n.UNSIGNED_SHORT,0);O.positionScreen.copy(xa);O.customUpdateCallback?O.customUpdateCallback(O):O.updateLensFlares();n.uniform1i(c,2);h.enable(n.BLEND);for(var Q=0,Re=O.lensFlares.length;Q<Re;Q++){var V=O.lensFlares[Q];.001<V.opacity&&.001<
V.scale&&(xa.x=V.x,xa.y=V.y,xa.z=V.z,N=V.size*V.scale/G.w,ea.x=N*E,ea.y=N,n.uniform3f(m,xa.x,xa.y,xa.z),n.uniform2f(k,ea.x,ea.y),n.uniform1f(l,V.rotation),n.uniform1f(f,V.opacity),n.uniform3f(g,V.color.r,V.color.g,V.color.b),h.setBlending(V.blending,V.blendEquation,V.blendSrc,V.blendDst),a.setTexture2D(V.texture,1),n.drawElements(n.TRIANGLES,6,n.UNSIGNED_SHORT,0))}}h.enable(n.CULL_FACE);h.enable(n.DEPTH_TEST);h.setDepthWrite(!0);a.resetGLState()}}}function Se(a,b){var c,d,e,f,g,k,l,m,u,h,n,r,t,v,
A,w,x;function T(a,b){return a.renderOrder!==b.renderOrder?a.renderOrder-b.renderOrder:a.z!==b.z?b.z-a.z:b.id-a.id}var y=a.context,F=a.state,G,E,J,Ma,N=new q,ea=new ca,xa=new q;this.render=function(q,Ea){if(0!==b.length){if(void 0===J){var L=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),M=new Uint16Array([0,1,2,0,2,3]);G=y.createBuffer();E=y.createBuffer();y.bindBuffer(y.ARRAY_BUFFER,G);y.bufferData(y.ARRAY_BUFFER,L,y.STATIC_DRAW);y.bindBuffer(y.ELEMENT_ARRAY_BUFFER,E);y.bufferData(y.ELEMENT_ARRAY_BUFFER,
M,y.STATIC_DRAW);var L=y.createProgram(),M=y.createShader(y.VERTEX_SHADER),O=y.createShader(y.FRAGMENT_SHADER);y.shaderSource(M,["precision "+a.getPrecision()+" float;","uniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform float rotation;\nuniform vec2 scale;\nuniform vec2 uvOffset;\nuniform vec2 uvScale;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uvOffset + uv * uvScale;\nvec2 alignedPosition = position * scale;\nvec2 rotatedPosition;\nrotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\nrotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\nvec4 finalPosition;\nfinalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\nfinalPosition.xy += rotatedPosition;\nfinalPosition = projectionMatrix * finalPosition;\ngl_Position = finalPosition;\n}"].join("\n"));
y.shaderSource(O,["precision "+a.getPrecision()+" float;","uniform vec3 color;\nuniform sampler2D map;\nuniform float opacity;\nuniform int fogType;\nuniform vec3 fogColor;\nuniform float fogDensity;\nuniform float fogNear;\nuniform float fogFar;\nuniform float alphaTest;\nvarying vec2 vUV;\nvoid main() {\nvec4 texture = texture2D( map, vUV );\nif ( texture.a < alphaTest ) discard;\ngl_FragColor = vec4( color * texture.xyz, texture.a * opacity );\nif ( fogType > 0 ) {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat fogFactor = 0.0;\nif ( fogType == 1 ) {\nfogFactor = smoothstep( fogNear, fogFar, depth );\n} else {\nconst float LOG2 = 1.442695;\nfogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n}\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n}\n}"].join("\n"));
y.compileShader(M);y.compileShader(O);y.attachShader(L,M);y.attachShader(L,O);y.linkProgram(L);J=L;w=y.getAttribLocation(J,"position");x=y.getAttribLocation(J,"uv");c=y.getUniformLocation(J,"uvOffset");d=y.getUniformLocation(J,"uvScale");e=y.getUniformLocation(J,"rotation");f=y.getUniformLocation(J,"scale");g=y.getUniformLocation(J,"color");k=y.getUniformLocation(J,"map");l=y.getUniformLocation(J,"opacity");m=y.getUniformLocation(J,"modelViewMatrix");u=y.getUniformLocation(J,"projectionMatrix");h=
y.getUniformLocation(J,"fogType");n=y.getUniformLocation(J,"fogDensity");r=y.getUniformLocation(J,"fogNear");t=y.getUniformLocation(J,"fogFar");v=y.getUniformLocation(J,"fogColor");A=y.getUniformLocation(J,"alphaTest");L=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");L.width=8;L.height=8;M=L.getContext("2d");M.fillStyle="white";M.fillRect(0,0,8,8);Ma=new ba(L);Ma.needsUpdate=!0}y.useProgram(J);F.initAttributes();F.enableAttribute(w);F.enableAttribute(x);F.disableUnusedAttributes();
F.disable(y.CULL_FACE);F.enable(y.BLEND);y.bindBuffer(y.ARRAY_BUFFER,G);y.vertexAttribPointer(w,2,y.FLOAT,!1,16,0);y.vertexAttribPointer(x,2,y.FLOAT,!1,16,8);y.bindBuffer(y.ELEMENT_ARRAY_BUFFER,E);y.uniformMatrix4fv(u,!1,Ea.projectionMatrix.elements);F.activeTexture(y.TEXTURE0);y.uniform1i(k,0);M=L=0;(O=q.fog)?(y.uniform3f(v,O.color.r,O.color.g,O.color.b),O&&O.isFog?(y.uniform1f(r,O.near),y.uniform1f(t,O.far),y.uniform1i(h,1),M=L=1):O&&O.isFogExp2&&(y.uniform1f(n,O.density),y.uniform1i(h,2),M=L=2)):
(y.uniform1i(h,0),M=L=0);for(var O=0,Q=b.length;O<Q;O++){var C=b[O];C.modelViewMatrix.multiplyMatrices(Ea.matrixWorldInverse,C.matrixWorld);C.z=-C.modelViewMatrix.elements[14]}b.sort(T);for(var V=[],O=0,Q=b.length;O<Q;O++){var C=b[O],W=C.material;!1!==W.visible&&(y.uniform1f(A,W.alphaTest),y.uniformMatrix4fv(m,!1,C.modelViewMatrix.elements),C.matrixWorld.decompose(N,ea,xa),V[0]=xa.x,V[1]=xa.y,C=0,q.fog&&W.fog&&(C=M),L!==C&&(y.uniform1i(h,C),L=C),null!==W.map?(y.uniform2f(c,W.map.offset.x,W.map.offset.y),
y.uniform2f(d,W.map.repeat.x,W.map.repeat.y)):(y.uniform2f(c,0,0),y.uniform2f(d,1,1)),y.uniform1f(l,W.opacity),y.uniform3f(g,W.color.r,W.color.g,W.color.b),y.uniform1f(e,W.rotation),y.uniform2fv(f,V),F.setBlending(W.blending,W.blendEquation,W.blendSrc,W.blendDst),F.setDepthTest(W.depthTest),F.setDepthWrite(W.depthWrite),W.map?a.setTexture2D(W.map,0):a.setTexture2D(Ma,0),y.drawElements(y.TRIANGLES,6,y.UNSIGNED_SHORT,0))}F.enable(y.CULL_FACE);a.resetGLState()}}}function S(){Object.defineProperty(this,
"id",{value:Zd++});this.uuid=h.Math.generateUUID();this.name="";this.type="Material";this.lights=this.fog=!0;this.blending=1;this.side=0;this.shading=2;this.vertexColors=0;this.opacity=1;this.transparent=!1;this.blendSrc=204;this.blendDst=205;this.blendEquation=100;this.blendEquationAlpha=this.blendDstAlpha=this.blendSrcAlpha=null;this.depthFunc=3;this.depthWrite=this.depthTest=!0;this.clippingPlanes=null;this.clipShadows=!1;this.colorWrite=!0;this.precision=null;this.polygonOffset=!1;this.alphaTest=
this.polygonOffsetUnits=this.polygonOffsetFactor=0;this.premultipliedAlpha=!1;this.overdraw=0;this._needsUpdate=this.visible=!0}function Da(a){S.call(this);this.type="ShaderMaterial";this.defines={};this.uniforms={};this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}";this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";this.linewidth=1;this.wireframe=!1;this.wireframeLinewidth=1;this.morphNormals=this.morphTargets=
this.skinning=this.clipping=this.lights=this.fog=!1;this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1};this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]};this.index0AttributeName=void 0;void 0!==a&&(void 0!==a.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(a))}function Ua(a){S.call(this);this.type="MeshDepthMaterial";this.depthPacking=3200;this.morphTargets=this.skinning=
!1;this.displacementMap=this.alphaMap=this.map=null;this.displacementScale=1;this.displacementBias=0;this.wireframe=!1;this.wireframeLinewidth=1;this.lights=this.fog=!1;this.setValues(a)}function Ha(a,b){this.min=void 0!==a?a:new q(Infinity,Infinity,Infinity);this.max=void 0!==b?b:new q(-Infinity,-Infinity,-Infinity)}function Aa(a,b){this.center=void 0!==a?a:new q;this.radius=void 0!==b?b:0}function ya(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1]);0<arguments.length&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}
function fa(a,b){this.normal=void 0!==a?a:new q(1,0,0);this.constant=void 0!==b?b:0}function dc(a,b,c,d,e,f){this.planes=[void 0!==a?a:new fa,void 0!==b?b:new fa,void 0!==c?c:new fa,void 0!==d?d:new fa,void 0!==e?e:new fa,void 0!==f?f:new fa]}function $d(a,b,c,d){function e(b,c,d,e){var f=b.geometry,g;g=A;var k=b.customDepthMaterial;d&&(g=w,k=b.customDistanceMaterial);k?g=k:(k=!1,c.morphTargets&&(f&&f.isBufferGeometry?k=f.morphAttributes&&f.morphAttributes.position&&0<f.morphAttributes.position.length:
f&&f.isGeometry&&(k=f.morphTargets&&0<f.morphTargets.length)),b=b.isSkinnedMesh&&c.skinning,f=0,k&&(f|=1),b&&(f|=2),g=g[f]);a.localClippingEnabled&&!0===c.clipShadows&&0!==c.clippingPlanes.length&&(f=g.uuid,k=c.uuid,b=x[f],void 0===b&&(b={},x[f]=b),f=b[k],void 0===f&&(f=g.clone(),b[k]=f),g=f);g.visible=c.visible;g.wireframe=c.wireframe;k=c.side;ea.renderSingleSided&&2==k&&(k=0);ea.renderReverseSided&&(0===k?k=1:1===k&&(k=0));g.side=k;g.clipShadows=c.clipShadows;g.clippingPlanes=c.clippingPlanes;g.wireframeLinewidth=
c.wireframeLinewidth;g.linewidth=c.linewidth;d&&void 0!==g.uniforms.lightPos&&g.uniforms.lightPos.value.copy(e);return g}function f(a,b,c){if(!1!==a.visible){0!==(a.layers.mask&b.layers.mask)&&(a.isMesh||a.isLine||a.isPoints)&&a.castShadow&&(!1===a.frustumCulled||!0===l.intersectsObject(a))&&!0===a.material.visible&&(a.modelViewMatrix.multiplyMatrices(c.matrixWorldInverse,a.matrixWorld),v.push(a));a=a.children;for(var d=0,e=a.length;d<e;d++)f(a[d],b,c)}}var g=a.context,k=a.state,l=new dc,m=new P,
u=b.shadows,p=new C,n=new C(d.maxTextureSize,d.maxTextureSize),r=new q,t=new q,v=[],A=Array(4),w=Array(4),x={},T=[new q(1,0,0),new q(-1,0,0),new q(0,0,1),new q(0,0,-1),new q(0,1,0),new q(0,-1,0)],y=[new q(0,1,0),new q(0,1,0),new q(0,1,0),new q(0,1,0),new q(0,0,1),new q(0,0,-1)],F=[new da,new da,new da,new da,new da,new da];b=new Ua;b.depthPacking=3201;b.clipping=!0;d=Cb.distanceRGBA;for(var G=h.UniformsUtils.clone(d.uniforms),E=0;4!==E;++E){var J=0!==(E&1),Ma=0!==(E&2),N=b.clone();N.morphTargets=
J;N.skinning=Ma;A[E]=N;J=new Da({defines:{USE_SHADOWMAP:""},uniforms:G,vertexShader:d.vertexShader,fragmentShader:d.fragmentShader,morphTargets:J,skinning:Ma,clipping:!0});w[E]=J}var ea=this;this.enabled=!1;this.autoUpdate=!0;this.needsUpdate=!1;this.type=1;this.renderSingleSided=this.renderReverseSided=!0;this.render=function(b,d){if(!1!==ea.enabled&&(!1!==ea.autoUpdate||!1!==ea.needsUpdate)&&0!==u.length){k.clearColor(1,1,1,1);k.disable(g.BLEND);k.setDepthTest(!0);k.setScissorTest(!1);for(var h,
x,w=0,A=u.length;w<A;w++){var q=u[w],G=q.shadow;if(void 0===G)console.warn("THREE.WebGLShadowMap:",q,"has no shadow.");else{var E=G.camera;p.copy(G.mapSize);p.min(n);if(q&&q.isPointLight){h=6;x=!0;var J=p.x,N=p.y;F[0].set(2*J,N,J,N);F[1].set(0,N,J,N);F[2].set(3*J,N,J,N);F[3].set(J,N,J,N);F[4].set(3*J,0,J,N);F[5].set(J,0,J,N);p.x*=4;p.y*=2}else h=1,x=!1;null===G.map&&(G.map=new zb(p.x,p.y,{minFilter:1003,magFilter:1003,format:1023}),E.updateProjectionMatrix());G&&G.isSpotLightShadow&&G.update(q);J=
G.map;G=G.matrix;t.setFromMatrixPosition(q.matrixWorld);E.position.copy(t);a.setRenderTarget(J);a.clear();for(J=0;J<h;J++){x?(r.copy(E.position),r.add(T[J]),E.up.copy(y[J]),E.lookAt(r),k.viewport(F[J])):(r.setFromMatrixPosition(q.target.matrixWorld),E.lookAt(r));E.updateMatrixWorld();E.matrixWorldInverse.getInverse(E.matrixWorld);G.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1);G.multiply(E.projectionMatrix);G.multiply(E.matrixWorldInverse);m.multiplyMatrices(E.projectionMatrix,E.matrixWorldInverse);
l.setFromMatrix(m);v.length=0;f(b,d,E);for(var N=0,Ma=v.length;N<Ma;N++){var C=v[N],z=c.update(C),D=C.material;if(D&&D.isMultiMaterial)for(var Va=z.groups,D=D.materials,ld=0,Ba=Va.length;ld<Ba;ld++){var Qa=Va[ld],Na=D[Qa.materialIndex];!0===Na.visible&&(Na=e(C,Na,x,t),a.renderBufferDirect(E,null,z,Na,C,Qa))}else Na=e(C,D,x,t),a.renderBufferDirect(E,null,z,Na,C,null)}}}}h=a.getClearColor();x=a.getClearAlpha();a.setClearColor(h,x);ea.needsUpdate=!1}}}function Wa(a,b){this.origin=void 0!==a?a:new q;
this.direction=void 0!==b?b:new q}function Xa(a,b,c,d){this._x=a||0;this._y=b||0;this._z=c||0;this._order=d||Xa.DefaultOrder}function Kc(){this.mask=1}function D(){Object.defineProperty(this,"id",{value:ae++});this.uuid=h.Math.generateUUID();this.name="";this.type="Object3D";this.parent=null;this.children=[];this.up=D.DefaultUp.clone();var a=new q,b=new Xa,c=new ca,d=new q(1,1,1);b.onChange(function(){c.setFromEuler(b,!1)});c.onChange(function(){b.setFromQuaternion(c,void 0,!1)});Object.defineProperties(this,
{position:{enumerable:!0,value:a},rotation:{enumerable:!0,value:b},quaternion:{enumerable:!0,value:c},scale:{enumerable:!0,value:d},modelViewMatrix:{value:new P},normalMatrix:{value:new ya}});this.matrix=new P;this.matrixWorld=new P;this.matrixAutoUpdate=D.DefaultMatrixAutoUpdate;this.matrixWorldNeedsUpdate=!1;this.layers=new Kc;this.visible=!0;this.receiveShadow=this.castShadow=!1;this.frustumCulled=!0;this.renderOrder=0;this.userData={};this.onBeforeRender=null}function cb(a,b){this.start=void 0!==
a?a:new q;this.end=void 0!==b?b:new q}function Fa(a,b,c){this.a=void 0!==a?a:new q;this.b=void 0!==b?b:new q;this.c=void 0!==c?c:new q}function ga(a,b,c,d,e,f){this.a=a;this.b=b;this.c=c;this.normal=d&&d.isVector3?d:new q;this.vertexNormals=Array.isArray(d)?d:[];this.color=e&&e.isColor?e:new H;this.vertexColors=Array.isArray(e)?e:[];this.materialIndex=void 0!==f?f:0}function Ia(a){S.call(this);this.type="MeshBasicMaterial";this.color=new H(16777215);this.aoMap=this.map=null;this.aoMapIntensity=1;
this.envMap=this.alphaMap=this.specularMap=null;this.combine=0;this.reflectivity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.lights=this.morphTargets=this.skinning=!1;this.setValues(a)}function z(a,b,c){if(Array.isArray(a))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.uuid=h.Math.generateUUID();this.array=a;this.itemSize=b;this.count=void 0!==a?a.length/b:0;this.normalized=!0===
c;this.dynamic=!1;this.updateRange={offset:0,count:-1};this.version=0}function be(a,b){return new z(new Uint16Array(a),b)}function ce(a,b){return new z(new Uint32Array(a),b)}function ma(a,b){return new z(new Float32Array(a),b)}function R(){Object.defineProperty(this,"id",{value:Lc++});this.uuid=h.Math.generateUUID();this.name="";this.type="Geometry";this.vertices=[];this.colors=[];this.faces=[];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphNormals=[];this.skinWeights=[];this.skinIndices=
[];this.lineDistances=[];this.boundingSphere=this.boundingBox=null;this.groupsNeedUpdate=this.lineDistancesNeedUpdate=this.colorsNeedUpdate=this.normalsNeedUpdate=this.uvsNeedUpdate=this.verticesNeedUpdate=this.elementsNeedUpdate=!1}function de(){Object.defineProperty(this,"id",{value:Lc++});this.uuid=h.Math.generateUUID();this.name="";this.type="DirectGeometry";this.indices=[];this.vertices=[];this.normals=[];this.colors=[];this.uvs=[];this.uvs2=[];this.groups=[];this.morphTargets={};this.skinWeights=
[];this.skinIndices=[];this.boundingSphere=this.boundingBox=null;this.groupsNeedUpdate=this.uvsNeedUpdate=this.colorsNeedUpdate=this.normalsNeedUpdate=this.verticesNeedUpdate=!1}function I(){Object.defineProperty(this,"id",{value:Lc++});this.uuid=h.Math.generateUUID();this.name="";this.type="BufferGeometry";this.index=null;this.attributes={};this.morphAttributes={};this.groups=[];this.boundingSphere=this.boundingBox=null;this.drawRange={start:0,count:Infinity}}function va(a,b){D.call(this);this.type=
"Mesh";this.geometry=void 0!==a?a:new I;this.material=void 0!==b?b:new Ia({color:16777215*Math.random()});this.drawMode=0;this.updateMorphTargets()}function db(a,b,c,d,e,f){function g(a,b,c,d,e,f,g,l,m,C,D){var z=f/m,L=g/C,M=f/2,O=g/2,Q=l/2;g=m+1;for(var H=C+1,V=f=0,W=new q,K=0;K<H;K++)for(var P=K*L-O,I=0;I<g;I++)W[a]=(I*z-M)*d,W[b]=P*e,W[c]=Q,h[t]=W.x,h[t+1]=W.y,h[t+2]=W.z,W[a]=0,W[b]=0,W[c]=0<l?1:-1,n[t]=W.x,n[t+1]=W.y,n[t+2]=W.z,r[v]=I/m,r[v+1]=1-K/C,t+=3,v+=2,f+=1;for(K=0;K<C;K++)for(I=0;I<m;I++)a=
w+I+g*(K+1),b=w+(I+1)+g*(K+1),c=w+(I+1)+g*K,u[A]=w+I+g*K,u[A+1]=a,u[A+2]=c,u[A+3]=a,u[A+4]=b,u[A+5]=c,A+=6,V+=6;k.addGroup(x,V,D);x+=V;w+=f}I.call(this);this.type="BoxBufferGeometry";this.parameters={width:a,height:b,depth:c,widthSegments:d,heightSegments:e,depthSegments:f};var k=this;d=Math.floor(d)||1;e=Math.floor(e)||1;f=Math.floor(f)||1;var l=function(a,b,c){return a=0+(a+1)*(b+1)*2+(a+1)*(c+1)*2+(c+1)*(b+1)*2}(d,e,f),m=function(a,b,c){a=0+a*b*2+a*c*2+c*b*2;return 6*a}(d,e,f),u=new (65535<m?Uint32Array:
Uint16Array)(m),h=new Float32Array(3*l),n=new Float32Array(3*l),r=new Float32Array(2*l),t=0,v=0,A=0,w=0,x=0;g("z","y","x",-1,-1,c,b,a,f,e,0);g("z","y","x",1,-1,c,b,-a,f,e,1);g("x","z","y",1,1,a,c,b,d,f,2);g("x","z","y",1,-1,a,c,-b,d,f,3);g("x","y","z",1,-1,a,b,c,d,e,4);g("x","y","z",-1,-1,a,b,-c,d,e,5);this.setIndex(new z(u,1));this.addAttribute("position",new z(h,3));this.addAttribute("normal",new z(n,3));this.addAttribute("uv",new z(r,2))}function eb(a,b,c,d){I.call(this);this.type="PlaneBufferGeometry";
this.parameters={width:a,height:b,widthSegments:c,heightSegments:d};var e=a/2,f=b/2;c=Math.floor(c)||1;d=Math.floor(d)||1;var g=c+1,k=d+1,l=a/c,m=b/d;b=new Float32Array(g*k*3);a=new Float32Array(g*k*3);for(var u=new Float32Array(g*k*2),h=0,n=0,r=0;r<k;r++)for(var t=r*m-f,v=0;v<g;v++)b[h]=v*l-e,b[h+1]=-t,a[h+2]=1,u[n]=v/c,u[n+1]=1-r/d,h+=3,n+=2;h=0;e=new (65535<b.length/3?Uint32Array:Uint16Array)(c*d*6);for(r=0;r<d;r++)for(v=0;v<c;v++)f=v+g*(r+1),k=v+1+g*(r+1),l=v+1+g*r,e[h]=v+g*r,e[h+1]=f,e[h+2]=
l,e[h+3]=f,e[h+4]=k,e[h+5]=l,h+=6;this.setIndex(new z(e,1));this.addAttribute("position",new z(b,3));this.addAttribute("normal",new z(a,3));this.addAttribute("uv",new z(u,2))}function qa(){D.call(this);this.type="Camera";this.matrixWorldInverse=new P;this.projectionMatrix=new P}function Ca(a,b,c,d){qa.call(this);this.type="PerspectiveCamera";this.fov=void 0!==a?a:50;this.zoom=1;this.near=void 0!==c?c:.1;this.far=void 0!==d?d:2E3;this.focus=10;this.aspect=void 0!==b?b:1;this.view=null;this.filmGauge=
35;this.filmOffset=0;this.updateProjectionMatrix()}function Db(a,b,c,d,e,f){qa.call(this);this.type="OrthographicCamera";this.zoom=1;this.view=null;this.left=a;this.right=b;this.top=c;this.bottom=d;this.near=void 0!==e?e:.1;this.far=void 0!==f?f:2E3;this.updateProjectionMatrix()}function Te(a,b,c){var d,e,f;return{setMode:function(a){d=a},setIndex:function(c){c.array instanceof Uint32Array&&b.get("OES_element_index_uint")?(e=a.UNSIGNED_INT,f=4):(e=a.UNSIGNED_SHORT,f=2)},render:function(b,k){a.drawElements(d,
k,e,b*f);c.calls++;c.vertices+=k;d===a.TRIANGLES&&(c.faces+=k/3)},renderInstances:function(g,k,l){var m=b.get("ANGLE_instanced_arrays");null===m?console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays."):(m.drawElementsInstancedANGLE(d,l,e,k*f,g.maxInstancedCount),c.calls++,c.vertices+=l*g.maxInstancedCount,d===a.TRIANGLES&&(c.faces+=g.maxInstancedCount*l/3))}}}function Ue(a,b,c){var d;return{setMode:function(a){d=
a},render:function(b,f){a.drawArrays(d,b,f);c.calls++;c.vertices+=f;d===a.TRIANGLES&&(c.faces+=f/3)},renderInstances:function(e){var f=b.get("ANGLE_instanced_arrays");if(null===f)console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");else{var g=e.attributes.position,g=g&&g.isInterleavedBufferAttribute?g.data.count:g.count;f.drawArraysInstancedANGLE(d,0,g,e.maxInstancedCount);c.calls++;c.vertices+=g*e.maxInstancedCount;
d===a.TRIANGLES&&(c.faces+=e.maxInstancedCount*g/3)}}}}function Ve(){var a={};return{get:function(b){if(void 0!==a[b.id])return a[b.id];var c;switch(b.type){case "DirectionalLight":c={direction:new q,color:new H,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new C};break;case "SpotLight":c={position:new q,direction:new q,color:new H,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new C};break;case "PointLight":c={position:new q,color:new H,distance:0,
decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new C};break;case "HemisphereLight":c={direction:new q,skyColor:new H,groundColor:new H}}return a[b.id]=c}}}function We(a){a=a.split("\n");for(var b=0;b<a.length;b++)a[b]=b+1+": "+a[b];return a.join("\n")}function ee(a,b,c){var d=a.createShader(b);a.shaderSource(d,c);a.compileShader(d);!1===a.getShaderParameter(d,a.COMPILE_STATUS)&&console.error("THREE.WebGLShader: Shader couldn't compile.");""!==a.getShaderInfoLog(d)&&console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",
b===a.VERTEX_SHADER?"vertex":"fragment",a.getShaderInfoLog(d),We(c));return d}function fe(a){switch(a){case 3E3:return["Linear","( value )"];case 3001:return["sRGB","( value )"];case 3002:return["RGBE","( value )"];case 3004:return["RGBM","( value, 7.0 )"];case 3005:return["RGBM","( value, 16.0 )"];case 3006:return["RGBD","( value, 256.0 )"];case 3007:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:throw Error("unsupported encoding: "+a);}}function md(a,b){var c=fe(b);return"vec4 "+a+"( vec4 value ) { return "+
c[0]+"ToLinear"+c[1]+"; }"}function Xe(a,b){var c=fe(b);return"vec4 "+a+"( vec4 value ) { return LinearTo"+c[0]+c[1]+"; }"}function Ye(a,b){var c;switch(b){case 1:c="Linear";break;case 2:c="Reinhard";break;case 3:c="Uncharted2";break;case 4:c="OptimizedCineon";break;default:throw Error("unsupported toneMapping: "+b);}return"vec3 "+a+"( vec3 color ) { return "+c+"ToneMapping( color ); }"}function Ze(a,b,c){a=a||{};return[a.derivatives||b.envMapCubeUV||b.bumpMap||b.normalMap||b.flatShading?"#extension GL_OES_standard_derivatives : enable":
"",(a.fragDepth||b.logarithmicDepthBuffer)&&c.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",a.drawBuffers&&c.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(a.shaderTextureLOD||b.envMap)&&c.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""].filter(ec).join("\n")}function $e(a){var b=[],c;for(c in a){var d=a[c];!1!==d&&b.push("#define "+c+" "+d)}return b.join("\n")}function ec(a){return""!==a}function ge(a,b){return a.replace(/NUM_DIR_LIGHTS/g,
b.numDirLights).replace(/NUM_SPOT_LIGHTS/g,b.numSpotLights).replace(/NUM_POINT_LIGHTS/g,b.numPointLights).replace(/NUM_HEMI_LIGHTS/g,b.numHemiLights)}function nd(a){return a.replace(/#include +<([\w\d.]+)>/g,function(a,c){var d=Z[c];if(void 0===d)throw Error("Can not resolve #include <"+c+">");return nd(d)})}function he(a){return a.replace(/for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,function(a,c,d,e){a="";for(c=parseInt(c);c<parseInt(d);c++)a+=e.replace(/\[ i \]/g,"[ "+c+
" ]");return a})}function af(a,b,c,d){var e=a.context,f=c.extensions,g=c.defines,k=c.__webglShader.vertexShader,l=c.__webglShader.fragmentShader,m="SHADOWMAP_TYPE_BASIC";1===d.shadowMapType?m="SHADOWMAP_TYPE_PCF":2===d.shadowMapType&&(m="SHADOWMAP_TYPE_PCF_SOFT");var h="ENVMAP_TYPE_CUBE",p="ENVMAP_MODE_REFLECTION",n="ENVMAP_BLENDING_MULTIPLY";if(d.envMap){switch(c.envMap.mapping){case 301:case 302:h="ENVMAP_TYPE_CUBE";break;case 306:case 307:h="ENVMAP_TYPE_CUBE_UV";break;case 303:case 304:h="ENVMAP_TYPE_EQUIREC";
break;case 305:h="ENVMAP_TYPE_SPHERE"}switch(c.envMap.mapping){case 302:case 304:p="ENVMAP_MODE_REFRACTION"}switch(c.combine){case 0:n="ENVMAP_BLENDING_MULTIPLY";break;case 1:n="ENVMAP_BLENDING_MIX";break;case 2:n="ENVMAP_BLENDING_ADD"}}var r=0<a.gammaFactor?a.gammaFactor:1,f=Ze(f,d,a.extensions),t=$e(g),v=e.createProgram();c.isRawShaderMaterial?(g=[t,"\n"].filter(ec).join("\n"),m=[f,t,"\n"].filter(ec).join("\n")):(g=["precision "+d.precision+" float;","precision "+d.precision+" int;","#define SHADER_NAME "+
c.__webglShader.name,t,d.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+r,"#define MAX_BONES "+d.maxBones,d.map?"#define USE_MAP":"",d.envMap?"#define USE_ENVMAP":"",d.envMap?"#define "+p:"",d.lightMap?"#define USE_LIGHTMAP":"",d.aoMap?"#define USE_AOMAP":"",d.emissiveMap?"#define USE_EMISSIVEMAP":"",d.bumpMap?"#define USE_BUMPMAP":"",d.normalMap?"#define USE_NORMALMAP":"",d.displacementMap&&d.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",d.specularMap?"#define USE_SPECULARMAP":
"",d.roughnessMap?"#define USE_ROUGHNESSMAP":"",d.metalnessMap?"#define USE_METALNESSMAP":"",d.alphaMap?"#define USE_ALPHAMAP":"",d.vertexColors?"#define USE_COLOR":"",d.flatShading?"#define FLAT_SHADED":"",d.skinning?"#define USE_SKINNING":"",d.useVertexTexture?"#define BONE_TEXTURE":"",d.morphTargets?"#define USE_MORPHTARGETS":"",d.morphNormals&&!1===d.flatShading?"#define USE_MORPHNORMALS":"",d.doubleSided?"#define DOUBLE_SIDED":"",d.flipSided?"#define FLIP_SIDED":"","#define NUM_CLIPPING_PLANES "+
d.numClippingPlanes,d.shadowMapEnabled?"#define USE_SHADOWMAP":"",d.shadowMapEnabled?"#define "+m:"",d.sizeAttenuation?"#define USE_SIZEATTENUATION":"",d.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",d.logarithmicDepthBuffer&&a.extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;",
"attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;",
"\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(ec).join("\n"),m=[f,"precision "+d.precision+" float;","precision "+d.precision+" int;","#define SHADER_NAME "+c.__webglShader.name,t,d.alphaTest?"#define ALPHATEST "+d.alphaTest:"","#define GAMMA_FACTOR "+r,d.useFog&&d.fog?"#define USE_FOG":"",d.useFog&&d.fogExp?"#define FOG_EXP2":"",d.map?"#define USE_MAP":
"",d.envMap?"#define USE_ENVMAP":"",d.envMap?"#define "+h:"",d.envMap?"#define "+p:"",d.envMap?"#define "+n:"",d.lightMap?"#define USE_LIGHTMAP":"",d.aoMap?"#define USE_AOMAP":"",d.emissiveMap?"#define USE_EMISSIVEMAP":"",d.bumpMap?"#define USE_BUMPMAP":"",d.normalMap?"#define USE_NORMALMAP":"",d.specularMap?"#define USE_SPECULARMAP":"",d.roughnessMap?"#define USE_ROUGHNESSMAP":"",d.metalnessMap?"#define USE_METALNESSMAP":"",d.alphaMap?"#define USE_ALPHAMAP":"",d.vertexColors?"#define USE_COLOR":
"",d.flatShading?"#define FLAT_SHADED":"",d.doubleSided?"#define DOUBLE_SIDED":"",d.flipSided?"#define FLIP_SIDED":"","#define NUM_CLIPPING_PLANES "+d.numClippingPlanes,d.shadowMapEnabled?"#define USE_SHADOWMAP":"",d.shadowMapEnabled?"#define "+m:"",d.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",d.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",d.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",d.logarithmicDepthBuffer&&a.extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":
"",d.envMap&&a.extensions.get("EXT_shader_texture_lod")?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",0!==d.toneMapping?"#define TONE_MAPPING":"",0!==d.toneMapping?Z.tonemapping_pars_fragment:"",0!==d.toneMapping?Ye("toneMapping",d.toneMapping):"",d.outputEncoding||d.mapEncoding||d.envMapEncoding||d.emissiveMapEncoding?Z.encodings_pars_fragment:"",d.mapEncoding?md("mapTexelToLinear",d.mapEncoding):"",d.envMapEncoding?md("envMapTexelToLinear",d.envMapEncoding):
"",d.emissiveMapEncoding?md("emissiveMapTexelToLinear",d.emissiveMapEncoding):"",d.outputEncoding?Xe("linearToOutputTexel",d.outputEncoding):"",d.depthPacking?"#define DEPTH_PACKING "+c.depthPacking:"","\n"].filter(ec).join("\n"));k=nd(k,d);k=ge(k,d);l=nd(l,d);l=ge(l,d);c.isShaderMaterial||(k=he(k),l=he(l));l=m+l;k=ee(e,e.VERTEX_SHADER,g+k);l=ee(e,e.FRAGMENT_SHADER,l);e.attachShader(v,k);e.attachShader(v,l);void 0!==c.index0AttributeName?e.bindAttribLocation(v,0,c.index0AttributeName):!0===d.morphTargets&&
e.bindAttribLocation(v,0,"position");e.linkProgram(v);d=e.getProgramInfoLog(v);h=e.getShaderInfoLog(k);p=e.getShaderInfoLog(l);r=n=!0;if(!1===e.getProgramParameter(v,e.LINK_STATUS))n=!1,console.error("THREE.WebGLProgram: shader error: ",e.getError(),"gl.VALIDATE_STATUS",e.getProgramParameter(v,e.VALIDATE_STATUS),"gl.getProgramInfoLog",d,h,p);else if(""!==d)console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",d);else if(""===h||""===p)r=!1;r&&(this.diagnostics={runnable:n,material:c,programLog:d,
vertexShader:{log:h,prefix:g},fragmentShader:{log:p,prefix:m}});e.deleteShader(k);e.deleteShader(l);var A;this.getUniforms=function(){void 0===A&&(A=new Ga(e,v,a));return A};var w;this.getAttributes=function(){if(void 0===w){for(var a={},b=e.getProgramParameter(v,e.ACTIVE_ATTRIBUTES),c=0;c<b;c++){var d=e.getActiveAttrib(v,c).name;a[d]=e.getAttribLocation(v,d)}w=a}return w};this.destroy=function(){e.deleteProgram(v);this.program=void 0};Object.defineProperties(this,{uniforms:{get:function(){console.warn("THREE.WebGLProgram: .uniforms is now .getUniforms().");
return this.getUniforms()}},attributes:{get:function(){console.warn("THREE.WebGLProgram: .attributes is now .getAttributes().");return this.getAttributes()}}});this.id=bf++;this.code=b;this.usedTimes=1;this.program=v;this.vertexShader=k;this.fragmentShader=l;return this}function cf(a,b){function c(a,b){var c;a?a&&a.isTexture?c=a.encoding:a&&a.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),
c=a.texture.encoding):c=3E3;3E3===c&&b&&(c=3007);return c}var d=[],e={MeshDepthMaterial:"depth",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points"},f="precision supportsVertexTextures map mapEncoding envMap envMapMode envMapEncoding lightMap aoMap emissiveMap emissiveMapEncoding bumpMap normalMap displacementMap specularMap roughnessMap metalnessMap alphaMap combine vertexColors fog useFog fogExp flatShading sizeAttenuation logarithmicDepthBuffer skinning maxBones useVertexTexture morphTargets morphNormals maxMorphTargets maxMorphNormals premultipliedAlpha numDirLights numPointLights numSpotLights numHemiLights shadowMapEnabled shadowMapType toneMapping physicallyCorrectLights alphaTest doubleSided flipSided numClippingPlanes depthPacking".split(" ");
this.getParameters=function(d,f,l,m,h){var p=e[d.type],n;b.floatVertexTextures&&h&&h.skeleton&&h.skeleton.useVertexTexture?n=1024:(n=Math.floor((b.maxVertexUniforms-20)/4),void 0!==h&&h&&h.isSkinnedMesh&&(n=Math.min(h.skeleton.bones.length,n),n<h.skeleton.bones.length&&console.warn("WebGLRenderer: too many bones - "+h.skeleton.bones.length+", this GPU supports just "+n+" (try OpenGL instead of ANGLE)")));var r=a.getPrecision();null!==d.precision&&(r=b.getMaxPrecision(d.precision),r!==d.precision&&
console.warn("THREE.WebGLProgram.getParameters:",d.precision,"not supported, using",r,"instead."));var t=a.getCurrentRenderTarget();return{shaderID:p,precision:r,supportsVertexTextures:b.vertexTextures,outputEncoding:c(t?t.texture:null,a.gammaOutput),map:!!d.map,mapEncoding:c(d.map,a.gammaInput),envMap:!!d.envMap,envMapMode:d.envMap&&d.envMap.mapping,envMapEncoding:c(d.envMap,a.gammaInput),envMapCubeUV:!!d.envMap&&(306===d.envMap.mapping||307===d.envMap.mapping),lightMap:!!d.lightMap,aoMap:!!d.aoMap,
emissiveMap:!!d.emissiveMap,emissiveMapEncoding:c(d.emissiveMap,a.gammaInput),bumpMap:!!d.bumpMap,normalMap:!!d.normalMap,displacementMap:!!d.displacementMap,roughnessMap:!!d.roughnessMap,metalnessMap:!!d.metalnessMap,specularMap:!!d.specularMap,alphaMap:!!d.alphaMap,combine:d.combine,vertexColors:d.vertexColors,fog:!!l,useFog:d.fog,fogExp:l&&l.isFogExp2,flatShading:1===d.shading,sizeAttenuation:d.sizeAttenuation,logarithmicDepthBuffer:b.logarithmicDepthBuffer,skinning:d.skinning,maxBones:n,useVertexTexture:b.floatVertexTextures&&
h&&h.skeleton&&h.skeleton.useVertexTexture,morphTargets:d.morphTargets,morphNormals:d.morphNormals,maxMorphTargets:a.maxMorphTargets,maxMorphNormals:a.maxMorphNormals,numDirLights:f.directional.length,numPointLights:f.point.length,numSpotLights:f.spot.length,numHemiLights:f.hemi.length,numClippingPlanes:m,shadowMapEnabled:a.shadowMap.enabled&&h.receiveShadow&&0<f.shadows.length,shadowMapType:a.shadowMap.type,toneMapping:a.toneMapping,physicallyCorrectLights:a.physicallyCorrectLights,premultipliedAlpha:d.premultipliedAlpha,
alphaTest:d.alphaTest,doubleSided:2===d.side,flipSided:1===d.side,depthPacking:void 0!==d.depthPacking?d.depthPacking:!1}};this.getProgramCode=function(a,b){var c=[];b.shaderID?c.push(b.shaderID):(c.push(a.fragmentShader),c.push(a.vertexShader));if(void 0!==a.defines)for(var d in a.defines)c.push(d),c.push(a.defines[d]);for(d=0;d<f.length;d++)c.push(b[f[d]]);return c.join()};this.acquireProgram=function(b,c,e){for(var f,h=0,p=d.length;h<p;h++){var n=d[h];if(n.code===e){f=n;++f.usedTimes;break}}void 0===
f&&(f=new af(a,e,b,c),d.push(f));return f};this.releaseProgram=function(a){if(0===--a.usedTimes){var b=d.indexOf(a);d[b]=d[d.length-1];d.pop();a.destroy()}};this.programs=d}function df(a,b,c){function d(a){var k=a.target;a=f[k.id];null!==a.index&&e(a.index);var l=a.attributes,m;for(m in l)e(l[m]);k.removeEventListener("dispose",d);delete f[k.id];m=b.get(k);m.wireframe&&e(m.wireframe);b["delete"](k);k=b.get(a);k.wireframe&&e(k.wireframe);b["delete"](a);c.memory.geometries--}function e(c){var d;d=c.isInterleavedBufferAttribute?
b.get(c.data).__webglBuffer:b.get(c).__webglBuffer;void 0!==d&&(a.deleteBuffer(d),c.isInterleavedBufferAttribute?b["delete"](c.data):b["delete"](c))}var f={};return{get:function(a){var b=a.geometry;if(void 0!==f[b.id])return f[b.id];b.addEventListener("dispose",d);var e;b.isBufferGeometry?e=b:b.isGeometry&&(void 0===b._bufferGeometry&&(b._bufferGeometry=(new I).setFromObject(a)),e=b._bufferGeometry);f[b.id]=e;c.memory.geometries++;return e}}}function ef(a,b,c){function d(c,d){var e=c.isInterleavedBufferAttribute?
c.data:c,l=b.get(e);void 0===l.__webglBuffer?(l.__webglBuffer=a.createBuffer(),a.bindBuffer(d,l.__webglBuffer),a.bufferData(d,e.array,e.dynamic?a.DYNAMIC_DRAW:a.STATIC_DRAW),l.version=e.version):l.version!==e.version&&(a.bindBuffer(d,l.__webglBuffer),!1===e.dynamic||-1===e.updateRange.count?a.bufferSubData(d,0,e.array):0===e.updateRange.count?console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually."):
(a.bufferSubData(d,e.updateRange.offset*e.array.BYTES_PER_ELEMENT,e.array.subarray(e.updateRange.offset,e.updateRange.offset+e.updateRange.count)),e.updateRange.count=0),l.version=e.version)}var e=new df(a,b,c);return{getAttributeBuffer:function(a){return a.isInterleavedBufferAttribute?b.get(a.data).__webglBuffer:b.get(a).__webglBuffer},getWireframeAttribute:function(c){var e=b.get(c);if(void 0!==e.wireframe)return e.wireframe;var k=[],l=c.index,m=c.attributes;c=m.position;if(null!==l)for(var l=l.array,
m=0,h=l.length;m<h;m+=3){var p=l[m+0],n=l[m+1],r=l[m+2];k.push(p,n,n,r,r,p)}else for(l=m.position.array,m=0,h=l.length/3-1;m<h;m+=3)p=m+0,n=m+1,r=m+2,k.push(p,n,n,r,r,p);k=new z(new (65535<c.count?Uint32Array:Uint16Array)(k),1);d(k,a.ELEMENT_ARRAY_BUFFER);return e.wireframe=k},update:function(b){var c=e.get(b);b.geometry.isGeometry&&c.updateFromObject(b);b=c.index;var k=c.attributes;null!==b&&d(b,a.ELEMENT_ARRAY_BUFFER);for(var l in k)d(k[l],a.ARRAY_BUFFER);b=c.morphAttributes;for(l in b)for(var k=
b[l],m=0,h=k.length;m<h;m++)d(k[m],a.ARRAY_BUFFER);return c}}}function ff(a,b,c,d,e,f,g){function k(a,b){if(a.width>b||a.height>b){var c=b/Math.max(a.width,a.height),d=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");d.width=Math.floor(a.width*c);d.height=Math.floor(a.height*c);d.getContext("2d").drawImage(a,0,0,a.width,a.height,0,0,d.width,d.height);console.warn("THREE.WebGLRenderer: image is too big ("+a.width+"x"+a.height+"). Resized to "+d.width+"x"+d.height,a);return d}return a}
function l(a){return h.Math.isPowerOfTwo(a.width)&&h.Math.isPowerOfTwo(a.height)}function m(b){return 1003===b||1004===b||1005===b?a.NEAREST:a.LINEAR}function u(b){b=b.target;b.removeEventListener("dispose",u);a:{var c=d.get(b);if(b.image&&c.__image__webglTextureCube)a.deleteTexture(c.__image__webglTextureCube);else{if(void 0===c.__webglInit)break a;a.deleteTexture(c.__webglTexture)}d["delete"](b)}A.textures--}function p(b){b=b.target;b.removeEventListener("dispose",p);var c=d.get(b),e=d.get(b.texture);
if(b){void 0!==e.__webglTexture&&a.deleteTexture(e.__webglTexture);b.depthTexture&&b.depthTexture.dispose();if(b&&b.isWebGLRenderTargetCube)for(e=0;6>e;e++)a.deleteFramebuffer(c.__webglFramebuffer[e]),c.__webglDepthbuffer&&a.deleteRenderbuffer(c.__webglDepthbuffer[e]);else a.deleteFramebuffer(c.__webglFramebuffer),c.__webglDepthbuffer&&a.deleteRenderbuffer(c.__webglDepthbuffer);d["delete"](b.texture);d["delete"](b)}A.textures--}function n(b,g){var m=d.get(b);if(0<b.version&&m.__version!==b.version){var n=
b.image;if(void 0===n)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined",b);else if(!1===n.complete)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete",b);else{void 0===m.__webglInit&&(m.__webglInit=!0,b.addEventListener("dispose",u),m.__webglTexture=a.createTexture(),A.textures++);c.activeTexture(a.TEXTURE0+g);c.bindTexture(a.TEXTURE_2D,m.__webglTexture);a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,b.flipY);a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,
b.premultiplyAlpha);a.pixelStorei(a.UNPACK_ALIGNMENT,b.unpackAlignment);var p=k(b.image,e.maxTextureSize);if((1001!==b.wrapS||1001!==b.wrapT||1003!==b.minFilter&&1006!==b.minFilter)&&!1===l(p))if(n=p,n instanceof HTMLImageElement||n instanceof HTMLCanvasElement){var t=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");t.width=h.Math.nearestPowerOfTwo(n.width);t.height=h.Math.nearestPowerOfTwo(n.height);t.getContext("2d").drawImage(n,0,0,t.width,t.height);console.warn("THREE.WebGLRenderer: image is not power of two ("+
n.width+"x"+n.height+"). Resized to "+t.width+"x"+t.height,n);p=t}else p=n;var n=l(p),t=f(b.format),v=f(b.type);r(a.TEXTURE_2D,b,n);var q=b.mipmaps;if(b&&b.isDepthTexture){q=a.DEPTH_COMPONENT;if(1015===b.type){if(!w)throw Error("Float Depth Texture only supported in WebGL2.0");q=a.DEPTH_COMPONENT32F}else w&&(q=a.DEPTH_COMPONENT16);1027===b.format&&(q=a.DEPTH_STENCIL);c.texImage2D(a.TEXTURE_2D,0,q,p.width,p.height,0,t,v,null)}else if(b&&b.isDataTexture)if(0<q.length&&n){for(var N=0,C=q.length;N<C;N++)p=
q[N],c.texImage2D(a.TEXTURE_2D,N,t,p.width,p.height,0,t,v,p.data);b.generateMipmaps=!1}else c.texImage2D(a.TEXTURE_2D,0,t,p.width,p.height,0,t,v,p.data);else if(b&&b.isCompressedTexture)for(N=0,C=q.length;N<C;N++)p=q[N],1023!==b.format&&1022!==b.format?-1<c.getCompressedTextureFormats().indexOf(t)?c.compressedTexImage2D(a.TEXTURE_2D,N,t,p.width,p.height,0,p.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):c.texImage2D(a.TEXTURE_2D,
N,t,p.width,p.height,0,t,v,p.data);else if(0<q.length&&n){N=0;for(C=q.length;N<C;N++)p=q[N],c.texImage2D(a.TEXTURE_2D,N,t,t,v,p);b.generateMipmaps=!1}else c.texImage2D(a.TEXTURE_2D,0,t,t,v,p);b.generateMipmaps&&n&&a.generateMipmap(a.TEXTURE_2D);m.__version=b.version;if(b.onUpdate)b.onUpdate(b);return}}c.activeTexture(a.TEXTURE0+g);c.bindTexture(a.TEXTURE_2D,m.__webglTexture)}function r(c,g,k){k?(a.texParameteri(c,a.TEXTURE_WRAP_S,f(g.wrapS)),a.texParameteri(c,a.TEXTURE_WRAP_T,f(g.wrapT)),a.texParameteri(c,
a.TEXTURE_MAG_FILTER,f(g.magFilter)),a.texParameteri(c,a.TEXTURE_MIN_FILTER,f(g.minFilter))):(a.texParameteri(c,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(c,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),1001===g.wrapS&&1001===g.wrapT||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping.",g),a.texParameteri(c,a.TEXTURE_MAG_FILTER,m(g.magFilter)),a.texParameteri(c,a.TEXTURE_MIN_FILTER,m(g.minFilter)),1003!==g.minFilter&&
1006!==g.minFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.",g));!(k=b.get("EXT_texture_filter_anisotropic"))||1015===g.type&&null===b.get("OES_texture_float_linear")||1016===g.type&&null===b.get("OES_texture_half_float_linear")||!(1<g.anisotropy||d.get(g).__currentAnisotropy)||(a.texParameterf(c,k.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(g.anisotropy,e.getMaxAnisotropy())),d.get(g).__currentAnisotropy=
g.anisotropy)}function t(b,e,g,k){var l=f(e.texture.format),m=f(e.texture.type);c.texImage2D(k,0,l,e.width,e.height,0,l,m,null);a.bindFramebuffer(a.FRAMEBUFFER,b);a.framebufferTexture2D(a.FRAMEBUFFER,g,k,d.get(e.texture).__webglTexture,0);a.bindFramebuffer(a.FRAMEBUFFER,null)}function v(b,c){a.bindRenderbuffer(a.RENDERBUFFER,b);c.depthBuffer&&!c.stencilBuffer?(a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_COMPONENT16,c.width,c.height),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,
b)):c.depthBuffer&&c.stencilBuffer?(a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_STENCIL,c.width,c.height),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,b)):a.renderbufferStorage(a.RENDERBUFFER,a.RGBA4,c.width,c.height);a.bindRenderbuffer(a.RENDERBUFFER,null)}var A=g.memory,w="undefined"!==typeof WebGL2RenderingContext&&a instanceof WebGL2RenderingContext;this.setTexture2D=n;this.setTextureCube=function(b,g){var m=d.get(b);if(6===b.image.length)if(0<b.version&&
m.__version!==b.version){m.__image__webglTextureCube||(b.addEventListener("dispose",u),m.__image__webglTextureCube=a.createTexture(),A.textures++);c.activeTexture(a.TEXTURE0+g);c.bindTexture(a.TEXTURE_CUBE_MAP,m.__image__webglTextureCube);a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,b.flipY);for(var h=b&&b.isCompressedTexture,n=b.image[0]&&b.image[0].isDataTexture,p=[],t=0;6>t;t++)p[t]=h||n?n?b.image[t].image:b.image[t]:k(b.image[t],e.maxCubemapSize);var v=l(p[0]),q=f(b.format),w=f(b.type);r(a.TEXTURE_CUBE_MAP,
b,v);for(t=0;6>t;t++)if(h)for(var C,D=p[t].mipmaps,z=0,L=D.length;z<L;z++)C=D[z],1023!==b.format&&1022!==b.format?-1<c.getCompressedTextureFormats().indexOf(q)?c.compressedTexImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+t,z,q,C.width,C.height,0,C.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):c.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+t,z,q,C.width,C.height,0,q,w,C.data);else n?c.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,q,p[t].width,
p[t].height,0,q,w,p[t].data):c.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,q,q,w,p[t]);b.generateMipmaps&&v&&a.generateMipmap(a.TEXTURE_CUBE_MAP);m.__version=b.version;if(b.onUpdate)b.onUpdate(b)}else c.activeTexture(a.TEXTURE0+g),c.bindTexture(a.TEXTURE_CUBE_MAP,m.__image__webglTextureCube)};this.setTextureCubeDynamic=function(b,e){c.activeTexture(a.TEXTURE0+e);c.bindTexture(a.TEXTURE_CUBE_MAP,d.get(b).__webglTexture)};this.setupRenderTarget=function(b){var e=d.get(b),f=d.get(b.texture);b.addEventListener("dispose",
p);f.__webglTexture=a.createTexture();A.textures++;var g=b&&b.isWebGLRenderTargetCube,k=l(b);if(g){e.__webglFramebuffer=[];for(var m=0;6>m;m++)e.__webglFramebuffer[m]=a.createFramebuffer()}else e.__webglFramebuffer=a.createFramebuffer();if(g){c.bindTexture(a.TEXTURE_CUBE_MAP,f.__webglTexture);r(a.TEXTURE_CUBE_MAP,b.texture,k);for(m=0;6>m;m++)t(e.__webglFramebuffer[m],b,a.COLOR_ATTACHMENT0,a.TEXTURE_CUBE_MAP_POSITIVE_X+m);b.texture.generateMipmaps&&k&&a.generateMipmap(a.TEXTURE_CUBE_MAP);c.bindTexture(a.TEXTURE_CUBE_MAP,
null)}else c.bindTexture(a.TEXTURE_2D,f.__webglTexture),r(a.TEXTURE_2D,b.texture,k),t(e.__webglFramebuffer,b,a.COLOR_ATTACHMENT0,a.TEXTURE_2D),b.texture.generateMipmaps&&k&&a.generateMipmap(a.TEXTURE_2D),c.bindTexture(a.TEXTURE_2D,null);if(b.depthBuffer){e=d.get(b);f=b&&b.isWebGLRenderTargetCube;if(b.depthTexture){if(f)throw Error("target.depthTexture not supported in Cube render targets");if(b&&b.isWebGLRenderTargetCube)throw Error("Depth Texture with cube render targets is not supported!");a.bindFramebuffer(a.FRAMEBUFFER,
e.__webglFramebuffer);if(!b.depthTexture||!b.depthTexture.isDepthTexture)throw Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");d.get(b.depthTexture).__webglTexture&&b.depthTexture.image.width===b.width&&b.depthTexture.image.height===b.height||(b.depthTexture.image.width=b.width,b.depthTexture.image.height=b.height,b.depthTexture.needsUpdate=!0);n(b.depthTexture,0);e=d.get(b.depthTexture).__webglTexture;if(1026===b.depthTexture.format)a.framebufferTexture2D(a.FRAMEBUFFER,
a.DEPTH_ATTACHMENT,a.TEXTURE_2D,e,0);else if(1027===b.depthTexture.format)a.framebufferTexture2D(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.TEXTURE_2D,e,0);else throw Error("Unknown depthTexture format");}else if(f)for(e.__webglDepthbuffer=[],f=0;6>f;f++)a.bindFramebuffer(a.FRAMEBUFFER,e.__webglFramebuffer[f]),e.__webglDepthbuffer[f]=a.createRenderbuffer(),v(e.__webglDepthbuffer[f],b);else a.bindFramebuffer(a.FRAMEBUFFER,e.__webglFramebuffer),e.__webglDepthbuffer=a.createRenderbuffer(),v(e.__webglDepthbuffer,
b);a.bindFramebuffer(a.FRAMEBUFFER,null)}};this.updateRenderTargetMipmap=function(b){var e=b.texture;e.generateMipmaps&&l(b)&&1003!==e.minFilter&&1006!==e.minFilter&&(b=b&&b.isWebGLRenderTargetCube?a.TEXTURE_CUBE_MAP:a.TEXTURE_2D,e=d.get(e).__webglTexture,c.bindTexture(b,e),a.generateMipmap(b),c.bindTexture(b,null))}}function gf(){var a={};return{get:function(b){b=b.uuid;var c=a[b];void 0===c&&(c={},a[b]=c);return c},"delete":function(b){delete a[b.uuid]},clear:function(){a={}}}}function hf(a,b,c){function d(b,
c,d){var e=new Uint8Array(4),f=a.createTexture();a.bindTexture(b,f);a.texParameteri(b,a.TEXTURE_MIN_FILTER,a.NEAREST);a.texParameteri(b,a.TEXTURE_MAG_FILTER,a.NEAREST);for(b=0;b<d;b++)a.texImage2D(c+b,0,a.RGBA,1,1,0,a.RGBA,a.UNSIGNED_BYTE,e);return f}function e(b){!0!==F[b]&&(a.enable(b),F[b]=!0)}function f(b){!1!==F[b]&&(a.disable(b),F[b]=!1)}function g(b,d,g,k,l,m,h,n){if(0!==b){e(a.BLEND);if(b!==E||n!==Ea)2===b?n?(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.ONE,a.ONE,a.ONE,
a.ONE)):(a.blendEquation(a.FUNC_ADD),a.blendFunc(a.SRC_ALPHA,a.ONE)):3===b?n?(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.ZERO,a.ZERO,a.ONE_MINUS_SRC_COLOR,a.ONE_MINUS_SRC_ALPHA)):(a.blendEquation(a.FUNC_ADD),a.blendFunc(a.ZERO,a.ONE_MINUS_SRC_COLOR)):4===b?n?(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.ZERO,a.SRC_COLOR,a.ZERO,a.SRC_ALPHA)):(a.blendEquation(a.FUNC_ADD),a.blendFunc(a.ZERO,a.SRC_COLOR)):n?(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),
a.blendFuncSeparate(a.ONE,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA)):(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA)),E=b,Ea=n;if(5===b){l=l||d;m=m||g;h=h||k;if(d!==J||l!==ea)a.blendEquationSeparate(c(d),c(l)),J=d,ea=l;if(g!==C||k!==N||m!==z||h!==D)a.blendFuncSeparate(c(g),c(k),c(m),c(h)),C=g,N=k,z=m,D=h}else D=z=ea=N=C=J=null}else f(a.BLEND),E=b}function k(a){v.setFunc(a)}function l(b){L!==b&&(b?a.frontFace(a.CW):
a.frontFace(a.CCW),L=b)}function m(b){0!==b?(e(a.CULL_FACE),b!==M&&(1===b?a.cullFace(a.BACK):2===b?a.cullFace(a.FRONT):a.cullFace(a.FRONT_AND_BACK))):f(a.CULL_FACE);M=b}function h(b){void 0===b&&(b=a.TEXTURE0+W-1);K!==b&&(a.activeTexture(b),K=b)}function p(a,b,c,d){t.setClear(a,b,c,d)}function n(a){v.setClear(a)}function r(a){q.setClear(a)}var t=new function(){var b=!1,c=new da,d=null,e=new da;return{setMask:function(c){d===c||b||(a.colorMask(c,c,c,c),d=c)},setLocked:function(a){b=a},setClear:function(b,
d,f,g){c.set(b,d,f,g);!1===e.equals(c)&&(a.clearColor(b,d,f,g),e.copy(c))},reset:function(){b=!1;d=null;e.set(0,0,0,1)}}},v=new function(){var b=!1,c=null,d=null,g=null;return{setTest:function(b){b?e(a.DEPTH_TEST):f(a.DEPTH_TEST)},setMask:function(d){c===d||b||(a.depthMask(d),c=d)},setFunc:function(b){if(d!==b){if(b)switch(b){case 0:a.depthFunc(a.NEVER);break;case 1:a.depthFunc(a.ALWAYS);break;case 2:a.depthFunc(a.LESS);break;case 3:a.depthFunc(a.LEQUAL);break;case 4:a.depthFunc(a.EQUAL);break;case 5:a.depthFunc(a.GEQUAL);
break;case 6:a.depthFunc(a.GREATER);break;case 7:a.depthFunc(a.NOTEQUAL);break;default:a.depthFunc(a.LEQUAL)}else a.depthFunc(a.LEQUAL);d=b}},setLocked:function(a){b=a},setClear:function(b){g!==b&&(a.clearDepth(b),g=b)},reset:function(){b=!1;g=d=c=null}}},q=new function(){var b=!1,c=null,d=null,g=null,k=null,l=null,m=null,h=null,n=null;return{setTest:function(b){b?e(a.STENCIL_TEST):f(a.STENCIL_TEST)},setMask:function(d){c===d||b||(a.stencilMask(d),c=d)},setFunc:function(b,c,e){if(d!==b||g!==c||k!==
e)a.stencilFunc(b,c,e),d=b,g=c,k=e},setOp:function(b,c,d){if(l!==b||m!==c||h!==d)a.stencilOp(b,c,d),l=b,m=c,h=d},setLocked:function(a){b=a},setClear:function(b){n!==b&&(a.clearStencil(b),n=b)},reset:function(){b=!1;n=h=m=l=k=g=d=c=null}}},w=a.getParameter(a.MAX_VERTEX_ATTRIBS),x=new Uint8Array(w),T=new Uint8Array(w),y=new Uint8Array(w),F={},G=null,E=null,J=null,C=null,N=null,ea=null,z=null,D=null,Ea=!1,L=null,M=null,O=null,Q=null,I=null,V=null,W=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS),K=null,H=
{},P=new da,S=new da,bb={};bb[a.TEXTURE_2D]=d(a.TEXTURE_2D,a.TEXTURE_2D,1);bb[a.TEXTURE_CUBE_MAP]=d(a.TEXTURE_CUBE_MAP,a.TEXTURE_CUBE_MAP_POSITIVE_X,6);return{buffers:{color:t,depth:v,stencil:q},init:function(){p(0,0,0,1);n(1);r(0);e(a.DEPTH_TEST);k(3);l(!1);m(1);e(a.CULL_FACE);e(a.BLEND);g(1)},initAttributes:function(){for(var a=0,b=x.length;a<b;a++)x[a]=0},enableAttribute:function(c){x[c]=1;0===T[c]&&(a.enableVertexAttribArray(c),T[c]=1);0!==y[c]&&(b.get("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(c,
0),y[c]=0)},enableAttributeAndDivisor:function(b,c,d){x[b]=1;0===T[b]&&(a.enableVertexAttribArray(b),T[b]=1);y[b]!==c&&(d.vertexAttribDivisorANGLE(b,c),y[b]=c)},disableUnusedAttributes:function(){for(var b=0,c=T.length;b!==c;++b)T[b]!==x[b]&&(a.disableVertexAttribArray(b),T[b]=0)},enable:e,disable:f,getCompressedTextureFormats:function(){if(null===G&&(G=[],b.get("WEBGL_compressed_texture_pvrtc")||b.get("WEBGL_compressed_texture_s3tc")||b.get("WEBGL_compressed_texture_etc1")))for(var c=a.getParameter(a.COMPRESSED_TEXTURE_FORMATS),
d=0;d<c.length;d++)G.push(c[d]);return G},setBlending:g,setColorWrite:function(a){t.setMask(a)},setDepthTest:function(a){v.setTest(a)},setDepthWrite:function(a){v.setMask(a)},setDepthFunc:k,setStencilTest:function(a){q.setTest(a)},setStencilWrite:function(a){q.setMask(a)},setStencilFunc:function(a,b,c){q.setFunc(a,b,c)},setStencilOp:function(a,b,c){q.setOp(a,b,c)},setFlipSided:l,setCullFace:m,setLineWidth:function(b){b!==O&&(a.lineWidth(b),O=b)},setPolygonOffset:function(b,c,d){if(b){if(e(a.POLYGON_OFFSET_FILL),
Q!==c||I!==d)a.polygonOffset(c,d),Q=c,I=d}else f(a.POLYGON_OFFSET_FILL)},getScissorTest:function(){return V},setScissorTest:function(b){(V=b)?e(a.SCISSOR_TEST):f(a.SCISSOR_TEST)},activeTexture:h,bindTexture:function(b,c){null===K&&h();var d=H[K];void 0===d&&(d={type:void 0,texture:void 0},H[K]=d);if(d.type!==b||d.texture!==c)a.bindTexture(b,c||bb[b]),d.type=b,d.texture=c},compressedTexImage2D:function(){try{a.compressedTexImage2D.apply(a,arguments)}catch(b){console.error(b)}},texImage2D:function(){try{a.texImage2D.apply(a,
arguments)}catch(b){console.error(b)}},clearColor:p,clearDepth:n,clearStencil:r,scissor:function(b){!1===P.equals(b)&&(a.scissor(b.x,b.y,b.z,b.w),P.copy(b))},viewport:function(b){!1===S.equals(b)&&(a.viewport(b.x,b.y,b.z,b.w),S.copy(b))},reset:function(){for(var b=0;b<T.length;b++)1===T[b]&&(a.disableVertexAttribArray(b),T[b]=0);F={};K=G=null;H={};M=L=E=null;t.reset();v.reset();q.reset()}}}function jf(a,b,c){function d(b){if("highp"===b){if(0<a.getShaderPrecisionFormat(a.VERTEX_SHADER,a.HIGH_FLOAT).precision&&
0<a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.HIGH_FLOAT).precision)return"highp";b="mediump"}return"mediump"===b&&0<a.getShaderPrecisionFormat(a.VERTEX_SHADER,a.MEDIUM_FLOAT).precision&&0<a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.MEDIUM_FLOAT).precision?"mediump":"lowp"}var e,f=void 0!==c.precision?c.precision:"highp",g=d(f);g!==f&&(console.warn("THREE.WebGLRenderer:",f,"not supported, using",g,"instead."),f=g);c=!0===c.logarithmicDepthBuffer&&!!b.get("EXT_frag_depth");var g=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS),
k=a.getParameter(a.MAX_VERTEX_TEXTURE_IMAGE_UNITS),l=a.getParameter(a.MAX_TEXTURE_SIZE),m=a.getParameter(a.MAX_CUBE_MAP_TEXTURE_SIZE),h=a.getParameter(a.MAX_VERTEX_ATTRIBS),p=a.getParameter(a.MAX_VERTEX_UNIFORM_VECTORS),n=a.getParameter(a.MAX_VARYING_VECTORS),r=a.getParameter(a.MAX_FRAGMENT_UNIFORM_VECTORS),t=0<k,v=!!b.get("OES_texture_float");return{getMaxAnisotropy:function(){if(void 0!==e)return e;var c=b.get("EXT_texture_filter_anisotropic");return e=null!==c?a.getParameter(c.MAX_TEXTURE_MAX_ANISOTROPY_EXT):
0},getMaxPrecision:d,precision:f,logarithmicDepthBuffer:c,maxTextures:g,maxVertexTextures:k,maxTextureSize:l,maxCubemapSize:m,maxAttributes:h,maxVertexUniforms:p,maxVaryings:n,maxFragmentUniforms:r,vertexTextures:t,floatFragmentTextures:v,floatVertexTextures:t&&v}}function kf(a){var b={};return{get:function(c){if(void 0!==b[c])return b[c];var d;switch(c){case "WEBGL_depth_texture":d=a.getExtension("WEBGL_depth_texture")||a.getExtension("MOZ_WEBGL_depth_texture")||a.getExtension("WEBKIT_WEBGL_depth_texture");
break;case "EXT_texture_filter_anisotropic":d=a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case "WEBGL_compressed_texture_s3tc":d=a.getExtension("WEBGL_compressed_texture_s3tc")||a.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||a.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case "WEBGL_compressed_texture_pvrtc":d=a.getExtension("WEBGL_compressed_texture_pvrtc")||
a.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;case "WEBGL_compressed_texture_etc1":d=a.getExtension("WEBGL_compressed_texture_etc1");break;default:d=a.getExtension(c)}null===d&&console.warn("THREE.WebGLRenderer: "+c+" extension not supported.");return b[c]=d}}}function lf(){function a(){m.value!==d&&(m.value=d,m.needsUpdate=0<e);c.numPlanes=e}function b(a,b,d,e){var f=null!==a?a.length:0,g=null;if(0!==f){g=m.value;if(!0!==e||null===g){e=d+4*f;b=b.matrixWorldInverse;l.getNormalMatrix(b);
if(null===g||g.length<e)g=new Float32Array(e);for(e=0;e!==f;++e,d+=4)k.copy(a[e]).applyMatrix4(b,l),k.normal.toArray(g,d),g[d+3]=k.constant}m.value=g;m.needsUpdate=!0}c.numPlanes=f;return g}var c=this,d=null,e=0,f=!1,g=!1,k=new fa,l=new ya,m={value:null,needsUpdate:!1};this.uniform=m;this.numPlanes=0;this.init=function(a,c,g){var k=0!==a.length||c||0!==e||f;f=c;d=b(a,g,0);e=a.length;return k};this.beginShadows=function(){g=!0;b(null)};this.endShadows=function(){g=!1;a()};this.setState=function(c,
k,l,h,t){if(!f||null===c||0===c.length||g&&!k)g?b(null):a();else{k=g?0:e;var v=4*k,q=h.clippingState||null;m.value=q;q=b(c,l,v,t);for(c=0;c!==v;++c)q[c]=d[c];h.clippingState=q;this.numPlanes+=k}}}function od(a){function b(a,b,c,d){!0===J&&(a*=d,b*=d,c*=d);X.clearColor(a,b,c,d)}function c(){X.init();X.scissor(Z.copy(ha).multiplyScalar(Oa));X.viewport(Va.copy(ga).multiplyScalar(Oa));b(Ba.r,Ba.g,Ba.b,Qa)}function d(){U=S=null;R="";K=-1;X.reset()}function e(a){a.preventDefault();d();c();fa.clear()}function f(a){a=
a.target;a.removeEventListener("dispose",f);g(a);fa["delete"](a)}function g(a){var b=fa.get(a).program;a.program=void 0;void 0!==b&&ta.releaseProgram(b)}function k(a,b){return Math.abs(b[0])-Math.abs(a[0])}function l(a,b){return a.object.renderOrder!==b.object.renderOrder?a.object.renderOrder-b.object.renderOrder:a.material.program&&b.material.program&&a.material.program!==b.material.program?a.material.program.id-b.material.program.id:a.material.id!==b.material.id?a.material.id-b.material.id:a.z!==
b.z?a.z-b.z:a.id-b.id}function m(a,b){return a.object.renderOrder!==b.object.renderOrder?a.object.renderOrder-b.object.renderOrder:a.z!==b.z?b.z-a.z:a.id-b.id}function u(a,b,c,d,e){var f;c.transparent?(d=D,f=++Ea):(d=ea,f=++z);f=d[f];void 0!==f?(f.id=a.id,f.object=a,f.geometry=b,f.material=c,f.z=Y.z,f.group=e):(f={id:a.id,object:a,geometry:b,material:c,z:Y.z,group:e},d.push(f))}function p(a){if(!na.intersectsSphere(a))return!1;var b=ca.numPlanes;if(0===b)return!0;var c=Q.clippingPlanes,d=a.center;
a=-a.radius;var e=0;do if(c[e].distanceToPoint(d)<a)return!1;while(++e!==b);return!0}function n(a,b){if(!1!==a.visible){if(0!==(a.layers.mask&b.layers.mask))if(a.isLight)N.push(a);else if(a.isSprite){var c;(c=!1===a.frustumCulled)||(la.center.set(0,0,0),la.radius=.7071067811865476,la.applyMatrix4(a.matrixWorld),c=!0===p(la));c&&M.push(a)}else if(a.isLensFlare)O.push(a);else if(a.isImmediateRenderObject)!0===Q.sortObjects&&(Y.setFromMatrixPosition(a.matrixWorld),Y.applyProjection(qa)),u(a,null,a.material,
Y.z,null);else if(a.isMesh||a.isLine||a.isPoints)if(a.isSkinnedMesh&&a.skeleton.update(),(c=!1===a.frustumCulled)||(c=a.geometry,null===c.boundingSphere&&c.computeBoundingSphere(),la.copy(c.boundingSphere).applyMatrix4(a.matrixWorld),c=!0===p(la)),c){var d=a.material;if(!0===d.visible)if(!0===Q.sortObjects&&(Y.setFromMatrixPosition(a.matrixWorld),Y.applyProjection(qa)),c=ra.update(a),d.isMultiMaterial)for(var e=c.groups,f=d.materials,d=0,g=e.length;d<g;d++){var k=e[d],l=f[k.materialIndex];!0===l.visible&&
u(a,c,l,Y.z,k)}else u(a,c,d,Y.z,null)}c=a.children;d=0;for(g=c.length;d<g;d++)n(c[d],b)}}function r(a,b,c,d){for(var e=0,f=a.length;e<f;e++){var g=a[e],k=g.object,l=g.geometry,m=void 0===d?g.material:d,g=g.group;k.modelViewMatrix.multiplyMatrices(b.matrixWorldInverse,k.matrixWorld);k.normalMatrix.getNormalMatrix(k.modelViewMatrix);if(k.isImmediateRenderObject){t(m);var h=v(b,c,m,k);R="";k.render(function(a){Q.renderBufferImmediate(a,h,m)})}else{if(null!==k.onBeforeRender)k.onBeforeRender();Q.renderBufferDirect(b,
c,l,m,k,g)}}}function t(a){2===a.side?X.disable(B.CULL_FACE):X.enable(B.CULL_FACE);X.setFlipSided(1===a.side);!0===a.transparent?X.setBlending(a.blending,a.blendEquation,a.blendSrc,a.blendDst,a.blendEquationAlpha,a.blendSrcAlpha,a.blendDstAlpha,a.premultipliedAlpha):X.setBlending(0);X.setDepthFunc(a.depthFunc);X.setDepthTest(a.depthTest);X.setDepthWrite(a.depthWrite);X.setColorWrite(a.colorWrite);X.setPolygonOffset(a.polygonOffset,a.polygonOffsetFactor,a.polygonOffsetUnits)}function v(a,b,c,d){ba=
0;var e=fa.get(c);oa&&(pa||a!==U)&&ca.setState(c.clippingPlanes,c.clipShadows,a,e,a===U&&c.id===K);!1===c.needsUpdate&&(void 0===e.program?c.needsUpdate=!0:c.fog&&e.fog!==b?c.needsUpdate=!0:c.lights&&e.lightsHash!==aa.hash?c.needsUpdate=!0:void 0!==e.numClippingPlanes&&e.numClippingPlanes!==ca.numPlanes&&(c.needsUpdate=!0));if(c.needsUpdate){a:{var k=fa.get(c),l=ta.getParameters(c,aa,b,ca.numPlanes,d),m=ta.getProgramCode(c,l),n=k.program,p=!0;if(void 0===n)c.addEventListener("dispose",f);else if(n.code!==
m)g(c);else if(void 0!==l.shaderID)break a;else p=!1;p&&(l.shaderID?(n=Cb[l.shaderID],k.__webglShader={name:c.type,uniforms:h.UniformsUtils.clone(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader}):k.__webglShader={name:c.type,uniforms:c.uniforms,vertexShader:c.vertexShader,fragmentShader:c.fragmentShader},c.__webglShader=k.__webglShader,n=ta.acquireProgram(c,l,m),k.program=n,c.program=n);l=n.getAttributes();if(c.morphTargets)for(m=c.numSupportedMorphTargets=0;m<Q.maxMorphTargets;m++)0<=
l["morphTarget"+m]&&c.numSupportedMorphTargets++;if(c.morphNormals)for(m=c.numSupportedMorphNormals=0;m<Q.maxMorphNormals;m++)0<=l["morphNormal"+m]&&c.numSupportedMorphNormals++;l=k.__webglShader.uniforms;if(!c.isShaderMaterial&&!c.isRawShaderMaterial||!0===c.clipping)k.numClippingPlanes=ca.numPlanes,l.clippingPlanes=ca.uniform;k.fog=b;k.lightsHash=aa.hash;c.lights&&(l.ambientLightColor.value=aa.ambient,l.directionalLights.value=aa.directional,l.spotLights.value=aa.spot,l.pointLights.value=aa.point,
l.hemisphereLights.value=aa.hemi,l.directionalShadowMap.value=aa.directionalShadowMap,l.directionalShadowMatrix.value=aa.directionalShadowMatrix,l.spotShadowMap.value=aa.spotShadowMap,l.spotShadowMatrix.value=aa.spotShadowMatrix,l.pointShadowMap.value=aa.pointShadowMap,l.pointShadowMatrix.value=aa.pointShadowMatrix);m=k.program.getUniforms();m=Ga.seqWithValue(m.seq,l);k.uniformsList=m;k.dynamicUniforms=Ga.splitDynamic(m,l)}c.needsUpdate=!1}var u=!1,p=n=!1,k=e.program,m=k.getUniforms(),l=e.__webglShader.uniforms;
k.id!==S&&(B.useProgram(k.program),S=k.id,p=n=u=!0);c.id!==K&&(K=c.id,n=!0);if(u||a!==U){m.set(B,a,"projectionMatrix");ja.logarithmicDepthBuffer&&m.setValue(B,"logDepthBufFC",2/(Math.log(a.far+1)/Math.LN2));a!==U&&(U=a,p=n=!0);if(c.isShaderMaterial||c.isMeshPhongMaterial||c.isMeshStandardMaterial||c.envMap)u=m.map.cameraPosition,void 0!==u&&u.setValue(B,Y.setFromMatrixPosition(a.matrixWorld));(c.isMeshPhongMaterial||c.isMeshLambertMaterial||c.isMeshBasicMaterial||c.isMeshStandardMaterial||c.isShaderMaterial||
c.skinning)&&m.setValue(B,"viewMatrix",a.matrixWorldInverse);m.set(B,Q,"toneMappingExposure");m.set(B,Q,"toneMappingWhitePoint")}c.skinning&&(m.setOptional(B,d,"bindMatrix"),m.setOptional(B,d,"bindMatrixInverse"),u=d.skeleton)&&(ja.floatVertexTextures&&u.useVertexTexture?(m.set(B,u,"boneTexture"),m.set(B,u,"boneTextureWidth"),m.set(B,u,"boneTextureHeight")):m.setOptional(B,u,"boneMatrices"));if(n){c.lights&&(n=p,l.ambientLightColor.needsUpdate=n,l.directionalLights.needsUpdate=n,l.pointLights.needsUpdate=
n,l.spotLights.needsUpdate=n,l.hemisphereLights.needsUpdate=n);b&&c.fog&&(l.fogColor.value=b.color,b.isFog?(l.fogNear.value=b.near,l.fogFar.value=b.far):b.isFogExp2&&(l.fogDensity.value=b.density));if(c.isMeshBasicMaterial||c.isMeshLambertMaterial||c.isMeshPhongMaterial||c.isMeshStandardMaterial||c.isMeshDepthMaterial){l.opacity.value=c.opacity;l.diffuse.value=c.color;c.emissive&&l.emissive.value.copy(c.emissive).multiplyScalar(c.emissiveIntensity);l.map.value=c.map;l.specularMap.value=c.specularMap;
l.alphaMap.value=c.alphaMap;c.aoMap&&(l.aoMap.value=c.aoMap,l.aoMapIntensity.value=c.aoMapIntensity);var r;c.map?r=c.map:c.specularMap?r=c.specularMap:c.displacementMap?r=c.displacementMap:c.normalMap?r=c.normalMap:c.bumpMap?r=c.bumpMap:c.roughnessMap?r=c.roughnessMap:c.metalnessMap?r=c.metalnessMap:c.alphaMap?r=c.alphaMap:c.emissiveMap&&(r=c.emissiveMap);void 0!==r&&(r.isWebGLRenderTarget&&(r=r.texture),b=r.offset,r=r.repeat,l.offsetRepeat.value.set(b.x,b.y,r.x,r.y));l.envMap.value=c.envMap;l.flipEnvMap.value=
c.envMap&&c.envMap.isCubeTexture?-1:1;l.reflectivity.value=c.reflectivity;l.refractionRatio.value=c.refractionRatio}c.isLineBasicMaterial?(l.diffuse.value=c.color,l.opacity.value=c.opacity):c.isLineDashedMaterial?(l.diffuse.value=c.color,l.opacity.value=c.opacity,l.dashSize.value=c.dashSize,l.totalSize.value=c.dashSize+c.gapSize,l.scale.value=c.scale):c.isPointsMaterial?(l.diffuse.value=c.color,l.opacity.value=c.opacity,l.size.value=c.size*Oa,l.scale.value=.5*x.clientHeight,l.map.value=c.map,null!==
c.map&&(r=c.map.offset,b=c.map.repeat,l.offsetRepeat.value.set(r.x,r.y,b.x,b.y))):c.isMeshLambertMaterial?(c.lightMap&&(l.lightMap.value=c.lightMap,l.lightMapIntensity.value=c.lightMapIntensity),c.emissiveMap&&(l.emissiveMap.value=c.emissiveMap)):c.isMeshPhongMaterial?(l.specular.value=c.specular,l.shininess.value=Math.max(c.shininess,1E-4),c.lightMap&&(l.lightMap.value=c.lightMap,l.lightMapIntensity.value=c.lightMapIntensity),c.emissiveMap&&(l.emissiveMap.value=c.emissiveMap),c.bumpMap&&(l.bumpMap.value=
c.bumpMap,l.bumpScale.value=c.bumpScale),c.normalMap&&(l.normalMap.value=c.normalMap,l.normalScale.value.copy(c.normalScale)),c.displacementMap&&(l.displacementMap.value=c.displacementMap,l.displacementScale.value=c.displacementScale,l.displacementBias.value=c.displacementBias)):c.isMeshPhysicalMaterial?(l.clearCoat.value=c.clearCoat,l.clearCoatRoughness.value=c.clearCoatRoughness,A(l,c)):c.isMeshStandardMaterial?A(l,c):c.isMeshDepthMaterial?c.displacementMap&&(l.displacementMap.value=c.displacementMap,
l.displacementScale.value=c.displacementScale,l.displacementBias.value=c.displacementBias):c.isMeshNormalMaterial&&(l.opacity.value=c.opacity);Ga.upload(B,e.uniformsList,l,Q)}m.set(B,d,"modelViewMatrix");m.set(B,d,"normalMatrix");m.setValue(B,"modelMatrix",d.matrixWorld);e=e.dynamicUniforms;null!==e&&(Ga.evalDynamic(e,l,d,c,a),Ga.upload(B,e,l,Q));return k}function A(a,b){a.roughness.value=b.roughness;a.metalness.value=b.metalness;b.roughnessMap&&(a.roughnessMap.value=b.roughnessMap);b.metalnessMap&&
(a.metalnessMap.value=b.metalnessMap);b.lightMap&&(a.lightMap.value=b.lightMap,a.lightMapIntensity.value=b.lightMapIntensity);b.emissiveMap&&(a.emissiveMap.value=b.emissiveMap);b.bumpMap&&(a.bumpMap.value=b.bumpMap,a.bumpScale.value=b.bumpScale);b.normalMap&&(a.normalMap.value=b.normalMap,a.normalScale.value.copy(b.normalScale));b.displacementMap&&(a.displacementMap.value=b.displacementMap,a.displacementScale.value=b.displacementScale,a.displacementBias.value=b.displacementBias);b.envMap&&(a.envMapIntensity.value=
b.envMapIntensity)}function w(a){var b;if(1E3===a)return B.REPEAT;if(1001===a)return B.CLAMP_TO_EDGE;if(1002===a)return B.MIRRORED_REPEAT;if(1003===a)return B.NEAREST;if(1004===a)return B.NEAREST_MIPMAP_NEAREST;if(1005===a)return B.NEAREST_MIPMAP_LINEAR;if(1006===a)return B.LINEAR;if(1007===a)return B.LINEAR_MIPMAP_NEAREST;if(1008===a)return B.LINEAR_MIPMAP_LINEAR;if(1009===a)return B.UNSIGNED_BYTE;if(1017===a)return B.UNSIGNED_SHORT_4_4_4_4;if(1018===a)return B.UNSIGNED_SHORT_5_5_5_1;if(1019===a)return B.UNSIGNED_SHORT_5_6_5;
if(1010===a)return B.BYTE;if(1011===a)return B.SHORT;if(1012===a)return B.UNSIGNED_SHORT;if(1013===a)return B.INT;if(1014===a)return B.UNSIGNED_INT;if(1015===a)return B.FLOAT;b=ia.get("OES_texture_half_float");if(null!==b&&1016===a)return b.HALF_FLOAT_OES;if(1021===a)return B.ALPHA;if(1022===a)return B.RGB;if(1023===a)return B.RGBA;if(1024===a)return B.LUMINANCE;if(1025===a)return B.LUMINANCE_ALPHA;if(1026===a)return B.DEPTH_COMPONENT;if(1027===a)return B.DEPTH_STENCIL;if(100===a)return B.FUNC_ADD;
if(101===a)return B.FUNC_SUBTRACT;if(102===a)return B.FUNC_REVERSE_SUBTRACT;if(200===a)return B.ZERO;if(201===a)return B.ONE;if(202===a)return B.SRC_COLOR;if(203===a)return B.ONE_MINUS_SRC_COLOR;if(204===a)return B.SRC_ALPHA;if(205===a)return B.ONE_MINUS_SRC_ALPHA;if(206===a)return B.DST_ALPHA;if(207===a)return B.ONE_MINUS_DST_ALPHA;if(208===a)return B.DST_COLOR;if(209===a)return B.ONE_MINUS_DST_COLOR;if(210===a)return B.SRC_ALPHA_SATURATE;b=ia.get("WEBGL_compressed_texture_s3tc");if(null!==b){if(2001===
a)return b.COMPRESSED_RGB_S3TC_DXT1_EXT;if(2002===a)return b.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(2003===a)return b.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(2004===a)return b.COMPRESSED_RGBA_S3TC_DXT5_EXT}b=ia.get("WEBGL_compressed_texture_pvrtc");if(null!==b){if(2100===a)return b.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(2101===a)return b.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(2102===a)return b.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(2103===a)return b.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}b=ia.get("WEBGL_compressed_texture_etc1");
if(null!==b&&2151===a)return b.COMPRESSED_RGB_ETC1_WEBGL;b=ia.get("EXT_blend_minmax");if(null!==b){if(103===a)return b.MIN_EXT;if(104===a)return b.MAX_EXT}b=ia.get("WEBGL_depth_texture");return null!==b&&1020===a?b.UNSIGNED_INT_24_8_WEBGL:0}console.log("THREE.WebGLRenderer","81");a=a||{};var x=void 0!==a.canvas?a.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),T=void 0!==a.context?a.context:null,y=void 0!==a.alpha?a.alpha:!1,F=void 0!==a.depth?a.depth:!0,G=void 0!==a.stencil?
a.stencil:!0,E=void 0!==a.antialias?a.antialias:!1,J=void 0!==a.premultipliedAlpha?a.premultipliedAlpha:!0,C=void 0!==a.preserveDrawingBuffer?a.preserveDrawingBuffer:!1,N=[],ea=[],z=-1,D=[],Ea=-1,L=new Float32Array(8),M=[],O=[];this.domElement=x;this.context=null;this.sortObjects=this.autoClearStencil=this.autoClearDepth=this.autoClearColor=this.autoClear=!0;this.clippingPlanes=[];this.localClippingEnabled=!1;this.gammaFactor=2;this.physicallyCorrectLights=this.gammaOutput=this.gammaInput=!1;this.toneMappingWhitePoint=
this.toneMappingExposure=this.toneMapping=1;this.maxMorphTargets=8;this.maxMorphNormals=4;var Q=this,S=null,V=null,W=null,K=-1,R="",U=null,Z=new da,bb=null,Va=new da,ba=0,Ba=new H(0),Qa=0,Na=x.width,Mc=x.height,Oa=1,ha=new da(0,0,Na,Mc),ka=!1,ga=new da(0,0,Na,Mc),na=new dc,ca=new lf,oa=!1,pa=!1,la=new Aa,qa=new P,Y=new q,aa={hash:"",ambient:[0,0,0],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],point:[],pointShadowMap:[],pointShadowMatrix:[],
hemi:[],shadows:[]},ma={calls:0,vertices:0,faces:0,points:0};this.info={render:ma,memory:{geometries:0,textures:0},programs:null};var B;try{y={alpha:y,depth:F,stencil:G,antialias:E,premultipliedAlpha:J,preserveDrawingBuffer:C};B=T||x.getContext("webgl",y)||x.getContext("experimental-webgl",y);if(null===B){if(null!==x.getContext("webgl"))throw"Error creating WebGL context with your selected attributes.";throw"Error creating WebGL context.";}void 0===B.getShaderPrecisionFormat&&(B.getShaderPrecisionFormat=
function(){return{rangeMin:1,rangeMax:1,precision:1}});x.addEventListener("webglcontextlost",e,!1)}catch(mf){console.error("THREE.WebGLRenderer: "+mf)}var ia=new kf(B);ia.get("WEBGL_depth_texture");ia.get("OES_texture_float");ia.get("OES_texture_float_linear");ia.get("OES_texture_half_float");ia.get("OES_texture_half_float_linear");ia.get("OES_standard_derivatives");ia.get("ANGLE_instanced_arrays");ia.get("OES_element_index_uint")&&(I.MaxIndex=4294967296);var ja=new jf(B,ia,a),X=new hf(B,ia,w),fa=
new gf,sa=new ff(B,ia,X,fa,ja,w,this.info),ra=new ef(B,fa,this.info),ta=new cf(this,ja),ya=new Ve;this.info.programs=ta.programs;var Fa=new Ue(B,ia,ma),Ha=new Te(B,ia,ma),Ja=new Db(-1,1,1,-1,0,1),wa=new Ca,za=new va(new eb(2,2),new Ia({depthTest:!1,depthWrite:!1,fog:!1}));a=Cb.cube;var ua=new va(new db(5,5,5),new Da({uniforms:a.uniforms,vertexShader:a.vertexShader,fragmentShader:a.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1}));c();this.context=B;this.capabilities=ja;this.extensions=ia;
this.properties=fa;this.state=X;var Ka=new $d(this,aa,ra,ja);this.shadowMap=Ka;var La=new Se(this,M),Pa=new Qe(this,O);this.getContext=function(){return B};this.getContextAttributes=function(){return B.getContextAttributes()};this.forceContextLoss=function(){ia.get("WEBGL_lose_context").loseContext()};this.getMaxAnisotropy=function(){return ja.getMaxAnisotropy()};this.getPrecision=function(){return ja.precision};this.getPixelRatio=function(){return Oa};this.setPixelRatio=function(a){void 0!==a&&(Oa=
a,this.setSize(ga.z,ga.w,!1))};this.getSize=function(){return{width:Na,height:Mc}};this.setSize=function(a,b,c){Na=a;Mc=b;x.width=a*Oa;x.height=b*Oa;!1!==c&&(x.style.width=a+"px",x.style.height=b+"px");this.setViewport(0,0,a,b)};this.setViewport=function(a,b,c,d){X.viewport(ga.set(a,b,c,d))};this.setScissor=function(a,b,c,d){X.scissor(ha.set(a,b,c,d))};this.setScissorTest=function(a){X.setScissorTest(ka=a)};this.getClearColor=function(){return Ba};this.setClearColor=function(a,c){Ba.set(a);Qa=void 0!==
c?c:1;b(Ba.r,Ba.g,Ba.b,Qa)};this.getClearAlpha=function(){return Qa};this.setClearAlpha=function(a){Qa=a;b(Ba.r,Ba.g,Ba.b,Qa)};this.clear=function(a,b,c){var d=0;if(void 0===a||a)d|=B.COLOR_BUFFER_BIT;if(void 0===b||b)d|=B.DEPTH_BUFFER_BIT;if(void 0===c||c)d|=B.STENCIL_BUFFER_BIT;B.clear(d)};this.clearColor=function(){this.clear(!0,!1,!1)};this.clearDepth=function(){this.clear(!1,!0,!1)};this.clearStencil=function(){this.clear(!1,!1,!0)};this.clearTarget=function(a,b,c,d){this.setRenderTarget(a);
this.clear(b,c,d)};this.resetGLState=d;this.dispose=function(){D=[];Ea=-1;ea=[];z=-1;x.removeEventListener("webglcontextlost",e,!1)};this.renderBufferImmediate=function(a,b,c){X.initAttributes();var d=fa.get(a);a.hasPositions&&!d.position&&(d.position=B.createBuffer());a.hasNormals&&!d.normal&&(d.normal=B.createBuffer());a.hasUvs&&!d.uv&&(d.uv=B.createBuffer());a.hasColors&&!d.color&&(d.color=B.createBuffer());b=b.getAttributes();a.hasPositions&&(B.bindBuffer(B.ARRAY_BUFFER,d.position),B.bufferData(B.ARRAY_BUFFER,
a.positionArray,B.DYNAMIC_DRAW),X.enableAttribute(b.position),B.vertexAttribPointer(b.position,3,B.FLOAT,!1,0,0));if(a.hasNormals){B.bindBuffer(B.ARRAY_BUFFER,d.normal);if(!c.isMeshPhongMaterial&&!c.isMeshStandardMaterial&&1===c.shading)for(var e=0,f=3*a.count;e<f;e+=9){var g=a.normalArray,k=(g[e+0]+g[e+3]+g[e+6])/3,l=(g[e+1]+g[e+4]+g[e+7])/3,m=(g[e+2]+g[e+5]+g[e+8])/3;g[e+0]=k;g[e+1]=l;g[e+2]=m;g[e+3]=k;g[e+4]=l;g[e+5]=m;g[e+6]=k;g[e+7]=l;g[e+8]=m}B.bufferData(B.ARRAY_BUFFER,a.normalArray,B.DYNAMIC_DRAW);
X.enableAttribute(b.normal);B.vertexAttribPointer(b.normal,3,B.FLOAT,!1,0,0)}a.hasUvs&&c.map&&(B.bindBuffer(B.ARRAY_BUFFER,d.uv),B.bufferData(B.ARRAY_BUFFER,a.uvArray,B.DYNAMIC_DRAW),X.enableAttribute(b.uv),B.vertexAttribPointer(b.uv,2,B.FLOAT,!1,0,0));a.hasColors&&0!==c.vertexColors&&(B.bindBuffer(B.ARRAY_BUFFER,d.color),B.bufferData(B.ARRAY_BUFFER,a.colorArray,B.DYNAMIC_DRAW),X.enableAttribute(b.color),B.vertexAttribPointer(b.color,3,B.FLOAT,!1,0,0));X.disableUnusedAttributes();B.drawArrays(B.TRIANGLES,
0,a.count);a.count=0};this.renderBufferDirect=function(a,b,c,d,e,f){t(d);var g=v(a,b,d,e),l=!1;a=c.id+"_"+g.id+"_"+d.wireframe;a!==R&&(R=a,l=!0);b=e.morphTargetInfluences;if(void 0!==b){var m=[];a=0;for(var h=b.length;a<h;a++)l=b[a],m.push([l,a]);m.sort(k);8<m.length&&(m.length=8);var n=c.morphAttributes;a=0;for(h=m.length;a<h;a++)l=m[a],L[a]=l[0],0!==l[0]?(b=l[1],!0===d.morphTargets&&n.position&&c.addAttribute("morphTarget"+a,n.position[b]),!0===d.morphNormals&&n.normal&&c.addAttribute("morphNormal"+
a,n.normal[b])):(!0===d.morphTargets&&c.removeAttribute("morphTarget"+a),!0===d.morphNormals&&c.removeAttribute("morphNormal"+a));a=m.length;for(b=L.length;a<b;a++)L[a]=0;g.getUniforms().setValue(B,"morphTargetInfluences",L);l=!0}b=c.index;h=c.attributes.position;m=1;!0===d.wireframe&&(b=ra.getWireframeAttribute(c),m=2);null!==b?(a=Ha,a.setIndex(b)):a=Fa;if(l){a:{var l=void 0,p;if(c&&c.isInstancedBufferGeometry&&(p=ia.get("ANGLE_instanced_arrays"),null===p)){console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");
break a}void 0===l&&(l=0);X.initAttributes();var n=c.attributes,g=g.getAttributes(),u=d.defaultAttributeValues,r;for(r in g){var x=g[r];if(0<=x){var q=n[r];if(void 0!==q){var w=B.FLOAT,y=q.array,A=q.normalized;y instanceof Float32Array?w=B.FLOAT:y instanceof Float64Array?console.warn("Unsupported data buffer format: Float64Array"):y instanceof Uint16Array?w=B.UNSIGNED_SHORT:y instanceof Int16Array?w=B.SHORT:y instanceof Uint32Array?w=B.UNSIGNED_INT:y instanceof Int32Array?w=B.INT:y instanceof Int8Array?
w=B.BYTE:y instanceof Uint8Array&&(w=B.UNSIGNED_BYTE);var y=q.itemSize,G=ra.getAttributeBuffer(q);if(q&&q.isInterleavedBufferAttribute){var E=q.data,J=E.stride,q=q.offset;E&&E.isInstancedInterleavedBuffer?(X.enableAttributeAndDivisor(x,E.meshPerAttribute,p),void 0===c.maxInstancedCount&&(c.maxInstancedCount=E.meshPerAttribute*E.count)):X.enableAttribute(x);B.bindBuffer(B.ARRAY_BUFFER,G);B.vertexAttribPointer(x,y,w,A,J*E.array.BYTES_PER_ELEMENT,(l*J+q)*E.array.BYTES_PER_ELEMENT)}else q&&q.isInstancedBufferAttribute?
(X.enableAttributeAndDivisor(x,q.meshPerAttribute,p),void 0===c.maxInstancedCount&&(c.maxInstancedCount=q.meshPerAttribute*q.count)):X.enableAttribute(x),B.bindBuffer(B.ARRAY_BUFFER,G),B.vertexAttribPointer(x,y,w,A,0,l*y*q.array.BYTES_PER_ELEMENT)}else if(void 0!==u&&(w=u[r],void 0!==w))switch(w.length){case 2:B.vertexAttrib2fv(x,w);break;case 3:B.vertexAttrib3fv(x,w);break;case 4:B.vertexAttrib4fv(x,w);break;default:B.vertexAttrib1fv(x,w)}}}X.disableUnusedAttributes()}null!==b&&B.bindBuffer(B.ELEMENT_ARRAY_BUFFER,
ra.getAttributeBuffer(b))}p=0;null!==b?p=b.count:void 0!==h&&(p=h.count);b=c.drawRange.start*m;h=null!==f?f.start*m:0;r=Math.max(b,h);f=Math.max(0,Math.min(p,b+c.drawRange.count*m,h+(null!==f?f.count*m:Infinity))-1-r+1);if(0!==f){if(e.isMesh)if(!0===d.wireframe)X.setLineWidth(d.wireframeLinewidth*(null===V?Oa:1)),a.setMode(B.LINES);else switch(e.drawMode){case 0:a.setMode(B.TRIANGLES);break;case 1:a.setMode(B.TRIANGLE_STRIP);break;case 2:a.setMode(B.TRIANGLE_FAN)}else e.isLine?(d=d.linewidth,void 0===
d&&(d=1),X.setLineWidth(d*(null===V?Oa:1)),e.isLineSegments?a.setMode(B.LINES):a.setMode(B.LINE_STRIP)):e.isPoints&&a.setMode(B.POINTS);c&&c.isInstancedBufferGeometry?0<c.maxInstancedCount&&a.renderInstances(c,r,f):a.render(r,f)}};this.render=function(a,c,d,e){if(void 0!==c&&!0!==c.isCamera)console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");else{var f=a.fog;R="";K=-1;U=null;!0===a.autoUpdate&&a.updateMatrixWorld();null===c.parent&&c.updateMatrixWorld();c.matrixWorldInverse.getInverse(c.matrixWorld);
qa.multiplyMatrices(c.projectionMatrix,c.matrixWorldInverse);na.setFromMatrix(qa);N.length=0;Ea=z=-1;M.length=0;O.length=0;pa=this.localClippingEnabled;oa=ca.init(this.clippingPlanes,pa,c);n(a,c);ea.length=z+1;D.length=Ea+1;!0===Q.sortObjects&&(ea.sort(l),D.sort(m));oa&&ca.beginShadows();for(var g=N,k=0,h=0,p=g.length;h<p;h++){var u=g[h];u.castShadow&&(aa.shadows[k++]=u)}aa.shadows.length=k;Ka.render(a,c);for(var g=N,t=u=0,v=0,q,x,w,y,A=c.matrixWorldInverse,E=0,G=0,J=0,T=0,k=0,h=g.length;k<h;k++)if(p=
g[k],q=p.color,x=p.intensity,w=p.distance,y=p.shadow&&p.shadow.map?p.shadow.map.texture:null,p.isAmbientLight)u+=q.r*x,t+=q.g*x,v+=q.b*x;else if(p.isDirectionalLight){var F=ya.get(p);F.color.copy(p.color).multiplyScalar(p.intensity);F.direction.setFromMatrixPosition(p.matrixWorld);Y.setFromMatrixPosition(p.target.matrixWorld);F.direction.sub(Y);F.direction.transformDirection(A);if(F.shadow=p.castShadow)F.shadowBias=p.shadow.bias,F.shadowRadius=p.shadow.radius,F.shadowMapSize=p.shadow.mapSize;aa.directionalShadowMap[E]=
y;aa.directionalShadowMatrix[E]=p.shadow.matrix;aa.directional[E++]=F}else if(p.isSpotLight){F=ya.get(p);F.position.setFromMatrixPosition(p.matrixWorld);F.position.applyMatrix4(A);F.color.copy(q).multiplyScalar(x);F.distance=w;F.direction.setFromMatrixPosition(p.matrixWorld);Y.setFromMatrixPosition(p.target.matrixWorld);F.direction.sub(Y);F.direction.transformDirection(A);F.coneCos=Math.cos(p.angle);F.penumbraCos=Math.cos(p.angle*(1-p.penumbra));F.decay=0===p.distance?0:p.decay;if(F.shadow=p.castShadow)F.shadowBias=
p.shadow.bias,F.shadowRadius=p.shadow.radius,F.shadowMapSize=p.shadow.mapSize;aa.spotShadowMap[J]=y;aa.spotShadowMatrix[J]=p.shadow.matrix;aa.spot[J++]=F}else if(p.isPointLight){F=ya.get(p);F.position.setFromMatrixPosition(p.matrixWorld);F.position.applyMatrix4(A);F.color.copy(p.color).multiplyScalar(p.intensity);F.distance=p.distance;F.decay=0===p.distance?0:p.decay;if(F.shadow=p.castShadow)F.shadowBias=p.shadow.bias,F.shadowRadius=p.shadow.radius,F.shadowMapSize=p.shadow.mapSize;aa.pointShadowMap[G]=
y;void 0===aa.pointShadowMatrix[G]&&(aa.pointShadowMatrix[G]=new P);Y.setFromMatrixPosition(p.matrixWorld).negate();aa.pointShadowMatrix[G].identity().setPosition(Y);aa.point[G++]=F}else p.isHemisphereLight&&(F=ya.get(p),F.direction.setFromMatrixPosition(p.matrixWorld),F.direction.transformDirection(A),F.direction.normalize(),F.skyColor.copy(p.color).multiplyScalar(x),F.groundColor.copy(p.groundColor).multiplyScalar(x),aa.hemi[T++]=F);aa.ambient[0]=u;aa.ambient[1]=t;aa.ambient[2]=v;aa.directional.length=
E;aa.spot.length=J;aa.point.length=G;aa.hemi.length=T;aa.hash=E+","+G+","+J+","+T+","+aa.shadows.length;oa&&ca.endShadows();ma.calls=0;ma.vertices=0;ma.faces=0;ma.points=0;void 0===d&&(d=null);this.setRenderTarget(d);g=a.background;null===g?b(Ba.r,Ba.g,Ba.b,Qa):g&&g.isColor&&(b(g.r,g.g,g.b,1),e=!0);(this.autoClear||e)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil);g&&g.isCubeTexture?(wa.projectionMatrix.copy(c.projectionMatrix),wa.matrixWorld.extractRotation(c.matrixWorld),
wa.matrixWorldInverse.getInverse(wa.matrixWorld),ua.material.uniforms.tCube.value=g,ua.modelViewMatrix.multiplyMatrices(wa.matrixWorldInverse,ua.matrixWorld),ra.update(ua),Q.renderBufferDirect(wa,null,ua.geometry,ua.material,ua,null)):g&&g.isTexture&&(za.material.map=g,ra.update(za),Q.renderBufferDirect(Ja,null,za.geometry,za.material,za,null));a.overrideMaterial?(e=a.overrideMaterial,r(ea,c,f,e),r(D,c,f,e)):(X.setBlending(0),r(ea,c,f),r(D,c,f));La.render(a,c);Pa.render(a,c,Va);d&&sa.updateRenderTargetMipmap(d);
X.setDepthTest(!0);X.setDepthWrite(!0);X.setColorWrite(!0)}};this.setFaceCulling=function(a,b){X.setCullFace(a);X.setFlipSided(0===b)};this.allocTextureUnit=function(){var a=ba;a>=ja.maxTextures&&console.warn("WebGLRenderer: trying to use "+a+" texture units while this GPU supports only "+ja.maxTextures);ba+=1;return a};this.setTexture2D=function(){var a=!1;return function(b,c){b&&b.isWebGLRenderTarget&&(a||(console.warn("THREE.WebGLRenderer.setTexture2D: don't use render targets as textures. Use their .texture property instead."),
a=!0),b=b.texture);sa.setTexture2D(b,c)}}();this.setTexture=function(){var a=!1;return function(b,c){a||(console.warn("THREE.WebGLRenderer: .setTexture is deprecated, use setTexture2D instead."),a=!0);sa.setTexture2D(b,c)}}();this.setTextureCube=function(){var a=!1;return function(b,c){b&&b.isWebGLRenderTargetCube&&(a||(console.warn("THREE.WebGLRenderer.setTextureCube: don't use cube render targets as textures. Use their .texture property instead."),a=!0),b=b.texture);b&&b.isCubeTexture||Array.isArray(b.image)&&
6===b.image.length?sa.setTextureCube(b,c):sa.setTextureCubeDynamic(b,c)}}();this.getCurrentRenderTarget=function(){return V};this.setRenderTarget=function(a){(V=a)&&void 0===fa.get(a).__webglFramebuffer&&sa.setupRenderTarget(a);var b=a&&a.isWebGLRenderTargetCube,c;a?(c=fa.get(a),c=b?c.__webglFramebuffer[a.activeCubeFace]:c.__webglFramebuffer,Z.copy(a.scissor),bb=a.scissorTest,Va.copy(a.viewport)):(c=null,Z.copy(ha).multiplyScalar(Oa),bb=ka,Va.copy(ga).multiplyScalar(Oa));W!==c&&(B.bindFramebuffer(B.FRAMEBUFFER,
c),W=c);X.scissor(Z);X.setScissorTest(bb);X.viewport(Va);b&&(b=fa.get(a.texture),B.framebufferTexture2D(B.FRAMEBUFFER,B.COLOR_ATTACHMENT0,B.TEXTURE_CUBE_MAP_POSITIVE_X+a.activeCubeFace,b.__webglTexture,a.activeMipMapLevel))};this.readRenderTargetPixels=function(a,b,c,d,e,f){if(!1===(a&&a.isWebGLRenderTarget))console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");else{var g=fa.get(a).__webglFramebuffer;if(g){var k=!1;g!==W&&(B.bindFramebuffer(B.FRAMEBUFFER,
g),k=!0);try{var l=a.texture,m=l.format,h=l.type;1023!==m&&w(m)!==B.getParameter(B.IMPLEMENTATION_COLOR_READ_FORMAT)?console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format."):1009===h||w(h)===B.getParameter(B.IMPLEMENTATION_COLOR_READ_TYPE)||1015===h&&(ia.get("OES_texture_float")||ia.get("WEBGL_color_buffer_float"))||1016===h&&ia.get("EXT_color_buffer_half_float")?B.checkFramebufferStatus(B.FRAMEBUFFER)===B.FRAMEBUFFER_COMPLETE?0<=b&&
b<=a.width-d&&0<=c&&c<=a.height-e&&B.readPixels(b,c,d,e,w(m),w(h),f):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete."):console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.")}finally{k&&B.bindFramebuffer(B.FRAMEBUFFER,W)}}}}}function Eb(a,b){this.name="";this.color=new H(a);this.density=void 0!==b?b:2.5E-4}function Fb(a,b,c){this.name="";this.color=
new H(a);this.near=void 0!==b?b:1;this.far=void 0!==c?c:1E3}function fb(){D.call(this);this.type="Scene";this.overrideMaterial=this.fog=this.background=null;this.autoUpdate=!0}function pd(a,b,c,d,e){D.call(this);this.lensFlares=[];this.positionScreen=new q;this.customUpdateCallback=void 0;void 0!==a&&this.add(a,b,c,d,e)}function gb(a){S.call(this);this.type="SpriteMaterial";this.color=new H(16777215);this.map=null;this.rotation=0;this.lights=this.fog=!1;this.setValues(a)}function fc(a){D.call(this);
this.type="Sprite";this.material=void 0!==a?a:new gb}function gc(){D.call(this);this.type="LOD";Object.defineProperties(this,{levels:{enumerable:!0,value:[]}})}function hb(a,b,c,d,e,f,g,k,l,m,h,p){ba.call(this,null,f,g,k,l,m,d,e,h,p);this.image={data:a,width:b,height:c};this.magFilter=void 0!==l?l:1003;this.minFilter=void 0!==m?m:1003;this.generateMipmaps=this.flipY=!1}function Nc(a,b,c){this.useVertexTexture=void 0!==c?c:!0;this.identityMatrix=new P;a=a||[];this.bones=a.slice(0);this.useVertexTexture?
(a=Math.sqrt(4*this.bones.length),a=h.Math.nextPowerOfTwo(Math.ceil(a)),this.boneTextureHeight=this.boneTextureWidth=a=Math.max(a,4),this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4),this.boneTexture=new hb(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,1023,1015)):this.boneMatrices=new Float32Array(16*this.bones.length);if(void 0===b)this.calculateInverses();else if(this.bones.length===b.length)this.boneInverses=b.slice(0);else for(console.warn("THREE.Skeleton bonInverses is the wrong length."),
this.boneInverses=[],b=0,a=this.bones.length;b<a;b++)this.boneInverses.push(new P)}function Oc(a){D.call(this);this.type="Bone";this.skin=a}function Pc(a,b,c){va.call(this,a,b);this.type="SkinnedMesh";this.bindMode="attached";this.bindMatrix=new P;this.bindMatrixInverse=new P;a=[];if(this.geometry&&void 0!==this.geometry.bones){for(var d,e=0,f=this.geometry.bones.length;e<f;++e)d=this.geometry.bones[e],b=new Oc(this),a.push(b),b.name=d.name,b.position.fromArray(d.pos),b.quaternion.fromArray(d.rotq),
void 0!==d.scl&&b.scale.fromArray(d.scl);e=0;for(f=this.geometry.bones.length;e<f;++e)d=this.geometry.bones[e],-1!==d.parent&&null!==d.parent&&void 0!==a[d.parent]?a[d.parent].add(a[e]):this.add(a[e])}this.normalizeSkinWeights();this.updateMatrixWorld(!0);this.bind(new Nc(a,void 0,c),this.matrixWorld)}function na(a){S.call(this);this.type="LineBasicMaterial";this.color=new H(16777215);this.linewidth=1;this.linejoin=this.linecap="round";this.lights=!1;this.setValues(a)}function Pa(a,b,c){if(1===c)return console.warn("THREE.Line: parameter THREE.LinePieces no longer supported. Created THREE.LineSegments instead."),
new ha(a,b);D.call(this);this.type="Line";this.geometry=void 0!==a?a:new I;this.material=void 0!==b?b:new na({color:16777215*Math.random()})}function ha(a,b){Pa.call(this,a,b);this.type="LineSegments"}function Ja(a){S.call(this);this.type="PointsMaterial";this.color=new H(16777215);this.map=null;this.size=1;this.sizeAttenuation=!0;this.lights=!1;this.setValues(a)}function Gb(a,b){D.call(this);this.type="Points";this.geometry=void 0!==a?a:new I;this.material=void 0!==b?b:new Ja({color:16777215*Math.random()})}
function hc(){D.call(this);this.type="Group"}function Qc(a,b,c,d,e,f,g,k,l){function m(){requestAnimationFrame(m);a.readyState>=a.HAVE_CURRENT_DATA&&(h.needsUpdate=!0)}ba.call(this,a,b,c,d,e,f,g,k,l);this.generateMipmaps=!1;var h=this;m()}function Hb(a,b,c,d,e,f,g,k,l,m,h,p){ba.call(this,null,f,g,k,l,m,d,e,h,p);this.image={width:b,height:c};this.mipmaps=a;this.generateMipmaps=this.flipY=!1}function Rc(a,b,c,d,e,f,g,k,l){ba.call(this,a,b,c,d,e,f,g,k,l);this.needsUpdate=!0}function ic(a,b,c,d,e,f,g,
k,l,m){m=void 0!==m?m:1026;if(1026!==m&&1027!==m)throw Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");ba.call(this,null,d,e,f,g,k,m,c,l);this.image={width:a,height:b};this.type=void 0!==c?c:1012;this.magFilter=void 0!==g?g:1003;this.minFilter=void 0!==k?k:1003;this.generateMipmaps=this.flipY=!1}function Ib(a){function b(a,b){return a-b}I.call(this);var c=[0,0],d={},e=["a","b","c"];if(a&&a.isGeometry){var f=a.vertices,g=a.faces,k=0,l=new Uint32Array(6*g.length);
a=0;for(var m=g.length;a<m;a++)for(var h=g[a],p=0;3>p;p++){c[0]=h[e[p]];c[1]=h[e[(p+1)%3]];c.sort(b);var n=c.toString();void 0===d[n]&&(l[2*k]=c[0],l[2*k+1]=c[1],d[n]=!0,k++)}c=new Float32Array(6*k);a=0;for(m=k;a<m;a++)for(p=0;2>p;p++)d=f[l[2*a+p]],k=6*a+3*p,c[k+0]=d.x,c[k+1]=d.y,c[k+2]=d.z;this.addAttribute("position",new z(c,3))}else if(a&&a.isBufferGeometry){if(null!==a.index){m=a.index.array;f=a.attributes.position;e=a.groups;k=0;0===e.length&&a.addGroup(0,m.length);l=new Uint32Array(2*m.length);
g=0;for(h=e.length;g<h;++g){a=e[g];p=a.start;n=a.count;a=p;for(var r=p+n;a<r;a+=3)for(p=0;3>p;p++)c[0]=m[a+p],c[1]=m[a+(p+1)%3],c.sort(b),n=c.toString(),void 0===d[n]&&(l[2*k]=c[0],l[2*k+1]=c[1],d[n]=!0,k++)}c=new Float32Array(6*k);a=0;for(m=k;a<m;a++)for(p=0;2>p;p++)k=6*a+3*p,d=l[2*a+p],c[k+0]=f.getX(d),c[k+1]=f.getY(d),c[k+2]=f.getZ(d)}else for(f=a.attributes.position.array,k=f.length/3,l=k/3,c=new Float32Array(6*k),a=0,m=l;a<m;a++)for(p=0;3>p;p++)k=18*a+6*p,l=9*a+3*p,c[k+0]=f[l],c[k+1]=f[l+1],
c[k+2]=f[l+2],d=9*a+(p+1)%3*3,c[k+3]=f[d],c[k+4]=f[d+1],c[k+5]=f[d+2];this.addAttribute("position",new z(c,3))}}function jc(a,b,c){R.call(this);this.type="ParametricGeometry";this.parameters={func:a,slices:b,stacks:c};var d=this.vertices,e=this.faces,f=this.faceVertexUvs[0],g,k,l,m,h=b+1;for(g=0;g<=c;g++)for(m=g/c,k=0;k<=b;k++)l=k/b,l=a(l,m),d.push(l);var p,n,r,t;for(g=0;g<c;g++)for(k=0;k<b;k++)a=g*h+k,d=g*h+k+1,m=(g+1)*h+k+1,l=(g+1)*h+k,p=new C(k/b,g/c),n=new C((k+1)/b,g/c),r=new C((k+1)/b,(g+1)/
c),t=new C(k/b,(g+1)/c),e.push(new ga(a,d,l)),f.push([p,n,t]),e.push(new ga(d,m,l)),f.push([n.clone(),r,t.clone()]);this.computeFaceNormals();this.computeVertexNormals()}function sa(a,b,c,d){function e(a){var b=a.normalize().clone();b.index=l.vertices.push(b)-1;b.uv=new C(Math.atan2(a.z,-a.x)/2/Math.PI+.5,1-(Math.atan2(-a.y,Math.sqrt(a.x*a.x+a.z*a.z))/Math.PI+.5));return b}function f(a,b,c){var d=new ga(a.index,b.index,c.index,[a.clone(),b.clone(),c.clone()]);l.faces.push(d);A.copy(a).add(b).add(c).divideScalar(3);
d=Math.atan2(A.z,-A.x);l.faceVertexUvs[0].push([k(a.uv,a,d),k(b.uv,b,d),k(c.uv,c,d)])}function g(a,b){for(var c=Math.pow(2,b),d=e(l.vertices[a.a]),g=e(l.vertices[a.b]),k=e(l.vertices[a.c]),m=[],h=0;h<=c;h++){m[h]=[];for(var n=e(d.clone().lerp(k,h/c)),p=e(g.clone().lerp(k,h/c)),u=c-h,r=0;r<=u;r++)m[h][r]=0===r&&h===c?n:e(n.clone().lerp(p,r/u))}for(h=0;h<c;h++)for(r=0;r<2*(c-h)-1;r++)d=Math.floor(r/2),0===r%2?f(m[h][d+1],m[h+1][d],m[h][d]):f(m[h][d+1],m[h+1][d+1],m[h+1][d])}function k(a,b,c){0>c&&1===
a.x&&(a=new C(a.x-1,a.y));0===b.x&&0===b.z&&(a=new C(c/2/Math.PI+.5,a.y));return a.clone()}R.call(this);this.type="PolyhedronGeometry";this.parameters={vertices:a,indices:b,radius:c,detail:d};c=c||1;d=d||0;for(var l=this,m=0,h=a.length;m<h;m+=3)e(new q(a[m],a[m+1],a[m+2]));a=this.vertices;for(var p=[],n=m=0,h=b.length;m<h;m+=3,n++){var r=a[b[m]],t=a[b[m+1]],v=a[b[m+2]];p[n]=new ga(r.index,t.index,v.index,[r.clone(),t.clone(),v.clone()])}for(var A=new q,m=0,h=p.length;m<h;m++)g(p[m],d);m=0;for(h=this.faceVertexUvs[0].length;m<
h;m++)b=this.faceVertexUvs[0][m],d=b[0].x,a=b[1].x,p=b[2].x,n=Math.min(d,a,p),.9<Math.max(d,a,p)&&.1>n&&(.2>d&&(b[0].x+=1),.2>a&&(b[1].x+=1),.2>p&&(b[2].x+=1));m=0;for(h=this.vertices.length;m<h;m++)this.vertices[m].multiplyScalar(c);this.mergeVertices();this.computeFaceNormals();this.boundingSphere=new Aa(new q,c)}function kc(a,b){sa.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],a,b);this.type="TetrahedronGeometry";this.parameters={radius:a,detail:b}}function lc(a,b){sa.call(this,
[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],a,b);this.type="OctahedronGeometry";this.parameters={radius:a,detail:b}}function mc(a,b){var c=(1+Math.sqrt(5))/2;sa.call(this,[-1,c,0,1,c,0,-1,-c,0,1,-c,0,0,-1,c,0,1,c,0,-1,-c,0,1,-c,c,0,-1,c,0,1,-c,0,-1,-c,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],a,b);this.type="IcosahedronGeometry";this.parameters={radius:a,detail:b}}
function nc(a,b){var c=(1+Math.sqrt(5))/2,d=1/c;sa.call(this,[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-d,-c,0,-d,c,0,d,-c,0,d,c,-d,-c,0,-d,c,0,d,-c,0,d,c,0,-c,0,-d,c,0,-d,-c,0,d,c,0,d],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],a,b);this.type="DodecahedronGeometry";
this.parameters={radius:a,detail:b}}function wa(a,b,c,d,e,f){R.call(this);this.type="TubeGeometry";this.parameters={path:a,segments:b,radius:c,radialSegments:d,closed:e,taper:f};b=b||64;c=c||1;d=d||8;e=e||!1;f=f||wa.NoTaper;var g=[],k,l,m=b+1,h,p,n,r,t,v=new q,A,w,x;A=new wa.FrenetFrames(a,b,e);w=A.normals;x=A.binormals;this.tangents=A.tangents;this.normals=w;this.binormals=x;for(A=0;A<m;A++)for(g[A]=[],h=A/(m-1),t=a.getPointAt(h),k=w[A],l=x[A],n=c*f(h),h=0;h<d;h++)p=h/d*2*Math.PI,r=-n*Math.cos(p),
p=n*Math.sin(p),v.copy(t),v.x+=r*k.x+p*l.x,v.y+=r*k.y+p*l.y,v.z+=r*k.z+p*l.z,g[A][h]=this.vertices.push(new q(v.x,v.y,v.z))-1;for(A=0;A<b;A++)for(h=0;h<d;h++)f=e?(A+1)%b:A+1,m=(h+1)%d,a=g[A][h],c=g[f][h],f=g[f][m],m=g[A][m],v=new C(A/b,h/d),w=new C((A+1)/b,h/d),x=new C((A+1)/b,(h+1)/d),k=new C(A/b,(h+1)/d),this.faces.push(new ga(a,c,m)),this.faceVertexUvs[0].push([v,w,k]),this.faces.push(new ga(c,f,m)),this.faceVertexUvs[0].push([w.clone(),x,k.clone()]);this.computeFaceNormals();this.computeVertexNormals()}
function Jb(a,b,c,d,e,f){function g(a,b,c,d,e){var f=Math.sin(a);b=c/b*a;c=Math.cos(b);e.x=d*(2+c)*.5*Math.cos(a);e.y=d*(2+c)*f*.5;e.z=d*Math.sin(b)*.5}I.call(this);this.type="TorusKnotBufferGeometry";this.parameters={radius:a,tube:b,tubularSegments:c,radialSegments:d,p:e,q:f};a=a||100;b=b||40;c=Math.floor(c)||64;d=Math.floor(d)||8;e=e||2;f=f||3;var k=(d+1)*(c+1),l=d*c*6,l=new z(new (65535<l?Uint32Array:Uint16Array)(l),1),m=new z(new Float32Array(3*k),3),h=new z(new Float32Array(3*k),3),k=new z(new Float32Array(2*
k),2),p,n,r=0,t=0,v=new q,A=new q,w=new C,x=new q,T=new q,y=new q,F=new q,G=new q;for(p=0;p<=c;++p)for(n=p/c*e*Math.PI*2,g(n,e,f,a,x),g(n+.01,e,f,a,T),F.subVectors(T,x),G.addVectors(T,x),y.crossVectors(F,G),G.crossVectors(y,F),y.normalize(),G.normalize(),n=0;n<=d;++n){var E=n/d*Math.PI*2,J=-b*Math.cos(E),E=b*Math.sin(E);v.x=x.x+(J*G.x+E*y.x);v.y=x.y+(J*G.y+E*y.y);v.z=x.z+(J*G.z+E*y.z);m.setXYZ(r,v.x,v.y,v.z);A.subVectors(v,x).normalize();h.setXYZ(r,A.x,A.y,A.z);w.x=p/c;w.y=n/d;k.setXY(r,w.x,w.y);
r++}for(n=1;n<=c;n++)for(p=1;p<=d;p++)a=(d+1)*n+(p-1),b=(d+1)*n+p,e=(d+1)*(n-1)+p,l.setX(t,(d+1)*(n-1)+(p-1)),t++,l.setX(t,a),t++,l.setX(t,e),t++,l.setX(t,a),t++,l.setX(t,b),t++,l.setX(t,e),t++;this.setIndex(l);this.addAttribute("position",m);this.addAttribute("normal",h);this.addAttribute("uv",k)}function oc(a,b,c,d,e,f,g){R.call(this);this.type="TorusKnotGeometry";this.parameters={radius:a,tube:b,tubularSegments:c,radialSegments:d,p:e,q:f};void 0!==g&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead.");
this.fromBufferGeometry(new Jb(a,b,c,d,e,f));this.mergeVertices()}function Kb(a,b,c,d,e){I.call(this);this.type="TorusBufferGeometry";this.parameters={radius:a,tube:b,radialSegments:c,tubularSegments:d,arc:e};a=a||100;b=b||40;c=Math.floor(c)||8;d=Math.floor(d)||6;e=e||2*Math.PI;var f=(c+1)*(d+1),g=c*d*6,g=new (65535<g?Uint32Array:Uint16Array)(g),k=new Float32Array(3*f),l=new Float32Array(3*f),f=new Float32Array(2*f),m=0,h=0,p=0,n=new q,r=new q,t=new q,v,A;for(v=0;v<=c;v++)for(A=0;A<=d;A++){var w=
A/d*e,x=v/c*Math.PI*2;r.x=(a+b*Math.cos(x))*Math.cos(w);r.y=(a+b*Math.cos(x))*Math.sin(w);r.z=b*Math.sin(x);k[m]=r.x;k[m+1]=r.y;k[m+2]=r.z;n.x=a*Math.cos(w);n.y=a*Math.sin(w);t.subVectors(r,n).normalize();l[m]=t.x;l[m+1]=t.y;l[m+2]=t.z;f[h]=A/d;f[h+1]=v/c;m+=3;h+=2}for(v=1;v<=c;v++)for(A=1;A<=d;A++)a=(d+1)*(v-1)+A-1,b=(d+1)*(v-1)+A,e=(d+1)*v+A,g[p]=(d+1)*v+A-1,g[p+1]=a,g[p+2]=e,g[p+3]=a,g[p+4]=b,g[p+5]=e,p+=6;this.setIndex(new z(g,1));this.addAttribute("position",new z(k,3));this.addAttribute("normal",
new z(l,3));this.addAttribute("uv",new z(f,2))}function pc(a,b,c,d,e){R.call(this);this.type="TorusGeometry";this.parameters={radius:a,tube:b,radialSegments:c,tubularSegments:d,arc:e};this.fromBufferGeometry(new Kb(a,b,c,d,e))}function ra(a,b){"undefined"!==typeof a&&(R.call(this),this.type="ExtrudeGeometry",a=Array.isArray(a)?a:[a],this.addShapeList(a,b),this.computeFaceNormals())}function qc(a,b){b=b||{};var c=b.font;if(!1===(c&&c.isFont))return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),
new R;c=c.generateShapes(a,b.size,b.curveSegments);b.amount=void 0!==b.height?b.height:50;void 0===b.bevelThickness&&(b.bevelThickness=10);void 0===b.bevelSize&&(b.bevelSize=8);void 0===b.bevelEnabled&&(b.bevelEnabled=!1);ra.call(this,c,b);this.type="TextGeometry"}function ib(a,b,c,d,e,f,g){I.call(this);this.type="SphereBufferGeometry";this.parameters={radius:a,widthSegments:b,heightSegments:c,phiStart:d,phiLength:e,thetaStart:f,thetaLength:g};a=a||50;b=Math.max(3,Math.floor(b)||8);c=Math.max(2,Math.floor(c)||
6);d=void 0!==d?d:0;e=void 0!==e?e:2*Math.PI;f=void 0!==f?f:0;g=void 0!==g?g:Math.PI;for(var k=f+g,l=(b+1)*(c+1),m=new z(new Float32Array(3*l),3),h=new z(new Float32Array(3*l),3),l=new z(new Float32Array(2*l),2),p=0,n=[],r=new q,t=0;t<=c;t++){for(var v=[],A=t/c,w=0;w<=b;w++){var x=w/b,T=-a*Math.cos(d+x*e)*Math.sin(f+A*g),y=a*Math.cos(f+A*g),F=a*Math.sin(d+x*e)*Math.sin(f+A*g);r.set(T,y,F).normalize();m.setXYZ(p,T,y,F);h.setXYZ(p,r.x,r.y,r.z);l.setXY(p,x,1-A);v.push(p);p++}n.push(v)}d=[];for(t=0;t<
c;t++)for(w=0;w<b;w++)e=n[t][w+1],g=n[t][w],p=n[t+1][w],r=n[t+1][w+1],(0!==t||0<f)&&d.push(e,g,r),(t!==c-1||k<Math.PI)&&d.push(g,p,r);this.setIndex(new (65535<m.count?ce:be)(d,1));this.addAttribute("position",m);this.addAttribute("normal",h);this.addAttribute("uv",l);this.boundingSphere=new Aa(new q,a)}function Lb(a,b,c,d,e,f,g){R.call(this);this.type="SphereGeometry";this.parameters={radius:a,widthSegments:b,heightSegments:c,phiStart:d,phiLength:e,thetaStart:f,thetaLength:g};this.fromBufferGeometry(new ib(a,
b,c,d,e,f,g))}function Mb(a,b,c,d,e,f){I.call(this);this.type="RingBufferGeometry";this.parameters={innerRadius:a,outerRadius:b,thetaSegments:c,phiSegments:d,thetaStart:e,thetaLength:f};a=a||20;b=b||50;e=void 0!==e?e:0;f=void 0!==f?f:2*Math.PI;c=void 0!==c?Math.max(3,c):8;d=void 0!==d?Math.max(1,d):1;var g=(c+1)*(d+1),k=c*d*6,k=new z(new (65535<k?Uint32Array:Uint16Array)(k),1),l=new z(new Float32Array(3*g),3),m=new z(new Float32Array(3*g),3),g=new z(new Float32Array(2*g),2),h=0,p=0,n,r=a,t=(b-a)/
d,v=new q,A=new C,w;for(a=0;a<=d;a++){for(w=0;w<=c;w++)n=e+w/c*f,v.x=r*Math.cos(n),v.y=r*Math.sin(n),l.setXYZ(h,v.x,v.y,v.z),m.setXYZ(h,0,0,1),A.x=(v.x/b+1)/2,A.y=(v.y/b+1)/2,g.setXY(h,A.x,A.y),h++;r+=t}for(a=0;a<d;a++)for(b=a*(c+1),w=0;w<c;w++)e=n=w+b,f=n+c+1,h=n+c+2,n+=1,k.setX(p,e),p++,k.setX(p,f),p++,k.setX(p,h),p++,k.setX(p,e),p++,k.setX(p,h),p++,k.setX(p,n),p++;this.setIndex(k);this.addAttribute("position",l);this.addAttribute("normal",m);this.addAttribute("uv",g)}function rc(a,b,c,d,e,f){R.call(this);
this.type="RingGeometry";this.parameters={innerRadius:a,outerRadius:b,thetaSegments:c,phiSegments:d,thetaStart:e,thetaLength:f};this.fromBufferGeometry(new Mb(a,b,c,d,e,f))}function sc(a,b,c,d){R.call(this);this.type="PlaneGeometry";this.parameters={width:a,height:b,widthSegments:c,heightSegments:d};this.fromBufferGeometry(new eb(a,b,c,d))}function Nb(a,b,c,d){I.call(this);this.type="LatheBufferGeometry";this.parameters={points:a,segments:b,phiStart:c,phiLength:d};b=Math.floor(b)||12;c=c||0;d=d||
2*Math.PI;d=h.Math.clamp(d,0,2*Math.PI);for(var e=(b+1)*a.length,f=b*a.length*6,g=new z(new (65535<f?Uint32Array:Uint16Array)(f),1),k=new z(new Float32Array(3*e),3),l=new z(new Float32Array(2*e),2),m=0,u=0,p=1/b,n=new q,r=new C,e=0;e<=b;e++)for(var f=c+e*p*d,t=Math.sin(f),v=Math.cos(f),f=0;f<=a.length-1;f++)n.x=a[f].x*t,n.y=a[f].y,n.z=a[f].x*v,k.setXYZ(m,n.x,n.y,n.z),r.x=e/b,r.y=f/(a.length-1),l.setXY(m,r.x,r.y),m++;for(e=0;e<b;e++)for(f=0;f<a.length-1;f++)c=f+e*a.length,m=c+a.length,p=c+a.length+
1,n=c+1,g.setX(u,c),u++,g.setX(u,m),u++,g.setX(u,n),u++,g.setX(u,m),u++,g.setX(u,p),u++,g.setX(u,n),u++;this.setIndex(g);this.addAttribute("position",k);this.addAttribute("uv",l);this.computeVertexNormals();if(d===2*Math.PI)for(d=this.attributes.normal.array,g=new q,k=new q,l=new q,c=b*a.length*3,f=e=0;e<a.length;e++,f+=3)g.x=d[f+0],g.y=d[f+1],g.z=d[f+2],k.x=d[c+f+0],k.y=d[c+f+1],k.z=d[c+f+2],l.addVectors(g,k).normalize(),d[f+0]=d[c+f+0]=l.x,d[f+1]=d[c+f+1]=l.y,d[f+2]=d[c+f+2]=l.z}function tc(a,b,
c,d){R.call(this);this.type="LatheGeometry";this.parameters={points:a,segments:b,phiStart:c,phiLength:d};this.fromBufferGeometry(new Nb(a,b,c,d));this.mergeVertices()}function Ya(a,b){R.call(this);this.type="ShapeGeometry";!1===Array.isArray(a)&&(a=[a]);this.addShapeList(a,b);this.computeFaceNormals()}function Ob(a,b){function c(a,b){return a-b}I.call(this);var d=Math.cos(h.Math.DEG2RAD*(void 0!==b?b:1)),e=[0,0],f={},g=["a","b","c"],k;a&&a.isBufferGeometry?(k=new R,k.fromBufferGeometry(a)):k=a.clone();
k.mergeVertices();k.computeFaceNormals();var l=k.vertices;k=k.faces;for(var m=0,u=k.length;m<u;m++)for(var p=k[m],n=0;3>n;n++){e[0]=p[g[n]];e[1]=p[g[(n+1)%3]];e.sort(c);var r=e.toString();void 0===f[r]?f[r]={vert1:e[0],vert2:e[1],face1:m,face2:void 0}:f[r].face2=m}e=[];for(r in f)if(g=f[r],void 0===g.face2||k[g.face1].normal.dot(k[g.face2].normal)<=d)m=l[g.vert1],e.push(m.x),e.push(m.y),e.push(m.z),m=l[g.vert2],e.push(m.x),e.push(m.y),e.push(m.z);this.addAttribute("position",new z(new Float32Array(e),
3))}function Za(a,b,c,d,e,f,g,k){function l(c){var e,f,l,h=new C,n=new q,p=0,u=!0===c?a:b,T=!0===c?1:-1;f=w;for(e=1;e<=d;e++)t.setXYZ(w,0,y*T,0),v.setXYZ(w,0,T,0),h.x=.5,h.y=.5,A.setXY(w,h.x,h.y),w++;l=w;for(e=0;e<=d;e++){var D=e/d*k+g,z=Math.cos(D),D=Math.sin(D);n.x=u*D;n.y=y*T;n.z=u*z;t.setXYZ(w,n.x,n.y,n.z);v.setXYZ(w,0,T,0);h.x=.5*z+.5;h.y=.5*D*T+.5;A.setXY(w,h.x,h.y);w++}for(e=0;e<d;e++)h=f+e,n=l+e,!0===c?(r.setX(x,n),x++,r.setX(x,n+1)):(r.setX(x,n+1),x++,r.setX(x,n)),x++,r.setX(x,h),x++,p+=
3;m.addGroup(F,p,!0===c?1:2);F+=p}I.call(this);this.type="CylinderBufferGeometry";this.parameters={radiusTop:a,radiusBottom:b,height:c,radialSegments:d,heightSegments:e,openEnded:f,thetaStart:g,thetaLength:k};var m=this;a=void 0!==a?a:20;b=void 0!==b?b:20;c=void 0!==c?c:100;d=Math.floor(d)||8;e=Math.floor(e)||1;f=void 0!==f?f:!1;g=void 0!==g?g:0;k=void 0!==k?k:2*Math.PI;var h=0;!1===f&&(0<a&&h++,0<b&&h++);var p=function(){var a=(d+1)*(e+1);!1===f&&(a+=(d+1)*h+d*h);return a}(),n=function(){var a=d*
e*6;!1===f&&(a+=d*h*3);return a}(),r=new z(new (65535<n?Uint32Array:Uint16Array)(n),1),t=new z(new Float32Array(3*p),3),v=new z(new Float32Array(3*p),3),A=new z(new Float32Array(2*p),2),w=0,x=0,T=[],y=c/2,F=0;(function(){var f,l,h=new q,n=new q,p=0,u=(b-a)/c;for(l=0;l<=e;l++){var C=[],D=l/e,z=D*(b-a)+a;for(f=0;f<=d;f++){var L=f/d,M=L*k+g,O=Math.sin(M),M=Math.cos(M);n.x=z*O;n.y=-D*c+y;n.z=z*M;t.setXYZ(w,n.x,n.y,n.z);h.set(O,u,M).normalize();v.setXYZ(w,h.x,h.y,h.z);A.setXY(w,L,1-D);C.push(w);w++}T.push(C)}for(f=
0;f<d;f++)for(l=0;l<e;l++)h=T[l+1][f],n=T[l+1][f+1],u=T[l][f+1],r.setX(x,T[l][f]),x++,r.setX(x,h),x++,r.setX(x,u),x++,r.setX(x,h),x++,r.setX(x,n),x++,r.setX(x,u),x++,p+=6;m.addGroup(F,p,0);F+=p})();!1===f&&(0<a&&l(!0),0<b&&l(!1));this.setIndex(r);this.addAttribute("position",t);this.addAttribute("normal",v);this.addAttribute("uv",A)}function jb(a,b,c,d,e,f,g,k){R.call(this);this.type="CylinderGeometry";this.parameters={radiusTop:a,radiusBottom:b,height:c,radialSegments:d,heightSegments:e,openEnded:f,
thetaStart:g,thetaLength:k};this.fromBufferGeometry(new Za(a,b,c,d,e,f,g,k));this.mergeVertices()}function uc(a,b,c,d,e,f,g){jb.call(this,0,a,b,c,d,e,f,g);this.type="ConeGeometry";this.parameters={radius:a,height:b,radialSegments:c,heightSegments:d,openEnded:e,thetaStart:f,thetaLength:g}}function vc(a,b,c,d,e,f,g){Za.call(this,0,a,b,c,d,e,f,g);this.type="ConeBufferGeometry";this.parameters={radius:a,height:b,radialSegments:c,heightSegments:d,thetaStart:f,thetaLength:g}}function Pb(a,b,c,d){I.call(this);
this.type="CircleBufferGeometry";this.parameters={radius:a,segments:b,thetaStart:c,thetaLength:d};a=a||50;b=void 0!==b?Math.max(3,b):8;c=void 0!==c?c:0;d=void 0!==d?d:2*Math.PI;var e=b+2,f=new Float32Array(3*e),g=new Float32Array(3*e),e=new Float32Array(2*e);g[2]=1;e[0]=.5;e[1]=.5;for(var k=0,l=3,m=2;k<=b;k++,l+=3,m+=2){var h=c+k/b*d;f[l]=a*Math.cos(h);f[l+1]=a*Math.sin(h);g[l+2]=1;e[m]=(f[l]/a+1)/2;e[m+1]=(f[l+1]/a+1)/2}c=[];for(l=1;l<=b;l++)c.push(l,l+1,0);this.setIndex(new z(new Uint16Array(c),
1));this.addAttribute("position",new z(f,3));this.addAttribute("normal",new z(g,3));this.addAttribute("uv",new z(e,2));this.boundingSphere=new Aa(new q,a)}function wc(a,b,c,d){R.call(this);this.type="CircleGeometry";this.parameters={radius:a,segments:b,thetaStart:c,thetaLength:d};this.fromBufferGeometry(new Pb(a,b,c,d))}function kb(a,b,c,d,e,f){R.call(this);this.type="BoxGeometry";this.parameters={width:a,height:b,depth:c,widthSegments:d,heightSegments:e,depthSegments:f};this.fromBufferGeometry(new db(a,
b,c,d,e,f));this.mergeVertices()}function Qb(){Da.call(this,{uniforms:h.UniformsUtils.merge([U.lights,{opacity:{value:1}}]),vertexShader:Z.shadow_vert,fragmentShader:Z.shadow_frag});this.transparent=this.lights=!0;Object.defineProperties(this,{opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(a){this.uniforms.opacity.value=a}}})}function Rb(a){Da.call(this,a);this.type="RawShaderMaterial"}function xc(a){this.uuid=h.Math.generateUUID();this.type="MultiMaterial";
this.materials=a instanceof Array?a:[];this.visible=!0}function Ka(a){S.call(this);this.defines={STANDARD:""};this.type="MeshStandardMaterial";this.color=new H(16777215);this.metalness=this.roughness=.5;this.lightMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new H(0);this.emissiveIntensity=1;this.bumpMap=this.emissiveMap=null;this.bumpScale=1;this.normalMap=null;this.normalScale=new C(1,1);this.displacementMap=null;this.displacementScale=1;this.displacementBias=
0;this.envMap=this.alphaMap=this.metalnessMap=this.roughnessMap=null;this.envMapIntensity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.morphNormals=this.morphTargets=this.skinning=!1;this.setValues(a)}function lb(a){Ka.call(this);this.defines={PHYSICAL:""};this.type="MeshPhysicalMaterial";this.reflectivity=.5;this.clearCoatRoughness=this.clearCoat=0;this.setValues(a)}function $a(a){S.call(this);this.type="MeshPhongMaterial";
this.color=new H(16777215);this.specular=new H(1118481);this.shininess=30;this.lightMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new H(0);this.emissiveIntensity=1;this.bumpMap=this.emissiveMap=null;this.bumpScale=1;this.normalMap=null;this.normalScale=new C(1,1);this.displacementMap=null;this.displacementScale=1;this.displacementBias=0;this.envMap=this.alphaMap=this.specularMap=null;this.combine=0;this.reflectivity=1;this.refractionRatio=.98;this.wireframe=
!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.morphNormals=this.morphTargets=this.skinning=!1;this.setValues(a)}function mb(a){S.call(this,a);this.type="MeshNormalMaterial";this.wireframe=!1;this.wireframeLinewidth=1;this.morphTargets=this.lights=this.fog=!1;this.setValues(a)}function nb(a){S.call(this);this.type="MeshLambertMaterial";this.color=new H(16777215);this.lightMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=
new H(0);this.emissiveIntensity=1;this.envMap=this.alphaMap=this.specularMap=this.emissiveMap=null;this.combine=0;this.reflectivity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.morphNormals=this.morphTargets=this.skinning=!1;this.setValues(a)}function ob(a){S.call(this);this.type="LineDashedMaterial";this.color=new H(16777215);this.scale=this.linewidth=1;this.dashSize=3;this.gapSize=1;this.lights=!1;this.setValues(a)}
function qd(a,b,c){var d=this,e=!1,f=0,g=0;this.onStart=void 0;this.onLoad=a;this.onProgress=b;this.onError=c;this.itemStart=function(a){g++;if(!1===e&&void 0!==d.onStart)d.onStart(a,f,g);e=!0};this.itemEnd=function(a){f++;if(void 0!==d.onProgress)d.onProgress(a,f,g);if(f===g&&(e=!1,void 0!==d.onLoad))d.onLoad()};this.itemError=function(a){if(void 0!==d.onError)d.onError(a)}}function za(a){this.manager=void 0!==a?a:h.DefaultLoadingManager}function ie(a){this.manager=void 0!==a?a:h.DefaultLoadingManager;
this._parser=null}function rd(a){this.manager=void 0!==a?a:h.DefaultLoadingManager;this._parser=null}function yc(a){this.manager=void 0!==a?a:h.DefaultLoadingManager}function sd(a){this.manager=void 0!==a?a:h.DefaultLoadingManager}function Sc(a){this.manager=void 0!==a?a:h.DefaultLoadingManager}function oa(a,b){D.call(this);this.type="Light";this.color=new H(a);this.intensity=void 0!==b?b:1;this.receiveShadow=void 0}function Tc(a,b,c){oa.call(this,a,c);this.type="HemisphereLight";this.castShadow=
void 0;this.position.copy(D.DefaultUp);this.updateMatrix();this.groundColor=new H(b)}function pb(a){this.camera=a;this.bias=0;this.radius=1;this.mapSize=new C(512,512);this.map=null;this.matrix=new P}function Uc(){pb.call(this,new Ca(50,1,.5,500))}function Vc(a,b,c,d,e,f){oa.call(this,a,b);this.type="SpotLight";this.position.copy(D.DefaultUp);this.updateMatrix();this.target=new D;Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(a){this.intensity=a/Math.PI}});
this.distance=void 0!==c?c:0;this.angle=void 0!==d?d:Math.PI/3;this.penumbra=void 0!==e?e:0;this.decay=void 0!==f?f:1;this.shadow=new Uc}function Wc(a,b,c,d){oa.call(this,a,b);this.type="PointLight";Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(a){this.intensity=a/(4*Math.PI)}});this.distance=void 0!==c?c:0;this.decay=void 0!==d?d:1;this.shadow=new pb(new Ca(90,1,.5,500))}function Xc(a){pb.call(this,new Db(-5,5,5,-5,.5,500))}function Yc(a,b){oa.call(this,
a,b);this.type="DirectionalLight";this.position.copy(D.DefaultUp);this.updateMatrix();this.target=new D;this.shadow=new Xc}function Zc(a,b){oa.call(this,a,b);this.type="AmbientLight";this.castShadow=void 0}function ja(a,b,c,d){this.parameterPositions=a;this._cachedIndex=0;this.resultBuffer=void 0!==d?d:new b.constructor(c);this.sampleValues=b;this.valueSize=c}function $c(a,b,c,d){ja.call(this,a,b,c,d);this._offsetNext=this._weightNext=this._offsetPrev=this._weightPrev=-0}function zc(a,b,c,d){ja.call(this,
a,b,c,d)}function ad(a,b,c,d){ja.call(this,a,b,c,d)}function qb(a,b,c,d){if(void 0===a)throw Error("track name is undefined");if(void 0===b||0===b.length)throw Error("no keyframes in track named "+a);this.name=a;this.times=h.AnimationUtils.convertArray(b,this.TimeBufferType);this.values=h.AnimationUtils.convertArray(c,this.ValueBufferType);this.setInterpolation(d||this.DefaultInterpolation);this.validate();this.optimize()}function Sb(a,b,c,d){qb.call(this,a,b,c,d)}function bd(a,b,c,d){ja.call(this,
a,b,c,d)}function Ac(a,b,c,d){qb.call(this,a,b,c,d)}function Tb(a,b,c,d){qb.call(this,a,b,c,d)}function cd(a,b,c,d){qb.call(this,a,b,c,d)}function dd(a,b,c){qb.call(this,a,b,c)}function ed(a,b,c,d){qb.call(this,a,b,c,d)}function rb(a,b,c,d){qb.apply(this,arguments)}function ta(a,b,c){this.name=a;this.tracks=c;this.duration=void 0!==b?b:-1;this.uuid=h.Math.generateUUID();0>this.duration&&this.resetDuration();this.optimize()}function fd(a){this.manager=void 0!==a?a:h.DefaultLoadingManager;this.textures=
{}}function td(a){this.manager=void 0!==a?a:h.DefaultLoadingManager}function sb(){this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){}}function ud(a){"boolean"===typeof a&&(console.warn("THREE.JSONLoader: showStatus parameter has been removed from constructor."),a=void 0);this.manager=void 0!==a?a:h.DefaultLoadingManager;this.withCredentials=!1}function je(a){this.manager=void 0!==a?a:h.DefaultLoadingManager;this.texturePath=""}function Y(){}function La(a,
b){this.v1=a;this.v2=b}function Bc(){this.curves=[];this.autoClose=!1}function Ra(a,b,c,d,e,f,g,k){this.aX=a;this.aY=b;this.xRadius=c;this.yRadius=d;this.aStartAngle=e;this.aEndAngle=f;this.aClockwise=g;this.aRotation=k||0}function tb(a){this.points=void 0===a?[]:a}function ub(a,b,c,d){this.v0=a;this.v1=b;this.v2=c;this.v3=d}function vb(a,b,c){this.v0=a;this.v1=b;this.v2=c}function wb(){Cc.apply(this,arguments);this.holes=[]}function Cc(a){Bc.call(this);this.currentPoint=new C;a&&this.fromPoints(a)}
function vd(){this.subPaths=[];this.currentPath=null}function wd(a){this.data=a}function ke(a){this.manager=void 0!==a?a:h.DefaultLoadingManager}function xd(){void 0===yd&&(yd=new (window.AudioContext||window.webkitAudioContext));return yd}function zd(a){this.manager=void 0!==a?a:h.DefaultLoadingManager}function le(){this.type="StereoCamera";this.aspect=1;this.eyeSep=.064;this.cameraL=new Ca;this.cameraL.layers.enable(1);this.cameraL.matrixAutoUpdate=!1;this.cameraR=new Ca;this.cameraR.layers.enable(2);
this.cameraR.matrixAutoUpdate=!1}function gd(a,b,c){D.call(this);this.type="CubeCamera";var d=new Ca(90,1,a,b);d.up.set(0,-1,0);d.lookAt(new q(1,0,0));this.add(d);var e=new Ca(90,1,a,b);e.up.set(0,-1,0);e.lookAt(new q(-1,0,0));this.add(e);var f=new Ca(90,1,a,b);f.up.set(0,0,1);f.lookAt(new q(0,1,0));this.add(f);var g=new Ca(90,1,a,b);g.up.set(0,0,-1);g.lookAt(new q(0,-1,0));this.add(g);var k=new Ca(90,1,a,b);k.up.set(0,-1,0);k.lookAt(new q(0,0,1));this.add(k);var l=new Ca(90,1,a,b);l.up.set(0,-1,
0);l.lookAt(new q(0,0,-1));this.add(l);this.renderTarget=new Ab(c,c,{format:1022,magFilter:1006,minFilter:1006});this.updateCubeMap=function(a,b){null===this.parent&&this.updateMatrixWorld();var c=this.renderTarget,h=c.texture.generateMipmaps;c.texture.generateMipmaps=!1;c.activeCubeFace=0;a.render(b,d,c);c.activeCubeFace=1;a.render(b,e,c);c.activeCubeFace=2;a.render(b,f,c);c.activeCubeFace=3;a.render(b,g,c);c.activeCubeFace=4;a.render(b,k,c);c.texture.generateMipmaps=h;c.activeCubeFace=5;a.render(b,
l,c);a.setRenderTarget(null)}}function Ad(){D.call(this);this.type="AudioListener";this.context=xd();this.gain=this.context.createGain();this.gain.connect(this.context.destination);this.filter=null}function Ub(a){D.call(this);this.type="Audio";this.context=a.context;this.source=this.context.createBufferSource();this.source.onended=this.onEnded.bind(this);this.gain=this.context.createGain();this.gain.connect(a.getInput());this.autoplay=!1;this.startTime=0;this.playbackRate=1;this.isPlaying=!1;this.hasPlaybackControl=
!0;this.sourceType="empty";this.filters=[]}function Bd(a){Ub.call(this,a);this.panner=this.context.createPanner();this.panner.connect(this.gain)}function Cd(a,b){this.analyser=a.context.createAnalyser();this.analyser.fftSize=void 0!==b?b:2048;this.data=new Uint8Array(this.analyser.frequencyBinCount);a.getOutput().connect(this.analyser)}function hd(a,b,c){this.binding=a;this.valueSize=c;a=Float64Array;switch(b){case "quaternion":b=this._slerp;break;case "string":case "bool":a=Array;b=this._select;
break;default:b=this._lerp}this.buffer=new a(4*c);this._mixBufferRegion=b;this.referenceCount=this.useCount=this.cumulativeWeight=0}function ka(a,b,c){this.path=b;this.parsedPath=c||ka.parseTrackName(b);this.node=ka.findNode(a,this.parsedPath.nodeName)||a;this.rootNode=a}function Dd(a){this.uuid=h.Math.generateUUID();this._objects=Array.prototype.slice.call(arguments);this.nCachedObjects_=0;var b={};this._indicesByUUID=b;for(var c=0,d=arguments.length;c!==d;++c)b[arguments[c].uuid]=c;this._paths=
[];this._parsedPaths=[];this._bindings=[];this._bindingsIndicesByPath={};var e=this;this.stats={objects:{get total(){return e._objects.length},get inUse(){return this.total-e.nCachedObjects_}},get bindingsPerObject(){return e._bindings.length}}}function Ed(a,b,c){this._mixer=a;this._clip=b;this._localRoot=c||null;a=b.tracks;b=a.length;c=Array(b);for(var d={endingStart:2400,endingEnd:2400},e=0;e!==b;++e){var f=a[e].createInterpolant(null);c[e]=f;f.settings=d}this._interpolantSettings=d;this._interpolants=
c;this._propertyBindings=Array(b);this._weightInterpolant=this._timeScaleInterpolant=this._byClipCacheIndex=this._cacheIndex=null;this.loop=2201;this._loopCount=-1;this._startTime=null;this.time=0;this._effectiveWeight=this.weight=this._effectiveTimeScale=this.timeScale=1;this.repetitions=Infinity;this.paused=!1;this.enabled=!0;this.clampWhenFinished=!1;this.zeroSlopeAtEnd=this.zeroSlopeAtStart=!0}function Fd(a){this._root=a;this._initMemoryManager();this.time=this._accuIndex=0;this.timeScale=1}function Gd(a,
b){"string"===typeof a&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),a=b);this.value=a;this.dynamic=!1}function xb(){I.call(this);this.type="InstancedBufferGeometry";this.maxInstancedCount=void 0}function Hd(a,b,c,d){this.uuid=h.Math.generateUUID();this.data=a;this.itemSize=b;this.offset=c;this.normalized=!0===d}function Vb(a,b){this.uuid=h.Math.generateUUID();this.array=a;this.stride=b;this.count=void 0!==a?a.length/b:0;this.dynamic=!1;this.updateRange={offset:0,count:-1};
this.version=0}function Wb(a,b,c){Vb.call(this,a,b);this.meshPerAttribute=c||1}function Xb(a,b,c){z.call(this,a,b);this.meshPerAttribute=c||1}function Id(a,b,c,d){this.ray=new Wa(a,b);this.near=c||0;this.far=d||Infinity;this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}};Object.defineProperties(this.params,{PointCloud:{get:function(){console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points.");return this.Points}}})}function me(a,b){return a.distance-b.distance}
function Jd(a,b,c,d){if(!1!==a.visible&&(a.raycast(b,c),!0===d)){a=a.children;d=0;for(var e=a.length;d<e;d++)Jd(a[d],b,c,!0)}}function Kd(a){this.autoStart=void 0!==a?a:!0;this.elapsedTime=this.oldTime=this.startTime=0;this.running=!1}function Ld(a,b,c){this.radius=void 0!==a?a:1;this.phi=void 0!==b?b:0;this.theta=void 0!==c?c:0;return this}function la(a,b){va.call(this,a,b);this.animationsMap={};this.animationsList=[];var c=this.geometry.morphTargets.length;this.createAnimation("__default",0,c-1,
c/1);this.setAnimationWeight("__default",1)}function Dc(a){D.call(this);this.material=a;this.render=function(a){}}function Ec(a,b,c,d){this.object=a;this.size=void 0!==b?b:1;a=void 0!==c?c:16711680;d=void 0!==d?d:1;b=0;(c=this.object.geometry)&&c.isGeometry?b=3*c.faces.length:c&&c.isBufferGeometry&&(b=c.attributes.normal.count);c=new I;b=new ma(6*b,3);c.addAttribute("position",b);ha.call(this,c,new na({color:a,linewidth:d}));this.matrixAutoUpdate=!1;this.update()}function Yb(a){D.call(this);this.light=
a;this.light.updateMatrixWorld();this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1;a=new I;for(var b=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],c=0,d=1;32>c;c++,d++){var e=c/32*Math.PI*2,f=d/32*Math.PI*2;b.push(Math.cos(e),Math.sin(e),1,Math.cos(f),Math.sin(f),1)}a.addAttribute("position",new ma(b,3));b=new na({fog:!1});this.cone=new ha(a,b);this.add(this.cone);this.update()}function Zb(a){this.bones=this.getBoneList(a);for(var b=new R,c=0;c<this.bones.length;c++){var d=this.bones[c];
d.parent&&d.parent.isBone&&(b.vertices.push(new q),b.vertices.push(new q),b.colors.push(new H(0,0,1)),b.colors.push(new H(0,1,0)))}b.dynamic=!0;c=new na({vertexColors:2,depthTest:!1,depthWrite:!1,transparent:!0});ha.call(this,b,c);this.root=a;this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1;this.update()}function $b(a,b){this.light=a;this.light.updateMatrixWorld();var c=new ib(b,4,2),d=new Ia({wireframe:!0,fog:!1});d.color.copy(this.light.color).multiplyScalar(this.light.intensity);va.call(this,
c,d);this.matrix=this.light.matrixWorld;this.matrixAutoUpdate=!1}function ac(a,b){D.call(this);this.light=a;this.light.updateMatrixWorld();this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1;this.colors=[new H,new H];var c=new Lb(b,4,2);c.rotateX(-Math.PI/2);for(var d=0;8>d;d++)c.faces[d].color=this.colors[4>d?0:1];d=new Ia({vertexColors:1,wireframe:!0});this.lightSphere=new va(c,d);this.add(this.lightSphere);this.update()}function Fc(a,b,c,d){b=b||1;c=new H(void 0!==c?c:4473924);d=new H(void 0!==
d?d:8947848);for(var e=b/2,f=2*a/b,g=[],k=[],l=0,m=0,h=-a;l<=b;l++,h+=f){g.push(-a,0,h,a,0,h);g.push(h,0,-a,h,0,a);var p=l===e?c:d;p.toArray(k,m);m+=3;p.toArray(k,m);m+=3;p.toArray(k,m);m+=3;p.toArray(k,m);m+=3}a=new I;a.addAttribute("position",new ma(g,3));a.addAttribute("color",new ma(k,3));g=new na({vertexColors:2});ha.call(this,a,g)}function Gc(a,b,c,d){this.object=a;this.size=void 0!==b?b:1;a=void 0!==c?c:16776960;d=void 0!==d?d:1;b=0;(c=this.object.geometry)&&c.isGeometry?b=c.faces.length:console.warn("THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.");
c=new I;b=new ma(6*b,3);c.addAttribute("position",b);ha.call(this,c,new na({color:a,linewidth:d}));this.matrixAutoUpdate=!1;this.update()}function bc(a,b){D.call(this);this.light=a;this.light.updateMatrixWorld();this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1;void 0===b&&(b=1);var c=new I;c.addAttribute("position",new ma([-b,b,0,b,b,0,b,-b,0,-b,-b,0,-b,b,0],3));var d=new na({fog:!1});this.add(new Pa(c,d));c=new I;c.addAttribute("position",new ma([0,0,0,0,0,1],3));this.add(new Pa(c,d));this.update()}
function Hc(a){function b(a,b,d){c(a,d);c(b,d)}function c(a,b){d.vertices.push(new q);d.colors.push(new H(b));void 0===f[a]&&(f[a]=[]);f[a].push(d.vertices.length-1)}var d=new R,e=new na({color:16777215,vertexColors:1}),f={};b("n1","n2",16755200);b("n2","n4",16755200);b("n4","n3",16755200);b("n3","n1",16755200);b("f1","f2",16755200);b("f2","f4",16755200);b("f4","f3",16755200);b("f3","f1",16755200);b("n1","f1",16755200);b("n2","f2",16755200);b("n3","f3",16755200);b("n4","f4",16755200);b("p","n1",16711680);
b("p","n2",16711680);b("p","n3",16711680);b("p","n4",16711680);b("u1","u2",43775);b("u2","u3",43775);b("u3","u1",43775);b("c","t",16777215);b("p","c",3355443);b("cn1","cn2",3355443);b("cn3","cn4",3355443);b("cf1","cf2",3355443);b("cf3","cf4",3355443);ha.call(this,d,e);this.camera=a;this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix();this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1;this.pointMap=f;this.update()}function Ic(a,b){var c=void 0!==b?b:8947848;this.object=a;this.box=
new Ha;va.call(this,new kb(1,1,1),new Ia({color:c,wireframe:!0}))}function Jc(a,b){void 0===b&&(b=16776960);var c=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),d=new Float32Array(24),e=new I;e.setIndex(new z(c,1));e.addAttribute("position",new z(d,3));ha.call(this,e,new na({color:b}));void 0!==a&&this.update(a)}function yb(a,b,c,d,e,f){D.call(this);void 0===d&&(d=16776960);void 0===c&&(c=1);void 0===e&&(e=.2*c);void 0===f&&(f=.2*e);this.position.copy(b);this.line=new Pa(ne,new na({color:d}));
this.line.matrixAutoUpdate=!1;this.add(this.line);this.cone=new va(oe,new Ia({color:d}));this.cone.matrixAutoUpdate=!1;this.add(this.cone);this.setDirection(a);this.setLength(c,e,f)}function id(a){a=a||1;var b=new Float32Array([0,0,0,a,0,0,0,0,0,0,a,0,0,0,0,0,0,a]),c=new Float32Array([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1]);a=new I;a.addAttribute("position",new z(b,3));a.addAttribute("color",new z(c,3));b=new na({vertexColors:2});ha.call(this,a,b)}function pe(a){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Please use THREE.CatmullRomCurve3.");
h.CatmullRomCurve3.call(this,a);this.type="catmullrom";this.closed=!0}function jd(a,b,c,d,e,f){Ra.call(this,a,b,c,c,d,e,f)}void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52));void 0===Math.sign&&(Math.sign=function(a){return 0>a?-1:0<a?1:+a});void 0===Function.prototype.name&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*(\S*)\s*\(/)[1]}});void 0===Object.assign&&function(){Object.assign=function(a){if(void 0===a||null===a)throw new TypeError("Cannot convert undefined or null to object");
for(var b=Object(a),c=1;c<arguments.length;c++){var d=arguments[c];if(void 0!==d&&null!==d)for(var e in d)Object.prototype.hasOwnProperty.call(d,e)&&(b[e]=d[e])}return b}}();Object.assign(pa.prototype,{addEventListener:function(a,b){void 0===this._listeners&&(this._listeners={});var c=this._listeners;void 0===c[a]&&(c[a]=[]);-1===c[a].indexOf(b)&&c[a].push(b)},hasEventListener:function(a,b){if(void 0===this._listeners)return!1;var c=this._listeners;return void 0!==c[a]&&-1!==c[a].indexOf(b)?!0:!1},
removeEventListener:function(a,b){if(void 0!==this._listeners){var c=this._listeners[a];if(void 0!==c){var d=c.indexOf(b);-1!==d&&c.splice(d,1)}}},dispatchEvent:function(a){if(void 0!==this._listeners){var b=this._listeners[a.type];if(void 0!==b){a.target=this;var c=[],d,e=b.length;for(d=0;d<e;d++)c[d]=b[d];for(d=0;d<e;d++)c[d].call(this,a)}}}});var qe={NoBlending:0,NormalBlending:1,AdditiveBlending:2,SubtractiveBlending:3,MultiplyBlending:4,CustomBlending:5},re={UVMapping:300,CubeReflectionMapping:301,
CubeRefractionMapping:302,EquirectangularReflectionMapping:303,EquirectangularRefractionMapping:304,SphericalReflectionMapping:305,CubeUVReflectionMapping:306,CubeUVRefractionMapping:307},Md={RepeatWrapping:1E3,ClampToEdgeWrapping:1001,MirroredRepeatWrapping:1002},Nd={NearestFilter:1003,NearestMipMapNearestFilter:1004,NearestMipMapLinearFilter:1005,LinearFilter:1006,LinearMipMapNearestFilter:1007,LinearMipMapLinearFilter:1008};h.Math={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var a=
"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),b=Array(36),c=0,d;return function(){for(var e=0;36>e;e++)8===e||13===e||18===e||23===e?b[e]="-":14===e?b[e]="4":(2>=c&&(c=33554432+16777216*Math.random()|0),d=c&15,c>>=4,b[e]=a[19===e?d&3|8:d]);return b.join("")}}(),clamp:function(a,b,c){return Math.max(b,Math.min(c,a))},euclideanModulo:function(a,b){return(a%b+b)%b},mapLinear:function(a,b,c,d,e){return d+(a-b)*(e-d)/(c-b)},smoothstep:function(a,b,c){if(a<=b)return 0;if(a>=
c)return 1;a=(a-b)/(c-b);return a*a*(3-2*a)},smootherstep:function(a,b,c){if(a<=b)return 0;if(a>=c)return 1;a=(a-b)/(c-b);return a*a*a*(a*(6*a-15)+10)},random16:function(){console.warn("THREE.Math.random16() has been deprecated. Use Math.random() instead.");return Math.random()},randInt:function(a,b){return a+Math.floor(Math.random()*(b-a+1))},randFloat:function(a,b){return a+Math.random()*(b-a)},randFloatSpread:function(a){return a*(.5-Math.random())},degToRad:function(a){return a*h.Math.DEG2RAD},
radToDeg:function(a){return a*h.Math.RAD2DEG},isPowerOfTwo:function(a){return 0===(a&a-1)&&0!==a},nearestPowerOfTwo:function(a){return Math.pow(2,Math.round(Math.log(a)/Math.LN2))},nextPowerOfTwo:function(a){a--;a|=a>>1;a|=a>>2;a|=a>>4;a|=a>>8;a|=a>>16;a++;return a}};C.prototype={constructor:C,isVector2:!0,get width(){return this.x},set width(a){this.x=a},get height(){return this.y},set height(a){this.y=a},set:function(a,b){this.x=a;this.y=b;return this},setScalar:function(a){this.y=this.x=a;return this},
setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;default:throw Error("index is out of range: "+a);}},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;default:throw Error("index is out of range: "+a);}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(a){this.x=a.x;this.y=a.y;return this},add:function(a,b){if(void 0!==b)return console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),
this.addVectors(a,b);this.x+=a.x;this.y+=a.y;return this},addScalar:function(a){this.x+=a;this.y+=a;return this},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;return this},addScaledVector:function(a,b){this.x+=a.x*b;this.y+=a.y*b;return this},sub:function(a,b){if(void 0!==b)return console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,b);this.x-=a.x;this.y-=a.y;return this},subScalar:function(a){this.x-=a;this.y-=a;return this},
subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;return this},multiply:function(a){this.x*=a.x;this.y*=a.y;return this},multiplyScalar:function(a){isFinite(a)?(this.x*=a,this.y*=a):this.y=this.x=0;return this},divide:function(a){this.x/=a.x;this.y/=a.y;return this},divideScalar:function(a){return this.multiplyScalar(1/a)},min:function(a){this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,a.y);return this},max:function(a){this.x=Math.max(this.x,a.x);this.y=Math.max(this.y,a.y);return this},clamp:function(a,
b){this.x=Math.max(a.x,Math.min(b.x,this.x));this.y=Math.max(a.y,Math.min(b.y,this.y));return this},clampScalar:function(){var a,b;return function(c,d){void 0===a&&(a=new C,b=new C);a.set(c,c);b.set(d,d);return this.clamp(a,b)}}(),clampLength:function(a,b){var c=this.length();return this.multiplyScalar(Math.max(a,Math.min(b,c))/c)},floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);return this},round:function(){this.x=
Math.round(this.x);this.y=Math.round(this.y);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);return this},negate:function(){this.x=-this.x;this.y=-this.y;return this},dot:function(a){return this.x*a.x+this.y*a.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length())},
angle:function(){var a=Math.atan2(this.y,this.x);0>a&&(a+=2*Math.PI);return a},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=this.x-a.x;a=this.y-a.y;return b*b+a*a},distanceToManhattan:function(a){return Math.abs(this.x-a.x)+Math.abs(this.y-a.y)},setLength:function(a){return this.multiplyScalar(a/this.length())},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;return this},lerpVectors:function(a,b,c){return this.subVectors(b,
a).multiplyScalar(c).add(a)},equals:function(a){return a.x===this.x&&a.y===this.y},fromArray:function(a,b){void 0===b&&(b=0);this.x=a[b];this.y=a[b+1];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.x;a[b+1]=this.y;return a},fromAttribute:function(a,b,c){void 0===c&&(c=0);b=b*a.itemSize+c;this.x=a.array[b];this.y=a.array[b+1];return this},rotateAround:function(a,b){var c=Math.cos(b),d=Math.sin(b),e=this.x-a.x,f=this.y-a.y;this.x=e*c-f*d+a.x;this.y=e*d+f*c+a.y;return this}};
ba.DEFAULT_IMAGE=void 0;ba.DEFAULT_MAPPING=300;ba.prototype={constructor:ba,isTexture:!0,set needsUpdate(a){!0===a&&this.version++},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.image=a.image;this.mipmaps=a.mipmaps.slice(0);this.mapping=a.mapping;this.wrapS=a.wrapS;this.wrapT=a.wrapT;this.magFilter=a.magFilter;this.minFilter=a.minFilter;this.anisotropy=a.anisotropy;this.format=a.format;this.type=a.type;this.offset.copy(a.offset);this.repeat.copy(a.repeat);this.generateMipmaps=
a.generateMipmaps;this.premultiplyAlpha=a.premultiplyAlpha;this.flipY=a.flipY;this.unpackAlignment=a.unpackAlignment;this.encoding=a.encoding;return this},toJSON:function(a){if(void 0!==a.textures[this.uuid])return a.textures[this.uuid];var b={metadata:{version:4.4,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],wrap:[this.wrapS,this.wrapT],minFilter:this.minFilter,magFilter:this.magFilter,
anisotropy:this.anisotropy,flipY:this.flipY};if(void 0!==this.image){var c=this.image;void 0===c.uuid&&(c.uuid=h.Math.generateUUID());if(void 0===a.images[c.uuid]){var d=a.images,e=c.uuid,f=c.uuid,g;void 0!==c.toDataURL?g=c:(g=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),g.width=c.width,g.height=c.height,g.getContext("2d").drawImage(c,0,0,c.width,c.height));g=2048<g.width||2048<g.height?g.toDataURL("image/jpeg",.6):g.toDataURL("image/png");d[e]={uuid:f,url:g}}b.image=c.uuid}return a.textures[this.uuid]=
b},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(a){if(300===this.mapping){a.multiply(this.repeat);a.add(this.offset);if(0>a.x||1<a.x)switch(this.wrapS){case 1E3:a.x-=Math.floor(a.x);break;case 1001:a.x=0>a.x?0:1;break;case 1002:a.x=1===Math.abs(Math.floor(a.x)%2)?Math.ceil(a.x)-a.x:a.x-Math.floor(a.x)}if(0>a.y||1<a.y)switch(this.wrapT){case 1E3:a.y-=Math.floor(a.y);break;case 1001:a.y=0>a.y?0:1;break;case 1002:a.y=1===Math.abs(Math.floor(a.y)%2)?Math.ceil(a.y)-a.y:
a.y-Math.floor(a.y)}this.flipY&&(a.y=1-a.y)}}};Object.assign(ba.prototype,pa.prototype);var Pd=0;da.prototype={constructor:da,isVector4:!0,set:function(a,b,c,d){this.x=a;this.y=b;this.z=c;this.w=d;return this},setScalar:function(a){this.w=this.z=this.y=this.x=a;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setZ:function(a){this.z=a;return this},setW:function(a){this.w=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=
b;break;case 2:this.z=b;break;case 3:this.w=b;break;default:throw Error("index is out of range: "+a);}},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw Error("index is out of range: "+a);}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=void 0!==a.w?a.w:1;return this},add:function(a,b){if(void 0!==b)return console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),
this.addVectors(a,b);this.x+=a.x;this.y+=a.y;this.z+=a.z;this.w+=a.w;return this},addScalar:function(a){this.x+=a;this.y+=a;this.z+=a;this.w+=a;return this},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;this.w=a.w+b.w;return this},addScaledVector:function(a,b){this.x+=a.x*b;this.y+=a.y*b;this.z+=a.z*b;this.w+=a.w*b;return this},sub:function(a,b){if(void 0!==b)return console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,
b);this.x-=a.x;this.y-=a.y;this.z-=a.z;this.w-=a.w;return this},subScalar:function(a){this.x-=a;this.y-=a;this.z-=a;this.w-=a;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;this.w=a.w-b.w;return this},multiplyScalar:function(a){isFinite(a)?(this.x*=a,this.y*=a,this.z*=a,this.w*=a):this.w=this.z=this.y=this.x=0;return this},applyMatrix4:function(a){var b=this.x,c=this.y,d=this.z,e=this.w;a=a.elements;this.x=a[0]*b+a[4]*c+a[8]*d+a[12]*e;this.y=a[1]*b+a[5]*c+a[9]*
d+a[13]*e;this.z=a[2]*b+a[6]*c+a[10]*d+a[14]*e;this.w=a[3]*b+a[7]*c+a[11]*d+a[15]*e;return this},divideScalar:function(a){return this.multiplyScalar(1/a)},setAxisAngleFromQuaternion:function(a){this.w=2*Math.acos(a.w);var b=Math.sqrt(1-a.w*a.w);1E-4>b?(this.x=1,this.z=this.y=0):(this.x=a.x/b,this.y=a.y/b,this.z=a.z/b);return this},setAxisAngleFromRotationMatrix:function(a){var b,c,d;a=a.elements;var e=a[0];d=a[4];var f=a[8],g=a[1],k=a[5],l=a[9];c=a[2];b=a[6];var m=a[10];if(.01>Math.abs(d-g)&&.01>
Math.abs(f-c)&&.01>Math.abs(l-b)){if(.1>Math.abs(d+g)&&.1>Math.abs(f+c)&&.1>Math.abs(l+b)&&.1>Math.abs(e+k+m-3))return this.set(1,0,0,0),this;a=Math.PI;e=(e+1)/2;k=(k+1)/2;m=(m+1)/2;d=(d+g)/4;f=(f+c)/4;l=(l+b)/4;e>k&&e>m?.01>e?(b=0,d=c=.707106781):(b=Math.sqrt(e),c=d/b,d=f/b):k>m?.01>k?(b=.707106781,c=0,d=.707106781):(c=Math.sqrt(k),b=d/c,d=l/c):.01>m?(c=b=.707106781,d=0):(d=Math.sqrt(m),b=f/d,c=l/d);this.set(b,c,d,a);return this}a=Math.sqrt((b-l)*(b-l)+(f-c)*(f-c)+(g-d)*(g-d));.001>Math.abs(a)&&
(a=1);this.x=(b-l)/a;this.y=(f-c)/a;this.z=(g-d)/a;this.w=Math.acos((e+k+m-1)/2);return this},min:function(a){this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,a.y);this.z=Math.min(this.z,a.z);this.w=Math.min(this.w,a.w);return this},max:function(a){this.x=Math.max(this.x,a.x);this.y=Math.max(this.y,a.y);this.z=Math.max(this.z,a.z);this.w=Math.max(this.w,a.w);return this},clamp:function(a,b){this.x=Math.max(a.x,Math.min(b.x,this.x));this.y=Math.max(a.y,Math.min(b.y,this.y));this.z=Math.max(a.z,Math.min(b.z,
this.z));this.w=Math.max(a.w,Math.min(b.w,this.w));return this},clampScalar:function(){var a,b;return function(c,d){void 0===a&&(a=new da,b=new da);a.set(c,c,c,c);b.set(d,d,d,d);return this.clamp(a,b)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);this.w=Math.floor(this.w);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);this.w=Math.ceil(this.w);return this},round:function(){this.x=Math.round(this.x);
this.y=Math.round(this.y);this.z=Math.round(this.z);this.w=Math.round(this.w);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z);this.w=0>this.w?Math.ceil(this.w):Math.floor(this.w);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;this.w=-this.w;return this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w},lengthSq:function(){return this.x*
this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){return this.multiplyScalar(a/this.length())},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;this.z+=(a.z-this.z)*b;this.w+=(a.w-this.w)*b;return this},lerpVectors:function(a,
b,c){return this.subVectors(b,a).multiplyScalar(c).add(a)},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z&&a.w===this.w},fromArray:function(a,b){void 0===b&&(b=0);this.x=a[b];this.y=a[b+1];this.z=a[b+2];this.w=a[b+3];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.x;a[b+1]=this.y;a[b+2]=this.z;a[b+3]=this.w;return a},fromAttribute:function(a,b,c){void 0===c&&(c=0);b=b*a.itemSize+c;this.x=a.array[b];this.y=a.array[b+1];this.z=a.array[b+2];this.w=
a.array[b+3];return this}};Object.assign(zb.prototype,pa.prototype,{isWebGLRenderTarget:!0,setSize:function(a,b){if(this.width!==a||this.height!==b)this.width=a,this.height=b,this.dispose();this.viewport.set(0,0,a,b);this.scissor.set(0,0,a,b)},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.width=a.width;this.height=a.height;this.viewport.copy(a.viewport);this.texture=a.texture.clone();this.depthBuffer=a.depthBuffer;this.stencilBuffer=a.stencilBuffer;this.depthTexture=
a.depthTexture;return this},dispose:function(){this.dispatchEvent({type:"dispose"})}});Ab.prototype=Object.create(zb.prototype);Ab.prototype.constructor=Ab;Ab.prototype.isWebGLRenderTargetCube=!0;ca.prototype={constructor:ca,get x(){return this._x},set x(a){this._x=a;this.onChangeCallback()},get y(){return this._y},set y(a){this._y=a;this.onChangeCallback()},get z(){return this._z},set z(a){this._z=a;this.onChangeCallback()},get w(){return this._w},set w(a){this._w=a;this.onChangeCallback()},set:function(a,
b,c,d){this._x=a;this._y=b;this._z=c;this._w=d;this.onChangeCallback();return this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(a){this._x=a.x;this._y=a.y;this._z=a.z;this._w=a.w;this.onChangeCallback();return this},setFromEuler:function(a,b){if(!1===(a&&a.isEuler))throw Error("THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var c=Math.cos(a._x/2),d=Math.cos(a._y/2),e=Math.cos(a._z/2),f=Math.sin(a._x/
2),g=Math.sin(a._y/2),k=Math.sin(a._z/2),l=a.order;"XYZ"===l?(this._x=f*d*e+c*g*k,this._y=c*g*e-f*d*k,this._z=c*d*k+f*g*e,this._w=c*d*e-f*g*k):"YXZ"===l?(this._x=f*d*e+c*g*k,this._y=c*g*e-f*d*k,this._z=c*d*k-f*g*e,this._w=c*d*e+f*g*k):"ZXY"===l?(this._x=f*d*e-c*g*k,this._y=c*g*e+f*d*k,this._z=c*d*k+f*g*e,this._w=c*d*e-f*g*k):"ZYX"===l?(this._x=f*d*e-c*g*k,this._y=c*g*e+f*d*k,this._z=c*d*k-f*g*e,this._w=c*d*e+f*g*k):"YZX"===l?(this._x=f*d*e+c*g*k,this._y=c*g*e+f*d*k,this._z=c*d*k-f*g*e,this._w=c*d*
e-f*g*k):"XZY"===l&&(this._x=f*d*e-c*g*k,this._y=c*g*e-f*d*k,this._z=c*d*k+f*g*e,this._w=c*d*e+f*g*k);if(!1!==b)this.onChangeCallback();return this},setFromAxisAngle:function(a,b){var c=b/2,d=Math.sin(c);this._x=a.x*d;this._y=a.y*d;this._z=a.z*d;this._w=Math.cos(c);this.onChangeCallback();return this},setFromRotationMatrix:function(a){var b=a.elements,c=b[0];a=b[4];var d=b[8],e=b[1],f=b[5],g=b[9],k=b[2],l=b[6],b=b[10],m=c+f+b;0<m?(c=.5/Math.sqrt(m+1),this._w=.25/c,this._x=(l-g)*c,this._y=(d-k)*c,
this._z=(e-a)*c):c>f&&c>b?(c=2*Math.sqrt(1+c-f-b),this._w=(l-g)/c,this._x=.25*c,this._y=(a+e)/c,this._z=(d+k)/c):f>b?(c=2*Math.sqrt(1+f-c-b),this._w=(d-k)/c,this._x=(a+e)/c,this._y=.25*c,this._z=(g+l)/c):(c=2*Math.sqrt(1+b-c-f),this._w=(e-a)/c,this._x=(d+k)/c,this._y=(g+l)/c,this._z=.25*c);this.onChangeCallback();return this},setFromUnitVectors:function(){var a,b;return function(c,d){void 0===a&&(a=new q);b=c.dot(d)+1;1E-6>b?(b=0,Math.abs(c.x)>Math.abs(c.z)?a.set(-c.y,c.x,0):a.set(0,-c.z,c.y)):a.crossVectors(c,
d);this._x=a.x;this._y=a.y;this._z=a.z;this._w=b;return this.normalize()}}(),inverse:function(){return this.conjugate().normalize()},conjugate:function(){this._x*=-1;this._y*=-1;this._z*=-1;this.onChangeCallback();return this},dot:function(a){return this._x*a._x+this._y*a._y+this._z*a._z+this._w*a._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var a=
this.length();0===a?(this._z=this._y=this._x=0,this._w=1):(a=1/a,this._x*=a,this._y*=a,this._z*=a,this._w*=a);this.onChangeCallback();return this},multiply:function(a,b){return void 0!==b?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(a,b)):this.multiplyQuaternions(this,a)},premultiply:function(a){return this.multiplyQuaternions(a,this)},multiplyQuaternions:function(a,b){var c=a._x,d=a._y,e=a._z,f=a._w,
g=b._x,k=b._y,l=b._z,m=b._w;this._x=c*m+f*g+d*l-e*k;this._y=d*m+f*k+e*g-c*l;this._z=e*m+f*l+c*k-d*g;this._w=f*m-c*g-d*k-e*l;this.onChangeCallback();return this},slerp:function(a,b){if(0===b)return this;if(1===b)return this.copy(a);var c=this._x,d=this._y,e=this._z,f=this._w,g=f*a._w+c*a._x+d*a._y+e*a._z;0>g?(this._w=-a._w,this._x=-a._x,this._y=-a._y,this._z=-a._z,g=-g):this.copy(a);if(1<=g)return this._w=f,this._x=c,this._y=d,this._z=e,this;var k=Math.sqrt(1-g*g);if(.001>Math.abs(k))return this._w=
.5*(f+this._w),this._x=.5*(c+this._x),this._y=.5*(d+this._y),this._z=.5*(e+this._z),this;var l=Math.atan2(k,g),g=Math.sin((1-b)*l)/k,k=Math.sin(b*l)/k;this._w=f*g+this._w*k;this._x=c*g+this._x*k;this._y=d*g+this._y*k;this._z=e*g+this._z*k;this.onChangeCallback();return this},equals:function(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._w===this._w},fromArray:function(a,b){void 0===b&&(b=0);this._x=a[b];this._y=a[b+1];this._z=a[b+2];this._w=a[b+3];this.onChangeCallback();return this},
toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this._x;a[b+1]=this._y;a[b+2]=this._z;a[b+3]=this._w;return a},onChange:function(a){this.onChangeCallback=a;return this},onChangeCallback:function(){}};Object.assign(ca,{slerp:function(a,b,c,d){return c.copy(a).slerp(b,d)},slerpFlat:function(a,b,c,d,e,f,g){var k=c[d+0],l=c[d+1],m=c[d+2];c=c[d+3];d=e[f+0];var h=e[f+1],p=e[f+2];e=e[f+3];if(c!==e||k!==d||l!==h||m!==p){f=1-g;var n=k*d+l*h+m*p+c*e,r=0<=n?1:-1,t=1-n*n;t>Number.EPSILON&&(t=
Math.sqrt(t),n=Math.atan2(t,n*r),f=Math.sin(f*n)/t,g=Math.sin(g*n)/t);r*=g;k=k*f+d*r;l=l*f+h*r;m=m*f+p*r;c=c*f+e*r;f===1-g&&(g=1/Math.sqrt(k*k+l*l+m*m+c*c),k*=g,l*=g,m*=g,c*=g)}a[b]=k;a[b+1]=l;a[b+2]=m;a[b+3]=c}});q.prototype={constructor:q,isVector3:!0,set:function(a,b,c){this.x=a;this.y=b;this.z=c;return this},setScalar:function(a){this.z=this.y=this.x=a;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setZ:function(a){this.z=a;return this},setComponent:function(a,
b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;default:throw Error("index is out of range: "+a);}},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw Error("index is out of range: "+a);}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;return this},add:function(a,b){if(void 0!==b)return console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),
this.addVectors(a,b);this.x+=a.x;this.y+=a.y;this.z+=a.z;return this},addScalar:function(a){this.x+=a;this.y+=a;this.z+=a;return this},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;return this},addScaledVector:function(a,b){this.x+=a.x*b;this.y+=a.y*b;this.z+=a.z*b;return this},sub:function(a,b){if(void 0!==b)return console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,b);this.x-=a.x;this.y-=a.y;this.z-=a.z;
return this},subScalar:function(a){this.x-=a;this.y-=a;this.z-=a;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;return this},multiply:function(a,b){if(void 0!==b)return console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(a,b);this.x*=a.x;this.y*=a.y;this.z*=a.z;return this},multiplyScalar:function(a){isFinite(a)?(this.x*=a,this.y*=a,this.z*=a):this.z=this.y=this.x=0;return this},multiplyVectors:function(a,
b){this.x=a.x*b.x;this.y=a.y*b.y;this.z=a.z*b.z;return this},applyEuler:function(){var a;return function(b){!1===(b&&b.isEuler)&&console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order.");void 0===a&&(a=new ca);return this.applyQuaternion(a.setFromEuler(b))}}(),applyAxisAngle:function(){var a;return function(b,c){void 0===a&&(a=new ca);return this.applyQuaternion(a.setFromAxisAngle(b,c))}}(),applyMatrix3:function(a){var b=this.x,c=this.y,d=this.z;
a=a.elements;this.x=a[0]*b+a[3]*c+a[6]*d;this.y=a[1]*b+a[4]*c+a[7]*d;this.z=a[2]*b+a[5]*c+a[8]*d;return this},applyMatrix4:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;this.x=a[0]*b+a[4]*c+a[8]*d+a[12];this.y=a[1]*b+a[5]*c+a[9]*d+a[13];this.z=a[2]*b+a[6]*c+a[10]*d+a[14];return this},applyProjection:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;var e=1/(a[3]*b+a[7]*c+a[11]*d+a[15]);this.x=(a[0]*b+a[4]*c+a[8]*d+a[12])*e;this.y=(a[1]*b+a[5]*c+a[9]*d+a[13])*e;this.z=(a[2]*b+a[6]*
c+a[10]*d+a[14])*e;return this},applyQuaternion:function(a){var b=this.x,c=this.y,d=this.z,e=a.x,f=a.y,g=a.z;a=a.w;var k=a*b+f*d-g*c,l=a*c+g*b-e*d,m=a*d+e*c-f*b,b=-e*b-f*c-g*d;this.x=k*a+b*-e+l*-g-m*-f;this.y=l*a+b*-f+m*-e-k*-g;this.z=m*a+b*-g+k*-f-l*-e;return this},project:function(){var a;return function(b){void 0===a&&(a=new P);a.multiplyMatrices(b.projectionMatrix,a.getInverse(b.matrixWorld));return this.applyProjection(a)}}(),unproject:function(){var a;return function(b){void 0===a&&(a=new P);
a.multiplyMatrices(b.matrixWorld,a.getInverse(b.projectionMatrix));return this.applyProjection(a)}}(),transformDirection:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;this.x=a[0]*b+a[4]*c+a[8]*d;this.y=a[1]*b+a[5]*c+a[9]*d;this.z=a[2]*b+a[6]*c+a[10]*d;return this.normalize()},divide:function(a){this.x/=a.x;this.y/=a.y;this.z/=a.z;return this},divideScalar:function(a){return this.multiplyScalar(1/a)},min:function(a){this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,a.y);this.z=Math.min(this.z,
a.z);return this},max:function(a){this.x=Math.max(this.x,a.x);this.y=Math.max(this.y,a.y);this.z=Math.max(this.z,a.z);return this},clamp:function(a,b){this.x=Math.max(a.x,Math.min(b.x,this.x));this.y=Math.max(a.y,Math.min(b.y,this.y));this.z=Math.max(a.z,Math.min(b.z,this.z));return this},clampScalar:function(){var a,b;return function(c,d){void 0===a&&(a=new q,b=new q);a.set(c,c,c);b.set(d,d,d);return this.clamp(a,b)}}(),clampLength:function(a,b){var c=this.length();return this.multiplyScalar(Math.max(a,
Math.min(b,c))/c)},floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);this.z=0>this.z?Math.ceil(this.z):
Math.floor(this.z);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){return this.multiplyScalar(a/
this.length())},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;this.z+=(a.z-this.z)*b;return this},lerpVectors:function(a,b,c){return this.subVectors(b,a).multiplyScalar(c).add(a)},cross:function(a,b){if(void 0!==b)return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(a,b);var c=this.x,d=this.y,e=this.z;this.x=d*a.z-e*a.y;this.y=e*a.x-c*a.z;this.z=c*a.y-d*a.x;return this},crossVectors:function(a,b){var c=
a.x,d=a.y,e=a.z,f=b.x,g=b.y,k=b.z;this.x=d*k-e*g;this.y=e*f-c*k;this.z=c*g-d*f;return this},projectOnVector:function(a){var b=a.dot(this)/a.lengthSq();return this.copy(a).multiplyScalar(b)},projectOnPlane:function(){var a;return function(b){void 0===a&&(a=new q);a.copy(this).projectOnVector(b);return this.sub(a)}}(),reflect:function(){var a;return function(b){void 0===a&&(a=new q);return this.sub(a.copy(b).multiplyScalar(2*this.dot(b)))}}(),angleTo:function(a){a=this.dot(a)/Math.sqrt(this.lengthSq()*
a.lengthSq());return Math.acos(h.Math.clamp(a,-1,1))},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=this.x-a.x,c=this.y-a.y;a=this.z-a.z;return b*b+c*c+a*a},distanceToManhattan:function(a){return Math.abs(this.x-a.x)+Math.abs(this.y-a.y)+Math.abs(this.z-a.z)},setFromSpherical:function(a){var b=Math.sin(a.phi)*a.radius;this.x=b*Math.sin(a.theta);this.y=Math.cos(a.phi)*a.radius;this.z=b*Math.cos(a.theta);return this},setFromMatrixPosition:function(a){return this.setFromMatrixColumn(a,
3)},setFromMatrixScale:function(a){var b=this.setFromMatrixColumn(a,0).length(),c=this.setFromMatrixColumn(a,1).length();a=this.setFromMatrixColumn(a,2).length();this.x=b;this.y=c;this.z=a;return this},setFromMatrixColumn:function(a,b){if("number"===typeof a){console.warn("THREE.Vector3: setFromMatrixColumn now expects ( matrix, index ).");var c=a;a=b;b=c}return this.fromArray(a.elements,4*b)},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z},fromArray:function(a,b){void 0===b&&
(b=0);this.x=a[b];this.y=a[b+1];this.z=a[b+2];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.x;a[b+1]=this.y;a[b+2]=this.z;return a},fromAttribute:function(a,b,c){void 0===c&&(c=0);b=b*a.itemSize+c;this.x=a.array[b];this.y=a.array[b+1];this.z=a.array[b+2];return this}};P.prototype={constructor:P,isMatrix4:!0,set:function(a,b,c,d,e,f,g,k,l,m,h,p,n,r,t,v){var q=this.elements;q[0]=a;q[4]=b;q[8]=c;q[12]=d;q[1]=e;q[5]=f;q[9]=g;q[13]=k;q[2]=l;q[6]=m;q[10]=h;q[14]=p;q[3]=
n;q[7]=r;q[11]=t;q[15]=v;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},clone:function(){return(new P).fromArray(this.elements)},copy:function(a){this.elements.set(a.elements);return this},copyPosition:function(a){var b=this.elements;a=a.elements;b[12]=a[12];b[13]=a[13];b[14]=a[14];return this},extractBasis:function(a,b,c){a.setFromMatrixColumn(this,0);b.setFromMatrixColumn(this,1);c.setFromMatrixColumn(this,2);return this},makeBasis:function(a,b,c){this.set(a.x,
b.x,c.x,0,a.y,b.y,c.y,0,a.z,b.z,c.z,0,0,0,0,1);return this},extractRotation:function(){var a;return function(b){void 0===a&&(a=new q);var c=this.elements,d=b.elements,e=1/a.setFromMatrixColumn(b,0).length(),f=1/a.setFromMatrixColumn(b,1).length();b=1/a.setFromMatrixColumn(b,2).length();c[0]=d[0]*e;c[1]=d[1]*e;c[2]=d[2]*e;c[4]=d[4]*f;c[5]=d[5]*f;c[6]=d[6]*f;c[8]=d[8]*b;c[9]=d[9]*b;c[10]=d[10]*b;return this}}(),makeRotationFromEuler:function(a){!1===(a&&a.isEuler)&&console.error("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");
var b=this.elements,c=a.x,d=a.y,e=a.z,f=Math.cos(c),c=Math.sin(c),g=Math.cos(d),d=Math.sin(d),k=Math.cos(e),e=Math.sin(e);if("XYZ"===a.order){a=f*k;var l=f*e,m=c*k,h=c*e;b[0]=g*k;b[4]=-g*e;b[8]=d;b[1]=l+m*d;b[5]=a-h*d;b[9]=-c*g;b[2]=h-a*d;b[6]=m+l*d;b[10]=f*g}else"YXZ"===a.order?(a=g*k,l=g*e,m=d*k,h=d*e,b[0]=a+h*c,b[4]=m*c-l,b[8]=f*d,b[1]=f*e,b[5]=f*k,b[9]=-c,b[2]=l*c-m,b[6]=h+a*c,b[10]=f*g):"ZXY"===a.order?(a=g*k,l=g*e,m=d*k,h=d*e,b[0]=a-h*c,b[4]=-f*e,b[8]=m+l*c,b[1]=l+m*c,b[5]=f*k,b[9]=h-a*c,b[2]=
-f*d,b[6]=c,b[10]=f*g):"ZYX"===a.order?(a=f*k,l=f*e,m=c*k,h=c*e,b[0]=g*k,b[4]=m*d-l,b[8]=a*d+h,b[1]=g*e,b[5]=h*d+a,b[9]=l*d-m,b[2]=-d,b[6]=c*g,b[10]=f*g):"YZX"===a.order?(a=f*g,l=f*d,m=c*g,h=c*d,b[0]=g*k,b[4]=h-a*e,b[8]=m*e+l,b[1]=e,b[5]=f*k,b[9]=-c*k,b[2]=-d*k,b[6]=l*e+m,b[10]=a-h*e):"XZY"===a.order&&(a=f*g,l=f*d,m=c*g,h=c*d,b[0]=g*k,b[4]=-e,b[8]=d*k,b[1]=a*e+h,b[5]=f*k,b[9]=l*e-m,b[2]=m*e-l,b[6]=c*k,b[10]=h*e+a);b[3]=0;b[7]=0;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return this},makeRotationFromQuaternion:function(a){var b=
this.elements,c=a.x,d=a.y,e=a.z,f=a.w,g=c+c,k=d+d,l=e+e;a=c*g;var h=c*k,c=c*l,u=d*k,d=d*l,e=e*l,g=f*g,k=f*k,f=f*l;b[0]=1-(u+e);b[4]=h-f;b[8]=c+k;b[1]=h+f;b[5]=1-(a+e);b[9]=d-g;b[2]=c-k;b[6]=d+g;b[10]=1-(a+u);b[3]=0;b[7]=0;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return this},lookAt:function(){var a,b,c;return function(d,e,f){void 0===a&&(a=new q,b=new q,c=new q);var g=this.elements;c.subVectors(d,e).normalize();0===c.lengthSq()&&(c.z=1);a.crossVectors(f,c).normalize();0===a.lengthSq()&&(c.z+=1E-4,
a.crossVectors(f,c).normalize());b.crossVectors(c,a);g[0]=a.x;g[4]=b.x;g[8]=c.x;g[1]=a.y;g[5]=b.y;g[9]=c.y;g[2]=a.z;g[6]=b.z;g[10]=c.z;return this}}(),multiply:function(a,b){return void 0!==b?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(a,b)):this.multiplyMatrices(this,a)},premultiply:function(a){return this.multiplyMatrices(a,this)},multiplyMatrices:function(a,b){var c=a.elements,d=b.elements,e=this.elements,
f=c[0],g=c[4],k=c[8],l=c[12],h=c[1],u=c[5],p=c[9],n=c[13],r=c[2],t=c[6],v=c[10],q=c[14],w=c[3],x=c[7],T=c[11],c=c[15],y=d[0],F=d[4],G=d[8],E=d[12],J=d[1],C=d[5],N=d[9],D=d[13],z=d[2],I=d[6],H=d[10],L=d[14],M=d[3],O=d[7],Q=d[11],d=d[15];e[0]=f*y+g*J+k*z+l*M;e[4]=f*F+g*C+k*I+l*O;e[8]=f*G+g*N+k*H+l*Q;e[12]=f*E+g*D+k*L+l*d;e[1]=h*y+u*J+p*z+n*M;e[5]=h*F+u*C+p*I+n*O;e[9]=h*G+u*N+p*H+n*Q;e[13]=h*E+u*D+p*L+n*d;e[2]=r*y+t*J+v*z+q*M;e[6]=r*F+t*C+v*I+q*O;e[10]=r*G+t*N+v*H+q*Q;e[14]=r*E+t*D+v*L+q*d;e[3]=w*y+
x*J+T*z+c*M;e[7]=w*F+x*C+T*I+c*O;e[11]=w*G+x*N+T*H+c*Q;e[15]=w*E+x*D+T*L+c*d;return this},multiplyToArray:function(a,b,c){var d=this.elements;this.multiplyMatrices(a,b);c[0]=d[0];c[1]=d[1];c[2]=d[2];c[3]=d[3];c[4]=d[4];c[5]=d[5];c[6]=d[6];c[7]=d[7];c[8]=d[8];c[9]=d[9];c[10]=d[10];c[11]=d[11];c[12]=d[12];c[13]=d[13];c[14]=d[14];c[15]=d[15];return this},multiplyScalar:function(a){var b=this.elements;b[0]*=a;b[4]*=a;b[8]*=a;b[12]*=a;b[1]*=a;b[5]*=a;b[9]*=a;b[13]*=a;b[2]*=a;b[6]*=a;b[10]*=a;b[14]*=a;
b[3]*=a;b[7]*=a;b[11]*=a;b[15]*=a;return this},applyToVector3Array:function(){var a;return function(b,c,d){void 0===a&&(a=new q);void 0===c&&(c=0);void 0===d&&(d=b.length);for(var e=0;e<d;e+=3,c+=3)a.fromArray(b,c),a.applyMatrix4(this),a.toArray(b,c);return b}}(),applyToBuffer:function(){var a;return function(b,c,d){void 0===a&&(a=new q);void 0===c&&(c=0);void 0===d&&(d=b.length/b.itemSize);for(var e=0;e<d;e++,c++)a.x=b.getX(c),a.y=b.getY(c),a.z=b.getZ(c),a.applyMatrix4(this),b.setXYZ(a.x,a.y,a.z);
return b}}(),determinant:function(){var a=this.elements,b=a[0],c=a[4],d=a[8],e=a[12],f=a[1],g=a[5],k=a[9],l=a[13],h=a[2],u=a[6],p=a[10],n=a[14];return a[3]*(+e*k*u-d*l*u-e*g*p+c*l*p+d*g*n-c*k*n)+a[7]*(+b*k*n-b*l*p+e*f*p-d*f*n+d*l*h-e*k*h)+a[11]*(+b*l*u-b*g*n-e*f*u+c*f*n+e*g*h-c*l*h)+a[15]*(-d*g*h-b*k*u+b*g*p+d*f*u-c*f*p+c*k*h)},transpose:function(){var a=this.elements,b;b=a[1];a[1]=a[4];a[4]=b;b=a[2];a[2]=a[8];a[8]=b;b=a[6];a[6]=a[9];a[9]=b;b=a[3];a[3]=a[12];a[12]=b;b=a[7];a[7]=a[13];a[13]=b;b=a[11];
a[11]=a[14];a[14]=b;return this},flattenToArrayOffset:function(a,b){console.warn("THREE.Matrix3: .flattenToArrayOffset is deprecated - just use .toArray instead.");return this.toArray(a,b)},getPosition:function(){var a;return function(){void 0===a&&(a=new q);console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");return a.setFromMatrixColumn(this,3)}}(),setPosition:function(a){var b=this.elements;b[12]=a.x;b[13]=a.y;b[14]=a.z;return this},
getInverse:function(a,b){var c=this.elements,d=a.elements,e=d[0],f=d[1],g=d[2],k=d[3],l=d[4],h=d[5],u=d[6],p=d[7],n=d[8],r=d[9],t=d[10],v=d[11],q=d[12],w=d[13],x=d[14],d=d[15],T=r*x*p-w*t*p+w*u*v-h*x*v-r*u*d+h*t*d,y=q*t*p-n*x*p-q*u*v+l*x*v+n*u*d-l*t*d,F=n*w*p-q*r*p+q*h*v-l*w*v-n*h*d+l*r*d,G=q*r*u-n*w*u-q*h*t+l*w*t+n*h*x-l*r*x,E=e*T+f*y+g*F+k*G;if(0===E){if(!0===b)throw Error("THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0");console.warn("THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0");
return this.identity()}E=1/E;c[0]=T*E;c[1]=(w*t*k-r*x*k-w*g*v+f*x*v+r*g*d-f*t*d)*E;c[2]=(h*x*k-w*u*k+w*g*p-f*x*p-h*g*d+f*u*d)*E;c[3]=(r*u*k-h*t*k-r*g*p+f*t*p+h*g*v-f*u*v)*E;c[4]=y*E;c[5]=(n*x*k-q*t*k+q*g*v-e*x*v-n*g*d+e*t*d)*E;c[6]=(q*u*k-l*x*k-q*g*p+e*x*p+l*g*d-e*u*d)*E;c[7]=(l*t*k-n*u*k+n*g*p-e*t*p-l*g*v+e*u*v)*E;c[8]=F*E;c[9]=(q*r*k-n*w*k-q*f*v+e*w*v+n*f*d-e*r*d)*E;c[10]=(l*w*k-q*h*k+q*f*p-e*w*p-l*f*d+e*h*d)*E;c[11]=(n*h*k-l*r*k-n*f*p+e*r*p+l*f*v-e*h*v)*E;c[12]=G*E;c[13]=(n*w*g-q*r*g+q*f*t-e*w*
t-n*f*x+e*r*x)*E;c[14]=(q*h*g-l*w*g-q*f*u+e*w*u+l*f*x-e*h*x)*E;c[15]=(l*r*g-n*h*g+n*f*u-e*r*u-l*f*t+e*h*t)*E;return this},scale:function(a){var b=this.elements,c=a.x,d=a.y;a=a.z;b[0]*=c;b[4]*=d;b[8]*=a;b[1]*=c;b[5]*=d;b[9]*=a;b[2]*=c;b[6]*=d;b[10]*=a;b[3]*=c;b[7]*=d;b[11]*=a;return this},getMaxScaleOnAxis:function(){var a=this.elements;return Math.sqrt(Math.max(a[0]*a[0]+a[1]*a[1]+a[2]*a[2],a[4]*a[4]+a[5]*a[5]+a[6]*a[6],a[8]*a[8]+a[9]*a[9]+a[10]*a[10]))},makeTranslation:function(a,b,c){this.set(1,
0,0,a,0,1,0,b,0,0,1,c,0,0,0,1);return this},makeRotationX:function(a){var b=Math.cos(a);a=Math.sin(a);this.set(1,0,0,0,0,b,-a,0,0,a,b,0,0,0,0,1);return this},makeRotationY:function(a){var b=Math.cos(a);a=Math.sin(a);this.set(b,0,a,0,0,1,0,0,-a,0,b,0,0,0,0,1);return this},makeRotationZ:function(a){var b=Math.cos(a);a=Math.sin(a);this.set(b,-a,0,0,a,b,0,0,0,0,1,0,0,0,0,1);return this},makeRotationAxis:function(a,b){var c=Math.cos(b),d=Math.sin(b),e=1-c,f=a.x,g=a.y,k=a.z,l=e*f,h=e*g;this.set(l*f+c,l*
g-d*k,l*k+d*g,0,l*g+d*k,h*g+c,h*k-d*f,0,l*k-d*g,h*k+d*f,e*k*k+c,0,0,0,0,1);return this},makeScale:function(a,b,c){this.set(a,0,0,0,0,b,0,0,0,0,c,0,0,0,0,1);return this},compose:function(a,b,c){this.makeRotationFromQuaternion(b);this.scale(c);this.setPosition(a);return this},decompose:function(){var a,b;return function(c,d,e){void 0===a&&(a=new q,b=new P);var f=this.elements,g=a.set(f[0],f[1],f[2]).length(),k=a.set(f[4],f[5],f[6]).length(),l=a.set(f[8],f[9],f[10]).length();0>this.determinant()&&(g=
-g);c.x=f[12];c.y=f[13];c.z=f[14];b.elements.set(this.elements);c=1/g;var f=1/k,h=1/l;b.elements[0]*=c;b.elements[1]*=c;b.elements[2]*=c;b.elements[4]*=f;b.elements[5]*=f;b.elements[6]*=f;b.elements[8]*=h;b.elements[9]*=h;b.elements[10]*=h;d.setFromRotationMatrix(b);e.x=g;e.y=k;e.z=l;return this}}(),makeFrustum:function(a,b,c,d,e,f){var g=this.elements;g[0]=2*e/(b-a);g[4]=0;g[8]=(b+a)/(b-a);g[12]=0;g[1]=0;g[5]=2*e/(d-c);g[9]=(d+c)/(d-c);g[13]=0;g[2]=0;g[6]=0;g[10]=-(f+e)/(f-e);g[14]=-2*f*e/(f-e);
g[3]=0;g[7]=0;g[11]=-1;g[15]=0;return this},makePerspective:function(a,b,c,d){a=c*Math.tan(h.Math.DEG2RAD*a*.5);var e=-a;return this.makeFrustum(e*b,a*b,e,a,c,d)},makeOrthographic:function(a,b,c,d,e,f){var g=this.elements,k=1/(b-a),l=1/(c-d),h=1/(f-e);g[0]=2*k;g[4]=0;g[8]=0;g[12]=-((b+a)*k);g[1]=0;g[5]=2*l;g[9]=0;g[13]=-((c+d)*l);g[2]=0;g[6]=0;g[10]=-2*h;g[14]=-((f+e)*h);g[3]=0;g[7]=0;g[11]=0;g[15]=1;return this},equals:function(a){var b=this.elements;a=a.elements;for(var c=0;16>c;c++)if(b[c]!==a[c])return!1;
return!0},fromArray:function(a,b){void 0===b&&(b=0);for(var c=0;16>c;c++)this.elements[c]=a[c+b];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);var c=this.elements;a[b]=c[0];a[b+1]=c[1];a[b+2]=c[2];a[b+3]=c[3];a[b+4]=c[4];a[b+5]=c[5];a[b+6]=c[6];a[b+7]=c[7];a[b+8]=c[8];a[b+9]=c[9];a[b+10]=c[10];a[b+11]=c[11];a[b+12]=c[12];a[b+13]=c[13];a[b+14]=c[14];a[b+15]=c[15];return a}};Ta.prototype=Object.create(ba.prototype);Ta.prototype.constructor=Ta;Ta.prototype.isCubeTexture=!0;
Object.defineProperty(Ta.prototype,"images",{get:function(){return this.image},set:function(a){this.image=a}});var Td=new ba,Ud=new Ta,Qd=[],Sd=[];Yd.prototype.setValue=function(a,b){for(var c=this.seq,d=0,e=c.length;d!==e;++d){var f=c[d];f.setValue(a,b[f.id])}};var kd=/([\w\d_]+)(\])?(\[|\.)?/g;Ga.prototype.setValue=function(a,b,c){b=this.map[b];void 0!==b&&b.setValue(a,c,this.renderer)};Ga.prototype.set=function(a,b,c){var d=this.map[c];void 0!==d&&d.setValue(a,b[c],this.renderer)};Ga.prototype.setOptional=
function(a,b,c){b=b[c];void 0!==b&&this.setValue(a,c,b)};Ga.upload=function(a,b,c,d){for(var e=0,f=b.length;e!==f;++e){var g=b[e],k=c[g.id];!1!==k.needsUpdate&&g.setValue(a,k.value,d)}};Ga.seqWithValue=function(a,b){for(var c=[],d=0,e=a.length;d!==e;++d){var f=a[d];f.id in b&&c.push(f)}return c};Ga.splitDynamic=function(a,b){for(var c=null,d=a.length,e=0,f=0;f!==d;++f){var g=a[f],k=b[g.id];k&&!0===k.dynamic?(null===c&&(c=[]),c.push(g)):(e<f&&(a[e]=g),++e)}e<d&&(a.length=e);return c};Ga.evalDynamic=
function(a,b,c,d,e){for(var f=0,g=a.length;f!==g;++f){var k=b[a[f].id],l=k.onUpdateCallback;void 0!==l&&l.call(k,c,d,e)}};h.UniformsUtils={merge:function(a){for(var b={},c=0;c<a.length;c++){var d=this.clone(a[c]),e;for(e in d)b[e]=d[e]}return b},clone:function(a){var b={},c;for(c in a){b[c]={};for(var d in a[c]){var e=a[c][d];e&&e.isColor||e&&e.isVector2||e&&e.isVector3||e&&e.isVector4||e&&e.isMatrix3||e&&e.isMatrix4||e&&e.isTexture?b[c][d]=e.clone():Array.isArray(e)?b[c][d]=e.slice():b[c][d]=e}}return b}};
var Z={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif\n",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif\n",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif\n",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif\n",
aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"\nvec3 transformed = vec3( position );\n",beginnormal_vertex:"\nvec3 objectNormal = vec3( normal );\n",bsdfs:"bool testLightInRange( const in float lightDistance, const in float cutoffDistance ) {\n\treturn any( bvec2( cutoffDistance == 0.0, lightDistance < cutoffDistance ) );\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t\tif( decayExponent > 0.0 ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\t\tfloat maxDistanceCutoffFactor = pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t\treturn distanceFalloff * maxDistanceCutoffFactor;\n#else\n\t\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n#endif\n\t\t}\n\t\treturn 1.0;\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n\treturn specularColor * AB.x + AB.y;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n",
bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = dFdx( surf_pos );\n\t\tvec3 vSigmaY = dFdy( surf_pos );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif\n",
clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tfor ( int i = 0; i < NUM_CLIPPING_PLANES; ++ i ) {\n\t\tvec4 plane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n#endif\n",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( PHYSICAL ) && ! defined( PHONG )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif\n",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvarying vec3 vViewPosition;\n#endif\n",
clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif\n",color_pars_vertex:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",common:"#define PI 3.14159265359\n#define PI2 6.28318530718\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\n",
cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_textureSize (1024.0)\nint getFaceFromDirection(vec3 direction) {\n\tvec3 absDirection = abs(direction);\n\tint face = -1;\n\tif( absDirection.x > absDirection.z ) {\n\t\tif(absDirection.x > absDirection.y )\n\t\t\tface = direction.x > 0.0 ? 0 : 3;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\telse {\n\t\tif(absDirection.z > absDirection.y )\n\t\t\tface = direction.z > 0.0 ? 2 : 5;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\treturn face;\n}\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\n\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\n\tfloat dxRoughness = dFdx(roughness);\n\tfloat dyRoughness = dFdy(roughness);\n\tvec3 dx = dFdx( vec * scale * dxRoughness );\n\tvec3 dy = dFdy( vec * scale * dyRoughness );\n\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\n\td = clamp(d, 1.0, cubeUV_rangeClamp);\n\tfloat mipLevel = 0.5 * log2(d);\n\treturn vec2(floor(mipLevel), fract(mipLevel));\n}\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\n\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\n\tfloat a = 16.0 * cubeUV_rcpTextureSize;\n\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\n\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\n\tfloat powScale = exp2_packed.x * exp2_packed.y;\n\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\n\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\n\tbool bRes = mipLevel == 0.0;\n\tscale =  bRes && (scale < a) ? a : scale;\n\tvec3 r;\n\tvec2 offset;\n\tint face = getFaceFromDirection(direction);\n\tfloat rcpPowScale = 1.0 / powScale;\n\tif( face == 0) {\n\t\tr = vec3(direction.x, -direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  a : offset.y;\n\t}\n\telse if( face == 1) {\n\t\tr = vec3(direction.y, direction.x, direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  a : offset.y;\n\t}\n\telse if( face == 2) {\n\t\tr = vec3(direction.z, direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  a : offset.y;\n\t}\n\telse if( face == 3) {\n\t\tr = vec3(direction.x, direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  0.0 : offset.y;\n\t}\n\telse if( face == 4) {\n\t\tr = vec3(direction.y, direction.x, -direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  0.0 : offset.y;\n\t}\n\telse {\n\t\tr = vec3(direction.z, -direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  0.0 : offset.y;\n\t}\n\tr = normalize(r);\n\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\n\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\n\tvec2 base = offset + vec2( texelOffset );\n\treturn base + s * ( scale - 2.0 * texelOffset );\n}\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\nvec4 textureCubeUV(vec3 reflectedDirection, float roughness ) {\n\tfloat roughnessVal = roughness* cubeUV_maxLods3;\n\tfloat r1 = floor(roughnessVal);\n\tfloat r2 = r1 + 1.0;\n\tfloat t = fract(roughnessVal);\n\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\n\tfloat s = mipInfo.y;\n\tfloat level0 = mipInfo.x;\n\tfloat level1 = level0 + 1.0;\n\tlevel1 = level1 > 5.0 ? 5.0 : level1;\n\tlevel0 += min( floor( s + 0.5 ), 5.0 );\n\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\n\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\n\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\n\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\n\tvec4 result = mix(color10, color20, t);\n\treturn vec4(result.rgb, 1.0);\n}\n#endif\n",
defaultnormal_vertex:"#ifdef FLIP_SIDED\n\tobjectNormal = -objectNormal;\n#endif\nvec3 transformedNormal = normalMatrix * objectNormal;\n",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif\n",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normal * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n#endif\n",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif\n",
emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif\n",encodings_fragment:"  gl_FragColor = linearToOutputTexel( gl_FragColor );\n",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n  return value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n  return vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n  return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n  return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n  return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n  return vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n  float maxComponent = max( max( value.r, value.g ), value.b );\n  float fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n  return vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n  return vec4( value.xyz * value.w * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n  float maxRGB = max( value.x, max( value.g, value.b ) );\n  float M      = clamp( maxRGB / maxRange, 0.0, 1.0 );\n  M            = ceil( M * 255.0 ) / 255.0;\n  return vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n    return vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n    float maxRGB = max( value.x, max( value.g, value.b ) );\n    float D      = max( maxRange / maxRGB, 1.0 );\n    D            = min( floor( D ) / 255.0, 1.0 );\n    return vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n  vec3 Xp_Y_XYZp = value.rgb * cLogLuvM;\n  Xp_Y_XYZp = max(Xp_Y_XYZp, vec3(1e-6, 1e-6, 1e-6));\n  vec4 vResult;\n  vResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n  float Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n  vResult.w = fract(Le);\n  vResult.z = (Le - (floor(vResult.w*255.0))/255.0)/255.0;\n  return vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n  float Le = value.z * 255.0 + value.w;\n  vec3 Xp_Y_XYZp;\n  Xp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\n  Xp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n  Xp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n  vec3 vRGB = Xp_Y_XYZp.rgb * cLogLuvInverseM;\n  return vec4( max(vRGB, 0.0), 1.0 );\n}\n",
envmap_fragment:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\tsampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\n\t\tsampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\tvec3 reflectView = flipNormal * normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\tenvColor = envMapTexelToLinear( envColor );\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif\n",
envmap_pars_fragment:"#if defined( USE_ENVMAP ) || defined( PHYSICAL )\n\tuniform float reflectivity;\n\tuniform float envMapIntenstiy;\n#endif\n#ifdef USE_ENVMAP\n\t#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )\n\t\tvarying vec3 vWorldPosition;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif\n",
envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif\n",envmap_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif\n",
fog_fragment:"#ifdef USE_FOG\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;\n\t#else\n\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n\t#endif\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * depth * depth * LOG2 ) );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif\n",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",
lightmap_fragment:"#ifdef USE_LIGHTMAP\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n#endif\n",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvLightFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif\n",
lights_pars:"uniform vec3 ambientLightColor;\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tif ( testLightInRange( lightDistance, pointLight.distance ) ) {\n\t\t\tdirectLight.color = pointLight.color;\n\t\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( all( bvec2( angleCos > spotLight.coneCos, testLightInRange( lightDistance, spotLight.distance ) ) ) ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif\n#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\t#include <normal_flip>\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = flipNormal * vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryVec = flipNormal * vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar - 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\n\t\t#endif\n\t\t#include <normal_flip>\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV(queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent));\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\n\t\t\tsampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = flipNormal * normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif\n",
lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;\n",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)\n",
lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\n#ifdef STANDARD\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.clearCoat = saturate( clearCoat );\tmaterial.clearCoatRoughness = clamp( clearCoatRoughness, 0.04, 1.0 );\n#endif\n",
lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n\t#ifndef STANDARD\n\t\tfloat clearCoat;\n\t\tfloat clearCoatRoughness;\n\t#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearCoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifndef STANDARD\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.directSpecular += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\n\treflectedLight.directDiffuse += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\t#ifndef STANDARD\n\t\treflectedLight.directSpecular += irradiance * material.clearCoat * BRDF_Specular_GGX( directLight, geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 clearCoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifndef STANDARD\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\tfloat dotNL = dotNV;\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.indirectSpecular += ( 1.0 - clearCoatDHR ) * radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\n\t#ifndef STANDARD\n\t\treflectedLight.indirectSpecular += clearCoatRadiance * material.clearCoat * BRDF_Specular_GGX_Environment( geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\n#define Material_ClearCoat_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.clearCoatRoughness )\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}\n",
lights_template:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = normalize( vViewPosition );\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#ifdef USE_LIGHTMAP\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t \tirradiance += getLightProbeIndirectIrradiance( geometry, 8 );\n\t#endif\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tvec3 radiance = getLightProbeIndirectRadiance( geometry, Material_BlinnShininessExponent( material ), 8 );\n\t#ifndef STANDARD\n\t\tvec3 clearCoatRadiance = getLightProbeIndirectRadiance( geometry, Material_ClearCoat_BlinnShininessExponent( material ), 8 );\n\t#else\n\t\tvec3 clearCoatRadiance = vec3( 0.0 );\n\t#endif\n\t\t\n\tRE_IndirectSpecular( radiance, clearCoatRadiance, geometry, material, reflectedLight );\n#endif\n",
logdepthbuf_fragment:"#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\tgl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#ifdef USE_LOGDEPTHBUF\n\tuniform float logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n#endif\n",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n\tuniform float logDepthBufFC;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\tgl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t#else\n\t\tgl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n\t#endif\n#endif\n",
map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif\n",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n",map_particle_fragment:"#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) * offsetRepeat.zw + offsetRepeat.xy );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n",map_particle_pars_fragment:"#ifdef USE_MAP\n\tuniform vec4 offsetRepeat;\n\tuniform sampler2D map;\n#endif\n",
metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.r;\n#endif\n",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n#endif\n",
morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\t#endif\n#endif\n",
normal_flip:"#ifdef DOUBLE_SIDED\n\tfloat flipNormal = ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n#else\n\tfloat flipNormal = 1.0;\n#endif\n",normal_fragment:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal ) * flipNormal;\n#endif\n#ifdef USE_NORMALMAP\n\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif\n",
normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n\t\tvec3 N = normalize( surf_norm );\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\tmapN.xy = normalScale * mapN.xy;\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif\n",
packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n  return normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n  return 1.0 - 2.0 * rgb.xyz;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n  return ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n  return linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n  return (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n  return ( near * far ) / ( ( far - near ) * invClipZ - far );\n}\n",
premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif\n",project_vertex:"#ifdef USE_SKINNING\n\tvec4 mvPosition = modelViewMatrix * skinned;\n#else\n\tvec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\n#endif\ngl_Position = projectionMatrix * mvPosition;\n",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.r;\n#endif\n",
roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\treturn (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn 1.0;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\tfloat dp = ( length( lightToPosition ) - shadowBias ) / 1000.0;\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif\n",
shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n#endif\n",
shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n#endif\n",
shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tDirectionalLight directionalLight;\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tSpotLight spotLight;\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tPointLight pointLight;\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#endif\n\treturn shadow;\n}\n",
skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureWidth;\n\t\tuniform int boneTextureHeight;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureWidth ) );\n\t\t\tfloat y = floor( j / float( boneTextureWidth ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureWidth );\n\t\t\tfloat dy = 1.0 / float( boneTextureHeight );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif\n",
skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\tskinned  = bindMatrixInverse * skinned;\n#endif\n",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n#endif\n",
specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n  gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif\n",tonemapping_pars_fragment:"#define saturate(a) clamp( a, 0.0, 1.0 )\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n  return toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n  color *= toneMappingExposure;\n  return saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n  color *= toneMappingExposure;\n  return saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n  color *= toneMappingExposure;\n  color = max( vec3( 0.0 ), color - 0.004 );\n  return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\n",
uv_pars_fragment:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n\tuniform vec4 offsetRepeat;\n#endif\n",
uv_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n#endif",
uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = uv2;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( PHYSICAL ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n\t#ifdef USE_SKINNING\n\t\tvec4 worldPosition = modelMatrix * skinned;\n\t#else\n\t\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n\t#endif\n#endif\n",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\n\tgl_FragColor.a *= opacity;\n}\n",
cube_vert:"varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}\n",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}\n",
depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n",
distanceRGBA_frag:"uniform vec3 lightPos;\nvarying vec4 vWorldPosition;\n#include <common>\n#include <packing>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tgl_FragColor = packDepthToRGBA( length( vWorldPosition.xyz - lightPos.xyz ) / 1000.0 );\n}\n",distanceRGBA_vert:"varying vec4 vWorldPosition;\n#include <common>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <skinbase_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition;\n}\n",
equirect_frag:"uniform sampler2D tEquirect;\nuniform float tFlip;\nvarying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldPosition );\n\tvec2 sampleUV;\n\tsampleUV.y = saturate( tFlip * direction.y * -0.5 + 0.5 );\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n}\n",equirect_vert:"varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}\n",
linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",
linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight;\n\treflectedLight.directDiffuse = vec3( 0.0 );\n\treflectedLight.directSpecular = vec3( 0.0 );\n\treflectedLight.indirectDiffuse = diffuseColor.rgb;\n\treflectedLight.indirectSpecular = vec3( 0.0 );\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <normal_flip>\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",
meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n}\n",
meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <normal_flip>\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",
meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars>\n#include <color_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n}\n",
meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_flip>\n\t#include <normal_fragment>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_template>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",
meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n}\n",
meshphysical_frag:"#define PHYSICAL\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifndef STANDARD\n\tuniform float clearCoat;\n\tuniform float clearCoatRoughness;\n#endif\nuniform float envMapIntensity;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <lights_pars>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_flip>\n\t#include <normal_fragment>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_template>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",
meshphysical_vert:"#define PHYSICAL\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n}\n",
normal_frag:"uniform float opacity;\nvarying vec3 vNormal;\n#include <common>\n#include <packing>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tgl_FragColor = vec4( packNormalToRGB( vNormal ), opacity );\n\t#include <logdepthbuf_fragment>\n}\n",normal_vert:"varying vec3 vNormal;\n#include <common>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvNormal = normalize( normalMatrix * normal );\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n",
points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",
points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#ifdef USE_SIZEATTENUATION\n\t\tgl_PointSize = size * ( scale / - mvPosition.z );\n\t#else\n\t\tgl_PointSize = size;\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n}\n",
shadow_frag:"uniform float opacity;\n#include <common>\n#include <packing>\n#include <bsdfs>\n#include <lights_pars>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( 0.0, 0.0, 0.0, opacity * ( 1.0  - getShadowMask() ) );\n}\n",shadow_vert:"#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n}\n"};H.prototype={constructor:H,
isColor:!0,r:1,g:1,b:1,set:function(a){a&&a.isColor?this.copy(a):"number"===typeof a?this.setHex(a):"string"===typeof a&&this.setStyle(a);return this},setScalar:function(a){this.b=this.g=this.r=a},setHex:function(a){a=Math.floor(a);this.r=(a>>16&255)/255;this.g=(a>>8&255)/255;this.b=(a&255)/255;return this},setRGB:function(a,b,c){this.r=a;this.g=b;this.b=c;return this},setHSL:function(){function a(a,c,d){0>d&&(d+=1);1<d&&--d;return d<1/6?a+6*(c-a)*d:.5>d?c:d<2/3?a+6*(c-a)*(2/3-d):a}return function(b,
c,d){b=h.Math.euclideanModulo(b,1);c=h.Math.clamp(c,0,1);d=h.Math.clamp(d,0,1);0===c?this.r=this.g=this.b=d:(c=.5>=d?d*(1+c):d+c-d*c,d=2*d-c,this.r=a(d,c,b+1/3),this.g=a(d,c,b),this.b=a(d,c,b-1/3));return this}}(),setStyle:function(a){function b(b){void 0!==b&&1>parseFloat(b)&&console.warn("THREE.Color: Alpha component of "+a+" will be ignored.")}var c;if(c=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(a)){var d=c[2];switch(c[1]){case "rgb":case "rgba":if(c=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(d))return this.r=
Math.min(255,parseInt(c[1],10))/255,this.g=Math.min(255,parseInt(c[2],10))/255,this.b=Math.min(255,parseInt(c[3],10))/255,b(c[5]),this;if(c=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(d))return this.r=Math.min(100,parseInt(c[1],10))/100,this.g=Math.min(100,parseInt(c[2],10))/100,this.b=Math.min(100,parseInt(c[3],10))/100,b(c[5]),this;break;case "hsl":case "hsla":if(c=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(d)){var d=parseFloat(c[1])/
360,e=parseInt(c[2],10)/100,f=parseInt(c[3],10)/100;b(c[5]);return this.setHSL(d,e,f)}}}else if(c=/^\#([A-Fa-f0-9]+)$/.exec(a)){c=c[1];d=c.length;if(3===d)return this.r=parseInt(c.charAt(0)+c.charAt(0),16)/255,this.g=parseInt(c.charAt(1)+c.charAt(1),16)/255,this.b=parseInt(c.charAt(2)+c.charAt(2),16)/255,this;if(6===d)return this.r=parseInt(c.charAt(0)+c.charAt(1),16)/255,this.g=parseInt(c.charAt(2)+c.charAt(3),16)/255,this.b=parseInt(c.charAt(4)+c.charAt(5),16)/255,this}a&&0<a.length&&(c=h.ColorKeywords[a],
void 0!==c?this.setHex(c):console.warn("THREE.Color: Unknown color "+a));return this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(a){this.r=a.r;this.g=a.g;this.b=a.b;return this},copyGammaToLinear:function(a,b){void 0===b&&(b=2);this.r=Math.pow(a.r,b);this.g=Math.pow(a.g,b);this.b=Math.pow(a.b,b);return this},copyLinearToGamma:function(a,b){void 0===b&&(b=2);var c=0<b?1/b:1;this.r=Math.pow(a.r,c);this.g=Math.pow(a.g,c);this.b=Math.pow(a.b,c);return this},convertGammaToLinear:function(){var a=
this.r,b=this.g,c=this.b;this.r=a*a;this.g=b*b;this.b=c*c;return this},convertLinearToGamma:function(){this.r=Math.sqrt(this.r);this.g=Math.sqrt(this.g);this.b=Math.sqrt(this.b);return this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(a){a=a||{h:0,s:0,l:0};var b=this.r,c=this.g,d=this.b,e=Math.max(b,c,d),f=Math.min(b,c,d),g,k=(f+e)/2;if(f===e)f=g=0;else{var l=e-f,f=.5>=k?l/(e+f):
l/(2-e-f);switch(e){case b:g=(c-d)/l+(c<d?6:0);break;case c:g=(d-b)/l+2;break;case d:g=(b-c)/l+4}g/=6}a.h=g;a.s=f;a.l=k;return a},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(a,b,c){var d=this.getHSL();d.h+=a;d.s+=b;d.l+=c;this.setHSL(d.h,d.s,d.l);return this},add:function(a){this.r+=a.r;this.g+=a.g;this.b+=a.b;return this},addColors:function(a,b){this.r=a.r+b.r;this.g=a.g+b.g;this.b=a.b+b.b;return this},addScalar:function(a){this.r+=
a;this.g+=a;this.b+=a;return this},sub:function(a){this.r=Math.max(0,this.r-a.r);this.g=Math.max(0,this.g-a.g);this.b=Math.max(0,this.b-a.b);return this},multiply:function(a){this.r*=a.r;this.g*=a.g;this.b*=a.b;return this},multiplyScalar:function(a){this.r*=a;this.g*=a;this.b*=a;return this},lerp:function(a,b){this.r+=(a.r-this.r)*b;this.g+=(a.g-this.g)*b;this.b+=(a.b-this.b)*b;return this},equals:function(a){return a.r===this.r&&a.g===this.g&&a.b===this.b},fromArray:function(a,b){void 0===b&&(b=
0);this.r=a[b];this.g=a[b+1];this.b=a[b+2];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.r;a[b+1]=this.g;a[b+2]=this.b;return a},toJSON:function(){return this.getHex()}};h.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,
cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,
dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,
lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,
mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,
seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};var U={common:{diffuse:{value:new H(15658734)},opacity:{value:1},map:{value:null},offsetRepeat:{value:new da(0,0,1,1)},specularMap:{value:null},alphaMap:{value:null},
envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new C(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},
metalnessmap:{metalnessMap:{value:null}},fog:{fogDensity:{value:2.5E-4},fogNear:{value:1},fogFar:{value:2E3},fogColor:{value:new H(16777215)}},lights:{ambientLightColor:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},
shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}}},points:{diffuse:{value:new H(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},offsetRepeat:{value:new da(0,0,1,1)}}},
Cb={basic:{uniforms:h.UniformsUtils.merge([U.common,U.aomap,U.fog]),vertexShader:Z.meshbasic_vert,fragmentShader:Z.meshbasic_frag},lambert:{uniforms:h.UniformsUtils.merge([U.common,U.aomap,U.lightmap,U.emissivemap,U.fog,U.lights,{emissive:{value:new H(0)}}]),vertexShader:Z.meshlambert_vert,fragmentShader:Z.meshlambert_frag},phong:{uniforms:h.UniformsUtils.merge([U.common,U.aomap,U.lightmap,U.emissivemap,U.bumpmap,U.normalmap,U.displacementmap,U.fog,U.lights,{emissive:{value:new H(0)},specular:{value:new H(1118481)},
shininess:{value:30}}]),vertexShader:Z.meshphong_vert,fragmentShader:Z.meshphong_frag},standard:{uniforms:h.UniformsUtils.merge([U.common,U.aomap,U.lightmap,U.emissivemap,U.bumpmap,U.normalmap,U.displacementmap,U.roughnessmap,U.metalnessmap,U.fog,U.lights,{emissive:{value:new H(0)},roughness:{value:.5},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Z.meshphysical_vert,fragmentShader:Z.meshphysical_frag},points:{uniforms:h.UniformsUtils.merge([U.points,U.fog]),vertexShader:Z.points_vert,
fragmentShader:Z.points_frag},dashed:{uniforms:h.UniformsUtils.merge([U.common,U.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Z.linedashed_vert,fragmentShader:Z.linedashed_frag},depth:{uniforms:h.UniformsUtils.merge([U.common,U.displacementmap]),vertexShader:Z.depth_vert,fragmentShader:Z.depth_frag},normal:{uniforms:{opacity:{value:1}},vertexShader:Z.normal_vert,fragmentShader:Z.normal_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Z.cube_vert,
fragmentShader:Z.cube_frag},equirect:{uniforms:{tEquirect:{value:null},tFlip:{value:-1}},vertexShader:Z.equirect_vert,fragmentShader:Z.equirect_frag},distanceRGBA:{uniforms:{lightPos:{value:new q}},vertexShader:Z.distanceRGBA_vert,fragmentShader:Z.distanceRGBA_frag}};Cb.physical={uniforms:h.UniformsUtils.merge([Cb.standard.uniforms,{clearCoat:{value:0},clearCoatRoughness:{value:0}}]),vertexShader:Z.meshphysical_vert,fragmentShader:Z.meshphysical_frag};cc.prototype={constructor:cc,set:function(a,b){this.min.copy(a);
this.max.copy(b);return this},setFromPoints:function(a){this.makeEmpty();for(var b=0,c=a.length;b<c;b++)this.expandByPoint(a[b]);return this},setFromCenterAndSize:function(){var a=new C;return function(b,c){var d=a.copy(c).multiplyScalar(.5);this.min.copy(b).sub(d);this.max.copy(b).add(d);return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.min.copy(a.min);this.max.copy(a.max);return this},makeEmpty:function(){this.min.x=this.min.y=Infinity;this.max.x=this.max.y=
-Infinity;return this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(a){a=a||new C;return this.isEmpty()?a.set(0,0):a.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(a){a=a||new C;return this.isEmpty()?a.set(0,0):a.subVectors(this.max,this.min)},expandByPoint:function(a){this.min.min(a);this.max.max(a);return this},expandByVector:function(a){this.min.sub(a);this.max.add(a);return this},expandByScalar:function(a){this.min.addScalar(-a);
this.max.addScalar(a);return this},containsPoint:function(a){return a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y?!1:!0},containsBox:function(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y?!0:!1},getParameter:function(a,b){return(b||new C).set((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(a){return a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y?
!1:!0},clampPoint:function(a,b){return(b||new C).copy(a).clamp(this.min,this.max)},distanceToPoint:function(){var a=new C;return function(b){return a.copy(b).clamp(this.min,this.max).sub(b).length()}}(),intersect:function(a){this.min.max(a.min);this.max.min(a.max);return this},union:function(a){this.min.min(a.min);this.max.max(a.max);return this},translate:function(a){this.min.add(a);this.max.add(a);return this},equals:function(a){return a.min.equals(this.min)&&a.max.equals(this.max)}};S.prototype=
{constructor:S,isMaterial:!0,get needsUpdate(){return this._needsUpdate},set needsUpdate(a){!0===a&&this.update();this._needsUpdate=a},setValues:function(a){if(void 0!==a)for(var b in a){var c=a[b];if(void 0===c)console.warn("THREE.Material: '"+b+"' parameter is undefined.");else{var d=this[b];void 0===d?console.warn("THREE."+this.type+": '"+b+"' is not a property of this material."):d&&d.isColor?d.set(c):d&&d.isVector3&&c&&c.isVector3?d.copy(c):this[b]="overdraw"===b?Number(c):c}}},toJSON:function(a){function b(a){var b=
[],c;for(c in a){var d=a[c];delete d.metadata;b.push(d)}return b}var c=void 0===a;c&&(a={textures:{},images:{}});var d={metadata:{version:4.4,type:"Material",generator:"Material.toJSON"}};d.uuid=this.uuid;d.type=this.type;""!==this.name&&(d.name=this.name);this.color&&this.color.isColor&&(d.color=this.color.getHex());void 0!==this.roughness&&(d.roughness=this.roughness);void 0!==this.metalness&&(d.metalness=this.metalness);this.emissive&&this.emissive.isColor&&(d.emissive=this.emissive.getHex());
this.specular&&this.specular.isColor&&(d.specular=this.specular.getHex());void 0!==this.shininess&&(d.shininess=this.shininess);this.map&&this.map.isTexture&&(d.map=this.map.toJSON(a).uuid);this.alphaMap&&this.alphaMap.isTexture&&(d.alphaMap=this.alphaMap.toJSON(a).uuid);this.lightMap&&this.lightMap.isTexture&&(d.lightMap=this.lightMap.toJSON(a).uuid);this.bumpMap&&this.bumpMap.isTexture&&(d.bumpMap=this.bumpMap.toJSON(a).uuid,d.bumpScale=this.bumpScale);this.normalMap&&this.normalMap.isTexture&&
(d.normalMap=this.normalMap.toJSON(a).uuid,d.normalScale=this.normalScale.toArray());this.displacementMap&&this.displacementMap.isTexture&&(d.displacementMap=this.displacementMap.toJSON(a).uuid,d.displacementScale=this.displacementScale,d.displacementBias=this.displacementBias);this.roughnessMap&&this.roughnessMap.isTexture&&(d.roughnessMap=this.roughnessMap.toJSON(a).uuid);this.metalnessMap&&this.metalnessMap.isTexture&&(d.metalnessMap=this.metalnessMap.toJSON(a).uuid);this.emissiveMap&&this.emissiveMap.isTexture&&
(d.emissiveMap=this.emissiveMap.toJSON(a).uuid);this.specularMap&&this.specularMap.isTexture&&(d.specularMap=this.specularMap.toJSON(a).uuid);this.envMap&&this.envMap.isTexture&&(d.envMap=this.envMap.toJSON(a).uuid,d.reflectivity=this.reflectivity);void 0!==this.size&&(d.size=this.size);void 0!==this.sizeAttenuation&&(d.sizeAttenuation=this.sizeAttenuation);1!==this.blending&&(d.blending=this.blending);2!==this.shading&&(d.shading=this.shading);0!==this.side&&(d.side=this.side);0!==this.vertexColors&&
(d.vertexColors=this.vertexColors);1>this.opacity&&(d.opacity=this.opacity);!0===this.transparent&&(d.transparent=this.transparent);d.depthFunc=this.depthFunc;d.depthTest=this.depthTest;d.depthWrite=this.depthWrite;0<this.alphaTest&&(d.alphaTest=this.alphaTest);!0===this.premultipliedAlpha&&(d.premultipliedAlpha=this.premultipliedAlpha);!0===this.wireframe&&(d.wireframe=this.wireframe);1<this.wireframeLinewidth&&(d.wireframeLinewidth=this.wireframeLinewidth);"round"!==this.wireframeLinecap&&(d.wireframeLinecap=
this.wireframeLinecap);"round"!==this.wireframeLinejoin&&(d.wireframeLinejoin=this.wireframeLinejoin);d.skinning=this.skinning;d.morphTargets=this.morphTargets;c&&(c=b(a.textures),a=b(a.images),0<c.length&&(d.textures=c),0<a.length&&(d.images=a));return d},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.name=a.name;this.fog=a.fog;this.lights=a.lights;this.blending=a.blending;this.side=a.side;this.shading=a.shading;this.vertexColors=a.vertexColors;this.opacity=a.opacity;
this.transparent=a.transparent;this.blendSrc=a.blendSrc;this.blendDst=a.blendDst;this.blendEquation=a.blendEquation;this.blendSrcAlpha=a.blendSrcAlpha;this.blendDstAlpha=a.blendDstAlpha;this.blendEquationAlpha=a.blendEquationAlpha;this.depthFunc=a.depthFunc;this.depthTest=a.depthTest;this.depthWrite=a.depthWrite;this.colorWrite=a.colorWrite;this.precision=a.precision;this.polygonOffset=a.polygonOffset;this.polygonOffsetFactor=a.polygonOffsetFactor;this.polygonOffsetUnits=a.polygonOffsetUnits;this.alphaTest=
a.alphaTest;this.premultipliedAlpha=a.premultipliedAlpha;this.overdraw=a.overdraw;this.visible=a.visible;this.clipShadows=a.clipShadows;a=a.clippingPlanes;var b=null;if(null!==a)for(var c=a.length,b=Array(c),d=0;d!==c;++d)b[d]=a[d].clone();this.clippingPlanes=b;return this},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}};Object.assign(S.prototype,pa.prototype);var Zd=0;Da.prototype=Object.create(S.prototype);Da.prototype.constructor=
Da;Da.prototype.isShaderMaterial=!0;Da.prototype.copy=function(a){S.prototype.copy.call(this,a);this.fragmentShader=a.fragmentShader;this.vertexShader=a.vertexShader;this.uniforms=h.UniformsUtils.clone(a.uniforms);this.defines=a.defines;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.lights=a.lights;this.clipping=a.clipping;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.morphNormals=a.morphNormals;this.extensions=a.extensions;return this};Da.prototype.toJSON=
function(a){a=S.prototype.toJSON.call(this,a);a.uniforms=this.uniforms;a.vertexShader=this.vertexShader;a.fragmentShader=this.fragmentShader;return a};Ua.prototype=Object.create(S.prototype);Ua.prototype.constructor=Ua;Ua.prototype.isMeshDepthMaterial=!0;Ua.prototype.copy=function(a){S.prototype.copy.call(this,a);this.depthPacking=a.depthPacking;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.map=a.map;this.alphaMap=a.alphaMap;this.displacementMap=a.displacementMap;this.displacementScale=
a.displacementScale;this.displacementBias=a.displacementBias;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;return this};Ha.prototype={constructor:Ha,isBox3:!0,set:function(a,b){this.min.copy(a);this.max.copy(b);return this},setFromArray:function(a){for(var b=Infinity,c=Infinity,d=Infinity,e=-Infinity,f=-Infinity,g=-Infinity,k=0,l=a.length;k<l;k+=3){var h=a[k],u=a[k+1],p=a[k+2];h<b&&(b=h);u<c&&(c=u);p<d&&(d=p);h>e&&(e=h);u>f&&(f=u);p>g&&(g=p)}this.min.set(b,c,d);this.max.set(e,
f,g)},setFromPoints:function(a){this.makeEmpty();for(var b=0,c=a.length;b<c;b++)this.expandByPoint(a[b]);return this},setFromCenterAndSize:function(){var a=new q;return function(b,c){var d=a.copy(c).multiplyScalar(.5);this.min.copy(b).sub(d);this.max.copy(b).add(d);return this}}(),setFromObject:function(){var a=new q;return function(b){var c=this;b.updateMatrixWorld(!0);this.makeEmpty();b.traverse(function(b){var e=b.geometry;if(void 0!==e)if(e&&e.isGeometry)for(var e=e.vertices,f=0,g=e.length;f<
g;f++)a.copy(e[f]),a.applyMatrix4(b.matrixWorld),c.expandByPoint(a);else if(e&&e.isBufferGeometry&&(g=e.attributes.position,void 0!==g)){var k;g&&g.isInterleavedBufferAttribute?(e=g.data.array,f=g.offset,k=g.data.stride):(e=g.array,f=0,k=3);for(g=e.length;f<g;f+=k)a.fromArray(e,f),a.applyMatrix4(b.matrixWorld),c.expandByPoint(a)}});return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.min.copy(a.min);this.max.copy(a.max);return this},makeEmpty:function(){this.min.x=
this.min.y=this.min.z=Infinity;this.max.x=this.max.y=this.max.z=-Infinity;return this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(a){a=a||new q;return this.isEmpty()?a.set(0,0,0):a.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(a){a=a||new q;return this.isEmpty()?a.set(0,0,0):a.subVectors(this.max,this.min)},expandByPoint:function(a){this.min.min(a);this.max.max(a);return this},expandByVector:function(a){this.min.sub(a);
this.max.add(a);return this},expandByScalar:function(a){this.min.addScalar(-a);this.max.addScalar(a);return this},containsPoint:function(a){return a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y||a.z<this.min.z||a.z>this.max.z?!1:!0},containsBox:function(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y&&this.min.z<=a.min.z&&a.max.z<=this.max.z?!0:!1},getParameter:function(a,b){return(b||new q).set((a.x-this.min.x)/(this.max.x-this.min.x),
(a.y-this.min.y)/(this.max.y-this.min.y),(a.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(a){return a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y||a.max.z<this.min.z||a.min.z>this.max.z?!1:!0},intersectsSphere:function(){var a;return function(b){void 0===a&&(a=new q);this.clampPoint(b.center,a);return a.distanceToSquared(b.center)<=b.radius*b.radius}}(),intersectsPlane:function(a){var b,c;0<a.normal.x?(b=a.normal.x*this.min.x,c=a.normal.x*this.max.x):
(b=a.normal.x*this.max.x,c=a.normal.x*this.min.x);0<a.normal.y?(b+=a.normal.y*this.min.y,c+=a.normal.y*this.max.y):(b+=a.normal.y*this.max.y,c+=a.normal.y*this.min.y);0<a.normal.z?(b+=a.normal.z*this.min.z,c+=a.normal.z*this.max.z):(b+=a.normal.z*this.max.z,c+=a.normal.z*this.min.z);return b<=a.constant&&c>=a.constant},clampPoint:function(a,b){return(b||new q).copy(a).clamp(this.min,this.max)},distanceToPoint:function(){var a=new q;return function(b){return a.copy(b).clamp(this.min,this.max).sub(b).length()}}(),
getBoundingSphere:function(){var a=new q;return function(b){b=b||new Aa;this.getCenter(b.center);b.radius=.5*this.size(a).length();return b}}(),intersect:function(a){this.min.max(a.min);this.max.min(a.max);this.isEmpty()&&this.makeEmpty();return this},union:function(a){this.min.min(a.min);this.max.max(a.max);return this},applyMatrix4:function(){var a=[new q,new q,new q,new q,new q,new q,new q,new q];return function(b){if(this.isEmpty())return this;a[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(b);
a[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(b);a[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(b);a[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(b);a[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(b);a[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(b);a[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(b);a[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(b);this.setFromPoints(a);return this}}(),translate:function(a){this.min.add(a);this.max.add(a);
return this},equals:function(a){return a.min.equals(this.min)&&a.max.equals(this.max)}};Aa.prototype={constructor:Aa,set:function(a,b){this.center.copy(a);this.radius=b;return this},setFromPoints:function(){var a=new Ha;return function(b,c){var d=this.center;void 0!==c?d.copy(c):a.setFromPoints(b).getCenter(d);for(var e=0,f=0,g=b.length;f<g;f++)e=Math.max(e,d.distanceToSquared(b[f]));this.radius=Math.sqrt(e);return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.center.copy(a.center);
this.radius=a.radius;return this},empty:function(){return 0>=this.radius},containsPoint:function(a){return a.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(a){return a.distanceTo(this.center)-this.radius},intersectsSphere:function(a){var b=this.radius+a.radius;return a.center.distanceToSquared(this.center)<=b*b},intersectsBox:function(a){return a.intersectsSphere(this)},intersectsPlane:function(a){return Math.abs(this.center.dot(a.normal)-a.constant)<=this.radius},
clampPoint:function(a,b){var c=this.center.distanceToSquared(a),d=b||new q;d.copy(a);c>this.radius*this.radius&&(d.sub(this.center).normalize(),d.multiplyScalar(this.radius).add(this.center));return d},getBoundingBox:function(a){a=a||new Ha;a.set(this.center,this.center);a.expandByScalar(this.radius);return a},applyMatrix4:function(a){this.center.applyMatrix4(a);this.radius*=a.getMaxScaleOnAxis();return this},translate:function(a){this.center.add(a);return this},equals:function(a){return a.center.equals(this.center)&&
a.radius===this.radius}};ya.prototype={constructor:ya,isMatrix3:!0,set:function(a,b,c,d,e,f,g,k,l){var h=this.elements;h[0]=a;h[1]=d;h[2]=g;h[3]=b;h[4]=e;h[5]=k;h[6]=c;h[7]=f;h[8]=l;return this},identity:function(){this.set(1,0,0,0,1,0,0,0,1);return this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(a){a=a.elements;this.set(a[0],a[3],a[6],a[1],a[4],a[7],a[2],a[5],a[8]);return this},setFromMatrix4:function(a){a=a.elements;this.set(a[0],a[4],a[8],a[1],a[5],a[9],
a[2],a[6],a[10]);return this},applyToVector3Array:function(){var a;return function(b,c,d){void 0===a&&(a=new q);void 0===c&&(c=0);void 0===d&&(d=b.length);for(var e=0;e<d;e+=3,c+=3)a.fromArray(b,c),a.applyMatrix3(this),a.toArray(b,c);return b}}(),applyToBuffer:function(){var a;return function(b,c,d){void 0===a&&(a=new q);void 0===c&&(c=0);void 0===d&&(d=b.length/b.itemSize);for(var e=0;e<d;e++,c++)a.x=b.getX(c),a.y=b.getY(c),a.z=b.getZ(c),a.applyMatrix3(this),b.setXYZ(a.x,a.y,a.z);return b}}(),multiplyScalar:function(a){var b=
this.elements;b[0]*=a;b[3]*=a;b[6]*=a;b[1]*=a;b[4]*=a;b[7]*=a;b[2]*=a;b[5]*=a;b[8]*=a;return this},determinant:function(){var a=this.elements,b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],k=a[6],l=a[7],a=a[8];return b*f*a-b*g*l-c*e*a+c*g*k+d*e*l-d*f*k},getInverse:function(a,b){a&&a.isMatrix4&&console.error("THREE.Matrix3.getInverse no longer takes a Matrix4 argument.");var c=a.elements,d=this.elements,e=c[0],f=c[1],g=c[2],k=c[3],l=c[4],h=c[5],u=c[6],p=c[7],c=c[8],n=c*l-h*p,r=h*u-c*k,t=p*k-l*u,q=e*n+f*
r+g*t;if(0===q){if(!0===b)throw Error("THREE.Matrix3.getInverse(): can't invert matrix, determinant is 0");console.warn("THREE.Matrix3.getInverse(): can't invert matrix, determinant is 0");return this.identity()}q=1/q;d[0]=n*q;d[1]=(g*p-c*f)*q;d[2]=(h*f-g*l)*q;d[3]=r*q;d[4]=(c*e-g*u)*q;d[5]=(g*k-h*e)*q;d[6]=t*q;d[7]=(f*u-p*e)*q;d[8]=(l*e-f*k)*q;return this},transpose:function(){var a,b=this.elements;a=b[1];b[1]=b[3];b[3]=a;a=b[2];b[2]=b[6];b[6]=a;a=b[5];b[5]=b[7];b[7]=a;return this},flattenToArrayOffset:function(a,
b){console.warn("THREE.Matrix3: .flattenToArrayOffset is deprecated - just use .toArray instead.");return this.toArray(a,b)},getNormalMatrix:function(a){return this.setFromMatrix4(a).getInverse(this).transpose()},transposeIntoArray:function(a){var b=this.elements;a[0]=b[0];a[1]=b[3];a[2]=b[6];a[3]=b[1];a[4]=b[4];a[5]=b[7];a[6]=b[2];a[7]=b[5];a[8]=b[8];return this},fromArray:function(a,b){void 0===b&&(b=0);for(var c=0;9>c;c++)this.elements[c]=a[c+b];return this},toArray:function(a,b){void 0===a&&(a=
[]);void 0===b&&(b=0);var c=this.elements;a[b]=c[0];a[b+1]=c[1];a[b+2]=c[2];a[b+3]=c[3];a[b+4]=c[4];a[b+5]=c[5];a[b+6]=c[6];a[b+7]=c[7];a[b+8]=c[8];return a}};fa.prototype={constructor:fa,set:function(a,b){this.normal.copy(a);this.constant=b;return this},setComponents:function(a,b,c,d){this.normal.set(a,b,c);this.constant=d;return this},setFromNormalAndCoplanarPoint:function(a,b){this.normal.copy(a);this.constant=-b.dot(this.normal);return this},setFromCoplanarPoints:function(){var a=new q,b=new q;
return function(c,d,e){d=a.subVectors(e,d).cross(b.subVectors(c,d)).normalize();this.setFromNormalAndCoplanarPoint(d,c);return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.normal.copy(a.normal);this.constant=a.constant;return this},normalize:function(){var a=1/this.normal.length();this.normal.multiplyScalar(a);this.constant*=a;return this},negate:function(){this.constant*=-1;this.normal.negate();return this},distanceToPoint:function(a){return this.normal.dot(a)+
this.constant},distanceToSphere:function(a){return this.distanceToPoint(a.center)-a.radius},projectPoint:function(a,b){return this.orthoPoint(a,b).sub(a).negate()},orthoPoint:function(a,b){var c=this.distanceToPoint(a);return(b||new q).copy(this.normal).multiplyScalar(c)},intersectLine:function(){var a=new q;return function(b,c){var d=c||new q,e=b.delta(a),f=this.normal.dot(e);if(0===f){if(0===this.distanceToPoint(b.start))return d.copy(b.start)}else return f=-(b.start.dot(this.normal)+this.constant)/
f,0>f||1<f?void 0:d.copy(e).multiplyScalar(f).add(b.start)}}(),intersectsLine:function(a){var b=this.distanceToPoint(a.start);a=this.distanceToPoint(a.end);return 0>b&&0<a||0>a&&0<b},intersectsBox:function(a){return a.intersectsPlane(this)},intersectsSphere:function(a){return a.intersectsPlane(this)},coplanarPoint:function(a){return(a||new q).copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var a=new q,b=new ya;return function(c,d){var e=this.coplanarPoint(a).applyMatrix4(c),
f=d||b.getNormalMatrix(c),f=this.normal.applyMatrix3(f).normalize();this.constant=-e.dot(f);return this}}(),translate:function(a){this.constant-=a.dot(this.normal);return this},equals:function(a){return a.normal.equals(this.normal)&&a.constant===this.constant}};dc.prototype={constructor:dc,set:function(a,b,c,d,e,f){var g=this.planes;g[0].copy(a);g[1].copy(b);g[2].copy(c);g[3].copy(d);g[4].copy(e);g[5].copy(f);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){for(var b=
this.planes,c=0;6>c;c++)b[c].copy(a.planes[c]);return this},setFromMatrix:function(a){var b=this.planes,c=a.elements;a=c[0];var d=c[1],e=c[2],f=c[3],g=c[4],k=c[5],l=c[6],h=c[7],u=c[8],p=c[9],n=c[10],r=c[11],t=c[12],q=c[13],A=c[14],c=c[15];b[0].setComponents(f-a,h-g,r-u,c-t).normalize();b[1].setComponents(f+a,h+g,r+u,c+t).normalize();b[2].setComponents(f+d,h+k,r+p,c+q).normalize();b[3].setComponents(f-d,h-k,r-p,c-q).normalize();b[4].setComponents(f-e,h-l,r-n,c-A).normalize();b[5].setComponents(f+e,
h+l,r+n,c+A).normalize();return this},intersectsObject:function(){var a=new Aa;return function(b){var c=b.geometry;null===c.boundingSphere&&c.computeBoundingSphere();a.copy(c.boundingSphere).applyMatrix4(b.matrixWorld);return this.intersectsSphere(a)}}(),intersectsSprite:function(){var a=new Aa;return function(b){a.center.set(0,0,0);a.radius=.7071067811865476;a.applyMatrix4(b.matrixWorld);return this.intersectsSphere(a)}}(),intersectsSphere:function(a){var b=this.planes,c=a.center;a=-a.radius;for(var d=
0;6>d;d++)if(b[d].distanceToPoint(c)<a)return!1;return!0},intersectsBox:function(){var a=new q,b=new q;return function(c){for(var d=this.planes,e=0;6>e;e++){var f=d[e];a.x=0<f.normal.x?c.min.x:c.max.x;b.x=0<f.normal.x?c.max.x:c.min.x;a.y=0<f.normal.y?c.min.y:c.max.y;b.y=0<f.normal.y?c.max.y:c.min.y;a.z=0<f.normal.z?c.min.z:c.max.z;b.z=0<f.normal.z?c.max.z:c.min.z;var g=f.distanceToPoint(a),f=f.distanceToPoint(b);if(0>g&&0>f)return!1}return!0}}(),containsPoint:function(a){for(var b=this.planes,c=0;6>
c;c++)if(0>b[c].distanceToPoint(a))return!1;return!0}};Wa.prototype={constructor:Wa,set:function(a,b){this.origin.copy(a);this.direction.copy(b);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.origin.copy(a.origin);this.direction.copy(a.direction);return this},at:function(a,b){return(b||new q).copy(this.direction).multiplyScalar(a).add(this.origin)},lookAt:function(a){this.direction.copy(a).sub(this.origin).normalize();return this},recast:function(){var a=
new q;return function(b){this.origin.copy(this.at(b,a));return this}}(),closestPointToPoint:function(a,b){var c=b||new q;c.subVectors(a,this.origin);var d=c.dot(this.direction);return 0>d?c.copy(this.origin):c.copy(this.direction).multiplyScalar(d).add(this.origin)},distanceToPoint:function(a){return Math.sqrt(this.distanceSqToPoint(a))},distanceSqToPoint:function(){var a=new q;return function(b){var c=a.subVectors(b,this.origin).dot(this.direction);if(0>c)return this.origin.distanceToSquared(b);
a.copy(this.direction).multiplyScalar(c).add(this.origin);return a.distanceToSquared(b)}}(),distanceSqToSegment:function(){var a=new q,b=new q,c=new q;return function(d,e,f,g){a.copy(d).add(e).multiplyScalar(.5);b.copy(e).sub(d).normalize();c.copy(this.origin).sub(a);var k=.5*d.distanceTo(e),l=-this.direction.dot(b),h=c.dot(this.direction),u=-c.dot(b),p=c.lengthSq(),n=Math.abs(1-l*l),r;0<n?(d=l*u-h,e=l*h-u,r=k*n,0<=d?e>=-r?e<=r?(k=1/n,d*=k,e*=k,l=d*(d+l*e+2*h)+e*(l*d+e+2*u)+p):(e=k,d=Math.max(0,-(l*
e+h)),l=-d*d+e*(e+2*u)+p):(e=-k,d=Math.max(0,-(l*e+h)),l=-d*d+e*(e+2*u)+p):e<=-r?(d=Math.max(0,-(-l*k+h)),e=0<d?-k:Math.min(Math.max(-k,-u),k),l=-d*d+e*(e+2*u)+p):e<=r?(d=0,e=Math.min(Math.max(-k,-u),k),l=e*(e+2*u)+p):(d=Math.max(0,-(l*k+h)),e=0<d?k:Math.min(Math.max(-k,-u),k),l=-d*d+e*(e+2*u)+p)):(e=0<l?-k:k,d=Math.max(0,-(l*e+h)),l=-d*d+e*(e+2*u)+p);f&&f.copy(this.direction).multiplyScalar(d).add(this.origin);g&&g.copy(b).multiplyScalar(e).add(a);return l}}(),intersectSphere:function(){var a=new q;
return function(b,c){a.subVectors(b.center,this.origin);var d=a.dot(this.direction),e=a.dot(a)-d*d,f=b.radius*b.radius;if(e>f)return null;f=Math.sqrt(f-e);e=d-f;d+=f;return 0>e&&0>d?null:0>e?this.at(d,c):this.at(e,c)}}(),intersectsSphere:function(a){return this.distanceToPoint(a.center)<=a.radius},distanceToPlane:function(a){var b=a.normal.dot(this.direction);if(0===b)return 0===a.distanceToPoint(this.origin)?0:null;a=-(this.origin.dot(a.normal)+a.constant)/b;return 0<=a?a:null},intersectPlane:function(a,
b){var c=this.distanceToPlane(a);return null===c?null:this.at(c,b)},intersectsPlane:function(a){var b=a.distanceToPoint(this.origin);return 0===b||0>a.normal.dot(this.direction)*b?!0:!1},intersectBox:function(a,b){var c,d,e,f,g;d=1/this.direction.x;f=1/this.direction.y;g=1/this.direction.z;var k=this.origin;0<=d?(c=(a.min.x-k.x)*d,d*=a.max.x-k.x):(c=(a.max.x-k.x)*d,d*=a.min.x-k.x);0<=f?(e=(a.min.y-k.y)*f,f*=a.max.y-k.y):(e=(a.max.y-k.y)*f,f*=a.min.y-k.y);if(c>f||e>d)return null;if(e>c||c!==c)c=e;
if(f<d||d!==d)d=f;0<=g?(e=(a.min.z-k.z)*g,g*=a.max.z-k.z):(e=(a.max.z-k.z)*g,g*=a.min.z-k.z);if(c>g||e>d)return null;if(e>c||c!==c)c=e;if(g<d||d!==d)d=g;return 0>d?null:this.at(0<=c?c:d,b)},intersectsBox:function(){var a=new q;return function(b){return null!==this.intersectBox(b,a)}}(),intersectTriangle:function(){var a=new q,b=new q,c=new q,d=new q;return function(e,f,g,k,l){b.subVectors(f,e);c.subVectors(g,e);d.crossVectors(b,c);f=this.direction.dot(d);if(0<f){if(k)return null;k=1}else if(0>f)k=
-1,f=-f;else return null;a.subVectors(this.origin,e);e=k*this.direction.dot(c.crossVectors(a,c));if(0>e)return null;g=k*this.direction.dot(b.cross(a));if(0>g||e+g>f)return null;e=-k*a.dot(d);return 0>e?null:this.at(e/f,l)}}(),applyMatrix4:function(a){this.direction.add(this.origin).applyMatrix4(a);this.origin.applyMatrix4(a);this.direction.sub(this.origin);this.direction.normalize();return this},equals:function(a){return a.origin.equals(this.origin)&&a.direction.equals(this.direction)}};Xa.RotationOrders=
"XYZ YZX ZXY XZY YXZ ZYX".split(" ");Xa.DefaultOrder="XYZ";Xa.prototype={constructor:Xa,isEuler:!0,get x(){return this._x},set x(a){this._x=a;this.onChangeCallback()},get y(){return this._y},set y(a){this._y=a;this.onChangeCallback()},get z(){return this._z},set z(a){this._z=a;this.onChangeCallback()},get order(){return this._order},set order(a){this._order=a;this.onChangeCallback()},set:function(a,b,c,d){this._x=a;this._y=b;this._z=c;this._order=d||this._order;this.onChangeCallback();return this},
clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(a){this._x=a._x;this._y=a._y;this._z=a._z;this._order=a._order;this.onChangeCallback();return this},setFromRotationMatrix:function(a,b,c){var d=h.Math.clamp,e=a.elements;a=e[0];var f=e[4],g=e[8],k=e[1],l=e[5],m=e[9],u=e[2],p=e[6],e=e[10];b=b||this._order;"XYZ"===b?(this._y=Math.asin(d(g,-1,1)),.99999>Math.abs(g)?(this._x=Math.atan2(-m,e),this._z=Math.atan2(-f,a)):(this._x=Math.atan2(p,l),this._z=0)):"YXZ"===
b?(this._x=Math.asin(-d(m,-1,1)),.99999>Math.abs(m)?(this._y=Math.atan2(g,e),this._z=Math.atan2(k,l)):(this._y=Math.atan2(-u,a),this._z=0)):"ZXY"===b?(this._x=Math.asin(d(p,-1,1)),.99999>Math.abs(p)?(this._y=Math.atan2(-u,e),this._z=Math.atan2(-f,l)):(this._y=0,this._z=Math.atan2(k,a))):"ZYX"===b?(this._y=Math.asin(-d(u,-1,1)),.99999>Math.abs(u)?(this._x=Math.atan2(p,e),this._z=Math.atan2(k,a)):(this._x=0,this._z=Math.atan2(-f,l))):"YZX"===b?(this._z=Math.asin(d(k,-1,1)),.99999>Math.abs(k)?(this._x=
Math.atan2(-m,l),this._y=Math.atan2(-u,a)):(this._x=0,this._y=Math.atan2(g,e))):"XZY"===b?(this._z=Math.asin(-d(f,-1,1)),.99999>Math.abs(f)?(this._x=Math.atan2(p,l),this._y=Math.atan2(g,a)):(this._x=Math.atan2(-m,e),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+b);this._order=b;if(!1!==c)this.onChangeCallback();return this},setFromQuaternion:function(){var a;return function(b,c,d){void 0===a&&(a=new P);a.makeRotationFromQuaternion(b);return this.setFromRotationMatrix(a,
c,d)}}(),setFromVector3:function(a,b){return this.set(a.x,a.y,a.z,b||this._order)},reorder:function(){var a=new ca;return function(b){a.setFromEuler(this);return this.setFromQuaternion(a,b)}}(),equals:function(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._order===this._order},fromArray:function(a){this._x=a[0];this._y=a[1];this._z=a[2];void 0!==a[3]&&(this._order=a[3]);this.onChangeCallback();return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this._x;a[b+1]=
this._y;a[b+2]=this._z;a[b+3]=this._order;return a},toVector3:function(a){return a?a.set(this._x,this._y,this._z):new q(this._x,this._y,this._z)},onChange:function(a){this.onChangeCallback=a;return this},onChangeCallback:function(){}};Kc.prototype={constructor:Kc,set:function(a){this.mask=1<<a},enable:function(a){this.mask|=1<<a},toggle:function(a){this.mask^=1<<a},disable:function(a){this.mask&=~(1<<a)},test:function(a){return 0!==(this.mask&a.mask)}};D.DefaultUp=new q(0,1,0);D.DefaultMatrixAutoUpdate=
!0;Object.assign(D.prototype,pa.prototype,{isObject3D:!0,applyMatrix:function(a){this.matrix.multiplyMatrices(a,this.matrix);this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(a,b){this.quaternion.setFromAxisAngle(a,b)},setRotationFromEuler:function(a){this.quaternion.setFromEuler(a,!0)},setRotationFromMatrix:function(a){this.quaternion.setFromRotationMatrix(a)},setRotationFromQuaternion:function(a){this.quaternion.copy(a)},rotateOnAxis:function(){var a=
new ca;return function(b,c){a.setFromAxisAngle(b,c);this.quaternion.multiply(a);return this}}(),rotateX:function(){var a=new q(1,0,0);return function(b){return this.rotateOnAxis(a,b)}}(),rotateY:function(){var a=new q(0,1,0);return function(b){return this.rotateOnAxis(a,b)}}(),rotateZ:function(){var a=new q(0,0,1);return function(b){return this.rotateOnAxis(a,b)}}(),translateOnAxis:function(){var a=new q;return function(b,c){a.copy(b).applyQuaternion(this.quaternion);this.position.add(a.multiplyScalar(c));
return this}}(),translateX:function(){var a=new q(1,0,0);return function(b){return this.translateOnAxis(a,b)}}(),translateY:function(){var a=new q(0,1,0);return function(b){return this.translateOnAxis(a,b)}}(),translateZ:function(){var a=new q(0,0,1);return function(b){return this.translateOnAxis(a,b)}}(),localToWorld:function(a){return a.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var a=new P;return function(b){return b.applyMatrix4(a.getInverse(this.matrixWorld))}}(),lookAt:function(){var a=
new P;return function(b){a.lookAt(b,this.position,this.up);this.quaternion.setFromRotationMatrix(a)}}(),add:function(a){if(1<arguments.length){for(var b=0;b<arguments.length;b++)this.add(arguments[b]);return this}if(a===this)return console.error("THREE.Object3D.add: object can't be added as a child of itself.",a),this;a&&a.isObject3D?(null!==a.parent&&a.parent.remove(a),a.parent=this,a.dispatchEvent({type:"added"}),this.children.push(a)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",
a);return this},remove:function(a){if(1<arguments.length)for(var b=0;b<arguments.length;b++)this.remove(arguments[b]);b=this.children.indexOf(a);-1!==b&&(a.parent=null,a.dispatchEvent({type:"removed"}),this.children.splice(b,1))},getObjectById:function(a){return this.getObjectByProperty("id",a)},getObjectByName:function(a){return this.getObjectByProperty("name",a)},getObjectByProperty:function(a,b){if(this[a]===b)return this;for(var c=0,d=this.children.length;c<d;c++){var e=this.children[c].getObjectByProperty(a,
b);if(void 0!==e)return e}},getWorldPosition:function(a){a=a||new q;this.updateMatrixWorld(!0);return a.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var a=new q,b=new q;return function(c){c=c||new ca;this.updateMatrixWorld(!0);this.matrixWorld.decompose(a,c,b);return c}}(),getWorldRotation:function(){var a=new ca;return function(b){b=b||new Xa;this.getWorldQuaternion(a);return b.setFromQuaternion(a,this.rotation.order,!1)}}(),getWorldScale:function(){var a=new q,b=new ca;
return function(c){c=c||new q;this.updateMatrixWorld(!0);this.matrixWorld.decompose(a,b,c);return c}}(),getWorldDirection:function(){var a=new ca;return function(b){b=b||new q;this.getWorldQuaternion(a);return b.set(0,0,1).applyQuaternion(a)}}(),raycast:function(){},traverse:function(a){a(this);for(var b=this.children,c=0,d=b.length;c<d;c++)b[c].traverse(a)},traverseVisible:function(a){if(!1!==this.visible){a(this);for(var b=this.children,c=0,d=b.length;c<d;c++)b[c].traverseVisible(a)}},traverseAncestors:function(a){var b=
this.parent;null!==b&&(a(b),b.traverseAncestors(a))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale);this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(a){!0===this.matrixAutoUpdate&&this.updateMatrix();if(!0===this.matrixWorldNeedsUpdate||!0===a)null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,a=!0;for(var b=this.children,c=0,d=b.length;c<d;c++)b[c].updateMatrixWorld(a)},
toJSON:function(a){function b(a){var b=[],c;for(c in a){var d=a[c];delete d.metadata;b.push(d)}return b}var c=void 0===a||""===a,d={};c&&(a={geometries:{},materials:{},textures:{},images:{}},d.metadata={version:4.4,type:"Object",generator:"Object3D.toJSON"});var e={};e.uuid=this.uuid;e.type=this.type;""!==this.name&&(e.name=this.name);"{}"!==JSON.stringify(this.userData)&&(e.userData=this.userData);!0===this.castShadow&&(e.castShadow=!0);!0===this.receiveShadow&&(e.receiveShadow=!0);!1===this.visible&&
(e.visible=!1);e.matrix=this.matrix.toArray();void 0!==this.geometry&&(void 0===a.geometries[this.geometry.uuid]&&(a.geometries[this.geometry.uuid]=this.geometry.toJSON(a)),e.geometry=this.geometry.uuid);void 0!==this.material&&(void 0===a.materials[this.material.uuid]&&(a.materials[this.material.uuid]=this.material.toJSON(a)),e.material=this.material.uuid);if(0<this.children.length){e.children=[];for(var f=0;f<this.children.length;f++)e.children.push(this.children[f].toJSON(a).object)}if(c){var c=
b(a.geometries),f=b(a.materials),g=b(a.textures);a=b(a.images);0<c.length&&(d.geometries=c);0<f.length&&(d.materials=f);0<g.length&&(d.textures=g);0<a.length&&(d.images=a)}d.object=e;return d},clone:function(a){return(new this.constructor).copy(this,a)},copy:function(a,b){void 0===b&&(b=!0);this.name=a.name;this.up.copy(a.up);this.position.copy(a.position);this.quaternion.copy(a.quaternion);this.scale.copy(a.scale);this.matrix.copy(a.matrix);this.matrixWorld.copy(a.matrixWorld);this.matrixAutoUpdate=
a.matrixAutoUpdate;this.matrixWorldNeedsUpdate=a.matrixWorldNeedsUpdate;this.visible=a.visible;this.castShadow=a.castShadow;this.receiveShadow=a.receiveShadow;this.frustumCulled=a.frustumCulled;this.renderOrder=a.renderOrder;this.userData=JSON.parse(JSON.stringify(a.userData));if(!0===b)for(var c=0;c<a.children.length;c++)this.add(a.children[c].clone());return this}});var ae=0;cb.prototype={constructor:cb,set:function(a,b){this.start.copy(a);this.end.copy(b);return this},clone:function(){return(new this.constructor).copy(this)},
copy:function(a){this.start.copy(a.start);this.end.copy(a.end);return this},getCenter:function(a){return(a||new q).addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(a){return(a||new q).subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(a,b){var c=b||new q;return this.delta(c).multiplyScalar(a).add(this.start)},closestPointToPointParameter:function(){var a=new q,
b=new q;return function(c,d){a.subVectors(c,this.start);b.subVectors(this.end,this.start);var e=b.dot(b),e=b.dot(a)/e;d&&(e=h.Math.clamp(e,0,1));return e}}(),closestPointToPoint:function(a,b,c){a=this.closestPointToPointParameter(a,b);c=c||new q;return this.delta(c).multiplyScalar(a).add(this.start)},applyMatrix4:function(a){this.start.applyMatrix4(a);this.end.applyMatrix4(a);return this},equals:function(a){return a.start.equals(this.start)&&a.end.equals(this.end)}};Fa.normal=function(){var a=new q;
return function(b,c,d,e){e=e||new q;e.subVectors(d,c);a.subVectors(b,c);e.cross(a);b=e.lengthSq();return 0<b?e.multiplyScalar(1/Math.sqrt(b)):e.set(0,0,0)}}();Fa.barycoordFromPoint=function(){var a=new q,b=new q,c=new q;return function(d,e,f,g,k){a.subVectors(g,e);b.subVectors(f,e);c.subVectors(d,e);d=a.dot(a);e=a.dot(b);f=a.dot(c);var l=b.dot(b);g=b.dot(c);var h=d*l-e*e;k=k||new q;if(0===h)return k.set(-2,-1,-1);h=1/h;l=(l*f-e*g)*h;d=(d*g-e*f)*h;return k.set(1-l-d,d,l)}}();Fa.containsPoint=function(){var a=
new q;return function(b,c,d,e){b=Fa.barycoordFromPoint(b,c,d,e,a);return 0<=b.x&&0<=b.y&&1>=b.x+b.y}}();Fa.prototype={constructor:Fa,set:function(a,b,c){this.a.copy(a);this.b.copy(b);this.c.copy(c);return this},setFromPointsAndIndices:function(a,b,c,d){this.a.copy(a[b]);this.b.copy(a[c]);this.c.copy(a[d]);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.a.copy(a.a);this.b.copy(a.b);this.c.copy(a.c);return this},area:function(){var a=new q,b=new q;return function(){a.subVectors(this.c,
this.b);b.subVectors(this.a,this.b);return.5*a.cross(b).length()}}(),midpoint:function(a){return(a||new q).addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(a){return Fa.normal(this.a,this.b,this.c,a)},plane:function(a){return(a||new fa).setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(a,b){return Fa.barycoordFromPoint(a,this.a,this.b,this.c,b)},containsPoint:function(a){return Fa.containsPoint(a,this.a,this.b,this.c)},closestPointToPoint:function(){var a,
b,c,d;return function(e,f){void 0===a&&(a=new fa,b=[new cb,new cb,new cb],c=new q,d=new q);var g=f||new q,k=Infinity;a.setFromCoplanarPoints(this.a,this.b,this.c);a.projectPoint(e,c);if(!0===this.containsPoint(c))g.copy(c);else{b[0].set(this.a,this.b);b[1].set(this.b,this.c);b[2].set(this.c,this.a);for(var l=0;l<b.length;l++){b[l].closestPointToPoint(c,!0,d);var h=c.distanceToSquared(d);h<k&&(k=h,g.copy(d))}}return g}}(),equals:function(a){return a.a.equals(this.a)&&a.b.equals(this.b)&&a.c.equals(this.c)}};
ga.prototype={constructor:ga,clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.a=a.a;this.b=a.b;this.c=a.c;this.normal.copy(a.normal);this.color.copy(a.color);this.materialIndex=a.materialIndex;for(var b=0,c=a.vertexNormals.length;b<c;b++)this.vertexNormals[b]=a.vertexNormals[b].clone();b=0;for(c=a.vertexColors.length;b<c;b++)this.vertexColors[b]=a.vertexColors[b].clone();return this}};Ia.prototype=Object.create(S.prototype);Ia.prototype.constructor=Ia;Ia.prototype.isMeshBasicMaterial=
!0;Ia.prototype.copy=function(a){S.prototype.copy.call(this,a);this.color.copy(a.color);this.map=a.map;this.aoMap=a.aoMap;this.aoMapIntensity=a.aoMapIntensity;this.specularMap=a.specularMap;this.alphaMap=a.alphaMap;this.envMap=a.envMap;this.combine=a.combine;this.reflectivity=a.reflectivity;this.refractionRatio=a.refractionRatio;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.wireframeLinecap=a.wireframeLinecap;this.wireframeLinejoin=a.wireframeLinejoin;this.skinning=
a.skinning;this.morphTargets=a.morphTargets;return this};z.prototype={constructor:z,isBufferAttribute:!0,set needsUpdate(a){!0===a&&this.version++},setDynamic:function(a){this.dynamic=a;return this},copy:function(a){this.array=new a.array.constructor(a.array);this.itemSize=a.itemSize;this.count=a.count;this.normalized=a.normalized;this.dynamic=a.dynamic;return this},copyAt:function(a,b,c){a*=this.itemSize;c*=b.itemSize;for(var d=0,e=this.itemSize;d<e;d++)this.array[a+d]=b.array[c+d];return this},
copyArray:function(a){this.array.set(a);return this},copyColorsArray:function(a){for(var b=this.array,c=0,d=0,e=a.length;d<e;d++){var f=a[d];void 0===f&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",d),f=new H);b[c++]=f.r;b[c++]=f.g;b[c++]=f.b}return this},copyIndicesArray:function(a){for(var b=this.array,c=0,d=0,e=a.length;d<e;d++){var f=a[d];b[c++]=f.a;b[c++]=f.b;b[c++]=f.c}return this},copyVector2sArray:function(a){for(var b=this.array,c=0,d=0,e=a.length;d<e;d++){var f=
a[d];void 0===f&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",d),f=new C);b[c++]=f.x;b[c++]=f.y}return this},copyVector3sArray:function(a){for(var b=this.array,c=0,d=0,e=a.length;d<e;d++){var f=a[d];void 0===f&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",d),f=new q);b[c++]=f.x;b[c++]=f.y;b[c++]=f.z}return this},copyVector4sArray:function(a){for(var b=this.array,c=0,d=0,e=a.length;d<e;d++){var f=a[d];void 0===f&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",
d),f=new da);b[c++]=f.x;b[c++]=f.y;b[c++]=f.z;b[c++]=f.w}return this},set:function(a,b){void 0===b&&(b=0);this.array.set(a,b);return this},getX:function(a){return this.array[a*this.itemSize]},setX:function(a,b){this.array[a*this.itemSize]=b;return this},getY:function(a){return this.array[a*this.itemSize+1]},setY:function(a,b){this.array[a*this.itemSize+1]=b;return this},getZ:function(a){return this.array[a*this.itemSize+2]},setZ:function(a,b){this.array[a*this.itemSize+2]=b;return this},getW:function(a){return this.array[a*
this.itemSize+3]},setW:function(a,b){this.array[a*this.itemSize+3]=b;return this},setXY:function(a,b,c){a*=this.itemSize;this.array[a+0]=b;this.array[a+1]=c;return this},setXYZ:function(a,b,c,d){a*=this.itemSize;this.array[a+0]=b;this.array[a+1]=c;this.array[a+2]=d;return this},setXYZW:function(a,b,c,d,e){a*=this.itemSize;this.array[a+0]=b;this.array[a+1]=c;this.array[a+2]=d;this.array[a+3]=e;return this},clone:function(){return(new this.constructor).copy(this)}};Object.assign(R.prototype,pa.prototype,
{isGeometry:!0,applyMatrix:function(a){for(var b=(new ya).getNormalMatrix(a),c=0,d=this.vertices.length;c<d;c++)this.vertices[c].applyMatrix4(a);c=0;for(d=this.faces.length;c<d;c++){a=this.faces[c];a.normal.applyMatrix3(b).normalize();for(var e=0,f=a.vertexNormals.length;e<f;e++)a.vertexNormals[e].applyMatrix3(b).normalize()}null!==this.boundingBox&&this.computeBoundingBox();null!==this.boundingSphere&&this.computeBoundingSphere();this.normalsNeedUpdate=this.verticesNeedUpdate=!0;return this},rotateX:function(){var a;
return function(b){void 0===a&&(a=new P);a.makeRotationX(b);this.applyMatrix(a);return this}}(),rotateY:function(){var a;return function(b){void 0===a&&(a=new P);a.makeRotationY(b);this.applyMatrix(a);return this}}(),rotateZ:function(){var a;return function(b){void 0===a&&(a=new P);a.makeRotationZ(b);this.applyMatrix(a);return this}}(),translate:function(){var a;return function(b,c,d){void 0===a&&(a=new P);a.makeTranslation(b,c,d);this.applyMatrix(a);return this}}(),scale:function(){var a;return function(b,
c,d){void 0===a&&(a=new P);a.makeScale(b,c,d);this.applyMatrix(a);return this}}(),lookAt:function(){var a;return function(b){void 0===a&&(a=new D);a.lookAt(b);a.updateMatrix();this.applyMatrix(a.matrix)}}(),fromBufferGeometry:function(a){function b(a,b,d,e){var f=void 0!==g?[u[a].clone(),u[b].clone(),u[d].clone()]:[],r=void 0!==k?[c.colors[a].clone(),c.colors[b].clone(),c.colors[d].clone()]:[];e=new ga(a,b,d,f,r,e);c.faces.push(e);void 0!==l&&c.faceVertexUvs[0].push([p[a].clone(),p[b].clone(),p[d].clone()]);
void 0!==h&&c.faceVertexUvs[1].push([n[a].clone(),n[b].clone(),n[d].clone()])}var c=this,d=null!==a.index?a.index.array:void 0,e=a.attributes,f=e.position.array,g=void 0!==e.normal?e.normal.array:void 0,k=void 0!==e.color?e.color.array:void 0,l=void 0!==e.uv?e.uv.array:void 0,h=void 0!==e.uv2?e.uv2.array:void 0;void 0!==h&&(this.faceVertexUvs[1]=[]);for(var u=[],p=[],n=[],r=e=0;e<f.length;e+=3,r+=2)c.vertices.push(new q(f[e],f[e+1],f[e+2])),void 0!==g&&u.push(new q(g[e],g[e+1],g[e+2])),void 0!==k&&
c.colors.push(new H(k[e],k[e+1],k[e+2])),void 0!==l&&p.push(new C(l[r],l[r+1])),void 0!==h&&n.push(new C(h[r],h[r+1]));if(void 0!==d)if(f=a.groups,0<f.length)for(e=0;e<f.length;e++)for(var t=f[e],v=t.start,A=t.count,r=v,v=v+A;r<v;r+=3)b(d[r],d[r+1],d[r+2],t.materialIndex);else for(e=0;e<d.length;e+=3)b(d[e],d[e+1],d[e+2]);else for(e=0;e<f.length/3;e+=3)b(e,e+1,e+2);this.computeFaceNormals();null!==a.boundingBox&&(this.boundingBox=a.boundingBox.clone());null!==a.boundingSphere&&(this.boundingSphere=
a.boundingSphere.clone());return this},center:function(){this.computeBoundingBox();var a=this.boundingBox.getCenter().negate();this.translate(a.x,a.y,a.z);return a},normalize:function(){this.computeBoundingSphere();var a=this.boundingSphere.center,b=this.boundingSphere.radius,b=0===b?1:1/b,c=new P;c.set(b,0,0,-b*a.x,0,b,0,-b*a.y,0,0,b,-b*a.z,0,0,0,1);this.applyMatrix(c);return this},computeFaceNormals:function(){for(var a=new q,b=new q,c=0,d=this.faces.length;c<d;c++){var e=this.faces[c],f=this.vertices[e.a],
g=this.vertices[e.b];a.subVectors(this.vertices[e.c],g);b.subVectors(f,g);a.cross(b);a.normalize();e.normal.copy(a)}},computeVertexNormals:function(a){void 0===a&&(a=!0);var b,c,d;d=Array(this.vertices.length);b=0;for(c=this.vertices.length;b<c;b++)d[b]=new q;if(a){var e,f,g,k=new q,l=new q;a=0;for(b=this.faces.length;a<b;a++)c=this.faces[a],e=this.vertices[c.a],f=this.vertices[c.b],g=this.vertices[c.c],k.subVectors(g,f),l.subVectors(e,f),k.cross(l),d[c.a].add(k),d[c.b].add(k),d[c.c].add(k)}else for(a=
0,b=this.faces.length;a<b;a++)c=this.faces[a],d[c.a].add(c.normal),d[c.b].add(c.normal),d[c.c].add(c.normal);b=0;for(c=this.vertices.length;b<c;b++)d[b].normalize();a=0;for(b=this.faces.length;a<b;a++)c=this.faces[a],e=c.vertexNormals,3===e.length?(e[0].copy(d[c.a]),e[1].copy(d[c.b]),e[2].copy(d[c.c])):(e[0]=d[c.a].clone(),e[1]=d[c.b].clone(),e[2]=d[c.c].clone());0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var a,b,c,d,e;c=0;for(d=this.faces.length;c<d;c++)for(e=
this.faces[c],e.__originalFaceNormal?e.__originalFaceNormal.copy(e.normal):e.__originalFaceNormal=e.normal.clone(),e.__originalVertexNormals||(e.__originalVertexNormals=[]),a=0,b=e.vertexNormals.length;a<b;a++)e.__originalVertexNormals[a]?e.__originalVertexNormals[a].copy(e.vertexNormals[a]):e.__originalVertexNormals[a]=e.vertexNormals[a].clone();var f=new R;f.faces=this.faces;a=0;for(b=this.morphTargets.length;a<b;a++){if(!this.morphNormals[a]){this.morphNormals[a]={};this.morphNormals[a].faceNormals=
[];this.morphNormals[a].vertexNormals=[];e=this.morphNormals[a].faceNormals;var g=this.morphNormals[a].vertexNormals,k,l;c=0;for(d=this.faces.length;c<d;c++)k=new q,l={a:new q,b:new q,c:new q},e.push(k),g.push(l)}g=this.morphNormals[a];f.vertices=this.morphTargets[a].vertices;f.computeFaceNormals();f.computeVertexNormals();c=0;for(d=this.faces.length;c<d;c++)e=this.faces[c],k=g.faceNormals[c],l=g.vertexNormals[c],k.copy(e.normal),l.a.copy(e.vertexNormals[0]),l.b.copy(e.vertexNormals[1]),l.c.copy(e.vertexNormals[2])}c=
0;for(d=this.faces.length;c<d;c++)e=this.faces[c],e.normal=e.__originalFaceNormal,e.vertexNormals=e.__originalVertexNormals},computeTangents:function(){console.warn("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){for(var a=0,b=this.vertices,c=0,d=b.length;c<d;c++)0<c&&(a+=b[c].distanceTo(b[c-1])),this.lineDistances[c]=a},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Ha);this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===
this.boundingSphere&&(this.boundingSphere=new Aa);this.boundingSphere.setFromPoints(this.vertices)},merge:function(a,b,c){if(!1===(a&&a.isGeometry))console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",a);else{var d,e=this.vertices.length,f=this.vertices,g=a.vertices,k=this.faces,l=a.faces,h=this.faceVertexUvs[0],u=a.faceVertexUvs[0],p=this.colors,n=a.colors;void 0===c&&(c=0);void 0!==b&&(d=(new ya).getNormalMatrix(b));a=0;for(var r=g.length;a<r;a++){var t=g[a].clone();
void 0!==b&&t.applyMatrix4(b);f.push(t)}a=0;for(r=n.length;a<r;a++)p.push(n[a].clone());a=0;for(r=l.length;a<r;a++){var g=l[a],q=g.vertexNormals,n=g.vertexColors,p=new ga(g.a+e,g.b+e,g.c+e);p.normal.copy(g.normal);void 0!==d&&p.normal.applyMatrix3(d).normalize();b=0;for(f=q.length;b<f;b++)t=q[b].clone(),void 0!==d&&t.applyMatrix3(d).normalize(),p.vertexNormals.push(t);p.color.copy(g.color);b=0;for(f=n.length;b<f;b++)t=n[b],p.vertexColors.push(t.clone());p.materialIndex=g.materialIndex+c;k.push(p)}a=
0;for(r=u.length;a<r;a++)if(c=u[a],d=[],void 0!==c){b=0;for(f=c.length;b<f;b++)d.push(c[b].clone());h.push(d)}}},mergeMesh:function(a){!1===(a&&a.isMesh)?console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",a):(a.matrixAutoUpdate&&a.updateMatrix(),this.merge(a.geometry,a.matrix))},mergeVertices:function(){var a={},b=[],c=[],d,e=Math.pow(10,4),f,g;f=0;for(g=this.vertices.length;f<g;f++)d=this.vertices[f],d=Math.round(d.x*e)+"_"+Math.round(d.y*e)+"_"+Math.round(d.z*e),void 0===
a[d]?(a[d]=f,b.push(this.vertices[f]),c[f]=b.length-1):c[f]=c[a[d]];a=[];f=0;for(g=this.faces.length;f<g;f++)for(e=this.faces[f],e.a=c[e.a],e.b=c[e.b],e.c=c[e.c],e=[e.a,e.b,e.c],d=0;3>d;d++)if(e[d]===e[(d+1)%3]){a.push(f);break}for(f=a.length-1;0<=f;f--)for(e=a[f],this.faces.splice(e,1),c=0,g=this.faceVertexUvs.length;c<g;c++)this.faceVertexUvs[c].splice(e,1);f=this.vertices.length-b.length;this.vertices=b;return f},sortFacesByMaterialIndex:function(){for(var a=this.faces,b=a.length,c=0;c<b;c++)a[c]._id=
c;a.sort(function(a,b){return a.materialIndex-b.materialIndex});var d=this.faceVertexUvs[0],e=this.faceVertexUvs[1],f,g;d&&d.length===b&&(f=[]);e&&e.length===b&&(g=[]);for(c=0;c<b;c++){var k=a[c]._id;f&&f.push(d[k]);g&&g.push(e[k])}f&&(this.faceVertexUvs[0]=f);g&&(this.faceVertexUvs[1]=g)},toJSON:function(){function a(a,b,c){return c?a|1<<b:a&~(1<<b)}function b(a){var b=a.x.toString()+a.y.toString()+a.z.toString();if(void 0!==h[b])return h[b];h[b]=l.length/3;l.push(a.x,a.y,a.z);return h[b]}function c(a){var b=
a.r.toString()+a.g.toString()+a.b.toString();if(void 0!==p[b])return p[b];p[b]=u.length;u.push(a.getHex());return p[b]}function d(a){var b=a.x.toString()+a.y.toString();if(void 0!==r[b])return r[b];r[b]=n.length/2;n.push(a.x,a.y);return r[b]}var e={metadata:{version:4.4,type:"Geometry",generator:"Geometry.toJSON"}};e.uuid=this.uuid;e.type=this.type;""!==this.name&&(e.name=this.name);if(void 0!==this.parameters){var f=this.parameters,g;for(g in f)void 0!==f[g]&&(e[g]=f[g]);return e}f=[];for(g=0;g<
this.vertices.length;g++){var k=this.vertices[g];f.push(k.x,k.y,k.z)}var k=[],l=[],h={},u=[],p={},n=[],r={};for(g=0;g<this.faces.length;g++){var t=this.faces[g],q=void 0!==this.faceVertexUvs[0][g],A=0<t.normal.length(),w=0<t.vertexNormals.length,x=1!==t.color.r||1!==t.color.g||1!==t.color.b,T=0<t.vertexColors.length,y=0,y=a(y,0,0),y=a(y,1,!0),y=a(y,2,!1),y=a(y,3,q),y=a(y,4,A),y=a(y,5,w),y=a(y,6,x),y=a(y,7,T);k.push(y);k.push(t.a,t.b,t.c);k.push(t.materialIndex);q&&(q=this.faceVertexUvs[0][g],k.push(d(q[0]),
d(q[1]),d(q[2])));A&&k.push(b(t.normal));w&&(A=t.vertexNormals,k.push(b(A[0]),b(A[1]),b(A[2])));x&&k.push(c(t.color));T&&(t=t.vertexColors,k.push(c(t[0]),c(t[1]),c(t[2])))}e.data={};e.data.vertices=f;e.data.normals=l;0<u.length&&(e.data.colors=u);0<n.length&&(e.data.uvs=[n]);e.data.faces=k;return e},clone:function(){return(new R).copy(this)},copy:function(a){this.vertices=[];this.faces=[];this.faceVertexUvs=[[]];this.colors=[];for(var b=a.vertices,c=0,d=b.length;c<d;c++)this.vertices.push(b[c].clone());
b=a.colors;c=0;for(d=b.length;c<d;c++)this.colors.push(b[c].clone());b=a.faces;c=0;for(d=b.length;c<d;c++)this.faces.push(b[c].clone());c=0;for(d=a.faceVertexUvs.length;c<d;c++){b=a.faceVertexUvs[c];void 0===this.faceVertexUvs[c]&&(this.faceVertexUvs[c]=[]);for(var e=0,f=b.length;e<f;e++){for(var g=b[e],k=[],l=0,h=g.length;l<h;l++)k.push(g[l].clone());this.faceVertexUvs[c].push(k)}}return this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var Lc=0;Object.assign(de.prototype,pa.prototype,
{computeBoundingBox:R.prototype.computeBoundingBox,computeBoundingSphere:R.prototype.computeBoundingSphere,computeFaceNormals:function(){console.warn("THREE.DirectGeometry: computeFaceNormals() is not a method of this type of geometry.")},computeVertexNormals:function(){console.warn("THREE.DirectGeometry: computeVertexNormals() is not a method of this type of geometry.")},computeGroups:function(a){var b,c=[],d;a=a.faces;for(var e=0;e<a.length;e++){var f=a[e];f.materialIndex!==d&&(d=f.materialIndex,
void 0!==b&&(b.count=3*e-b.start,c.push(b)),b={start:3*e,materialIndex:d})}void 0!==b&&(b.count=3*e-b.start,c.push(b));this.groups=c},fromGeometry:function(a){var b=a.faces,c=a.vertices,d=a.faceVertexUvs,e=d[0]&&0<d[0].length,f=d[1]&&0<d[1].length,g=a.morphTargets,k=g.length,l;if(0<k){l=[];for(var h=0;h<k;h++)l[h]=[];this.morphTargets.position=l}var u=a.morphNormals,p=u.length,n;if(0<p){n=[];for(h=0;h<p;h++)n[h]=[];this.morphTargets.normal=n}for(var r=a.skinIndices,t=a.skinWeights,q=r.length===c.length,
A=t.length===c.length,h=0;h<b.length;h++){var w=b[h];this.vertices.push(c[w.a],c[w.b],c[w.c]);var x=w.vertexNormals;3===x.length?this.normals.push(x[0],x[1],x[2]):(x=w.normal,this.normals.push(x,x,x));x=w.vertexColors;3===x.length?this.colors.push(x[0],x[1],x[2]):(x=w.color,this.colors.push(x,x,x));!0===e&&(x=d[0][h],void 0!==x?this.uvs.push(x[0],x[1],x[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",h),this.uvs.push(new C,new C,new C)));!0===f&&(x=d[1][h],void 0!==x?
this.uvs2.push(x[0],x[1],x[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",h),this.uvs2.push(new C,new C,new C)));for(x=0;x<k;x++){var T=g[x].vertices;l[x].push(T[w.a],T[w.b],T[w.c])}for(x=0;x<p;x++)T=u[x].vertexNormals[h],n[x].push(T.a,T.b,T.c);q&&this.skinIndices.push(r[w.a],r[w.b],r[w.c]);A&&this.skinWeights.push(t[w.a],t[w.b],t[w.c])}this.computeGroups(a);this.verticesNeedUpdate=a.verticesNeedUpdate;this.normalsNeedUpdate=a.normalsNeedUpdate;this.colorsNeedUpdate=
a.colorsNeedUpdate;this.uvsNeedUpdate=a.uvsNeedUpdate;this.groupsNeedUpdate=a.groupsNeedUpdate;return this},dispose:function(){this.dispatchEvent({type:"dispose"})}});Object.assign(I.prototype,pa.prototype,{isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(a){this.index=a},addAttribute:function(a,b,c){if(!1===(b&&b.isBufferAttribute)&&!1===(b&&b.isInterleavedBufferAttribute))console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.addAttribute(a,
new z(b,c));else if("index"===a)console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(b);else return this.attributes[a]=b,this},getAttribute:function(a){return this.attributes[a]},removeAttribute:function(a){delete this.attributes[a];return this},addGroup:function(a,b,c){this.groups.push({start:a,count:b,materialIndex:void 0!==c?c:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(a,b){this.drawRange.start=a;this.drawRange.count=b},applyMatrix:function(a){var b=
this.attributes.position;void 0!==b&&(a.applyToVector3Array(b.array),b.needsUpdate=!0);b=this.attributes.normal;void 0!==b&&((new ya).getNormalMatrix(a).applyToVector3Array(b.array),b.needsUpdate=!0);null!==this.boundingBox&&this.computeBoundingBox();null!==this.boundingSphere&&this.computeBoundingSphere();return this},rotateX:function(){var a;return function(b){void 0===a&&(a=new P);a.makeRotationX(b);this.applyMatrix(a);return this}}(),rotateY:function(){var a;return function(b){void 0===a&&(a=
new P);a.makeRotationY(b);this.applyMatrix(a);return this}}(),rotateZ:function(){var a;return function(b){void 0===a&&(a=new P);a.makeRotationZ(b);this.applyMatrix(a);return this}}(),translate:function(){var a;return function(b,c,d){void 0===a&&(a=new P);a.makeTranslation(b,c,d);this.applyMatrix(a);return this}}(),scale:function(){var a;return function(b,c,d){void 0===a&&(a=new P);a.makeScale(b,c,d);this.applyMatrix(a);return this}}(),lookAt:function(){var a;return function(b){void 0===a&&(a=new D);
a.lookAt(b);a.updateMatrix();this.applyMatrix(a.matrix)}}(),center:function(){this.computeBoundingBox();var a=this.boundingBox.getCenter().negate();this.translate(a.x,a.y,a.z);return a},setFromObject:function(a){var b=a.geometry;if(a&&a.isPoints||a&&a.isLine){a=new ma(3*b.vertices.length,3);var c=new ma(3*b.colors.length,3);this.addAttribute("position",a.copyVector3sArray(b.vertices));this.addAttribute("color",c.copyColorsArray(b.colors));b.lineDistances&&b.lineDistances.length===b.vertices.length&&
(a=new ma(b.lineDistances.length,1),this.addAttribute("lineDistance",a.copyArray(b.lineDistances)));null!==b.boundingSphere&&(this.boundingSphere=b.boundingSphere.clone());null!==b.boundingBox&&(this.boundingBox=b.boundingBox.clone())}else a&&a.isMesh&&b&&b.isGeometry&&this.fromGeometry(b);return this},updateFromObject:function(a){var b=a.geometry;if(a&&a.isMesh){var c=b.__directGeometry;!0===b.elementsNeedUpdate&&(c=void 0,b.elementsNeedUpdate=!1);if(void 0===c)return this.fromGeometry(b);c.verticesNeedUpdate=
b.verticesNeedUpdate;c.normalsNeedUpdate=b.normalsNeedUpdate;c.colorsNeedUpdate=b.colorsNeedUpdate;c.uvsNeedUpdate=b.uvsNeedUpdate;c.groupsNeedUpdate=b.groupsNeedUpdate;b.verticesNeedUpdate=!1;b.normalsNeedUpdate=!1;b.colorsNeedUpdate=!1;b.uvsNeedUpdate=!1;b.groupsNeedUpdate=!1;b=c}!0===b.verticesNeedUpdate&&(c=this.attributes.position,void 0!==c&&(c.copyVector3sArray(b.vertices),c.needsUpdate=!0),b.verticesNeedUpdate=!1);!0===b.normalsNeedUpdate&&(c=this.attributes.normal,void 0!==c&&(c.copyVector3sArray(b.normals),
c.needsUpdate=!0),b.normalsNeedUpdate=!1);!0===b.colorsNeedUpdate&&(c=this.attributes.color,void 0!==c&&(c.copyColorsArray(b.colors),c.needsUpdate=!0),b.colorsNeedUpdate=!1);b.uvsNeedUpdate&&(c=this.attributes.uv,void 0!==c&&(c.copyVector2sArray(b.uvs),c.needsUpdate=!0),b.uvsNeedUpdate=!1);b.lineDistancesNeedUpdate&&(c=this.attributes.lineDistance,void 0!==c&&(c.copyArray(b.lineDistances),c.needsUpdate=!0),b.lineDistancesNeedUpdate=!1);b.groupsNeedUpdate&&(b.computeGroups(a.geometry),this.groups=
b.groups,b.groupsNeedUpdate=!1);return this},fromGeometry:function(a){a.__directGeometry=(new de).fromGeometry(a);return this.fromDirectGeometry(a.__directGeometry)},fromDirectGeometry:function(a){var b=new Float32Array(3*a.vertices.length);this.addAttribute("position",(new z(b,3)).copyVector3sArray(a.vertices));0<a.normals.length&&(b=new Float32Array(3*a.normals.length),this.addAttribute("normal",(new z(b,3)).copyVector3sArray(a.normals)));0<a.colors.length&&(b=new Float32Array(3*a.colors.length),
this.addAttribute("color",(new z(b,3)).copyColorsArray(a.colors)));0<a.uvs.length&&(b=new Float32Array(2*a.uvs.length),this.addAttribute("uv",(new z(b,2)).copyVector2sArray(a.uvs)));0<a.uvs2.length&&(b=new Float32Array(2*a.uvs2.length),this.addAttribute("uv2",(new z(b,2)).copyVector2sArray(a.uvs2)));0<a.indices.length&&(b=new (65535<a.vertices.length?Uint32Array:Uint16Array)(3*a.indices.length),this.setIndex((new z(b,1)).copyIndicesArray(a.indices)));this.groups=a.groups;for(var c in a.morphTargets){for(var b=
[],d=a.morphTargets[c],e=0,f=d.length;e<f;e++){var g=d[e],k=new ma(3*g.length,3);b.push(k.copyVector3sArray(g))}this.morphAttributes[c]=b}0<a.skinIndices.length&&(c=new ma(4*a.skinIndices.length,4),this.addAttribute("skinIndex",c.copyVector4sArray(a.skinIndices)));0<a.skinWeights.length&&(c=new ma(4*a.skinWeights.length,4),this.addAttribute("skinWeight",c.copyVector4sArray(a.skinWeights)));null!==a.boundingSphere&&(this.boundingSphere=a.boundingSphere.clone());null!==a.boundingBox&&(this.boundingBox=
a.boundingBox.clone());return this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Ha);var a=this.attributes.position.array;void 0!==a?this.boundingBox.setFromArray(a):this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){var a=
new Ha,b=new q;return function(){null===this.boundingSphere&&(this.boundingSphere=new Aa);var c=this.attributes.position;if(c){var c=c.array,d=this.boundingSphere.center;a.setFromArray(c);a.getCenter(d);for(var e=0,f=0,g=c.length;f<g;f+=3)b.fromArray(c,f),e=Math.max(e,d.distanceToSquared(b));this.boundingSphere.radius=Math.sqrt(e);isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',
this)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var a=this.index,b=this.attributes,c=this.groups;if(b.position){var d=b.position.array;if(void 0===b.normal)this.addAttribute("normal",new z(new Float32Array(d.length),3));else for(var e=b.normal.array,f=0,g=e.length;f<g;f++)e[f]=0;var e=b.normal.array,k,l,h,u=new q,p=new q,n=new q,r=new q,t=new q;if(a){a=a.array;0===c.length&&this.addGroup(0,a.length);for(var v=0,A=c.length;v<A;++v)for(f=c[v],g=f.start,k=f.count,f=g,g+=k;f<
g;f+=3)k=3*a[f+0],l=3*a[f+1],h=3*a[f+2],u.fromArray(d,k),p.fromArray(d,l),n.fromArray(d,h),r.subVectors(n,p),t.subVectors(u,p),r.cross(t),e[k]+=r.x,e[k+1]+=r.y,e[k+2]+=r.z,e[l]+=r.x,e[l+1]+=r.y,e[l+2]+=r.z,e[h]+=r.x,e[h+1]+=r.y,e[h+2]+=r.z}else for(f=0,g=d.length;f<g;f+=9)u.fromArray(d,f),p.fromArray(d,f+3),n.fromArray(d,f+6),r.subVectors(n,p),t.subVectors(u,p),r.cross(t),e[f]=r.x,e[f+1]=r.y,e[f+2]=r.z,e[f+3]=r.x,e[f+4]=r.y,e[f+5]=r.z,e[f+6]=r.x,e[f+7]=r.y,e[f+8]=r.z;this.normalizeNormals();b.normal.needsUpdate=
!0}},merge:function(a,b){if(!1===(a&&a.isBufferGeometry))console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",a);else{void 0===b&&(b=0);var c=this.attributes,d;for(d in c)if(void 0!==a.attributes[d])for(var e=c[d].array,f=a.attributes[d],g=f.array,k=0,f=f.itemSize*b;k<g.length;k++,f++)e[f]=g[k];return this}},normalizeNormals:function(){for(var a=this.attributes.normal.array,b,c,d,e=0,f=a.length;e<f;e+=3)b=a[e],c=a[e+1],d=a[e+2],b=1/Math.sqrt(b*b+c*c+d*d),
a[e]*=b,a[e+1]*=b,a[e+2]*=b},toNonIndexed:function(){if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var a=new I,b=this.index.array,c=this.attributes,d;for(d in c){for(var e=c[d],f=e.array,e=e.itemSize,g=new f.constructor(b.length*e),k,l=0,h=0,u=b.length;h<u;h++){k=b[h]*e;for(var p=0;p<e;p++)g[l++]=f[k++]}a.addAttribute(d,new z(g,e))}return a},toJSON:function(){var a={metadata:{version:4.4,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};
a.uuid=this.uuid;a.type=this.type;""!==this.name&&(a.name=this.name);if(void 0!==this.parameters){var b=this.parameters,c;for(c in b)void 0!==b[c]&&(a[c]=b[c]);return a}a.data={attributes:{}};var d=this.index;null!==d&&(b=Array.prototype.slice.call(d.array),a.data.index={type:d.array.constructor.name,array:b});d=this.attributes;for(c in d){var e=d[c],b=Array.prototype.slice.call(e.array);a.data.attributes[c]={itemSize:e.itemSize,type:e.array.constructor.name,array:b,normalized:e.normalized}}c=this.groups;
0<c.length&&(a.data.groups=JSON.parse(JSON.stringify(c)));c=this.boundingSphere;null!==c&&(a.data.boundingSphere={center:c.center.toArray(),radius:c.radius});return a},clone:function(){return(new I).copy(this)},copy:function(a){var b=a.index;null!==b&&this.setIndex(b.clone());var b=a.attributes,c;for(c in b)this.addAttribute(c,b[c].clone());a=a.groups;c=0;for(b=a.length;c<b;c++){var d=a[c];this.addGroup(d.start,d.count,d.materialIndex)}return this},dispose:function(){this.dispatchEvent({type:"dispose"})}});
I.MaxIndex=65535;va.prototype=Object.assign(Object.create(D.prototype),{constructor:va,isMesh:!0,setDrawMode:function(a){this.drawMode=a},copy:function(a){D.prototype.copy.call(this,a);this.drawMode=a.drawMode;return this},updateMorphTargets:function(){var a=this.geometry.morphTargets;if(void 0!==a&&0<a.length){this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var b=0,c=a.length;b<c;b++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[a[b].name]=b}},raycast:function(){function a(a,
b,c,d,e,f,g){Fa.barycoordFromPoint(a,b,c,d,v);e.multiplyScalar(v.x);f.multiplyScalar(v.y);g.multiplyScalar(v.z);e.add(f).add(g);return e.clone()}function b(a,b,c,d,e,f,g){var k=a.material;if(null===(1===k.side?c.intersectTriangle(f,e,d,!0,g):c.intersectTriangle(d,e,f,2!==k.side,g)))return null;w.copy(g);w.applyMatrix4(a.matrixWorld);c=b.ray.origin.distanceTo(w);return c<b.near||c>b.far?null:{distance:c,point:w.clone(),object:a}}function c(c,d,e,f,m,p,u,q){g.fromArray(f,3*p);k.fromArray(f,3*u);h.fromArray(f,
3*q);if(c=b(c,d,e,g,k,h,A))m&&(n.fromArray(m,2*p),r.fromArray(m,2*u),t.fromArray(m,2*q),c.uv=a(A,g,k,h,n,r,t)),c.face=new ga(p,u,q,Fa.normal(g,k,h)),c.faceIndex=p;return c}var d=new P,e=new Wa,f=new Aa,g=new q,k=new q,h=new q,m=new q,u=new q,p=new q,n=new C,r=new C,t=new C,v=new q,A=new q,w=new q;return function(q,v){var w=this.geometry,F=this.material,G=this.matrixWorld;if(void 0!==F&&(null===w.boundingSphere&&w.computeBoundingSphere(),f.copy(w.boundingSphere),f.applyMatrix4(G),!1!==q.ray.intersectsSphere(f)&&
(d.getInverse(G),e.copy(q.ray).applyMatrix4(d),null===w.boundingBox||!1!==e.intersectsBox(w.boundingBox)))){var E,J;if(w&&w.isBufferGeometry){var C,D,F=w.index,G=w.attributes,w=G.position.array;void 0!==G.uv&&(E=G.uv.array);if(null!==F)for(var G=F.array,z=0,I=G.length;z<I;z+=3){if(F=G[z],C=G[z+1],D=G[z+2],J=c(this,q,e,w,E,F,C,D))J.faceIndex=Math.floor(z/3),v.push(J)}else for(z=0,I=w.length;z<I;z+=9)if(F=z/3,C=F+1,D=F+2,J=c(this,q,e,w,E,F,C,D))J.index=F,v.push(J)}else if(w&&w.isGeometry){var H,P,G=
F&&F.isMultiMaterial,z=!0===G?F.materials:null,I=w.vertices;C=w.faces;D=w.faceVertexUvs[0];0<D.length&&(E=D);for(var L=0,M=C.length;L<M;L++){var O=C[L];J=!0===G?z[O.materialIndex]:F;if(void 0!==J){D=I[O.a];H=I[O.b];P=I[O.c];if(!0===J.morphTargets){J=w.morphTargets;var Q=this.morphTargetInfluences;g.set(0,0,0);k.set(0,0,0);h.set(0,0,0);for(var S=0,V=J.length;S<V;S++){var W=Q[S];if(0!==W){var K=J[S].vertices;g.addScaledVector(m.subVectors(K[O.a],D),W);k.addScaledVector(u.subVectors(K[O.b],H),W);h.addScaledVector(p.subVectors(K[O.c],
P),W)}}g.add(D);k.add(H);h.add(P);D=g;H=k;P=h}if(J=b(this,q,e,D,H,P,A))E&&(Q=E[L],n.copy(Q[0]),r.copy(Q[1]),t.copy(Q[2]),J.uv=a(A,D,H,P,n,r,t)),J.face=O,J.faceIndex=L,v.push(J)}}}}}}(),clone:function(){return(new this.constructor(this.geometry,this.material)).copy(this)}});db.prototype=Object.create(I.prototype);db.prototype.constructor=db;eb.prototype=Object.create(I.prototype);eb.prototype.constructor=eb;qa.prototype=Object.create(D.prototype);qa.prototype.constructor=qa;qa.prototype.isCamera=!0;
qa.prototype.getWorldDirection=function(){var a=new ca;return function(b){b=b||new q;this.getWorldQuaternion(a);return b.set(0,0,-1).applyQuaternion(a)}}();qa.prototype.lookAt=function(){var a=new P;return function(b){a.lookAt(this.position,b,this.up);this.quaternion.setFromRotationMatrix(a)}}();qa.prototype.clone=function(){return(new this.constructor).copy(this)};qa.prototype.copy=function(a){D.prototype.copy.call(this,a);this.matrixWorldInverse.copy(a.matrixWorldInverse);this.projectionMatrix.copy(a.projectionMatrix);
return this};Ca.prototype=Object.assign(Object.create(qa.prototype),{constructor:Ca,isPerspectiveCamera:!0,copy:function(a){qa.prototype.copy.call(this,a);this.fov=a.fov;this.zoom=a.zoom;this.near=a.near;this.far=a.far;this.focus=a.focus;this.aspect=a.aspect;this.view=null===a.view?null:Object.assign({},a.view);this.filmGauge=a.filmGauge;this.filmOffset=a.filmOffset;return this},setFocalLength:function(a){a=.5*this.getFilmHeight()/a;this.fov=2*h.Math.RAD2DEG*Math.atan(a);this.updateProjectionMatrix()},
getFocalLength:function(){var a=Math.tan(.5*h.Math.DEG2RAD*this.fov);return.5*this.getFilmHeight()/a},getEffectiveFOV:function(){return 2*h.Math.RAD2DEG*Math.atan(Math.tan(.5*h.Math.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(a,b,c,d,e,f){this.aspect=a/b;this.view={fullWidth:a,fullHeight:b,offsetX:c,offsetY:d,width:e,height:f};this.updateProjectionMatrix()},
clearViewOffset:function(){this.view=null;this.updateProjectionMatrix()},updateProjectionMatrix:function(){var a=this.near,b=a*Math.tan(.5*h.Math.DEG2RAD*this.fov)/this.zoom,c=2*b,d=this.aspect*c,e=-.5*d,f=this.view;if(null!==f)var g=f.fullWidth,k=f.fullHeight,e=e+f.offsetX*d/g,b=b-f.offsetY*c/k,d=f.width/g*d,c=f.height/k*c;f=this.filmOffset;0!==f&&(e+=a*f/this.getFilmWidth());this.projectionMatrix.makeFrustum(e,e+d,b-c,b,a,this.far)},toJSON:function(a){a=D.prototype.toJSON.call(this,a);a.object.fov=
this.fov;a.object.zoom=this.zoom;a.object.near=this.near;a.object.far=this.far;a.object.focus=this.focus;a.object.aspect=this.aspect;null!==this.view&&(a.object.view=Object.assign({},this.view));a.object.filmGauge=this.filmGauge;a.object.filmOffset=this.filmOffset;return a}});Db.prototype=Object.assign(Object.create(qa.prototype),{constructor:Db,isOrthographicCamera:!0,copy:function(a){qa.prototype.copy.call(this,a);this.left=a.left;this.right=a.right;this.top=a.top;this.bottom=a.bottom;this.near=
a.near;this.far=a.far;this.zoom=a.zoom;this.view=null===a.view?null:Object.assign({},a.view);return this},setViewOffset:function(a,b,c,d,e,f){this.view={fullWidth:a,fullHeight:b,offsetX:c,offsetY:d,width:e,height:f};this.updateProjectionMatrix()},clearViewOffset:function(){this.view=null;this.updateProjectionMatrix()},updateProjectionMatrix:function(){var a=(this.right-this.left)/(2*this.zoom),b=(this.top-this.bottom)/(2*this.zoom),c=(this.right+this.left)/2,d=(this.top+this.bottom)/2,e=c-a,c=c+a,
a=d+b,b=d-b;if(null!==this.view)var c=this.zoom/(this.view.width/this.view.fullWidth),b=this.zoom/(this.view.height/this.view.fullHeight),f=(this.right-this.left)/this.view.width,d=(this.top-this.bottom)/this.view.height,e=e+this.view.offsetX/c*f,c=e+this.view.width/c*f,a=a-this.view.offsetY/b*d,b=a-this.view.height/b*d;this.projectionMatrix.makeOrthographic(e,c,a,b,this.near,this.far)},toJSON:function(a){a=D.prototype.toJSON.call(this,a);a.object.zoom=this.zoom;a.object.left=this.left;a.object.right=
this.right;a.object.top=this.top;a.object.bottom=this.bottom;a.object.near=this.near;a.object.far=this.far;null!==this.view&&(a.object.view=Object.assign({},this.view));return a}});var bf=0;Eb.prototype.isFogExp2=!0;Eb.prototype.clone=function(){return new Eb(this.color.getHex(),this.density)};Eb.prototype.toJSON=function(a){return{type:"FogExp2",color:this.color.getHex(),density:this.density}};Fb.prototype.isFog=!0;Fb.prototype.clone=function(){return new Fb(this.color.getHex(),this.near,this.far)};
Fb.prototype.toJSON=function(a){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}};fb.prototype=Object.create(D.prototype);fb.prototype.constructor=fb;fb.prototype.copy=function(a,b){D.prototype.copy.call(this,a,b);null!==a.background&&(this.background=a.background.clone());null!==a.fog&&(this.fog=a.fog.clone());null!==a.overrideMaterial&&(this.overrideMaterial=a.overrideMaterial.clone());this.autoUpdate=a.autoUpdate;this.matrixAutoUpdate=a.matrixAutoUpdate;return this};fb.prototype.toJSON=
function(a){var b=D.prototype.toJSON.call(this,a);null!==this.background&&(b.object.background=this.background.toJSON(a));null!==this.fog&&(b.object.fog=this.fog.toJSON());return b};pd.prototype=Object.assign(Object.create(D.prototype),{constructor:pd,isLensFlare:!0,copy:function(a){D.prototype.copy.call(this,a);this.positionScreen.copy(a.positionScreen);this.customUpdateCallback=a.customUpdateCallback;for(var b=0,c=a.lensFlares.length;b<c;b++)this.lensFlares.push(a.lensFlares[b]);return this},add:function(a,
b,c,d,e,f){void 0===b&&(b=-1);void 0===c&&(c=0);void 0===f&&(f=1);void 0===e&&(e=new H(16777215));void 0===d&&(d=1);c=Math.min(c,Math.max(0,c));this.lensFlares.push({texture:a,size:b,distance:c,x:0,y:0,z:0,scale:1,rotation:0,opacity:f,color:e,blending:d})},updateLensFlares:function(){var a,b=this.lensFlares.length,c,d=2*-this.positionScreen.x,e=2*-this.positionScreen.y;for(a=0;a<b;a++)c=this.lensFlares[a],c.x=this.positionScreen.x+d*c.distance,c.y=this.positionScreen.y+e*c.distance,c.wantedRotation=
c.x*Math.PI*.25,c.rotation+=.25*(c.wantedRotation-c.rotation)}});gb.prototype=Object.create(S.prototype);gb.prototype.constructor=gb;gb.prototype.copy=function(a){S.prototype.copy.call(this,a);this.color.copy(a.color);this.map=a.map;this.rotation=a.rotation;return this};fc.prototype=Object.assign(Object.create(D.prototype),{constructor:fc,isSprite:!0,raycast:function(){var a=new q;return function(b,c){a.setFromMatrixPosition(this.matrixWorld);var d=b.ray.distanceSqToPoint(a);d>this.scale.x*this.scale.y/
4||c.push({distance:Math.sqrt(d),point:this.position,face:null,object:this})}}(),clone:function(){return(new this.constructor(this.material)).copy(this)}});gc.prototype=Object.assign(Object.create(D.prototype),{constructor:gc,copy:function(a){D.prototype.copy.call(this,a,!1);a=a.levels;for(var b=0,c=a.length;b<c;b++){var d=a[b];this.addLevel(d.object.clone(),d.distance)}return this},addLevel:function(a,b){void 0===b&&(b=0);b=Math.abs(b);for(var c=this.levels,d=0;d<c.length&&!(b<c[d].distance);d++);
c.splice(d,0,{distance:b,object:a});this.add(a)},getObjectForDistance:function(a){for(var b=this.levels,c=1,d=b.length;c<d&&!(a<b[c].distance);c++);return b[c-1].object},raycast:function(){var a=new q;return function(b,c){a.setFromMatrixPosition(this.matrixWorld);var d=b.ray.origin.distanceTo(a);this.getObjectForDistance(d).raycast(b,c)}}(),update:function(){var a=new q,b=new q;return function(c){var d=this.levels;if(1<d.length){a.setFromMatrixPosition(c.matrixWorld);b.setFromMatrixPosition(this.matrixWorld);
c=a.distanceTo(b);d[0].object.visible=!0;for(var e=1,f=d.length;e<f;e++)if(c>=d[e].distance)d[e-1].object.visible=!1,d[e].object.visible=!0;else break;for(;e<f;e++)d[e].object.visible=!1}}}(),toJSON:function(a){a=D.prototype.toJSON.call(this,a);a.object.levels=[];for(var b=this.levels,c=0,d=b.length;c<d;c++){var e=b[c];a.object.levels.push({object:e.object.uuid,distance:e.distance})}return a}});hb.prototype=Object.create(ba.prototype);hb.prototype.constructor=hb;hb.prototype.isDataTexture=!0;Object.assign(Nc.prototype,
{calculateInverses:function(){this.boneInverses=[];for(var a=0,b=this.bones.length;a<b;a++){var c=new P;this.bones[a]&&c.getInverse(this.bones[a].matrixWorld);this.boneInverses.push(c)}},pose:function(){for(var a,b=0,c=this.bones.length;b<c;b++)(a=this.bones[b])&&a.matrixWorld.getInverse(this.boneInverses[b]);b=0;for(c=this.bones.length;b<c;b++)if(a=this.bones[b])a.parent&&a.parent.isBone?(a.matrix.getInverse(a.parent.matrixWorld),a.matrix.multiply(a.matrixWorld)):a.matrix.copy(a.matrixWorld),a.matrix.decompose(a.position,
a.quaternion,a.scale)},update:function(){var a=new P;return function(){for(var b=0,c=this.bones.length;b<c;b++)a.multiplyMatrices(this.bones[b]?this.bones[b].matrixWorld:this.identityMatrix,this.boneInverses[b]),a.toArray(this.boneMatrices,16*b);this.useVertexTexture&&(this.boneTexture.needsUpdate=!0)}}(),clone:function(){return new Nc(this.bones,this.boneInverses,this.useVertexTexture)}});Oc.prototype=Object.assign(Object.create(D.prototype),{constructor:Oc,isBone:!0,copy:function(a){D.prototype.copy.call(this,
a);this.skin=a.skin;return this}});Pc.prototype=Object.assign(Object.create(va.prototype),{constructor:Pc,isSkinnedMesh:!0,bind:function(a,b){this.skeleton=a;void 0===b&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),b=this.matrixWorld);this.bindMatrix.copy(b);this.bindMatrixInverse.getInverse(b)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){if(this.geometry&&this.geometry.isGeometry)for(var a=0;a<this.geometry.skinWeights.length;a++){var b=this.geometry.skinWeights[a],
c=1/b.lengthManhattan();Infinity!==c?b.multiplyScalar(c):b.set(1,0,0,0)}else if(this.geometry&&this.geometry.isBufferGeometry)for(var b=new da,d=this.geometry.attributes.skinWeight,a=0;a<d.count;a++)b.x=d.getX(a),b.y=d.getY(a),b.z=d.getZ(a),b.w=d.getW(a),c=1/b.lengthManhattan(),Infinity!==c?b.multiplyScalar(c):b.set(1,0,0,0),d.setXYZW(a,b.x,b.y,b.z,b.w)},updateMatrixWorld:function(a){va.prototype.updateMatrixWorld.call(this,!0);"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):
"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh unrecognized bindMode: "+this.bindMode)},clone:function(){return(new this.constructor(this.geometry,this.material,this.skeleton.useVertexTexture)).copy(this)}});na.prototype=Object.create(S.prototype);na.prototype.constructor=na;na.prototype.isLineBasicMaterial=!0;na.prototype.copy=function(a){S.prototype.copy.call(this,a);this.color.copy(a.color);this.linewidth=a.linewidth;this.linecap=a.linecap;
this.linejoin=a.linejoin;return this};Pa.prototype=Object.assign(Object.create(D.prototype),{constructor:Pa,isLine:!0,raycast:function(){var a=new P,b=new Wa,c=new Aa;return function(d,e){var f=d.linePrecision,f=f*f,g=this.geometry,k=this.matrixWorld;null===g.boundingSphere&&g.computeBoundingSphere();c.copy(g.boundingSphere);c.applyMatrix4(k);if(!1!==d.ray.intersectsSphere(c)){a.getInverse(k);b.copy(d.ray).applyMatrix4(a);var h=new q,m=new q,k=new q,u=new q,p=this&&this.isLineSegments?2:1;if(g&&g.isBufferGeometry){var n=
g.index,r=g.attributes.position.array;if(null!==n)for(var n=n.array,g=0,t=n.length-1;g<t;g+=p){var v=n[g+1];h.fromArray(r,3*n[g]);m.fromArray(r,3*v);v=b.distanceSqToSegment(h,m,u,k);v>f||(u.applyMatrix4(this.matrixWorld),v=d.ray.origin.distanceTo(u),v<d.near||v>d.far||e.push({distance:v,point:k.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this}))}else for(g=0,t=r.length/3-1;g<t;g+=p)h.fromArray(r,3*g),m.fromArray(r,3*g+3),v=b.distanceSqToSegment(h,m,u,k),v>f||(u.applyMatrix4(this.matrixWorld),
v=d.ray.origin.distanceTo(u),v<d.near||v>d.far||e.push({distance:v,point:k.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this}))}else if(g&&g.isGeometry)for(h=g.vertices,m=h.length,g=0;g<m-1;g+=p)v=b.distanceSqToSegment(h[g],h[g+1],u,k),v>f||(u.applyMatrix4(this.matrixWorld),v=d.ray.origin.distanceTo(u),v<d.near||v>d.far||e.push({distance:v,point:k.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this}))}}}(),clone:function(){return(new this.constructor(this.geometry,
this.material)).copy(this)}});ha.prototype=Object.assign(Object.create(Pa.prototype),{constructor:ha,isLineSegments:!0});Ja.prototype=Object.create(S.prototype);Ja.prototype.constructor=Ja;Ja.prototype.isPointsMaterial=!0;Ja.prototype.copy=function(a){S.prototype.copy.call(this,a);this.color.copy(a.color);this.map=a.map;this.size=a.size;this.sizeAttenuation=a.sizeAttenuation;return this};Gb.prototype=Object.assign(Object.create(D.prototype),{constructor:Gb,isPoints:!0,raycast:function(){var a=new P,
b=new Wa,c=new Aa;return function(d,e){function f(a,c){var f=b.distanceSqToPoint(a);if(f<u){var k=b.closestPointToPoint(a);k.applyMatrix4(h);var n=d.ray.origin.distanceTo(k);n<d.near||n>d.far||e.push({distance:n,distanceToRay:Math.sqrt(f),point:k.clone(),index:c,face:null,object:g})}}var g=this,k=this.geometry,h=this.matrixWorld,m=d.params.Points.threshold;null===k.boundingSphere&&k.computeBoundingSphere();c.copy(k.boundingSphere);c.applyMatrix4(h);if(!1!==d.ray.intersectsSphere(c)){a.getInverse(h);
b.copy(d.ray).applyMatrix4(a);var m=m/((this.scale.x+this.scale.y+this.scale.z)/3),u=m*m,m=new q;if(k&&k.isBufferGeometry){var p=k.index,k=k.attributes.position.array;if(null!==p)for(var n=p.array,p=0,r=n.length;p<r;p++){var t=n[p];m.fromArray(k,3*t);f(m,t)}else for(p=0,n=k.length/3;p<n;p++)m.fromArray(k,3*p),f(m,p)}else for(m=k.vertices,p=0,n=m.length;p<n;p++)f(m[p],p)}}}(),clone:function(){return(new this.constructor(this.geometry,this.material)).copy(this)}});hc.prototype=Object.assign(Object.create(D.prototype),
{constructor:hc});Qc.prototype=Object.create(ba.prototype);Qc.prototype.constructor=Qc;Hb.prototype=Object.create(ba.prototype);Hb.prototype.constructor=Hb;Hb.prototype.isCompressedTexture=!0;Rc.prototype=Object.create(ba.prototype);Rc.prototype.constructor=Rc;ic.prototype=Object.create(ba.prototype);ic.prototype.constructor=ic;ic.prototype.isDepthTexture=!0;Ib.prototype=Object.create(I.prototype);Ib.prototype.constructor=Ib;jc.prototype=Object.create(R.prototype);jc.prototype.constructor=jc;sa.prototype=
Object.create(R.prototype);sa.prototype.constructor=sa;kc.prototype=Object.create(sa.prototype);kc.prototype.constructor=kc;lc.prototype=Object.create(sa.prototype);lc.prototype.constructor=lc;mc.prototype=Object.create(sa.prototype);mc.prototype.constructor=mc;nc.prototype=Object.create(sa.prototype);nc.prototype.constructor=nc;wa.prototype=Object.create(R.prototype);wa.prototype.constructor=wa;wa.NoTaper=function(a){return 1};wa.SinusoidalTaper=function(a){return Math.sin(Math.PI*a)};wa.FrenetFrames=
function(a,b,c){var d=new q,e=[],f=[],g=[],k=new q,l=new P;b+=1;var m,u,p;this.tangents=e;this.normals=f;this.binormals=g;for(m=0;m<b;m++)u=m/(b-1),e[m]=a.getTangentAt(u),e[m].normalize();f[0]=new q;g[0]=new q;a=Number.MAX_VALUE;m=Math.abs(e[0].x);u=Math.abs(e[0].y);p=Math.abs(e[0].z);m<=a&&(a=m,d.set(1,0,0));u<=a&&(a=u,d.set(0,1,0));p<=a&&d.set(0,0,1);k.crossVectors(e[0],d).normalize();f[0].crossVectors(e[0],k);g[0].crossVectors(e[0],f[0]);for(m=1;m<b;m++)f[m]=f[m-1].clone(),g[m]=g[m-1].clone(),
k.crossVectors(e[m-1],e[m]),k.length()>Number.EPSILON&&(k.normalize(),d=Math.acos(h.Math.clamp(e[m-1].dot(e[m]),-1,1)),f[m].applyMatrix4(l.makeRotationAxis(k,d))),g[m].crossVectors(e[m],f[m]);if(c)for(d=Math.acos(h.Math.clamp(f[0].dot(f[b-1]),-1,1)),d/=b-1,0<e[0].dot(k.crossVectors(f[0],f[b-1]))&&(d=-d),m=1;m<b;m++)f[m].applyMatrix4(l.makeRotationAxis(e[m],d*m)),g[m].crossVectors(e[m],f[m])};Jb.prototype=Object.create(I.prototype);Jb.prototype.constructor=Jb;oc.prototype=Object.create(R.prototype);
oc.prototype.constructor=oc;Kb.prototype=Object.create(I.prototype);Kb.prototype.constructor=Kb;pc.prototype=Object.create(R.prototype);pc.prototype.constructor=pc;h.ShapeUtils={area:function(a){for(var b=a.length,c=0,d=b-1,e=0;e<b;d=e++)c+=a[d].x*a[e].y-a[e].x*a[d].y;return.5*c},triangulate:function(){return function(a,b){var c=a.length;if(3>c)return null;var d=[],e=[],f=[],g,k,l;if(0<h.ShapeUtils.area(a))for(k=0;k<c;k++)e[k]=k;else for(k=0;k<c;k++)e[k]=c-1-k;var m=2*c;for(k=c-1;2<c;){if(0>=m--){console.warn("THREE.ShapeUtils: Unable to triangulate polygon! in triangulate()");
break}g=k;c<=g&&(g=0);k=g+1;c<=k&&(k=0);l=k+1;c<=l&&(l=0);var q;a:{var p,n,r,t,v,A,w,x;p=a[e[g]].x;n=a[e[g]].y;r=a[e[k]].x;t=a[e[k]].y;v=a[e[l]].x;A=a[e[l]].y;if(Number.EPSILON>(r-p)*(A-n)-(t-n)*(v-p))q=!1;else{var C,y,F,G,E,J,D,z,I,H;C=v-r;y=A-t;F=p-v;G=n-A;E=r-p;J=t-n;for(q=0;q<c;q++)if(w=a[e[q]].x,x=a[e[q]].y,!(w===p&&x===n||w===r&&x===t||w===v&&x===A)&&(D=w-p,z=x-n,I=w-r,H=x-t,w-=v,x-=A,I=C*H-y*I,D=E*z-J*D,z=F*x-G*w,I>=-Number.EPSILON&&z>=-Number.EPSILON&&D>=-Number.EPSILON)){q=!1;break a}q=!0}}if(q){d.push([a[e[g]],
a[e[k]],a[e[l]]]);f.push([e[g],e[k],e[l]]);g=k;for(l=k+1;l<c;g++,l++)e[g]=e[l];c--;m=2*c}}return b?f:d}}(),triangulateShape:function(a,b){function c(a){var b=a.length;2<b&&a[b-1].equals(a[0])&&a.pop()}function d(a,b,c){return a.x!==b.x?a.x<b.x?a.x<=c.x&&c.x<=b.x:b.x<=c.x&&c.x<=a.x:a.y<b.y?a.y<=c.y&&c.y<=b.y:b.y<=c.y&&c.y<=a.y}function e(a,b,c,e,f){var g=b.x-a.x,k=b.y-a.y,h=e.x-c.x,l=e.y-c.y,n=a.x-c.x,m=a.y-c.y,p=k*h-g*l,q=k*n-g*m;if(Math.abs(p)>Number.EPSILON){if(0<p){if(0>q||q>p)return[];h=l*n-h*
m;if(0>h||h>p)return[]}else{if(0<q||q<p)return[];h=l*n-h*m;if(0<h||h<p)return[]}if(0===h)return!f||0!==q&&q!==p?[a]:[];if(h===p)return!f||0!==q&&q!==p?[b]:[];if(0===q)return[c];if(q===p)return[e];f=h/p;return[{x:a.x+f*g,y:a.y+f*k}]}if(0!==q||l*n!==h*m)return[];k=0===g&&0===k;h=0===h&&0===l;if(k&&h)return a.x!==c.x||a.y!==c.y?[]:[a];if(k)return d(c,e,a)?[a]:[];if(h)return d(a,b,c)?[c]:[];0!==g?(a.x<b.x?(g=a,h=a.x,k=b,a=b.x):(g=b,h=b.x,k=a,a=a.x),c.x<e.x?(b=c,p=c.x,l=e,c=e.x):(b=e,p=e.x,l=c,c=c.x)):
(a.y<b.y?(g=a,h=a.y,k=b,a=b.y):(g=b,h=b.y,k=a,a=a.y),c.y<e.y?(b=c,p=c.y,l=e,c=e.y):(b=e,p=e.y,l=c,c=c.y));return h<=p?a<p?[]:a===p?f?[]:[b]:a<=c?[b,k]:[b,l]:h>c?[]:h===c?f?[]:[g]:a<=c?[g,k]:[g,l]}function f(a,b,c,d){var e=b.x-a.x,f=b.y-a.y;b=c.x-a.x;c=c.y-a.y;var g=d.x-a.x;d=d.y-a.y;a=e*c-f*b;e=e*d-f*g;return Math.abs(a)>Number.EPSILON?(b=g*c-d*b,0<a?0<=e&&0<=b:0<=e||0<=b):0<e}c(a);b.forEach(c);var g,k,l,m,q,p={};l=a.concat();g=0;for(k=b.length;g<k;g++)Array.prototype.push.apply(l,b[g]);g=0;for(k=
l.length;g<k;g++)q=l[g].x+":"+l[g].y,void 0!==p[q]&&console.warn("THREE.ShapeUtils: Duplicate point",q,g),p[q]=g;g=function(a,b){function c(a,b){var d=k.length-1,e=a-1;0>e&&(e=d);var g=a+1;g>d&&(g=0);d=f(k[a],k[e],k[g],h[b]);if(!d)return!1;d=h.length-1;e=b-1;0>e&&(e=d);g=b+1;g>d&&(g=0);return(d=f(h[b],h[e],h[g],k[a]))?!0:!1}function d(a,b){var c,f;for(c=0;c<k.length;c++)if(f=c+1,f%=k.length,f=e(a,b,k[c],k[f],!0),0<f.length)return!0;return!1}function g(a,c){var d,f,k,h;for(d=0;d<l.length;d++)for(f=
b[l[d]],k=0;k<f.length;k++)if(h=k+1,h%=f.length,h=e(a,c,f[k],f[h],!0),0<h.length)return!0;return!1}var k=a.concat(),h,l=[],n,m,p,q,u,C=[],D,z,I,H=0;for(n=b.length;H<n;H++)l.push(H);D=0;for(var L=2*l.length;0<l.length;){L--;if(0>L){console.log("Infinite Loop! Holes left:"+l.length+", Probably Hole outside Shape!");break}for(m=D;m<k.length;m++){p=k[m];n=-1;for(H=0;H<l.length;H++)if(q=l[H],u=p.x+":"+p.y+":"+q,void 0===C[u]){h=b[q];for(z=0;z<h.length;z++)if(q=h[z],c(m,z)&&!d(p,q)&&!g(p,q)){n=z;l.splice(H,
1);D=k.slice(0,m+1);q=k.slice(m);z=h.slice(n);I=h.slice(0,n+1);k=D.concat(z).concat(I).concat(q);D=m;break}if(0<=n)break;C[u]=!0}if(0<=n)break}}return k}(a,b);var n=h.ShapeUtils.triangulate(g,!1);g=0;for(k=n.length;g<k;g++)for(m=n[g],l=0;3>l;l++)q=m[l].x+":"+m[l].y,q=p[q],void 0!==q&&(m[l]=q);return n.concat()},isClockWise:function(a){return 0>h.ShapeUtils.area(a)},b2:function(){return function(a,b,c,d){var e=1-a;return e*e*b+2*(1-a)*a*c+a*a*d}}(),b3:function(){return function(a,b,c,d,e){var f=1-
a,g=1-a;return f*f*f*b+3*g*g*a*c+3*(1-a)*a*a*d+a*a*a*e}}()};ra.prototype=Object.create(R.prototype);ra.prototype.constructor=ra;ra.prototype.addShapeList=function(a,b){for(var c=a.length,d=0;d<c;d++)this.addShape(a[d],b)};ra.prototype.addShape=function(a,b){function c(a,b,c){b||console.error("THREE.ExtrudeGeometry: vec does not exist");return b.clone().multiplyScalar(c).add(a)}function d(a,b,c){var d,e,f;e=a.x-b.x;f=a.y-b.y;d=c.x-a.x;var g=c.y-a.y,k=e*e+f*f;if(Math.abs(e*g-f*d)>Number.EPSILON){var h=
Math.sqrt(k),l=Math.sqrt(d*d+g*g),k=b.x-f/h;b=b.y+e/h;g=((c.x-g/l-k)*g-(c.y+d/l-b)*d)/(e*g-f*d);d=k+e*g-a.x;e=b+f*g-a.y;f=d*d+e*e;if(2>=f)return new C(d,e);f=Math.sqrt(f/2)}else a=!1,e>Number.EPSILON?d>Number.EPSILON&&(a=!0):e<-Number.EPSILON?d<-Number.EPSILON&&(a=!0):Math.sign(f)===Math.sign(g)&&(a=!0),a?(d=-f,f=Math.sqrt(k)):(d=e,e=f,f=Math.sqrt(k/2));return new C(d/f,e/f)}function e(a,b){var c,d;for(K=a.length;0<=--K;){c=K;d=K-1;0>d&&(d=a.length-1);var e,f=r+2*u;for(e=0;e<f;e++){var g=U*e,k=U*
(e+1),h=b+c+g,g=b+d+g,l=b+d+k,k=b+c+k,h=h+N,g=g+N,l=l+N,k=k+N;I.faces.push(new ga(h,g,k,null,null,1));I.faces.push(new ga(g,l,k,null,null,1));h=w.generateSideWallUV(I,h,g,l,k);I.faceVertexUvs[0].push([h[0],h[1],h[3]]);I.faceVertexUvs[0].push([h[1],h[2],h[3]])}}}function f(a,b,c){I.vertices.push(new q(a,b,c))}function g(a,b,c){a+=N;b+=N;c+=N;I.faces.push(new ga(a,b,c,null,null,0));a=w.generateTopUV(I,a,b,c);I.faceVertexUvs[0].push(a)}var k=void 0!==b.amount?b.amount:100,l=void 0!==b.bevelThickness?
b.bevelThickness:6,m=void 0!==b.bevelSize?b.bevelSize:l-2,u=void 0!==b.bevelSegments?b.bevelSegments:3,p=void 0!==b.bevelEnabled?b.bevelEnabled:!0,n=void 0!==b.curveSegments?b.curveSegments:12,r=void 0!==b.steps?b.steps:1,t=b.extrudePath,v,A=!1,w=void 0!==b.UVGenerator?b.UVGenerator:ra.WorldUVGenerator,x,D,y,F;t&&(v=t.getSpacedPoints(r),A=!0,p=!1,x=void 0!==b.frames?b.frames:new wa.FrenetFrames(t,r,!1),D=new q,y=new q,F=new q);p||(m=l=u=0);var G,E,z,I=this,N=this.vertices.length,t=a.extractPoints(n),
n=t.shape,H=t.holes;if(t=!h.ShapeUtils.isClockWise(n)){n=n.reverse();E=0;for(z=H.length;E<z;E++)G=H[E],h.ShapeUtils.isClockWise(G)&&(H[E]=G.reverse());t=!1}var P=h.ShapeUtils.triangulateShape(n,H),S=n;E=0;for(z=H.length;E<z;E++)G=H[E],n=n.concat(G);var R,L,M,O,Q,U=n.length,V,W=P.length,t=[],K=0;M=S.length;R=M-1;for(L=K+1;K<M;K++,R++,L++)R===M&&(R=0),L===M&&(L=0),t[K]=d(S[K],S[R],S[L]);var Z=[],Y,ba=t.concat();E=0;for(z=H.length;E<z;E++){G=H[E];Y=[];K=0;M=G.length;R=M-1;for(L=K+1;K<M;K++,R++,L++)R===
M&&(R=0),L===M&&(L=0),Y[K]=d(G[K],G[R],G[L]);Z.push(Y);ba=ba.concat(Y)}for(R=0;R<u;R++){M=R/u;O=l*Math.cos(M*Math.PI/2);L=m*Math.sin(M*Math.PI/2);K=0;for(M=S.length;K<M;K++)Q=c(S[K],t[K],L),f(Q.x,Q.y,-O);E=0;for(z=H.length;E<z;E++)for(G=H[E],Y=Z[E],K=0,M=G.length;K<M;K++)Q=c(G[K],Y[K],L),f(Q.x,Q.y,-O)}L=m;for(K=0;K<U;K++)Q=p?c(n[K],ba[K],L):n[K],A?(y.copy(x.normals[0]).multiplyScalar(Q.x),D.copy(x.binormals[0]).multiplyScalar(Q.y),F.copy(v[0]).add(y).add(D),f(F.x,F.y,F.z)):f(Q.x,Q.y,0);for(M=1;M<=
r;M++)for(K=0;K<U;K++)Q=p?c(n[K],ba[K],L):n[K],A?(y.copy(x.normals[M]).multiplyScalar(Q.x),D.copy(x.binormals[M]).multiplyScalar(Q.y),F.copy(v[M]).add(y).add(D),f(F.x,F.y,F.z)):f(Q.x,Q.y,k/r*M);for(R=u-1;0<=R;R--){M=R/u;O=l*Math.cos(M*Math.PI/2);L=m*Math.sin(M*Math.PI/2);K=0;for(M=S.length;K<M;K++)Q=c(S[K],t[K],L),f(Q.x,Q.y,k+O);E=0;for(z=H.length;E<z;E++)for(G=H[E],Y=Z[E],K=0,M=G.length;K<M;K++)Q=c(G[K],Y[K],L),A?f(Q.x,Q.y+v[r-1].y,v[r-1].x+O):f(Q.x,Q.y,k+O)}(function(){if(p){var a=0*U;for(K=0;K<
W;K++)V=P[K],g(V[2]+a,V[1]+a,V[0]+a);a=U*(r+2*u);for(K=0;K<W;K++)V=P[K],g(V[0]+a,V[1]+a,V[2]+a)}else{for(K=0;K<W;K++)V=P[K],g(V[2],V[1],V[0]);for(K=0;K<W;K++)V=P[K],g(V[0]+U*r,V[1]+U*r,V[2]+U*r)}})();(function(){var a=0;e(S,a);a+=S.length;E=0;for(z=H.length;E<z;E++)G=H[E],e(G,a),a+=G.length})()};ra.WorldUVGenerator={generateTopUV:function(a,b,c,d){a=a.vertices;b=a[b];c=a[c];d=a[d];return[new C(b.x,b.y),new C(c.x,c.y),new C(d.x,d.y)]},generateSideWallUV:function(a,b,c,d,e){a=a.vertices;b=a[b];c=a[c];
d=a[d];e=a[e];return.01>Math.abs(b.y-c.y)?[new C(b.x,1-b.z),new C(c.x,1-c.z),new C(d.x,1-d.z),new C(e.x,1-e.z)]:[new C(b.y,1-b.z),new C(c.y,1-c.z),new C(d.y,1-d.z),new C(e.y,1-e.z)]}};qc.prototype=Object.create(ra.prototype);qc.prototype.constructor=qc;ib.prototype=Object.create(I.prototype);ib.prototype.constructor=ib;Lb.prototype=Object.create(R.prototype);Lb.prototype.constructor=Lb;Mb.prototype=Object.create(I.prototype);Mb.prototype.constructor=Mb;rc.prototype=Object.create(R.prototype);rc.prototype.constructor=
rc;sc.prototype=Object.create(R.prototype);sc.prototype.constructor=sc;Nb.prototype=Object.create(I.prototype);Nb.prototype.constructor=Nb;tc.prototype=Object.create(R.prototype);tc.prototype.constructor=tc;Ya.prototype=Object.create(R.prototype);Ya.prototype.constructor=Ya;Ya.prototype.addShapeList=function(a,b){for(var c=0,d=a.length;c<d;c++)this.addShape(a[c],b);return this};Ya.prototype.addShape=function(a,b){void 0===b&&(b={});var c=b.material,d=void 0===b.UVGenerator?ra.WorldUVGenerator:b.UVGenerator,
e,f,g,k=this.vertices.length;e=a.extractPoints(void 0!==b.curveSegments?b.curveSegments:12);var l=e.shape,m=e.holes;if(!h.ShapeUtils.isClockWise(l))for(l=l.reverse(),e=0,f=m.length;e<f;e++)g=m[e],h.ShapeUtils.isClockWise(g)&&(m[e]=g.reverse());var u=h.ShapeUtils.triangulateShape(l,m);e=0;for(f=m.length;e<f;e++)g=m[e],l=l.concat(g);m=l.length;f=u.length;for(e=0;e<m;e++)g=l[e],this.vertices.push(new q(g.x,g.y,0));for(e=0;e<f;e++)m=u[e],l=m[0]+k,g=m[1]+k,m=m[2]+k,this.faces.push(new ga(l,g,m,null,null,
c)),this.faceVertexUvs[0].push(d.generateTopUV(this,l,g,m))};Ob.prototype=Object.create(I.prototype);Ob.prototype.constructor=Ob;Za.prototype=Object.create(I.prototype);Za.prototype.constructor=Za;jb.prototype=Object.create(R.prototype);jb.prototype.constructor=jb;uc.prototype=Object.create(jb.prototype);uc.prototype.constructor=uc;vc.prototype=Object.create(I.prototype);vc.prototype.constructor=vc;Pb.prototype=Object.create(I.prototype);Pb.prototype.constructor=Pb;wc.prototype=Object.create(R.prototype);
wc.prototype.constructor=wc;kb.prototype=Object.create(R.prototype);kb.prototype.constructor=kb;var ua=Object.freeze({WireframeGeometry:Ib,ParametricGeometry:jc,TetrahedronGeometry:kc,OctahedronGeometry:lc,IcosahedronGeometry:mc,DodecahedronGeometry:nc,PolyhedronGeometry:sa,TubeGeometry:wa,TorusKnotGeometry:oc,TorusKnotBufferGeometry:Jb,TorusGeometry:pc,TorusBufferGeometry:Kb,TextGeometry:qc,SphereBufferGeometry:ib,SphereGeometry:Lb,RingGeometry:rc,RingBufferGeometry:Mb,PlaneBufferGeometry:eb,PlaneGeometry:sc,
LatheGeometry:tc,LatheBufferGeometry:Nb,ShapeGeometry:Ya,ExtrudeGeometry:ra,EdgesGeometry:Ob,ConeGeometry:uc,ConeBufferGeometry:vc,CylinderGeometry:jb,CylinderBufferGeometry:Za,CircleBufferGeometry:Pb,CircleGeometry:wc,BoxBufferGeometry:db,BoxGeometry:kb});Qb.prototype=Object.create(Da.prototype);Qb.prototype.constructor=Qb;Qb.prototype.isShadowMaterial=!0;Rb.prototype=Object.create(Da.prototype);Rb.prototype.constructor=Rb;Rb.prototype.isRawShaderMaterial=!0;xc.prototype={constructor:xc,isMultiMaterial:!0,
toJSON:function(a){for(var b={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type,materials:[]},c=this.materials,d=0,e=c.length;d<e;d++){var f=c[d].toJSON(a);delete f.metadata;b.materials.push(f)}b.visible=this.visible;return b},clone:function(){for(var a=new this.constructor,b=0;b<this.materials.length;b++)a.materials.push(this.materials[b].clone());a.visible=this.visible;return a}};Ka.prototype=Object.create(S.prototype);Ka.prototype.constructor=Ka;
Ka.prototype.isMeshStandardMaterial=!0;Ka.prototype.copy=function(a){S.prototype.copy.call(this,a);this.defines={STANDARD:""};this.color.copy(a.color);this.roughness=a.roughness;this.metalness=a.metalness;this.map=a.map;this.lightMap=a.lightMap;this.lightMapIntensity=a.lightMapIntensity;this.aoMap=a.aoMap;this.aoMapIntensity=a.aoMapIntensity;this.emissive.copy(a.emissive);this.emissiveMap=a.emissiveMap;this.emissiveIntensity=a.emissiveIntensity;this.bumpMap=a.bumpMap;this.bumpScale=a.bumpScale;this.normalMap=
a.normalMap;this.normalScale.copy(a.normalScale);this.displacementMap=a.displacementMap;this.displacementScale=a.displacementScale;this.displacementBias=a.displacementBias;this.roughnessMap=a.roughnessMap;this.metalnessMap=a.metalnessMap;this.alphaMap=a.alphaMap;this.envMap=a.envMap;this.envMapIntensity=a.envMapIntensity;this.refractionRatio=a.refractionRatio;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.wireframeLinecap=a.wireframeLinecap;this.wireframeLinejoin=a.wireframeLinejoin;
this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.morphNormals=a.morphNormals;return this};lb.prototype=Object.create(Ka.prototype);lb.prototype.constructor=lb;lb.prototype.isMeshPhysicalMaterial=!0;lb.prototype.copy=function(a){Ka.prototype.copy.call(this,a);this.defines={PHYSICAL:""};this.reflectivity=a.reflectivity;this.clearCoat=a.clearCoat;this.clearCoatRoughness=a.clearCoatRoughness;return this};$a.prototype=Object.create(S.prototype);$a.prototype.constructor=$a;$a.prototype.isMeshPhongMaterial=
!0;$a.prototype.copy=function(a){S.prototype.copy.call(this,a);this.color.copy(a.color);this.specular.copy(a.specular);this.shininess=a.shininess;this.map=a.map;this.lightMap=a.lightMap;this.lightMapIntensity=a.lightMapIntensity;this.aoMap=a.aoMap;this.aoMapIntensity=a.aoMapIntensity;this.emissive.copy(a.emissive);this.emissiveMap=a.emissiveMap;this.emissiveIntensity=a.emissiveIntensity;this.bumpMap=a.bumpMap;this.bumpScale=a.bumpScale;this.normalMap=a.normalMap;this.normalScale.copy(a.normalScale);
this.displacementMap=a.displacementMap;this.displacementScale=a.displacementScale;this.displacementBias=a.displacementBias;this.specularMap=a.specularMap;this.alphaMap=a.alphaMap;this.envMap=a.envMap;this.combine=a.combine;this.reflectivity=a.reflectivity;this.refractionRatio=a.refractionRatio;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.wireframeLinecap=a.wireframeLinecap;this.wireframeLinejoin=a.wireframeLinejoin;this.skinning=a.skinning;this.morphTargets=a.morphTargets;
this.morphNormals=a.morphNormals;return this};mb.prototype=Object.create(S.prototype);mb.prototype.constructor=mb;mb.prototype.isMeshNormalMaterial=!0;mb.prototype.copy=function(a){S.prototype.copy.call(this,a);this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;return this};nb.prototype=Object.create(S.prototype);nb.prototype.constructor=nb;nb.prototype.isMeshLambertMaterial=!0;nb.prototype.copy=function(a){S.prototype.copy.call(this,a);this.color.copy(a.color);this.map=a.map;
this.lightMap=a.lightMap;this.lightMapIntensity=a.lightMapIntensity;this.aoMap=a.aoMap;this.aoMapIntensity=a.aoMapIntensity;this.emissive.copy(a.emissive);this.emissiveMap=a.emissiveMap;this.emissiveIntensity=a.emissiveIntensity;this.specularMap=a.specularMap;this.alphaMap=a.alphaMap;this.envMap=a.envMap;this.combine=a.combine;this.reflectivity=a.reflectivity;this.refractionRatio=a.refractionRatio;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.wireframeLinecap=a.wireframeLinecap;
this.wireframeLinejoin=a.wireframeLinejoin;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.morphNormals=a.morphNormals;return this};ob.prototype=Object.create(S.prototype);ob.prototype.constructor=ob;ob.prototype.isLineDashedMaterial=!0;ob.prototype.copy=function(a){S.prototype.copy.call(this,a);this.color.copy(a.color);this.linewidth=a.linewidth;this.scale=a.scale;this.dashSize=a.dashSize;this.gapSize=a.gapSize;return this};var nf=Object.freeze({ShadowMaterial:Qb,SpriteMaterial:gb,
RawShaderMaterial:Rb,ShaderMaterial:Da,PointsMaterial:Ja,MultiMaterial:xc,MeshPhysicalMaterial:lb,MeshStandardMaterial:Ka,MeshPhongMaterial:$a,MeshNormalMaterial:mb,MeshLambertMaterial:nb,MeshDepthMaterial:Ua,MeshBasicMaterial:Ia,LineDashedMaterial:ob,LineBasicMaterial:na,Material:S});h.Cache={enabled:!1,files:{},add:function(a,b){!1!==this.enabled&&(this.files[a]=b)},get:function(a){if(!1!==this.enabled)return this.files[a]},remove:function(a){delete this.files[a]},clear:function(){this.files={}}};
h.DefaultLoadingManager=new qd;Object.assign(za.prototype,{load:function(a,b,c,d){void 0!==this.path&&(a=this.path+a);var e=this,f=h.Cache.get(a);if(void 0!==f)return e.manager.itemStart(a),setTimeout(function(){b&&b(f);e.manager.itemEnd(a)},0),f;var g=new XMLHttpRequest;g.open("GET",a,!0);g.addEventListener("load",function(c){var f=c.target.response;h.Cache.add(a,f);200===this.status?(b&&b(f),e.manager.itemEnd(a)):0===this.status?(console.warn("THREE.XHRLoader: HTTP Status 0 received."),b&&b(f),
e.manager.itemEnd(a)):(d&&d(c),e.manager.itemError(a))},!1);void 0!==c&&g.addEventListener("progress",function(a){c(a)},!1);g.addEventListener("error",function(b){d&&d(b);e.manager.itemError(a)},!1);void 0!==this.responseType&&(g.responseType=this.responseType);void 0!==this.withCredentials&&(g.withCredentials=this.withCredentials);g.overrideMimeType&&g.overrideMimeType("text/plain");g.send(null);e.manager.itemStart(a);return g},setPath:function(a){this.path=a;return this},setResponseType:function(a){this.responseType=
a;return this},setWithCredentials:function(a){this.withCredentials=a;return this}});Object.assign(ie.prototype,{load:function(a,b,c,d){function e(e){h.load(a[e],function(a){a=f._parser(a,!0);g[e]={width:a.width,height:a.height,format:a.format,mipmaps:a.mipmaps};m+=1;6===m&&(1===a.mipmapCount&&(k.minFilter=1006),k.format=a.format,k.needsUpdate=!0,b&&b(k))},c,d)}var f=this,g=[],k=new Hb;k.image=g;var h=new za(this.manager);h.setPath(this.path);h.setResponseType("arraybuffer");if(Array.isArray(a))for(var m=
0,q=0,p=a.length;q<p;++q)e(q);else h.load(a,function(a){a=f._parser(a,!0);if(a.isCubemap)for(var c=a.mipmaps.length/a.mipmapCount,d=0;d<c;d++){g[d]={mipmaps:[]};for(var e=0;e<a.mipmapCount;e++)g[d].mipmaps.push(a.mipmaps[d*a.mipmapCount+e]),g[d].format=a.format,g[d].width=a.width,g[d].height=a.height}else k.image.width=a.width,k.image.height=a.height,k.mipmaps=a.mipmaps;1===a.mipmapCount&&(k.minFilter=1006);k.format=a.format;k.needsUpdate=!0;b&&b(k)},c,d);return k},setPath:function(a){this.path=a;
return this}});Object.assign(rd.prototype,{load:function(a,b,c,d){var e=this,f=new hb,g=new za(this.manager);g.setResponseType("arraybuffer");g.load(a,function(a){if(a=e._parser(a))void 0!==a.image?f.image=a.image:void 0!==a.data&&(f.image.width=a.width,f.image.height=a.height,f.image.data=a.data),f.wrapS=void 0!==a.wrapS?a.wrapS:1001,f.wrapT=void 0!==a.wrapT?a.wrapT:1001,f.magFilter=void 0!==a.magFilter?a.magFilter:1006,f.minFilter=void 0!==a.minFilter?a.minFilter:1008,f.anisotropy=void 0!==a.anisotropy?
a.anisotropy:1,void 0!==a.format&&(f.format=a.format),void 0!==a.type&&(f.type=a.type),void 0!==a.mipmaps&&(f.mipmaps=a.mipmaps),1===a.mipmapCount&&(f.minFilter=1006),f.needsUpdate=!0,b&&b(f,a)},c,d);return f}});Object.assign(yc.prototype,{load:function(a,b,c,d){var e=this,f=document.createElementNS("http://www.w3.org/1999/xhtml","img");f.onload=function(){f.onload=null;URL.revokeObjectURL(f.src);b&&b(f);e.manager.itemEnd(a)};if(0===a.indexOf("data:"))f.src=a;else{var g=new za;g.setPath(this.path);
g.setResponseType("blob");g.setWithCredentials(this.withCredentials);g.load(a,function(a){f.src=URL.createObjectURL(a)},c,d)}e.manager.itemStart(a);return f},setCrossOrigin:function(a){this.crossOrigin=a;return this},setWithCredentials:function(a){this.withCredentials=a;return this},setPath:function(a){this.path=a;return this}});Object.assign(sd.prototype,{load:function(a,b,c,d){function e(c){g.load(a[c],function(a){f.images[c]=a;k++;6===k&&(f.needsUpdate=!0,b&&b(f))},void 0,d)}var f=new Ta,g=new yc(this.manager);
g.setCrossOrigin(this.crossOrigin);g.setPath(this.path);var k=0;for(c=0;c<a.length;++c)e(c);return f},setCrossOrigin:function(a){this.crossOrigin=a;return this},setPath:function(a){this.path=a;return this}});Object.assign(Sc.prototype,{load:function(a,b,c,d){var e=new ba,f=new yc(this.manager);f.setCrossOrigin(this.crossOrigin);f.setWithCredentials(this.withCredentials);f.setPath(this.path);f.load(a,function(c){var d=0<a.search(/\.(jpg|jpeg)$/)||0===a.search(/^data\:image\/jpeg/);e.format=d?1022:
1023;e.image=c;e.needsUpdate=!0;void 0!==b&&b(e)},c,d);return e},setCrossOrigin:function(a){this.crossOrigin=a;return this},setWithCredentials:function(a){this.withCredentials=a;return this},setPath:function(a){this.path=a;return this}});oa.prototype=Object.assign(Object.create(D.prototype),{constructor:oa,isLight:!0,copy:function(a){D.prototype.copy.call(this,a);this.color.copy(a.color);this.intensity=a.intensity;return this},toJSON:function(a){a=D.prototype.toJSON.call(this,a);a.object.color=this.color.getHex();
a.object.intensity=this.intensity;void 0!==this.groundColor&&(a.object.groundColor=this.groundColor.getHex());void 0!==this.distance&&(a.object.distance=this.distance);void 0!==this.angle&&(a.object.angle=this.angle);void 0!==this.decay&&(a.object.decay=this.decay);void 0!==this.penumbra&&(a.object.penumbra=this.penumbra);void 0!==this.shadow&&(a.object.shadow=this.shadow.toJSON());return a}});Tc.prototype=Object.assign(Object.create(oa.prototype),{constructor:Tc,isHemisphereLight:!0,copy:function(a){oa.prototype.copy.call(this,
a);this.groundColor.copy(a.groundColor);return this}});Object.assign(pb.prototype,{copy:function(a){this.camera=a.camera.clone();this.bias=a.bias;this.radius=a.radius;this.mapSize.copy(a.mapSize);return this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var a={};0!==this.bias&&(a.bias=this.bias);1!==this.radius&&(a.radius=this.radius);if(512!==this.mapSize.x||512!==this.mapSize.y)a.mapSize=this.mapSize.toArray();a.camera=this.camera.toJSON(!1).object;delete a.camera.matrix;
return a}});Uc.prototype=Object.assign(Object.create(pb.prototype),{constructor:Uc,isSpotLightShadow:!0,update:function(a){var b=2*h.Math.RAD2DEG*a.angle,c=this.mapSize.width/this.mapSize.height;a=a.distance||500;var d=this.camera;if(b!==d.fov||c!==d.aspect||a!==d.far)d.fov=b,d.aspect=c,d.far=a,d.updateProjectionMatrix()}});Vc.prototype=Object.assign(Object.create(oa.prototype),{constructor:Vc,isSpotLight:!0,copy:function(a){oa.prototype.copy.call(this,a);this.distance=a.distance;this.angle=a.angle;
this.penumbra=a.penumbra;this.decay=a.decay;this.target=a.target.clone();this.shadow=a.shadow.clone();return this}});Wc.prototype=Object.assign(Object.create(oa.prototype),{constructor:Wc,isPointLight:!0,copy:function(a){oa.prototype.copy.call(this,a);this.distance=a.distance;this.decay=a.decay;this.shadow=a.shadow.clone();return this}});Xc.prototype=Object.assign(Object.create(pb.prototype),{constructor:Xc});Yc.prototype=Object.assign(Object.create(oa.prototype),{constructor:Yc,isDirectionalLight:!0,
copy:function(a){oa.prototype.copy.call(this,a);this.target=a.target.clone();this.shadow=a.shadow.clone();return this}});Zc.prototype=Object.assign(Object.create(oa.prototype),{constructor:Zc,isAmbientLight:!0});h.AnimationUtils={arraySlice:function(a,b,c){return h.AnimationUtils.isTypedArray(a)?new a.constructor(a.subarray(b,c)):a.slice(b,c)},convertArray:function(a,b,c){return!a||!c&&a.constructor===b?a:"number"===typeof b.BYTES_PER_ELEMENT?new b(a):Array.prototype.slice.call(a)},isTypedArray:function(a){return ArrayBuffer.isView(a)&&
!(a instanceof DataView)},getKeyframeOrder:function(a){for(var b=a.length,c=Array(b),d=0;d!==b;++d)c[d]=d;c.sort(function(b,c){return a[b]-a[c]});return c},sortedArray:function(a,b,c){for(var d=a.length,e=new a.constructor(d),f=0,g=0;g!==d;++f)for(var k=c[f]*b,h=0;h!==b;++h)e[g++]=a[k+h];return e},flattenJSON:function(a,b,c,d){for(var e=1,f=a[0];void 0!==f&&void 0===f[d];)f=a[e++];if(void 0!==f){var g=f[d];if(void 0!==g)if(Array.isArray(g)){do g=f[d],void 0!==g&&(b.push(f.time),c.push.apply(c,g)),
f=a[e++];while(void 0!==f)}else if(void 0!==g.toArray){do g=f[d],void 0!==g&&(b.push(f.time),g.toArray(c,c.length)),f=a[e++];while(void 0!==f)}else{do g=f[d],void 0!==g&&(b.push(f.time),c.push(g)),f=a[e++];while(void 0!==f)}}}};ja.prototype={constructor:ja,evaluate:function(a){var b=this.parameterPositions,c=this._cachedIndex,d=b[c],e=b[c-1];a:{b:{c:{d:if(!(a<d)){for(var f=c+2;;){if(void 0===d){if(a<e)break d;this._cachedIndex=c=b.length;return this.afterEnd_(c-1,a,e)}if(c===f)break;e=d;d=b[++c];
if(a<d)break b}d=b.length;break c}if(a>=e)break a;else{f=b[1];a<f&&(c=2,e=f);for(f=c-2;;){if(void 0===e)return this._cachedIndex=0,this.beforeStart_(0,a,d);if(c===f)break;d=e;e=b[--c-1];if(a>=e)break b}d=c;c=0}}for(;c<d;)e=c+d>>>1,a<b[e]?d=e:c=e+1;d=b[c];e=b[c-1];if(void 0===e)return this._cachedIndex=0,this.beforeStart_(0,a,d);if(void 0===d)return this._cachedIndex=c=b.length,this.afterEnd_(c-1,e,a)}this._cachedIndex=c;this.intervalChanged_(c,e,d)}return this.interpolate_(c,e,a,d)},settings:null,
DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(a){var b=this.resultBuffer,c=this.sampleValues,d=this.valueSize;a*=d;for(var e=0;e!==d;++e)b[e]=c[a+e];return b},interpolate_:function(a,b,c,d){throw Error("call to abstract method");},intervalChanged_:function(a,b,c){}};Object.assign(ja.prototype,{beforeStart_:ja.prototype.copySampleValue_,afterEnd_:ja.prototype.copySampleValue_});$c.prototype=Object.assign(Object.create(ja.prototype),
{constructor:$c,DefaultSettings_:{endingStart:2400,endingEnd:2400},intervalChanged_:function(a,b,c){var d=this.parameterPositions,e=a-2,f=a+1,g=d[e],k=d[f];if(void 0===g)switch(this.getSettings_().endingStart){case 2401:e=a;g=2*b-c;break;case 2402:e=d.length-2;g=b+d[e]-d[e+1];break;default:e=a,g=c}if(void 0===k)switch(this.getSettings_().endingEnd){case 2401:f=a;k=2*c-b;break;case 2402:f=1;k=c+d[1]-d[0];break;default:f=a-1,k=b}a=.5*(c-b);d=this.valueSize;this._weightPrev=a/(b-g);this._weightNext=
a/(k-c);this._offsetPrev=e*d;this._offsetNext=f*d},interpolate_:function(a,b,c,d){var e=this.resultBuffer,f=this.sampleValues,g=this.valueSize;a*=g;var k=a-g,h=this._offsetPrev,m=this._offsetNext,q=this._weightPrev,p=this._weightNext,n=(c-b)/(d-b);c=n*n;d=c*n;b=-q*d+2*q*c-q*n;q=(1+q)*d+(-1.5-2*q)*c+(-.5+q)*n+1;n=(-1-p)*d+(1.5+p)*c+.5*n;p=p*d-p*c;for(c=0;c!==g;++c)e[c]=b*f[h+c]+q*f[k+c]+n*f[a+c]+p*f[m+c];return e}});zc.prototype=Object.assign(Object.create(ja.prototype),{constructor:zc,interpolate_:function(a,
b,c,d){var e=this.resultBuffer,f=this.sampleValues,g=this.valueSize;a*=g;var k=a-g;b=(c-b)/(d-b);c=1-b;for(d=0;d!==g;++d)e[d]=f[k+d]*c+f[a+d]*b;return e}});ad.prototype=Object.assign(Object.create(ja.prototype),{constructor:ad,interpolate_:function(a,b,c,d){return this.copySampleValue_(a-1)}});var Sa;Sa={TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:2301,InterpolantFactoryMethodDiscrete:function(a){return new ad(this.times,this.values,this.getValueSize(),a)},InterpolantFactoryMethodLinear:function(a){return new zc(this.times,
this.values,this.getValueSize(),a)},InterpolantFactoryMethodSmooth:function(a){return new $c(this.times,this.values,this.getValueSize(),a)},setInterpolation:function(a){var b;switch(a){case 2300:b=this.InterpolantFactoryMethodDiscrete;break;case 2301:b=this.InterpolantFactoryMethodLinear;break;case 2302:b=this.InterpolantFactoryMethodSmooth}if(void 0===b){b="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant)if(a!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);
else throw Error(b);console.warn(b)}else this.createInterpolant=b},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}},getValueSize:function(){return this.values.length/this.times.length},shift:function(a){if(0!==a)for(var b=this.times,c=0,d=b.length;c!==d;++c)b[c]+=a;return this},scale:function(a){if(1!==a)for(var b=this.times,c=
0,d=b.length;c!==d;++c)b[c]*=a;return this},trim:function(a,b){for(var c=this.times,d=c.length,e=0,f=d-1;e!==d&&c[e]<a;)++e;for(;-1!==f&&c[f]>b;)--f;++f;if(0!==e||f!==d)e>=f&&(f=Math.max(f,1),e=f-1),d=this.getValueSize(),this.times=h.AnimationUtils.arraySlice(c,e,f),this.values=h.AnimationUtils.arraySlice(this.values,e*d,f*d);return this},validate:function(){var a=!0,b=this.getValueSize();0!==b-Math.floor(b)&&(console.error("invalid value size in track",this),a=!1);var c=this.times,b=this.values,
d=c.length;0===d&&(console.error("track is empty",this),a=!1);for(var e=null,f=0;f!==d;f++){var g=c[f];if("number"===typeof g&&isNaN(g)){console.error("time is not a valid number",this,f,g);a=!1;break}if(null!==e&&e>g){console.error("out of order keys",this,f,g,e);a=!1;break}e=g}if(void 0!==b&&h.AnimationUtils.isTypedArray(b))for(f=0,c=b.length;f!==c;++f)if(d=b[f],isNaN(d)){console.error("value is not a valid number",this,f,d);a=!1;break}return a},optimize:function(){for(var a=this.times,b=this.values,
c=this.getValueSize(),d=2302===this.getInterpolation(),e=1,f=a.length-1,g=1;g<f;++g){var k=!1,l=a[g];if(l!==a[g+1]&&(1!==g||l!==l[0]))if(d)k=!0;else for(var m=g*c,q=m-c,p=m+c,l=0;l!==c;++l){var n=b[m+l];if(n!==b[q+l]||n!==b[p+l]){k=!0;break}}if(k){if(g!==e)for(a[e]=a[g],k=g*c,m=e*c,l=0;l!==c;++l)b[m+l]=b[k+l];++e}}if(0<f){a[e]=a[f];k=f*c;m=e*c;for(l=0;l!==c;++l)b[m+l]=b[k+l];++e}e!==a.length&&(this.times=h.AnimationUtils.arraySlice(a,0,e),this.values=h.AnimationUtils.arraySlice(b,0,e*c));return this}};
Sb.prototype=Object.assign(Object.create(Sa),{constructor:Sb,ValueTypeName:"vector"});bd.prototype=Object.assign(Object.create(ja.prototype),{constructor:bd,interpolate_:function(a,b,c,d){var e=this.resultBuffer,f=this.sampleValues,g=this.valueSize;a*=g;b=(c-b)/(d-b);for(c=a+g;a!==c;a+=4)ca.slerpFlat(e,0,f,a-g,f,a,b);return e}});Ac.prototype=Object.assign(Object.create(Sa),{constructor:Ac,ValueTypeName:"quaternion",DefaultInterpolation:2301,InterpolantFactoryMethodLinear:function(a){return new bd(this.times,
this.values,this.getValueSize(),a)},InterpolantFactoryMethodSmooth:void 0});Tb.prototype=Object.assign(Object.create(Sa),{constructor:Tb,ValueTypeName:"number"});cd.prototype=Object.assign(Object.create(Sa),{constructor:cd,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0});dd.prototype=Object.assign(Object.create(Sa),{constructor:dd,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:2300,
InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0});ed.prototype=Object.assign(Object.create(Sa),{constructor:ed,ValueTypeName:"color"});rb.prototype=Sa;Sa.constructor=rb;Object.assign(rb,{parse:function(a){if(void 0===a.type)throw Error("track type undefined, can not parse");var b=rb._getTrackTypeForValueTypeName(a.type);if(void 0===a.times){var c=[],d=[];h.AnimationUtils.flattenJSON(a.keys,c,d,"value");a.times=c;a.values=d}return void 0!==b.parse?b.parse(a):new b(a.name,
a.times,a.values,a.interpolation)},toJSON:function(a){var b=a.constructor;if(void 0!==b.toJSON)b=b.toJSON(a);else{var b={name:a.name,times:h.AnimationUtils.convertArray(a.times,Array),values:h.AnimationUtils.convertArray(a.values,Array)},c=a.getInterpolation();c!==a.DefaultInterpolation&&(b.interpolation=c)}b.type=a.ValueTypeName;return b},_getTrackTypeForValueTypeName:function(a){switch(a.toLowerCase()){case "scalar":case "double":case "float":case "number":case "integer":return Tb;case "vector":case "vector2":case "vector3":case "vector4":return Sb;
case "color":return ed;case "quaternion":return Ac;case "bool":case "boolean":return dd;case "string":return cd}throw Error("Unsupported typeName: "+a);}});ta.prototype={constructor:ta,resetDuration:function(){for(var a=0,b=0,c=this.tracks.length;b!==c;++b)var d=this.tracks[b],a=Math.max(a,d.times[d.times.length-1]);this.duration=a},trim:function(){for(var a=0;a<this.tracks.length;a++)this.tracks[a].trim(0,this.duration);return this},optimize:function(){for(var a=0;a<this.tracks.length;a++)this.tracks[a].optimize();
return this}};Object.assign(ta,{parse:function(a){for(var b=[],c=a.tracks,d=1/(a.fps||1),e=0,f=c.length;e!==f;++e)b.push(rb.parse(c[e]).scale(d));return new ta(a.name,a.duration,b)},toJSON:function(a){var b=[],c=a.tracks;a={name:a.name,duration:a.duration,tracks:b};for(var d=0,e=c.length;d!==e;++d)b.push(rb.toJSON(c[d]));return a},CreateFromMorphTargetSequence:function(a,b,c,d){for(var e=b.length,f=[],g=0;g<e;g++){var k=[],l=[];k.push((g+e-1)%e,g,(g+1)%e);l.push(0,1,0);var m=h.AnimationUtils.getKeyframeOrder(k),
k=h.AnimationUtils.sortedArray(k,1,m),l=h.AnimationUtils.sortedArray(l,1,m);d||0!==k[0]||(k.push(e),l.push(l[0]));f.push((new Tb(".morphTargetInfluences["+b[g].name+"]",k,l)).scale(1/c))}return new ta(a,-1,f)},findByName:function(a,b){var c=a;Array.isArray(a)||(c=a.geometry&&a.geometry.animations||a.animations);for(var d=0;d<c.length;d++)if(c[d].name===b)return c[d];return null},CreateClipsFromMorphTargetSequences:function(a,b,c){for(var d={},e=/^([\w-]*?)([\d]+)$/,f=0,g=a.length;f<g;f++){var k=a[f],
h=k.name.match(e);if(h&&1<h.length){var m=h[1];(h=d[m])||(d[m]=h=[]);h.push(k)}}a=[];for(m in d)a.push(ta.CreateFromMorphTargetSequence(m,d[m],b,c));return a},parseAnimation:function(a,b){if(!a)return console.error("  no animation in JSONLoader data"),null;for(var c=function(a,b,c,d,e){if(0!==c.length){var f=[],g=[];h.AnimationUtils.flattenJSON(c,f,g,d);0!==f.length&&e.push(new a(b,f,g))}},d=[],e=a.name||"default",f=a.length||-1,g=a.fps||30,k=a.hierarchy||[],l=0;l<k.length;l++){var m=k[l].keys;if(m&&
0!==m.length)if(m[0].morphTargets){for(var f={},q=0;q<m.length;q++)if(m[q].morphTargets)for(var p=0;p<m[q].morphTargets.length;p++)f[m[q].morphTargets[p]]=-1;for(var n in f){for(var r=[],t=[],p=0;p!==m[q].morphTargets.length;++p){var v=m[q];r.push(v.time);t.push(v.morphTarget===n?1:0)}d.push(new Tb(".morphTargetInfluence["+n+"]",r,t))}f=f.length*(g||1)}else q=".bones["+b[l].name+"]",c(Sb,q+".position",m,"pos",d),c(Ac,q+".quaternion",m,"rot",d),c(Sb,q+".scale",m,"scl",d)}return 0===d.length?null:new ta(e,
f,d)}});Object.assign(fd.prototype,{load:function(a,b,c,d){var e=this;(new za(e.manager)).load(a,function(a){b(e.parse(JSON.parse(a)))},c,d)},setTextures:function(a){this.textures=a},parse:function(a){function b(a){void 0===c[a]&&console.warn("THREE.MaterialLoader: Undefined texture",a);return c[a]}var c=this.textures,d=new nf[a.type];void 0!==a.uuid&&(d.uuid=a.uuid);void 0!==a.name&&(d.name=a.name);void 0!==a.color&&d.color.setHex(a.color);void 0!==a.roughness&&(d.roughness=a.roughness);void 0!==
a.metalness&&(d.metalness=a.metalness);void 0!==a.emissive&&d.emissive.setHex(a.emissive);void 0!==a.specular&&d.specular.setHex(a.specular);void 0!==a.shininess&&(d.shininess=a.shininess);void 0!==a.uniforms&&(d.uniforms=a.uniforms);void 0!==a.vertexShader&&(d.vertexShader=a.vertexShader);void 0!==a.fragmentShader&&(d.fragmentShader=a.fragmentShader);void 0!==a.vertexColors&&(d.vertexColors=a.vertexColors);void 0!==a.fog&&(d.fog=a.fog);void 0!==a.shading&&(d.shading=a.shading);void 0!==a.blending&&
(d.blending=a.blending);void 0!==a.side&&(d.side=a.side);void 0!==a.opacity&&(d.opacity=a.opacity);void 0!==a.transparent&&(d.transparent=a.transparent);void 0!==a.alphaTest&&(d.alphaTest=a.alphaTest);void 0!==a.depthTest&&(d.depthTest=a.depthTest);void 0!==a.depthWrite&&(d.depthWrite=a.depthWrite);void 0!==a.colorWrite&&(d.colorWrite=a.colorWrite);void 0!==a.wireframe&&(d.wireframe=a.wireframe);void 0!==a.wireframeLinewidth&&(d.wireframeLinewidth=a.wireframeLinewidth);void 0!==a.wireframeLinecap&&
(d.wireframeLinecap=a.wireframeLinecap);void 0!==a.wireframeLinejoin&&(d.wireframeLinejoin=a.wireframeLinejoin);void 0!==a.skinning&&(d.skinning=a.skinning);void 0!==a.morphTargets&&(d.morphTargets=a.morphTargets);void 0!==a.size&&(d.size=a.size);void 0!==a.sizeAttenuation&&(d.sizeAttenuation=a.sizeAttenuation);void 0!==a.map&&(d.map=b(a.map));void 0!==a.alphaMap&&(d.alphaMap=b(a.alphaMap),d.transparent=!0);void 0!==a.bumpMap&&(d.bumpMap=b(a.bumpMap));void 0!==a.bumpScale&&(d.bumpScale=a.bumpScale);
void 0!==a.normalMap&&(d.normalMap=b(a.normalMap));if(void 0!==a.normalScale){var e=a.normalScale;!1===Array.isArray(e)&&(e=[e,e]);d.normalScale=(new C).fromArray(e)}void 0!==a.displacementMap&&(d.displacementMap=b(a.displacementMap));void 0!==a.displacementScale&&(d.displacementScale=a.displacementScale);void 0!==a.displacementBias&&(d.displacementBias=a.displacementBias);void 0!==a.roughnessMap&&(d.roughnessMap=b(a.roughnessMap));void 0!==a.metalnessMap&&(d.metalnessMap=b(a.metalnessMap));void 0!==
a.emissiveMap&&(d.emissiveMap=b(a.emissiveMap));void 0!==a.emissiveIntensity&&(d.emissiveIntensity=a.emissiveIntensity);void 0!==a.specularMap&&(d.specularMap=b(a.specularMap));void 0!==a.envMap&&(d.envMap=b(a.envMap));void 0!==a.reflectivity&&(d.reflectivity=a.reflectivity);void 0!==a.lightMap&&(d.lightMap=b(a.lightMap));void 0!==a.lightMapIntensity&&(d.lightMapIntensity=a.lightMapIntensity);void 0!==a.aoMap&&(d.aoMap=b(a.aoMap));void 0!==a.aoMapIntensity&&(d.aoMapIntensity=a.aoMapIntensity);if(void 0!==
a.materials)for(var e=0,f=a.materials.length;e<f;e++)d.materials.push(this.parse(a.materials[e]));return d}});Object.assign(td.prototype,{load:function(a,b,c,d){var e=this;(new za(e.manager)).load(a,function(a){b(e.parse(JSON.parse(a)))},c,d)},parse:function(a){var b=new I,c=a.data.index,d={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};
void 0!==c&&(c=new d[c.type](c.array),b.setIndex(new z(c,1)));var e=a.data.attributes,f;for(f in e){var g=e[f],c=new d[g.type](g.array);b.addAttribute(f,new z(c,g.itemSize,g.normalized))}d=a.data.groups||a.data.drawcalls||a.data.offsets;if(void 0!==d)for(f=0,c=d.length;f!==c;++f)e=d[f],b.addGroup(e.start,e.count,e.materialIndex);a=a.data.boundingSphere;void 0!==a&&(d=new q,void 0!==a.center&&d.fromArray(a.center),b.boundingSphere=new Aa(d,a.radius));return b}});sb.prototype={constructor:sb,crossOrigin:void 0,
extractUrlBase:function(a){a=a.split("/");if(1===a.length)return"./";a.pop();return a.join("/")+"/"},initMaterials:function(a,b,c){for(var d=[],e=0;e<a.length;++e)d[e]=this.createMaterial(a[e],b,c);return d},createMaterial:function(){var a,b,c;return function(d,e,f){function g(a,c,d,g,l){a=e+a;var m=sb.Handlers.get(a);null!==m?a=m.load(a):(b.setCrossOrigin(f),a=b.load(a));void 0!==c&&(a.repeat.fromArray(c),1!==c[0]&&(a.wrapS=1E3),1!==c[1]&&(a.wrapT=1E3));void 0!==d&&a.offset.fromArray(d);void 0!==
g&&("repeat"===g[0]&&(a.wrapS=1E3),"mirror"===g[0]&&(a.wrapS=1002),"repeat"===g[1]&&(a.wrapT=1E3),"mirror"===g[1]&&(a.wrapT=1002));void 0!==l&&(a.anisotropy=l);c=h.Math.generateUUID();k[c]=a;return c}void 0===a&&(a=new H);void 0===b&&(b=new Sc);void 0===c&&(c=new fd);var k={},l={uuid:h.Math.generateUUID(),type:"MeshLambertMaterial"},m;for(m in d){var q=d[m];switch(m){case "DbgColor":case "DbgIndex":case "opticalDensity":case "illumination":break;case "DbgName":l.name=q;break;case "blending":l.blending=
qe[q];break;case "colorAmbient":case "mapAmbient":console.warn("THREE.Loader.createMaterial:",m,"is no longer supported.");break;case "colorDiffuse":l.color=a.fromArray(q).getHex();break;case "colorSpecular":l.specular=a.fromArray(q).getHex();break;case "colorEmissive":l.emissive=a.fromArray(q).getHex();break;case "specularCoef":l.shininess=q;break;case "shading":"basic"===q.toLowerCase()&&(l.type="MeshBasicMaterial");"phong"===q.toLowerCase()&&(l.type="MeshPhongMaterial");"standard"===q.toLowerCase()&&
(l.type="MeshStandardMaterial");break;case "mapDiffuse":l.map=g(q,d.mapDiffuseRepeat,d.mapDiffuseOffset,d.mapDiffuseWrap,d.mapDiffuseAnisotropy);break;case "mapDiffuseRepeat":case "mapDiffuseOffset":case "mapDiffuseWrap":case "mapDiffuseAnisotropy":break;case "mapEmissive":l.emissiveMap=g(q,d.mapEmissiveRepeat,d.mapEmissiveOffset,d.mapEmissiveWrap,d.mapEmissiveAnisotropy);break;case "mapEmissiveRepeat":case "mapEmissiveOffset":case "mapEmissiveWrap":case "mapEmissiveAnisotropy":break;case "mapLight":l.lightMap=
g(q,d.mapLightRepeat,d.mapLightOffset,d.mapLightWrap,d.mapLightAnisotropy);break;case "mapLightRepeat":case "mapLightOffset":case "mapLightWrap":case "mapLightAnisotropy":break;case "mapAO":l.aoMap=g(q,d.mapAORepeat,d.mapAOOffset,d.mapAOWrap,d.mapAOAnisotropy);break;case "mapAORepeat":case "mapAOOffset":case "mapAOWrap":case "mapAOAnisotropy":break;case "mapBump":l.bumpMap=g(q,d.mapBumpRepeat,d.mapBumpOffset,d.mapBumpWrap,d.mapBumpAnisotropy);break;case "mapBumpScale":l.bumpScale=q;break;case "mapBumpRepeat":case "mapBumpOffset":case "mapBumpWrap":case "mapBumpAnisotropy":break;
case "mapNormal":l.normalMap=g(q,d.mapNormalRepeat,d.mapNormalOffset,d.mapNormalWrap,d.mapNormalAnisotropy);break;case "mapNormalFactor":l.normalScale=[q,q];break;case "mapNormalRepeat":case "mapNormalOffset":case "mapNormalWrap":case "mapNormalAnisotropy":break;case "mapSpecular":l.specularMap=g(q,d.mapSpecularRepeat,d.mapSpecularOffset,d.mapSpecularWrap,d.mapSpecularAnisotropy);break;case "mapSpecularRepeat":case "mapSpecularOffset":case "mapSpecularWrap":case "mapSpecularAnisotropy":break;case "mapMetalness":l.metalnessMap=
g(q,d.mapMetalnessRepeat,d.mapMetalnessOffset,d.mapMetalnessWrap,d.mapMetalnessAnisotropy);break;case "mapMetalnessRepeat":case "mapMetalnessOffset":case "mapMetalnessWrap":case "mapMetalnessAnisotropy":break;case "mapRoughness":l.roughnessMap=g(q,d.mapRoughnessRepeat,d.mapRoughnessOffset,d.mapRoughnessWrap,d.mapRoughnessAnisotropy);break;case "mapRoughnessRepeat":case "mapRoughnessOffset":case "mapRoughnessWrap":case "mapRoughnessAnisotropy":break;case "mapAlpha":l.alphaMap=g(q,d.mapAlphaRepeat,
d.mapAlphaOffset,d.mapAlphaWrap,d.mapAlphaAnisotropy);break;case "mapAlphaRepeat":case "mapAlphaOffset":case "mapAlphaWrap":case "mapAlphaAnisotropy":break;case "flipSided":l.side=1;break;case "doubleSided":l.side=2;break;case "transparency":console.warn("THREE.Loader.createMaterial: transparency has been renamed to opacity");l.opacity=q;break;case "depthTest":case "depthWrite":case "colorWrite":case "opacity":case "reflectivity":case "transparent":case "visible":case "wireframe":l[m]=q;break;case "vertexColors":!0===
q&&(l.vertexColors=2);"face"===q&&(l.vertexColors=1);break;default:console.error("THREE.Loader.createMaterial: Unsupported",m,q)}}"MeshBasicMaterial"===l.type&&delete l.emissive;"MeshPhongMaterial"!==l.type&&delete l.specular;1>l.opacity&&(l.transparent=!0);c.setTextures(k);return c.parse(l)}}()};sb.Handlers={handlers:[],add:function(a,b){this.handlers.push(a,b)},get:function(a){for(var b=this.handlers,c=0,d=b.length;c<d;c+=2){var e=b[c+1];if(b[c].test(a))return e}return null}};Object.assign(ud.prototype,
{load:function(a,b,c,d){var e=this,f=this.texturePath&&"string"===typeof this.texturePath?this.texturePath:sb.prototype.extractUrlBase(a),g=new za(this.manager);g.setWithCredentials(this.withCredentials);g.load(a,function(c){c=JSON.parse(c);var d=c.metadata;if(void 0!==d&&(d=d.type,void 0!==d)){if("object"===d.toLowerCase()){console.error("THREE.JSONLoader: "+a+" should be loaded with THREE.ObjectLoader instead.");return}if("scene"===d.toLowerCase()){console.error("THREE.JSONLoader: "+a+" should be loaded with THREE.SceneLoader instead.");
return}}c=e.parse(c,f);b(c.geometry,c.materials)},c,d)},setTexturePath:function(a){this.texturePath=a},parse:function(a,b){var c=new R,d=void 0!==a.scale?1/a.scale:1;(function(b){var d,g,k,h,m,u,p,n,r,t,v,A,w,x=a.faces;u=a.vertices;var z=a.normals,y=a.colors,F=0;if(void 0!==a.uvs){for(d=0;d<a.uvs.length;d++)a.uvs[d].length&&F++;for(d=0;d<F;d++)c.faceVertexUvs[d]=[]}h=0;for(m=u.length;h<m;)d=new q,d.x=u[h++]*b,d.y=u[h++]*b,d.z=u[h++]*b,c.vertices.push(d);h=0;for(m=x.length;h<m;)if(b=x[h++],r=b&1,k=
b&2,d=b&8,p=b&16,t=b&32,u=b&64,b&=128,r){r=new ga;r.a=x[h];r.b=x[h+1];r.c=x[h+3];v=new ga;v.a=x[h+1];v.b=x[h+2];v.c=x[h+3];h+=4;k&&(k=x[h++],r.materialIndex=k,v.materialIndex=k);k=c.faces.length;if(d)for(d=0;d<F;d++)for(A=a.uvs[d],c.faceVertexUvs[d][k]=[],c.faceVertexUvs[d][k+1]=[],g=0;4>g;g++)n=x[h++],w=A[2*n],n=A[2*n+1],w=new C(w,n),2!==g&&c.faceVertexUvs[d][k].push(w),0!==g&&c.faceVertexUvs[d][k+1].push(w);p&&(p=3*x[h++],r.normal.set(z[p++],z[p++],z[p]),v.normal.copy(r.normal));if(t)for(d=0;4>
d;d++)p=3*x[h++],t=new q(z[p++],z[p++],z[p]),2!==d&&r.vertexNormals.push(t),0!==d&&v.vertexNormals.push(t);u&&(u=x[h++],u=y[u],r.color.setHex(u),v.color.setHex(u));if(b)for(d=0;4>d;d++)u=x[h++],u=y[u],2!==d&&r.vertexColors.push(new H(u)),0!==d&&v.vertexColors.push(new H(u));c.faces.push(r);c.faces.push(v)}else{r=new ga;r.a=x[h++];r.b=x[h++];r.c=x[h++];k&&(k=x[h++],r.materialIndex=k);k=c.faces.length;if(d)for(d=0;d<F;d++)for(A=a.uvs[d],c.faceVertexUvs[d][k]=[],g=0;3>g;g++)n=x[h++],w=A[2*n],n=A[2*n+
1],w=new C(w,n),c.faceVertexUvs[d][k].push(w);p&&(p=3*x[h++],r.normal.set(z[p++],z[p++],z[p]));if(t)for(d=0;3>d;d++)p=3*x[h++],t=new q(z[p++],z[p++],z[p]),r.vertexNormals.push(t);u&&(u=x[h++],r.color.setHex(y[u]));if(b)for(d=0;3>d;d++)u=x[h++],r.vertexColors.push(new H(y[u]));c.faces.push(r)}})(d);(function(){var b=void 0!==a.influencesPerVertex?a.influencesPerVertex:2;if(a.skinWeights)for(var d=0,g=a.skinWeights.length;d<g;d+=b)c.skinWeights.push(new da(a.skinWeights[d],1<b?a.skinWeights[d+1]:0,
2<b?a.skinWeights[d+2]:0,3<b?a.skinWeights[d+3]:0));if(a.skinIndices)for(d=0,g=a.skinIndices.length;d<g;d+=b)c.skinIndices.push(new da(a.skinIndices[d],1<b?a.skinIndices[d+1]:0,2<b?a.skinIndices[d+2]:0,3<b?a.skinIndices[d+3]:0));c.bones=a.bones;c.bones&&0<c.bones.length&&(c.skinWeights.length!==c.skinIndices.length||c.skinIndices.length!==c.vertices.length)&&console.warn("When skinning, number of vertices ("+c.vertices.length+"), skinIndices ("+c.skinIndices.length+"), and skinWeights ("+c.skinWeights.length+
") should match.")})();(function(b){if(void 0!==a.morphTargets)for(var d=0,g=a.morphTargets.length;d<g;d++){c.morphTargets[d]={};c.morphTargets[d].name=a.morphTargets[d].name;c.morphTargets[d].vertices=[];for(var k=c.morphTargets[d].vertices,h=a.morphTargets[d].vertices,m=0,u=h.length;m<u;m+=3){var p=new q;p.x=h[m]*b;p.y=h[m+1]*b;p.z=h[m+2]*b;k.push(p)}}if(void 0!==a.morphColors&&0<a.morphColors.length)for(console.warn('THREE.JSONLoader: "morphColors" no longer supported. Using them as face colors.'),
b=c.faces,k=a.morphColors[0].colors,d=0,g=b.length;d<g;d++)b[d].color.fromArray(k,3*d)})(d);(function(){var b=[],d=[];void 0!==a.animation&&d.push(a.animation);void 0!==a.animations&&(a.animations.length?d=d.concat(a.animations):d.push(a.animations));for(var g=0;g<d.length;g++){var k=ta.parseAnimation(d[g],c.bones);k&&b.push(k)}c.morphTargets&&(d=ta.CreateClipsFromMorphTargetSequences(c.morphTargets,10),b=b.concat(d));0<b.length&&(c.animations=b)})();c.computeFaceNormals();c.computeBoundingSphere();
if(void 0===a.materials||0===a.materials.length)return{geometry:c};d=sb.prototype.initMaterials(a.materials,b,this.crossOrigin);return{geometry:c,materials:d}}});Object.assign(je.prototype,{load:function(a,b,c,d){""===this.texturePath&&(this.texturePath=a.substring(0,a.lastIndexOf("/")+1));var e=this;(new za(e.manager)).load(a,function(a){e.parse(JSON.parse(a),b)},c,d)},setTexturePath:function(a){this.texturePath=a},setCrossOrigin:function(a){this.crossOrigin=a},parse:function(a,b){var c=this.parseGeometries(a.geometries),
d=this.parseImages(a.images,function(){void 0!==b&&b(e)}),d=this.parseTextures(a.textures,d),d=this.parseMaterials(a.materials,d),e=this.parseObject(a.object,c,d);a.animations&&(e.animations=this.parseAnimations(a.animations));void 0!==a.images&&0!==a.images.length||void 0===b||b(e);return e},parseGeometries:function(a){var b={};if(void 0!==a)for(var c=new ud,d=new td,e=0,f=a.length;e<f;e++){var g,k=a[e];switch(k.type){case "PlaneGeometry":case "PlaneBufferGeometry":g=new ua[k.type](k.width,k.height,
k.widthSegments,k.heightSegments);break;case "BoxGeometry":case "BoxBufferGeometry":case "CubeGeometry":g=new ua[k.type](k.width,k.height,k.depth,k.widthSegments,k.heightSegments,k.depthSegments);break;case "CircleGeometry":case "CircleBufferGeometry":g=new ua[k.type](k.radius,k.segments,k.thetaStart,k.thetaLength);break;case "CylinderGeometry":case "CylinderBufferGeometry":g=new ua[k.type](k.radiusTop,k.radiusBottom,k.height,k.radialSegments,k.heightSegments,k.openEnded,k.thetaStart,k.thetaLength);
break;case "ConeGeometry":case "ConeBufferGeometry":g=new ua[k.type](k.radius,k.height,k.radialSegments,k.heightSegments,k.openEnded,k.thetaStart,k.thetaLength);break;case "SphereGeometry":case "SphereBufferGeometry":g=new ua[k.type](k.radius,k.widthSegments,k.heightSegments,k.phiStart,k.phiLength,k.thetaStart,k.thetaLength);break;case "DodecahedronGeometry":case "IcosahedronGeometry":case "OctahedronGeometry":case "TetrahedronGeometry":g=new ua[k.type](k.radius,k.detail);break;case "RingGeometry":case "RingBufferGeometry":g=
new ua[k.type](k.innerRadius,k.outerRadius,k.thetaSegments,k.phiSegments,k.thetaStart,k.thetaLength);break;case "TorusGeometry":case "TorusBufferGeometry":g=new ua[k.type](k.radius,k.tube,k.radialSegments,k.tubularSegments,k.arc);break;case "TorusKnotGeometry":case "TorusKnotBufferGeometry":g=new ua[k.type](k.radius,k.tube,k.tubularSegments,k.radialSegments,k.p,k.q);break;case "LatheGeometry":case "LatheBufferGeometry":g=new ua[k.type](k.points,k.segments,k.phiStart,k.phiLength);break;case "BufferGeometry":g=
d.parse(k);break;case "Geometry":g=c.parse(k.data,this.texturePath).geometry;break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+k.type+'"');continue}g.uuid=k.uuid;void 0!==k.name&&(g.name=k.name);b[k.uuid]=g}return b},parseMaterials:function(a,b){var c={};if(void 0!==a){var d=new fd;d.setTextures(b);for(var e=0,f=a.length;e<f;e++){var g=d.parse(a[e]);c[g.uuid]=g}}return c},parseAnimations:function(a){for(var b=[],c=0;c<a.length;c++){var d=ta.parse(a[c]);b.push(d)}return b},
parseImages:function(a,b){function c(a){d.manager.itemStart(a);return g.load(a,function(){d.manager.itemEnd(a)},void 0,function(){d.manager.itemError(a)})}var d=this,e={};if(void 0!==a&&0<a.length){var f=new qd(b),g=new yc(f);g.setCrossOrigin(this.crossOrigin);for(var f=0,k=a.length;f<k;f++){var h=a[f],m=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(h.url)?h.url:d.texturePath+h.url;e[h.uuid]=c(m)}}return e},parseTextures:function(a,b){function c(a,b){if("number"===typeof a)return a;console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",
a);return b[a]}var d={};if(void 0!==a)for(var e=0,f=a.length;e<f;e++){var g=a[e];void 0===g.image&&console.warn('THREE.ObjectLoader: No "image" specified for',g.uuid);void 0===b[g.image]&&console.warn("THREE.ObjectLoader: Undefined image",g.image);var k=new ba(b[g.image]);k.needsUpdate=!0;k.uuid=g.uuid;void 0!==g.name&&(k.name=g.name);void 0!==g.mapping&&(k.mapping=c(g.mapping,re));void 0!==g.offset&&k.offset.fromArray(g.offset);void 0!==g.repeat&&k.repeat.fromArray(g.repeat);void 0!==g.wrap&&(k.wrapS=
c(g.wrap[0],Md),k.wrapT=c(g.wrap[1],Md));void 0!==g.minFilter&&(k.minFilter=c(g.minFilter,Nd));void 0!==g.magFilter&&(k.magFilter=c(g.magFilter,Nd));void 0!==g.anisotropy&&(k.anisotropy=g.anisotropy);void 0!==g.flipY&&(k.flipY=g.flipY);d[g.uuid]=k}return d},parseObject:function(){var a=new P;return function(b,c,d){function e(a){void 0===c[a]&&console.warn("THREE.ObjectLoader: Undefined geometry",a);return c[a]}function f(a){if(void 0!==a)return void 0===d[a]&&console.warn("THREE.ObjectLoader: Undefined material",
a),d[a]}var g;switch(b.type){case "Scene":g=new fb;void 0!==b.background&&Number.isInteger(b.background)&&(g.background=new H(b.background));void 0!==b.fog&&("Fog"===b.fog.type?g.fog=new Fb(b.fog.color,b.fog.near,b.fog.far):"FogExp2"===b.fog.type&&(g.fog=new Eb(b.fog.color,b.fog.density)));break;case "PerspectiveCamera":g=new Ca(b.fov,b.aspect,b.near,b.far);void 0!==b.focus&&(g.focus=b.focus);void 0!==b.zoom&&(g.zoom=b.zoom);void 0!==b.filmGauge&&(g.filmGauge=b.filmGauge);void 0!==b.filmOffset&&(g.filmOffset=
b.filmOffset);void 0!==b.view&&(g.view=Object.assign({},b.view));break;case "OrthographicCamera":g=new Db(b.left,b.right,b.top,b.bottom,b.near,b.far);break;case "AmbientLight":g=new Zc(b.color,b.intensity);break;case "DirectionalLight":g=new Yc(b.color,b.intensity);break;case "PointLight":g=new Wc(b.color,b.intensity,b.distance,b.decay);break;case "SpotLight":g=new Vc(b.color,b.intensity,b.distance,b.angle,b.penumbra,b.decay);break;case "HemisphereLight":g=new Tc(b.color,b.groundColor,b.intensity);
break;case "Mesh":g=e(b.geometry);var k=f(b.material);g=g.bones&&0<g.bones.length?new Pc(g,k):new va(g,k);break;case "LOD":g=new gc;break;case "Line":g=new Pa(e(b.geometry),f(b.material),b.mode);break;case "LineSegments":g=new ha(e(b.geometry),f(b.material));break;case "PointCloud":case "Points":g=new Gb(e(b.geometry),f(b.material));break;case "Sprite":g=new fc(f(b.material));break;case "Group":g=new hc;break;default:g=new D}g.uuid=b.uuid;void 0!==b.name&&(g.name=b.name);void 0!==b.matrix?(a.fromArray(b.matrix),
a.decompose(g.position,g.quaternion,g.scale)):(void 0!==b.position&&g.position.fromArray(b.position),void 0!==b.rotation&&g.rotation.fromArray(b.rotation),void 0!==b.quaternion&&g.quaternion.fromArray(b.quaternion),void 0!==b.scale&&g.scale.fromArray(b.scale));void 0!==b.castShadow&&(g.castShadow=b.castShadow);void 0!==b.receiveShadow&&(g.receiveShadow=b.receiveShadow);b.shadow&&(void 0!==b.shadow.bias&&(g.shadow.bias=b.shadow.bias),void 0!==b.shadow.radius&&(g.shadow.radius=b.shadow.radius),void 0!==
b.shadow.mapSize&&g.shadow.mapSize.fromArray(b.shadow.mapSize),void 0!==b.shadow.camera&&(g.shadow.camera=this.parseObject(b.shadow.camera)));void 0!==b.visible&&(g.visible=b.visible);void 0!==b.userData&&(g.userData=b.userData);if(void 0!==b.children)for(var h in b.children)g.add(this.parseObject(b.children[h],c,d));if("LOD"===b.type)for(b=b.levels,k=0;k<b.length;k++){var m=b[k];h=g.getObjectByProperty("uuid",m.object);void 0!==h&&g.addLevel(h,m.distance)}return g}}()});Y.prototype={constructor:Y,
getPoint:function(a){console.warn("THREE.Curve: Warning, getPoint() not implemented!");return null},getPointAt:function(a){a=this.getUtoTmapping(a);return this.getPoint(a)},getPoints:function(a){a||(a=5);for(var b=[],c=0;c<=a;c++)b.push(this.getPoint(c/a));return b},getSpacedPoints:function(a){a||(a=5);for(var b=[],c=0;c<=a;c++)b.push(this.getPointAt(c/a));return b},getLength:function(){var a=this.getLengths();return a[a.length-1]},getLengths:function(a){a||(a=this.__arcLengthDivisions?this.__arcLengthDivisions:
200);if(this.cacheArcLengths&&this.cacheArcLengths.length===a+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var b=[],c,d=this.getPoint(0),e,f=0;b.push(0);for(e=1;e<=a;e++)c=this.getPoint(e/a),f+=c.distanceTo(d),b.push(f),d=c;return this.cacheArcLengths=b},updateArcLengths:function(){this.needsUpdate=!0;this.getLengths()},getUtoTmapping:function(a,b){var c=this.getLengths(),d,e=c.length,f;f=b?b:a*c[e-1];for(var g=0,k=e-1,h;g<=k;)if(d=Math.floor(g+(k-g)/2),h=c[d]-f,0>h)g=d+1;
else if(0<h)k=d-1;else{k=d;break}d=k;if(c[d]===f)return d/(e-1);g=c[d];return(d+(f-g)/(c[d+1]-g))/(e-1)},getTangent:function(a){var b=a-1E-4;a+=1E-4;0>b&&(b=0);1<a&&(a=1);b=this.getPoint(b);return this.getPoint(a).clone().sub(b).normalize()},getTangentAt:function(a){a=this.getUtoTmapping(a);return this.getTangent(a)}};Y.create=function(a,b){a.prototype=Object.create(Y.prototype);a.prototype.constructor=a;a.prototype.getPoint=b;return a};La.prototype=Object.create(Y.prototype);La.prototype.constructor=
La;La.prototype.isLineCurve=!0;La.prototype.getPoint=function(a){if(1===a)return this.v2.clone();var b=this.v2.clone().sub(this.v1);b.multiplyScalar(a).add(this.v1);return b};La.prototype.getPointAt=function(a){return this.getPoint(a)};La.prototype.getTangent=function(a){return this.v2.clone().sub(this.v1).normalize()};Bc.prototype=Object.assign(Object.create(Y.prototype),{constructor:Bc,add:function(a){this.curves.push(a)},closePath:function(){var a=this.curves[0].getPoint(0),b=this.curves[this.curves.length-
1].getPoint(1);a.equals(b)||this.curves.push(new La(b,a))},getPoint:function(a){var b=a*this.getLength(),c=this.getCurveLengths();for(a=0;a<c.length;){if(c[a]>=b)return b=c[a]-b,a=this.curves[a],c=a.getLength(),a.getPointAt(0===c?0:1-b/c);a++}return null},getLength:function(){var a=this.getCurveLengths();return a[a.length-1]},updateArcLengths:function(){this.needsUpdate=!0;this.cacheLengths=null;this.getLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;
for(var a=[],b=0,c=0,d=this.curves.length;c<d;c++)b+=this.curves[c].getLength(),a.push(b);return this.cacheLengths=a},getSpacedPoints:function(a){a||(a=40);for(var b=[],c=0;c<=a;c++)b.push(this.getPoint(c/a));this.autoClose&&b.push(b[0]);return b},getPoints:function(a){a=a||12;for(var b=[],c,d=0,e=this.curves;d<e.length;d++)for(var f=e[d],f=f.getPoints(f&&f.isEllipseCurve?2*a:f&&f.isLineCurve?1:f&&f.isSplineCurve?a*f.points.length:a),g=0;g<f.length;g++){var k=f[g];c&&c.equals(k)||(b.push(k),c=k)}this.autoClose&&
1<b.length&&!b[b.length-1].equals(b[0])&&b.push(b[0]);return b},createPointsGeometry:function(a){a=this.getPoints(a);return this.createGeometry(a)},createSpacedPointsGeometry:function(a){a=this.getSpacedPoints(a);return this.createGeometry(a)},createGeometry:function(a){for(var b=new R,c=0,d=a.length;c<d;c++){var e=a[c];b.vertices.push(new q(e.x,e.y,e.z||0))}return b}});Ra.prototype=Object.create(Y.prototype);Ra.prototype.constructor=Ra;Ra.prototype.isEllipseCurve=!0;Ra.prototype.getPoint=function(a){for(var b=
2*Math.PI,c=this.aEndAngle-this.aStartAngle,d=Math.abs(c)<Number.EPSILON;0>c;)c+=b;for(;c>b;)c-=b;c<Number.EPSILON&&(c=d?0:b);!0!==this.aClockwise||d||(c=c===b?-b:c-b);b=this.aStartAngle+a*c;a=this.aX+this.xRadius*Math.cos(b);var e=this.aY+this.yRadius*Math.sin(b);0!==this.aRotation&&(b=Math.cos(this.aRotation),c=Math.sin(this.aRotation),d=a-this.aX,e-=this.aY,a=d*b-e*c+this.aX,e=d*c+e*b+this.aY);return new C(a,e)};h.CurveUtils={tangentQuadraticBezier:function(a,b,c,d){return 2*(1-a)*(c-b)+2*a*(d-
c)},tangentCubicBezier:function(a,b,c,d,e){return-3*b*(1-a)*(1-a)+3*c*(1-a)*(1-a)-6*a*c*(1-a)+6*a*d*(1-a)-3*a*a*d+3*a*a*e},tangentSpline:function(a,b,c,d,e){return 6*a*a-6*a+(3*a*a-4*a+1)+(-6*a*a+6*a)+(3*a*a-2*a)},interpolate:function(a,b,c,d,e){a=.5*(c-a);d=.5*(d-b);var f=e*e;return(2*b-2*c+a+d)*e*f+(-3*b+3*c-2*a-d)*f+a*e+b}};tb.prototype=Object.create(Y.prototype);tb.prototype.constructor=tb;tb.prototype.isSplineCurve=!0;tb.prototype.getPoint=function(a){var b=this.points;a*=b.length-1;var c=Math.floor(a);
a-=c;var d=b[0===c?c:c-1],e=b[c],f=b[c>b.length-2?b.length-1:c+1],b=b[c>b.length-3?b.length-1:c+2],c=h.CurveUtils.interpolate;return new C(c(d.x,e.x,f.x,b.x,a),c(d.y,e.y,f.y,b.y,a))};ub.prototype=Object.create(Y.prototype);ub.prototype.constructor=ub;ub.prototype.getPoint=function(a){var b=h.ShapeUtils.b3;return new C(b(a,this.v0.x,this.v1.x,this.v2.x,this.v3.x),b(a,this.v0.y,this.v1.y,this.v2.y,this.v3.y))};ub.prototype.getTangent=function(a){var b=h.CurveUtils.tangentCubicBezier;return(new C(b(a,
this.v0.x,this.v1.x,this.v2.x,this.v3.x),b(a,this.v0.y,this.v1.y,this.v2.y,this.v3.y))).normalize()};vb.prototype=Object.create(Y.prototype);vb.prototype.constructor=vb;vb.prototype.getPoint=function(a){var b=h.ShapeUtils.b2;return new C(b(a,this.v0.x,this.v1.x,this.v2.x),b(a,this.v0.y,this.v1.y,this.v2.y))};vb.prototype.getTangent=function(a){var b=h.CurveUtils.tangentQuadraticBezier;return(new C(b(a,this.v0.x,this.v1.x,this.v2.x),b(a,this.v0.y,this.v1.y,this.v2.y))).normalize()};var Od=Object.assign(Object.create(Bc.prototype),
{fromPoints:function(a){this.moveTo(a[0].x,a[0].y);for(var b=1,c=a.length;b<c;b++)this.lineTo(a[b].x,a[b].y)},moveTo:function(a,b){this.currentPoint.set(a,b)},lineTo:function(a,b){var c=new La(this.currentPoint.clone(),new C(a,b));this.curves.push(c);this.currentPoint.set(a,b)},quadraticCurveTo:function(a,b,c,d){a=new vb(this.currentPoint.clone(),new C(a,b),new C(c,d));this.curves.push(a);this.currentPoint.set(c,d)},bezierCurveTo:function(a,b,c,d,e,f){a=new ub(this.currentPoint.clone(),new C(a,b),
new C(c,d),new C(e,f));this.curves.push(a);this.currentPoint.set(e,f)},splineThru:function(a){var b=[this.currentPoint.clone()].concat(a),b=new tb(b);this.curves.push(b);this.currentPoint.copy(a[a.length-1])},arc:function(a,b,c,d,e,f){this.absarc(a+this.currentPoint.x,b+this.currentPoint.y,c,d,e,f)},absarc:function(a,b,c,d,e,f){this.absellipse(a,b,c,c,d,e,f)},ellipse:function(a,b,c,d,e,f,g,k){this.absellipse(a+this.currentPoint.x,b+this.currentPoint.y,c,d,e,f,g,k)},absellipse:function(a,b,c,d,e,f,
g,k){a=new Ra(a,b,c,d,e,f,g,k);0<this.curves.length&&(b=a.getPoint(0),b.equals(this.currentPoint)||this.lineTo(b.x,b.y));this.curves.push(a);a=a.getPoint(1);this.currentPoint.copy(a)}});wb.prototype=Object.assign(Object.create(Od),{constructor:wb,getPointsHoles:function(a){for(var b=[],c=0,d=this.holes.length;c<d;c++)b[c]=this.holes[c].getPoints(a);return b},extractAllPoints:function(a){return{shape:this.getPoints(a),holes:this.getPointsHoles(a)}},extractPoints:function(a){return this.extractAllPoints(a)}});
Cc.prototype=Od;Od.constructor=Cc;vd.prototype={moveTo:function(a,b){this.currentPath=new Cc;this.subPaths.push(this.currentPath);this.currentPath.moveTo(a,b)},lineTo:function(a,b){this.currentPath.lineTo(a,b)},quadraticCurveTo:function(a,b,c,d){this.currentPath.quadraticCurveTo(a,b,c,d)},bezierCurveTo:function(a,b,c,d,e,f){this.currentPath.bezierCurveTo(a,b,c,d,e,f)},splineThru:function(a){this.currentPath.splineThru(a)},toShapes:function(a,b){function c(a){for(var b=[],c=0,d=a.length;c<d;c++){var e=
a[c],f=new wb;f.curves=e.curves;b.push(f)}return b}function d(a,b){for(var c=b.length,d=!1,e=c-1,f=0;f<c;e=f++){var g=b[e],k=b[f],h=k.x-g.x,l=k.y-g.y;if(Math.abs(l)>Number.EPSILON){if(0>l&&(g=b[f],h=-h,k=b[e],l=-l),!(a.y<g.y||a.y>k.y))if(a.y===g.y){if(a.x===g.x)return!0}else{e=l*(a.x-g.x)-h*(a.y-g.y);if(0===e)return!0;0>e||(d=!d)}}else if(a.y===g.y&&(k.x<=a.x&&a.x<=g.x||g.x<=a.x&&a.x<=k.x))return!0}return d}var e=h.ShapeUtils.isClockWise,f=this.subPaths;if(0===f.length)return[];if(!0===b)return c(f);
var g,k,l,m=[];if(1===f.length)return k=f[0],l=new wb,l.curves=k.curves,m.push(l),m;var q=!e(f[0].getPoints()),q=a?!q:q;l=[];var p=[],n=[],r=0,t;p[r]=void 0;n[r]=[];for(var v=0,A=f.length;v<A;v++)k=f[v],t=k.getPoints(),g=e(t),(g=a?!g:g)?(!q&&p[r]&&r++,p[r]={s:new wb,p:t},p[r].s.curves=k.curves,q&&r++,n[r]=[]):n[r].push({h:k,p:t[0]});if(!p[0])return c(f);if(1<p.length){v=!1;k=[];e=0;for(f=p.length;e<f;e++)l[e]=[];e=0;for(f=p.length;e<f;e++)for(g=n[e],q=0;q<g.length;q++){r=g[q];t=!0;for(A=0;A<p.length;A++)d(r.p,
p[A].p)&&(e!==A&&k.push({froms:e,tos:A,hole:q}),t?(t=!1,l[A].push(r)):v=!0);t&&l[e].push(r)}0<k.length&&(v||(n=l))}v=0;for(e=p.length;v<e;v++)for(l=p[v].s,m.push(l),k=n[v],f=0,g=k.length;f<g;f++)l.holes.push(k[f].h);return m}};Object.assign(wd.prototype,{isFont:!0,generateShapes:function(a,b,c){void 0===b&&(b=100);void 0===c&&(c=4);var d=this.data;a=String(a).split("");var e=b/d.resolution,f=0;b=[];for(var g=0;g<a.length;g++){var k;k=e;var l=f,m=d.glyphs[a[g]]||d.glyphs["?"];if(m){var q=new vd,p=
[],n=h.ShapeUtils.b2,r=h.ShapeUtils.b3,t,v,A,w,x,z,y,C;if(m.o)for(var D=m._cachedOutline||(m._cachedOutline=m.o.split(" ")),E=0,J=D.length;E<J;)switch(D[E++]){case "m":t=D[E++]*k+l;v=D[E++]*k;q.moveTo(t,v);break;case "l":t=D[E++]*k+l;v=D[E++]*k;q.lineTo(t,v);break;case "q":t=D[E++]*k+l;v=D[E++]*k;x=D[E++]*k+l;z=D[E++]*k;q.quadraticCurveTo(x,z,t,v);if(w=p[p.length-1]){A=w.x;w=w.y;for(var H=1;H<=c;H++){var I=H/c;n(I,A,x,t);n(I,w,z,v)}}break;case "b":if(t=D[E++]*k+l,v=D[E++]*k,x=D[E++]*k+l,z=D[E++]*
k,y=D[E++]*k+l,C=D[E++]*k,q.bezierCurveTo(x,z,y,C,t,v),w=p[p.length-1])for(A=w.x,w=w.y,H=1;H<=c;H++)I=H/c,r(I,A,x,y,t),r(I,w,z,C,v)}k={offset:m.ha*k,path:q}}else k=void 0;f+=k.offset;b.push(k.path)}c=[];d=0;for(a=b.length;d<a;d++)Array.prototype.push.apply(c,b[d].toShapes());return c}});Object.assign(ke.prototype,{load:function(a,b,c,d){var e=this;(new za(this.manager)).load(a,function(a){var c;try{c=JSON.parse(a)}catch(d){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),
c=JSON.parse(a.substring(65,a.length-2))}a=e.parse(c);b&&b(a)},c,d)},parse:function(a){return new wd(a)}});var yd;Object.assign(zd.prototype,{load:function(a,b,c,d){var e=new za(this.manager);e.setResponseType("arraybuffer");e.load(a,function(a){xd().decodeAudioData(a,function(a){b(a)})},c,d)}});Object.assign(le.prototype,{update:function(){var a,b,c,d,e,f,g,k=new P,l=new P;return function(m){if(a!==this||b!==m.focus||c!==m.fov||d!==m.aspect*this.aspect||e!==m.near||f!==m.far||g!==m.zoom){a=this;
b=m.focus;c=m.fov;d=m.aspect*this.aspect;e=m.near;f=m.far;g=m.zoom;var q=m.projectionMatrix.clone(),p=this.eyeSep/2,n=p*e/b,r=e*Math.tan(h.Math.DEG2RAD*c*.5)/g,t;l.elements[12]=-p;k.elements[12]=p;p=-r*d+n;t=r*d+n;q.elements[0]=2*e/(t-p);q.elements[8]=(t+p)/(t-p);this.cameraL.projectionMatrix.copy(q);p=-r*d-n;t=r*d-n;q.elements[0]=2*e/(t-p);q.elements[8]=(t+p)/(t-p);this.cameraR.projectionMatrix.copy(q)}this.cameraL.matrixWorld.copy(m.matrixWorld).multiply(l);this.cameraR.matrixWorld.copy(m.matrixWorld).multiply(k)}}()});
gd.prototype=Object.create(D.prototype);gd.prototype.constructor=gd;Ad.prototype=Object.assign(Object.create(D.prototype),{constructor:Ad,getInput:function(){return this.gain},removeFilter:function(){null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null)},getFilter:function(){return this.filter},setFilter:function(a){null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):
this.gain.disconnect(this.context.destination);this.filter=a;this.gain.connect(this.filter);this.filter.connect(this.context.destination)},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(a){this.gain.gain.value=a},updateMatrixWorld:function(){var a=new q,b=new ca,c=new q,d=new q;return function(e){D.prototype.updateMatrixWorld.call(this,e);e=this.context.listener;var f=this.up;this.matrixWorld.decompose(a,b,c);d.set(0,0,-1).applyQuaternion(b);e.setPosition(a.x,a.y,
a.z);e.setOrientation(d.x,d.y,d.z,f.x,f.y,f.z)}}()});Ub.prototype=Object.assign(Object.create(D.prototype),{constructor:Ub,getOutput:function(){return this.gain},setNodeSource:function(a){this.hasPlaybackControl=!1;this.sourceType="audioNode";this.source=a;this.connect();return this},setBuffer:function(a){this.source.buffer=a;this.sourceType="buffer";this.autoplay&&this.play();return this},play:function(){if(!0===this.isPlaying)console.warn("THREE.Audio: Audio is already playing.");else if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");
else{var a=this.context.createBufferSource();a.buffer=this.source.buffer;a.loop=this.source.loop;a.onended=this.source.onended;a.start(0,this.startTime);a.playbackRate.value=this.playbackRate;this.isPlaying=!0;this.source=a;return this.connect()}},pause:function(){if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");else return this.source.stop(),this.startTime=this.context.currentTime,this.isPlaying=!1,this},stop:function(){if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");
else return this.source.stop(),this.startTime=0,this.isPlaying=!1,this},connect:function(){if(0<this.filters.length){this.source.connect(this.filters[0]);for(var a=1,b=this.filters.length;a<b;a++)this.filters[a-1].connect(this.filters[a]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(0<this.filters.length){this.source.disconnect(this.filters[0]);for(var a=1,b=this.filters.length;a<b;a++)this.filters[a-
1].disconnect(this.filters[a]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(a){a||(a=[]);!0===this.isPlaying?(this.disconnect(),this.filters=a,this.connect()):this.filters=a;return this},getFilter:function(){return this.getFilters()[0]},setFilter:function(a){return this.setFilters(a?[a]:[])},setPlaybackRate:function(a){if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");
else return this.playbackRate=a,!0===this.isPlaying&&(this.source.playbackRate.value=this.playbackRate),this},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.source.loop},setLoop:function(a){!1===this.hasPlaybackControl?console.warn("THREE.Audio: this Audio has no playback control."):this.source.loop=a},getVolume:function(){return this.gain.gain.value},
setVolume:function(a){this.gain.gain.value=a;return this}});Bd.prototype=Object.assign(Object.create(Ub.prototype),{constructor:Bd,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(a){this.panner.refDistance=a},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(a){this.panner.rolloffFactor=a},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(a){this.panner.distanceModel=
a},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(a){this.panner.maxDistance=a},updateMatrixWorld:function(){var a=new q;return function(b){D.prototype.updateMatrixWorld.call(this,b);a.setFromMatrixPosition(this.matrixWorld);this.panner.setPosition(a.x,a.y,a.z)}}()});Object.assign(Cd.prototype,{getFrequencyData:function(){this.analyser.getByteFrequencyData(this.data);return this.data},getAverageFrequency:function(){for(var a=0,b=this.getFrequencyData(),c=0;c<b.length;c++)a+=
b[c];return a/b.length}});hd.prototype={constructor:hd,accumulate:function(a,b){var c=this.buffer,d=this.valueSize,e=a*d+d,f=this.cumulativeWeight;if(0===f){for(f=0;f!==d;++f)c[e+f]=c[f];f=b}else f+=b,this._mixBufferRegion(c,e,0,b/f,d);this.cumulativeWeight=f},apply:function(a){var b=this.valueSize,c=this.buffer;a=a*b+b;var d=this.cumulativeWeight,e=this.binding;this.cumulativeWeight=0;1>d&&this._mixBufferRegion(c,a,3*b,1-d,b);for(var d=b,f=b+b;d!==f;++d)if(c[d]!==c[d+b]){e.setValue(c,a);break}},
saveOriginalState:function(){var a=this.buffer,b=this.valueSize,c=3*b;this.binding.getValue(a,c);for(var d=b;d!==c;++d)a[d]=a[c+d%b];this.cumulativeWeight=0},restoreOriginalState:function(){this.binding.setValue(this.buffer,3*this.valueSize)},_select:function(a,b,c,d,e){if(.5<=d)for(d=0;d!==e;++d)a[b+d]=a[c+d]},_slerp:function(a,b,c,d,e){ca.slerpFlat(a,b,a,b,a,c,d)},_lerp:function(a,b,c,d,e){for(var f=1-d,g=0;g!==e;++g){var k=b+g;a[k]=a[k]*f+a[c+g]*d}}};ka.prototype={constructor:ka,getValue:function(a,
b){this.bind();this.getValue(a,b)},setValue:function(a,b){this.bind();this.setValue(a,b)},bind:function(){var a=this.node,b=this.parsedPath,c=b.objectName,d=b.propertyName,e=b.propertyIndex;a||(this.node=a=ka.findNode(this.rootNode,b.nodeName)||this.rootNode);this.getValue=this._getValue_unavailable;this.setValue=this._setValue_unavailable;if(a){if(c){var f=b.objectIndex;switch(c){case "materials":if(!a.material){console.error("  can not bind to material as node does not have a material",this);return}if(!a.material.materials){console.error("  can not bind to material.materials as node.material does not have a materials array",
this);return}a=a.material.materials;break;case "bones":if(!a.skeleton){console.error("  can not bind to bones as node does not have a skeleton",this);return}a=a.skeleton.bones;for(c=0;c<a.length;c++)if(a[c].name===f){f=c;break}break;default:if(void 0===a[c]){console.error("  can not bind to objectName of node, undefined",this);return}a=a[c]}if(void 0!==f){if(void 0===a[f]){console.error("  trying to bind to objectIndex of objectName, but is undefined:",this,a);return}a=a[f]}}f=a[d];if(void 0===f)console.error("  trying to update property for track: "+
b.nodeName+"."+d+" but it wasn't found.",a);else{b=this.Versioning.None;void 0!==a.needsUpdate?(b=this.Versioning.NeedsUpdate,this.targetObject=a):void 0!==a.matrixWorldNeedsUpdate&&(b=this.Versioning.MatrixWorldNeedsUpdate,this.targetObject=a);c=this.BindingType.Direct;if(void 0!==e){if("morphTargetInfluences"===d){if(!a.geometry){console.error("  can not bind to morphTargetInfluences becasuse node does not have a geometry",this);return}if(!a.geometry.morphTargets){console.error("  can not bind to morphTargetInfluences becasuse node does not have a geometry.morphTargets",
this);return}for(c=0;c<this.node.geometry.morphTargets.length;c++)if(a.geometry.morphTargets[c].name===e){e=c;break}}c=this.BindingType.ArrayElement;this.resolvedProperty=f;this.propertyIndex=e}else void 0!==f.fromArray&&void 0!==f.toArray?(c=this.BindingType.HasFromToArray,this.resolvedProperty=f):void 0!==f.length?(c=this.BindingType.EntireArray,this.resolvedProperty=f):this.propertyName=d;this.getValue=this.GetterByBindingType[c];this.setValue=this.SetterByBindingTypeAndVersioning[c][b]}}else console.error("  trying to update node for track: "+
this.path+" but it wasn't found.")},unbind:function(){this.node=null;this.getValue=this._getValue_unbound;this.setValue=this._setValue_unbound}};Object.assign(ka.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},_getValue_unbound:ka.prototype.getValue,_setValue_unbound:ka.prototype.setValue,BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(a,b){a[b]=this.node[this.propertyName]},
function(a,b){for(var c=this.resolvedProperty,d=0,e=c.length;d!==e;++d)a[b++]=c[d]},function(a,b){a[b]=this.resolvedProperty[this.propertyIndex]},function(a,b){this.resolvedProperty.toArray(a,b)}],SetterByBindingTypeAndVersioning:[[function(a,b){this.node[this.propertyName]=a[b]},function(a,b){this.node[this.propertyName]=a[b];this.targetObject.needsUpdate=!0},function(a,b){this.node[this.propertyName]=a[b];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(a,b){for(var c=this.resolvedProperty,
d=0,e=c.length;d!==e;++d)c[d]=a[b++]},function(a,b){for(var c=this.resolvedProperty,d=0,e=c.length;d!==e;++d)c[d]=a[b++];this.targetObject.needsUpdate=!0},function(a,b){for(var c=this.resolvedProperty,d=0,e=c.length;d!==e;++d)c[d]=a[b++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(a,b){this.resolvedProperty[this.propertyIndex]=a[b]},function(a,b){this.resolvedProperty[this.propertyIndex]=a[b];this.targetObject.needsUpdate=!0},function(a,b){this.resolvedProperty[this.propertyIndex]=a[b];
this.targetObject.matrixWorldNeedsUpdate=!0}],[function(a,b){this.resolvedProperty.fromArray(a,b)},function(a,b){this.resolvedProperty.fromArray(a,b);this.targetObject.needsUpdate=!0},function(a,b){this.resolvedProperty.fromArray(a,b);this.targetObject.matrixWorldNeedsUpdate=!0}]]});ka.Composite=function(a,b,c){c=c||ka.parseTrackName(b);this._targetGroup=a;this._bindings=a.subscribe_(b,c)};ka.Composite.prototype={constructor:ka.Composite,getValue:function(a,b){this.bind();var c=this._bindings[this._targetGroup.nCachedObjects_];
void 0!==c&&c.getValue(a,b)},setValue:function(a,b){for(var c=this._bindings,d=this._targetGroup.nCachedObjects_,e=c.length;d!==e;++d)c[d].setValue(a,b)},bind:function(){for(var a=this._bindings,b=this._targetGroup.nCachedObjects_,c=a.length;b!==c;++b)a[b].bind()},unbind:function(){for(var a=this._bindings,b=this._targetGroup.nCachedObjects_,c=a.length;b!==c;++b)a[b].unbind()}};ka.create=function(a,b,c){return a&&a.isAnimationObjectGroup?new ka.Composite(a,b,c):new ka(a,b,c)};ka.parseTrackName=function(a){var b=
/^((?:\w+[\/:])*)(\w+)?(?:\.(\w+)(?:\[(.+)\])?)?\.(\w+)(?:\[(.+)\])?$/.exec(a);if(!b)throw Error("cannot parse trackName at all: "+a);b={nodeName:b[2],objectName:b[3],objectIndex:b[4],propertyName:b[5],propertyIndex:b[6]};if(null===b.propertyName||0===b.propertyName.length)throw Error("can not parse propertyName from trackName: "+a);return b};ka.findNode=function(a,b){if(!b||""===b||"root"===b||"."===b||-1===b||b===a.name||b===a.uuid)return a;if(a.skeleton){var c=function(a){for(var c=0;c<a.bones.length;c++){var d=
a.bones[c];if(d.name===b)return d}return null}(a.skeleton);if(c)return c}if(a.children){var d=function(a){for(var c=0;c<a.length;c++){var g=a[c];if(g.name===b||g.uuid===b||(g=d(g.children)))return g}return null};if(c=d(a.children))return c}return null};Dd.prototype={constructor:Dd,isAnimationObjectGroup:!0,add:function(a){for(var b=this._objects,c=b.length,d=this.nCachedObjects_,e=this._indicesByUUID,f=this._paths,g=this._parsedPaths,k=this._bindings,h=k.length,m=0,q=arguments.length;m!==q;++m){var p=
arguments[m],n=p.uuid,r=e[n];if(void 0===r){r=c++;e[n]=r;b.push(p);for(var n=0,t=h;n!==t;++n)k[n].push(new ka(p,f[n],g[n]))}else if(r<d){var v=b[r],A=--d,t=b[A];e[t.uuid]=r;b[r]=t;e[n]=A;b[A]=p;n=0;for(t=h;n!==t;++n){var w=k[n],x=w[r];w[r]=w[A];void 0===x&&(x=new ka(p,f[n],g[n]));w[A]=x}}else b[r]!==v&&console.error("Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes...")}this.nCachedObjects_=d},remove:function(a){for(var b=this._objects,
c=this.nCachedObjects_,d=this._indicesByUUID,e=this._bindings,f=e.length,g=0,k=arguments.length;g!==k;++g){var h=arguments[g],m=h.uuid,q=d[m];if(void 0!==q&&q>=c){var p=c++,n=b[p];d[n.uuid]=q;b[q]=n;d[m]=p;b[p]=h;h=0;for(m=f;h!==m;++h){var n=e[h],r=n[q];n[q]=n[p];n[p]=r}}}this.nCachedObjects_=c},uncache:function(a){for(var b=this._objects,c=b.length,d=this.nCachedObjects_,e=this._indicesByUUID,f=this._bindings,g=f.length,k=0,h=arguments.length;k!==h;++k){var m=arguments[k].uuid,q=e[m];if(void 0!==
q)if(delete e[m],q<d){var m=--d,p=b[m],n=--c,r=b[n];e[p.uuid]=q;b[q]=p;e[r.uuid]=m;b[m]=r;b.pop();p=0;for(r=g;p!==r;++p){var t=f[p],v=t[n];t[q]=t[m];t[m]=v;t.pop()}}else for(n=--c,r=b[n],e[r.uuid]=q,b[q]=r,b.pop(),p=0,r=g;p!==r;++p)t=f[p],t[q]=t[n],t.pop()}this.nCachedObjects_=d},subscribe_:function(a,b){var c=this._bindingsIndicesByPath,d=c[a],e=this._bindings;if(void 0!==d)return e[d];var f=this._paths,g=this._parsedPaths,k=this._objects,h=this.nCachedObjects_,m=Array(k.length),d=e.length;c[a]=
d;f.push(a);g.push(b);e.push(m);c=h;for(d=k.length;c!==d;++c)m[c]=new ka(k[c],a,b);return m},unsubscribe_:function(a){var b=this._bindingsIndicesByPath,c=b[a];if(void 0!==c){var d=this._paths,e=this._parsedPaths,f=this._bindings,g=f.length-1,k=f[g];b[a[g]]=c;f[c]=k;f.pop();e[c]=e[g];e.pop();d[c]=d[g];d.pop()}}};Ed.prototype={constructor:Ed,play:function(){this._mixer._activateAction(this);return this},stop:function(){this._mixer._deactivateAction(this);return this.reset()},reset:function(){this.paused=
!1;this.enabled=!0;this.time=0;this._loopCount=-1;this._startTime=null;return this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(a){this._startTime=a;return this},setLoop:function(a,b){this.loop=a;this.repetitions=b;return this},setEffectiveWeight:function(a){this.weight=a;this._effectiveWeight=this.enabled?
a:0;return this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(a){return this._scheduleFading(a,0,1)},fadeOut:function(a){return this._scheduleFading(a,1,0)},crossFadeFrom:function(a,b,c){a.fadeOut(b);this.fadeIn(b);if(c){c=this._clip.duration;var d=a._clip.duration,e=c/d;a.warp(1,d/c,b);this.warp(e,1,b)}return this},crossFadeTo:function(a,b,c){return a.crossFadeFrom(this,b,c)},stopFading:function(){var a=this._weightInterpolant;null!==a&&(this._weightInterpolant=
null,this._mixer._takeBackControlInterpolant(a));return this},setEffectiveTimeScale:function(a){this.timeScale=a;this._effectiveTimeScale=this.paused?0:a;return this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(a){this.timeScale=this._clip.duration/a;return this.stopWarping()},syncWith:function(a){this.time=a.time;this.timeScale=a.timeScale;return this.stopWarping()},halt:function(a){return this.warp(this._effectiveTimeScale,0,a)},warp:function(a,
b,c){var d=this._mixer,e=d.time,f=this._timeScaleInterpolant,g=this.timeScale;null===f&&(this._timeScaleInterpolant=f=d._lendControlInterpolant());d=f.parameterPositions;f=f.sampleValues;d[0]=e;d[1]=e+c;f[0]=a/g;f[1]=b/g;return this},stopWarping:function(){var a=this._timeScaleInterpolant;null!==a&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(a));return this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||
this._mixer._root},_update:function(a,b,c,d){var e=this._startTime;if(null!==e){b=(a-e)*c;if(0>b||0===c)return;this._startTime=null;b*=c}b*=this._updateTimeScale(a);c=this._updateTime(b);a=this._updateWeight(a);if(0<a){b=this._interpolants;for(var e=this._propertyBindings,f=0,g=b.length;f!==g;++f)b[f].evaluate(c),e[f].accumulate(d,a)}},_updateWeight:function(a){var b=0;if(this.enabled){var b=this.weight,c=this._weightInterpolant;if(null!==c){var d=c.evaluate(a)[0],b=b*d;a>c.parameterPositions[1]&&
(this.stopFading(),0===d&&(this.enabled=!1))}}return this._effectiveWeight=b},_updateTimeScale:function(a){var b=0;if(!this.paused){var b=this.timeScale,c=this._timeScaleInterpolant;if(null!==c){var d=c.evaluate(a)[0],b=b*d;a>c.parameterPositions[1]&&(this.stopWarping(),0===b?this.paused=!0:this.timeScale=b)}}return this._effectiveTimeScale=b},_updateTime:function(a){var b=this.time+a;if(0===a)return b;var c=this._clip.duration,d=this.loop,e=this._loopCount;if(2200===d)a:{if(-1===e&&(this.loopCount=
0,this._setEndings(!0,!0,!1)),b>=c)b=c;else if(0>b)b=0;else break a;this.clampWhenFinished?this.paused=!0:this.enabled=!1;this._mixer.dispatchEvent({type:"finished",action:this,direction:0>a?-1:1})}else{d=2202===d;-1===e&&(0<=a?(e=0,this._setEndings(!0,0===this.repetitions,d)):this._setEndings(0===this.repetitions,!0,d));if(b>=c||0>b){var f=Math.floor(b/c),b=b-c*f,e=e+Math.abs(f),g=this.repetitions-e;0>g?(this.clampWhenFinished?this.paused=!0:this.enabled=!1,b=0<a?c:0,this._mixer.dispatchEvent({type:"finished",
action:this,direction:0<a?1:-1})):(0===g?(a=0>a,this._setEndings(a,!a,d)):this._setEndings(!1,!1,d),this._loopCount=e,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:f}))}if(d&&1===(e&1))return this.time=b,c-b}return this.time=b},_setEndings:function(a,b,c){var d=this._interpolantSettings;c?(d.endingStart=2401,d.endingEnd=2401):(d.endingStart=a?this.zeroSlopeAtStart?2401:2400:2402,d.endingEnd=b?this.zeroSlopeAtEnd?2401:2400:2402)},_scheduleFading:function(a,b,c){var d=this._mixer,e=d.time,
f=this._weightInterpolant;null===f&&(this._weightInterpolant=f=d._lendControlInterpolant());d=f.parameterPositions;f=f.sampleValues;d[0]=e;f[0]=b;d[1]=e+a;f[1]=c;return this}};Object.assign(Fd.prototype,pa.prototype,{clipAction:function(a,b){var c=b||this._root,d=c.uuid,e="string"===typeof a?ta.findByName(c,a):a,c=null!==e?e.uuid:a,f=this._actionsByClip[c],g=null;if(void 0!==f){g=f.actionByRoot[d];if(void 0!==g)return g;g=f.knownActions[0];null===e&&(e=g._clip)}if(null===e)return null;e=new Ed(this,
e,b);this._bindAction(e,g);this._addInactiveAction(e,c,d);return e},existingAction:function(a,b){var c=b||this._root,d=c.uuid,c="string"===typeof a?ta.findByName(c,a):a,c=this._actionsByClip[c?c.uuid:a];return void 0!==c?c.actionByRoot[d]||null:null},stopAllAction:function(){for(var a=this._actions,b=this._nActiveActions,c=this._bindings,d=this._nActiveBindings,e=this._nActiveBindings=this._nActiveActions=0;e!==b;++e)a[e].reset();for(e=0;e!==d;++e)c[e].useCount=0;return this},update:function(a){a*=
this.timeScale;for(var b=this._actions,c=this._nActiveActions,d=this.time+=a,e=Math.sign(a),f=this._accuIndex^=1,g=0;g!==c;++g){var k=b[g];k.enabled&&k._update(d,a,e,f)}a=this._bindings;b=this._nActiveBindings;for(g=0;g!==b;++g)a[g].apply(f);return this},getRoot:function(){return this._root},uncacheClip:function(a){var b=this._actions;a=a.uuid;var c=this._actionsByClip,d=c[a];if(void 0!==d){for(var d=d.knownActions,e=0,f=d.length;e!==f;++e){var g=d[e];this._deactivateAction(g);var k=g._cacheIndex,
h=b[b.length-1];g._cacheIndex=null;g._byClipCacheIndex=null;h._cacheIndex=k;b[k]=h;b.pop();this._removeInactiveBindingsForAction(g)}delete c[a]}},uncacheRoot:function(a){a=a.uuid;var b=this._actionsByClip,c;for(c in b){var d=b[c].actionByRoot[a];void 0!==d&&(this._deactivateAction(d),this._removeInactiveAction(d))}c=this._bindingsByRootAndName[a];if(void 0!==c)for(var e in c)a=c[e],a.restoreOriginalState(),this._removeInactiveBinding(a)},uncacheAction:function(a,b){var c=this.existingAction(a,b);
null!==c&&(this._deactivateAction(c),this._removeInactiveAction(c))}});Object.assign(Fd.prototype,{_bindAction:function(a,b){var c=a._localRoot||this._root,d=a._clip.tracks,e=d.length,f=a._propertyBindings,g=a._interpolants,k=c.uuid,h=this._bindingsByRootAndName,m=h[k];void 0===m&&(m={},h[k]=m);for(h=0;h!==e;++h){var q=d[h],p=q.name,n=m[p];if(void 0===n){n=f[h];if(void 0!==n){null===n._cacheIndex&&(++n.referenceCount,this._addInactiveBinding(n,k,p));continue}n=new hd(ka.create(c,p,b&&b._propertyBindings[h].binding.parsedPath),
q.ValueTypeName,q.getValueSize());++n.referenceCount;this._addInactiveBinding(n,k,p)}f[h]=n;g[h].resultBuffer=n.buffer}},_activateAction:function(a){if(!this._isActiveAction(a)){if(null===a._cacheIndex){var b=(a._localRoot||this._root).uuid,c=a._clip.uuid,d=this._actionsByClip[c];this._bindAction(a,d&&d.knownActions[0]);this._addInactiveAction(a,c,b)}b=a._propertyBindings;c=0;for(d=b.length;c!==d;++c){var e=b[c];0===e.useCount++&&(this._lendBinding(e),e.saveOriginalState())}this._lendAction(a)}},
_deactivateAction:function(a){if(this._isActiveAction(a)){for(var b=a._propertyBindings,c=0,d=b.length;c!==d;++c){var e=b[c];0===--e.useCount&&(e.restoreOriginalState(),this._takeBackBinding(e))}this._takeBackAction(a)}},_initMemoryManager:function(){this._actions=[];this._nActiveActions=0;this._actionsByClip={};this._bindings=[];this._nActiveBindings=0;this._bindingsByRootAndName={};this._controlInterpolants=[];this._nActiveControlInterpolants=0;var a=this;this.stats={actions:{get total(){return a._actions.length},
get inUse(){return a._nActiveActions}},bindings:{get total(){return a._bindings.length},get inUse(){return a._nActiveBindings}},controlInterpolants:{get total(){return a._controlInterpolants.length},get inUse(){return a._nActiveControlInterpolants}}}},_isActiveAction:function(a){a=a._cacheIndex;return null!==a&&a<this._nActiveActions},_addInactiveAction:function(a,b,c){var d=this._actions,e=this._actionsByClip,f=e[b];void 0===f?(f={knownActions:[a],actionByRoot:{}},a._byClipCacheIndex=0,e[b]=f):(b=
f.knownActions,a._byClipCacheIndex=b.length,b.push(a));a._cacheIndex=d.length;d.push(a);f.actionByRoot[c]=a},_removeInactiveAction:function(a){var b=this._actions,c=b[b.length-1],d=a._cacheIndex;c._cacheIndex=d;b[d]=c;b.pop();a._cacheIndex=null;var c=a._clip.uuid,d=this._actionsByClip,e=d[c],f=e.knownActions,g=f[f.length-1],k=a._byClipCacheIndex;g._byClipCacheIndex=k;f[k]=g;f.pop();a._byClipCacheIndex=null;delete e.actionByRoot[(b._localRoot||this._root).uuid];0===f.length&&delete d[c];this._removeInactiveBindingsForAction(a)},
_removeInactiveBindingsForAction:function(a){a=a._propertyBindings;for(var b=0,c=a.length;b!==c;++b){var d=a[b];0===--d.referenceCount&&this._removeInactiveBinding(d)}},_lendAction:function(a){var b=this._actions,c=a._cacheIndex,d=this._nActiveActions++,e=b[d];a._cacheIndex=d;b[d]=a;e._cacheIndex=c;b[c]=e},_takeBackAction:function(a){var b=this._actions,c=a._cacheIndex,d=--this._nActiveActions,e=b[d];a._cacheIndex=d;b[d]=a;e._cacheIndex=c;b[c]=e},_addInactiveBinding:function(a,b,c){var d=this._bindingsByRootAndName,
e=d[b],f=this._bindings;void 0===e&&(e={},d[b]=e);e[c]=a;a._cacheIndex=f.length;f.push(a)},_removeInactiveBinding:function(a){var b=this._bindings,c=a.binding,d=c.rootNode.uuid,c=c.path,e=this._bindingsByRootAndName,f=e[d],g=b[b.length-1];a=a._cacheIndex;g._cacheIndex=a;b[a]=g;b.pop();delete f[c];a:{for(var k in f)break a;delete e[d]}},_lendBinding:function(a){var b=this._bindings,c=a._cacheIndex,d=this._nActiveBindings++,e=b[d];a._cacheIndex=d;b[d]=a;e._cacheIndex=c;b[c]=e},_takeBackBinding:function(a){var b=
this._bindings,c=a._cacheIndex,d=--this._nActiveBindings,e=b[d];a._cacheIndex=d;b[d]=a;e._cacheIndex=c;b[c]=e},_lendControlInterpolant:function(){var a=this._controlInterpolants,b=this._nActiveControlInterpolants++,c=a[b];void 0===c&&(c=new zc(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),c.__cacheIndex=b,a[b]=c);return c},_takeBackControlInterpolant:function(a){var b=this._controlInterpolants,c=a.__cacheIndex,d=--this._nActiveControlInterpolants,e=b[d];a.__cacheIndex=
d;b[d]=a;e.__cacheIndex=c;b[c]=e},_controlInterpolantsResultBuffer:new Float32Array(1)});Gd.prototype={constructor:Gd,onUpdate:function(a){this.dynamic=!0;this.onUpdateCallback=a;return this}};xb.prototype=Object.create(I.prototype);xb.prototype.constructor=xb;xb.prototype.isInstancedBufferGeometry=!0;xb.prototype.addGroup=function(a,b,c){this.groups.push({start:a,count:b,instances:c})};xb.prototype.copy=function(a){var b=a.index;null!==b&&this.setIndex(b.clone());var b=a.attributes,c;for(c in b)this.addAttribute(c,
b[c].clone());a=a.groups;c=0;for(b=a.length;c<b;c++){var d=a[c];this.addGroup(d.start,d.count,d.instances)}return this};Hd.prototype={constructor:Hd,isInterleavedBufferAttribute:!0,get count(){return this.data.count},get array(){return this.data.array},setX:function(a,b){this.data.array[a*this.data.stride+this.offset]=b;return this},setY:function(a,b){this.data.array[a*this.data.stride+this.offset+1]=b;return this},setZ:function(a,b){this.data.array[a*this.data.stride+this.offset+2]=b;return this},
setW:function(a,b){this.data.array[a*this.data.stride+this.offset+3]=b;return this},getX:function(a){return this.data.array[a*this.data.stride+this.offset]},getY:function(a){return this.data.array[a*this.data.stride+this.offset+1]},getZ:function(a){return this.data.array[a*this.data.stride+this.offset+2]},getW:function(a){return this.data.array[a*this.data.stride+this.offset+3]},setXY:function(a,b,c){a=a*this.data.stride+this.offset;this.data.array[a+0]=b;this.data.array[a+1]=c;return this},setXYZ:function(a,
b,c,d){a=a*this.data.stride+this.offset;this.data.array[a+0]=b;this.data.array[a+1]=c;this.data.array[a+2]=d;return this},setXYZW:function(a,b,c,d,e){a=a*this.data.stride+this.offset;this.data.array[a+0]=b;this.data.array[a+1]=c;this.data.array[a+2]=d;this.data.array[a+3]=e;return this}};Vb.prototype={constructor:Vb,isInterleavedBuffer:!0,set needsUpdate(a){!0===a&&this.version++},setDynamic:function(a){this.dynamic=a;return this},copy:function(a){this.array=new a.array.constructor(a.array);this.count=
a.count;this.stride=a.stride;this.dynamic=a.dynamic;return this},copyAt:function(a,b,c){a*=this.stride;c*=b.stride;for(var d=0,e=this.stride;d<e;d++)this.array[a+d]=b.array[c+d];return this},set:function(a,b){void 0===b&&(b=0);this.array.set(a,b);return this},clone:function(){return(new this.constructor).copy(this)}};Wb.prototype=Object.create(Vb.prototype);Wb.prototype.constructor=Wb;Wb.prototype.isInstancedInterleavedBuffer=!0;Wb.prototype.copy=function(a){Vb.prototype.copy.call(this,a);this.meshPerAttribute=
a.meshPerAttribute;return this};Xb.prototype=Object.create(z.prototype);Xb.prototype.constructor=Xb;Xb.prototype.isInstancedBufferAttribute=!0;Xb.prototype.copy=function(a){z.prototype.copy.call(this,a);this.meshPerAttribute=a.meshPerAttribute;return this};Id.prototype={constructor:Id,linePrecision:1,set:function(a,b){this.ray.set(a,b)},setFromCamera:function(a,b){b&&b.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(b.matrixWorld),this.ray.direction.set(a.x,a.y,.5).unproject(b).sub(this.ray.origin).normalize()):
b&&b.isOrthographicCamera?(this.ray.origin.set(a.x,a.y,(b.near+b.far)/(b.near-b.far)).unproject(b),this.ray.direction.set(0,0,-1).transformDirection(b.matrixWorld)):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(a,b){var c=[];Jd(a,this,c,b);c.sort(me);return c},intersectObjects:function(a,b){var c=[];if(!1===Array.isArray(a))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),c;for(var d=0,e=a.length;d<e;d++)Jd(a[d],this,c,b);c.sort(me);
return c}};Kd.prototype={constructor:Kd,start:function(){this.oldTime=this.startTime=(performance||Date).now();this.running=!0},stop:function(){this.getElapsedTime();this.running=!1},getElapsedTime:function(){this.getDelta();return this.elapsedTime},getDelta:function(){var a=0;this.autoStart&&!this.running&&this.start();if(this.running){var b=(performance||Date).now(),a=(b-this.oldTime)/1E3;this.oldTime=b;this.elapsedTime+=a}return a}};Ld.prototype={constructor:Ld,set:function(a,b,c){this.radius=
a;this.phi=b;this.theta=c;return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.radius.copy(a.radius);this.phi.copy(a.phi);this.theta.copy(a.theta);return this},makeSafe:function(){this.phi=Math.max(1E-6,Math.min(Math.PI-1E-6,this.phi));return this},setFromVector3:function(a){this.radius=a.length();0===this.radius?this.phi=this.theta=0:(this.theta=Math.atan2(a.x,a.z),this.phi=Math.acos(h.Math.clamp(a.y/this.radius,-1,1)));return this}};la.prototype=Object.create(va.prototype);
la.prototype.constructor=la;la.prototype.createAnimation=function(a,b,c,d){b={start:b,end:c,length:c-b+1,fps:d,duration:(c-b)/d,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[a]=b;this.animationsList.push(b)};la.prototype.autoCreateAnimations=function(a){for(var b=/([a-z]+)_?(\d+)/i,c,d={},e=this.geometry,f=0,g=e.morphTargets.length;f<g;f++){var k=e.morphTargets[f].name.match(b);if(k&&1<k.length){var h=k[1];d[h]||(d[h]={start:Infinity,
end:-Infinity});k=d[h];f<k.start&&(k.start=f);f>k.end&&(k.end=f);c||(c=h)}}for(h in d)k=d[h],this.createAnimation(h,k.start,k.end,a);this.firstAnimation=c};la.prototype.setAnimationDirectionForward=function(a){if(a=this.animationsMap[a])a.direction=1,a.directionBackwards=!1};la.prototype.setAnimationDirectionBackward=function(a){if(a=this.animationsMap[a])a.direction=-1,a.directionBackwards=!0};la.prototype.setAnimationFPS=function(a,b){var c=this.animationsMap[a];c&&(c.fps=b,c.duration=(c.end-c.start)/
c.fps)};la.prototype.setAnimationDuration=function(a,b){var c=this.animationsMap[a];c&&(c.duration=b,c.fps=(c.end-c.start)/c.duration)};la.prototype.setAnimationWeight=function(a,b){var c=this.animationsMap[a];c&&(c.weight=b)};la.prototype.setAnimationTime=function(a,b){var c=this.animationsMap[a];c&&(c.time=b)};la.prototype.getAnimationTime=function(a){var b=0;if(a=this.animationsMap[a])b=a.time;return b};la.prototype.getAnimationDuration=function(a){var b=-1;if(a=this.animationsMap[a])b=a.duration;
return b};la.prototype.playAnimation=function(a){var b=this.animationsMap[a];b?(b.time=0,b.active=!0):console.warn("THREE.MorphBlendMesh: animation["+a+"] undefined in .playAnimation()")};la.prototype.stopAnimation=function(a){if(a=this.animationsMap[a])a.active=!1};la.prototype.update=function(a){for(var b=0,c=this.animationsList.length;b<c;b++){var d=this.animationsList[b];if(d.active){var e=d.duration/d.length;d.time+=d.direction*a;if(d.mirroredLoop){if(d.time>d.duration||0>d.time)d.direction*=
-1,d.time>d.duration&&(d.time=d.duration,d.directionBackwards=!0),0>d.time&&(d.time=0,d.directionBackwards=!1)}else d.time%=d.duration,0>d.time&&(d.time+=d.duration);var f=d.start+h.Math.clamp(Math.floor(d.time/e),0,d.length-1),g=d.weight;f!==d.currentFrame&&(this.morphTargetInfluences[d.lastFrame]=0,this.morphTargetInfluences[d.currentFrame]=1*g,this.morphTargetInfluences[f]=0,d.lastFrame=d.currentFrame,d.currentFrame=f);e=d.time%e/e;d.directionBackwards&&(e=1-e);d.currentFrame!==d.lastFrame?(this.morphTargetInfluences[d.currentFrame]=
e*g,this.morphTargetInfluences[d.lastFrame]=(1-e)*g):this.morphTargetInfluences[d.currentFrame]=g}}};Dc.prototype=Object.create(D.prototype);Dc.prototype.constructor=Dc;Dc.prototype.isImmediateRenderObject=!0;Ec.prototype=Object.create(ha.prototype);Ec.prototype.constructor=Ec;Ec.prototype.update=function(){var a=new q,b=new q,c=new ya;return function(){var d=["a","b","c"];this.object.updateMatrixWorld(!0);c.getNormalMatrix(this.object.matrixWorld);var e=this.object.matrixWorld,f=this.geometry.attributes.position,
g=this.object.geometry;if(g&&g.isGeometry)for(var k=g.vertices,h=g.faces,m=g=0,q=h.length;m<q;m++)for(var p=h[m],n=0,r=p.vertexNormals.length;n<r;n++){var t=p.vertexNormals[n];a.copy(k[p[d[n]]]).applyMatrix4(e);b.copy(t).applyMatrix3(c).normalize().multiplyScalar(this.size).add(a);f.setXYZ(g,a.x,a.y,a.z);g+=1;f.setXYZ(g,b.x,b.y,b.z);g+=1}else if(g&&g.isBufferGeometry)for(d=g.attributes.position,k=g.attributes.normal,n=g=0,r=d.count;n<r;n++)a.set(d.getX(n),d.getY(n),d.getZ(n)).applyMatrix4(e),b.set(k.getX(n),
k.getY(n),k.getZ(n)),b.applyMatrix3(c).normalize().multiplyScalar(this.size).add(a),f.setXYZ(g,a.x,a.y,a.z),g+=1,f.setXYZ(g,b.x,b.y,b.z),g+=1;f.needsUpdate=!0;return this}}();Yb.prototype=Object.create(D.prototype);Yb.prototype.constructor=Yb;Yb.prototype.dispose=function(){this.cone.geometry.dispose();this.cone.material.dispose()};Yb.prototype.update=function(){var a=new q,b=new q;return function(){var c=this.light.distance?this.light.distance:1E3,d=c*Math.tan(this.light.angle);this.cone.scale.set(d,
d,c);a.setFromMatrixPosition(this.light.matrixWorld);b.setFromMatrixPosition(this.light.target.matrixWorld);this.cone.lookAt(b.sub(a));this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}}();Zb.prototype=Object.create(ha.prototype);Zb.prototype.constructor=Zb;Zb.prototype.getBoneList=function(a){var b=[];a&&a.isBone&&b.push(a);for(var c=0;c<a.children.length;c++)b.push.apply(b,this.getBoneList(a.children[c]));return b};Zb.prototype.update=function(){for(var a=this.geometry,
b=(new P).getInverse(this.root.matrixWorld),c=new P,d=0,e=0;e<this.bones.length;e++){var f=this.bones[e];f.parent&&f.parent.isBone&&(c.multiplyMatrices(b,f.matrixWorld),a.vertices[d].setFromMatrixPosition(c),c.multiplyMatrices(b,f.parent.matrixWorld),a.vertices[d+1].setFromMatrixPosition(c),d+=2)}a.verticesNeedUpdate=!0;a.computeBoundingSphere()};$b.prototype=Object.create(va.prototype);$b.prototype.constructor=$b;$b.prototype.dispose=function(){this.geometry.dispose();this.material.dispose()};$b.prototype.update=
function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)};ac.prototype=Object.create(D.prototype);ac.prototype.constructor=ac;ac.prototype.dispose=function(){this.lightSphere.geometry.dispose();this.lightSphere.material.dispose()};ac.prototype.update=function(){var a=new q;return function(){this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity);this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity);this.lightSphere.lookAt(a.setFromMatrixPosition(this.light.matrixWorld).negate());
this.lightSphere.geometry.colorsNeedUpdate=!0}}();Fc.prototype=Object.create(ha.prototype);Fc.prototype.constructor=Fc;Fc.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")};Gc.prototype=Object.create(ha.prototype);Gc.prototype.constructor=Gc;Gc.prototype.update=function(){var a=new q,b=new q,c=new ya;return function(){this.object.updateMatrixWorld(!0);c.getNormalMatrix(this.object.matrixWorld);for(var d=this.object.matrixWorld,
e=this.geometry.attributes.position,f=this.object.geometry,g=f.vertices,f=f.faces,k=0,h=0,m=f.length;h<m;h++){var q=f[h],p=q.normal;a.copy(g[q.a]).add(g[q.b]).add(g[q.c]).divideScalar(3).applyMatrix4(d);b.copy(p).applyMatrix3(c).normalize().multiplyScalar(this.size).add(a);e.setXYZ(k,a.x,a.y,a.z);k+=1;e.setXYZ(k,b.x,b.y,b.z);k+=1}e.needsUpdate=!0;return this}}();bc.prototype=Object.create(D.prototype);bc.prototype.constructor=bc;bc.prototype.dispose=function(){var a=this.children[0],b=this.children[1];
a.geometry.dispose();a.material.dispose();b.geometry.dispose();b.material.dispose()};bc.prototype.update=function(){var a=new q,b=new q,c=new q;return function(){a.setFromMatrixPosition(this.light.matrixWorld);b.setFromMatrixPosition(this.light.target.matrixWorld);c.subVectors(b,a);var d=this.children[0],e=this.children[1];d.lookAt(c);d.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);e.lookAt(c);e.scale.z=c.length()}}();Hc.prototype=Object.create(ha.prototype);Hc.prototype.constructor=
Hc;Hc.prototype.update=function(){function a(a,g,k,h){d.set(g,k,h).unproject(e);a=c[a];if(void 0!==a)for(g=0,k=a.length;g<k;g++)b.vertices[a[g]].copy(d)}var b,c,d=new q,e=new qa;return function(){b=this.geometry;c=this.pointMap;e.projectionMatrix.copy(this.camera.projectionMatrix);a("c",0,0,-1);a("t",0,0,1);a("n1",-1,-1,-1);a("n2",1,-1,-1);a("n3",-1,1,-1);a("n4",1,1,-1);a("f1",-1,-1,1);a("f2",1,-1,1);a("f3",-1,1,1);a("f4",1,1,1);a("u1",.7,1.1,-1);a("u2",-.7,1.1,-1);a("u3",0,2,-1);a("cf1",-1,0,1);
a("cf2",1,0,1);a("cf3",0,-1,1);a("cf4",0,1,1);a("cn1",-1,0,-1);a("cn2",1,0,-1);a("cn3",0,-1,-1);a("cn4",0,1,-1);b.verticesNeedUpdate=!0}}();Ic.prototype=Object.create(va.prototype);Ic.prototype.constructor=Ic;Ic.prototype.update=function(){this.box.setFromObject(this.object);this.box.size(this.scale);this.box.getCenter(this.position)};Jc.prototype=Object.create(ha.prototype);Jc.prototype.constructor=Jc;Jc.prototype.update=function(){var a=new Ha;return function(b){b&&b.isBox3?a.copy(b):a.setFromObject(b);
if(!a.isEmpty()){b=a.min;var c=a.max,d=this.geometry.attributes.position,e=d.array;e[0]=c.x;e[1]=c.y;e[2]=c.z;e[3]=b.x;e[4]=c.y;e[5]=c.z;e[6]=b.x;e[7]=b.y;e[8]=c.z;e[9]=c.x;e[10]=b.y;e[11]=c.z;e[12]=c.x;e[13]=c.y;e[14]=b.z;e[15]=b.x;e[16]=c.y;e[17]=b.z;e[18]=b.x;e[19]=b.y;e[20]=b.z;e[21]=c.x;e[22]=b.y;e[23]=b.z;d.needsUpdate=!0;this.geometry.computeBoundingSphere()}}}();var ne=new I;ne.addAttribute("position",new ma([0,0,0,0,1,0],3));var oe=new Za(0,.5,1,5,1);oe.translate(0,-.5,0);yb.prototype=Object.create(D.prototype);
yb.prototype.constructor=yb;yb.prototype.setDirection=function(){var a=new q,b;return function(c){.99999<c.y?this.quaternion.set(0,0,0,1):-.99999>c.y?this.quaternion.set(1,0,0,0):(a.set(c.z,0,-c.x).normalize(),b=Math.acos(c.y),this.quaternion.setFromAxisAngle(a,b))}}();yb.prototype.setLength=function(a,b,c){void 0===b&&(b=.2*a);void 0===c&&(c=.2*b);this.line.scale.set(1,Math.max(0,a-b),1);this.line.updateMatrix();this.cone.scale.set(c,b,c);this.cone.position.y=a;this.cone.updateMatrix()};yb.prototype.setColor=
function(a){this.line.material.color.copy(a);this.cone.material.color.copy(a)};id.prototype=Object.create(ha.prototype);id.prototype.constructor=id;h.CatmullRomCurve3=function(){function a(){}var b=new q,c=new a,d=new a,e=new a;a.prototype.init=function(a,b,c,d){this.c0=a;this.c1=c;this.c2=-3*a+3*b-2*c-d;this.c3=2*a-2*b+c+d};a.prototype.initNonuniformCatmullRom=function(a,b,c,d,e,h,p){this.init(b,c,((b-a)/e-(c-a)/(e+h)+(c-b)/h)*h,((c-b)/h-(d-b)/(h+p)+(d-c)/p)*h)};a.prototype.initCatmullRom=function(a,
b,c,d,e){this.init(b,c,e*(c-a),e*(d-b))};a.prototype.calc=function(a){var b=a*a;return this.c0+this.c1*a+this.c2*b+this.c3*b*a};return Y.create(function(a){this.points=a||[];this.closed=!1},function(a){var g=this.points,k,h;h=g.length;2>h&&console.log("duh, you need at least 2 points");a*=h-(this.closed?0:1);k=Math.floor(a);a-=k;this.closed?k+=0<k?0:(Math.floor(Math.abs(k)/g.length)+1)*g.length:0===a&&k===h-1&&(k=h-2,a=1);var m,u,p;this.closed||0<k?m=g[(k-1)%h]:(b.subVectors(g[0],g[1]).add(g[0]),
m=b);u=g[k%h];p=g[(k+1)%h];this.closed||k+2<h?g=g[(k+2)%h]:(b.subVectors(g[h-1],g[h-2]).add(g[h-1]),g=b);if(void 0===this.type||"centripetal"===this.type||"chordal"===this.type){var n="chordal"===this.type?.5:.25;h=Math.pow(m.distanceToSquared(u),n);k=Math.pow(u.distanceToSquared(p),n);n=Math.pow(p.distanceToSquared(g),n);1E-4>k&&(k=1);1E-4>h&&(h=k);1E-4>n&&(n=k);c.initNonuniformCatmullRom(m.x,u.x,p.x,g.x,h,k,n);d.initNonuniformCatmullRom(m.y,u.y,p.y,g.y,h,k,n);e.initNonuniformCatmullRom(m.z,u.z,
p.z,g.z,h,k,n)}else"catmullrom"===this.type&&(h=void 0!==this.tension?this.tension:.5,c.initCatmullRom(m.x,u.x,p.x,g.x,h),d.initCatmullRom(m.y,u.y,p.y,g.y,h),e.initCatmullRom(m.z,u.z,p.z,g.z,h));return new q(c.calc(a),d.calc(a),e.calc(a))})}();pe.prototype=Object.create(h.CatmullRomCurve3.prototype);var of=Y.create(function(a){console.warn("THREE.SplineCurve3 will be deprecated. Please use THREE.CatmullRomCurve3");this.points=void 0===a?[]:a},function(a){var b=this.points;a*=b.length-1;var c=Math.floor(a);
a-=c;var d=b[0==c?c:c-1],e=b[c],f=b[c>b.length-2?b.length-1:c+1],b=b[c>b.length-3?b.length-1:c+2],c=h.CurveUtils.interpolate;return new q(c(d.x,e.x,f.x,b.x,a),c(d.y,e.y,f.y,b.y,a),c(d.z,e.z,f.z,b.z,a))});h.CubicBezierCurve3=Y.create(function(a,b,c,d){this.v0=a;this.v1=b;this.v2=c;this.v3=d},function(a){var b=h.ShapeUtils.b3;return new q(b(a,this.v0.x,this.v1.x,this.v2.x,this.v3.x),b(a,this.v0.y,this.v1.y,this.v2.y,this.v3.y),b(a,this.v0.z,this.v1.z,this.v2.z,this.v3.z))});h.QuadraticBezierCurve3=
Y.create(function(a,b,c){this.v0=a;this.v1=b;this.v2=c},function(a){var b=h.ShapeUtils.b2;return new q(b(a,this.v0.x,this.v1.x,this.v2.x),b(a,this.v0.y,this.v1.y,this.v2.y),b(a,this.v0.z,this.v1.z,this.v2.z))});h.LineCurve3=Y.create(function(a,b){this.v1=a;this.v2=b},function(a){if(1===a)return this.v2.clone();var b=new q;b.subVectors(this.v2,this.v1);b.multiplyScalar(a);b.add(this.v1);return b});jd.prototype=Object.create(Ra.prototype);jd.prototype.constructor=jd;h.SceneUtils={createMultiMaterialObject:function(a,
b){for(var c=new hc,d=0,e=b.length;d<e;d++)c.add(new va(a,b[d]));return c},detach:function(a,b,c){a.applyMatrix(b.matrixWorld);b.remove(a);c.add(a)},attach:function(a,b,c){var d=new P;d.getInverse(c.matrixWorld);a.applyMatrix(d);b.remove(a);c.add(a)}};Object.assign(cc.prototype,{center:function(a){console.warn("THREE.Box2: .center() has been renamed to .getCenter().");return this.getCenter(a)},empty:function(){console.warn("THREE.Box2: .empty() has been renamed to .isEmpty().");return this.isEmpty()},
isIntersectionBox:function(a){console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox().");return this.intersectsBox(a)},size:function(a){console.warn("THREE.Box2: .size() has been renamed to .getSize().");return this.getSize(a)}});Object.assign(Ha.prototype,{center:function(a){console.warn("THREE.Box3: .center() has been renamed to .getCenter().");return this.getCenter(a)},empty:function(){console.warn("THREE.Box3: .empty() has been renamed to .isEmpty().");return this.isEmpty()},
isIntersectionBox:function(a){console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox().");return this.intersectsBox(a)},isIntersectionSphere:function(a){console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere().");return this.intersectsSphere(a)},size:function(a){console.warn("THREE.Box3: .size() has been renamed to .getSize().");return this.getSize(a)}});Object.assign(cb.prototype,{center:function(a){console.warn("THREE.Line3: .center() has been renamed to .getCenter().");
return this.getCenter(a)}});Object.assign(ya.prototype,{multiplyVector3:function(a){console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead.");return a.applyMatrix3(this)},multiplyVector3Array:function(a){console.warn("THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.");return this.applyToVector3Array(a)}});Object.assign(P.prototype,{extractPosition:function(a){console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition().");
return this.copyPosition(a)},setRotationFromQuaternion:function(a){console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion().");return this.makeRotationFromQuaternion(a)},multiplyVector3:function(a){console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead.");return a.applyProjection(this)},multiplyVector4:function(a){console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead.");
return a.applyMatrix4(this)},multiplyVector3Array:function(a){console.warn("THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.");return this.applyToVector3Array(a)},rotateAxis:function(a){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead.");a.transformDirection(this)},crossVector:function(a){console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead.");
return a.applyMatrix4(this)},translate:function(a){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(a){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(a){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(a){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(a,b){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")}});Object.assign(fa.prototype,{isIntersectionLine:function(a){console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine().");
return this.intersectsLine(a)}});Object.assign(ca.prototype,{multiplyVector3:function(a){console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead.");return a.applyQuaternion(this)}});Object.assign(Wa.prototype,{isIntersectionBox:function(a){console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox().");return this.intersectsBox(a)},isIntersectionPlane:function(a){console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane().");
return this.intersectsPlane(a)},isIntersectionSphere:function(a){console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere().");return this.intersectsSphere(a)}});Object.assign(wb.prototype,{extrude:function(a){console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead.");return new ra(this,a)},makeGeometry:function(a){console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead.");return new Ya(this,a)}});Object.assign(q.prototype,
{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(a){console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition().");return this.setFromMatrixPosition(a)},getScaleFromMatrix:function(a){console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale().");
return this.setFromMatrixScale(a)},getColumnFromMatrix:function(a,b){console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn().");return this.setFromMatrixColumn(b,a)}});Object.assign(D.prototype,{getChildByName:function(a){console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName().");return this.getObjectByName(a)},renderDepth:function(a){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(a,
b){console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead.");return this.translateOnAxis(b,a)}});Object.defineProperties(D.prototype,{eulerOrder:{get:function(){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order.");return this.rotation.order},set:function(a){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order.");this.rotation.order=a}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},
set:function(a){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}});Object.defineProperties(gc.prototype,{objects:{get:function(){console.warn("THREE.LOD: .objects has been renamed to .levels.");return this.levels}}});Ca.prototype.setLens=function(a,b){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup.");void 0!==b&&(this.filmGauge=b);this.setFocalLength(a)};Object.defineProperties(oa.prototype,
{onlyShadow:{set:function(a){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(a){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov.");this.shadow.camera.fov=a}},shadowCameraLeft:{set:function(a){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left.");this.shadow.camera.left=a}},shadowCameraRight:{set:function(a){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right.");this.shadow.camera.right=a}},
shadowCameraTop:{set:function(a){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top.");this.shadow.camera.top=a}},shadowCameraBottom:{set:function(a){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom.");this.shadow.camera.bottom=a}},shadowCameraNear:{set:function(a){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near.");this.shadow.camera.near=a}},shadowCameraFar:{set:function(a){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far.");
this.shadow.camera.far=a}},shadowCameraVisible:{set:function(a){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(a){console.warn("THREE.Light: .shadowBias is now .shadow.bias.");this.shadow.bias=a}},shadowDarkness:{set:function(a){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(a){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width.");
this.shadow.mapSize.width=a}},shadowMapHeight:{set:function(a){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height.");this.shadow.mapSize.height=a}}});Object.defineProperties(z.prototype,{length:{get:function(){console.warn("THREE.BufferAttribute: .length has been deprecated. Please use .count.");return this.array.length}}});Object.assign(I.prototype,{addIndex:function(a){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex().");this.setIndex(a)},addDrawCall:function(a,
b,c){void 0!==c&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset.");console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup().");this.addGroup(a,b)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups().");this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")}});
Object.defineProperties(I.prototype,{drawcalls:{get:function(){console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups.");return this.groups}},offsets:{get:function(){console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups.");return this.groups}}});Object.defineProperties(S.prototype,{wrapAround:{get:function(){console.warn("THREE."+this.type+": .wrapAround has been removed.")},set:function(a){console.warn("THREE."+this.type+": .wrapAround has been removed.")}},
wrapRGB:{get:function(){console.warn("THREE."+this.type+": .wrapRGB has been removed.");return new H}}});Object.defineProperties($a.prototype,{metal:{get:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead.");return!1},set:function(a){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}});Object.defineProperties(Da.prototype,{derivatives:{get:function(){console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives.");
return this.extensions.derivatives},set:function(a){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives.");this.extensions.derivatives=a}}});pa.prototype=Object.assign(Object.create({constructor:pa,apply:function(a){console.warn("THREE.EventDispatcher: .apply is deprecated, just inherit or Object.assign the prototype to mix-in.");Object.assign(a,this)}}),pa.prototype);Object.assign(od.prototype,{supportsFloatTextures:function(){console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' ).");
return this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' ).");return this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' ).");return this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' ).");
return this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' ).");return this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' ).");return this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return this.capabilities.vertexTextures},
supportsInstancedArrays:function(){console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' ).");return this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(a){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest().");this.setScissorTest(a)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},
addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")}});Object.defineProperties(od.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(a){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled.");this.shadowMap.enabled=a}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(a){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type.");
this.shadowMap.type=a}},shadowMapCullFace:{get:function(){return this.shadowMap.cullFace},set:function(a){console.warn("THREE.WebGLRenderer: .shadowMapCullFace is now .shadowMap.cullFace.");this.shadowMap.cullFace=a}}});Object.defineProperties($d.prototype,{cullFace:{get:function(){return this.renderReverseSided?2:1},set:function(a){a=1!==a;console.warn("WebGLRenderer: .shadowMap.cullFace is deprecated. Set .shadowMap.renderReverseSided to "+a+".");this.renderReverseSided=a}}});Object.defineProperties(zb.prototype,
{wrapS:{get:function(){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS.");return this.texture.wrapS},set:function(a){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS.");this.texture.wrapS=a}},wrapT:{get:function(){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT.");return this.texture.wrapT},set:function(a){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT.");this.texture.wrapT=a}},magFilter:{get:function(){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter.");
return this.texture.magFilter},set:function(a){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter.");this.texture.magFilter=a}},minFilter:{get:function(){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter.");return this.texture.minFilter},set:function(a){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter.");this.texture.minFilter=a}},anisotropy:{get:function(){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy.");
return this.texture.anisotropy},set:function(a){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy.");this.texture.anisotropy=a}},offset:{get:function(){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset.");return this.texture.offset},set:function(a){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset.");this.texture.offset=a}},repeat:{get:function(){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat.");return this.texture.repeat},
set:function(a){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat.");this.texture.repeat=a}},format:{get:function(){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format.");return this.texture.format},set:function(a){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format.");this.texture.format=a}},type:{get:function(){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type.");return this.texture.type},set:function(a){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type.");
this.texture.type=a}},generateMipmaps:{get:function(){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps.");return this.texture.generateMipmaps},set:function(a){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps.");this.texture.generateMipmaps=a}}});Object.assign(Ub.prototype,{load:function(a){console.warn("THREE.Audio: .load has been deprecated. Please use THREE.AudioLoader.");var b=this;(new zd).load(a,function(a){b.setBuffer(a)});
return this}});Object.assign(Cd.prototype,{getData:function(a){console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData().");return this.getFrequencyData()}});Object.defineProperty(h,"AudioContext",{get:function(){return h.getAudioContext()}});h.WebGLRenderTargetCube=Ab;h.WebGLRenderTarget=zb;h.WebGLRenderer=od;h.ShaderLib=Cb;h.UniformsLib=U;h.ShaderChunk=Z;h.FogExp2=Eb;h.Fog=Fb;h.Scene=fb;h.LensFlare=pd;h.Sprite=fc;h.LOD=gc;h.SkinnedMesh=Pc;h.Skeleton=Nc;h.Bone=Oc;h.Mesh=va;h.LineSegments=
ha;h.Line=Pa;h.Points=Gb;h.Group=hc;h.VideoTexture=Qc;h.DataTexture=hb;h.CompressedTexture=Hb;h.CubeTexture=Ta;h.CanvasTexture=Rc;h.DepthTexture=ic;h.TextureIdCount=function(){return Pd++};h.Texture=ba;h.MaterialIdCount=function(){return Zd++};h.CompressedTextureLoader=ie;h.BinaryTextureLoader=rd;h.DataTextureLoader=rd;h.CubeTextureLoader=sd;h.TextureLoader=Sc;h.ObjectLoader=je;h.MaterialLoader=fd;h.BufferGeometryLoader=td;h.LoadingManager=qd;h.JSONLoader=ud;h.ImageLoader=yc;h.FontLoader=ke;h.XHRLoader=
za;h.Loader=sb;h.AudioLoader=zd;h.SpotLightShadow=Uc;h.SpotLight=Vc;h.PointLight=Wc;h.HemisphereLight=Tc;h.DirectionalLightShadow=Xc;h.DirectionalLight=Yc;h.AmbientLight=Zc;h.LightShadow=pb;h.Light=oa;h.StereoCamera=le;h.PerspectiveCamera=Ca;h.OrthographicCamera=Db;h.CubeCamera=gd;h.Camera=qa;h.AudioListener=Ad;h.PositionalAudio=Bd;h.getAudioContext=xd;h.AudioAnalyser=Cd;h.Audio=Ub;h.VectorKeyframeTrack=Sb;h.StringKeyframeTrack=cd;h.QuaternionKeyframeTrack=Ac;h.NumberKeyframeTrack=Tb;h.ColorKeyframeTrack=
ed;h.BooleanKeyframeTrack=dd;h.PropertyMixer=hd;h.PropertyBinding=ka;h.KeyframeTrack=rb;h.AnimationObjectGroup=Dd;h.AnimationMixer=Fd;h.AnimationClip=ta;h.Uniform=Gd;h.InstancedBufferGeometry=xb;h.BufferGeometry=I;h.GeometryIdCount=function(){return Lc++};h.Geometry=R;h.InterleavedBufferAttribute=Hd;h.InstancedInterleavedBuffer=Wb;h.InterleavedBuffer=Vb;h.InstancedBufferAttribute=Xb;h.DynamicBufferAttribute=function(a,b){console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setDynamic( true ) instead.");
return(new z(a,b)).setDynamic(!0)};h.Float64Attribute=function(a,b){return new z(new Float64Array(a),b)};h.Float32Attribute=ma;h.Uint32Attribute=ce;h.Int32Attribute=function(a,b){return new z(new Int32Array(a),b)};h.Uint16Attribute=be;h.Int16Attribute=function(a,b){return new z(new Int16Array(a),b)};h.Uint8ClampedAttribute=function(a,b){return new z(new Uint8ClampedArray(a),b)};h.Uint8Attribute=function(a,b){return new z(new Uint8Array(a),b)};h.Int8Attribute=function(a,b){return new z(new Int8Array(a),
b)};h.BufferAttribute=z;h.Face3=ga;h.Object3DIdCount=function(){return ae++};h.Object3D=D;h.Raycaster=Id;h.Layers=Kc;h.EventDispatcher=pa;h.Clock=Kd;h.QuaternionLinearInterpolant=bd;h.LinearInterpolant=zc;h.DiscreteInterpolant=ad;h.CubicInterpolant=$c;h.Interpolant=ja;h.Triangle=Fa;h.Spline=function(a){function b(a,b,c,d,e,f,g){a=.5*(c-a);d=.5*(d-b);return(2*(b-c)+a+d)*g+(-3*(b-c)-2*a-d)*f+a*e+b}this.points=a;var c=[],d={x:0,y:0,z:0},e,f,g,h,l,m,u,p,n;this.initFromArray=function(a){this.points=[];
for(var b=0;b<a.length;b++)this.points[b]={x:a[b][0],y:a[b][1],z:a[b][2]}};this.getPoint=function(a){e=(this.points.length-1)*a;f=Math.floor(e);g=e-f;c[0]=0===f?f:f-1;c[1]=f;c[2]=f>this.points.length-2?this.points.length-1:f+1;c[3]=f>this.points.length-3?this.points.length-1:f+2;m=this.points[c[0]];u=this.points[c[1]];p=this.points[c[2]];n=this.points[c[3]];h=g*g;l=g*h;d.x=b(m.x,u.x,p.x,n.x,g,h,l);d.y=b(m.y,u.y,p.y,n.y,g,h,l);d.z=b(m.z,u.z,p.z,n.z,g,h,l);return d};this.getControlPointsArray=function(){var a,
b,c=this.points.length,d=[];for(a=0;a<c;a++)b=this.points[a],d[a]=[b.x,b.y,b.z];return d};this.getLength=function(a){var b,c,d,e=0,f=new q,g=new q,h=[],k=0;h[0]=0;a||(a=100);c=this.points.length*a;f.copy(this.points[0]);for(a=1;a<c;a++)b=a/c,d=this.getPoint(b),g.copy(d),k+=g.distanceTo(f),f.copy(d),b*=this.points.length-1,b=Math.floor(b),b!==e&&(h[b]=k,e=b);h[h.length]=k;return{chunks:h,total:k}};this.reparametrizeByArcLength=function(a){var b,c,d,e,f,g,h=[],k=new q,l=this.getLength();h.push(k.copy(this.points[0]).clone());
for(b=1;b<this.points.length;b++){c=l.chunks[b]-l.chunks[b-1];g=Math.ceil(a*c/l.total);e=(b-1)/(this.points.length-1);f=b/(this.points.length-1);for(c=1;c<g-1;c++)d=e+1/g*c*(f-e),d=this.getPoint(d),h.push(k.copy(d).clone());h.push(k.copy(this.points[b]).clone())}this.points=h}};h.Spherical=Ld;h.Plane=fa;h.Frustum=dc;h.Sphere=Aa;h.Ray=Wa;h.Matrix4=P;h.Matrix3=ya;h.Box3=Ha;h.Box2=cc;h.Line3=cb;h.Euler=Xa;h.Vector4=da;h.Vector3=q;h.Vector2=C;h.Quaternion=ca;h.Color=H;h.MorphBlendMesh=la;h.ImmediateRenderObject=
Dc;h.VertexNormalsHelper=Ec;h.SpotLightHelper=Yb;h.SkeletonHelper=Zb;h.PointLightHelper=$b;h.HemisphereLightHelper=ac;h.GridHelper=Fc;h.FaceNormalsHelper=Gc;h.DirectionalLightHelper=bc;h.CameraHelper=Hc;h.BoundingBoxHelper=Ic;h.BoxHelper=Jc;h.ArrowHelper=yb;h.AxisHelper=id;h.ClosedSplineCurve3=pe;h.SplineCurve3=of;h.ArcCurve=jd;h.EllipseCurve=Ra;h.SplineCurve=tb;h.CubicBezierCurve=ub;h.QuadraticBezierCurve=vb;h.LineCurve=La;h.Shape=wb;h.ShapePath=vd;h.Path=Cc;h.Font=wd;h.CurvePath=Bc;h.Curve=Y;h.WireframeGeometry=
Ib;h.ParametricGeometry=jc;h.TetrahedronGeometry=kc;h.OctahedronGeometry=lc;h.IcosahedronGeometry=mc;h.DodecahedronGeometry=nc;h.PolyhedronGeometry=sa;h.TubeGeometry=wa;h.TorusKnotGeometry=oc;h.TorusKnotBufferGeometry=Jb;h.TorusGeometry=pc;h.TorusBufferGeometry=Kb;h.TextGeometry=qc;h.SphereBufferGeometry=ib;h.SphereGeometry=Lb;h.RingGeometry=rc;h.RingBufferGeometry=Mb;h.PlaneBufferGeometry=eb;h.PlaneGeometry=sc;h.LatheGeometry=tc;h.LatheBufferGeometry=Nb;h.ShapeGeometry=Ya;h.ExtrudeGeometry=ra;h.EdgesGeometry=
Ob;h.ConeGeometry=uc;h.ConeBufferGeometry=vc;h.CylinderGeometry=jb;h.CylinderBufferGeometry=Za;h.CircleBufferGeometry=Pb;h.CircleGeometry=wc;h.BoxBufferGeometry=db;h.BoxGeometry=kb;h.ShadowMaterial=Qb;h.SpriteMaterial=gb;h.RawShaderMaterial=Rb;h.ShaderMaterial=Da;h.PointsMaterial=Ja;h.MultiMaterial=xc;h.MeshPhysicalMaterial=lb;h.MeshStandardMaterial=Ka;h.MeshPhongMaterial=$a;h.MeshNormalMaterial=mb;h.MeshLambertMaterial=nb;h.MeshDepthMaterial=Ua;h.MeshBasicMaterial=Ia;h.LineDashedMaterial=ob;h.LineBasicMaterial=
na;h.Material=S;h.REVISION="81";h.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2};h.CullFaceNone=0;h.CullFaceBack=1;h.CullFaceFront=2;h.CullFaceFrontBack=3;h.FrontFaceDirectionCW=0;h.FrontFaceDirectionCCW=1;h.BasicShadowMap=0;h.PCFShadowMap=1;h.PCFSoftShadowMap=2;h.FrontSide=0;h.BackSide=1;h.DoubleSide=2;h.FlatShading=1;h.SmoothShading=2;h.NoColors=0;h.FaceColors=1;h.VertexColors=2;h.NoBlending=0;h.NormalBlending=1;h.AdditiveBlending=2;h.SubtractiveBlending=3;h.MultiplyBlending=4;h.CustomBlending=5;h.BlendingMode=
qe;h.AddEquation=100;h.SubtractEquation=101;h.ReverseSubtractEquation=102;h.MinEquation=103;h.MaxEquation=104;h.ZeroFactor=200;h.OneFactor=201;h.SrcColorFactor=202;h.OneMinusSrcColorFactor=203;h.SrcAlphaFactor=204;h.OneMinusSrcAlphaFactor=205;h.DstAlphaFactor=206;h.OneMinusDstAlphaFactor=207;h.DstColorFactor=208;h.OneMinusDstColorFactor=209;h.SrcAlphaSaturateFactor=210;h.NeverDepth=0;h.AlwaysDepth=1;h.LessDepth=2;h.LessEqualDepth=3;h.EqualDepth=4;h.GreaterEqualDepth=5;h.GreaterDepth=6;h.NotEqualDepth=
7;h.MultiplyOperation=0;h.MixOperation=1;h.AddOperation=2;h.NoToneMapping=0;h.LinearToneMapping=1;h.ReinhardToneMapping=2;h.Uncharted2ToneMapping=3;h.CineonToneMapping=4;h.UVMapping=300;h.CubeReflectionMapping=301;h.CubeRefractionMapping=302;h.EquirectangularReflectionMapping=303;h.EquirectangularRefractionMapping=304;h.SphericalReflectionMapping=305;h.CubeUVReflectionMapping=306;h.CubeUVRefractionMapping=307;h.TextureMapping=re;h.RepeatWrapping=1E3;h.ClampToEdgeWrapping=1001;h.MirroredRepeatWrapping=
1002;h.TextureWrapping=Md;h.NearestFilter=1003;h.NearestMipMapNearestFilter=1004;h.NearestMipMapLinearFilter=1005;h.LinearFilter=1006;h.LinearMipMapNearestFilter=1007;h.LinearMipMapLinearFilter=1008;h.TextureFilter=Nd;h.UnsignedByteType=1009;h.ByteType=1010;h.ShortType=1011;h.UnsignedShortType=1012;h.IntType=1013;h.UnsignedIntType=1014;h.FloatType=1015;h.HalfFloatType=1016;h.UnsignedShort4444Type=1017;h.UnsignedShort5551Type=1018;h.UnsignedShort565Type=1019;h.UnsignedInt248Type=1020;h.AlphaFormat=
1021;h.RGBFormat=1022;h.RGBAFormat=1023;h.LuminanceFormat=1024;h.LuminanceAlphaFormat=1025;h.RGBEFormat=1023;h.DepthFormat=1026;h.DepthStencilFormat=1027;h.RGB_S3TC_DXT1_Format=2001;h.RGBA_S3TC_DXT1_Format=2002;h.RGBA_S3TC_DXT3_Format=2003;h.RGBA_S3TC_DXT5_Format=2004;h.RGB_PVRTC_4BPPV1_Format=2100;h.RGB_PVRTC_2BPPV1_Format=2101;h.RGBA_PVRTC_4BPPV1_Format=2102;h.RGBA_PVRTC_2BPPV1_Format=2103;h.RGB_ETC1_Format=2151;h.LoopOnce=2200;h.LoopRepeat=2201;h.LoopPingPong=2202;h.InterpolateDiscrete=2300;h.InterpolateLinear=
2301;h.InterpolateSmooth=2302;h.ZeroCurvatureEnding=2400;h.ZeroSlopeEnding=2401;h.WrapAroundEnding=2402;h.TrianglesDrawMode=0;h.TriangleStripDrawMode=1;h.TriangleFanDrawMode=2;h.LinearEncoding=3E3;h.sRGBEncoding=3001;h.GammaEncoding=3007;h.RGBEEncoding=3002;h.LogLuvEncoding=3003;h.RGBM7Encoding=3004;h.RGBM16Encoding=3005;h.RGBDEncoding=3006;h.BasicDepthPacking=3200;h.RGBADepthPacking=3201;h.CubeGeometry=kb;h.Face4=function(a,b,c,d,e,f,g){console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead.");
return new ga(a,b,c,e,f,g)};h.LineStrip=0;h.LinePieces=1;h.MeshFaceMaterial=xc;h.PointCloud=function(a,b){console.warn("THREE.PointCloud has been renamed to THREE.Points.");return new Gb(a,b)};h.Particle=fc;h.ParticleSystem=function(a,b){console.warn("THREE.ParticleSystem has been renamed to THREE.Points.");return new Gb(a,b)};h.PointCloudMaterial=function(a){console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial.");return new Ja(a)};h.ParticleBasicMaterial=function(a){console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial.");
return new Ja(a)};h.ParticleSystemMaterial=function(a){console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial.");return new Ja(a)};h.Vertex=function(a,b,c){console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead.");return new q(a,b,c)};h.EdgesHelper=function(a,b){console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead.");return new ha(new Ob(a.geometry),new na({color:void 0!==b?b:16777215}))};h.WireframeHelper=function(a,b){console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead.");
return new ha(new Ib(a.geometry),new na({color:void 0!==b?b:16777215}))};h.GeometryUtils={merge:function(a,b,c){console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.");var d;b.isMesh&&(b.matrixAutoUpdate&&b.updateMatrix(),d=b.matrix,b=b.geometry);a.merge(b,d,c)},center:function(a){console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead.");return a.center()}};h.ImageUtils=
{crossOrigin:void 0,loadTexture:function(a,b,c,d){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var e=new Sc;e.setCrossOrigin(this.crossOrigin);a=e.load(a,c,void 0,d);b&&(a.mapping=b);return a},loadTextureCube:function(a,b,c,d){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var e=new sd;e.setCrossOrigin(this.crossOrigin);a=e.load(a,c,void 0,d);b&&(a.mapping=b);return a},loadCompressedTexture:function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},
loadCompressedTextureCube:function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")}};h.Projector=function(){console.error("THREE.Projector has been moved to /examples/js/renderers/Projector.js.");this.projectVector=function(a,b){console.warn("THREE.Projector: .projectVector() is now vector.project().");a.project(b)};this.unprojectVector=function(a,b){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject().");a.unproject(b)};
this.pickingRay=function(a,b){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")}};h.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js");this.domElement=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");this.clear=function(){};this.render=function(){};this.setClearColor=function(){};this.setSize=function(){}};Object.defineProperty(h,"__esModule",{value:!0})});

/**
 * @author alteredq / http://alteredqualia.com/
 */

THREE.EffectComposer = function ( renderer, renderTarget ) {

	this.renderer = renderer;

	if ( renderTarget === undefined ) {

		var parameters = {
			minFilter: THREE.LinearFilter,
			magFilter: THREE.LinearFilter,
			format: THREE.RGBAFormat,
			stencilBuffer: false
		};
		var size = renderer.getSize();
		renderTarget = new THREE.WebGLRenderTarget( size.width, size.height, parameters );

	}

	this.renderTarget1 = renderTarget;
	this.renderTarget2 = renderTarget.clone();

	this.writeBuffer = this.renderTarget1;
	this.readBuffer = this.renderTarget2;

	this.passes = [];

	if ( THREE.CopyShader === undefined )
		console.error( "THREE.EffectComposer relies on THREE.CopyShader" );

	this.copyPass = new THREE.ShaderPass( THREE.CopyShader );

};

Object.assign( THREE.EffectComposer.prototype, {

	swapBuffers: function() {

		var tmp = this.readBuffer;
		this.readBuffer = this.writeBuffer;
		this.writeBuffer = tmp;

	},

	addPass: function ( pass ) {

		this.passes.push( pass );

		var size = this.renderer.getSize();
		pass.setSize( size.width, size.height );

	},

	insertPass: function ( pass, index ) {

		this.passes.splice( index, 0, pass );

	},

	render: function ( delta ) {

		var maskActive = false;

		var pass, i, il = this.passes.length;

		for ( i = 0; i < il; i ++ ) {

			pass = this.passes[ i ];

			if ( pass.enabled === false ) continue;

			pass.render( this.renderer, this.writeBuffer, this.readBuffer, delta, maskActive );

			if ( pass.needsSwap ) {

				if ( maskActive ) {

					var context = this.renderer.context;

					context.stencilFunc( context.NOTEQUAL, 1, 0xffffffff );

					this.copyPass.render( this.renderer, this.writeBuffer, this.readBuffer, delta );

					context.stencilFunc( context.EQUAL, 1, 0xffffffff );

				}

				this.swapBuffers();

			}

			if ( THREE.MaskPass !== undefined ) {

				if ( pass instanceof THREE.MaskPass ) {

					maskActive = true;

				} else if ( pass instanceof THREE.ClearMaskPass ) {

					maskActive = false;

				}

			}

		}

	},

	reset: function ( renderTarget ) {

		if ( renderTarget === undefined ) {

			var size = this.renderer.getSize();

			renderTarget = this.renderTarget1.clone();
			renderTarget.setSize( size.width, size.height );

		}

		this.renderTarget1.dispose();
		this.renderTarget2.dispose();
		this.renderTarget1 = renderTarget;
		this.renderTarget2 = renderTarget.clone();

		this.writeBuffer = this.renderTarget1;
		this.readBuffer = this.renderTarget2;

	},

	setSize: function ( width, height ) {

		this.renderTarget1.setSize( width, height );
		this.renderTarget2.setSize( width, height );

		for ( var i = 0; i < this.passes.length; i ++ ) {

			this.passes[i].setSize( width, height );

		}

	}

} );


THREE.Pass = function () {

	// if set to true, the pass is processed by the composer
	this.enabled = true;

	// if set to true, the pass indicates to swap read and write buffer after rendering
	this.needsSwap = true;

	// if set to true, the pass clears its buffer before rendering
	this.clear = false;

	// if set to true, the result of the pass is rendered to screen
	this.renderToScreen = false;

};

Object.assign( THREE.Pass.prototype, {

	setSize: function( width, height ) {},

	render: function ( renderer, writeBuffer, readBuffer, delta, maskActive ) {

		console.error( "THREE.Pass: .render() must be implemented in derived pass." );

	}

} );

/**
 * @author miibond
 * Generate a texture that represents the luminosity of the current scene, adapted over time
 * to simulate the optic nerve responding to the amount of light it is receiving.
 * Based on a GDC2007 presentation by Wolfgang Engel titled "Post-Processing Pipeline"
 *
 * Full-screen tone-mapping shader based on http://www.graphics.cornell.edu/~jaf/publications/sig02_paper.pdf
 */

THREE.AdaptiveToneMappingPass = function ( adaptive, resolution ) {

	THREE.Pass.call( this );

	this.resolution = ( resolution !== undefined ) ? resolution : 256;
	this.needsInit = true;
	this.adaptive = adaptive !== undefined ? !! adaptive : true;

	this.luminanceRT = null;
	this.previousLuminanceRT = null;
	this.currentLuminanceRT = null;

	if ( THREE.CopyShader === undefined )
		console.error( "THREE.AdaptiveToneMappingPass relies on THREE.CopyShader" );

	var copyShader = THREE.CopyShader;

	this.copyUniforms = THREE.UniformsUtils.clone( copyShader.uniforms );

	this.materialCopy = new THREE.ShaderMaterial( {

		uniforms: this.copyUniforms,
		vertexShader: copyShader.vertexShader,
		fragmentShader: copyShader.fragmentShader,
		blending: THREE.NoBlending,
		depthTest: false

	} );

	if ( THREE.LuminosityShader === undefined )
		console.error( "THREE.AdaptiveToneMappingPass relies on THREE.LuminosityShader" );

	this.materialLuminance = new THREE.ShaderMaterial( {

		uniforms: THREE.UniformsUtils.clone( THREE.LuminosityShader.uniforms ),
		vertexShader: THREE.LuminosityShader.vertexShader,
		fragmentShader: THREE.LuminosityShader.fragmentShader,
		blending: THREE.NoBlending,
	} );

	this.adaptLuminanceShader = {
		defines: {
			"MIP_LEVEL_1X1" : ( Math.log( this.resolution ) / Math.log( 2.0 ) ).toFixed( 1 ),
		},
		uniforms: {
			"lastLum": { value: null },
			"currentLum": { value: null },
			"delta": { value: 0.016 },
			"tau": { value: 1.0 }
		},
		vertexShader: [
			"varying vec2 vUv;",

			"void main() {",

				"vUv = uv;",
				"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

			"}"
		].join( '\n' ),
		fragmentShader: [
			"varying vec2 vUv;",

			"uniform sampler2D lastLum;",
			"uniform sampler2D currentLum;",
			"uniform float delta;",
			"uniform float tau;",

			"void main() {",

				"vec4 lastLum = texture2D( lastLum, vUv, MIP_LEVEL_1X1 );",
				"vec4 currentLum = texture2D( currentLum, vUv, MIP_LEVEL_1X1 );",

				"float fLastLum = lastLum.r;",
				"float fCurrentLum = currentLum.r;",

				//The adaption seems to work better in extreme lighting differences
				//if the input luminance is squared.
				"fCurrentLum *= fCurrentLum;",

				// Adapt the luminance using Pattanaik's technique
				"float fAdaptedLum = fLastLum + (fCurrentLum - fLastLum) * (1.0 - exp(-delta * tau));",
				// "fAdaptedLum = sqrt(fAdaptedLum);",
				"gl_FragColor = vec4( vec3( fAdaptedLum ), 1.0 );",
			"}",
		].join( '\n' )
	};

	this.materialAdaptiveLum = new THREE.ShaderMaterial( {

		uniforms: THREE.UniformsUtils.clone( this.adaptLuminanceShader.uniforms ),
		vertexShader: this.adaptLuminanceShader.vertexShader,
		fragmentShader: this.adaptLuminanceShader.fragmentShader,
		defines: this.adaptLuminanceShader.defines,
		blending: THREE.NoBlending
	} );

	if ( THREE.ToneMapShader === undefined )
		console.error( "THREE.AdaptiveToneMappingPass relies on THREE.ToneMapShader" );

	this.materialToneMap = new THREE.ShaderMaterial( {

		uniforms: THREE.UniformsUtils.clone( THREE.ToneMapShader.uniforms ),
		vertexShader: THREE.ToneMapShader.vertexShader,
		fragmentShader: THREE.ToneMapShader.fragmentShader,
		blending: THREE.NoBlending
	} );

	this.camera = new THREE.OrthographicCamera( - 1, 1, 1, - 1, 0, 1 );
	this.scene  = new THREE.Scene();

	this.quad = new THREE.Mesh( new THREE.PlaneBufferGeometry( 2, 2 ), null );
	this.scene.add( this.quad );

};

THREE.AdaptiveToneMappingPass.prototype = Object.assign( Object.create( THREE.Pass.prototype ), {

	constructor: THREE.AdaptiveToneMappingPass,

	render: function ( renderer, writeBuffer, readBuffer, delta, maskActive ) {

		if ( this.needsInit ) {

			this.reset( renderer );

			this.luminanceRT.texture.type = readBuffer.texture.type;
			this.previousLuminanceRT.texture.type = readBuffer.texture.type;
			this.currentLuminanceRT.texture.type = readBuffer.texture.type;
			this.needsInit = false;

		}

		if ( this.adaptive ) {

			//Render the luminance of the current scene into a render target with mipmapping enabled
			this.quad.material = this.materialLuminance;
			this.materialLuminance.uniforms.tDiffuse.value = readBuffer.texture;
			renderer.render( this.scene, this.camera, this.currentLuminanceRT );

			//Use the new luminance values, the previous luminance and the frame delta to
			//adapt the luminance over time.
			this.quad.material = this.materialAdaptiveLum;
			this.materialAdaptiveLum.uniforms.delta.value = delta;
			this.materialAdaptiveLum.uniforms.lastLum.value = this.previousLuminanceRT.texture;
			this.materialAdaptiveLum.uniforms.currentLum.value = this.currentLuminanceRT.texture;
			renderer.render( this.scene, this.camera, this.luminanceRT );

			//Copy the new adapted luminance value so that it can be used by the next frame.
			this.quad.material = this.materialCopy;
			this.copyUniforms.tDiffuse.value = this.luminanceRT.texture;
			renderer.render( this.scene, this.camera, this.previousLuminanceRT );

		}

		this.quad.material = this.materialToneMap;
		this.materialToneMap.uniforms.tDiffuse.value = readBuffer.texture;
		renderer.render( this.scene, this.camera, writeBuffer, this.clear );

	},

	reset: function( renderer ) {

		// render targets
		if ( this.luminanceRT ) {

			this.luminanceRT.dispose();

		}
		if ( this.currentLuminanceRT ) {

			this.currentLuminanceRT.dispose();

		}
		if ( this.previousLuminanceRT ) {

			this.previousLuminanceRT.dispose();

		}

		var pars = { minFilter: THREE.LinearFilter, magFilter: THREE.LinearFilter, format: THREE.RGBAFormat }; // was RGB format. changed to RGBA format. see discussion in #8415 / #8450

		this.luminanceRT = new THREE.WebGLRenderTarget( this.resolution, this.resolution, pars );
		this.luminanceRT.texture.generateMipmaps = false;

		this.previousLuminanceRT = new THREE.WebGLRenderTarget( this.resolution, this.resolution, pars );
		this.previousLuminanceRT.texture.generateMipmaps = false;

		// We only need mipmapping for the current luminosity because we want a down-sampled version to sample in our adaptive shader
		pars.minFilter = THREE.LinearMipMapLinearFilter;
		this.currentLuminanceRT = new THREE.WebGLRenderTarget( this.resolution, this.resolution, pars );

		if ( this.adaptive ) {

			this.materialToneMap.defines[ "ADAPTED_LUMINANCE" ] = "";
			this.materialToneMap.uniforms.luminanceMap.value = this.luminanceRT.texture;

		}
		//Put something in the adaptive luminance texture so that the scene can render initially
		this.quad.material = new THREE.MeshBasicMaterial( { color: 0x777777 } );
		this.materialLuminance.needsUpdate = true;
		this.materialAdaptiveLum.needsUpdate = true;
		this.materialToneMap.needsUpdate = true;
		// renderer.render( this.scene, this.camera, this.luminanceRT );
		// renderer.render( this.scene, this.camera, this.previousLuminanceRT );
		// renderer.render( this.scene, this.camera, this.currentLuminanceRT );

	},

	setAdaptive: function( adaptive ) {

		if ( adaptive ) {

			this.adaptive = true;
			this.materialToneMap.defines[ "ADAPTED_LUMINANCE" ] = "";
			this.materialToneMap.uniforms.luminanceMap.value = this.luminanceRT.texture;

		} else {

			this.adaptive = false;
			delete this.materialToneMap.defines[ "ADAPTED_LUMINANCE" ];
			this.materialToneMap.uniforms.luminanceMap.value = null;

		}
		this.materialToneMap.needsUpdate = true;

	},

	setAdaptionRate: function( rate ) {

		if ( rate ) {

			this.materialAdaptiveLum.uniforms.tau.value = Math.abs( rate );

		}

	},

	setMaxLuminance: function( maxLum ) {

		if ( maxLum ) {

			this.materialToneMap.uniforms.maxLuminance.value = maxLum;

		}

	},

	setAverageLuminance: function( avgLum ) {

		if ( avgLum ) {

			this.materialToneMap.uniforms.averageLuminance.value = avgLum;

		}

	},

	setMiddleGrey: function( middleGrey ) {

		if ( middleGrey ) {

			this.materialToneMap.uniforms.middleGrey.value = middleGrey;

		}

	},

	dispose: function() {

		if ( this.luminanceRT ) {

			this.luminanceRT.dispose();

		}
		if ( this.previousLuminanceRT ) {

			this.previousLuminanceRT.dispose();

		}
		if ( this.currentLuminanceRT ) {

			this.currentLuminanceRT.dispose();

		}
		if ( this.materialLuminance ) {

			this.materialLuminance.dispose();

		}
		if ( this.materialAdaptiveLum ) {

			this.materialAdaptiveLum.dispose();

		}
		if ( this.materialCopy ) {

			this.materialCopy.dispose();

		}
		if ( this.materialToneMap ) {

			this.materialToneMap.dispose();

		}

	}

} );

/**
 * @author alteredq / http://alteredqualia.com/
 */

THREE.BloomPass = function ( strength, kernelSize, sigma, resolution ) {

	THREE.Pass.call( this );

	strength = ( strength !== undefined ) ? strength : 1;
	kernelSize = ( kernelSize !== undefined ) ? kernelSize : 25;
	sigma = ( sigma !== undefined ) ? sigma : 4.0;
	resolution = ( resolution !== undefined ) ? resolution : 256;

	// render targets

	var pars = { minFilter: THREE.LinearFilter, magFilter: THREE.LinearFilter, format: THREE.RGBAFormat };

	this.renderTargetX = new THREE.WebGLRenderTarget( resolution, resolution, pars );
	this.renderTargetY = new THREE.WebGLRenderTarget( resolution, resolution, pars );

	// copy material

	if ( THREE.CopyShader === undefined )
		console.error( "THREE.BloomPass relies on THREE.CopyShader" );

	var copyShader = THREE.CopyShader;

	this.copyUniforms = THREE.UniformsUtils.clone( copyShader.uniforms );

	this.copyUniforms[ "opacity" ].value = strength;

	this.materialCopy = new THREE.ShaderMaterial( {

		uniforms: this.copyUniforms,
		vertexShader: copyShader.vertexShader,
		fragmentShader: copyShader.fragmentShader,
		blending: THREE.AdditiveBlending,
		transparent: true

	} );

	// convolution material

	if ( THREE.ConvolutionShader === undefined )
		console.error( "THREE.BloomPass relies on THREE.ConvolutionShader" );

	var convolutionShader = THREE.ConvolutionShader;

	this.convolutionUniforms = THREE.UniformsUtils.clone( convolutionShader.uniforms );

	this.convolutionUniforms[ "uImageIncrement" ].value = THREE.BloomPass.blurX;
	this.convolutionUniforms[ "cKernel" ].value = THREE.ConvolutionShader.buildKernel( sigma );

	this.materialConvolution = new THREE.ShaderMaterial( {

		uniforms: this.convolutionUniforms,
		vertexShader:  convolutionShader.vertexShader,
		fragmentShader: convolutionShader.fragmentShader,
		defines: {
			"KERNEL_SIZE_FLOAT": kernelSize.toFixed( 1 ),
			"KERNEL_SIZE_INT": kernelSize.toFixed( 0 )
		}

	} );

	this.needsSwap = false;

	this.camera = new THREE.OrthographicCamera( - 1, 1, 1, - 1, 0, 1 );
	this.scene  = new THREE.Scene();

	this.quad = new THREE.Mesh( new THREE.PlaneBufferGeometry( 2, 2 ), null );
	this.scene.add( this.quad );

};

THREE.BloomPass.prototype = Object.assign( Object.create( THREE.Pass.prototype ), {

	constructor: THREE.BloomPass,

	render: function ( renderer, writeBuffer, readBuffer, delta, maskActive ) {

		if ( maskActive ) renderer.context.disable( renderer.context.STENCIL_TEST );

		// Render quad with blured scene into texture (convolution pass 1)

		this.quad.material = this.materialConvolution;

		this.convolutionUniforms[ "tDiffuse" ].value = readBuffer.texture;
		this.convolutionUniforms[ "uImageIncrement" ].value = THREE.BloomPass.blurX;

		renderer.render( this.scene, this.camera, this.renderTargetX, true );


		// Render quad with blured scene into texture (convolution pass 2)

		this.convolutionUniforms[ "tDiffuse" ].value = this.renderTargetX.texture;
		this.convolutionUniforms[ "uImageIncrement" ].value = THREE.BloomPass.blurY;

		renderer.render( this.scene, this.camera, this.renderTargetY, true );

		// Render original scene with superimposed blur to texture

		this.quad.material = this.materialCopy;

		this.copyUniforms[ "tDiffuse" ].value = this.renderTargetY.texture;

		if ( maskActive ) renderer.context.enable( renderer.context.STENCIL_TEST );

		renderer.render( this.scene, this.camera, readBuffer, this.clear );

	}

} );

THREE.BloomPass.blurX = new THREE.Vector2( 0.001953125, 0.0 );
THREE.BloomPass.blurY = new THREE.Vector2( 0.0, 0.001953125 );

/**
 * Depth-of-field post-process with bokeh shader
 */


THREE.BokehPass = function ( scene, camera, params ) {

	THREE.Pass.call( this );

	this.scene = scene;
	this.camera = camera;

	var focus = ( params.focus !== undefined ) ? params.focus : 1.0;
	var aspect = ( params.aspect !== undefined ) ? params.aspect : camera.aspect;
	var aperture = ( params.aperture !== undefined ) ? params.aperture : 0.025;
	var maxblur = ( params.maxblur !== undefined ) ? params.maxblur : 1.0;

	// render targets

	var width = params.width || window.innerWidth || 1;
	var height = params.height || window.innerHeight || 1;

	this.renderTargetColor = new THREE.WebGLRenderTarget( width, height, {
		minFilter: THREE.LinearFilter,
		magFilter: THREE.LinearFilter,
		format: THREE.RGBFormat
	} );

	this.renderTargetDepth = this.renderTargetColor.clone();

	// depth material

	this.materialDepth = new THREE.MeshDepthMaterial();

	// bokeh material

	if ( THREE.BokehShader === undefined ) {

		console.error( "THREE.BokehPass relies on THREE.BokehShader" );

	}

	var bokehShader = THREE.BokehShader;
	var bokehUniforms = THREE.UniformsUtils.clone( bokehShader.uniforms );

	bokehUniforms[ "tDepth" ].value = this.renderTargetDepth.texture;

	bokehUniforms[ "focus" ].value = focus;
	bokehUniforms[ "aspect" ].value = aspect;
	bokehUniforms[ "aperture" ].value = aperture;
	bokehUniforms[ "maxblur" ].value = maxblur;

	this.materialBokeh = new THREE.ShaderMaterial( {
		uniforms: bokehUniforms,
		vertexShader: bokehShader.vertexShader,
		fragmentShader: bokehShader.fragmentShader
	} );

	this.uniforms = bokehUniforms;
	this.needsSwap = false;

	this.camera2 = new THREE.OrthographicCamera( - 1, 1, 1, - 1, 0, 1 );
	this.scene2  = new THREE.Scene();

	this.quad2 = new THREE.Mesh( new THREE.PlaneBufferGeometry( 2, 2 ), null );
	this.scene2.add( this.quad2 );

};

THREE.BokehPass.prototype = Object.assign( Object.create( THREE.Pass.prototype ), {

	constructor: THREE.BokehPass,

	render: function ( renderer, writeBuffer, readBuffer, delta, maskActive ) {

		this.quad2.material = this.materialBokeh;

		// Render depth into texture

		this.scene.overrideMaterial = this.materialDepth;

		renderer.render( this.scene, this.camera, this.renderTargetDepth, true );

		// Render bokeh composite

		this.uniforms[ "tColor" ].value = readBuffer.texture;

		if ( this.renderToScreen ) {

			renderer.render( this.scene2, this.camera2 );

		} else {

			renderer.render( this.scene2, this.camera2, writeBuffer, this.clear );

		}

		this.scene.overrideMaterial = null;

	}

} );

/**
 * @author mrdoob / http://mrdoob.com/
 */

THREE.ClearPass = function ( clearColor, clearAlpha ) {

	THREE.Pass.call( this );

	this.needsSwap = false;

	this.clearColor = ( clearColor !== undefined ) ? clearColor : 0x000000;
	this.clearAlpha = ( clearAlpha !== undefined ) ? clearAlpha : 0;

};

THREE.ClearPass.prototype = Object.assign( Object.create( THREE.Pass.prototype ), {

	constructor: THREE.ClearPass,

	render: function ( renderer, writeBuffer, readBuffer, delta, maskActive ) {

		var oldClearColor, oldClearAlpha;

		if ( this.clearColor ) {

			oldClearColor = renderer.getClearColor().getHex();
			oldClearAlpha = renderer.getClearAlpha();

			renderer.setClearColor( this.clearColor, this.clearAlpha );

		}

		renderer.setRenderTarget( this.renderToScreen ? null : readBuffer );
		renderer.clear();

		if ( this.clearColor ) {

			renderer.setClearColor( oldClearColor, oldClearAlpha );

		}

	}

} );

/**
 * @author bhouston / http://clara.io/
 */

THREE.CubeTexturePass = function ( camera, envMap, opacity ) {

	THREE.Pass.call( this );

	this.camera = camera;

	this.needsSwap = false;

	this.cubeShader = THREE.ShaderLib[ 'cube' ];
	this.cubeMesh = new THREE.Mesh(
		new THREE.BoxBufferGeometry( 10, 10, 10 ),
		new THREE.ShaderMaterial( {
			uniforms: this.cubeShader.uniforms,
			vertexShader: this.cubeShader.vertexShader,
			fragmentShader: this.cubeShader.fragmentShader,
			depthTest: false,
			depthWrite: false,
			side: THREE.BackSide
		} )
	);

	this.envMap = envMap;
	this.opacity = ( opacity !== undefined ) ? opacity : 1.0;

	this.cubeScene = new THREE.Scene();
	this.cubeCamera = new THREE.PerspectiveCamera();
	this.cubeScene.add( this.cubeMesh );

};

THREE.CubeTexturePass.prototype = Object.assign( Object.create( THREE.Pass.prototype ), {

	constructor: THREE.CubeTexturePass,

	render: function ( renderer, writeBuffer, readBuffer, delta, maskActive ) {

		var oldAutoClear = renderer.autoClear;
		renderer.autoClear = false;

		this.cubeCamera.projectionMatrix.copy( this.camera.projectionMatrix );
		this.cubeCamera.quaternion.setFromRotationMatrix( this.camera.matrixWorld );

		this.cubeMesh.material.uniforms[ "tCube" ].value = this.envMap;
		this.cubeMesh.material.uniforms[ "opacity" ].value = this.opacity;
		this.cubeMesh.material.transparent = ( this.opacity < 1.0 );

		renderer.render( this.cubeScene, this.cubeCamera, this.renderToScreen ? null : readBuffer, this.clear );

		renderer.autoClear = oldAutoClear;

	}

} );

/**
 * @author alteredq / http://alteredqualia.com/
 */

THREE.DotScreenPass = function ( center, angle, scale ) {

	THREE.Pass.call( this );

	if ( THREE.DotScreenShader === undefined )
		console.error( "THREE.DotScreenPass relies on THREE.DotScreenShader" );

	var shader = THREE.DotScreenShader;

	this.uniforms = THREE.UniformsUtils.clone( shader.uniforms );

	if ( center !== undefined ) this.uniforms[ "center" ].value.copy( center );
	if ( angle !== undefined ) this.uniforms[ "angle" ].value = angle;
	if ( scale !== undefined ) this.uniforms[ "scale" ].value = scale;

	this.material = new THREE.ShaderMaterial( {

		uniforms: this.uniforms,
		vertexShader: shader.vertexShader,
		fragmentShader: shader.fragmentShader

	} );

	this.camera = new THREE.OrthographicCamera( - 1, 1, 1, - 1, 0, 1 );
	this.scene  = new THREE.Scene();

	this.quad = new THREE.Mesh( new THREE.PlaneBufferGeometry( 2, 2 ), null );
	this.scene.add( this.quad );

};

THREE.DotScreenPass.prototype = Object.assign( Object.create( THREE.Pass.prototype ), {

	constructor: THREE.DotScreenPass,

	render: function ( renderer, writeBuffer, readBuffer, delta, maskActive ) {

		this.uniforms[ "tDiffuse" ].value = readBuffer.texture;
		this.uniforms[ "tSize" ].value.set( readBuffer.width, readBuffer.height );

		this.quad.material = this.material;

		if ( this.renderToScreen ) {

			renderer.render( this.scene, this.camera );

		} else {

			renderer.render( this.scene, this.camera, writeBuffer, this.clear );

		}

	}

} );

/**
 * @author alteredq / http://alteredqualia.com/
 */

THREE.FilmPass = function ( noiseIntensity, scanlinesIntensity, scanlinesCount, grayscale ) {

	THREE.Pass.call( this );

	if ( THREE.FilmShader === undefined )
		console.error( "THREE.FilmPass relies on THREE.FilmShader" );

	var shader = THREE.FilmShader;

	this.uniforms = THREE.UniformsUtils.clone( shader.uniforms );

	this.material = new THREE.ShaderMaterial( {

		uniforms: this.uniforms,
		vertexShader: shader.vertexShader,
		fragmentShader: shader.fragmentShader

	} );

	if ( grayscale !== undefined )	this.uniforms.grayscale.value = grayscale;
	if ( noiseIntensity !== undefined ) this.uniforms.nIntensity.value = noiseIntensity;
	if ( scanlinesIntensity !== undefined ) this.uniforms.sIntensity.value = scanlinesIntensity;
	if ( scanlinesCount !== undefined ) this.uniforms.sCount.value = scanlinesCount;

	this.camera = new THREE.OrthographicCamera( - 1, 1, 1, - 1, 0, 1 );
	this.scene  = new THREE.Scene();

	this.quad = new THREE.Mesh( new THREE.PlaneBufferGeometry( 2, 2 ), null );
	this.scene.add( this.quad );

};

THREE.FilmPass.prototype = Object.assign( Object.create( THREE.Pass.prototype ), {

	constructor: THREE.FilmPass,

	render: function ( renderer, writeBuffer, readBuffer, delta, maskActive ) {

		this.uniforms[ "tDiffuse" ].value = readBuffer.texture;
		this.uniforms[ "time" ].value += delta;

		this.quad.material = this.material;

		if ( this.renderToScreen ) {

			renderer.render( this.scene, this.camera );

		} else {

			renderer.render( this.scene, this.camera, writeBuffer, this.clear );

		}

	}

} );

/**
 * @author alteredq / http://alteredqualia.com/
 */

THREE.GlitchPass = function ( dt_size ) {

	THREE.Pass.call( this );

	if ( THREE.DigitalGlitch === undefined ) console.error( "THREE.GlitchPass relies on THREE.DigitalGlitch" );

	var shader = THREE.DigitalGlitch;
	this.uniforms = THREE.UniformsUtils.clone( shader.uniforms );

	if ( dt_size == undefined ) dt_size = 64;


	this.uniforms[ "tDisp" ].value = this.generateHeightmap( dt_size );


	this.material = new THREE.ShaderMaterial( {
		uniforms: this.uniforms,
		vertexShader: shader.vertexShader,
		fragmentShader: shader.fragmentShader
	} );

	this.camera = new THREE.OrthographicCamera( - 1, 1, 1, - 1, 0, 1 );
	this.scene  = new THREE.Scene();

	this.quad = new THREE.Mesh( new THREE.PlaneBufferGeometry( 2, 2 ), null );
	this.scene.add( this.quad );

	this.goWild = false;
	this.curF = 0;
	this.generateTrigger();

};

THREE.GlitchPass.prototype = Object.assign( Object.create( THREE.Pass.prototype ), {

	constructor: THREE.GlitchPass,

	render: function ( renderer, writeBuffer, readBuffer, delta, maskActive ) {

		this.uniforms[ "tDiffuse" ].value = readBuffer.texture;
		this.uniforms[ 'seed' ].value = Math.random();//default seeding
		this.uniforms[ 'byp' ].value = 0;

		if ( this.curF % this.randX == 0 || this.goWild == true ) {

			this.uniforms[ 'amount' ].value = Math.random() / 30;
			this.uniforms[ 'angle' ].value = THREE.Math.randFloat( - Math.PI, Math.PI );
			this.uniforms[ 'seed_x' ].value = THREE.Math.randFloat( - 1, 1 );
			this.uniforms[ 'seed_y' ].value = THREE.Math.randFloat( - 1, 1 );
			this.uniforms[ 'distortion_x' ].value = THREE.Math.randFloat( 0, 1 );
			this.uniforms[ 'distortion_y' ].value = THREE.Math.randFloat( 0, 1 );
			this.curF = 0;
			this.generateTrigger();

		} else if ( this.curF % this.randX < this.randX / 5 ) {

			this.uniforms[ 'amount' ].value = Math.random() / 90;
			this.uniforms[ 'angle' ].value = THREE.Math.randFloat( - Math.PI, Math.PI );
			this.uniforms[ 'distortion_x' ].value = THREE.Math.randFloat( 0, 1 );
			this.uniforms[ 'distortion_y' ].value = THREE.Math.randFloat( 0, 1 );
			this.uniforms[ 'seed_x' ].value = THREE.Math.randFloat( - 0.3, 0.3 );
			this.uniforms[ 'seed_y' ].value = THREE.Math.randFloat( - 0.3, 0.3 );

		} else if ( this.goWild == false ) {

			this.uniforms[ 'byp' ].value = 1;

		}

		this.curF ++;
		this.quad.material = this.material;

		if ( this.renderToScreen ) {

			renderer.render( this.scene, this.camera );

		} else {

			renderer.render( this.scene, this.camera, writeBuffer, this.clear );

		}

	},

	generateTrigger: function() {

		this.randX = THREE.Math.randInt( 120, 240 );

	},

	generateHeightmap: function( dt_size ) {

		var data_arr = new Float32Array( dt_size * dt_size * 3 );
		var length = dt_size * dt_size;

		for ( var i = 0; i < length; i ++ ) {

			var val = THREE.Math.randFloat( 0, 1 );
			data_arr[ i * 3 + 0 ] = val;
			data_arr[ i * 3 + 1 ] = val;
			data_arr[ i * 3 + 2 ] = val;

		}

		var texture = new THREE.DataTexture( data_arr, dt_size, dt_size, THREE.RGBFormat, THREE.FloatType );
		texture.needsUpdate = true;
		return texture;

	}

} );

/**
*
* Manual Multi-Sample Anti-Aliasing Render Pass
*
* @author bhouston / http://clara.io/
*
* This manual approach to MSAA re-renders the scene ones for each sample with camera jitter and accumulates the results.
*
* References: https://en.wikipedia.org/wiki/Multisample_anti-aliasing
*
*/

THREE.ManualMSAARenderPass = function ( scene, camera, clearColor, clearAlpha ) {

	THREE.Pass.call( this );

	this.scene = scene;
	this.camera = camera;

	this.sampleLevel = 4; // specified as n, where the number of samples is 2^n, so sampleLevel = 4, is 2^4 samples, 16.
	this.unbiased = true;

	// as we need to clear the buffer in this pass, clearColor must be set to something, defaults to black.
	this.clearColor = ( clearColor !== undefined ) ? clearColor : 0x000000;
	this.clearAlpha = ( clearAlpha !== undefined ) ? clearAlpha : 0;

	if ( THREE.CopyShader === undefined ) console.error( "THREE.ManualMSAARenderPass relies on THREE.CopyShader" );

	var copyShader = THREE.CopyShader;
	this.copyUniforms = THREE.UniformsUtils.clone( copyShader.uniforms );

	this.copyMaterial = new THREE.ShaderMaterial(	{
		uniforms: this.copyUniforms,
		vertexShader: copyShader.vertexShader,
		fragmentShader: copyShader.fragmentShader,
		premultipliedAlpha: true,
		transparent: true,
		blending: THREE.AdditiveBlending,
		depthTest: false,
		depthWrite: false
	} );

	this.camera2 = new THREE.OrthographicCamera( - 1, 1, 1, - 1, 0, 1 );
	this.scene2	= new THREE.Scene();
	this.quad2 = new THREE.Mesh( new THREE.PlaneGeometry( 2, 2 ), this.copyMaterial );
	this.scene2.add( this.quad2 );

};

THREE.ManualMSAARenderPass.prototype = Object.assign( Object.create( THREE.Pass.prototype ), {

	constructor: THREE.ManualMSAARenderPass,

	dispose: function() {

		if ( this.sampleRenderTarget ) {

			this.sampleRenderTarget.dispose();
			this.sampleRenderTarget = null;

		}

	},

	setSize: function ( width, height ) {

		if ( this.sampleRenderTarget )	this.sampleRenderTarget.setSize( width, height );

	},

	render: function ( renderer, writeBuffer, readBuffer, delta, maskActive ) {

		if ( ! this.sampleRenderTarget ) {

			this.sampleRenderTarget = new THREE.WebGLRenderTarget( readBuffer.width, readBuffer.height,
				{ minFilter: THREE.LinearFilter, magFilter: THREE.LinearFilter, format: THREE.RGBAFormat } );

		}

		var jitterOffsets = THREE.ManualMSAARenderPass.JitterVectors[ Math.max( 0, Math.min( this.sampleLevel, 5 ) ) ];

		var autoClear = renderer.autoClear;
		renderer.autoClear = false;

		var oldClearColor = renderer.getClearColor().getHex();
		var oldClearAlpha = renderer.getClearAlpha();

		var baseSampleWeight = 1.0 / jitterOffsets.length;
		var roundingRange = 1 / 32;
		this.copyUniforms[ "tDiffuse" ].value = this.sampleRenderTarget.texture;

		var width = readBuffer.width, height = readBuffer.height;

		// render the scene multiple times, each slightly jitter offset from the last and accumulate the results.
		for ( var i = 0; i < jitterOffsets.length; i ++ ) {

			var jitterOffset = jitterOffsets[i];
			if ( this.camera.setViewOffset ) {
				this.camera.setViewOffset( width, height,
					jitterOffset[ 0 ] * 0.0625, jitterOffset[ 1 ] * 0.0625,   // 0.0625 = 1 / 16
					width, height );
			}

			var sampleWeight = baseSampleWeight;
			if( this.unbiased ) {
				// the theory is that equal weights for each sample lead to an accumulation of rounding errors.
				// The following equation varies the sampleWeight per sample so that it is uniformly distributed
				// across a range of values whose rounding errors cancel each other out.
				var uniformCenteredDistribution = ( -0.5 + ( i + 0.5 ) / jitterOffsets.length );
				sampleWeight += roundingRange * uniformCenteredDistribution;
			}

			this.copyUniforms[ "opacity" ].value = sampleWeight;
			renderer.setClearColor( this.clearColor, this.clearAlpha );
			renderer.render( this.scene, this.camera, this.sampleRenderTarget, true );
			if (i === 0) {
				renderer.setClearColor( 0x000000, 0.0 );
			}
			renderer.render( this.scene2, this.camera2, this.renderToScreen ? null : writeBuffer, (i === 0) );

		}

		if ( this.camera.clearViewOffset ) this.camera.clearViewOffset();

		renderer.autoClear = autoClear;
		renderer.setClearColor( oldClearColor, oldClearAlpha );

	}

} );


// These jitter vectors are specified in integers because it is easier.
// I am assuming a [-8,8) integer grid, but it needs to be mapped onto [-0.5,0.5)
// before being used, thus these integers need to be scaled by 1/16.
//
// Sample patterns reference: https://msdn.microsoft.com/en-us/library/windows/desktop/ff476218%28v=vs.85%29.aspx?f=255&MSPPError=-2147217396
THREE.ManualMSAARenderPass.JitterVectors = [
	[
		[ 0, 0 ]
	],
	[
		[ 4, 4 ], [ - 4, - 4 ]
	],
	[
		[ - 2, - 6 ], [ 6, - 2 ], [ - 6, 2 ], [ 2, 6 ]
	],
	[
		[ 1, - 3 ], [ - 1, 3 ], [ 5, 1 ], [ - 3, - 5 ],
		[ - 5, 5 ], [ - 7, - 1 ], [ 3, 7 ], [ 7, - 7 ]
	],
	[
		[ 1, 1 ], [ - 1, - 3 ], [ - 3, 2 ], [ 4, - 1 ],
		[ - 5, - 2 ], [ 2, 5 ], [ 5, 3 ], [ 3, - 5 ],
		[ - 2, 6 ], [ 0, - 7 ], [ - 4, - 6 ], [ - 6, 4 ],
		[ - 8, 0 ], [ 7, - 4 ], [ 6, 7 ], [ - 7, - 8 ]
	],
	[
		[ - 4, - 7 ], [ - 7, - 5 ], [ - 3, - 5 ], [ - 5, - 4 ],
		[ - 1, - 4 ], [ - 2, - 2 ], [ - 6, - 1 ], [ - 4, 0 ],
		[ - 7, 1 ], [ - 1, 2 ], [ - 6, 3 ], [ - 3, 3 ],
		[ - 7, 6 ], [ - 3, 6 ], [ - 5, 7 ], [ - 1, 7 ],
		[ 5, - 7 ], [ 1, - 6 ], [ 6, - 5 ], [ 4, - 4 ],
		[ 2, - 3 ], [ 7, - 2 ], [ 1, - 1 ], [ 4, - 1 ],
		[ 2, 1 ], [ 6, 2 ], [ 0, 4 ], [ 4, 4 ],
		[ 2, 5 ], [ 7, 5 ], [ 5, 6 ], [ 3, 7 ]
	]
];

/**
 * @author alteredq / http://alteredqualia.com/
 */

THREE.MaskPass = function ( scene, camera ) {

	THREE.Pass.call( this );

	this.scene = scene;
	this.camera = camera;

	this.clear = true;
	this.needsSwap = false;

	this.inverse = false;

};

THREE.MaskPass.prototype = Object.assign( Object.create( THREE.Pass.prototype ), {

	constructor: THREE.MaskPass,

	render: function ( renderer, writeBuffer, readBuffer, delta, maskActive ) {

		var context = renderer.context;
		var state = renderer.state;

		// don't update color or depth

		state.buffers.color.setMask( false );
		state.buffers.depth.setMask( false );

		// lock buffers

		state.buffers.color.setLocked( true );
		state.buffers.depth.setLocked( true );

		// set up stencil

		var writeValue, clearValue;

		if ( this.inverse ) {

			writeValue = 0;
			clearValue = 1;

		} else {

			writeValue = 1;
			clearValue = 0;

		}

		state.buffers.stencil.setTest( true );
		state.buffers.stencil.setOp( context.REPLACE, context.REPLACE, context.REPLACE );
		state.buffers.stencil.setFunc( context.ALWAYS, writeValue, 0xffffffff );
		state.buffers.stencil.setClear( clearValue );

		// draw into the stencil buffer

		renderer.render( this.scene, this.camera, readBuffer, this.clear );
		renderer.render( this.scene, this.camera, writeBuffer, this.clear );

		// unlock color and depth buffer for subsequent rendering

		state.buffers.color.setLocked( false );
		state.buffers.depth.setLocked( false );

		// only render where stencil is set to 1

		state.buffers.stencil.setFunc( context.EQUAL, 1, 0xffffffff );  // draw if == 1
		state.buffers.stencil.setOp( context.KEEP, context.KEEP, context.KEEP );

	}

} );


THREE.ClearMaskPass = function () {

	THREE.Pass.call( this );

	this.needsSwap = false;

};

THREE.ClearMaskPass.prototype = Object.create( THREE.Pass.prototype );

Object.assign( THREE.ClearMaskPass.prototype, {

	render: function ( renderer, writeBuffer, readBuffer, delta, maskActive ) {

		renderer.state.buffers.stencil.setTest( false );

	}

} );

/**
 * @author spidersharma / http://eduperiment.com/
 */

THREE.OutlinePass = function ( resolution, scene, camera, selectedObjects ) {

	this.renderScene = scene;
	this.renderCamera = camera;
	this.selectedObjects = selectedObjects !== undefined ? selectedObjects : [];
	this.visibleEdgeColor = new THREE.Color(1, 1, 1);
	this.hiddenEdgeColor = new THREE.Color(0.1, 0.04, 0.02);
	this.edgeGlow = 0.0;
	this.usePatternTexture = false;
	this.edgeThickness = 1.0;
	this.edgeStrength = 3.0;
	this.downSampleRatio = 2;
	this.pulsePeriod = 0;

	THREE.Pass.call( this );

	this.resolution = ( resolution !== undefined ) ? new THREE.Vector2(resolution.x, resolution.y) : new THREE.Vector2(256, 256);

	var pars = { minFilter: THREE.LinearFilter, magFilter: THREE.LinearFilter, format: THREE.RGBAFormat };

	var resx = Math.round(this.resolution.x/this.downSampleRatio);
	var resy = Math.round(this.resolution.y/this.downSampleRatio);

	this.maskBufferMaterial = new THREE.MeshBasicMaterial({color:0xffffff});
	this.maskBufferMaterial.side = THREE.DoubleSide;
	this.renderTargetMaskBuffer = new THREE.WebGLRenderTarget( this.resolution.x, this.resolution.y, pars );
	this.renderTargetMaskBuffer.texture.generateMipmaps = false;

	this.depthMaterial = new THREE.MeshDepthMaterial();
	this.depthMaterial.side = THREE.DoubleSide;
	this.depthMaterial.depthPacking = THREE.RGBADepthPacking;
	this.depthMaterial.blending = THREE.NoBlending;

	this.prepareMaskMaterial = this.getPrepareMaskMaterial();
	this.prepareMaskMaterial.side = THREE.DoubleSide;

	this.renderTargetDepthBuffer = new THREE.WebGLRenderTarget( this.resolution.x, this.resolution.y, pars );
	this.renderTargetDepthBuffer.texture.generateMipmaps = false;

	this.renderTargetMaskDownSampleBuffer = new THREE.WebGLRenderTarget( resx, resy, pars );
	this.renderTargetMaskDownSampleBuffer.texture.generateMipmaps = false;

	this.renderTargetBlurBuffer1 = new THREE.WebGLRenderTarget( resx, resy, pars );
	this.renderTargetBlurBuffer1.texture.generateMipmaps = false;
	this.renderTargetBlurBuffer2 = new THREE.WebGLRenderTarget( Math.round(resx/2), Math.round(resy/2), pars );
	this.renderTargetBlurBuffer2.texture.generateMipmaps = false;

	this.edgeDetectionMaterial = this.getEdgeDetectionMaterial();
	this.renderTargetEdgeBuffer1 = new THREE.WebGLRenderTarget( resx, resy, pars );
	this.renderTargetEdgeBuffer1.texture.generateMipmaps = false;
	this.renderTargetEdgeBuffer2 = new THREE.WebGLRenderTarget( Math.round(resx/2), Math.round(resy/2), pars );
	this.renderTargetEdgeBuffer2.texture.generateMipmaps = false;

	var MAX_EDGE_THICKNESS = 4;
	var MAX_EDGE_GLOW = 4;

	this.separableBlurMaterial1 = this.getSeperableBlurMaterial(MAX_EDGE_THICKNESS);
	this.separableBlurMaterial1.uniforms[ "texSize" ].value = new THREE.Vector2(resx, resy);
	this.separableBlurMaterial1.uniforms[ "kernelRadius" ].value = 1;
	this.separableBlurMaterial2 = this.getSeperableBlurMaterial(MAX_EDGE_GLOW);
	this.separableBlurMaterial2.uniforms[ "texSize" ].value = new THREE.Vector2(Math.round(resx/2), Math.round(resy/2));
	this.separableBlurMaterial2.uniforms[ "kernelRadius" ].value = MAX_EDGE_GLOW;

	// Overlay material
	this.overlayMaterial = this.getOverlayMaterial();

	// copy material
	if ( THREE.CopyShader === undefined )
		console.error( "THREE.OutlinePass relies on THREE.CopyShader" );

	var copyShader = THREE.CopyShader;

	this.copyUniforms = THREE.UniformsUtils.clone( copyShader.uniforms );
	this.copyUniforms[ "opacity" ].value = 1.0;

	this.materialCopy = new THREE.ShaderMaterial( {
		uniforms: this.copyUniforms,
		vertexShader: copyShader.vertexShader,
		fragmentShader: copyShader.fragmentShader,
		blending: THREE.NoBlending,
		depthTest: false,
		depthWrite: false,
		transparent: true
	} );

	this.enabled = true;
	this.needsSwap = false;

	this.oldClearColor = new THREE.Color();
	this.oldClearAlpha = 1;

	this.camera = new THREE.OrthographicCamera( - 1, 1, 1, - 1, 0, 1 );
	this.scene  = new THREE.Scene();

	this.quad = new THREE.Mesh( new THREE.PlaneBufferGeometry( 2, 2 ), null );
	this.scene.add( this.quad );

	this.tempPulseColor1 = new THREE.Color();
	this.tempPulseColor2 = new THREE.Color();
	this.textureMatrix = new THREE.Matrix4();
};

THREE.OutlinePass.prototype = Object.assign( Object.create( THREE.Pass.prototype ), {

	constructor: THREE.OutlinePass,

	dispose: function() {
		this.renderTargetMaskBuffer.dispose();
		this.renderTargetDepthBuffer.dispose();
		this.renderTargetMaskDownSampleBuffer.dispose();
		this.renderTargetBlurBuffer1.dispose();
		this.renderTargetBlurBuffer2.dispose();
		this.renderTargetEdgeBuffer1.dispose();
		this.renderTargetEdgeBuffer2.dispose();
	},

	setSize: function ( width, height ) {

		this.renderTargetMaskBuffer.setSize(width, height );

		var resx = Math.round(width/this.downSampleRatio);
		var resy = Math.round(height/this.downSampleRatio);
		this.renderTargetMaskDownSampleBuffer.setSize(resx, resy );
		this.renderTargetBlurBuffer1.setSize(resx, resy );
		this.renderTargetEdgeBuffer1.setSize(resx, resy );
		this.separableBlurMaterial1.uniforms[ "texSize" ].value = new THREE.Vector2(resx, resy);

	  resx = Math.round(resx/2);
	  resy = Math.round(resy/2);

		this.renderTargetBlurBuffer2.setSize(resx, resy );
		this.renderTargetEdgeBuffer2.setSize(resx, resy );

		this.separableBlurMaterial2.uniforms[ "texSize" ].value = new THREE.Vector2(resx, resy);
	},

	changeVisibilityOfSelectedObjects: function( bVisible ) {

		var gatherSelectedMeshesCallBack = function( object ) {

			if( object instanceof THREE.Mesh ) {
				object.visible = bVisible;
			}
		}

		for( var i=0; i<this.selectedObjects.length; i++ ) {

			var selectedObject = this.selectedObjects[i];

			selectedObject.traverse( gatherSelectedMeshesCallBack );
		}
	},

	changeVisibilityOfNonSelectedObjects: function( bVisible ) {

		var selectedMeshes = [];

		var gatherSelectedMeshesCallBack = function( object ) {

			if( object instanceof THREE.Mesh ) {

				selectedMeshes.push(object);

			}
		}

		for( var i=0; i<this.selectedObjects.length; i++ ) {

			var selectedObject = this.selectedObjects[i];

			selectedObject.traverse( gatherSelectedMeshesCallBack );
		}

		var VisibilityChangeCallBack = function( object ) {

			if( object instanceof THREE.Mesh ) {

				var bFound = false;

				for( var i=0; i<selectedMeshes.length; i++ ) {

					var selectedObjectId = selectedMeshes[i].id;

					if(selectedObjectId === object.id) {
						bFound = true;
						break;
					}

				}
				if(!bFound) {
					var visibility = object.visible;
					if( !bVisible || object.bVisible )
						object.visible = bVisible;
					object.bVisible = visibility;
				}
			}
		}
		this.renderScene.traverse( VisibilityChangeCallBack );
	},

	updateTextureMatrix: function() {

		this.textureMatrix.set( 0.5, 0.0, 0.0, 0.5,
														0.0, 0.5, 0.0, 0.5,
														0.0, 0.0, 0.5, 0.5,
														0.0, 0.0, 0.0, 1.0 );
		this.textureMatrix.multiply( this.renderCamera.projectionMatrix );
		this.textureMatrix.multiply( this.renderCamera.matrixWorldInverse );

	},

	render: function ( renderer, writeBuffer, readBuffer, delta, maskActive ) {

		if(this.selectedObjects.length === 0 )
			return;

		this.oldClearColor.copy( renderer.getClearColor() );
		this.oldClearAlpha = renderer.getClearAlpha();
		var oldAutoClear = renderer.autoClear;

		renderer.autoClear = false;

		if ( maskActive ) renderer.context.disable( renderer.context.STENCIL_TEST );

		renderer.setClearColor( 0xffffff, 1 );

		// Make selected objects invisible
		this.changeVisibilityOfSelectedObjects(false);

		// 1. Draw Non Selected objects in the depth buffer
		this.renderScene.overrideMaterial = this.depthMaterial;
		renderer.render( this.renderScene, this.renderCamera, this.renderTargetDepthBuffer, true );

		// Make selected objects visible
		this.changeVisibilityOfSelectedObjects(true);

		// Update Texture Matrix for Depth compare
		this.updateTextureMatrix();

		// Make non selected objects invisible, and draw only the selected objects, by comparing the depth buffer of non selected objects
		this.changeVisibilityOfNonSelectedObjects(false);
		this.renderScene.overrideMaterial = this.prepareMaskMaterial;
		this.prepareMaskMaterial.uniforms[ "cameraNearFar" ].value = new THREE.Vector2(this.renderCamera.near, this.renderCamera.far);
		this.prepareMaskMaterial.uniforms[ "depthTexture" ].value = this.renderTargetDepthBuffer.texture;
		this.prepareMaskMaterial.uniforms[ "textureMatrix" ].value = this.textureMatrix;
		renderer.render( this.renderScene, this.renderCamera, this.renderTargetMaskBuffer, true );
		this.renderScene.overrideMaterial = null;
		this.changeVisibilityOfNonSelectedObjects(true);

		// 2. Downsample to Half resolution
		this.quad.material = this.materialCopy;
		this.copyUniforms[ "tDiffuse" ].value = this.renderTargetMaskBuffer.texture;
		renderer.render( this.scene, this.camera, this.renderTargetMaskDownSampleBuffer, true );

		this.tempPulseColor1.copy( this.visibleEdgeColor );
		this.tempPulseColor2.copy( this.hiddenEdgeColor );
		if( this.pulsePeriod > 0 ) {
			var scalar = ( 1 + 0.25 ) / 2 + Math.cos( performance.now() * 0.01/ this.pulsePeriod ) * ( 1.0 - 0.25 )/2
			this.tempPulseColor1.multiplyScalar( scalar );
			this.tempPulseColor2.multiplyScalar( scalar );
		}

		// 3. Apply Edge Detection Pass
		this.quad.material = this.edgeDetectionMaterial;
		this.edgeDetectionMaterial.uniforms[ "maskTexture" ].value = this.renderTargetMaskDownSampleBuffer.texture;
		this.edgeDetectionMaterial.uniforms[ "texSize" ].value = new THREE.Vector2(this.renderTargetMaskDownSampleBuffer.width, this.renderTargetMaskDownSampleBuffer.height);
		this.edgeDetectionMaterial.uniforms[ "visibleEdgeColor" ].value = this.tempPulseColor1;
		this.edgeDetectionMaterial.uniforms[ "hiddenEdgeColor" ].value = this.tempPulseColor2;
		renderer.render( this.scene, this.camera, this.renderTargetEdgeBuffer1, true );

		// 4. Apply Blur on Half res
		this.quad.material = this.separableBlurMaterial1;
		this.separableBlurMaterial1.uniforms[ "colorTexture" ].value = this.renderTargetEdgeBuffer1.texture;
		this.separableBlurMaterial1.uniforms[ "direction" ].value = THREE.OutlinePass.BlurDirectionX;
		this.separableBlurMaterial1.uniforms[ "kernelRadius" ].value = this.edgeThickness;
		renderer.render( this.scene, this.camera, this.renderTargetBlurBuffer1, true );
		this.separableBlurMaterial1.uniforms[ "colorTexture" ].value = this.renderTargetBlurBuffer1.texture;
		this.separableBlurMaterial1.uniforms[ "direction" ].value = THREE.OutlinePass.BlurDirectionY;
		renderer.render( this.scene, this.camera, this.renderTargetEdgeBuffer1, true );

		// Apply Blur on quarter res
		this.quad.material = this.separableBlurMaterial2;
		this.separableBlurMaterial2.uniforms[ "colorTexture" ].value = this.renderTargetEdgeBuffer1.texture;
		this.separableBlurMaterial2.uniforms[ "direction" ].value = THREE.OutlinePass.BlurDirectionX;
		renderer.render( this.scene, this.camera, this.renderTargetBlurBuffer2, true );
		this.separableBlurMaterial2.uniforms[ "colorTexture" ].value = this.renderTargetBlurBuffer2.texture;
		this.separableBlurMaterial2.uniforms[ "direction" ].value = THREE.OutlinePass.BlurDirectionY;
		renderer.render( this.scene, this.camera, this.renderTargetEdgeBuffer2, true );

		// Blend it additively over the input texture
		this.quad.material = this.overlayMaterial;
		this.overlayMaterial.uniforms[ "maskTexture" ].value = this.renderTargetMaskBuffer.texture;
		this.overlayMaterial.uniforms[ "edgeTexture1" ].value = this.renderTargetEdgeBuffer1.texture;
		this.overlayMaterial.uniforms[ "edgeTexture2" ].value = this.renderTargetEdgeBuffer2.texture;
		this.overlayMaterial.uniforms[ "patternTexture" ].value = this.patternTexture;
		this.overlayMaterial.uniforms[ "edgeStrength" ].value = this.edgeStrength;
		this.overlayMaterial.uniforms[ "edgeGlow" ].value = this.edgeGlow;
		this.overlayMaterial.uniforms[ "usePatternTexture" ].value = this.usePatternTexture;


		if ( maskActive ) renderer.context.enable( renderer.context.STENCIL_TEST );

		renderer.render( this.scene, this.camera, readBuffer, false );

		renderer.setClearColor( this.oldClearColor, this.oldClearAlpha );
		renderer.autoClear = oldAutoClear;
	},

	getPrepareMaskMaterial: function() {

		return new THREE.ShaderMaterial( {

			uniforms: {
				"depthTexture": { value: null },
				"cameraNearFar": { value: new THREE.Vector2( 0.5, 0.5 ) },
				"textureMatrix" : { value: new THREE.Matrix4() }
			},

			vertexShader:
				"varying vec2 vUv;\
				varying vec4 projTexCoord;\
				varying vec4 vPosition;\
				uniform mat4 textureMatrix;\
				void main() {\
					vUv = uv;\
					vPosition = modelViewMatrix * vec4( position, 1.0 );\
					vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\
					projTexCoord = textureMatrix * worldPosition;\
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\
				}",

			fragmentShader:
				"#include <packing>\
				varying vec2 vUv;\
				varying vec4 vPosition;\
				varying vec4 projTexCoord;\
				uniform sampler2D depthTexture;\
				uniform vec2 cameraNearFar;\
				\
				void main() {\
					float depth = unpackRGBAToDepth(texture2DProj( depthTexture, projTexCoord ));\
					float viewZ = -perspectiveDepthToViewZ( depth, cameraNearFar.x, cameraNearFar.y );\
					float depthTest = (-vPosition.z > viewZ) ? 1.0 : 0.0;\
					gl_FragColor = vec4(0.0, depthTest, 1.0, 1.0);\
				}"
		} );
	},

	getEdgeDetectionMaterial: function() {

		return new THREE.ShaderMaterial( {

			uniforms: {
				"maskTexture": { value: null },
				"texSize": { value: new THREE.Vector2( 0.5, 0.5 ) },
				"visibleEdgeColor": { value: new THREE.Vector3( 1.0, 1.0, 1.0 ) },
				"hiddenEdgeColor":  { value: new THREE.Vector3( 1.0, 1.0, 1.0 ) },
			},

			vertexShader:
				"varying vec2 vUv;\n\
				void main() {\n\
					vUv = uv;\n\
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\
				}",

			fragmentShader:
				"varying vec2 vUv;\
				uniform sampler2D maskTexture;\
				uniform vec2 texSize;\
				uniform vec3 visibleEdgeColor;\
				uniform vec3 hiddenEdgeColor;\
				\
				void main() {\n\
					vec2 invSize = 1.0 / texSize;\
					vec4 uvOffset = vec4(1.0, 0.0, 0.0, 1.0) * vec4(invSize, invSize);\
					vec4 c1 = texture2D( maskTexture, vUv + uvOffset.xy);\
					vec4 c2 = texture2D( maskTexture, vUv - uvOffset.xy);\
					vec4 c3 = texture2D( maskTexture, vUv + uvOffset.yw);\
					vec4 c4 = texture2D( maskTexture, vUv - uvOffset.yw);\
					float diff1 = (c1.r - c2.r)*0.5;\
					float diff2 = (c3.r - c4.r)*0.5;\
					float d = length( vec2(diff1, diff2) );\
					float a1 = min(c1.g, c2.g);\
					float a2 = min(c3.g, c4.g);\
					float visibilityFactor = min(a1, a2);\
					vec3 edgeColor = 1.0 - visibilityFactor > 0.001 ? visibleEdgeColor : hiddenEdgeColor;\
					gl_FragColor = vec4(edgeColor, 1.0) * vec4(d);\
				}"
		} );
	},

	getSeperableBlurMaterial: function(maxRadius) {

		return new THREE.ShaderMaterial( {

			defines: {
				"MAX_RADIUS" : maxRadius,
			},

			uniforms: {
				"colorTexture": { value: null },
				"texSize": 	{ value: new THREE.Vector2( 0.5, 0.5 ) },
				"direction": { value: new THREE.Vector2( 0.5, 0.5 ) },
				"kernelRadius": { value: 1.0 }
			},

			vertexShader:
				"varying vec2 vUv;\n\
				void main() {\n\
					vUv = uv;\n\
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\
				}",

			fragmentShader:
				"#include <common>\
				varying vec2 vUv;\
				uniform sampler2D colorTexture;\
				uniform vec2 texSize;\
				uniform vec2 direction;\
				uniform float kernelRadius;\
				\
				float gaussianPdf(in float x, in float sigma) {\
					return 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\
				}\
				void main() {\
					vec2 invSize = 1.0 / texSize;\
					float weightSum = gaussianPdf(0.0, kernelRadius);\
					vec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;\
					vec2 delta = direction * invSize * kernelRadius/float(MAX_RADIUS);\
					vec2 uvOffset = delta;\
					for( int i = 1; i <= MAX_RADIUS; i ++ ) {\
						float w = gaussianPdf(uvOffset.x, kernelRadius);\
						vec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;\
						vec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;\
						diffuseSum += ((sample1 + sample2) * w);\
						weightSum += (2.0 * w);\
						uvOffset += delta;\
					}\
					gl_FragColor = vec4(diffuseSum/weightSum, 1.0);\
				}"
		} );
	},

	getOverlayMaterial: function() {

		return new THREE.ShaderMaterial( {

			uniforms: {
				"maskTexture": { value: null },
				"edgeTexture1": { value: null },
				"edgeTexture2": { value: null },
				"patternTexture": { value: null },
				"edgeStrength" : { value: 1.0 },
				"edgeGlow" : { value: 1.0 },
				"usePatternTexture" : { value: 0.0 }
			},

			vertexShader:
				"varying vec2 vUv;\n\
				void main() {\n\
					vUv = uv;\n\
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\
				}",

			fragmentShader:
				"varying vec2 vUv;\
				uniform sampler2D maskTexture;\
				uniform sampler2D edgeTexture1;\
				uniform sampler2D edgeTexture2;\
				uniform sampler2D patternTexture;\
				uniform float edgeStrength;\
				uniform float edgeGlow;\
				uniform bool usePatternTexture;\
				\
				void main() {\
					vec4 edgeValue1 = texture2D(edgeTexture1, vUv);\
					vec4 edgeValue2 = texture2D(edgeTexture2, vUv);\
					vec4 maskColor = texture2D(maskTexture, vUv);\
					vec4 patternColor = texture2D(patternTexture, 6.0 * vUv);\
					float visibilityFactor = 1.0 - maskColor.g > 0.0 ? 1.0 : 0.5;\
					vec4 edgeValue = edgeValue1 + edgeValue2 * edgeGlow;\
					vec4 finalColor = edgeStrength * maskColor.r * edgeValue;\
					if(usePatternTexture)\
						finalColor += + visibilityFactor * (1.0 - maskColor.r) * (1.0 - patternColor.r);\
					gl_FragColor = finalColor;\
				}",

				blending: THREE.AdditiveBlending,
				depthTest: false,
				depthWrite: false,
				transparent: true
		} );
	}

} );

THREE.OutlinePass.BlurDirectionX = new THREE.Vector2( 1.0, 0.0 );
THREE.OutlinePass.BlurDirectionY = new THREE.Vector2( 0.0, 1.0 );

/**
 * @author alteredq / http://alteredqualia.com/
 */

THREE.RenderPass = function ( scene, camera, overrideMaterial, clearColor, clearAlpha ) {

	THREE.Pass.call( this );

	this.scene = scene;
	this.camera = camera;

	this.overrideMaterial = overrideMaterial;

	this.clearColor = clearColor;
	this.clearAlpha = ( clearAlpha !== undefined ) ? clearAlpha : 0;

	this.clear = true;
	this.needsSwap = false;

};

THREE.RenderPass.prototype = Object.assign( Object.create( THREE.Pass.prototype ), {

	constructor: THREE.RenderPass,

	render: function ( renderer, writeBuffer, readBuffer, delta, maskActive ) {

		var oldAutoClear = renderer.autoClear;
		renderer.autoClear = false;

		this.scene.overrideMaterial = this.overrideMaterial;

		var oldClearColor, oldClearAlpha;

		if ( this.clearColor ) {

			oldClearColor = renderer.getClearColor().getHex();
			oldClearAlpha = renderer.getClearAlpha();

			renderer.setClearColor( this.clearColor, this.clearAlpha );

		}

		renderer.render( this.scene, this.camera, this.renderToScreen ? null : readBuffer, this.clear );

		if ( this.clearColor ) {

			renderer.setClearColor( oldClearColor, oldClearAlpha );

		}

		this.scene.overrideMaterial = null;
		renderer.autoClear = oldAutoClear;
	}

} );

/**
 * @author mpk / http://polko.me/
 */

THREE.SMAAPass = function ( width, height ) {

	THREE.Pass.call( this );

	// render targets

	this.edgesRT = new THREE.WebGLRenderTarget( width, height, {
		depthBuffer: false,
		stencilBuffer: false,
		generateMipmaps: false,
		minFilter: THREE.LinearFilter,
		format: THREE.RGBFormat
	} );

	this.weightsRT = new THREE.WebGLRenderTarget( width, height, {
		depthBuffer: false,
		stencilBuffer: false,
		generateMipmaps: false,
		minFilter: THREE.LinearFilter,
		format: THREE.RGBAFormat
	} );

	// textures

	var areaTextureImage = new Image();
	areaTextureImage.src = this.getAreaTexture();

	this.areaTexture = new THREE.Texture();
	this.areaTexture.image = areaTextureImage;
	this.areaTexture.format = THREE.RGBFormat;
	this.areaTexture.minFilter = THREE.LinearFilter;
	this.areaTexture.generateMipmaps = false;
	this.areaTexture.needsUpdate = true;
	this.areaTexture.flipY = false;

	var searchTextureImage = new Image();
	searchTextureImage.src = this.getSearchTexture();

	this.searchTexture = new THREE.Texture();
	this.searchTexture.image = searchTextureImage;
	this.searchTexture.magFilter = THREE.NearestFilter;
	this.searchTexture.minFilter = THREE.NearestFilter;
	this.searchTexture.generateMipmaps = false;
	this.searchTexture.needsUpdate = true;
	this.searchTexture.flipY = false;

	// materials - pass 1

	if ( THREE.SMAAShader === undefined ) {
		console.error( "THREE.SMAAPass relies on THREE.SMAAShader" );
	}

	this.uniformsEdges = THREE.UniformsUtils.clone( THREE.SMAAShader[0].uniforms );

	this.uniformsEdges[ "resolution" ].value.set( 1 / width, 1 / height );

	this.materialEdges = new THREE.ShaderMaterial( {
		defines: THREE.SMAAShader[0].defines,
		uniforms: this.uniformsEdges,
		vertexShader: THREE.SMAAShader[0].vertexShader,
		fragmentShader: THREE.SMAAShader[0].fragmentShader
	} );

	// materials - pass 2

	this.uniformsWeights = THREE.UniformsUtils.clone( THREE.SMAAShader[1].uniforms );

	this.uniformsWeights[ "resolution" ].value.set( 1 / width, 1 / height );
	this.uniformsWeights[ "tDiffuse" ].value = this.edgesRT.texture;
	this.uniformsWeights[ "tArea" ].value = this.areaTexture;
	this.uniformsWeights[ "tSearch" ].value = this.searchTexture;

	this.materialWeights = new THREE.ShaderMaterial( {
		defines: THREE.SMAAShader[1].defines,
		uniforms: this.uniformsWeights,
		vertexShader: THREE.SMAAShader[1].vertexShader,
		fragmentShader: THREE.SMAAShader[1].fragmentShader
	} );

	// materials - pass 3

	this.uniformsBlend = THREE.UniformsUtils.clone( THREE.SMAAShader[2].uniforms );

	this.uniformsBlend[ "resolution" ].value.set( 1 / width, 1 / height );
	this.uniformsBlend[ "tDiffuse" ].value = this.weightsRT.texture;

	this.materialBlend = new THREE.ShaderMaterial( {
		uniforms: this.uniformsBlend,
		vertexShader: THREE.SMAAShader[2].vertexShader,
		fragmentShader: THREE.SMAAShader[2].fragmentShader
	} );

	this.needsSwap = false;

	this.camera = new THREE.OrthographicCamera( -1, 1, 1, -1, 0, 1 );
	this.scene  = new THREE.Scene();

	this.quad = new THREE.Mesh( new THREE.PlaneBufferGeometry( 2, 2 ), null );
	this.scene.add( this.quad );

};

THREE.SMAAPass.prototype = Object.assign( Object.create( THREE.Pass.prototype ), {

	constructor: THREE.SMAAPass,

	render: function ( renderer, writeBuffer, readBuffer, delta, maskActive ) {

		// pass 1

		this.uniformsEdges[ "tDiffuse" ].value = readBuffer.texture;

		this.quad.material = this.materialEdges;

		renderer.render( this.scene, this.camera, this.edgesRT, this.clear );

		// pass 2

		this.quad.material = this.materialWeights;

		renderer.render( this.scene, this.camera, this.weightsRT, this.clear );

		// pass 3

		this.uniformsBlend[ "tColor" ].value = readBuffer.texture;

		this.quad.material = this.materialBlend;

		if ( this.renderToScreen ) {

			renderer.render( this.scene, this.camera );

		} else {

			renderer.render( this.scene, this.camera, writeBuffer, this.clear );

		}

	},

	setSize: function ( width, height ) {

		this.edgesRT.setSize( width, height );
		this.weightsRT.setSize( width, height );

		this.materialEdges.uniforms[ 'resolution' ].value.set( 1 / width, 1 / height );
		this.materialWeights.uniforms[ 'resolution' ].value.set( 1 / width, 1 / height );
		this.materialBlend.uniforms[ 'resolution' ].value.set( 1 / width, 1 / height );

	},

	getAreaTexture: function () {
		return 'data:image/png;base64,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';
	},

	getSearchTexture: function () {
		return 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAAAhCAAAAABIXyLAAAAAOElEQVRIx2NgGAWjYBSMglEwEICREYRgFBZBqDCSLA2MGPUIVQETE9iNUAqLR5gIeoQKRgwXjwAAGn4AtaFeYLEAAAAASUVORK5CYII=';
	}

} );

/**
 * @author alteredq / http://alteredqualia.com/
 */

THREE.SavePass = function ( renderTarget ) {

	THREE.Pass.call( this );

	if ( THREE.CopyShader === undefined )
		console.error( "THREE.SavePass relies on THREE.CopyShader" );

	var shader = THREE.CopyShader;

	this.textureID = "tDiffuse";

	this.uniforms = THREE.UniformsUtils.clone( shader.uniforms );

	this.material = new THREE.ShaderMaterial( {

		uniforms: this.uniforms,
		vertexShader: shader.vertexShader,
		fragmentShader: shader.fragmentShader

	} );

	this.renderTarget = renderTarget;

	if ( this.renderTarget === undefined ) {

		this.renderTargetParameters = { minFilter: THREE.LinearFilter, magFilter: THREE.LinearFilter, format: THREE.RGBFormat, stencilBuffer: false };
		this.renderTarget = new THREE.WebGLRenderTarget( window.innerWidth, window.innerHeight, this.renderTargetParameters );

	}

	this.needsSwap = false;

	this.camera = new THREE.OrthographicCamera( - 1, 1, 1, - 1, 0, 1 );
	this.scene  = new THREE.Scene();

	this.quad = new THREE.Mesh( new THREE.PlaneBufferGeometry( 2, 2 ), null );
	this.scene.add( this.quad );

};

THREE.SavePass.prototype = Object.assign( Object.create( THREE.Pass.prototype ), {

	constructor: THREE.SavePass,

	render: function ( renderer, writeBuffer, readBuffer, delta, maskActive ) {

		if ( this.uniforms[ this.textureID ] ) {

			this.uniforms[ this.textureID ].value = readBuffer.texture;

		}

		this.quad.material = this.material;

		renderer.render( this.scene, this.camera, this.renderTarget, this.clear );

	}

} );

/**
 * @author alteredq / http://alteredqualia.com/
 */

THREE.ShaderPass = function ( shader, textureID ) {

	THREE.Pass.call( this );

	this.textureID = ( textureID !== undefined ) ? textureID : "tDiffuse";

	if ( shader instanceof THREE.ShaderMaterial ) {

		this.uniforms = shader.uniforms;

		this.material = shader;

	} else if ( shader ) {

		this.uniforms = THREE.UniformsUtils.clone( shader.uniforms );

		this.material = new THREE.ShaderMaterial( {

			defines: shader.defines || {},
			uniforms: this.uniforms,
			vertexShader: shader.vertexShader,
			fragmentShader: shader.fragmentShader

		} );

	}

	this.camera = new THREE.OrthographicCamera( - 1, 1, 1, - 1, 0, 1 );
	this.scene = new THREE.Scene();

	this.quad = new THREE.Mesh( new THREE.PlaneBufferGeometry( 2, 2 ), null );
	this.scene.add( this.quad );

};

THREE.ShaderPass.prototype = Object.assign( Object.create( THREE.Pass.prototype ), {

	constructor: THREE.ShaderPass,

	render: function( renderer, writeBuffer, readBuffer, delta, maskActive ) {

		if ( this.uniforms[ this.textureID ] ) {

			this.uniforms[ this.textureID ].value = readBuffer.texture;

		}

		this.quad.material = this.material;

		if ( this.renderToScreen ) {

			renderer.render( this.scene, this.camera );

		} else {

			renderer.render( this.scene, this.camera, writeBuffer, this.clear );

		}

	}

} );

/**
 *
 * Temporal Anti-Aliasing Render Pass
 *
 * @author bhouston / http://clara.io/
 *
 * When there is no motion in the scene, the TAA render pass accumulates jittered camera samples across frames to create a high quality anti-aliased result.
 *
 * References:
 *
 * TODO: Add support for motion vector pas so that accumulation of samples across frames can occur on dynamics scenes.
 *
 */

THREE.TAARenderPass = function ( scene, camera, params ) {

	if ( THREE.ManualMSAARenderPass === undefined ) {

		console.error( "THREE.TAARenderPass relies on THREE.ManualMSAARenderPass" );

	}
	THREE.ManualMSAARenderPass.call( this, scene, camera, params );

	this.sampleLevel = 0;
	this.accumulate = false;

};

THREE.TAARenderPass.JitterVectors = THREE.ManualMSAARenderPass.JitterVectors;

THREE.TAARenderPass.prototype = Object.assign( Object.create( THREE.ManualMSAARenderPass.prototype ), {

	constructor: THREE.TAARenderPass,

	render: function ( renderer, writeBuffer, readBuffer, delta ) {

		if( ! this.accumulate ) {

				THREE.ManualMSAARenderPass.prototype.render.call( this, renderer, writeBuffer, readBuffer, delta );

				this.accumulateIndex = -1;
				return;

		}

		var jitterOffsets = THREE.TAARenderPass.JitterVectors[ 5 ];

		if ( ! this.sampleRenderTarget ) {

			this.sampleRenderTarget = new THREE.WebGLRenderTarget( readBuffer.width, readBuffer.height, this.params );

		}

		if ( ! this.holdRenderTarget ) {

			this.holdRenderTarget = new THREE.WebGLRenderTarget( readBuffer.width, readBuffer.height, this.params );

		}

		if( this.accumulate && this.accumulateIndex === -1 ) {

				THREE.ManualMSAARenderPass.prototype.render.call( this, renderer, this.holdRenderTarget, readBuffer, delta );

				this.accumulateIndex = 0;

		}

		var autoClear = renderer.autoClear;
		renderer.autoClear = false;

		var sampleWeight = 1.0 / ( jitterOffsets.length );

		if( this.accumulateIndex >= 0 && this.accumulateIndex < jitterOffsets.length ) {

			this.copyUniforms[ "opacity" ].value = sampleWeight;
			this.copyUniforms[ "tDiffuse" ].value = writeBuffer.texture;

			// render the scene multiple times, each slightly jitter offset from the last and accumulate the results.
			var numSamplesPerFrame = Math.pow( 2, this.sampleLevel );
			for ( var i = 0; i < numSamplesPerFrame; i ++ ) {

				var j = this.accumulateIndex;
				var jitterOffset = jitterOffsets[j];
				if ( this.camera.setViewOffset ) {
					this.camera.setViewOffset( readBuffer.width, readBuffer.height,
						jitterOffset[ 0 ] * 0.0625, jitterOffset[ 1 ] * 0.0625,   // 0.0625 = 1 / 16
						readBuffer.width, readBuffer.height );
				}

				renderer.render( this.scene, this.camera, writeBuffer, true );
				renderer.render( this.scene2, this.camera2, this.sampleRenderTarget, ( this.accumulateIndex === 0 ) );

				this.accumulateIndex ++;
				if( this.accumulateIndex >= jitterOffsets.length ) break;
			}

			if ( this.camera.clearViewOffset ) this.camera.clearViewOffset();

		}

		var accumulationWeight = this.accumulateIndex * sampleWeight;

		if( accumulationWeight > 0 ) {
			this.copyUniforms[ "opacity" ].value = 1.0;
			this.copyUniforms[ "tDiffuse" ].value = this.sampleRenderTarget.texture;
			renderer.render( this.scene2, this.camera2, writeBuffer, true );
		}
		if( accumulationWeight < 1.0 ) {
			this.copyUniforms[ "opacity" ].value = 1.0 - accumulationWeight;
			this.copyUniforms[ "tDiffuse" ].value = this.holdRenderTarget.texture;
			renderer.render( this.scene2, this.camera2, writeBuffer, ( accumulationWeight === 0 ) );
		}

		renderer.autoClear = autoClear;

	}

});

/**
 * @author alteredq / http://alteredqualia.com/
 */

THREE.TexturePass = function ( map, opacity ) {

	THREE.Pass.call( this );

	if ( THREE.CopyShader === undefined )
		console.error( "THREE.TexturePass relies on THREE.CopyShader" );

	var shader = THREE.CopyShader;

	this.map = map;
	this.opacity = ( opacity !== undefined ) ? opacity : 1.0;

	this.uniforms = THREE.UniformsUtils.clone( shader.uniforms );

	this.material = new THREE.ShaderMaterial( {

		uniforms: this.uniforms,
		vertexShader: shader.vertexShader,
		fragmentShader: shader.fragmentShader,
		depthTest: false,
		depthWrite: false

	} );

	this.needsSwap = false;

	this.camera = new THREE.OrthographicCamera( - 1, 1, 1, - 1, 0, 1 );
	this.scene  = new THREE.Scene();

	this.quad = new THREE.Mesh( new THREE.PlaneBufferGeometry( 2, 2 ), null );
	this.scene.add( this.quad );

};

THREE.TexturePass.prototype = Object.assign( Object.create( THREE.Pass.prototype ), {

	constructor: THREE.TexturePass,

	render: function ( renderer, writeBuffer, readBuffer, delta, maskActive ) {

		var oldAutoClear = renderer.autoClear;
		renderer.autoClear = false;

		this.quad.material = this.material;

		this.uniforms[ "opacity" ].value = this.opacity;
		this.uniforms[ "tDiffuse" ].value = this.map;
		this.material.transparent = ( this.opacity < 1.0 );

		renderer.render( this.scene, this.camera, this.renderToScreen ? null : readBuffer, this.clear );

		renderer.autoClear = oldAutoClear;
	}

} );

/**
 * @author spidersharma / http://eduperiment.com/
 Inspired from Unreal Engine::
 https://docs.unrealengine.com/latest/INT/Engine/Rendering/PostProcessEffects/Bloom/
 */

THREE.UnrealBloomPass = function ( resolution, strength, radius, threshold ) {

	THREE.Pass.call( this );

	this.strength = ( strength !== undefined ) ? strength : 1;
	this.radius = radius;
	this.threshold = threshold;
	this.resolution = ( resolution !== undefined ) ? new THREE.Vector2(resolution.x, resolution.y) : new THREE.Vector2(256, 256);

	// render targets
	var pars = { minFilter: THREE.LinearFilter, magFilter: THREE.LinearFilter, format: THREE.RGBAFormat };
	this.renderTargetsHorizontal = [];
	this.renderTargetsVertical = [];
	this.nMips = 5;
	var resx = Math.round(this.resolution.x/2);
	var resy = Math.round(this.resolution.y/2);

	this.renderTargetBright = new THREE.WebGLRenderTarget( resx, resy, pars );
	this.renderTargetBright.texture.generateMipmaps = false;

	for( var i=0; i<this.nMips; i++) {

		var renderTarget = new THREE.WebGLRenderTarget( resx, resy, pars );

		renderTarget.texture.generateMipmaps = false;

		this.renderTargetsHorizontal.push(renderTarget);

		var renderTarget = new THREE.WebGLRenderTarget( resx, resy, pars );

		renderTarget.texture.generateMipmaps = false;

		this.renderTargetsVertical.push(renderTarget);

		resx = Math.round(resx/2);

		resy = Math.round(resy/2);
	}

	// luminosity high pass material

	if ( THREE.LuminosityHighPassShader === undefined )
		console.error( "THREE.UnrealBloomPass relies on THREE.LuminosityHighPassShader" );

	var highPassShader = THREE.LuminosityHighPassShader;
	this.highPassUniforms = THREE.UniformsUtils.clone( highPassShader.uniforms );

	this.highPassUniforms[ "luminosityThreshold" ].value = threshold;
	this.highPassUniforms[ "smoothWidth" ].value = 0.01;

	this.materialHighPassFilter = new THREE.ShaderMaterial( {
		uniforms: this.highPassUniforms,
		vertexShader:  highPassShader.vertexShader,
		fragmentShader: highPassShader.fragmentShader,
		defines: {}
	} );

	// Gaussian Blur Materials
	this.separableBlurMaterials = [];
	var kernelSizeArray = [3, 5, 7, 9, 11];
	var resx = Math.round(this.resolution.x/2);
	var resy = Math.round(this.resolution.y/2);

	for( var i=0; i<this.nMips; i++) {

		this.separableBlurMaterials.push(this.getSeperableBlurMaterial(kernelSizeArray[i]));

		this.separableBlurMaterials[i].uniforms[ "texSize" ].value = new THREE.Vector2(resx, resy);

		resx = Math.round(resx/2);

		resy = Math.round(resy/2);
	}

	// Composite material
	this.compositeMaterial = this.getCompositeMaterial(this.nMips);
	this.compositeMaterial.uniforms["blurTexture1"].value = this.renderTargetsVertical[0].texture;
	this.compositeMaterial.uniforms["blurTexture2"].value = this.renderTargetsVertical[1].texture;
	this.compositeMaterial.uniforms["blurTexture3"].value = this.renderTargetsVertical[2].texture;
	this.compositeMaterial.uniforms["blurTexture4"].value = this.renderTargetsVertical[3].texture;
	this.compositeMaterial.uniforms["blurTexture5"].value = this.renderTargetsVertical[4].texture;
	this.compositeMaterial.uniforms["bloomStrength"].value = strength;
	this.compositeMaterial.uniforms["bloomRadius"].value = 0.1;
	this.compositeMaterial.needsUpdate = true;

	var bloomFactors = [1.0, 0.8, 0.6, 0.4, 0.2];
	this.compositeMaterial.uniforms["bloomFactors"].value = bloomFactors;
	this.bloomTintColors = [new THREE.Vector3(1,1,1), new THREE.Vector3(1,1,1), new THREE.Vector3(1,1,1)
												,new THREE.Vector3(1,1,1), new THREE.Vector3(1,1,1)];
	this.compositeMaterial.uniforms["bloomTintColors"].value = this.bloomTintColors;

	// copy material
	if ( THREE.CopyShader === undefined )
		console.error( "THREE.BloomPass relies on THREE.CopyShader" );

	var copyShader = THREE.CopyShader;

	this.copyUniforms = THREE.UniformsUtils.clone( copyShader.uniforms );
	this.copyUniforms[ "opacity" ].value = 1.0;

	this.materialCopy = new THREE.ShaderMaterial( {
		uniforms: this.copyUniforms,
		vertexShader: copyShader.vertexShader,
		fragmentShader: copyShader.fragmentShader,
		blending: THREE.AdditiveBlending,
		depthTest: false,
		depthWrite: false,
		transparent: true
	} );

	this.enabled = true;
	this.needsSwap = false;

	this.oldClearColor = new THREE.Color();
	this.oldClearAlpha = 1;

	this.camera = new THREE.OrthographicCamera( - 1, 1, 1, - 1, 0, 1 );
	this.scene  = new THREE.Scene();

	this.quad = new THREE.Mesh( new THREE.PlaneBufferGeometry( 2, 2 ), null );
	this.scene.add( this.quad );

};

THREE.UnrealBloomPass.prototype = Object.assign( Object.create( THREE.Pass.prototype ), {

	constructor: THREE.UnrealBloomPass,

	dispose: function() {
		for( var i=0; i< this.renderTargetsHorizontal.length(); i++) {
			this.renderTargetsHorizontal[i].dispose();
		}
		for( var i=0; i< this.renderTargetsVertical.length(); i++) {
			this.renderTargetsVertical[i].dispose();
		}
		this.renderTargetBright.dispose();
	},

	setSize: function ( width, height ) {

		var resx = Math.round(width/2);
		var resy = Math.round(height/2);

		this.renderTargetBright.setSize(resx, resy);

		for( var i=0; i<this.nMips; i++) {

			this.renderTargetsHorizontal[i].setSize(resx, resy);
			this.renderTargetsVertical[i].setSize(resx, resy);

			this.separableBlurMaterials[i].uniforms[ "texSize" ].value = new THREE.Vector2(resx, resy);

			resx = Math.round(resx/2);
			resy = Math.round(resy/2);
		}
	},

	render: function ( renderer, writeBuffer, readBuffer, delta, maskActive ) {

		this.oldClearColor.copy( renderer.getClearColor() );
		this.oldClearAlpha = renderer.getClearAlpha();
		var oldAutoClear = renderer.autoClear;
		renderer.autoClear = false;

		renderer.setClearColor( new THREE.Color( 0, 0, 0 ), 0 );

		if ( maskActive ) renderer.context.disable( renderer.context.STENCIL_TEST );

		// 1. Extract Bright Areas
		this.highPassUniforms[ "tDiffuse" ].value = readBuffer.texture;
		this.highPassUniforms[ "luminosityThreshold" ].value = this.threshold;
		this.quad.material = this.materialHighPassFilter;
		renderer.render( this.scene, this.camera, this.renderTargetBright, true );

		// 2. Blur All the mips progressively
		var inputRenderTarget = this.renderTargetBright;

		for(var i=0; i<this.nMips; i++) {

			this.quad.material = this.separableBlurMaterials[i];

			this.separableBlurMaterials[i].uniforms[ "colorTexture" ].value = inputRenderTarget.texture;

			this.separableBlurMaterials[i].uniforms[ "direction" ].value = THREE.UnrealBloomPass.BlurDirectionX;

			renderer.render( this.scene, this.camera, this.renderTargetsHorizontal[i], true );

			this.separableBlurMaterials[i].uniforms[ "colorTexture" ].value = this.renderTargetsHorizontal[i].texture;

			this.separableBlurMaterials[i].uniforms[ "direction" ].value = THREE.UnrealBloomPass.BlurDirectionY;

			renderer.render( this.scene, this.camera, this.renderTargetsVertical[i], true );

			inputRenderTarget = this.renderTargetsVertical[i];
		}

		// Composite All the mips
		this.quad.material = this.compositeMaterial;
		this.compositeMaterial.uniforms["bloomStrength"].value = this.strength;
		this.compositeMaterial.uniforms["bloomRadius"].value = this.radius;
		this.compositeMaterial.uniforms["bloomTintColors"].value = this.bloomTintColors;
		renderer.render( this.scene, this.camera, this.renderTargetsHorizontal[0], true );

		// Blend it additively over the input texture
		this.quad.material = this.materialCopy;
		this.copyUniforms[ "tDiffuse" ].value = this.renderTargetsHorizontal[0].texture;

		if ( maskActive ) renderer.context.enable( renderer.context.STENCIL_TEST );

		renderer.render( this.scene, this.camera, readBuffer, false );

		renderer.setClearColor( this.oldClearColor, this.oldClearAlpha );
		renderer.autoClear = oldAutoClear;
	},

	getSeperableBlurMaterial: function(kernelRadius) {

		return new THREE.ShaderMaterial( {

			defines: {
				"KERNEL_RADIUS" : kernelRadius,
				"SIGMA" : kernelRadius
			},

			uniforms: {
				"colorTexture": { value: null },
				"texSize": 				{ value: new THREE.Vector2( 0.5, 0.5 ) },
				"direction": 				{ value: new THREE.Vector2( 0.5, 0.5 ) },
			},

			vertexShader:
				"varying vec2 vUv;\n\
				void main() {\n\
					vUv = uv;\n\
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\
				}",

			fragmentShader:
				"#include <common>\
				varying vec2 vUv;\n\
				uniform sampler2D colorTexture;\n\
				uniform vec2 texSize;\
				uniform vec2 direction;\
				\
				float gaussianPdf(in float x, in float sigma) {\
					return 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\
				}\
				void main() {\n\
					vec2 invSize = 1.0 / texSize;\
					float fSigma = float(SIGMA);\
					float weightSum = gaussianPdf(0.0, fSigma);\
					vec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;\
					for( int i = 1; i < KERNEL_RADIUS; i ++ ) {\
						float x = float(i);\
						float w = gaussianPdf(x, fSigma);\
						vec2 uvOffset = direction * invSize * x;\
						vec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;\
						vec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;\
						diffuseSum += (sample1 + sample2) * w;\
						weightSum += 2.0 * w;\
					}\
					gl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n\
				}"
		} );
	},

	getCompositeMaterial: function(nMips) {

		return new THREE.ShaderMaterial( {

			defines:{
				"NUM_MIPS" : nMips
			},

			uniforms: {
				"blurTexture1": { value: null },
				"blurTexture2": { value: null },
				"blurTexture3": { value: null },
				"blurTexture4": { value: null },
				"blurTexture5": { value: null },
				"dirtTexture": { value: null },
				"bloomStrength" : { value: 1.0 },
				"bloomFactors" : { value: null },
				"bloomTintColors" : { value: null },
				"bloomRadius" : { value: 0.0 }
			},

			vertexShader:
				"varying vec2 vUv;\n\
				void main() {\n\
					vUv = uv;\n\
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\
				}",

			fragmentShader:
				"varying vec2 vUv;\
				uniform sampler2D blurTexture1;\
				uniform sampler2D blurTexture2;\
				uniform sampler2D blurTexture3;\
				uniform sampler2D blurTexture4;\
				uniform sampler2D blurTexture5;\
				uniform sampler2D dirtTexture;\
				uniform float bloomStrength;\
				uniform float bloomRadius;\
				uniform float bloomFactors[NUM_MIPS];\
				uniform vec3 bloomTintColors[NUM_MIPS];\
				\
				float lerpBloomFactor(const in float factor) { \
					float mirrorFactor = 1.2 - factor;\
					return mix(factor, mirrorFactor, bloomRadius);\
				}\
				\
				void main() {\
					gl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) + \
					 							 lerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) + \
												 lerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) + \
												 lerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) + \
												 lerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );\
				}"
		} );
	}

} );

THREE.UnrealBloomPass.BlurDirectionX = new THREE.Vector2( 1.0, 0.0 );
THREE.UnrealBloomPass.BlurDirectionY = new THREE.Vector2( 0.0, 1.0 );

/**
 * @author mrdoob / http://www.mrdoob.com
 *
 * Simple test shader
 */

THREE.BasicShader = {

	uniforms: {},

	vertexShader: [

		"void main() {",

			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join( "\n" ),

	fragmentShader: [

		"void main() {",

			"gl_FragColor = vec4( 1.0, 0.0, 0.0, 0.5 );",

		"}"

	].join( "\n" )

};

/**
 * @author alteredq / http://alteredqualia.com/
 *
 * Bleach bypass shader [http://en.wikipedia.org/wiki/Bleach_bypass]
 * - based on Nvidia example
 * http://developer.download.nvidia.com/shaderlibrary/webpages/shader_library.html#post_bleach_bypass
 */

THREE.BleachBypassShader = {

	uniforms: {

		"tDiffuse": { value: null },
		"opacity":  { value: 1.0 }

	},

	vertexShader: [

		"varying vec2 vUv;",

		"void main() {",

			"vUv = uv;",
			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join( "\n" ),

	fragmentShader: [

		"uniform float opacity;",

		"uniform sampler2D tDiffuse;",

		"varying vec2 vUv;",

		"void main() {",

			"vec4 base = texture2D( tDiffuse, vUv );",

			"vec3 lumCoeff = vec3( 0.25, 0.65, 0.1 );",
			"float lum = dot( lumCoeff, base.rgb );",
			"vec3 blend = vec3( lum );",

			"float L = min( 1.0, max( 0.0, 10.0 * ( lum - 0.45 ) ) );",

			"vec3 result1 = 2.0 * base.rgb * blend;",
			"vec3 result2 = 1.0 - 2.0 * ( 1.0 - blend ) * ( 1.0 - base.rgb );",

			"vec3 newColor = mix( result1, result2, L );",

			"float A2 = opacity * base.a;",
			"vec3 mixRGB = A2 * newColor.rgb;",
			"mixRGB += ( ( 1.0 - A2 ) * base.rgb );",

			"gl_FragColor = vec4( mixRGB, base.a );",

		"}"

	].join( "\n" )

};

/**
 * @author alteredq / http://alteredqualia.com/
 *
 * Blend two textures
 */

THREE.BlendShader = {

	uniforms: {

		"tDiffuse1": { value: null },
		"tDiffuse2": { value: null },
		"mixRatio":  { value: 0.5 },
		"opacity":   { value: 1.0 }

	},

	vertexShader: [

		"varying vec2 vUv;",

		"void main() {",

			"vUv = uv;",
			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join( "\n" ),

	fragmentShader: [

		"uniform float opacity;",
		"uniform float mixRatio;",

		"uniform sampler2D tDiffuse1;",
		"uniform sampler2D tDiffuse2;",

		"varying vec2 vUv;",

		"void main() {",

			"vec4 texel1 = texture2D( tDiffuse1, vUv );",
			"vec4 texel2 = texture2D( tDiffuse2, vUv );",
			"gl_FragColor = opacity * mix( texel1, texel2, mixRatio );",

		"}"

	].join( "\n" )

};

/**
 * @author alteredq / http://alteredqualia.com/
 *
 * Depth-of-field shader with bokeh
 * ported from GLSL shader by Martins Upitis
 * http://artmartinsh.blogspot.com/2010/02/glsl-lens-blur-filter-with-bokeh.html
 */

THREE.BokehShader = {

	uniforms: {

		"tColor":   { value: null },
		"tDepth":   { value: null },
		"focus":    { value: 1.0 },
		"aspect":   { value: 1.0 },
		"aperture": { value: 0.025 },
		"maxblur":  { value: 1.0 }

	},

	vertexShader: [

		"varying vec2 vUv;",

		"void main() {",

			"vUv = uv;",
			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join( "\n" ),

	fragmentShader: [

		"varying vec2 vUv;",

		"uniform sampler2D tColor;",
		"uniform sampler2D tDepth;",

		"uniform float maxblur;",  // max blur amount
		"uniform float aperture;", // aperture - bigger values for shallower depth of field

		"uniform float focus;",
		"uniform float aspect;",

		"void main() {",

			"vec2 aspectcorrect = vec2( 1.0, aspect );",

			"vec4 depth1 = texture2D( tDepth, vUv );",

			"float factor = depth1.x - focus;",

			"vec2 dofblur = vec2 ( clamp( factor * aperture, -maxblur, maxblur ) );",

			"vec2 dofblur9 = dofblur * 0.9;",
			"vec2 dofblur7 = dofblur * 0.7;",
			"vec2 dofblur4 = dofblur * 0.4;",

			"vec4 col = vec4( 0.0 );",

			"col += texture2D( tColor, vUv.xy );",
			"col += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur );",
			"col += texture2D( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur );",
			"col += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur );",
			"col += texture2D( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur );",
			"col += texture2D( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur );",
			"col += texture2D( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur );",
			"col += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur );",
			"col += texture2D( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur );",
			"col += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur );",
			"col += texture2D( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur );",
			"col += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur );",
			"col += texture2D( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur );",
			"col += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur );",
			"col += texture2D( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur );",
			"col += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur );",
			"col += texture2D( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur );",

			"col += texture2D( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur9 );",
			"col += texture2D( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur9 );",
			"col += texture2D( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur9 );",
			"col += texture2D( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur9 );",
			"col += texture2D( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur9 );",
			"col += texture2D( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur9 );",
			"col += texture2D( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur9 );",
			"col += texture2D( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur9 );",

			"col += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur7 );",
			"col += texture2D( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur7 );",
			"col += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur7 );",
			"col += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur7 );",
			"col += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur7 );",
			"col += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur7 );",
			"col += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur7 );",
			"col += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur7 );",

			"col += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur4 );",
			"col += texture2D( tColor, vUv.xy + ( vec2(  0.4,   0.0  ) * aspectcorrect ) * dofblur4 );",
			"col += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur4 );",
			"col += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur4 );",
			"col += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur4 );",
			"col += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur4 );",
			"col += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur4 );",
			"col += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur4 );",

			"gl_FragColor = col / 41.0;",
			"gl_FragColor.a = 1.0;",

		"}"

	].join( "\n" )

};

/**
 * @author zz85 / https://github.com/zz85 | twitter.com/blurspline
 *
 * Depth-of-field shader with bokeh
 * ported from GLSL shader by Martins Upitis
 * http://blenderartists.org/forum/showthread.php?237488-GLSL-depth-of-field-with-bokeh-v2-4-(update)
 *
 * Requires #define RINGS and SAMPLES integers
 */



THREE.BokehShader = {

	uniforms: {

		"textureWidth":  { value: 1.0 },
		"textureHeight":  { value: 1.0 },

		"focalDepth":   { value: 1.0 },
		"focalLength":   { value: 24.0 },
		"fstop": { value: 0.9 },

		"tColor":   { value: null },
		"tDepth":   { value: null },

		"maxblur":  { value: 1.0 },

		"showFocus":   { value: 0 },
		"manualdof":   { value: 0 },
		"vignetting":   { value: 0 },
		"depthblur":   { value: 0 },

		"threshold":  { value: 0.5 },
		"gain":  { value: 2.0 },
		"bias":  { value: 0.5 },
		"fringe":  { value: 0.7 },

		"znear":  { value: 0.1 },
		"zfar":  { value: 100 },

		"noise":  { value: 1 },
		"dithering":  { value: 0.0001 },
		"pentagon": { value: 0 },

		"shaderFocus":  { value: 1 },
		"focusCoords":  { value: new THREE.Vector2() },


	},

	vertexShader: [

		"varying vec2 vUv;",

		"void main() {",

			"vUv = uv;",
			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join( "\n" ),

	fragmentShader: [

		"#include <common>",

		"varying vec2 vUv;",

		"uniform sampler2D tColor;",
		"uniform sampler2D tDepth;",
		"uniform float textureWidth;",
		"uniform float textureHeight;",

		"uniform float focalDepth;  //focal distance value in meters, but you may use autofocus option below",
		"uniform float focalLength; //focal length in mm",
		"uniform float fstop; //f-stop value",
		"uniform bool showFocus; //show debug focus point and focal range (red = focal point, green = focal range)",

		"/*",
		"make sure that these two values are the same for your camera, otherwise distances will be wrong.",
		"*/",

		"uniform float znear; // camera clipping start",
		"uniform float zfar; // camera clipping end",

		"//------------------------------------------",
		"//user variables",

		"const int samples = SAMPLES; //samples on the first ring",
		"const int rings = RINGS; //ring count",

		"const int maxringsamples = rings * samples;",

		"uniform bool manualdof; // manual dof calculation",
		"float ndofstart = 1.0; // near dof blur start",
		"float ndofdist = 2.0; // near dof blur falloff distance",
		"float fdofstart = 1.0; // far dof blur start",
		"float fdofdist = 3.0; // far dof blur falloff distance",

		"float CoC = 0.03; //circle of confusion size in mm (35mm film = 0.03mm)",

		"uniform bool vignetting; // use optical lens vignetting",

		"float vignout = 1.3; // vignetting outer border",
		"float vignin = 0.0; // vignetting inner border",
		"float vignfade = 22.0; // f-stops till vignete fades",

		"uniform bool shaderFocus;",
		"// disable if you use external focalDepth value",

		"uniform vec2 focusCoords;",
		"// autofocus point on screen (0.0,0.0 - left lower corner, 1.0,1.0 - upper right)",
		"// if center of screen use vec2(0.5, 0.5);",

		"uniform float maxblur;",
		"//clamp value of max blur (0.0 = no blur, 1.0 default)",

		"uniform float threshold; // highlight threshold;",
		"uniform float gain; // highlight gain;",

		"uniform float bias; // bokeh edge bias",
		"uniform float fringe; // bokeh chromatic aberration / fringing",

		"uniform bool noise; //use noise instead of pattern for sample dithering",

		"uniform float dithering;",

		"uniform bool depthblur; // blur the depth buffer",
		"float dbsize = 1.25; // depth blur size",

		"/*",
		"next part is experimental",
		"not looking good with small sample and ring count",
		"looks okay starting from samples = 4, rings = 4",
		"*/",

		"uniform bool pentagon; //use pentagon as bokeh shape?",
		"float feather = 0.4; //pentagon shape feather",

		"//------------------------------------------",

		"float penta(vec2 coords) {",
			"//pentagonal shape",
			"float scale = float(rings) - 1.3;",
			"vec4  HS0 = vec4( 1.0,         0.0,         0.0,  1.0);",
			"vec4  HS1 = vec4( 0.309016994, 0.951056516, 0.0,  1.0);",
			"vec4  HS2 = vec4(-0.809016994, 0.587785252, 0.0,  1.0);",
			"vec4  HS3 = vec4(-0.809016994,-0.587785252, 0.0,  1.0);",
			"vec4  HS4 = vec4( 0.309016994,-0.951056516, 0.0,  1.0);",
			"vec4  HS5 = vec4( 0.0        ,0.0         , 1.0,  1.0);",

			"vec4  one = vec4( 1.0 );",

			"vec4 P = vec4((coords),vec2(scale, scale));",

			"vec4 dist = vec4(0.0);",
			"float inorout = -4.0;",

			"dist.x = dot( P, HS0 );",
			"dist.y = dot( P, HS1 );",
			"dist.z = dot( P, HS2 );",
			"dist.w = dot( P, HS3 );",

			"dist = smoothstep( -feather, feather, dist );",

			"inorout += dot( dist, one );",

			"dist.x = dot( P, HS4 );",
			"dist.y = HS5.w - abs( P.z );",

			"dist = smoothstep( -feather, feather, dist );",
			"inorout += dist.x;",

			"return clamp( inorout, 0.0, 1.0 );",
		"}",

		"float bdepth(vec2 coords) {",
			"// Depth buffer blur",
			"float d = 0.0;",
			"float kernel[9];",
			"vec2 offset[9];",

			"vec2 wh = vec2(1.0/textureWidth,1.0/textureHeight) * dbsize;",

			"offset[0] = vec2(-wh.x,-wh.y);",
			"offset[1] = vec2( 0.0, -wh.y);",
			"offset[2] = vec2( wh.x -wh.y);",

			"offset[3] = vec2(-wh.x,  0.0);",
			"offset[4] = vec2( 0.0,   0.0);",
			"offset[5] = vec2( wh.x,  0.0);",

			"offset[6] = vec2(-wh.x, wh.y);",
			"offset[7] = vec2( 0.0,  wh.y);",
			"offset[8] = vec2( wh.x, wh.y);",

			"kernel[0] = 1.0/16.0;   kernel[1] = 2.0/16.0;   kernel[2] = 1.0/16.0;",
			"kernel[3] = 2.0/16.0;   kernel[4] = 4.0/16.0;   kernel[5] = 2.0/16.0;",
			"kernel[6] = 1.0/16.0;   kernel[7] = 2.0/16.0;   kernel[8] = 1.0/16.0;",


			"for( int i=0; i<9; i++ ) {",
				"float tmp = texture2D(tDepth, coords + offset[i]).r;",
				"d += tmp * kernel[i];",
			"}",

			"return d;",
		"}",


		"vec3 color(vec2 coords,float blur) {",
			"//processing the sample",

			"vec3 col = vec3(0.0);",
			"vec2 texel = vec2(1.0/textureWidth,1.0/textureHeight);",

			"col.r = texture2D(tColor,coords + vec2(0.0,1.0)*texel*fringe*blur).r;",
			"col.g = texture2D(tColor,coords + vec2(-0.866,-0.5)*texel*fringe*blur).g;",
			"col.b = texture2D(tColor,coords + vec2(0.866,-0.5)*texel*fringe*blur).b;",

			"vec3 lumcoeff = vec3(0.299,0.587,0.114);",
			"float lum = dot(col.rgb, lumcoeff);",
			"float thresh = max((lum-threshold)*gain, 0.0);",
			"return col+mix(vec3(0.0),col,thresh*blur);",
		"}",

		"vec3 debugFocus(vec3 col, float blur, float depth) {",
			"float edge = 0.002*depth; //distance based edge smoothing",
			"float m = clamp(smoothstep(0.0,edge,blur),0.0,1.0);",
			"float e = clamp(smoothstep(1.0-edge,1.0,blur),0.0,1.0);",

			"col = mix(col,vec3(1.0,0.5,0.0),(1.0-m)*0.6);",
			"col = mix(col,vec3(0.0,0.5,1.0),((1.0-e)-(1.0-m))*0.2);",

			"return col;",
		"}",

		"float linearize(float depth) {",
			"return -zfar * znear / (depth * (zfar - znear) - zfar);",
		"}",


		"float vignette() {",
			"float dist = distance(vUv.xy, vec2(0.5,0.5));",
			"dist = smoothstep(vignout+(fstop/vignfade), vignin+(fstop/vignfade), dist);",
			"return clamp(dist,0.0,1.0);",
		"}",

		"float gather(float i, float j, int ringsamples, inout vec3 col, float w, float h, float blur) {",
			"float rings2 = float(rings);",
			"float step = PI*2.0 / float(ringsamples);",
			"float pw = cos(j*step)*i;",
			"float ph = sin(j*step)*i;",
			"float p = 1.0;",
			"if (pentagon) {",
				"p = penta(vec2(pw,ph));",
			"}",
			"col += color(vUv.xy + vec2(pw*w,ph*h), blur) * mix(1.0, i/rings2, bias) * p;",
			"return 1.0 * mix(1.0, i /rings2, bias) * p;",
		"}",

		"void main() {",
			"//scene depth calculation",

			"float depth = linearize(texture2D(tDepth,vUv.xy).x);",

			"// Blur depth?",
			"if (depthblur) {",
				"depth = linearize(bdepth(vUv.xy));",
			"}",

			"//focal plane calculation",

			"float fDepth = focalDepth;",

			"if (shaderFocus) {",

				"fDepth = linearize(texture2D(tDepth,focusCoords).x);",

			"}",

			"// dof blur factor calculation",

			"float blur = 0.0;",

			"if (manualdof) {",
				"float a = depth-fDepth; // Focal plane",
				"float b = (a-fdofstart)/fdofdist; // Far DoF",
				"float c = (-a-ndofstart)/ndofdist; // Near Dof",
				"blur = (a>0.0) ? b : c;",
			"} else {",
				"float f = focalLength; // focal length in mm",
				"float d = fDepth*1000.0; // focal plane in mm",
				"float o = depth*1000.0; // depth in mm",

				"float a = (o*f)/(o-f);",
				"float b = (d*f)/(d-f);",
				"float c = (d-f)/(d*fstop*CoC);",

				"blur = abs(a-b)*c;",
			"}",

			"blur = clamp(blur,0.0,1.0);",

			"// calculation of pattern for dithering",

			"vec2 noise = vec2(rand(vUv.xy), rand( vUv.xy + vec2( 0.4, 0.6 ) ) )*dithering*blur;",

			"// getting blur x and y step factor",

			"float w = (1.0/textureWidth)*blur*maxblur+noise.x;",
			"float h = (1.0/textureHeight)*blur*maxblur+noise.y;",

			"// calculation of final color",

			"vec3 col = vec3(0.0);",

			"if(blur < 0.05) {",
				"//some optimization thingy",
				"col = texture2D(tColor, vUv.xy).rgb;",
			"} else {",
				"col = texture2D(tColor, vUv.xy).rgb;",
				"float s = 1.0;",
				"int ringsamples;",

				"for (int i = 1; i <= rings; i++) {",
					"/*unboxstart*/",
					"ringsamples = i * samples;",

					"for (int j = 0 ; j < maxringsamples ; j++) {",
						"if (j >= ringsamples) break;",
						"s += gather(float(i), float(j), ringsamples, col, w, h, blur);",
					"}",
					"/*unboxend*/",
				"}",

				"col /= s; //divide by sample count",
			"}",

			"if (showFocus) {",
				"col = debugFocus(col, blur, depth);",
			"}",

			"if (vignetting) {",
				"col *= vignette();",
			"}",

			"gl_FragColor.rgb = col;",
			"gl_FragColor.a = 1.0;",
		"} "

	].join( "\n" )

};

/**
 * @author tapio / http://tapio.github.com/
 *
 * Brightness and contrast adjustment
 * https://github.com/evanw/glfx.js
 * brightness: -1 to 1 (-1 is solid black, 0 is no change, and 1 is solid white)
 * contrast: -1 to 1 (-1 is solid gray, 0 is no change, and 1 is maximum contrast)
 */

THREE.BrightnessContrastShader = {

	uniforms: {

		"tDiffuse":   { value: null },
		"brightness": { value: 0 },
		"contrast":   { value: 0 }

	},

	vertexShader: [

		"varying vec2 vUv;",

		"void main() {",

			"vUv = uv;",

			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join( "\n" ),

	fragmentShader: [

		"uniform sampler2D tDiffuse;",
		"uniform float brightness;",
		"uniform float contrast;",

		"varying vec2 vUv;",

		"void main() {",

			"gl_FragColor = texture2D( tDiffuse, vUv );",

			"gl_FragColor.rgb += brightness;",

			"if (contrast > 0.0) {",
				"gl_FragColor.rgb = (gl_FragColor.rgb - 0.5) / (1.0 - contrast) + 0.5;",
			"} else {",
				"gl_FragColor.rgb = (gl_FragColor.rgb - 0.5) * (1.0 + contrast) + 0.5;",
			"}",

		"}"

	].join( "\n" )

};

/**
 * @author alteredq / http://alteredqualia.com/
 *
 * Color correction
 */

THREE.ColorCorrectionShader = {

	uniforms: {

		"tDiffuse": { value: null },
		"powRGB":   { value: new THREE.Vector3( 2, 2, 2 ) },
		"mulRGB":   { value: new THREE.Vector3( 1, 1, 1 ) },
		"addRGB":   { value: new THREE.Vector3( 0, 0, 0 ) }

	},

	vertexShader: [

		"varying vec2 vUv;",

		"void main() {",

			"vUv = uv;",

			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join( "\n" ),

	fragmentShader: [

		"uniform sampler2D tDiffuse;",
		"uniform vec3 powRGB;",
		"uniform vec3 mulRGB;",
		"uniform vec3 addRGB;",

		"varying vec2 vUv;",

		"void main() {",

			"gl_FragColor = texture2D( tDiffuse, vUv );",
			"gl_FragColor.rgb = mulRGB * pow( ( gl_FragColor.rgb + addRGB ), powRGB );",

		"}"

	].join( "\n" )

};

/**
 * @author alteredq / http://alteredqualia.com/
 *
 * Colorify shader
 */

THREE.ColorifyShader = {

	uniforms: {

		"tDiffuse": { value: null },
		"color":    { value: new THREE.Color( 0xffffff ) }

	},

	vertexShader: [

		"varying vec2 vUv;",

		"void main() {",

			"vUv = uv;",
			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join( "\n" ),

	fragmentShader: [

		"uniform vec3 color;",
		"uniform sampler2D tDiffuse;",

		"varying vec2 vUv;",

		"void main() {",

			"vec4 texel = texture2D( tDiffuse, vUv );",

			"vec3 luma = vec3( 0.299, 0.587, 0.114 );",
			"float v = dot( texel.xyz, luma );",

			"gl_FragColor = vec4( v * color, texel.w );",

		"}"

	].join( "\n" )

};

/**
 * @author alteredq / http://alteredqualia.com/
 *
 * Convolution shader
 * ported from o3d sample to WebGL / GLSL
 * http://o3d.googlecode.com/svn/trunk/samples/convolution.html
 */

THREE.ConvolutionShader = {

	defines: {

		"KERNEL_SIZE_FLOAT": "25.0",
		"KERNEL_SIZE_INT": "25",

	},

	uniforms: {

		"tDiffuse":        { value: null },
		"uImageIncrement": { value: new THREE.Vector2( 0.001953125, 0.0 ) },
		"cKernel":         { value: [] }

	},

	vertexShader: [

		"uniform vec2 uImageIncrement;",

		"varying vec2 vUv;",

		"void main() {",

			"vUv = uv - ( ( KERNEL_SIZE_FLOAT - 1.0 ) / 2.0 ) * uImageIncrement;",
			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join( "\n" ),

	fragmentShader: [

		"uniform float cKernel[ KERNEL_SIZE_INT ];",

		"uniform sampler2D tDiffuse;",
		"uniform vec2 uImageIncrement;",

		"varying vec2 vUv;",

		"void main() {",

			"vec2 imageCoord = vUv;",
			"vec4 sum = vec4( 0.0, 0.0, 0.0, 0.0 );",

			"for( int i = 0; i < KERNEL_SIZE_INT; i ++ ) {",

				"sum += texture2D( tDiffuse, imageCoord ) * cKernel[ i ];",
				"imageCoord += uImageIncrement;",

			"}",

			"gl_FragColor = sum;",

		"}"


	].join( "\n" ),

	buildKernel: function ( sigma ) {

		// We lop off the sqrt(2 * pi) * sigma term, since we're going to normalize anyway.

		function gauss( x, sigma ) {

			return Math.exp( - ( x * x ) / ( 2.0 * sigma * sigma ) );

		}

		var i, values, sum, halfWidth, kMaxKernelSize = 25, kernelSize = 2 * Math.ceil( sigma * 3.0 ) + 1;

		if ( kernelSize > kMaxKernelSize ) kernelSize = kMaxKernelSize;
		halfWidth = ( kernelSize - 1 ) * 0.5;

		values = new Array( kernelSize );
		sum = 0.0;
		for ( i = 0; i < kernelSize; ++ i ) {

			values[ i ] = gauss( i - halfWidth, sigma );
			sum += values[ i ];

		}

		// normalize the kernel

		for ( i = 0; i < kernelSize; ++ i ) values[ i ] /= sum;

		return values;

	}

};

/**
 * @author alteredq / http://alteredqualia.com/
 *
 * Full-screen textured quad shader
 */

THREE.CopyShader = {

	uniforms: {

		"tDiffuse": { value: null },
		"opacity":  { value: 1.0 }

	},

	vertexShader: [

		"varying vec2 vUv;",

		"void main() {",

			"vUv = uv;",
			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join( "\n" ),

	fragmentShader: [

		"uniform float opacity;",

		"uniform sampler2D tDiffuse;",

		"varying vec2 vUv;",

		"void main() {",

			"vec4 texel = texture2D( tDiffuse, vUv );",
			"gl_FragColor = opacity * texel;",

		"}"

	].join( "\n" )

};

/**
 * @author alteredq / http://alteredqualia.com/
 *
 * Depth-of-field shader using mipmaps
 * - from Matt Handley @applmak
 * - requires power-of-2 sized render target with enabled mipmaps
 */

THREE.DOFMipMapShader = {

	uniforms: {

		"tColor":   { value: null },
		"tDepth":   { value: null },
		"focus":    { value: 1.0 },
		"maxblur":  { value: 1.0 }

	},

	vertexShader: [

		"varying vec2 vUv;",

		"void main() {",

			"vUv = uv;",
			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join( "\n" ),

	fragmentShader: [

		"uniform float focus;",
		"uniform float maxblur;",

		"uniform sampler2D tColor;",
		"uniform sampler2D tDepth;",

		"varying vec2 vUv;",

		"void main() {",

			"vec4 depth = texture2D( tDepth, vUv );",

			"float factor = depth.x - focus;",

			"vec4 col = texture2D( tColor, vUv, 2.0 * maxblur * abs( focus - depth.x ) );",

			"gl_FragColor = col;",
			"gl_FragColor.a = 1.0;",

		"}"

	].join( "\n" )

};

/**
 * @author felixturner / http://airtight.cc/
 *
 * RGB Shift Shader
 * Shifts red and blue channels from center in opposite directions
 * Ported from http://kriss.cx/tom/2009/05/rgb-shift/
 * by Tom Butterworth / http://kriss.cx/tom/
 *
 * amount: shift distance (1 is width of input)
 * angle: shift angle in radians
 */

THREE.DigitalGlitch = {

	uniforms: {

		"tDiffuse":		{ value: null },//diffuse texture
		"tDisp":		{ value: null },//displacement texture for digital glitch squares
		"byp":			{ value: 0 },//apply the glitch ?
		"amount":		{ value: 0.08 },
		"angle":		{ value: 0.02 },
		"seed":			{ value: 0.02 },
		"seed_x":		{ value: 0.02 },//-1,1
		"seed_y":		{ value: 0.02 },//-1,1
		"distortion_x":	{ value: 0.5 },
		"distortion_y":	{ value: 0.6 },
		"col_s":		{ value: 0.05 }
	},

	vertexShader: [

		"varying vec2 vUv;",
		"void main() {",
			"vUv = uv;",
			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",
		"}"
	].join( "\n" ),

	fragmentShader: [
		"uniform int byp;",//should we apply the glitch ?
		
		"uniform sampler2D tDiffuse;",
		"uniform sampler2D tDisp;",
		
		"uniform float amount;",
		"uniform float angle;",
		"uniform float seed;",
		"uniform float seed_x;",
		"uniform float seed_y;",
		"uniform float distortion_x;",
		"uniform float distortion_y;",
		"uniform float col_s;",
			
		"varying vec2 vUv;",
		
		
		"float rand(vec2 co){",
			"return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);",
		"}",
				
		"void main() {",
			"if(byp<1) {",
				"vec2 p = vUv;",
				"float xs = floor(gl_FragCoord.x / 0.5);",
				"float ys = floor(gl_FragCoord.y / 0.5);",
				//based on staffantans glitch shader for unity https://github.com/staffantan/unityglitch
				"vec4 normal = texture2D (tDisp, p*seed*seed);",
				"if(p.y<distortion_x+col_s && p.y>distortion_x-col_s*seed) {",
					"if(seed_x>0.){",
						"p.y = 1. - (p.y + distortion_y);",
					"}",
					"else {",
						"p.y = distortion_y;",
					"}",
				"}",
				"if(p.x<distortion_y+col_s && p.x>distortion_y-col_s*seed) {",
					"if(seed_y>0.){",
						"p.x=distortion_x;",
					"}",
					"else {",
						"p.x = 1. - (p.x + distortion_x);",
					"}",
				"}",
				"p.x+=normal.x*seed_x*(seed/5.);",
				"p.y+=normal.y*seed_y*(seed/5.);",
				//base from RGB shift shader
				"vec2 offset = amount * vec2( cos(angle), sin(angle));",
				"vec4 cr = texture2D(tDiffuse, p + offset);",
				"vec4 cga = texture2D(tDiffuse, p);",
				"vec4 cb = texture2D(tDiffuse, p - offset);",
				"gl_FragColor = vec4(cr.r, cga.g, cb.b, cga.a);",
				//add noise
				"vec4 snow = 200.*amount*vec4(rand(vec2(xs * seed,ys * seed*50.))*0.2);",
				"gl_FragColor = gl_FragColor+ snow;",
			"}",
			"else {",
				"gl_FragColor=texture2D (tDiffuse, vUv);",
			"}",
		"}"

	].join( "\n" )

};

/**
 * @author alteredq / http://alteredqualia.com/
 *
 * Dot screen shader
 * based on glfx.js sepia shader
 * https://github.com/evanw/glfx.js
 */

THREE.DotScreenShader = {

	uniforms: {

		"tDiffuse": { value: null },
		"tSize":    { value: new THREE.Vector2( 256, 256 ) },
		"center":   { value: new THREE.Vector2( 0.5, 0.5 ) },
		"angle":    { value: 1.57 },
		"scale":    { value: 1.0 }

	},

	vertexShader: [

		"varying vec2 vUv;",

		"void main() {",

			"vUv = uv;",
			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join( "\n" ),

	fragmentShader: [

		"uniform vec2 center;",
		"uniform float angle;",
		"uniform float scale;",
		"uniform vec2 tSize;",

		"uniform sampler2D tDiffuse;",

		"varying vec2 vUv;",

		"float pattern() {",

			"float s = sin( angle ), c = cos( angle );",

			"vec2 tex = vUv * tSize - center;",
			"vec2 point = vec2( c * tex.x - s * tex.y, s * tex.x + c * tex.y ) * scale;",

			"return ( sin( point.x ) * sin( point.y ) ) * 4.0;",

		"}",

		"void main() {",

			"vec4 color = texture2D( tDiffuse, vUv );",

			"float average = ( color.r + color.g + color.b ) / 3.0;",

			"gl_FragColor = vec4( vec3( average * 10.0 - 5.0 + pattern() ), color.a );",

		"}"

	].join( "\n" )

};

/**
 * @author zz85 / https://github.com/zz85 | https://www.lab4games.net/zz85/blog
 *
 * Edge Detection Shader using Frei-Chen filter
 * Based on http://rastergrid.com/blog/2011/01/frei-chen-edge-detector
 *
 * aspect: vec2 of (1/width, 1/height)
 */

THREE.EdgeShader = {

	uniforms: {

		"tDiffuse": { value: null },
		"aspect":    { value: new THREE.Vector2( 512, 512 ) },
	},

	vertexShader: [

		"varying vec2 vUv;",

		"void main() {",

			"vUv = uv;",
			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join( "\n" ),

	fragmentShader: [

		"uniform sampler2D tDiffuse;",
		"varying vec2 vUv;",

		"uniform vec2 aspect;",

		"vec2 texel = vec2(1.0 / aspect.x, 1.0 / aspect.y);",


		"mat3 G[9];",

		// hard coded matrix values!!!! as suggested in https://github.com/neilmendoza/ofxPostProcessing/blob/master/src/EdgePass.cpp#L45

		"const mat3 g0 = mat3( 0.3535533845424652, 0, -0.3535533845424652, 0.5, 0, -0.5, 0.3535533845424652, 0, -0.3535533845424652 );",
		"const mat3 g1 = mat3( 0.3535533845424652, 0.5, 0.3535533845424652, 0, 0, 0, -0.3535533845424652, -0.5, -0.3535533845424652 );",
		"const mat3 g2 = mat3( 0, 0.3535533845424652, -0.5, -0.3535533845424652, 0, 0.3535533845424652, 0.5, -0.3535533845424652, 0 );",
		"const mat3 g3 = mat3( 0.5, -0.3535533845424652, 0, -0.3535533845424652, 0, 0.3535533845424652, 0, 0.3535533845424652, -0.5 );",
		"const mat3 g4 = mat3( 0, -0.5, 0, 0.5, 0, 0.5, 0, -0.5, 0 );",
		"const mat3 g5 = mat3( -0.5, 0, 0.5, 0, 0, 0, 0.5, 0, -0.5 );",
		"const mat3 g6 = mat3( 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.6666666865348816, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204 );",
		"const mat3 g7 = mat3( -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, 0.6666666865348816, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408 );",
		"const mat3 g8 = mat3( 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408 );",

		"void main(void)",
		"{",

			"G[0] = g0,",
			"G[1] = g1,",
			"G[2] = g2,",
			"G[3] = g3,",
			"G[4] = g4,",
			"G[5] = g5,",
			"G[6] = g6,",
			"G[7] = g7,",
			"G[8] = g8;",

			"mat3 I;",
			"float cnv[9];",
			"vec3 sample;",

			/* fetch the 3x3 neighbourhood and use the RGB vector's length as intensity value */
			"for (float i=0.0; i<3.0; i++) {",
				"for (float j=0.0; j<3.0; j++) {",
					"sample = texture2D(tDiffuse, vUv + texel * vec2(i-1.0,j-1.0) ).rgb;",
					"I[int(i)][int(j)] = length(sample);",
				"}",
			"}",

			/* calculate the convolution values for all the masks */
			"for (int i=0; i<9; i++) {",
				"float dp3 = dot(G[i][0], I[0]) + dot(G[i][1], I[1]) + dot(G[i][2], I[2]);",
				"cnv[i] = dp3 * dp3;",
			"}",

			"float M = (cnv[0] + cnv[1]) + (cnv[2] + cnv[3]);",
			"float S = (cnv[4] + cnv[5]) + (cnv[6] + cnv[7]) + (cnv[8] + M);",

			"gl_FragColor = vec4(vec3(sqrt(M/S)), 1.0);",
		"}",

	].join( "\n" )
};

/**
 * @author zz85 / https://github.com/zz85 | https://www.lab4games.net/zz85/blog
 *
 * Edge Detection Shader using Sobel filter
 * Based on http://rastergrid.com/blog/2011/01/frei-chen-edge-detector
 *
 * aspect: vec2 of (1/width, 1/height)
 */

THREE.EdgeShader2 = {

	uniforms: {

		"tDiffuse": { value: null },
		"aspect":    { value: new THREE.Vector2( 512, 512 ) },
	},

	vertexShader: [

		"varying vec2 vUv;",

		"void main() {",

			"vUv = uv;",
			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join( "\n" ),

	fragmentShader: [

		"uniform sampler2D tDiffuse;",
		"varying vec2 vUv;",
		"uniform vec2 aspect;",


		"vec2 texel = vec2(1.0 / aspect.x, 1.0 / aspect.y);",

		"mat3 G[2];",

		"const mat3 g0 = mat3( 1.0, 2.0, 1.0, 0.0, 0.0, 0.0, -1.0, -2.0, -1.0 );",
		"const mat3 g1 = mat3( 1.0, 0.0, -1.0, 2.0, 0.0, -2.0, 1.0, 0.0, -1.0 );",


		"void main(void)",
		"{",
			"mat3 I;",
			"float cnv[2];",
			"vec3 sample;",

			"G[0] = g0;",
			"G[1] = g1;",

			/* fetch the 3x3 neighbourhood and use the RGB vector's length as intensity value */
			"for (float i=0.0; i<3.0; i++)",
			"for (float j=0.0; j<3.0; j++) {",
				"sample = texture2D( tDiffuse, vUv + texel * vec2(i-1.0,j-1.0) ).rgb;",
				"I[int(i)][int(j)] = length(sample);",
			"}",

			/* calculate the convolution values for all the masks */
			"for (int i=0; i<2; i++) {",
				"float dp3 = dot(G[i][0], I[0]) + dot(G[i][1], I[1]) + dot(G[i][2], I[2]);",
				"cnv[i] = dp3 * dp3; ",
			"}",

			"gl_FragColor = vec4(0.5 * sqrt(cnv[0]*cnv[0]+cnv[1]*cnv[1]));",
		"} ",

	].join( "\n" )

};

/**
 * @author alteredq / http://alteredqualia.com/
 * @author davidedc / http://www.sketchpatch.net/
 *
 * NVIDIA FXAA by Timothy Lottes
 * http://timothylottes.blogspot.com/2011/06/fxaa3-source-released.html
 * - WebGL port by @supereggbert
 * http://www.glge.org/demos/fxaa/
 */

THREE.FXAAShader = {

	uniforms: {

		"tDiffuse":   { value: null },
		"resolution": { value: new THREE.Vector2( 1 / 1024, 1 / 512 ) }

	},

	vertexShader: [

		"void main() {",

			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join( "\n" ),

	fragmentShader: [

		"uniform sampler2D tDiffuse;",
		"uniform vec2 resolution;",

		"#define FXAA_REDUCE_MIN   (1.0/128.0)",
		"#define FXAA_REDUCE_MUL   (1.0/8.0)",
		"#define FXAA_SPAN_MAX     8.0",

		"void main() {",

			"vec3 rgbNW = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( -1.0, -1.0 ) ) * resolution ).xyz;",
			"vec3 rgbNE = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( 1.0, -1.0 ) ) * resolution ).xyz;",
			"vec3 rgbSW = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( -1.0, 1.0 ) ) * resolution ).xyz;",
			"vec3 rgbSE = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( 1.0, 1.0 ) ) * resolution ).xyz;",
			"vec4 rgbaM  = texture2D( tDiffuse,  gl_FragCoord.xy  * resolution );",
			"vec3 rgbM  = rgbaM.xyz;",
			"vec3 luma = vec3( 0.299, 0.587, 0.114 );",

			"float lumaNW = dot( rgbNW, luma );",
			"float lumaNE = dot( rgbNE, luma );",
			"float lumaSW = dot( rgbSW, luma );",
			"float lumaSE = dot( rgbSE, luma );",
			"float lumaM  = dot( rgbM,  luma );",
			"float lumaMin = min( lumaM, min( min( lumaNW, lumaNE ), min( lumaSW, lumaSE ) ) );",
			"float lumaMax = max( lumaM, max( max( lumaNW, lumaNE) , max( lumaSW, lumaSE ) ) );",

			"vec2 dir;",
			"dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));",
			"dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));",

			"float dirReduce = max( ( lumaNW + lumaNE + lumaSW + lumaSE ) * ( 0.25 * FXAA_REDUCE_MUL ), FXAA_REDUCE_MIN );",

			"float rcpDirMin = 1.0 / ( min( abs( dir.x ), abs( dir.y ) ) + dirReduce );",
			"dir = min( vec2( FXAA_SPAN_MAX,  FXAA_SPAN_MAX),",
				  "max( vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),",
						"dir * rcpDirMin)) * resolution;",
			"vec4 rgbA = (1.0/2.0) * (",
        	"texture2D(tDiffuse,  gl_FragCoord.xy  * resolution + dir * (1.0/3.0 - 0.5)) +",
			"texture2D(tDiffuse,  gl_FragCoord.xy  * resolution + dir * (2.0/3.0 - 0.5)));",
    		"vec4 rgbB = rgbA * (1.0/2.0) + (1.0/4.0) * (",
			"texture2D(tDiffuse,  gl_FragCoord.xy  * resolution + dir * (0.0/3.0 - 0.5)) +",
      		"texture2D(tDiffuse,  gl_FragCoord.xy  * resolution + dir * (3.0/3.0 - 0.5)));",
    		"float lumaB = dot(rgbB, vec4(luma, 0.0));",

			"if ( ( lumaB < lumaMin ) || ( lumaB > lumaMax ) ) {",

				"gl_FragColor = rgbA;",

			"} else {",
				"gl_FragColor = rgbB;",

			"}",

		"}"

	].join( "\n" )

};

/**
 * @author alteredq / http://alteredqualia.com/
 *
 * Film grain & scanlines shader
 *
 * - ported from HLSL to WebGL / GLSL
 * http://www.truevision3d.com/forums/showcase/staticnoise_colorblackwhite_scanline_shaders-t18698.0.html
 *
 * Screen Space Static Postprocessor
 *
 * Produces an analogue noise overlay similar to a film grain / TV static
 *
 * Original implementation and noise algorithm
 * Pat 'Hawthorne' Shearon
 *
 * Optimized scanlines + noise version with intensity scaling
 * Georg 'Leviathan' Steinrohder
 *
 * This version is provided under a Creative Commons Attribution 3.0 License
 * http://creativecommons.org/licenses/by/3.0/
 */

THREE.FilmShader = {

	uniforms: {

		"tDiffuse":   { value: null },
		"time":       { value: 0.0 },
		"nIntensity": { value: 0.5 },
		"sIntensity": { value: 0.05 },
		"sCount":     { value: 4096 },
		"grayscale":  { value: 1 }

	},

	vertexShader: [

		"varying vec2 vUv;",

		"void main() {",

			"vUv = uv;",
			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join( "\n" ),

	fragmentShader: [

		"#include <common>",
		
		// control parameter
		"uniform float time;",

		"uniform bool grayscale;",

		// noise effect intensity value (0 = no effect, 1 = full effect)
		"uniform float nIntensity;",

		// scanlines effect intensity value (0 = no effect, 1 = full effect)
		"uniform float sIntensity;",

		// scanlines effect count value (0 = no effect, 4096 = full effect)
		"uniform float sCount;",

		"uniform sampler2D tDiffuse;",

		"varying vec2 vUv;",

		"void main() {",

			// sample the source
			"vec4 cTextureScreen = texture2D( tDiffuse, vUv );",

			// make some noise
			"float dx = rand( vUv + time );",

			// add noise
			"vec3 cResult = cTextureScreen.rgb + cTextureScreen.rgb * clamp( 0.1 + dx, 0.0, 1.0 );",

			// get us a sine and cosine
			"vec2 sc = vec2( sin( vUv.y * sCount ), cos( vUv.y * sCount ) );",

			// add scanlines
			"cResult += cTextureScreen.rgb * vec3( sc.x, sc.y, sc.x ) * sIntensity;",

			// interpolate between source and result by intensity
			"cResult = cTextureScreen.rgb + clamp( nIntensity, 0.0,1.0 ) * ( cResult - cTextureScreen.rgb );",

			// convert to grayscale if desired
			"if( grayscale ) {",

				"cResult = vec3( cResult.r * 0.3 + cResult.g * 0.59 + cResult.b * 0.11 );",

			"}",

			"gl_FragColor =  vec4( cResult, cTextureScreen.a );",

		"}"

	].join( "\n" )

};

/**
 * @author alteredq / http://alteredqualia.com/
 *
 * Focus shader
 * based on PaintEffect postprocess from ro.me
 * http://code.google.com/p/3-dreams-of-black/source/browse/deploy/js/effects/PaintEffect.js
 */

THREE.FocusShader = {

	uniforms : {

		"tDiffuse":       { value: null },
		"screenWidth":    { value: 1024 },
		"screenHeight":   { value: 1024 },
		"sampleDistance": { value: 0.94 },
		"waveFactor":     { value: 0.00125 }

	},

	vertexShader: [

		"varying vec2 vUv;",

		"void main() {",

			"vUv = uv;",
			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join( "\n" ),

	fragmentShader: [

		"uniform float screenWidth;",
		"uniform float screenHeight;",
		"uniform float sampleDistance;",
		"uniform float waveFactor;",

		"uniform sampler2D tDiffuse;",

		"varying vec2 vUv;",

		"void main() {",

			"vec4 color, org, tmp, add;",
			"float sample_dist, f;",
			"vec2 vin;",
			"vec2 uv = vUv;",

			"add = color = org = texture2D( tDiffuse, uv );",

			"vin = ( uv - vec2( 0.5 ) ) * vec2( 1.4 );",
			"sample_dist = dot( vin, vin ) * 2.0;",

			"f = ( waveFactor * 100.0 + sample_dist ) * sampleDistance * 4.0;",

			"vec2 sampleSize = vec2(  1.0 / screenWidth, 1.0 / screenHeight ) * vec2( f );",

			"add += tmp = texture2D( tDiffuse, uv + vec2( 0.111964, 0.993712 ) * sampleSize );",
			"if( tmp.b < color.b ) color = tmp;",

			"add += tmp = texture2D( tDiffuse, uv + vec2( 0.846724, 0.532032 ) * sampleSize );",
			"if( tmp.b < color.b ) color = tmp;",

			"add += tmp = texture2D( tDiffuse, uv + vec2( 0.943883, -0.330279 ) * sampleSize );",
			"if( tmp.b < color.b ) color = tmp;",

			"add += tmp = texture2D( tDiffuse, uv + vec2( 0.330279, -0.943883 ) * sampleSize );",
			"if( tmp.b < color.b ) color = tmp;",

			"add += tmp = texture2D( tDiffuse, uv + vec2( -0.532032, -0.846724 ) * sampleSize );",
			"if( tmp.b < color.b ) color = tmp;",

			"add += tmp = texture2D( tDiffuse, uv + vec2( -0.993712, -0.111964 ) * sampleSize );",
			"if( tmp.b < color.b ) color = tmp;",

			"add += tmp = texture2D( tDiffuse, uv + vec2( -0.707107, 0.707107 ) * sampleSize );",
			"if( tmp.b < color.b ) color = tmp;",

			"color = color * vec4( 2.0 ) - ( add / vec4( 8.0 ) );",
			"color = color + ( add / vec4( 8.0 ) - color ) * ( vec4( 1.0 ) - vec4( sample_dist * 0.5 ) );",

			"gl_FragColor = vec4( color.rgb * color.rgb * vec3( 0.95 ) + color.rgb, 1.0 );",

		"}"


	].join( "\n" )
};

/**
 * @author alteredq / http://alteredqualia.com/
 *
 * Based on Nvidia Cg tutorial
 */

THREE.FresnelShader = {

	uniforms: {

		"mRefractionRatio": { value: 1.02 },
		"mFresnelBias": { value: 0.1 },
		"mFresnelPower": { value: 2.0 },
		"mFresnelScale": { value: 1.0 },
		"tCube": { value: null }

	},

	vertexShader: [

		"uniform float mRefractionRatio;",
		"uniform float mFresnelBias;",
		"uniform float mFresnelScale;",
		"uniform float mFresnelPower;",

		"varying vec3 vReflect;",
		"varying vec3 vRefract[3];",
		"varying float vReflectionFactor;",

		"void main() {",

			"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",
			"vec4 worldPosition = modelMatrix * vec4( position, 1.0 );",

			"vec3 worldNormal = normalize( mat3( modelMatrix[0].xyz, modelMatrix[1].xyz, modelMatrix[2].xyz ) * normal );",

			"vec3 I = worldPosition.xyz - cameraPosition;",

			"vReflect = reflect( I, worldNormal );",
			"vRefract[0] = refract( normalize( I ), worldNormal, mRefractionRatio );",
			"vRefract[1] = refract( normalize( I ), worldNormal, mRefractionRatio * 0.99 );",
			"vRefract[2] = refract( normalize( I ), worldNormal, mRefractionRatio * 0.98 );",
			"vReflectionFactor = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( I ), worldNormal ), mFresnelPower );",

			"gl_Position = projectionMatrix * mvPosition;",

		"}"

	].join( "\n" ),

	fragmentShader: [

		"uniform samplerCube tCube;",

		"varying vec3 vReflect;",
		"varying vec3 vRefract[3];",
		"varying float vReflectionFactor;",

		"void main() {",

			"vec4 reflectedColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );",
			"vec4 refractedColor = vec4( 1.0 );",

			"refractedColor.r = textureCube( tCube, vec3( -vRefract[0].x, vRefract[0].yz ) ).r;",
			"refractedColor.g = textureCube( tCube, vec3( -vRefract[1].x, vRefract[1].yz ) ).g;",
			"refractedColor.b = textureCube( tCube, vec3( -vRefract[2].x, vRefract[2].yz ) ).b;",

			"gl_FragColor = mix( refractedColor, reflectedColor, clamp( vReflectionFactor, 0.0, 1.0 ) );",

		"}"

	].join( "\n" )

};

/**
 * @author WestLangley / http://github.com/WestLangley
 *
 * Gamma Correction Shader
 * http://en.wikipedia.org/wiki/gamma_correction
 */

THREE.GammaCorrectionShader = {

	uniforms: {

		"tDiffuse": { value: null },

	},

	vertexShader: [

		"varying vec2 vUv;",

		"void main() {",

			"vUv = uv;",
			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join( "\n" ),

	fragmentShader: [

		"uniform sampler2D tDiffuse;",

		"varying vec2 vUv;",

		"void main() {",

			"vec4 tex = texture2D( tDiffuse, vec2( vUv.x, vUv.y ) );",

			"gl_FragColor = LinearToGamma( tex, float( GAMMA_FACTOR ) );",

		"}"

	].join( "\n" )

};

/**
 * @author zz85 / http://www.lab4games.net/zz85/blog
 *
 * Two pass Gaussian blur filter (horizontal and vertical blur shaders)
 * - described in http://www.gamerendering.com/2008/10/11/gaussian-blur-filter-shader/
 *   and used in http://www.cake23.de/traveling-wavefronts-lit-up.html
 *
 * - 9 samples per pass
 * - standard deviation 2.7
 * - "h" and "v" parameters should be set to "1 / width" and "1 / height"
 */

THREE.HorizontalBlurShader = {

	uniforms: {

		"tDiffuse": { value: null },
		"h":        { value: 1.0 / 512.0 }

	},

	vertexShader: [

		"varying vec2 vUv;",

		"void main() {",

			"vUv = uv;",
			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join( "\n" ),

	fragmentShader: [

		"uniform sampler2D tDiffuse;",
		"uniform float h;",

		"varying vec2 vUv;",

		"void main() {",

			"vec4 sum = vec4( 0.0 );",

			"sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;",
			"sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;",
			"sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;",
			"sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;",
			"sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;",
			"sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;",
			"sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;",
			"sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;",
			"sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;",

			"gl_FragColor = sum;",

		"}"

	].join( "\n" )

};

/**
 * @author alteredq / http://alteredqualia.com/
 *
 * Simple fake tilt-shift effect, modulating two pass Gaussian blur (see above) by vertical position
 *
 * - 9 samples per pass
 * - standard deviation 2.7
 * - "h" and "v" parameters should be set to "1 / width" and "1 / height"
 * - "r" parameter control where "focused" horizontal line lies
 */

THREE.HorizontalTiltShiftShader = {

	uniforms: {

		"tDiffuse": { value: null },
		"h":        { value: 1.0 / 512.0 },
		"r":        { value: 0.35 }

	},

	vertexShader: [

		"varying vec2 vUv;",

		"void main() {",

			"vUv = uv;",
			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join( "\n" ),

	fragmentShader: [

		"uniform sampler2D tDiffuse;",
		"uniform float h;",
		"uniform float r;",

		"varying vec2 vUv;",

		"void main() {",

			"vec4 sum = vec4( 0.0 );",

			"float hh = h * abs( r - vUv.y );",

			"sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * hh, vUv.y ) ) * 0.051;",
			"sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * hh, vUv.y ) ) * 0.0918;",
			"sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * hh, vUv.y ) ) * 0.12245;",
			"sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * hh, vUv.y ) ) * 0.1531;",
			"sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;",
			"sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * hh, vUv.y ) ) * 0.1531;",
			"sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * hh, vUv.y ) ) * 0.12245;",
			"sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * hh, vUv.y ) ) * 0.0918;",
			"sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * hh, vUv.y ) ) * 0.051;",

			"gl_FragColor = sum;",

		"}"

	].join( "\n" )

};

/**
 * @author tapio / http://tapio.github.com/
 *
 * Hue and saturation adjustment
 * https://github.com/evanw/glfx.js
 * hue: -1 to 1 (-1 is 180 degrees in the negative direction, 0 is no change, etc.
 * saturation: -1 to 1 (-1 is solid gray, 0 is no change, and 1 is maximum contrast)
 */

THREE.HueSaturationShader = {

	uniforms: {

		"tDiffuse":   { value: null },
		"hue":        { value: 0 },
		"saturation": { value: 0 }

	},

	vertexShader: [

		"varying vec2 vUv;",

		"void main() {",

			"vUv = uv;",

			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join( "\n" ),

	fragmentShader: [

		"uniform sampler2D tDiffuse;",
		"uniform float hue;",
		"uniform float saturation;",

		"varying vec2 vUv;",

		"void main() {",

			"gl_FragColor = texture2D( tDiffuse, vUv );",

			// hue
			"float angle = hue * 3.14159265;",
			"float s = sin(angle), c = cos(angle);",
			"vec3 weights = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;",
			"float len = length(gl_FragColor.rgb);",
			"gl_FragColor.rgb = vec3(",
				"dot(gl_FragColor.rgb, weights.xyz),",
				"dot(gl_FragColor.rgb, weights.zxy),",
				"dot(gl_FragColor.rgb, weights.yzx)",
			");",

			// saturation
			"float average = (gl_FragColor.r + gl_FragColor.g + gl_FragColor.b) / 3.0;",
			"if (saturation > 0.0) {",
				"gl_FragColor.rgb += (average - gl_FragColor.rgb) * (1.0 - 1.0 / (1.001 - saturation));",
			"} else {",
				"gl_FragColor.rgb += (average - gl_FragColor.rgb) * (-saturation);",
			"}",

		"}"

	].join( "\n" )

};

/**
 * @author felixturner / http://airtight.cc/
 *
 * Kaleidoscope Shader
 * Radial reflection around center point
 * Ported from: http://pixelshaders.com/editor/
 * by Toby Schachman / http://tobyschachman.com/
 *
 * sides: number of reflections
 * angle: initial angle in radians
 */

THREE.KaleidoShader = {

	uniforms: {

		"tDiffuse": { value: null },
		"sides":    { value: 6.0 },
		"angle":    { value: 0.0 }

	},

	vertexShader: [

		"varying vec2 vUv;",

		"void main() {",

			"vUv = uv;",
			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join( "\n" ),

	fragmentShader: [

		"uniform sampler2D tDiffuse;",
		"uniform float sides;",
		"uniform float angle;",
		
		"varying vec2 vUv;",

		"void main() {",

			"vec2 p = vUv - 0.5;",
			"float r = length(p);",
			"float a = atan(p.y, p.x) + angle;",
			"float tau = 2. * 3.1416 ;",
			"a = mod(a, tau/sides);",
			"a = abs(a - tau/sides/2.) ;",
			"p = r * vec2(cos(a), sin(a));",
			"vec4 color = texture2D(tDiffuse, p + 0.5);",
			"gl_FragColor = color;",

		"}"

	].join( "\n" )

};

/**
 * @author alteredq / http://alteredqualia.com/
 *
 * Luminosity
 * http://en.wikipedia.org/wiki/Luminosity
 */

THREE.LuminosityShader = {

	uniforms: {

		"tDiffuse": { value: null }

	},

	vertexShader: [

		"varying vec2 vUv;",

		"void main() {",

			"vUv = uv;",

			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join( "\n" ),

	fragmentShader: [

		"uniform sampler2D tDiffuse;",

		"varying vec2 vUv;",

		"void main() {",

			"vec4 texel = texture2D( tDiffuse, vUv );",

			"vec3 luma = vec3( 0.299, 0.587, 0.114 );",

			"float v = dot( texel.xyz, luma );",

			"gl_FragColor = vec4( v, v, v, texel.w );",

		"}"

	].join( "\n" )

};

/**
 * @author felixturner / http://airtight.cc/
 *
 * Mirror Shader
 * Copies half the input to the other half
 *
 * side: side of input to mirror (0 = left, 1 = right, 2 = top, 3 = bottom)
 */

THREE.MirrorShader = {

	uniforms: {

		"tDiffuse": { value: null },
		"side":     { value: 1 }

	},

	vertexShader: [

		"varying vec2 vUv;",

		"void main() {",

			"vUv = uv;",
			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join( "\n" ),

	fragmentShader: [

		"uniform sampler2D tDiffuse;",
		"uniform int side;",
		
		"varying vec2 vUv;",

		"void main() {",

			"vec2 p = vUv;",
			"if (side == 0){",
				"if (p.x > 0.5) p.x = 1.0 - p.x;",
			"}else if (side == 1){",
				"if (p.x < 0.5) p.x = 1.0 - p.x;",
			"}else if (side == 2){",
				"if (p.y < 0.5) p.y = 1.0 - p.y;",
			"}else if (side == 3){",
				"if (p.y > 0.5) p.y = 1.0 - p.y;",
			"} ",
			"vec4 color = texture2D(tDiffuse, p);",
			"gl_FragColor = color;",

		"}"

	].join( "\n" )

};

/**
 * @author alteredq / http://alteredqualia.com/
 *
 * Normal map shader
 * - compute normals from heightmap
 */

THREE.NormalMapShader = {

	uniforms: {

		"heightMap":  { value: null },
		"resolution": { value: new THREE.Vector2( 512, 512 ) },
		"scale":      { value: new THREE.Vector2( 1, 1 ) },
		"height":     { value: 0.05 }

	},

	vertexShader: [

		"varying vec2 vUv;",

		"void main() {",

			"vUv = uv;",
			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join( "\n" ),

	fragmentShader: [

		"uniform float height;",
		"uniform vec2 resolution;",
		"uniform sampler2D heightMap;",

		"varying vec2 vUv;",

		"void main() {",

			"float val = texture2D( heightMap, vUv ).x;",

			"float valU = texture2D( heightMap, vUv + vec2( 1.0 / resolution.x, 0.0 ) ).x;",
			"float valV = texture2D( heightMap, vUv + vec2( 0.0, 1.0 / resolution.y ) ).x;",

			"gl_FragColor = vec4( ( 0.5 * normalize( vec3( val - valU, val - valV, height  ) ) + 0.5 ), 1.0 );",

		"}"

	].join( "\n" )

};

// Author: Aleksandr Albert
// Website: www.routter.co.tt

// Description: A deep water ocean shader set
// based on an implementation of a Tessendorf Waves
// originally presented by David Li ( www.david.li/waves )

// The general method is to apply shaders to simulation Framebuffers
// and then sample these framebuffers when rendering the ocean mesh

// The set uses 7 shaders:

// -- Simulation shaders
// [1] ocean_sim_vertex         -> Vertex shader used to set up a 2x2 simulation plane centered at (0,0)
// [2] ocean_subtransform       -> Fragment shader used to subtransform the mesh (generates the displacement map)
// [3] ocean_initial_spectrum   -> Fragment shader used to set intitial wave frequency at a texel coordinate
// [4] ocean_phase              -> Fragment shader used to set wave phase at a texel coordinate
// [5] ocean_spectrum           -> Fragment shader used to set current wave frequency at a texel coordinate
// [6] ocean_normal             -> Fragment shader used to set face normals at a texel coordinate

// -- Rendering Shader
// [7] ocean_main               -> Vertex and Fragment shader used to create the final render


THREE.ShaderLib[ 'ocean_sim_vertex' ] = {
	vertexShader: [
		'varying vec2 vUV;',

		'void main (void) {',
			'vUV = position.xy * 0.5 + 0.5;',
			'gl_Position = vec4(position, 1.0 );',
		'}'
	].join( '\n' )
};
THREE.ShaderLib[ 'ocean_subtransform' ] = {
	uniforms: {
		"u_input": { value: null },
		"u_transformSize": { value: 512.0 },
		"u_subtransformSize": { value: 250.0 }
	},
	fragmentShader: [
		//GPU FFT using a Stockham formulation

		'precision highp float;',
		'#include <common>',

		'uniform sampler2D u_input;',
		'uniform float u_transformSize;',
		'uniform float u_subtransformSize;',

		'varying vec2 vUV;',

		'vec2 multiplyComplex (vec2 a, vec2 b) {',
			'return vec2(a[0] * b[0] - a[1] * b[1], a[1] * b[0] + a[0] * b[1]);',
		'}',

		'void main (void) {',
			'#ifdef HORIZONTAL',
			'float index = vUV.x * u_transformSize - 0.5;',
			'#else',
			'float index = vUV.y * u_transformSize - 0.5;',
			'#endif',

			'float evenIndex = floor(index / u_subtransformSize) * (u_subtransformSize * 0.5) + mod(index, u_subtransformSize * 0.5);',

			//transform two complex sequences simultaneously
			'#ifdef HORIZONTAL',
			'vec4 even = texture2D(u_input, vec2(evenIndex + 0.5, gl_FragCoord.y) / u_transformSize).rgba;',
			'vec4 odd = texture2D(u_input, vec2(evenIndex + u_transformSize * 0.5 + 0.5, gl_FragCoord.y) / u_transformSize).rgba;',
			'#else',
			'vec4 even = texture2D(u_input, vec2(gl_FragCoord.x, evenIndex + 0.5) / u_transformSize).rgba;',
			'vec4 odd = texture2D(u_input, vec2(gl_FragCoord.x, evenIndex + u_transformSize * 0.5 + 0.5) / u_transformSize).rgba;',
			'#endif',

			'float twiddleArgument = -2.0 * PI * (index / u_subtransformSize);',
			'vec2 twiddle = vec2(cos(twiddleArgument), sin(twiddleArgument));',

			'vec2 outputA = even.xy + multiplyComplex(twiddle, odd.xy);',
			'vec2 outputB = even.zw + multiplyComplex(twiddle, odd.zw);',

			'gl_FragColor = vec4(outputA, outputB);',
		'}'
	].join( '\n' )
};
THREE.ShaderLib[ 'ocean_initial_spectrum' ] = {
	uniforms: {
		"u_wind": { value: new THREE.Vector2( 10.0, 10.0 ) },
		"u_resolution": { value: 512.0 },
		"u_size": { value: 250.0 },
	},
	fragmentShader: [
		'precision highp float;',
		'#include <common>',

		'const float G = 9.81;',
		'const float KM = 370.0;',
		'const float CM = 0.23;',

		'uniform vec2 u_wind;',
		'uniform float u_resolution;',
		'uniform float u_size;',

		'float omega (float k) {',
			'return sqrt(G * k * (1.0 + pow2(k / KM)));',
		'}',

		'float tanh (float x) {',
			'return (1.0 - exp(-2.0 * x)) / (1.0 + exp(-2.0 * x));',
		'}',

		'void main (void) {',
			'vec2 coordinates = gl_FragCoord.xy - 0.5;',

			'float n = (coordinates.x < u_resolution * 0.5) ? coordinates.x : coordinates.x - u_resolution;',
			'float m = (coordinates.y < u_resolution * 0.5) ? coordinates.y : coordinates.y - u_resolution;',

			'vec2 K = (2.0 * PI * vec2(n, m)) / u_size;',
			'float k = length(K);',

			'float l_wind = length(u_wind);',

			'float Omega = 0.84;',
			'float kp = G * pow2(Omega / l_wind);',

			'float c = omega(k) / k;',
			'float cp = omega(kp) / kp;',

			'float Lpm = exp(-1.25 * pow2(kp / k));',
			'float gamma = 1.7;',
			'float sigma = 0.08 * (1.0 + 4.0 * pow(Omega, -3.0));',
			'float Gamma = exp(-pow2(sqrt(k / kp) - 1.0) / 2.0 * pow2(sigma));',
			'float Jp = pow(gamma, Gamma);',
			'float Fp = Lpm * Jp * exp(-Omega / sqrt(10.0) * (sqrt(k / kp) - 1.0));',
			'float alphap = 0.006 * sqrt(Omega);',
			'float Bl = 0.5 * alphap * cp / c * Fp;',

			'float z0 = 0.000037 * pow2(l_wind) / G * pow(l_wind / cp, 0.9);',
			'float uStar = 0.41 * l_wind / log(10.0 / z0);',
			'float alpham = 0.01 * ((uStar < CM) ? (1.0 + log(uStar / CM)) : (1.0 + 3.0 * log(uStar / CM)));',
			'float Fm = exp(-0.25 * pow2(k / KM - 1.0));',
			'float Bh = 0.5 * alpham * CM / c * Fm * Lpm;',

			'float a0 = log(2.0) / 4.0;',
			'float am = 0.13 * uStar / CM;',
			'float Delta = tanh(a0 + 4.0 * pow(c / cp, 2.5) + am * pow(CM / c, 2.5));',

			'float cosPhi = dot(normalize(u_wind), normalize(K));',

			'float S = (1.0 / (2.0 * PI)) * pow(k, -4.0) * (Bl + Bh) * (1.0 + Delta * (2.0 * cosPhi * cosPhi - 1.0));',

			'float dk = 2.0 * PI / u_size;',
			'float h = sqrt(S / 2.0) * dk;',

			'if (K.x == 0.0 && K.y == 0.0) {',
				'h = 0.0;', //no DC term
			'}',
			'gl_FragColor = vec4(h, 0.0, 0.0, 0.0);',
		'}'
	].join( '\n' )
};
THREE.ShaderLib[ 'ocean_phase' ] = {
	uniforms: {
		"u_phases": { value: null },
		"u_deltaTime": { value: null },
		"u_resolution": { value: null },
		"u_size": { value: null },
	},
	fragmentShader: [
		'precision highp float;',
		'#include <common>',

		'const float G = 9.81;',
		'const float KM = 370.0;',

		'varying vec2 vUV;',

		'uniform sampler2D u_phases;',
		'uniform float u_deltaTime;',
		'uniform float u_resolution;',
		'uniform float u_size;',

		'float omega (float k) {',
			'return sqrt(G * k * (1.0 + k * k / KM * KM));',
		'}',

		'void main (void) {',
			'float deltaTime = 1.0 / 60.0;',
			'vec2 coordinates = gl_FragCoord.xy - 0.5;',
			'float n = (coordinates.x < u_resolution * 0.5) ? coordinates.x : coordinates.x - u_resolution;',
			'float m = (coordinates.y < u_resolution * 0.5) ? coordinates.y : coordinates.y - u_resolution;',
			'vec2 waveVector = (2.0 * PI * vec2(n, m)) / u_size;',

			'float phase = texture2D(u_phases, vUV).r;',
			'float deltaPhase = omega(length(waveVector)) * u_deltaTime;',
			'phase = mod(phase + deltaPhase, 2.0 * PI);',

			'gl_FragColor = vec4(phase, 0.0, 0.0, 0.0);',
		'}'
	].join( '\n' )
};
THREE.ShaderLib[ 'ocean_spectrum' ] = {
	uniforms: {
		"u_size": { value: null },
		"u_resolution": { value: null },
		"u_choppiness": { value: null },
		"u_phases": { value: null },
		"u_initialSpectrum": { value: null },
	},
	fragmentShader: [
		'precision highp float;',
		'#include <common>',

		'const float G = 9.81;',
		'const float KM = 370.0;',

		'varying vec2 vUV;',

		'uniform float u_size;',
		'uniform float u_resolution;',
		'uniform float u_choppiness;',
		'uniform sampler2D u_phases;',
		'uniform sampler2D u_initialSpectrum;',

		'vec2 multiplyComplex (vec2 a, vec2 b) {',
			'return vec2(a[0] * b[0] - a[1] * b[1], a[1] * b[0] + a[0] * b[1]);',
		'}',

		'vec2 multiplyByI (vec2 z) {',
			'return vec2(-z[1], z[0]);',
		'}',

		'float omega (float k) {',
			'return sqrt(G * k * (1.0 + k * k / KM * KM));',
		'}',

		'void main (void) {',
			'vec2 coordinates = gl_FragCoord.xy - 0.5;',
			'float n = (coordinates.x < u_resolution * 0.5) ? coordinates.x : coordinates.x - u_resolution;',
			'float m = (coordinates.y < u_resolution * 0.5) ? coordinates.y : coordinates.y - u_resolution;',
			'vec2 waveVector = (2.0 * PI * vec2(n, m)) / u_size;',

			'float phase = texture2D(u_phases, vUV).r;',
			'vec2 phaseVector = vec2(cos(phase), sin(phase));',

			'vec2 h0 = texture2D(u_initialSpectrum, vUV).rg;',
			'vec2 h0Star = texture2D(u_initialSpectrum, vec2(1.0 - vUV + 1.0 / u_resolution)).rg;',
			'h0Star.y *= -1.0;',

			'vec2 h = multiplyComplex(h0, phaseVector) + multiplyComplex(h0Star, vec2(phaseVector.x, -phaseVector.y));',

			'vec2 hX = -multiplyByI(h * (waveVector.x / length(waveVector))) * u_choppiness;',
			'vec2 hZ = -multiplyByI(h * (waveVector.y / length(waveVector))) * u_choppiness;',

			//no DC term
			'if (waveVector.x == 0.0 && waveVector.y == 0.0) {',
				'h = vec2(0.0);',
				'hX = vec2(0.0);',
				'hZ = vec2(0.0);',
			'}',

			'gl_FragColor = vec4(hX + multiplyByI(h), hZ);',
		'}'
	].join( '\n' )
};
THREE.ShaderLib[ 'ocean_normals' ] = {
	uniforms: {
		"u_displacementMap": { value: null },
		"u_resolution": { value: null },
		"u_size": { value: null },
	},
	fragmentShader: [
		'precision highp float;',

		'varying vec2 vUV;',

		'uniform sampler2D u_displacementMap;',
		'uniform float u_resolution;',
		'uniform float u_size;',

		'void main (void) {',
			'float texel = 1.0 / u_resolution;',
			'float texelSize = u_size / u_resolution;',

			'vec3 center = texture2D(u_displacementMap, vUV).rgb;',
			'vec3 right = vec3(texelSize, 0.0, 0.0) + texture2D(u_displacementMap, vUV + vec2(texel, 0.0)).rgb - center;',
			'vec3 left = vec3(-texelSize, 0.0, 0.0) + texture2D(u_displacementMap, vUV + vec2(-texel, 0.0)).rgb - center;',
			'vec3 top = vec3(0.0, 0.0, -texelSize) + texture2D(u_displacementMap, vUV + vec2(0.0, -texel)).rgb - center;',
			'vec3 bottom = vec3(0.0, 0.0, texelSize) + texture2D(u_displacementMap, vUV + vec2(0.0, texel)).rgb - center;',

			'vec3 topRight = cross(right, top);',
			'vec3 topLeft = cross(top, left);',
			'vec3 bottomLeft = cross(left, bottom);',
			'vec3 bottomRight = cross(bottom, right);',

			'gl_FragColor = vec4(normalize(topRight + topLeft + bottomLeft + bottomRight), 1.0);',
		'}'
	].join( '\n' )
};
THREE.ShaderLib[ 'ocean_main' ] = {
	uniforms: {
		"u_displacementMap": { value: null },
		"u_normalMap": { value: null },
		"u_geometrySize": { value: null },
		"u_size": { value: null },
		"u_projectionMatrix": { value: null },
		"u_viewMatrix": { value: null },
		"u_cameraPosition": { value: null },
		"u_skyColor": { value: null },
		"u_oceanColor": { value: null },
		"u_sunDirection": { value: null },
		"u_exposure": { value: null },
	},
	vertexShader: [
		'precision highp float;',

		'varying vec3 vPos;',
		'varying vec2 vUV;',

		'uniform mat4 u_projectionMatrix;',
		'uniform mat4 u_viewMatrix;',
		'uniform float u_size;',
		'uniform float u_geometrySize;',
		'uniform sampler2D u_displacementMap;',

		'void main (void) {',
			'vec3 newPos = position + texture2D(u_displacementMap, uv).rgb * (u_geometrySize / u_size);',
			'vPos = newPos;',
			'vUV = uv;',
			'gl_Position = u_projectionMatrix * u_viewMatrix * vec4(newPos, 1.0);',
		'}'
	].join( '\n' ),
	fragmentShader: [
		'precision highp float;',

		'varying vec3 vPos;',
		'varying vec2 vUV;',

		'uniform sampler2D u_displacementMap;',
		'uniform sampler2D u_normalMap;',
		'uniform vec3 u_cameraPosition;',
		'uniform vec3 u_oceanColor;',
		'uniform vec3 u_skyColor;',
		'uniform vec3 u_sunDirection;',
		'uniform float u_exposure;',

		'vec3 hdr (vec3 color, float exposure) {',
			'return 1.0 - exp(-color * exposure);',
		'}',

		'void main (void) {',
			'vec3 normal = texture2D(u_normalMap, vUV).rgb;',

			'vec3 view = normalize(u_cameraPosition - vPos);',
			'float fresnel = 0.02 + 0.98 * pow(1.0 - dot(normal, view), 5.0);',
			'vec3 sky = fresnel * u_skyColor;',

			'float diffuse = clamp(dot(normal, normalize(u_sunDirection)), 0.0, 1.0);',
			'vec3 water = (1.0 - fresnel) * u_oceanColor * u_skyColor * diffuse;',

			'vec3 color = sky + water;',

			'gl_FragColor = vec4(hdr(color, u_exposure), 1.0);',
		'}'
	].join( '\n' )
};

// Parallax Occlusion shaders from
//    http://sunandblackcat.com/tipFullView.php?topicid=28
// No tangent-space transforms logic based on
//   http://mmikkelsen3d.blogspot.sk/2012/02/parallaxpoc-mapping-and-no-tangent.html

THREE.ParallaxShader = {
	// Ordered from fastest to best quality.
	modes: {
		none:  'NO_PARALLAX',
		basic: 'USE_BASIC_PARALLAX',
		steep: 'USE_STEEP_PARALLAX',
		occlusion: 'USE_OCLUSION_PARALLAX', // a.k.a. POM
		relief: 'USE_RELIEF_PARALLAX',
	},

	uniforms: {
		"bumpMap": { value: null },
		"map": { value: null },
		"parallaxScale": { value: null },
		"parallaxMinLayers": { value: null },
		"parallaxMaxLayers": { value: null }
	},

	vertexShader: [
		"varying vec2 vUv;",
		"varying vec3 vViewPosition;",
		"varying vec3 vNormal;",

		"void main() {",

			"vUv = uv;",
			"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",
			"vViewPosition = -mvPosition.xyz;",
			"vNormal = normalize( normalMatrix * normal );",
			"gl_Position = projectionMatrix * mvPosition;",

		"}"

  ].join( "\n" ),

	fragmentShader: [
		"uniform sampler2D bumpMap;",
		"uniform sampler2D map;",

		"uniform float parallaxScale;",
		"uniform float parallaxMinLayers;",
		"uniform float parallaxMaxLayers;",

		"varying vec2 vUv;",
		"varying vec3 vViewPosition;",
		"varying vec3 vNormal;",

		"#ifdef USE_BASIC_PARALLAX",

			"vec2 parallaxMap( in vec3 V ) {",

				"float initialHeight = texture2D( bumpMap, vUv ).r;",

				// No Offset Limitting: messy, floating output at grazing angles.
				//"vec2 texCoordOffset = parallaxScale * V.xy / V.z * initialHeight;",

				// Offset Limiting
				"vec2 texCoordOffset = parallaxScale * V.xy * initialHeight;",
				"return vUv - texCoordOffset;",

			"}",

		"#else",

			"vec2 parallaxMap( in vec3 V ) {",

				// Determine number of layers from angle between V and N
				"float numLayers = mix( parallaxMaxLayers, parallaxMinLayers, abs( dot( vec3( 0.0, 0.0, 1.0 ), V ) ) );",

				"float layerHeight = 1.0 / numLayers;",
				"float currentLayerHeight = 0.0;",
				// Shift of texture coordinates for each iteration
				"vec2 dtex = parallaxScale * V.xy / V.z / numLayers;",

				"vec2 currentTextureCoords = vUv;",

				"float heightFromTexture = texture2D( bumpMap, currentTextureCoords ).r;",

				// while ( heightFromTexture > currentLayerHeight )
				// Infinite loops are not well supported. Do a "large" finite
				// loop, but not too large, as it slows down some compilers.
				"for ( int i = 0; i < 30; i += 1 ) {",
					"if ( heightFromTexture <= currentLayerHeight ) {",
						"break;",
					"}",
					"currentLayerHeight += layerHeight;",
					// Shift texture coordinates along vector V
					"currentTextureCoords -= dtex;",
					"heightFromTexture = texture2D( bumpMap, currentTextureCoords ).r;",
				"}",

				"#ifdef USE_STEEP_PARALLAX",

					"return currentTextureCoords;",

				"#elif defined( USE_RELIEF_PARALLAX )",

					"vec2 deltaTexCoord = dtex / 2.0;",
					"float deltaHeight = layerHeight / 2.0;",

					// Return to the mid point of previous layer
					"currentTextureCoords += deltaTexCoord;",
					"currentLayerHeight -= deltaHeight;",

					// Binary search to increase precision of Steep Parallax Mapping
					"const int numSearches = 5;",
					"for ( int i = 0; i < numSearches; i += 1 ) {",

						"deltaTexCoord /= 2.0;",
						"deltaHeight /= 2.0;",
						"heightFromTexture = texture2D( bumpMap, currentTextureCoords ).r;",
						// Shift along or against vector V
						"if( heightFromTexture > currentLayerHeight ) {", // Below the surface

							"currentTextureCoords -= deltaTexCoord;",
							"currentLayerHeight += deltaHeight;",

						"} else {", // above the surface

							"currentTextureCoords += deltaTexCoord;",
							"currentLayerHeight -= deltaHeight;",

						"}",

					"}",
					"return currentTextureCoords;",

				"#elif defined( USE_OCLUSION_PARALLAX )",

					"vec2 prevTCoords = currentTextureCoords + dtex;",

					// Heights for linear interpolation
					"float nextH = heightFromTexture - currentLayerHeight;",
					"float prevH = texture2D( bumpMap, prevTCoords ).r - currentLayerHeight + layerHeight;",

					// Proportions for linear interpolation
					"float weight = nextH / ( nextH - prevH );",

					// Interpolation of texture coordinates
					"return prevTCoords * weight + currentTextureCoords * ( 1.0 - weight );",

				"#else", // NO_PARALLAX

					"return vUv;",

				"#endif",

			"}",
		"#endif",

		"vec2 perturbUv( vec3 surfPosition, vec3 surfNormal, vec3 viewPosition ) {",

 			"vec2 texDx = dFdx( vUv );",
			"vec2 texDy = dFdy( vUv );",

			"vec3 vSigmaX = dFdx( surfPosition );",
			"vec3 vSigmaY = dFdy( surfPosition );",
			"vec3 vR1 = cross( vSigmaY, surfNormal );",
			"vec3 vR2 = cross( surfNormal, vSigmaX );",
			"float fDet = dot( vSigmaX, vR1 );",

			"vec2 vProjVscr = ( 1.0 / fDet ) * vec2( dot( vR1, viewPosition ), dot( vR2, viewPosition ) );",
			"vec3 vProjVtex;",
			"vProjVtex.xy = texDx * vProjVscr.x + texDy * vProjVscr.y;",
			"vProjVtex.z = dot( surfNormal, viewPosition );",

			"return parallaxMap( vProjVtex );",
		"}",

		"void main() {",

			"vec2 mapUv = perturbUv( -vViewPosition, normalize( vNormal ), normalize( vViewPosition ) );",
			"gl_FragColor = texture2D( map, mapUv );",

		"}",

  ].join( "\n" )

};

/**
 * @author felixturner / http://airtight.cc/
 *
 * RGB Shift Shader
 * Shifts red and blue channels from center in opposite directions
 * Ported from http://kriss.cx/tom/2009/05/rgb-shift/
 * by Tom Butterworth / http://kriss.cx/tom/
 *
 * amount: shift distance (1 is width of input)
 * angle: shift angle in radians
 */

THREE.RGBShiftShader = {

	uniforms: {

		"tDiffuse": { value: null },
		"amount":   { value: 0.005 },
		"angle":    { value: 0.0 }

	},

	vertexShader: [

		"varying vec2 vUv;",

		"void main() {",

			"vUv = uv;",
			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join( "\n" ),

	fragmentShader: [

		"uniform sampler2D tDiffuse;",
		"uniform float amount;",
		"uniform float angle;",

		"varying vec2 vUv;",

		"void main() {",

			"vec2 offset = amount * vec2( cos(angle), sin(angle));",
			"vec4 cr = texture2D(tDiffuse, vUv + offset);",
			"vec4 cga = texture2D(tDiffuse, vUv);",
			"vec4 cb = texture2D(tDiffuse, vUv - offset);",
			"gl_FragColor = vec4(cr.r, cga.g, cb.b, cga.a);",

		"}"

	].join( "\n" )

};

/**
 * @author mpk / http://polko.me/
 *
 * WebGL port of Subpixel Morphological Antialiasing (SMAA) v2.8
 * Preset: SMAA 1x Medium (with color edge detection)
 * https://github.com/iryoku/smaa/releases/tag/v2.8
 */

THREE.SMAAShader = [ {

	defines: {

		"SMAA_THRESHOLD": "0.1"

	},

	uniforms: {

		"tDiffuse":		{ value: null },
		"resolution":	{ value: new THREE.Vector2( 1 / 1024, 1 / 512 ) }

	},

	vertexShader: [

		"uniform vec2 resolution;",

		"varying vec2 vUv;",
		"varying vec4 vOffset[ 3 ];",

		"void SMAAEdgeDetectionVS( vec2 texcoord ) {",
			"vOffset[ 0 ] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0,  1.0 );", // WebGL port note: Changed sign in W component
			"vOffset[ 1 ] = texcoord.xyxy + resolution.xyxy * vec4(  1.0, 0.0, 0.0, -1.0 );", // WebGL port note: Changed sign in W component
			"vOffset[ 2 ] = texcoord.xyxy + resolution.xyxy * vec4( -2.0, 0.0, 0.0,  2.0 );", // WebGL port note: Changed sign in W component
		"}",

		"void main() {",

			"vUv = uv;",

			"SMAAEdgeDetectionVS( vUv );",

			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join("\n"),

	fragmentShader: [

		"uniform sampler2D tDiffuse;",

		"varying vec2 vUv;",
		"varying vec4 vOffset[ 3 ];",

		"vec4 SMAAColorEdgeDetectionPS( vec2 texcoord, vec4 offset[3], sampler2D colorTex ) {",
			"vec2 threshold = vec2( SMAA_THRESHOLD, SMAA_THRESHOLD );",

			// Calculate color deltas:
			"vec4 delta;",
			"vec3 C = texture2D( colorTex, texcoord ).rgb;",

			"vec3 Cleft = texture2D( colorTex, offset[0].xy ).rgb;",
			"vec3 t = abs( C - Cleft );",
			"delta.x = max( max( t.r, t.g ), t.b );",

			"vec3 Ctop = texture2D( colorTex, offset[0].zw ).rgb;",
			"t = abs( C - Ctop );",
			"delta.y = max( max( t.r, t.g ), t.b );",

			// We do the usual threshold:
			"vec2 edges = step( threshold, delta.xy );",

			// Then discard if there is no edge:
			"if ( dot( edges, vec2( 1.0, 1.0 ) ) == 0.0 )",
				"discard;",

			// Calculate right and bottom deltas:
			"vec3 Cright = texture2D( colorTex, offset[1].xy ).rgb;",
			"t = abs( C - Cright );",
			"delta.z = max( max( t.r, t.g ), t.b );",

			"vec3 Cbottom  = texture2D( colorTex, offset[1].zw ).rgb;",
			"t = abs( C - Cbottom );",
			"delta.w = max( max( t.r, t.g ), t.b );",

			// Calculate the maximum delta in the direct neighborhood:
			"float maxDelta = max( max( max( delta.x, delta.y ), delta.z ), delta.w );",

			// Calculate left-left and top-top deltas:
			"vec3 Cleftleft  = texture2D( colorTex, offset[2].xy ).rgb;",
			"t = abs( C - Cleftleft );",
			"delta.z = max( max( t.r, t.g ), t.b );",

			"vec3 Ctoptop = texture2D( colorTex, offset[2].zw ).rgb;",
			"t = abs( C - Ctoptop );",
			"delta.w = max( max( t.r, t.g ), t.b );",

			// Calculate the final maximum delta:
			"maxDelta = max( max( maxDelta, delta.z ), delta.w );",

			// Local contrast adaptation in action:
			"edges.xy *= step( 0.5 * maxDelta, delta.xy );",

			"return vec4( edges, 0.0, 0.0 );",
		"}",

		"void main() {",

			"gl_FragColor = SMAAColorEdgeDetectionPS( vUv, vOffset, tDiffuse );",

		"}"

	].join("\n")

}, {

	defines: {

		"SMAA_MAX_SEARCH_STEPS":		"8",
		"SMAA_AREATEX_MAX_DISTANCE":	"16",
		"SMAA_AREATEX_PIXEL_SIZE":		"( 1.0 / vec2( 160.0, 560.0 ) )",
		"SMAA_AREATEX_SUBTEX_SIZE":		"( 1.0 / 7.0 )"

	},

	uniforms: {

		"tDiffuse":		{ value: null },
		"tArea":		{ value: null },
		"tSearch":		{ value: null },
		"resolution":	{ value: new THREE.Vector2( 1 / 1024, 1 / 512 ) }

	},

	vertexShader: [

		"uniform vec2 resolution;",

		"varying vec2 vUv;",
		"varying vec4 vOffset[ 3 ];",
		"varying vec2 vPixcoord;",

		"void SMAABlendingWeightCalculationVS( vec2 texcoord ) {",
			"vPixcoord = texcoord / resolution;",

			// We will use these offsets for the searches later on (see @PSEUDO_GATHER4):
			"vOffset[ 0 ] = texcoord.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );", // WebGL port note: Changed sign in Y and W components
			"vOffset[ 1 ] = texcoord.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );", // WebGL port note: Changed sign in Y and W components

			// And these for the searches, they indicate the ends of the loops:
			"vOffset[ 2 ] = vec4( vOffset[ 0 ].xz, vOffset[ 1 ].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( SMAA_MAX_SEARCH_STEPS );",

		"}",

		"void main() {",

			"vUv = uv;",

			"SMAABlendingWeightCalculationVS( vUv );",

			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join("\n"),

	fragmentShader: [

		"#define SMAASampleLevelZeroOffset( tex, coord, offset ) texture2D( tex, coord + float( offset ) * resolution, 0.0 )",

		"uniform sampler2D tDiffuse;",
		"uniform sampler2D tArea;",
		"uniform sampler2D tSearch;",
		"uniform vec2 resolution;",

		"varying vec2 vUv;",
		"varying vec4 vOffset[3];",
		"varying vec2 vPixcoord;",

		"vec2 round( vec2 x ) {",
			"return sign( x ) * floor( abs( x ) + 0.5 );",
		"}",

		"float SMAASearchLength( sampler2D searchTex, vec2 e, float bias, float scale ) {",
			// Not required if searchTex accesses are set to point:
			// float2 SEARCH_TEX_PIXEL_SIZE = 1.0 / float2(66.0, 33.0);
			// e = float2(bias, 0.0) + 0.5 * SEARCH_TEX_PIXEL_SIZE +
			//     e * float2(scale, 1.0) * float2(64.0, 32.0) * SEARCH_TEX_PIXEL_SIZE;
			"e.r = bias + e.r * scale;",
			"return 255.0 * texture2D( searchTex, e, 0.0 ).r;",
		"}",

		"float SMAASearchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {",
			/**
			* @PSEUDO_GATHER4
			* This texcoord has been offset by (-0.25, -0.125) in the vertex shader to
			* sample between edge, thus fetching four edges in a row.
			* Sampling with different offsets in each direction allows to disambiguate
			* which edges are active from the four fetched ones.
			*/
			"vec2 e = vec2( 0.0, 1.0 );",

			"for ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) {", // WebGL port note: Changed while to for
				"e = texture2D( edgesTex, texcoord, 0.0 ).rg;",
				"texcoord -= vec2( 2.0, 0.0 ) * resolution;",
				"if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;",
			"}",

			// We correct the previous (-0.25, -0.125) offset we applied:
			"texcoord.x += 0.25 * resolution.x;",

			// The searches are bias by 1, so adjust the coords accordingly:
			"texcoord.x += resolution.x;",

			// Disambiguate the length added by the last step:
			"texcoord.x += 2.0 * resolution.x;", // Undo last step
			"texcoord.x -= resolution.x * SMAASearchLength(searchTex, e, 0.0, 0.5);",

			"return texcoord.x;",
		"}",

		"float SMAASearchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {",
			"vec2 e = vec2( 0.0, 1.0 );",

			"for ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) {", // WebGL port note: Changed while to for
				"e = texture2D( edgesTex, texcoord, 0.0 ).rg;",
				"texcoord += vec2( 2.0, 0.0 ) * resolution;",
				"if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;",
			"}",

			"texcoord.x -= 0.25 * resolution.x;",
			"texcoord.x -= resolution.x;",
			"texcoord.x -= 2.0 * resolution.x;",
			"texcoord.x += resolution.x * SMAASearchLength( searchTex, e, 0.5, 0.5 );",

			"return texcoord.x;",
		"}",

		"float SMAASearchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {",
			"vec2 e = vec2( 1.0, 0.0 );",

			"for ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) {", // WebGL port note: Changed while to for
				"e = texture2D( edgesTex, texcoord, 0.0 ).rg;",
				"texcoord += vec2( 0.0, 2.0 ) * resolution;", // WebGL port note: Changed sign
				"if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;",
			"}",

			"texcoord.y -= 0.25 * resolution.y;", // WebGL port note: Changed sign
			"texcoord.y -= resolution.y;", // WebGL port note: Changed sign
			"texcoord.y -= 2.0 * resolution.y;", // WebGL port note: Changed sign
			"texcoord.y += resolution.y * SMAASearchLength( searchTex, e.gr, 0.0, 0.5 );", // WebGL port note: Changed sign

			"return texcoord.y;",
		"}",

		"float SMAASearchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {",
			"vec2 e = vec2( 1.0, 0.0 );",

			"for ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) {", // WebGL port note: Changed while to for
				"e = texture2D( edgesTex, texcoord, 0.0 ).rg;",
				"texcoord -= vec2( 0.0, 2.0 ) * resolution;", // WebGL port note: Changed sign
				"if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;",
			"}",

			"texcoord.y += 0.25 * resolution.y;", // WebGL port note: Changed sign
			"texcoord.y += resolution.y;", // WebGL port note: Changed sign
			"texcoord.y += 2.0 * resolution.y;", // WebGL port note: Changed sign
			"texcoord.y -= resolution.y * SMAASearchLength( searchTex, e.gr, 0.5, 0.5 );", // WebGL port note: Changed sign

			"return texcoord.y;",
		"}",

		"vec2 SMAAArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {",
			// Rounding prevents precision errors of bilinear filtering:
			"vec2 texcoord = float( SMAA_AREATEX_MAX_DISTANCE ) * round( 4.0 * vec2( e1, e2 ) ) + dist;",

			// We do a scale and bias for mapping to texel space:
			"texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );",

			// Move to proper place, according to the subpixel offset:
			"texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;",

			"return texture2D( areaTex, texcoord, 0.0 ).rg;",
		"}",

		"vec4 SMAABlendingWeightCalculationPS( vec2 texcoord, vec2 pixcoord, vec4 offset[ 3 ], sampler2D edgesTex, sampler2D areaTex, sampler2D searchTex, ivec4 subsampleIndices ) {",
			"vec4 weights = vec4( 0.0, 0.0, 0.0, 0.0 );",

			"vec2 e = texture2D( edgesTex, texcoord ).rg;",

			"if ( e.g > 0.0 ) {", // Edge at north
				"vec2 d;",

				// Find the distance to the left:
				"vec2 coords;",
				"coords.x = SMAASearchXLeft( edgesTex, searchTex, offset[ 0 ].xy, offset[ 2 ].x );",
				"coords.y = offset[ 1 ].y;", // offset[1].y = texcoord.y - 0.25 * resolution.y (@CROSSING_OFFSET)
				"d.x = coords.x;",

				// Now fetch the left crossing edges, two at a time using bilinear
				// filtering. Sampling at -0.25 (see @CROSSING_OFFSET) enables to
				// discern what value each edge has:
				"float e1 = texture2D( edgesTex, coords, 0.0 ).r;",

				// Find the distance to the right:
				"coords.x = SMAASearchXRight( edgesTex, searchTex, offset[ 0 ].zw, offset[ 2 ].y );",
				"d.y = coords.x;",

				// We want the distances to be in pixel units (doing this here allow to
				// better interleave arithmetic and memory accesses):
				"d = d / resolution.x - pixcoord.x;",

				// SMAAArea below needs a sqrt, as the areas texture is compressed
				// quadratically:
				"vec2 sqrt_d = sqrt( abs( d ) );",

				// Fetch the right crossing edges:
				"coords.y -= 1.0 * resolution.y;", // WebGL port note: Added
				"float e2 = SMAASampleLevelZeroOffset( edgesTex, coords, ivec2( 1, 0 ) ).r;",

				// Ok, we know how this pattern looks like, now it is time for getting
				// the actual area:
				"weights.rg = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.y ) );",
			"}",

			"if ( e.r > 0.0 ) {", // Edge at west
				"vec2 d;",

				// Find the distance to the top:
				"vec2 coords;",

				"coords.y = SMAASearchYUp( edgesTex, searchTex, offset[ 1 ].xy, offset[ 2 ].z );",
				"coords.x = offset[ 0 ].x;", // offset[1].x = texcoord.x - 0.25 * resolution.x;
				"d.x = coords.y;",

				// Fetch the top crossing edges:
				"float e1 = texture2D( edgesTex, coords, 0.0 ).g;",

				// Find the distance to the bottom:
				"coords.y = SMAASearchYDown( edgesTex, searchTex, offset[ 1 ].zw, offset[ 2 ].w );",
				"d.y = coords.y;",

				// We want the distances to be in pixel units:
				"d = d / resolution.y - pixcoord.y;",

				// SMAAArea below needs a sqrt, as the areas texture is compressed
				// quadratically:
				"vec2 sqrt_d = sqrt( abs( d ) );",

				// Fetch the bottom crossing edges:
				"coords.y -= 1.0 * resolution.y;", // WebGL port note: Added
				"float e2 = SMAASampleLevelZeroOffset( edgesTex, coords, ivec2( 0, 1 ) ).g;",

				// Get the area for this direction:
				"weights.ba = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.x ) );",
			"}",

			"return weights;",
		"}",

		"void main() {",

			"gl_FragColor = SMAABlendingWeightCalculationPS( vUv, vPixcoord, vOffset, tDiffuse, tArea, tSearch, ivec4( 0.0 ) );",

		"}"

	].join("\n")

}, {

	uniforms: {

		"tDiffuse":		{ value: null },
		"tColor":		{ value: null },
		"resolution":	{ value: new THREE.Vector2( 1 / 1024, 1 / 512 ) }

	},

	vertexShader: [

		"uniform vec2 resolution;",

		"varying vec2 vUv;",
		"varying vec4 vOffset[ 2 ];",

		"void SMAANeighborhoodBlendingVS( vec2 texcoord ) {",
			"vOffset[ 0 ] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0, 1.0 );", // WebGL port note: Changed sign in W component
			"vOffset[ 1 ] = texcoord.xyxy + resolution.xyxy * vec4( 1.0, 0.0, 0.0, -1.0 );", // WebGL port note: Changed sign in W component
		"}",

		"void main() {",

			"vUv = uv;",

			"SMAANeighborhoodBlendingVS( vUv );",

			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join("\n"),

	fragmentShader: [

		"uniform sampler2D tDiffuse;",
		"uniform sampler2D tColor;",
		"uniform vec2 resolution;",

		"varying vec2 vUv;",
		"varying vec4 vOffset[ 2 ];",

		"vec4 SMAANeighborhoodBlendingPS( vec2 texcoord, vec4 offset[ 2 ], sampler2D colorTex, sampler2D blendTex ) {",
			// Fetch the blending weights for current pixel:
			"vec4 a;",
			"a.xz = texture2D( blendTex, texcoord ).xz;",
			"a.y = texture2D( blendTex, offset[ 1 ].zw ).g;",
			"a.w = texture2D( blendTex, offset[ 1 ].xy ).a;",

			// Is there any blending weight with a value greater than 0.0?
			"if ( dot(a, vec4( 1.0, 1.0, 1.0, 1.0 )) < 1e-5 ) {",
				"return texture2D( colorTex, texcoord, 0.0 );",
			"} else {",
				// Up to 4 lines can be crossing a pixel (one through each edge). We
				// favor blending by choosing the line with the maximum weight for each
				// direction:
				"vec2 offset;",
				"offset.x = a.a > a.b ? a.a : -a.b;", // left vs. right
				"offset.y = a.g > a.r ? -a.g : a.r;", // top vs. bottom // WebGL port note: Changed signs

				// Then we go in the direction that has the maximum weight:
				"if ( abs( offset.x ) > abs( offset.y )) {", // horizontal vs. vertical
					"offset.y = 0.0;",
				"} else {",
					"offset.x = 0.0;",
				"}",

				// Fetch the opposite color and lerp by hand:
				"vec4 C = texture2D( colorTex, texcoord, 0.0 );",
				"texcoord += sign( offset ) * resolution;",
				"vec4 Cop = texture2D( colorTex, texcoord, 0.0 );",
				"float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );",

				// WebGL port note: Added gamma correction
				"C.xyz = pow(C.xyz, vec3(2.2));",
				"Cop.xyz = pow(Cop.xyz, vec3(2.2));",
				"vec4 mixed = mix(C, Cop, s);",
				"mixed.xyz = pow(mixed.xyz, vec3(1.0 / 2.2));",

				"return mixed;",
			"}",
		"}",

		"void main() {",

			"gl_FragColor = SMAANeighborhoodBlendingPS( vUv, vOffset, tColor, tDiffuse );",

		"}"

	].join("\n")

} ];

/**
 * @author alteredq / http://alteredqualia.com/
 *
 * Screen-space ambient occlusion shader
 * - ported from
 *   SSAO GLSL shader v1.2
 *   assembled by Martins Upitis (martinsh) (http://devlog-martinsh.blogspot.com)
 *   original technique is made by ArKano22 (http://www.gamedev.net/topic/550699-ssao-no-halo-artifacts/)
 * - modifications
 * - modified to use RGBA packed depth texture (use clear color 1,1,1,1 for depth pass)
 * - refactoring and optimizations
 */

THREE.SSAOShader = {

	uniforms: {

		"tDiffuse":     { value: null },
		"tDepth":       { value: null },
		"size":         { value: new THREE.Vector2( 512, 512 ) },
		"cameraNear":   { value: 1 },
		"cameraFar":    { value: 100 },
		"onlyAO":       { value: 0 },
		"aoClamp":      { value: 0.5 },
		"lumInfluence": { value: 0.5 }

	},

	vertexShader: [

		"varying vec2 vUv;",

		"void main() {",

			"vUv = uv;",

			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join( "\n" ),

	fragmentShader: [

		"uniform float cameraNear;",
		"uniform float cameraFar;",

		"uniform bool onlyAO;",      // use only ambient occlusion pass?

		"uniform vec2 size;",        // texture width, height
		"uniform float aoClamp;",    // depth clamp - reduces haloing at screen edges

		"uniform float lumInfluence;",  // how much luminance affects occlusion

		"uniform sampler2D tDiffuse;",
		"uniform sampler2D tDepth;",

		"varying vec2 vUv;",

		// "#define PI 3.14159265",
		"#define DL 2.399963229728653",  // PI * ( 3.0 - sqrt( 5.0 ) )
		"#define EULER 2.718281828459045",

		// user variables

		"const int samples = 8;",     // ao sample count
		"const float radius = 5.0;",  // ao radius

		"const bool useNoise = false;",      // use noise instead of pattern for sample dithering
		"const float noiseAmount = 0.0003;", // dithering amount

		"const float diffArea = 0.4;",   // self-shadowing reduction
		"const float gDisplace = 0.4;",  // gauss bell center


		// RGBA depth

		"#include <packing>",

		// generating noise / pattern texture for dithering

		"vec2 rand( const vec2 coord ) {",

			"vec2 noise;",

			"if ( useNoise ) {",

				"float nx = dot ( coord, vec2( 12.9898, 78.233 ) );",
				"float ny = dot ( coord, vec2( 12.9898, 78.233 ) * 2.0 );",

				"noise = clamp( fract ( 43758.5453 * sin( vec2( nx, ny ) ) ), 0.0, 1.0 );",

			"} else {",

				"float ff = fract( 1.0 - coord.s * ( size.x / 2.0 ) );",
				"float gg = fract( coord.t * ( size.y / 2.0 ) );",

				"noise = vec2( 0.25, 0.75 ) * vec2( ff ) + vec2( 0.75, 0.25 ) * gg;",

			"}",

			"return ( noise * 2.0  - 1.0 ) * noiseAmount;",

		"}",

		"float readDepth( const in vec2 coord ) {",

			"float cameraFarPlusNear = cameraFar + cameraNear;",
			"float cameraFarMinusNear = cameraFar - cameraNear;",
			"float cameraCoef = 2.0 * cameraNear;",

			// "return ( 2.0 * cameraNear ) / ( cameraFar + cameraNear - unpackDepth( texture2D( tDepth, coord ) ) * ( cameraFar - cameraNear ) );",
			"return cameraCoef / ( cameraFarPlusNear - unpackRGBAToDepth( texture2D( tDepth, coord ) ) * cameraFarMinusNear );",


		"}",

		"float compareDepths( const in float depth1, const in float depth2, inout int far ) {",

			"float garea = 2.0;",                         // gauss bell width
			"float diff = ( depth1 - depth2 ) * 100.0;",  // depth difference (0-100)

			// reduce left bell width to avoid self-shadowing

			"if ( diff < gDisplace ) {",

				"garea = diffArea;",

			"} else {",

				"far = 1;",

			"}",

			"float dd = diff - gDisplace;",
			"float gauss = pow( EULER, -2.0 * dd * dd / ( garea * garea ) );",
			"return gauss;",

		"}",

		"float calcAO( float depth, float dw, float dh ) {",

			"float dd = radius - depth * radius;",
			"vec2 vv = vec2( dw, dh );",

			"vec2 coord1 = vUv + dd * vv;",
			"vec2 coord2 = vUv - dd * vv;",

			"float temp1 = 0.0;",
			"float temp2 = 0.0;",

			"int far = 0;",
			"temp1 = compareDepths( depth, readDepth( coord1 ), far );",

			// DEPTH EXTRAPOLATION

			"if ( far > 0 ) {",

				"temp2 = compareDepths( readDepth( coord2 ), depth, far );",
				"temp1 += ( 1.0 - temp1 ) * temp2;",

			"}",

			"return temp1;",

		"}",

		"void main() {",

			"vec2 noise = rand( vUv );",
			"float depth = readDepth( vUv );",

			"float tt = clamp( depth, aoClamp, 1.0 );",

			"float w = ( 1.0 / size.x )  / tt + ( noise.x * ( 1.0 - noise.x ) );",
			"float h = ( 1.0 / size.y ) / tt + ( noise.y * ( 1.0 - noise.y ) );",

			"float ao = 0.0;",

			"float dz = 1.0 / float( samples );",
			"float z = 1.0 - dz / 2.0;",
			"float l = 0.0;",

			"for ( int i = 0; i <= samples; i ++ ) {",

				"float r = sqrt( 1.0 - z );",

				"float pw = cos( l ) * r;",
				"float ph = sin( l ) * r;",
				"ao += calcAO( depth, pw * w, ph * h );",
				"z = z - dz;",
				"l = l + DL;",

			"}",

			"ao /= float( samples );",
			"ao = 1.0 - ao;",

			"vec3 color = texture2D( tDiffuse, vUv ).rgb;",

			"vec3 lumcoeff = vec3( 0.299, 0.587, 0.114 );",
			"float lum = dot( color.rgb, lumcoeff );",
			"vec3 luminance = vec3( lum );",

			"vec3 final = vec3( color * mix( vec3( ao ), vec3( 1.0 ), luminance * lumInfluence ) );",  // mix( color * ao, white, luminance )

			"if ( onlyAO ) {",

				"final = vec3( mix( vec3( ao ), vec3( 1.0 ), luminance * lumInfluence ) );",  // ambient occlusion only

			"}",

			"gl_FragColor = vec4( final, 1.0 );",

		"}"

	].join( "\n" )

};

/**
 * @author alteredq / http://alteredqualia.com/
 *
 * Sepia tone shader
 * based on glfx.js sepia shader
 * https://github.com/evanw/glfx.js
 */

THREE.SepiaShader = {

	uniforms: {

		"tDiffuse": { value: null },
		"amount":   { value: 1.0 }

	},

	vertexShader: [

		"varying vec2 vUv;",

		"void main() {",

			"vUv = uv;",
			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join( "\n" ),

	fragmentShader: [

		"uniform float amount;",

		"uniform sampler2D tDiffuse;",

		"varying vec2 vUv;",

		"void main() {",

			"vec4 color = texture2D( tDiffuse, vUv );",
			"vec3 c = color.rgb;",

			"color.r = dot( c, vec3( 1.0 - 0.607 * amount, 0.769 * amount, 0.189 * amount ) );",
			"color.g = dot( c, vec3( 0.349 * amount, 1.0 - 0.314 * amount, 0.168 * amount ) );",
			"color.b = dot( c, vec3( 0.272 * amount, 0.534 * amount, 1.0 - 0.869 * amount ) );",

			"gl_FragColor = vec4( min( vec3( 1.0 ), color.rgb ), color.a );",

		"}"

	].join( "\n" )

};

/**
 * @author flimshaw / http://charliehoey.com
 *
 * Technicolor Shader
 * Simulates the look of the two-strip technicolor process popular in early 20th century films.
 * More historical info here: http://www.widescreenmuseum.com/oldcolor/technicolor1.htm
 * Demo here: http://charliehoey.com/technicolor_shader/shader_test.html
 */

THREE.TechnicolorShader = {

	uniforms: {

		"tDiffuse": { value: null },

	},

	vertexShader: [

		"varying vec2 vUv;",

		"void main() {",

			"vUv = uv;",
			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join( "\n" ),

	fragmentShader: [

		"uniform sampler2D tDiffuse;",
		"varying vec2 vUv;",

		"void main() {",

			"vec4 tex = texture2D( tDiffuse, vec2( vUv.x, vUv.y ) );",
			"vec4 newTex = vec4(tex.r, (tex.g + tex.b) * .5, (tex.g + tex.b) * .5, 1.0);",

			"gl_FragColor = newTex;",

		"}"

	].join( "\n" )

};

/**
 * @author miibond
 *
 * Full-screen tone-mapping shader based on http://www.graphics.cornell.edu/~jaf/publications/sig02_paper.pdf
 */

THREE.ToneMapShader = {

	uniforms: {

		"tDiffuse": { value: null },
		"averageLuminance":  { value: 1.0 },
		"luminanceMap":  { value: null },
		"maxLuminance":  { value: 16.0 },
		"middleGrey":  { value: 0.6 }
	},

	vertexShader: [

		"varying vec2 vUv;",

		"void main() {",

			"vUv = uv;",
			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join( "\n" ),

	fragmentShader: [

		"uniform sampler2D tDiffuse;",

		"varying vec2 vUv;",

		"uniform float middleGrey;",
		"uniform float maxLuminance;",
		"#ifdef ADAPTED_LUMINANCE",
			"uniform sampler2D luminanceMap;",
		"#else",
			"uniform float averageLuminance;",
		"#endif",
		
		"const vec3 LUM_CONVERT = vec3(0.299, 0.587, 0.114);",

		"vec3 ToneMap( vec3 vColor ) {",
			"#ifdef ADAPTED_LUMINANCE",
				// Get the calculated average luminance 
				"float fLumAvg = texture2D(luminanceMap, vec2(0.5, 0.5)).r;",
			"#else",
				"float fLumAvg = averageLuminance;",
			"#endif",
			
			// Calculate the luminance of the current pixel
			"float fLumPixel = dot(vColor, LUM_CONVERT);",

			// Apply the modified operator (Eq. 4)
			"float fLumScaled = (fLumPixel * middleGrey) / fLumAvg;",

			"float fLumCompressed = (fLumScaled * (1.0 + (fLumScaled / (maxLuminance * maxLuminance)))) / (1.0 + fLumScaled);",
			"return fLumCompressed * vColor;",
		"}",

		"void main() {",

			"vec4 texel = texture2D( tDiffuse, vUv );",
			
			"gl_FragColor = vec4( ToneMap( texel.xyz ), texel.w );",

		"}"

	].join( "\n" )

};

/**
 * @author zz85 / http://www.lab4games.net/zz85/blog
 *
 * Triangle blur shader
 * based on glfx.js triangle blur shader
 * https://github.com/evanw/glfx.js
 *
 * A basic blur filter, which convolves the image with a
 * pyramid filter. The pyramid filter is separable and is applied as two
 * perpendicular triangle filters.
 */

THREE.TriangleBlurShader = {

	uniforms : {

		"texture": { value: null },
		"delta":   { value: new THREE.Vector2( 1, 1 ) }

	},

	vertexShader: [

		"varying vec2 vUv;",

		"void main() {",

			"vUv = uv;",
			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join( "\n" ),

	fragmentShader: [

		"#include <common>",

		"#define ITERATIONS 10.0",

		"uniform sampler2D texture;",
		"uniform vec2 delta;",

		"varying vec2 vUv;",

		"void main() {",

			"vec4 color = vec4( 0.0 );",

			"float total = 0.0;",

			// randomize the lookup values to hide the fixed number of samples

			"float offset = rand( vUv );",

			"for ( float t = -ITERATIONS; t <= ITERATIONS; t ++ ) {",

				"float percent = ( t + offset - 0.5 ) / ITERATIONS;",
				"float weight = 1.0 - abs( percent );",

				"color += texture2D( texture, vUv + delta * percent ) * weight;",
				"total += weight;",

			"}",

			"gl_FragColor = color / total;",

		"}"

	].join( "\n" )

};

/**
 * @author alteredq / http://alteredqualia.com/
 *
 * Unpack RGBA depth shader
 * - show RGBA encoded depth as monochrome color
 */

THREE.UnpackDepthRGBAShader = {

	uniforms: {

		"tDiffuse": { value: null },
		"opacity":  { value: 1.0 }

	},

	vertexShader: [

		"varying vec2 vUv;",

		"void main() {",

			"vUv = uv;",
			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join( "\n" ),

	fragmentShader: [

		"uniform float opacity;",

		"uniform sampler2D tDiffuse;",

		"varying vec2 vUv;",

		"#include <packing>",

		"void main() {",

			"float depth = 1.0 - unpackRGBAToDepth( texture2D( tDiffuse, vUv ) );",
			"gl_FragColor = opacity * vec4( vec3( depth ), 1.0 );",

		"}"

	].join( "\n" )

};

/**
 * @author zz85 / http://www.lab4games.net/zz85/blog
 *
 * Two pass Gaussian blur filter (horizontal and vertical blur shaders)
 * - described in http://www.gamerendering.com/2008/10/11/gaussian-blur-filter-shader/
 *   and used in http://www.cake23.de/traveling-wavefronts-lit-up.html
 *
 * - 9 samples per pass
 * - standard deviation 2.7
 * - "h" and "v" parameters should be set to "1 / width" and "1 / height"
 */

THREE.VerticalBlurShader = {

	uniforms: {

		"tDiffuse": { value: null },
		"v":        { value: 1.0 / 512.0 }

	},

	vertexShader: [

		"varying vec2 vUv;",

		"void main() {",

			"vUv = uv;",
			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join( "\n" ),

	fragmentShader: [

		"uniform sampler2D tDiffuse;",
		"uniform float v;",

		"varying vec2 vUv;",

		"void main() {",

			"vec4 sum = vec4( 0.0 );",

			"sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;",
			"sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;",
			"sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;",
			"sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;",
			"sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;",
			"sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;",
			"sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;",
			"sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;",
			"sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;",

			"gl_FragColor = sum;",

		"}"

	].join( "\n" )

};

/**
 * @author alteredq / http://alteredqualia.com/
 *
 * Simple fake tilt-shift effect, modulating two pass Gaussian blur (see above) by vertical position
 *
 * - 9 samples per pass
 * - standard deviation 2.7
 * - "h" and "v" parameters should be set to "1 / width" and "1 / height"
 * - "r" parameter control where "focused" horizontal line lies
 */

THREE.VerticalTiltShiftShader = {

	uniforms: {

		"tDiffuse": { value: null },
		"v":        { value: 1.0 / 512.0 },
		"r":        { value: 0.35 }

	},

	vertexShader: [

		"varying vec2 vUv;",

		"void main() {",

			"vUv = uv;",
			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join( "\n" ),

	fragmentShader: [

		"uniform sampler2D tDiffuse;",
		"uniform float v;",
		"uniform float r;",

		"varying vec2 vUv;",

		"void main() {",

			"vec4 sum = vec4( 0.0 );",

			"float vv = v * abs( r - vUv.y );",

			"sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * vv ) ) * 0.051;",
			"sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * vv ) ) * 0.0918;",
			"sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * vv ) ) * 0.12245;",
			"sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * vv ) ) * 0.1531;",
			"sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;",
			"sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * vv ) ) * 0.1531;",
			"sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * vv ) ) * 0.12245;",
			"sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * vv ) ) * 0.0918;",
			"sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * vv ) ) * 0.051;",

			"gl_FragColor = sum;",

		"}"

	].join( "\n" )

};

/**
 * @author alteredq / http://alteredqualia.com/
 *
 * Vignette shader
 * based on PaintEffect postprocess from ro.me
 * http://code.google.com/p/3-dreams-of-black/source/browse/deploy/js/effects/PaintEffect.js
 */

THREE.VignetteShader = {

	uniforms: {

		"tDiffuse": { value: null },
		"offset":   { value: 1.0 },
		"darkness": { value: 1.0 }

	},

	vertexShader: [

		"varying vec2 vUv;",

		"void main() {",

			"vUv = uv;",
			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join( "\n" ),

	fragmentShader: [

		"uniform float offset;",
		"uniform float darkness;",

		"uniform sampler2D tDiffuse;",

		"varying vec2 vUv;",

		"void main() {",

			// Eskil's vignette

			"vec4 texel = texture2D( tDiffuse, vUv );",
			"vec2 uv = ( vUv - vec2( 0.5 ) ) * vec2( offset );",
			"gl_FragColor = vec4( mix( texel.rgb, vec3( 1.0 - darkness ), dot( uv, uv ) ), texel.a );",

			/*
			// alternative version from glfx.js
			// this one makes more "dusty" look (as opposed to "burned")

			"vec4 color = texture2D( tDiffuse, vUv );",
			"float dist = distance( vUv, vec2( 0.5 ) );",
			"color.rgb *= smoothstep( 0.8, offset * 0.799, dist *( darkness + offset ) );",
			"gl_FragColor = color;",
			*/

		"}"

	].join( "\n" )

};

/*! Hammer.JS - v2.0.6 - 2016-02-25
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the  license */
!function(a,b,c,d){"use strict";function e(a,b,c){return setTimeout(j(a,c),b)}function f(a,b,c){return Array.isArray(a)?(g(a,c[b],c),!0):!1}function g(a,b,c){var e;if(a)if(a.forEach)a.forEach(b,c);else if(a.length!==d)for(e=0;e<a.length;)b.call(c,a[e],e,a),e++;else for(e in a)a.hasOwnProperty(e)&&b.call(c,a[e],e,a)}function h(b,c,d){var e="DEPRECATED METHOD: "+c+"\n"+d+" AT \n";return function(){var c=new Error("get-stack-trace"),d=c&&c.stack?c.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",f=a.console&&(a.console.warn||a.console.log);return f&&f.call(a.console,e,d),b.apply(this,arguments)}}function i(a,b,c){var d,e=b.prototype;d=a.prototype=Object.create(e),d.constructor=a,d._super=e,c&&ha(d,c)}function j(a,b){return function(){return a.apply(b,arguments)}}function k(a,b){return typeof a==ka?a.apply(b?b[0]||d:d,b):a}function l(a,b){return a===d?b:a}function m(a,b,c){g(q(b),function(b){a.addEventListener(b,c,!1)})}function n(a,b,c){g(q(b),function(b){a.removeEventListener(b,c,!1)})}function o(a,b){for(;a;){if(a==b)return!0;a=a.parentNode}return!1}function p(a,b){return a.indexOf(b)>-1}function q(a){return a.trim().split(/\s+/g)}function r(a,b,c){if(a.indexOf&&!c)return a.indexOf(b);for(var d=0;d<a.length;){if(c&&a[d][c]==b||!c&&a[d]===b)return d;d++}return-1}function s(a){return Array.prototype.slice.call(a,0)}function t(a,b,c){for(var d=[],e=[],f=0;f<a.length;){var g=b?a[f][b]:a[f];r(e,g)<0&&d.push(a[f]),e[f]=g,f++}return c&&(d=b?d.sort(function(a,c){return a[b]>c[b]}):d.sort()),d}function u(a,b){for(var c,e,f=b[0].toUpperCase()+b.slice(1),g=0;g<ia.length;){if(c=ia[g],e=c?c+f:b,e in a)return e;g++}return d}function v(){return qa++}function w(b){var c=b.ownerDocument||b;return c.defaultView||c.parentWindow||a}function x(a,b){var c=this;this.manager=a,this.callback=b,this.element=a.element,this.target=a.options.inputTarget,this.domHandler=function(b){k(a.options.enable,[a])&&c.handler(b)},this.init()}function y(a){var b,c=a.options.inputClass;return new(b=c?c:ta?M:ua?P:sa?R:L)(a,z)}function z(a,b,c){var d=c.pointers.length,e=c.changedPointers.length,f=b&Aa&&d-e===0,g=b&(Ca|Da)&&d-e===0;c.isFirst=!!f,c.isFinal=!!g,f&&(a.session={}),c.eventType=b,A(a,c),a.emit("hammer.input",c),a.recognize(c),a.session.prevInput=c}function A(a,b){var c=a.session,d=b.pointers,e=d.length;c.firstInput||(c.firstInput=D(b)),e>1&&!c.firstMultiple?c.firstMultiple=D(b):1===e&&(c.firstMultiple=!1);var f=c.firstInput,g=c.firstMultiple,h=g?g.center:f.center,i=b.center=E(d);b.timeStamp=na(),b.deltaTime=b.timeStamp-f.timeStamp,b.angle=I(h,i),b.distance=H(h,i),B(c,b),b.offsetDirection=G(b.deltaX,b.deltaY);var j=F(b.deltaTime,b.deltaX,b.deltaY);b.overallVelocityX=j.x,b.overallVelocityY=j.y,b.overallVelocity=ma(j.x)>ma(j.y)?j.x:j.y,b.scale=g?K(g.pointers,d):1,b.rotation=g?J(g.pointers,d):0,b.maxPointers=c.prevInput?b.pointers.length>c.prevInput.maxPointers?b.pointers.length:c.prevInput.maxPointers:b.pointers.length,C(c,b);var k=a.element;o(b.srcEvent.target,k)&&(k=b.srcEvent.target),b.target=k}function B(a,b){var c=b.center,d=a.offsetDelta||{},e=a.prevDelta||{},f=a.prevInput||{};b.eventType!==Aa&&f.eventType!==Ca||(e=a.prevDelta={x:f.deltaX||0,y:f.deltaY||0},d=a.offsetDelta={x:c.x,y:c.y}),b.deltaX=e.x+(c.x-d.x),b.deltaY=e.y+(c.y-d.y)}function C(a,b){var c,e,f,g,h=a.lastInterval||b,i=b.timeStamp-h.timeStamp;if(b.eventType!=Da&&(i>za||h.velocity===d)){var j=b.deltaX-h.deltaX,k=b.deltaY-h.deltaY,l=F(i,j,k);e=l.x,f=l.y,c=ma(l.x)>ma(l.y)?l.x:l.y,g=G(j,k),a.lastInterval=b}else c=h.velocity,e=h.velocityX,f=h.velocityY,g=h.direction;b.velocity=c,b.velocityX=e,b.velocityY=f,b.direction=g}function D(a){for(var b=[],c=0;c<a.pointers.length;)b[c]={clientX:la(a.pointers[c].clientX),clientY:la(a.pointers[c].clientY)},c++;return{timeStamp:na(),pointers:b,center:E(b),deltaX:a.deltaX,deltaY:a.deltaY}}function E(a){var b=a.length;if(1===b)return{x:la(a[0].clientX),y:la(a[0].clientY)};for(var c=0,d=0,e=0;b>e;)c+=a[e].clientX,d+=a[e].clientY,e++;return{x:la(c/b),y:la(d/b)}}function F(a,b,c){return{x:b/a||0,y:c/a||0}}function G(a,b){return a===b?Ea:ma(a)>=ma(b)?0>a?Fa:Ga:0>b?Ha:Ia}function H(a,b,c){c||(c=Ma);var d=b[c[0]]-a[c[0]],e=b[c[1]]-a[c[1]];return Math.sqrt(d*d+e*e)}function I(a,b,c){c||(c=Ma);var d=b[c[0]]-a[c[0]],e=b[c[1]]-a[c[1]];return 180*Math.atan2(e,d)/Math.PI}function J(a,b){return I(b[1],b[0],Na)+I(a[1],a[0],Na)}function K(a,b){return H(b[0],b[1],Na)/H(a[0],a[1],Na)}function L(){this.evEl=Pa,this.evWin=Qa,this.allow=!0,this.pressed=!1,x.apply(this,arguments)}function M(){this.evEl=Ta,this.evWin=Ua,x.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}function N(){this.evTarget=Wa,this.evWin=Xa,this.started=!1,x.apply(this,arguments)}function O(a,b){var c=s(a.touches),d=s(a.changedTouches);return b&(Ca|Da)&&(c=t(c.concat(d),"identifier",!0)),[c,d]}function P(){this.evTarget=Za,this.targetIds={},x.apply(this,arguments)}function Q(a,b){var c=s(a.touches),d=this.targetIds;if(b&(Aa|Ba)&&1===c.length)return d[c[0].identifier]=!0,[c,c];var e,f,g=s(a.changedTouches),h=[],i=this.target;if(f=c.filter(function(a){return o(a.target,i)}),b===Aa)for(e=0;e<f.length;)d[f[e].identifier]=!0,e++;for(e=0;e<g.length;)d[g[e].identifier]&&h.push(g[e]),b&(Ca|Da)&&delete d[g[e].identifier],e++;return h.length?[t(f.concat(h),"identifier",!0),h]:void 0}function R(){x.apply(this,arguments);var a=j(this.handler,this);this.touch=new P(this.manager,a),this.mouse=new L(this.manager,a)}function S(a,b){this.manager=a,this.set(b)}function T(a){if(p(a,db))return db;var b=p(a,eb),c=p(a,fb);return b&&c?db:b||c?b?eb:fb:p(a,cb)?cb:bb}function U(a){this.options=ha({},this.defaults,a||{}),this.id=v(),this.manager=null,this.options.enable=l(this.options.enable,!0),this.state=gb,this.simultaneous={},this.requireFail=[]}function V(a){return a&lb?"cancel":a&jb?"end":a&ib?"move":a&hb?"start":""}function W(a){return a==Ia?"down":a==Ha?"up":a==Fa?"left":a==Ga?"right":""}function X(a,b){var c=b.manager;return c?c.get(a):a}function Y(){U.apply(this,arguments)}function Z(){Y.apply(this,arguments),this.pX=null,this.pY=null}function $(){Y.apply(this,arguments)}function _(){U.apply(this,arguments),this._timer=null,this._input=null}function aa(){Y.apply(this,arguments)}function ba(){Y.apply(this,arguments)}function ca(){U.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function da(a,b){return b=b||{},b.recognizers=l(b.recognizers,da.defaults.preset),new ea(a,b)}function ea(a,b){this.options=ha({},da.defaults,b||{}),this.options.inputTarget=this.options.inputTarget||a,this.handlers={},this.session={},this.recognizers=[],this.element=a,this.input=y(this),this.touchAction=new S(this,this.options.touchAction),fa(this,!0),g(this.options.recognizers,function(a){var b=this.add(new a[0](a[1]));a[2]&&b.recognizeWith(a[2]),a[3]&&b.requireFailure(a[3])},this)}function fa(a,b){var c=a.element;c.style&&g(a.options.cssProps,function(a,d){c.style[u(c.style,d)]=b?a:""})}function ga(a,c){var d=b.createEvent("Event");d.initEvent(a,!0,!0),d.gesture=c,c.target.dispatchEvent(d)}var ha,ia=["","webkit","Moz","MS","ms","o"],ja=b.createElement("div"),ka="function",la=Math.round,ma=Math.abs,na=Date.now;ha="function"!=typeof Object.assign?function(a){if(a===d||null===a)throw new TypeError("Cannot convert undefined or null to object");for(var b=Object(a),c=1;c<arguments.length;c++){var e=arguments[c];if(e!==d&&null!==e)for(var f in e)e.hasOwnProperty(f)&&(b[f]=e[f])}return b}:Object.assign;var oa=h(function(a,b,c){for(var e=Object.keys(b),f=0;f<e.length;)(!c||c&&a[e[f]]===d)&&(a[e[f]]=b[e[f]]),f++;return a},"extend","Use `assign`."),pa=h(function(a,b){return oa(a,b,!0)},"merge","Use `assign`."),qa=1,ra=/mobile|tablet|ip(ad|hone|od)|android/i,sa="ontouchstart"in a,ta=u(a,"PointerEvent")!==d,ua=sa&&ra.test(navigator.userAgent),va="touch",wa="pen",xa="mouse",ya="kinect",za=25,Aa=1,Ba=2,Ca=4,Da=8,Ea=1,Fa=2,Ga=4,Ha=8,Ia=16,Ja=Fa|Ga,Ka=Ha|Ia,La=Ja|Ka,Ma=["x","y"],Na=["clientX","clientY"];x.prototype={handler:function(){},init:function(){this.evEl&&m(this.element,this.evEl,this.domHandler),this.evTarget&&m(this.target,this.evTarget,this.domHandler),this.evWin&&m(w(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&n(this.element,this.evEl,this.domHandler),this.evTarget&&n(this.target,this.evTarget,this.domHandler),this.evWin&&n(w(this.element),this.evWin,this.domHandler)}};var Oa={mousedown:Aa,mousemove:Ba,mouseup:Ca},Pa="mousedown",Qa="mousemove mouseup";i(L,x,{handler:function(a){var b=Oa[a.type];b&Aa&&0===a.button&&(this.pressed=!0),b&Ba&&1!==a.which&&(b=Ca),this.pressed&&this.allow&&(b&Ca&&(this.pressed=!1),this.callback(this.manager,b,{pointers:[a],changedPointers:[a],pointerType:xa,srcEvent:a}))}});var Ra={pointerdown:Aa,pointermove:Ba,pointerup:Ca,pointercancel:Da,pointerout:Da},Sa={2:va,3:wa,4:xa,5:ya},Ta="pointerdown",Ua="pointermove pointerup pointercancel";a.MSPointerEvent&&!a.PointerEvent&&(Ta="MSPointerDown",Ua="MSPointerMove MSPointerUp MSPointerCancel"),i(M,x,{handler:function(a){var b=this.store,c=!1,d=a.type.toLowerCase().replace("ms",""),e=Ra[d],f=Sa[a.pointerType]||a.pointerType,g=f==va,h=r(b,a.pointerId,"pointerId");e&Aa&&(0===a.button||g)?0>h&&(b.push(a),h=b.length-1):e&(Ca|Da)&&(c=!0),0>h||(b[h]=a,this.callback(this.manager,e,{pointers:b,changedPointers:[a],pointerType:f,srcEvent:a}),c&&b.splice(h,1))}});var Va={touchstart:Aa,touchmove:Ba,touchend:Ca,touchcancel:Da},Wa="touchstart",Xa="touchstart touchmove touchend touchcancel";i(N,x,{handler:function(a){var b=Va[a.type];if(b===Aa&&(this.started=!0),this.started){var c=O.call(this,a,b);b&(Ca|Da)&&c[0].length-c[1].length===0&&(this.started=!1),this.callback(this.manager,b,{pointers:c[0],changedPointers:c[1],pointerType:va,srcEvent:a})}}});var Ya={touchstart:Aa,touchmove:Ba,touchend:Ca,touchcancel:Da},Za="touchstart touchmove touchend touchcancel";i(P,x,{handler:function(a){var b=Ya[a.type],c=Q.call(this,a,b);c&&this.callback(this.manager,b,{pointers:c[0],changedPointers:c[1],pointerType:va,srcEvent:a})}}),i(R,x,{handler:function(a,b,c){var d=c.pointerType==va,e=c.pointerType==xa;if(d)this.mouse.allow=!1;else if(e&&!this.mouse.allow)return;b&(Ca|Da)&&(this.mouse.allow=!0),this.callback(a,b,c)},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var $a=u(ja.style,"touchAction"),_a=$a!==d,ab="compute",bb="auto",cb="manipulation",db="none",eb="pan-x",fb="pan-y";S.prototype={set:function(a){a==ab&&(a=this.compute()),_a&&this.manager.element.style&&(this.manager.element.style[$a]=a),this.actions=a.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var a=[];return g(this.manager.recognizers,function(b){k(b.options.enable,[b])&&(a=a.concat(b.getTouchAction()))}),T(a.join(" "))},preventDefaults:function(a){if(!_a){var b=a.srcEvent,c=a.offsetDirection;if(this.manager.session.prevented)return void b.preventDefault();var d=this.actions,e=p(d,db),f=p(d,fb),g=p(d,eb);if(e){var h=1===a.pointers.length,i=a.distance<2,j=a.deltaTime<250;if(h&&i&&j)return}if(!g||!f)return e||f&&c&Ja||g&&c&Ka?this.preventSrc(b):void 0}},preventSrc:function(a){this.manager.session.prevented=!0,a.preventDefault()}};var gb=1,hb=2,ib=4,jb=8,kb=jb,lb=16,mb=32;U.prototype={defaults:{},set:function(a){return ha(this.options,a),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(a){if(f(a,"recognizeWith",this))return this;var b=this.simultaneous;return a=X(a,this),b[a.id]||(b[a.id]=a,a.recognizeWith(this)),this},dropRecognizeWith:function(a){return f(a,"dropRecognizeWith",this)?this:(a=X(a,this),delete this.simultaneous[a.id],this)},requireFailure:function(a){if(f(a,"requireFailure",this))return this;var b=this.requireFail;return a=X(a,this),-1===r(b,a)&&(b.push(a),a.requireFailure(this)),this},dropRequireFailure:function(a){if(f(a,"dropRequireFailure",this))return this;a=X(a,this);var b=r(this.requireFail,a);return b>-1&&this.requireFail.splice(b,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(a){return!!this.simultaneous[a.id]},emit:function(a){function b(b){c.manager.emit(b,a)}var c=this,d=this.state;jb>d&&b(c.options.event+V(d)),b(c.options.event),a.additionalEvent&&b(a.additionalEvent),d>=jb&&b(c.options.event+V(d))},tryEmit:function(a){return this.canEmit()?this.emit(a):void(this.state=mb)},canEmit:function(){for(var a=0;a<this.requireFail.length;){if(!(this.requireFail[a].state&(mb|gb)))return!1;a++}return!0},recognize:function(a){var b=ha({},a);return k(this.options.enable,[this,b])?(this.state&(kb|lb|mb)&&(this.state=gb),this.state=this.process(b),void(this.state&(hb|ib|jb|lb)&&this.tryEmit(b))):(this.reset(),void(this.state=mb))},process:function(a){},getTouchAction:function(){},reset:function(){}},i(Y,U,{defaults:{pointers:1},attrTest:function(a){var b=this.options.pointers;return 0===b||a.pointers.length===b},process:function(a){var b=this.state,c=a.eventType,d=b&(hb|ib),e=this.attrTest(a);return d&&(c&Da||!e)?b|lb:d||e?c&Ca?b|jb:b&hb?b|ib:hb:mb}}),i(Z,Y,{defaults:{event:"pan",threshold:10,pointers:1,direction:La},getTouchAction:function(){var a=this.options.direction,b=[];return a&Ja&&b.push(fb),a&Ka&&b.push(eb),b},directionTest:function(a){var b=this.options,c=!0,d=a.distance,e=a.direction,f=a.deltaX,g=a.deltaY;return e&b.direction||(b.direction&Ja?(e=0===f?Ea:0>f?Fa:Ga,c=f!=this.pX,d=Math.abs(a.deltaX)):(e=0===g?Ea:0>g?Ha:Ia,c=g!=this.pY,d=Math.abs(a.deltaY))),a.direction=e,c&&d>b.threshold&&e&b.direction},attrTest:function(a){return Y.prototype.attrTest.call(this,a)&&(this.state&hb||!(this.state&hb)&&this.directionTest(a))},emit:function(a){this.pX=a.deltaX,this.pY=a.deltaY;var b=W(a.direction);b&&(a.additionalEvent=this.options.event+b),this._super.emit.call(this,a)}}),i($,Y,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[db]},attrTest:function(a){return this._super.attrTest.call(this,a)&&(Math.abs(a.scale-1)>this.options.threshold||this.state&hb)},emit:function(a){if(1!==a.scale){var b=a.scale<1?"in":"out";a.additionalEvent=this.options.event+b}this._super.emit.call(this,a)}}),i(_,U,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[bb]},process:function(a){var b=this.options,c=a.pointers.length===b.pointers,d=a.distance<b.threshold,f=a.deltaTime>b.time;if(this._input=a,!d||!c||a.eventType&(Ca|Da)&&!f)this.reset();else if(a.eventType&Aa)this.reset(),this._timer=e(function(){this.state=kb,this.tryEmit()},b.time,this);else if(a.eventType&Ca)return kb;return mb},reset:function(){clearTimeout(this._timer)},emit:function(a){this.state===kb&&(a&&a.eventType&Ca?this.manager.emit(this.options.event+"up",a):(this._input.timeStamp=na(),this.manager.emit(this.options.event,this._input)))}}),i(aa,Y,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[db]},attrTest:function(a){return this._super.attrTest.call(this,a)&&(Math.abs(a.rotation)>this.options.threshold||this.state&hb)}}),i(ba,Y,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Ja|Ka,pointers:1},getTouchAction:function(){return Z.prototype.getTouchAction.call(this)},attrTest:function(a){var b,c=this.options.direction;return c&(Ja|Ka)?b=a.overallVelocity:c&Ja?b=a.overallVelocityX:c&Ka&&(b=a.overallVelocityY),this._super.attrTest.call(this,a)&&c&a.offsetDirection&&a.distance>this.options.threshold&&a.maxPointers==this.options.pointers&&ma(b)>this.options.velocity&&a.eventType&Ca},emit:function(a){var b=W(a.offsetDirection);b&&this.manager.emit(this.options.event+b,a),this.manager.emit(this.options.event,a)}}),i(ca,U,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[cb]},process:function(a){var b=this.options,c=a.pointers.length===b.pointers,d=a.distance<b.threshold,f=a.deltaTime<b.time;if(this.reset(),a.eventType&Aa&&0===this.count)return this.failTimeout();if(d&&f&&c){if(a.eventType!=Ca)return this.failTimeout();var g=this.pTime?a.timeStamp-this.pTime<b.interval:!0,h=!this.pCenter||H(this.pCenter,a.center)<b.posThreshold;this.pTime=a.timeStamp,this.pCenter=a.center,h&&g?this.count+=1:this.count=1,this._input=a;var i=this.count%b.taps;if(0===i)return this.hasRequireFailures()?(this._timer=e(function(){this.state=kb,this.tryEmit()},b.interval,this),hb):kb}return mb},failTimeout:function(){return this._timer=e(function(){this.state=mb},this.options.interval,this),mb},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==kb&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),da.VERSION="2.0.6",da.defaults={domEvents:!1,touchAction:ab,enable:!0,inputTarget:null,inputClass:null,preset:[[aa,{enable:!1}],[$,{enable:!1},["rotate"]],[ba,{direction:Ja}],[Z,{direction:Ja},["swipe"]],[ca],[ca,{event:"doubletap",taps:2},["tap"]],[_]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var nb=1,ob=2;ea.prototype={set:function(a){return ha(this.options,a),a.touchAction&&this.touchAction.update(),a.inputTarget&&(this.input.destroy(),this.input.target=a.inputTarget,this.input.init()),this},stop:function(a){this.session.stopped=a?ob:nb},recognize:function(a){var b=this.session;if(!b.stopped){this.touchAction.preventDefaults(a);var c,d=this.recognizers,e=b.curRecognizer;(!e||e&&e.state&kb)&&(e=b.curRecognizer=null);for(var f=0;f<d.length;)c=d[f],b.stopped===ob||e&&c!=e&&!c.canRecognizeWith(e)?c.reset():c.recognize(a),!e&&c.state&(hb|ib|jb)&&(e=b.curRecognizer=c),f++}},get:function(a){if(a instanceof U)return a;for(var b=this.recognizers,c=0;c<b.length;c++)if(b[c].options.event==a)return b[c];return null},add:function(a){if(f(a,"add",this))return this;var b=this.get(a.options.event);return b&&this.remove(b),this.recognizers.push(a),a.manager=this,this.touchAction.update(),a},remove:function(a){if(f(a,"remove",this))return this;if(a=this.get(a)){var b=this.recognizers,c=r(b,a);-1!==c&&(b.splice(c,1),this.touchAction.update())}return this},on:function(a,b){var c=this.handlers;return g(q(a),function(a){c[a]=c[a]||[],c[a].push(b)}),this},off:function(a,b){var c=this.handlers;return g(q(a),function(a){b?c[a]&&c[a].splice(r(c[a],b),1):delete c[a]}),this},emit:function(a,b){this.options.domEvents&&ga(a,b);var c=this.handlers[a]&&this.handlers[a].slice();if(c&&c.length){b.type=a,b.preventDefault=function(){b.srcEvent.preventDefault()};for(var d=0;d<c.length;)c[d](b),d++}},destroy:function(){this.element&&fa(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},ha(da,{INPUT_START:Aa,INPUT_MOVE:Ba,INPUT_END:Ca,INPUT_CANCEL:Da,STATE_POSSIBLE:gb,STATE_BEGAN:hb,STATE_CHANGED:ib,STATE_ENDED:jb,STATE_RECOGNIZED:kb,STATE_CANCELLED:lb,STATE_FAILED:mb,DIRECTION_NONE:Ea,DIRECTION_LEFT:Fa,DIRECTION_RIGHT:Ga,DIRECTION_UP:Ha,DIRECTION_DOWN:Ia,DIRECTION_HORIZONTAL:Ja,DIRECTION_VERTICAL:Ka,DIRECTION_ALL:La,Manager:ea,Input:x,TouchAction:S,TouchInput:P,MouseInput:L,PointerEventInput:M,TouchMouseInput:R,SingleTouchInput:N,Recognizer:U,AttrRecognizer:Y,Tap:ca,Pan:Z,Swipe:ba,Pinch:$,Rotate:aa,Press:_,on:m,off:n,each:g,merge:pa,extend:oa,assign:ha,inherit:i,bindFn:j,prefixed:u});var pb="undefined"!=typeof a?a:"undefined"!=typeof self?self:{};pb.Hammer=da,"function"==typeof define&&define.amd?define(function(){return da}):"undefined"!=typeof module&&module.exports?module.exports=da:a[c]=da}(window,document,"Hammer");
//# sourceMappingURL=hammer.min.map
(function() {
  var root = this;
  var e,g=g||{VERSION:"0.1.1",jf:[],xd:!1,wl:!1};function n(a){this.S="";this.lc=this.Hb=this.qb=null;this.ob=!0;this.ze=this.bd=!1;this.Ee=null;this.ab=a||"BaseObject"}n.prototype.constructor=n;function aa(a){if("string"!==typeof a.S||""===a.S)a.S=g.R.Jf();g.R.register(a);a.qb&&("string"===typeof a.qb&&(a.qb=[a.qb]),!0===Array.isArray(a.qb)&&g.eb.register(a))}function ba(a){""!==a.S&&!0===g.R.hb(a.S)&&g.R.unregister(a)}
function ca(a,b,d){d=d||"log";console[d].apply(console,["%c[KEN]%c KEN."+a.ab+" : "+b+" %c(@"+window.performance.now().toFixed(2)+"ms)","background: #e2edff; color: #4286f4; font-weight: 700","font-weight: 400","color: #AAA"]);if("object"===typeof b&&null!==b)console[d](b)}n.prototype.log=function(a){if(!0===g.xd||!0===g[this.ab].DEBUG||!0===this.bd)ca(this,a,"log"),this.Ee||(this.Ee=[]),this.Ee.push(a)};n.prototype.warn=function(a){!0!==g.wl&&!0!==g[this.ab].WARNING&&!0!==this.ze||ca(this,a,"warn")};
n.prototype.destroy=function(){!1!==this.ob&&(ba(this),this.lc&&(this.lc.H(),this.lc.destroy(),this.lc=null),this.Hb=null,this.ob=!1)};Object.defineProperty(n.prototype,"className",{get:function(){return this.ab}});Object.defineProperty(n.prototype,"uid",{get:function(){return this.S}});Object.defineProperty(n.prototype,"tags",{get:function(){return this.qb}});Object.defineProperty(n.prototype,"alive",{get:function(){return this.ob}});
Object.defineProperty(n.prototype,"data",{get:function(){return this.Hb},set:function(a){this.Hb=a}});Object.defineProperty(n.prototype,"debug",{get:function(){return this.bd},set:function(a){this.bd=!!a;!0===this.bd&&(console.log("Enabling debug for a KEN."+this.ab+" instance :"),console.log(this))}});Object.defineProperty(n.prototype,"warning",{get:function(){return this.ze},set:function(a){this.ze=!!a;!0===this.ze&&(console.log("Enabling warning for a KEN."+this.ab+" instance :"),console.log(this))}});
Object.defineProperty(n.prototype,"onDestroy",{get:function(){this.lc||(this.lc=new p(this));return this.lc}});function r(a,b,d){n.call(this,"Viewer");this.f=a;this.aa=b||{};this.da=this.U=this.ha=this.W=this.P=this.M=this.D=this.Aa=this.Z=this.Ba=this.ta=this.X=this.Ca=this.K=this.ma=this.ka=this.$=this.B=this.O=this.F=this.J=this.G=this.C=this.u=this.c=this.sa=null;this.ja=this.ia=!1;this.o=this.i=this.m=null;this.I=d||null;window.setTimeout(this.sl.bind(this),0)}r.prototype=Object.create(n.prototype);
e=r.prototype;e.constructor=r;
e.sl=function(a){this.S="KEN-instance-"+String(g.jf.length);g.jf.push(this.S);aa(this);this.log("KEN.Viewer.boot();");this.sa=new da(this);"string"===typeof this.f&&""!==this.f&&(this.f=document.getElementById(this.f));if("undefined"===typeof this.f||null===this.f||!1===g.la.Sf(this.f))throw"KEN.Viewer.boot : Viewer parent is invalid";this.f.style.width="100%";this.f.style.height="100%";this.c=new u(this,null,null,this.f);this.c.id="KEN-main-container-"+this.S;this.u=new u(this);this.u.id="KEN-canvas-container-"+
this.S;this.c.index=0;this.u.Lb(!0);this.c.cc(this.u);this.C=new u(this);this.C.id="KEN-dom-hotspot-container-"+this.S;this.c.index=0;this.C.Lb(!0);this.c.cc(this.C);this.G=new u(this);this.G.id="KEN-plugin-container-"+this.S;this.c.index=0;this.G.Lb(!0);this.c.cc(this.G);this.J=new ea(this);this.J.Lb(!0);this.u.cc(this.J);this.ka=new fa(this);this.P=new ga(this);this.F=new v(this);this.M=new ha(this);this.ha=new ia(this);this.X=new w(this);this.ta=new ja(this);this.U=new x(this);this.K=new ka(this);
this.O=new z(this);this.D=new A(this);this.B=new la(this);this.$=new ma(this);this.ma=new na(this);this.Ca=new oa(this);this.da=new pa(this);this.Aa=new qa(this);this.Z=new ra(this);this.Ba=new sa(this);this.W=new ta(this);this.F.boot();this.M.boot();this.X.boot();this.O.boot();this.D.boot();this.B.boot();this.log("KEN is alive !");"function"===typeof a&&a.call();this.I&&"function"===typeof this.I.boot&&this.I.boot.call();this.M.start();this.ja=!0;this.m&&this.m.H();a=this.aa;"string"===typeof a?
this.Ba.json(this.S+"-configuration",a,this.tl,this):a&&"object"===typeof a&&ua(this,a)};e.tl=function(a){this.log("KEN.Viewer._configLoadComplete();");a=this.Z.get(B.JSON,a.key).data;ua(this,a)};
function ua(a,b){a.aa=b;if("undefined"!==typeof b.viewer){var d=b.viewer;a.c.background="string"===typeof d.background?d.background:"#000"}"undefined"!==typeof b.i18n&&a.ha.na(b.i18n);"undefined"!==typeof b.history&&a.ta.na(b.history);"undefined"!==typeof b.audio&&a.F.na(b.audio);"undefined"!==typeof b.playlists&&a.O.na(b.playlists);"undefined"!==typeof b.actions&&a.$.na(b.actions);"undefined"!==typeof b.director&&a.ma.na(b.director);"undefined"!==typeof b.hotspots&&a.B.Oi(b.hotspots);"undefined"!==
typeof b.postProcessing&&a.Ca.na(b.postProcessing);"undefined"!==typeof b.plugins&&a.D.na(b.plugins);a.K.na(b.controllers);"undefined"!==b.tour&&a.X.load(b.tour)}e.update=function(a){!0!==this.ia&&(this.P.update(a),this.sa.update(),this.Aa.update(),this.F.update(),this.D.update(),this.W.update(),this.B.update(),this.K.update(),this.I&&"function"===typeof this.I.update&&this.I.update.call(),this.U&&this.U.render())};e.pause=function(){this.ia=!0;this.i&&this.i.H()};
e.resume=function(){this.ia=!1;this.o&&this.o.H()};
e.destroy=function(){this.M.stop();this.f=this.aa=null;this.D.destroy();this.D=null;this.M.destroy();this.M=null;this.Ba.destroy();this.Ba=null;this.ta.destroy();this.ta=null;this.P.destroy();this.P=null;this.Aa.destroy();this.Aa=null;this.B.destroy();this.B=null;this.U.destroy();this.U=null;this.J.destroy();this.J=null;this.u.destroy();this.u=null;this.C.destroy();this.C=null;this.ma.destroy();this.ma=null;this.Ca.destroy();this.Ca=null;this.G.destroy();this.G=null;this.$.destroy();this.$=null;this.c.destroy();
this.c=null;this.sa.destroy();this.sa=null;this.O.destroy();this.O=null;this.F.destroy();this.F=null;this.X.destroy();this.X=null;this.Z.destroy();this.Z=null;this.W.destroy();this.W=null;this.ha.destroy();this.ha=null;this.da.destroy();this.da=null;this.K.destroy();this.I=this.K=null;this.m&&(this.m.destroy(),this.m=null);this.i&&(this.i.destroy(),this.i=null);this.o&&(this.o.destroy(),this.o=null);g.jf.splice(this.S,1);n.prototype.destroy.call(this)};Object.defineProperty(r.prototype,"ready",{get:function(){return this.ja}});
Object.defineProperty(r.prototype,"config",{get:function(){return this.aa}});Object.defineProperty(r.prototype,"parent",{get:function(){return this.f}});Object.defineProperty(r.prototype,"display",{get:function(){return this.sa}});Object.defineProperty(r.prototype,"fullscreen",{get:function(){return this.c.qd()},set:function(a){"boolean"===typeof a&&this.c.qd()!==a&&(this.c.fullscreen=a)}});Object.defineProperty(r.prototype,"container",{get:function(){return this.c}});
Object.defineProperty(r.prototype,"canvasContainer",{get:function(){return this.u}});Object.defineProperty(r.prototype,"canvas",{get:function(){return this.J}});Object.defineProperty(r.prototype,"domHotspotContainer",{get:function(){return this.C}});Object.defineProperty(r.prototype,"pluginContainer",{get:function(){return this.G}});Object.defineProperty(r.prototype,"raf",{get:function(){return this.M}});Object.defineProperty(r.prototype,"audio",{get:function(){return this.F}});
Object.defineProperty(r.prototype,"playlists",{get:function(){return this.O}});Object.defineProperty(r.prototype,"hotspots",{get:function(){return this.B}});Object.defineProperty(r.prototype,"actions",{get:function(){return this.$}});Object.defineProperty(r.prototype,"dependencies",{get:function(){return this.ka}});Object.defineProperty(r.prototype,"director",{get:function(){return this.ma}});Object.defineProperty(r.prototype,"tour",{get:function(){return this.X}});
Object.defineProperty(r.prototype,"history",{get:function(){return this.ta}});Object.defineProperty(r.prototype,"load",{get:function(){return this.Ba}});Object.defineProperty(r.prototype,"cache",{get:function(){return this.Z}});Object.defineProperty(r.prototype,"plugins",{get:function(){return this.D}});Object.defineProperty(r.prototype,"raycaster",{get:function(){return this.da}});Object.defineProperty(r.prototype,"clock",{get:function(){return this.P}});
Object.defineProperty(r.prototype,"tween",{get:function(){return this.W}});Object.defineProperty(r.prototype,"i18n",{get:function(){return this.ha}});Object.defineProperty(r.prototype,"renderer",{get:function(){return this.U}});Object.defineProperty(r.prototype,"controllers",{get:function(){return this.K}});Object.defineProperty(r.prototype,"postProcessing",{get:function(){return this.Ca}});Object.defineProperty(r.prototype,"keyboard",{get:function(){return this.Aa}});
Object.defineProperty(r.prototype,"width",{get:function(){return this.c.width},set:function(a){this.c.width=a}});Object.defineProperty(r.prototype,"height",{get:function(){return this.c.height},set:function(a){this.c.height=a}});Object.defineProperty(r.prototype,"onReady",{get:function(){this.m||(this.m=new p(this));return this.m}});Object.defineProperty(r.prototype,"onPause",{get:function(){this.i||(this.i=new p(this));return this.i}});
Object.defineProperty(r.prototype,"onResume",{get:function(){this.o||(this.o=new p(this));return this.o}});
g.eb=function(a){a=a();a.prototype=Object.create(n.prototype);a.prototype.constructor=a;a.prototype.register=function(a){if("object"===typeof a&&"string"===typeof a.uid&&Array.isArray(a.tags)){var b=a.uid,h=a.tags;if(!0===g.R.hb(b))for(var k=0,l=h.length;k<l;k++)a=h[k],"string"!==typeof a?this.warn("Tags: An object has a tag that isn't a string!"):("undefined"===typeof this.rb[a]&&(this.rb[a]=[],null!==this.gd&&this.gd.H({tag:a})),-1===this.rb[a].indexOf(b)&&this.rb[a].push(b));else this.warn("Tags: The object you want to register in tags is not known by UID!"),
this.warn(a)}else this.warn("Tags: No uid or no tags on the object you try to register!"),this.warn(a)};a.prototype.Lf=function(a,d){var b=[];if("string"===typeof a)b=this.rb[a];else if(Array.isArray(a)){var k=0;for(a=a.length;k<a;k++);}"string"===typeof d&&(b=g.R.Yd(b,d));return b};a.prototype.get=function(a,d){if("string"===typeof a)return g.R.get(this.rb[a],d);if(Array.isArray(a)){var b=0;for(a=a.length;b<a;b++);return g.R.get([],d)}};a.prototype.pn=function(a,d){if(!0===this.hb(a)){a=this.rb[a];
for(var b=0,k=this.rb.length;b<k;b++)if(!0===g.R.V(a[b],d))return!0}return!1};a.prototype.hb=function(a){return"undefined"!==typeof this.rb[a]&&null!==this.rb[a]};Object.defineProperty(a.prototype,"list",{get:function(){return Object.keys(this.rb)}});Object.defineProperty(a.prototype,"onRegister",{get:function(){null===this.gd&&(this.gd=new p(this));return this.gd}});return new a}(function(){return function(){this.rb={};this.gd=null;n.call(this,"Tags")}});
g.R=function(a){a=a();a.prototype=Object.create(n.prototype);a.prototype.constructor=a;a.prototype.Jf=function(){var a="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)});return!1===g.R.hb(a)?a:g.R.Jf()};a.prototype.ek=function(a){function b(a){var d,k;for(k in a)if("uid"===k)if(d=a[k],"string"===typeof d){if(g.R.hb(d))throw"UID configuration not valid, uid "+d+" already have an object binded to!";if(-1!==h.indexOf(d))throw"UID configuration not valid, uid "+
d+" is in double in config file!";h.push(a[k])}else throw"Found a uid in configuration that is not a string!";else"object"===typeof a[k]&&b(a[k]);return!0}var h=[];return b(a)};a.prototype.register=function(a){if("object"===typeof a&&"string"===typeof a.uid){var b=a.uid;if(!1===g.R.hb(b))return this.ba[b]=a,!0;this.warn("The uid you want to register already exists!");this.warn(a)}else this.warn("No uid on the object you try to register!"),this.warn(a);return!1};a.prototype.unregister=function(a){"object"===
typeof a&&"string"===typeof a.uid?(a=a.uid,this.ba[a]=null,delete this.ba[a]):this.warn("No uid on the object you try to unregister!")};a.prototype.Lf=function(a){return"undefined"===typeof a||null===a?Object.keys(this.ba):g.R.Yd(Object.keys(this.ba),a)};a.prototype.Yd=function(a,d){return a.filter(function(a){return g.R.V(a,d)?!0:!1})};a.prototype.get=function(a,d){if("undefined"===typeof a||null===a){if("string"!==typeof d)return this.ba;a=Object.keys(this.ba)}if("string"===typeof a)return this.ba[a];
if(Array.isArray(a)){"string"===typeof d&&(a=g.R.Yd(a,d));d=[];for(var b,k=0,l=a.length;k<l;k++)b=a[k],!0===g.R.hb(b)&&d.push(this.ba[b]);return d}};a.prototype.V=function(a,d){a=g.R.get(a);return g.L.V(a,d)};a.prototype.hb=function(a){return"undefined"!==typeof this.ba[a]&&null!==this.ba[a]};return new a}(function(){return function(){this.ba={};n.call(this,"UID")}});
function w(a){this.j=a;this.J=this.O=this.K=this.f=null;this.M="";this.c=null;this.m="";this.o=null;this.u="";this.i=this.G=this.I=this.F=this.C=this.D=this.B=null;n.call(this,"Tour")}w.prototype=Object.create(n.prototype);e=w.prototype;e.constructor=w;e.boot=function(){this.log("KEN.Tour.boot();");this.c=[];this.o=[];this.K=new D(this.j);this.O=new D(this.j);this.J=new D(this.j)};
e.load=function(a){this.log("KEN.Tour.load();");"string"===typeof a?this.j.load.json("tour.config",a,this.gl,this):"object"===typeof a&&va(this,a)};e.hl=function(){return!!this.c.length};e.sc=function(){return!!this.o.length};e.il=function(){var a=this.c.indexOf(this.m);this.sd(a+1<this.c.length?this.c[a+1]:this.c[0])};e.jl=function(){var a=this.c.indexOf(this.m);this.sd(0<=a-1?this.c[a-1]:this.c[this.c.length-1])};
e.gl=function(a){this.log("KEN.Tour.loadComplete();");a=this.j.cache.get(B.JSON,a.key).data;va(this,a)};
function va(a,b){if(!0!==g.R.ek(b))throw"Tour configuration is not valid!";a.f=b;a.S=a.f.uid;aa(a);a.M=a.f["default"];a.K.key=a.f.name;a.O.key=a.f.slug;a.J.key=a.f.description;if("undefined"!==typeof a.f.scenes&&0<a.f.scenes.length){b=a.f.scenes;for(var d,h=0,k=b.length;h<k;h++)d=new E(a.j,b[h]),!0===d.booted&&wa(a,d)}if("undefined"!==typeof a.f.groups&&0<a.f.groups.length)for(b=a.f.groups,h=0,k=b.length;h<k;h++)d=new F(a.j,b[h]),a.o.push(d.uid);xa(a)}
function xa(a){if("undefined"===typeof a.f.scenes||a.c.length===a.f.scenes.length){a.B&&a.B.H();var b=ya().hashParameters;null!==b&&"string"===typeof b.uid?za(b.uid):""!==a.M&&null!==a.M&&g.R.hb(a.M)?za(a.M):a.sd(0)}}function za(a){!0!==g.R.V(a,"Scene")&&!0!==g.R.V(a,"Group")||g.R.get(a).load()}e.Mj=function(a){wa(this,a);xa(this)};function wa(a,b){b.onLoadStart.add(a.Nm,a);b.onLoadComplete.add(a.Mm,a);a.c.push(b.uid)}
e.sd=function(a){var b;"number"===typeof a?0<=a&&a<this.c.length?b=this.c[a]:this.warn("Load scene, index "+a+" is out of bounds"):"string"===typeof a&&g.R.V(a,"Scene")?b=a:"object"===typeof a&&g.L.V(a,"Scene")&&(b=a.uid);"undefined"!==typeof b&&b!==this.m&&za(b)};e.Nm=function(a){""!==this.m&&null!==this.m&&this.scene.xe();a=a.emitter;this.m=a.uid;!1===a.sc()?(this.u=null,this.i&&this.i.H()):!0===a.sc()&&!1===a.nd(this.u)&&Aa(this,a.groups[0].uid);this.D&&this.D.H({uid:a.uid})};
e.Mm=function(){this.F&&this.F.H()};function Aa(a,b){!0===g.R.V(b,"Group")&&b!==a.u&&(a.u=b,a.i&&a.i.H())}e.Gj=function(a){var b;"number"===typeof a?0<=a&&a<this.o.length?b=this.o[a]:this.warn("Load group, index "+a+" is out of bounds"):"string"===typeof a&&g.R.V(a,"Group")?b=a:"object"===typeof a&&g.L.V(a,"Group")&&(b=a.uid);"undefined"!==typeof b&&b!==this.u&&(Aa(this,b),za(b))};
e.destroy=function(){this.f=this.j=null;this.K.destroy();this.K=null;this.O.destroy();this.O=null;this.J.destroy();this.J=null;for(var a=0,b=this.c.length;a<b;a++)g.R.get(this.c[a]).destroy();this.c=null;a=0;for(b=this.o.length;a<b;a++)g.R.get(this.o[a]).destroy();this.o=null;this.B&&(this.B.destroy(),this.B=null);this.D&&(this.D.destroy(),this.D=null);this.C&&(this.C.destroy(),this.C=null);this.F&&(this.F.destroy(),this.F=null);this.I&&(this.I.destroy(),this.I=null);this.G&&(this.G.destroy(),this.G=
null);this.i&&(this.i.destroy(),this.i=null);n.prototype.destroy.call(this)};Object.defineProperty(w.prototype,"config",{get:function(){return this.f}});Object.defineProperty(w.prototype,"name",{get:function(){return this.K.value}});Object.defineProperty(w.prototype,"slug",{get:function(){return this.O.value}});Object.defineProperty(w.prototype,"description",{get:function(){return this.J.value}});Object.defineProperty(w.prototype,"scenes",{get:function(){return g.R.get(this.c)}});
Object.defineProperty(w.prototype,"scene",{get:function(){return null===this.m||""===this.m?null:g.R.get(this.m)},set:function(a){this.sd(a)}});Object.defineProperty(w.prototype,"sceneUid",{get:function(){return this.m}});Object.defineProperty(w.prototype,"groups",{get:function(){return g.R.get(this.o)}});Object.defineProperty(w.prototype,"group",{get:function(){return null===this.u||""===this.u?null:g.R.get(this.u)},set:function(a){this.Gj(a)}});Object.defineProperty(w.prototype,"groupUid",{get:function(){return this.u}});
Object.defineProperty(w.prototype,"onReady",{get:function(){this.B||(this.B=new p(this));return this.B}});Object.defineProperty(w.prototype,"onSceneLoadStart",{get:function(){this.D||(this.D=new p(this));return this.D}});Object.defineProperty(w.prototype,"onSceneLoadProgress",{get:function(){this.C||(this.C=new p(this));return this.C}});Object.defineProperty(w.prototype,"onSceneLoadComplete",{get:function(){this.F||(this.F=new p(this));return this.F}});
Object.defineProperty(w.prototype,"onSceneLoadError",{get:function(){this.I||(this.I=new p(this));return this.I}});Object.defineProperty(w.prototype,"onScenePreview",{get:function(){this.G||(this.G=new p(this));return this.G}});Object.defineProperty(w.prototype,"onGroupChange",{get:function(){this.i||(this.i=new p(this));return this.i}});
function F(a,b){this.j=a;this.f=b;this.o=null;this.D="#ffffff";this.B=1;this.c=this.m=this.u=null;this.i="";n.call(this,"Group");this.log("KEN.Group._boot();");this.S=this.f.uid;this.qb=this.f.tags;aa(this);this.c=[];this.o=new D(this.j,this.f.name);this.u=new D(this.j,this.f.slug);this.m=new D(this.j,this.f.description);"string"===typeof this.f.color&&(this.D=this.f.color);"number"===typeof this.f.alpha&&(this.B=this.f.alpha);a=this.f;"undefined"!==typeof a.children&&!0===g.L.Ma(a.children,"string")?
this.c=a.children:this.warn("A group has no children in its configuration, or configuration is not valid!");"string"===typeof a["default"]&&(-1!==this.c.indexOf(a["default"])?this.i=a["default"]:this.warn("A group has a default child that is not in its children array!"))}F.prototype=Object.create(n.prototype);e=F.prototype;e.constructor=F;
e.load=function(a){this.log("KEN.Group.load();");if(!this.c||!this.c.length)throw"Group.load() : can't load a group that have no children";var b;"undefined"===typeof a||null===a?b="string"===typeof this.i&&""!==this.i?this.i:this.c[0]:"number"===typeof a&&0<=a&&a<this.c.length?b=this.c[a]:"string"===typeof a?b=a:"object"===typeof a&&!0===this.Ie(a)&&(b=a.uid);if(-1===this.c.indexOf(b))throw'Group.load() : uid "'+b+'" is not in children of the group!';if(!0===g.R.V(b,"Scene")||!0===g.R.V(b,"Group"))g.R.get(b).load();
else throw"Impossible to load group child with uid "+b+", it seems to be neither a scene or a group!";};e.Ie=function(a){return"string"===typeof a?-1!==this.c.indexOf(a):!0===g.L.V(a,"Scene")||!0===g.L.V(a,"Group")?this.Ie(a.uid):!1};e.Pc=function(a){return"string"===typeof a&&g.R.V(a,"Scene")?-1!==this.c.indexOf(a):!0===g.L.V(a,"Scene")?this.Pc(a.uid):!1};e.nd=function(a){return"string"===typeof a&&g.R.V(a,"Group")?-1!==this.c.indexOf(a):!0===g.L.V(a,"Group")?this.nd(a.uid):!1};e.ln=function(){return!!this.c.length};
e.Of=function(a){for(var b,d=0,h=this.c.length;d<h;d++)if(b=this.c[d],g.R.V(b,a))return!0;return!1};e.Je=function(){return this.Of("Scene")};e.sc=function(){return this.Of("Group")};e.kd=function(a){if("string"!==typeof a)return this.c;for(var b=[],d=0,h=this.c.length;d<h;d++)g.R.V(this.c[d],a)&&b.push(this.c[d]);return b};e.$d=function(a){a=this.kd(a);return g.R.get(a)};
e.yk=function(){if(!1===this.Je())this.warn("Can't do Group.nextScene() on this group that have no scenes!");else{var a=this.scenesUids,b=a.indexOf(this.j.tour.sceneUid),d;-1===b&&(g.R.V(this.i,"Scene")?d=this.i:d=a[0]);b+1<a.length?d=a[b+1]:-1!==b&&(d=a[0]);this.load(d)}};
e.zk=function(){if(!1===this.Je())this.warn("Can't do Group.previousScene() on this group that have no scenes!");else{var a=this.scenesUids,b=a.indexOf(this.j.tour.sceneUid),d;-1===b&&(g.R.V(this.i,"Scene")?d=this.i:d=a[0]);0<=b-1?d=a[b-1]:-1!==b&&(d=a[a.length-1]);this.load(d)}};e.destroy=function(){this.c=this.j=null;this.o.destroy();this.o=null;this.u.destroy();this.u=null;this.m.destroy();this.m=null;n.prototype.destroy.call(this)};Object.defineProperty(F.prototype,"config",{get:function(){return this.f}});
Object.defineProperty(F.prototype,"name",{get:function(){return this.o.value}});Object.defineProperty(F.prototype,"color",{get:function(){return this.D}});Object.defineProperty(F.prototype,"alpha",{get:function(){return this.B}});Object.defineProperty(F.prototype,"slug",{get:function(){return this.u.value}});Object.defineProperty(F.prototype,"description",{get:function(){return this.m.value}});Object.defineProperty(F.prototype,"childrenUids",{get:function(){return this.kd()}});
Object.defineProperty(F.prototype,"children",{get:function(){return this.$d()}});Object.defineProperty(F.prototype,"scenesUids",{get:function(){return this.kd("Scene")}});Object.defineProperty(F.prototype,"scenes",{get:function(){return this.$d("Scene")}});Object.defineProperty(F.prototype,"groupsUids",{get:function(){return this.kd("Group")}});Object.defineProperty(F.prototype,"groups",{get:function(){return this.$d("Group")}});
function E(a,b){this.j=a;this.c=b;this.B=this.F=this.D=null;this.C=0;this.I=!1;this.u=this.m=this.o=this.f=this.i=null;n.call(this,"Scene");!0!==this.I&&(this.log("KEN.Scene._boot();"),this.S=this.c.uid,this.qb=this.c.tags,aa(this),this.D=new D(this.j,this.c.name),this.F=new D(this.j,this.c.slug),this.B=new D(this.j,this.c.description),"string"===typeof this.c.url&&""!==this.c.url?this.j.load.json(this.S,this.c.url,this.el,this):this.I=!0)}E.prototype=Object.create(n.prototype);e=E.prototype;
e.constructor=E;e.el=function(a){this.I=!0;"string"===typeof a.data&&(a.data=JSON.parse(a.data));this.c=g.L.rc(this.c,a.data);this.j.tour.Mj(this);this.u&&this.u.H()};e.load=function(){this.log("KEN.Scene.load();");this.j.tour.scene!==this&&(this.i&&this.i.H(),this.C++,this.f&&this.f.H())};e.xe=function(){this.o&&this.o.H();this.m&&this.m.H()};e.nd=function(a){return"string"===typeof a&&!0===g.R.V(a,"Group")?g.R.get(a).Pc(this):!0===g.L.V(a,"Group")?a.Pc(this):!1};
e.sc=function(){for(var a=this.j.tour.groups,b,d=0,h=a.length;d<h;d++)if(b=a[d],!0===b.Pc(this))return!0;return!1};e.destroy=function(){this.j=null;this.D.destroy();this.D=null;this.F.destroy();this.F=null;this.B.destroy();this.B=null;this.i&&(this.i.destroy(),this.i=null);this.f&&(this.f.destroy(),this.f=null);this.o&&(this.o.destroy(),this.o=null);this.m&&(this.m.destroy(),this.m=null);n.prototype.destroy.call(this)};Object.defineProperty(E.prototype,"booted",{get:function(){return this.I}});
Object.defineProperty(E.prototype,"config",{get:function(){return this.c}});Object.defineProperty(E.prototype,"viewCount",{get:function(){return this.C}});Object.defineProperty(E.prototype,"viewed",{get:function(){return!!this.C}});Object.defineProperty(E.prototype,"name",{get:function(){return this.D.value}});Object.defineProperty(E.prototype,"slug",{get:function(){return this.F.value}});Object.defineProperty(E.prototype,"description",{get:function(){return this.B.value}});
Object.defineProperty(E.prototype,"groupsUid",{get:function(){for(var a=this.j.tour.groups,b,d=[],h=0,k=a.length;h<k;h++)b=a[h],!0===b.Pc(this)&&d.push(b.uid);return d}});Object.defineProperty(E.prototype,"groups",{get:function(){return g.R.get(this.groupsUid)}});Object.defineProperty(E.prototype,"thumbnails",{get:function(){return this.c.thumbnails}});Object.defineProperty(E.prototype,"onLoadStart",{get:function(){this.i||(this.i=new p(this));return this.i}});
Object.defineProperty(E.prototype,"onLoadComplete",{get:function(){this.f||(this.f=new p(this));return this.f}});Object.defineProperty(E.prototype,"onUnloadStart",{get:function(){this.o||(this.o=new p(this));return this.o}});Object.defineProperty(E.prototype,"onUnloadComplete",{get:function(){this.m||(this.m=new p(this));return this.m}});Object.defineProperty(E.prototype,"onConfigLoadComplete",{get:function(){this.u||(this.u=new p(this));return this.u}});g.Math={};g.Math.Qa="degrees";g.Math.wb="radians";
g.Math.Kg=Math.PI/180;g.Math.Vh=180/Math.PI;g.Math.bi=2*Math.PI;g.Math.ca=function(a){return a*g.Math.Kg};g.Math.Pb=function(a){return a*g.Math.Vh};g.Math.vd=function(a){return Math.round(10*a)/10};g.Math.fa=function(a,b,d){b="number"===typeof b&&!1===isNaN(b)?b:-Infinity;d="number"===typeof d&&!1===isNaN(d)?d:Infinity;return Math.min(Math.max(a,b),d)};g.Math.uc=function(a,b,d){d-=b;return((a-b)%d+d)%d+b};g.Math.An=function(a,b,d){return a*d+b*(1-d)};
g.Math.Hn=function(a,b,d){a=g.Math.fa((a-b)/(d-b),0,1);return a*a*(3-2*a)};g.Math.hg=function(a){return{yaw:Math.atan2(-a.elements[2],a.elements[10]),pitch:Math.asin(-a.elements[6]),roll:Math.atan2(-a.elements[4],a.elements[5])}};
g.Math.Xd=function(a,b,d,h){var k=Math.cos(a);a=Math.sin(a);var l=Math.cos(-b);b=Math.sin(-b);var q=Math.cos(d);d=Math.sin(d);"undefined"===typeof h&&(h=!1);return h?(new THREE.Matrix4).set(k*q+a*b*d,-k*d+a*b*q,a*l,0,l*d,l*q,-b,0,-a*q+k*b*d,a*d+k*b*q,k*l,0,0,0,0,1):(new THREE.Matrix4).set(q*k-d*b*a,-d*l,q*a+d*b*k,0,d*k+q*b*a,q*l,d*a-q*b*k,0,-a*l,b,l*k,0,0,0,0,1)};g.Quaternion={};g.Quaternion.we=function(a){a=(new THREE.Euler).setFromQuaternion(a,"XYZ");return{yaw:a.x,pitch:-a.y,roll:a.z}};
g.Quaternion.Jb=function(a,b,d){"object"===typeof a&&(b=a.pitch,d=a.roll,a=a.yaw);return(new THREE.Quaternion).setFromEuler(new THREE.Euler(a,-b,d,"ZXY"))};g.Quaternion.$j=function(a){a=g.Quaternion.we(a);return g.Math.Xd(a.yaw,a.pitch,a.roll)};g.Quaternion.dn=function(a){return g.Quaternion.Jb(g.Math.hg(a))};g.Quaternion.cancelRoll=function(a){a=g.Quaternion.we(a);return g.Quaternion.Jb(a.yaw,a.pitch,0)};g.Quaternion.$m=function(a,b){return(new THREE.Quaternion).copy(a).inverse().multiply(b)};
g.Quaternion.Ud=function(a,b){a=Math.abs(a.dot(b));return 1<=a?0:2*Math.acos(a)};g.Quaternion.multiplyScalar=function(a,b){return new THREE.Quaternion(a*b.x,a*b.y,a*b.z,a*b.w)};g.Quaternion.add=function(a,b){return new THREE.Quaternion(a.x+b.x,a.y+b.y,a.z+b.z,a.w+b.w)};g.Quaternion.log=function(a){var b=new THREE.Quaternion(0,0,0,0);if(1>Math.abs(a.w)){var d=Math.acos(a.w),h=Math.sin(d);0<h&&(b.x=d*a.x/h,b.y=d*a.y/h,b.z=d*a.z/h);return b}b.x=a.x;b.y=a.y;b.z=a.z;return b};
g.Quaternion.exp=function(a){var b=Math.sqrt(a.x*a.x+a.y*a.y+a.z*a.z),d=Math.sin(b),h=(new THREE.Quaternion).copy(a);h.w=Math.cos(b);Math.abs(d)>Number.EPSILON&&(h.x=d*a.x/b,h.y=d*a.y/b,h.z=d*a.z/b);return h};g.Quaternion.slerp=function(a,b,d){var h=new THREE.Quaternion;THREE.Quaternion.slerp(a,b,h,d);return h};g.Quaternion.Jn=function(a,b,d,h,k,l){a=g.Quaternion.slerp(a,h,l);b=g.Quaternion.slerp(b,d,l);return g.Quaternion.slerp(a,b,2*l*(1-l))};
g.Quaternion.Lj=function(a,b,d){return g.Quaternion.add(g.Quaternion.multiplyScalar(1-d,a),g.Quaternion.multiplyScalar(d,b)).normalize()};g.Quaternion.ue=function(a,b,d){var h=a.dot(b);if(.95<=Math.abs(h))return g.Quaternion.Lj(a,b,d);h=Math.acos(h);return g.Quaternion.multiplyScalar(1/Math.sin(h),g.Quaternion.add(g.Quaternion.multiplyScalar(Math.sin(h*(1-d)),a),g.Quaternion.multiplyScalar(Math.sin(h*d),b)))};
g.Quaternion.Yj=function(a,b,d,h,k){a=g.Quaternion.ue(a,h,k);b=g.Quaternion.ue(b,d,k);return g.Quaternion.ue(a,b,2*k*(1-k))};g.Quaternion.og=function(a,b,d){var h=(new THREE.Quaternion).copy(b).conjugate();a=(new THREE.Quaternion).copy(h).multiply(a);d=(new THREE.Quaternion).copy(h).multiply(d);h=g.Quaternion.log(a);d=g.Quaternion.log(d);d=g.Quaternion.add(h,d);d=g.Quaternion.multiplyScalar(-.25,d);d=g.Quaternion.exp(d);return(new THREE.Quaternion).copy(b).multiply(d).normalize()};
function Ba(a,b,d,h){this.S="number"===typeof a?a:0;this.i="number"===typeof b?b:0;this.f="number"===typeof d?d:0;this.c="number"===typeof h?h:0}Ba.prototype.constructor=Ba;Object.defineProperty(Ba.prototype,"x",{get:function(){return this.S},set:function(a){"number"===typeof a&&(this.S=a)}});Object.defineProperty(Ba.prototype,"y",{get:function(){return this.i},set:function(a){"number"===typeof a&&(this.i=a)}});
Object.defineProperty(Ba.prototype,"width",{get:function(){return this.f},set:function(a){"number"===typeof a&&(this.f=a)}});Object.defineProperty(Ba.prototype,"height",{get:function(){return this.c},set:function(a){"number"===typeof a&&(this.c=a)}});Object.defineProperty(Ba.prototype,"center",{get:function(){return new THREE.Vector2(this.S+.5*this.f,this.i+.5*this.c)}});Object.defineProperty(Ba.prototype,"origin",{get:function(){return new THREE.Vector2(this.S,this.i)}});
Object.defineProperty(Ba.prototype,"size",{get:function(){return new Ca(this.f,this.c)}});function Ca(a,b){this.f=a||0;this.c=b||0}Ca.prototype.constructor=Ca;Object.defineProperty(Ca.prototype,"width",{get:function(){return this.f}});Object.defineProperty(Ca.prototype,"height",{get:function(){return this.c}});Object.defineProperty(Ca.prototype,"ratio",{get:function(){return this.f/this.c}});
function G(a,b){this.j=a;this.c=null;this.O="";this.X=this.M=!0;this.u=null;this.K=this.U=!1;this.F=this.B=this.D=this.I=null;n.call(this,b||"Object3D");this.Ne()}G.prototype=Object.create(n.prototype);e=G.prototype;e.constructor=G;e.Ne=function(){this.u={};this.c=new THREE.Mesh;this.j.renderer.objects.register(this)};e.click=function(){this.log("click");!0===g.L.V(this.u.onClick,"ActionEventDispatcher")&&this.u.onClick.H();this.I&&this.I.H()};
e.lh=function(){this.log("over");!0===g.L.V(this.u.onOver,"ActionEventDispatcher")&&this.u.onOver.H();this.D&&this.D.H()};e.kh=function(){this.log("out");!0===g.L.V(this.u.onOut,"ActionEventDispatcher")&&this.u.onOut.H();this.B&&this.B.H()};
e.destroy=function(){this.j.renderer.objects.unregister(this);this.c&&(this.c.c=null,this.c.geometry&&(this.c.geometry.dispose(),this.c.geometry=null),this.c=null);this.I&&(this.I.destroy(),this.I=null);this.D&&(this.D.destroy(),this.D=null);this.B&&(this.B.destroy(),this.B=null);this.F&&(this.F.destroy(),this.F=null);this.j=null;n.prototype.destroy.call(this)};Object.defineProperty(G.prototype,"mesh",{get:function(){return this.c}});
Object.defineProperty(G.prototype,"visible",{get:function(){return this.M},set:function(a){this.M=!!a;this.c&&(this.c.visible=this.M)}});Object.defineProperty(G.prototype,"hovered",{get:function(){return this.U},set:function(a){this.U=!!a}});Object.defineProperty(G.prototype,"interactive",{get:function(){return this.X},set:function(a){this.X=!!a}});Object.defineProperty(G.prototype,"fx",{get:function(){return this.O}});Object.defineProperty(G.prototype,"events",{get:function(){return this.u}});
Object.defineProperty(G.prototype,"ready",{get:function(){return this.K}});Object.defineProperty(G.prototype,"onClick",{get:function(){this.I||(this.I=new p(this));return this.I}});Object.defineProperty(G.prototype,"onOver",{get:function(){this.D||(this.D=new p(this));return this.D}});Object.defineProperty(G.prototype,"onOut",{get:function(){this.B||(this.B=new p(this));return this.B}});Object.defineProperty(G.prototype,"onReady",{get:function(){this.F||(this.F=new p(this));return this.F}});
function Da(a){this.j=a;this.c=this.ba=null;n.call(this,"ObjectRenderer");this.ba=[];this.c=[]}Da.prototype=Object.create(n.prototype);e=Da.prototype;e.constructor=Da;function Ea(a,b){var d=[];return d="undefined"===typeof b||""===b||null===b?a.ba.filter(function(a){return"undefined"===typeof a.fx||""===a.fx||null===a.fx}):a.ba.filter(function(a){return a.fx===b})}function Fa(a){var b=Ea(a,null);return g.L.Ri(a.ba,b)}
function Ga(a){return Fa(a).reduce(function(a,d){0>a.indexOf(d.fx)&&a.push(d.fx);return a},[])}e.register=function(a){this.ba.push(a)};e.unregister=function(a){this.ba.splice(this.ba.indexOf(a),1)};
e.Vi=function(){var a=this.j.renderer.camera.main,b=Ea(this,null);if(0<b.length){for(var d=new THREE.Scene,h=0,k=b.length;h<k;h++)d.add(b[h].mesh);this.c.push(new Ha(this.j,d,a,null))}b=Ga(this);d=0;for(h=b.length;d<h;d++){for(var k=b[d],l=Ea(this,k),q=new THREE.Scene,t=0,y=l.length;t<y;t++)q.add(l[t].mesh);this.c.push(new Ha(this.j,q,a,this.j.postProcessing.ae(k)))}};e.oj=function(){return this.ba.filter(function(a){return!0===a.ready&&!0===a.interactive})};
e.lj=function(a){for(var b=0,d=this.ba.length;b<d;b++)if(this.ba[b].mesh===a)return this.ba[b];return null};e.clear=function(){for(var a=this.c.length;a--;)this.c.pop().destroy()};e.destroy=function(){this.clear();this.j=this.c=null;n.prototype.destroy.call(this)};Object.defineProperty(Da.prototype,"all",{get:function(){return this.ba}});Object.defineProperty(Da.prototype,"renderScenes",{get:function(){return this.c}});
function pa(a){this.j=a;this.i=null;this.f=Ia.cb;this.c=null;n.call(this,"Raycaster");this.j.tour.onSceneLoadComplete.add(this.bl,this)}pa.prototype=Object.create(n.prototype);pa.prototype.constructor=pa;var Ia={cb:"pointer",zc:"gaze"};e=pa.prototype;e.bl=function(a){a.emitter.scene.onUnloadStart.ga(this.cl,this);Ja(this)};e.cl=function(){Ka(this)};
function Ja(a){a.log("Raycating start");a.i||(a.i=new THREE.Raycaster);switch(a.f){case Ia.cb:a.log("Raycating start pointer");!1===a.j.canvas.pointer.onClick.has(a.Id,a)&&a.j.canvas.pointer.onClick.add(a.Id,a);!1===a.j.canvas.pointer.onMove.has(a.Jd,a)&&a.j.canvas.pointer.onMove.add(a.Jd,a);break;case Ia.zc:a.log("Raycating start gaze"),!1===a.j.renderer.camera.onCameraChange.has(a.Hd,a)&&a.j.renderer.camera.onCameraChange.add(a.Hd,a)}}
function Ka(a){a.log("Raycating stop");a.j.canvas.pointer.onClick.has(a.Id,a)&&a.j.canvas.pointer.onClick.remove(a.Id,a);a.j.canvas.pointer.onMove.has(a.Jd,a)&&a.j.canvas.pointer.onMove.remove(a.Jd,a);!1===a.j.renderer.camera.onCameraChange.has(a.Hd,a)&&a.j.renderer.camera.onCameraChange.remove(a.Hd,a);La(a);a.i=null}e.Id=function(a){a.data.center=a.data.center||{x:a.data.x,y:a.data.y};Ma(this,"click",a.data.center)};
e.Jd=function(a){a.data.center=a.data.center||{x:a.data.x,y:a.data.y};Ma(this,"move",a.data.center)};e.Hd=function(){Ma(this,"move")};
function Ma(a,b,d){var h=a.j.renderer.canvasResolution;d=d||{x:h.width/2,y:h.height/2};var k=a.j.renderer.camera,l=(new THREE.Vector2(d.x/h.width,1-d.y/h.height)).multiplyScalar(2).addScalar(-1),h=a.j.renderer.objects.oj();d=0;for(var q=h.length;d<q;d++)h[d].hovered=!1;d=null;a.i.setFromCamera(l,k.main);k=[];l=0;for(q=h.length;l<q;l++)k.push(h[l].mesh);h=a.i.intersectObjects(k);if(0<h.length)if(l=h[0].object,k=h[0].uv,h=a.j.renderer.objects.lj(l),!0===l.material.transparent){q=null;if(null!==h.mesh&&
null!==h.mesh.material&&null!==h.mesh.material.map){var t=h.mesh.material.map,l=null;null!==t.image&&("img"===t.image.nodeName.toLowerCase()?(l=document.createElement("canvas"),l.width=t.image.width,l.height=t.image.height,l.getContext("2d").drawImage(t.image,0,0)):"canvas"===t.image.nodeName.toLowerCase()&&(l=t.image),null!==l&&(q=l.width,t=l.height,k=4*(Math.floor(t-k.y*t)*q+Math.floor(k.x*q)),l=l.getContext("2d").getImageData(0,0,q,t).data,q=new Na(0,0,0,l[k+3])))}(k=q)&&10<k.alpha&&(d=h)}else d=
h;d?"click"===b?a.click():"move"===b&&d!==a.c&&(La(a),a.c=d,d.lh(),a.f===Ia.zc&&a.j.renderer.camera.gaze.start()):La(a)}function La(a){a.c&&(a.c.kh(),a.c=null,a.f===Ia.zc&&a.j.renderer.camera.gaze.stop())}e.click=function(){this.c&&this.c.click()};Object.defineProperty(pa.prototype,"mode",{get:function(){return this.f},set:function(a){a!==Ia.cb&&a!==Ia.zc||a===this.f||(Ka(this),this.f=a,Ja(this))}});Object.defineProperty(pa.prototype,"hoveredObject",{get:function(){return this.c}});g.kb={};
g.kb.IMAGE="image";g.kb.VIDEO="video";g.Za={};g.Za.Ng="equi";g.Za.Gg="cube";g.Za.Og="flat";g.Za.kk="hotspot";
function Oa(a,b){this.j=a;this.m=b;this.c=this.N=this.f=this.i=null;n.call(this,"Media");a=this.m;this.warn("KEN.Media config validator not implemented");this.S=a.uid;b=a.source;var d=a.sound,h=!1;if(!b)throw"No source specified !";d&&("undefined"!==typeof d.url&&""!==d.url?(this.f=new H(this.j,this.S+"-amb",d.url,d.type===g.Na.Be?!0:!1),this.f.volume="number"===typeof d.volume?g.Math.fa(d.volume,0,1):1,this.f.loop="boolean"===typeof d.loop?d.loop:!1,this.f.startTime="number"===typeof d.startTime?
d.startTime:0,!0===("boolean"===typeof d.autoPlay?d.autoPlay:!1)&&this.f.play(this.f.startTime,this.f.loop,!0)):a.type===g.kb.VIDEO&&d.type===g.Na.Be&&(h=!0));if(a.type===g.kb.IMAGE){if(!b.url)throw"Multi resolution not implemented yet !";if(b.format===g.Za.Ng)b={key:a.uid,url:b.url},this.N=new I(this.j,b);else if(b.format===g.Za.Gg)b={key:a.uid,url:b.url},this.N=new I(this.j,b);else if(b.format===g.Za.Og)throw"Flat media not supported yet !";this.N.onLoadComplete.ga(this.u,this)}else if(a.type===
g.kb.VIDEO){if(Array.isArray(b.levels)){b.url=[];for(var d=0,k=b.levels.length;d<k;d++)b.url.push(b.levels[d].url)}b.streaming===g.fb.De?this.N=new J(this.j,a.uid):this.N=new K(this.j,a.uid,null,null,h);this.N.load(b.url);this.N.onLoadedMetaData.ga(this.o,this)}this.i="undefined"!==typeof a.options?a.options:null}Oa.prototype=Object.create(n.prototype);Oa.prototype.constructor=Oa;Oa.prototype.u=function(){this.c&&this.c.H()};
Oa.prototype.o=function(){this.i&&(this.N.volume="number"===typeof this.i.volume?this.i.volume:1,this.N.loop="boolean"===typeof this.i.loop?this.i.loop:!0,!1!==this.i.autoPlay&&this.N.play());this.c&&this.c.H()};Oa.prototype.destroy=function(){this.N&&(this.N.destroy(),this.N=null);this.c&&(this.c.destroy(),this.c=null);this.f&&(this.f.destroy(),this.f=null);this.m=this.j=null};Object.defineProperty(Oa.prototype,"displayObject",{get:function(){return this.N}});
Object.defineProperty(Oa.prototype,"onLoadComplete",{get:function(){this.c||(this.c=new p(this));return this.c}});function x(a){this.j=a;this.c=this.i=this.u=this.f=this.m=this.B=null;this.X=g.Va.Gd;this.D=null;this.G=!1;this.o=this.$=this.M=this.C=this.ha=null;this.P=this.U=!1;this.O=this.K=this.I=this.J=this.F=null;n.call(this,"RenderManager");!0!==this.G&&this.j.onReady.add(this.Dh,this,1E3)}x.prototype=Object.create(n.prototype);e=x.prototype;e.constructor=x;
e.Dh=function(){var a={antialias:!0,alpha:!0,premultipliedAlpha:!1,canvas:this.j.canvas.dom};try{this.B=new THREE.WebGLRenderer(a)}catch(b){this.destroy();return}this.B.autoClear=!1;this.B.autoClearDepth=!0;this.B.autoClearColor=!0;this.$=new THREE.TextureLoader;this.m=new Pa(this.j);this.f=new Qa(this.j);this.f.onDisplayChange.add(this.yi,this);Ra(this,this.f.rendererSize);this.D=new L(this.j);this.M=new Da(this.j);this.j.canvas.onResize.add(this.ci,this);this.j.tour.onSceneLoadStart.add(this.Ch,
this)};
e.Ch=function(){this.j.tour.scene.onUnloadStart.ga(this.Dm,this);var a=this.j.tour.scene.config;this.o=a;"undefined"!==typeof a.background&&(this.j.container.background=a.background);var b=g.L.ib(this.j.config.view,a.view);switch("string"===typeof b.type?b.type.toLowerCase():g.La.Cc){case g.La.Ac:this.wd(g.La.Ac);break;default:this.wd(g.La.Cc)}b=g.L.ib(this.j.config.camera,a.camera);this.D.load(b);"undefined"!==typeof a.media&&"undefined"!==typeof a.media.source?(this.X="cubemap"===a.media.format?g.Va.Ed:
g.Va.Fd,this.i=new Oa(this.j,a.media),this.i.onLoadComplete.ga(this.hm,this),g.L.V(this.i.displayObject,["VideoHTML5","VideoDash"])&&this.i.displayObject.onQualityChange.add(this.Pe,this),this.K&&this.K.H()):Sa(this)};
e.Dm=function(){this.P=this.U=!1;this.M&&this.M.clear();this.m&&this.m.clear();this.o=null;this.i&&(!0===g.L.V(this.i.displayObject,["VideoHTML5","VideoDash"])&&void 0!==this.i.displayObject.onQualityChange&&this.i.displayObject.onQualityChange.has(this.Pe,this)&&this.i.displayObject.onQualityChange.remove(this.Pe,this),this.O&&this.O.H(),this.i.destroy(),this.i=null)};
e.hm=function(a){this.log("Media load is complete");Ta(this,this.X);this.c.displayObject=a.emitter.displayObject;a=null;"undefined"!==typeof this.o.media.fx&&null!==this.o.media.fx&&(a=this.j.postProcessing.ae(this.o.media.fx));this.m.Li(this.c.renderTarget.texture,a);this.M.Vi();this.m.Ni(this.M.renderScenes);"undefined"!==typeof this.o.fx&&this.m.Mi(this.j.postProcessing.ae(this.o.fx));this.U=!0;this.F&&this.F.H()};e.Pe=function(a){this.log("Media quality has changed");this.c.displayObject=a.emitter};
function Ra(a,b){a.log("Renderer size: "+b.width+"x"+b.height);var d=a.f.presentingVR,h=!0;!0===d&&(h=!1);!1===d&&a.f.setSize(b);a.B.setSize(b.width,b.height,h);a.ha=b;a.C=new Ca(b.width*(d?.5:1),b.height);a.c&&a.c.setSize(a.C);a.m.setSize(a.C);a.log("Render size change in "+(d?"VR":"screen")+" mode, resolution: "+a.C.width+"x"+a.C.height)}e.ci=function(){this.log("_canvasResizeHandler");var a=this.j.canvas.dom;Ra(this,new Ca(a.width,a.height))};
e.yi=function(){Ra(this,this.f.rendererSize);this.j.raycaster.mode=!0===this.f.presentingVR?Ia.zc:Ia.cb};function Ta(a,b){var d=null,h=null;a.c&&(null!==a.c.displayObject&&(d=a.c.displayObject),null!==a.c.renderTarget&&(h=a.c.renderTarget));Sa(a);b===g.Va.Fd?(a.c=new Ua(a.j,h),h=a.B.getSize(),Ra(a,new Ca(h.width,h.height))):b===g.Va.Ed&&(b={order:a.o.media.source.order||"RLUDFB",tile:a.o.media.source.tile},b.yn=a.o.media.format,a.c=new Va(a.j,h,b));null!==d&&(a.c.displayObject=d);a.G=!0}
function Sa(a){a.G=!1;a.c&&(a.c.destroy(),a.c=null)}e.render=function(){if(!1!==this.G&&this.m&&(!0===this.U||!0===this.P)){var a=this.f.presentingVR,b=this.f.pj();this.D.update();for(var d=0,h=b.length;d<h;d++){var k=b[d],l=k.rectangle,k=k.camera;this.B.setViewport(l.origin.x,l.origin.y,l.size.width,l.size.height);this.c&&this.c.render((a?k:null)||null);this.m.render(k);this.B.clearDepth();!0===a&&(l=new THREE.Scene,l.add(k),this.B.render(l,k))}!0===this.f.presentingVR&&this.f.Bh()}};
e.screenToWorld=function(a){return this.u.screenToWorld(a)};e.worldToScreen=function(a,b){return this.u.worldToScreen(a,b||0)};e.dl=function(a){this.f.presentingVR!==a&&(this.f.Ah(a),"equi"===this.o.media.format&&(this.X=!0===a?g.Va.Ed:g.Va.Fd,Ta(this,this.X)))};
e.wd=function(a){this.log("setView");this.G=!1;this.u&&(this.log("Destroy previous view"),this.u.destroy(),this.u=null);if(a===g.La.Cc)this.u=new Wa(this.j,this.D);else if(a===g.La.Ac)this.u=new Xa(this.j,this.D);else throw"View type not supported "+a;this.c&&this.c.ic();this.G=!0};
e.destroy=function(){this.j.canvas.onResize.remove(this.ci,this);this.j.tour.onSceneLoadStart.remove(this.Ch,this);this.j.onReady.remove(this.Dh,this);this.F&&(this.F.destroy(),this.F=null);this.J&&(this.J.destroy(),this.J=null);this.I&&(this.I.destroy(),this.I=null);this.i&&(this.i.destroy(),this.i=null);this.$&&(this.$=null);this.u&&(this.u.destroy(),this.u=null);this.c&&(this.c.destroy(),this.c=null);this.D&&(this.D.destroy(),this.D=null);this.f&&(this.f.onDisplayChange.remove(this.yi,this),this.f.destroy(),
this.f=null);this.m&&(this.m.destroy(),this.m=null);this.B=this.o=null};Object.defineProperty(x.prototype,"viewer",{get:function(){return this.j}});Object.defineProperty(x.prototype,"media",{get:function(){return this.i}});Object.defineProperty(x.prototype,"webGLRenderer",{get:function(){return this.B}});Object.defineProperty(x.prototype,"renderPipeline",{get:function(){return this.m}});Object.defineProperty(x.prototype,"backgroundRenderer",{get:function(){return this.c}});
Object.defineProperty(x.prototype,"view",{get:function(){return this.u},set:function(a){if("string"===typeof a&&""!==a)switch(a){case g.La.Ac:this.wd(g.La.Ac);break;case g.La.Cc:this.wd(g.La.Cc);break;default:throw"View type not supported: "+a;}}});Object.defineProperty(x.prototype,"camera",{get:function(){return this.D}});Object.defineProperty(x.prototype,"canvasResolution",{get:function(){return this.ha}});Object.defineProperty(x.prototype,"displayResolution",{get:function(){return this.C}});
Object.defineProperty(x.prototype,"presentingVR",{get:function(){return this.f.presentingVR}});Object.defineProperty(x.prototype,"display",{get:function(){return this.f}});Object.defineProperty(x.prototype,"textureLoader",{get:function(){return this.$}});Object.defineProperty(x.prototype,"backgroundReady",{get:function(){return this.U}});Object.defineProperty(x.prototype,"onBackgroundReady",{get:function(){this.F||(this.F=new p(this,!0));return this.F}});
Object.defineProperty(x.prototype,"objects",{get:function(){return this.M}});Object.defineProperty(x.prototype,"hotspotsReady",{get:function(){return this.P}});Object.defineProperty(x.prototype,"onHotspotsReady",{get:function(){this.J||(this.J=new p(this,!0));return this.J}});Object.defineProperty(x.prototype,"onReady",{get:function(){this.I||(this.I=new p(this));return this.I}});Object.defineProperty(x.prototype,"onMediaReady",{get:function(){this.K||(this.K=new p(this));return this.K}});
Object.defineProperty(x.prototype,"onMediaRelease",{get:function(){this.O||(this.O=new p(this));return this.O}});
function Ha(a,b,d,h){this.j=a;this.m=b;this.f=d;this.i=h;this.c=null;n.call(this,"RenderScene");this.c=new THREE.EffectComposer(this.j.renderer.webGLRenderer);a=new THREE.RenderPass(this.m,this.f);a.ken={};a.ken.pipelinePosition="render";this.c.addPass(a);a=this.j.postProcessing.qe(this.i);b=0;for(d=a.length;b<d;b++)h=a[b],h.renderToScreen=!1,h.ken.pipelinePosition="render",this.c.addPass(h)}Ha.prototype=Object.create(n.prototype);Ha.prototype.constructor=Ha;
Ha.prototype.setSize=function(a,b){this.c.setSize(a,b)};Ha.prototype.destroy=function(){this.c.readBuffer.dispose();for(this.c.writeBuffer.dispose();0<this.c.passes.length;){var a=this.c.passes.pop();a instanceof THREE.TexturePass&&a.hasOwnProperty("tDiffuse")&&(a.uniforms.tDiffuse.value.texture.dispose(),a.uniforms.tDiffuse.value=null)}this.i=this.f=this.m=this.j=this.c=null};Object.defineProperty(Ha.prototype,"scene",{get:function(){return this.m}});
Object.defineProperty(Ha.prototype,"sceneComposer",{get:function(){return this.c}});function Pa(a){this.j=a;this.i=this.f=this.c=null;this.m=!0;n.call(this,"RenderPipeline");this.i=new THREE.Clock;this.f=[];this.c=new THREE.EffectComposer(this.j.renderer.webGLRenderer);this.c.ken={};this.c.ken.name="RenderComposer"}Pa.prototype=Object.create(n.prototype);e=Pa.prototype;e.constructor=Pa;
function Ya(a,b){a.log("COMPOSER: "+b.ken.name);for(var d=[],h=0,k=b.passes.length;h<k;h++){var l;l=b.passes[h];l=l instanceof THREE.TexturePass?l.hasOwnProperty("map")?"Texture("+l.map.uuid.split("-")[0].slice(0,4)+")":"Texture":l instanceof THREE.RenderPass?"Render":l instanceof THREE.ClearMaskPass?"ClearMask":l instanceof THREE.MaskPass?"Mask":l instanceof THREE.ShaderPass?l.hasOwnProperty("ken")?"Shader("+l.ken.type.replace("Shader","")+")":"Shader":"Pass";d.push(l)}h="";k=0;for(l=d.length;k<
l;k++){for(var q=d[k],h=h+"| ",t=0;t<q.length;t++)h+="-";h+=" |";if(k<l-1)for(q=0;5>q;q++)h+=" "}a.log(h);k="";l=0;for(q=d.length;l<q;l++)k+="| "+d[l]+" |",l<q-1&&(k+=" --- ");!1===b.passes[b.passes.length-1].renderToScreen&&(k+=" --- tex");a.log(k);a.log(h)}function Za(a){for(var b=0,d=a.f.length;b<d;b++)Ya(a,a.f[b]);Ya(a,a.c)}
function $a(a,b,d){d="undefined"!==typeof d?d:a.passes.length;if(Array.isArray(b))for(var h=b.length-1;0<=h;h--)a.insertPass(b[h],d);else b instanceof THREE.Pass&&a.insertPass(b,d)}
function ab(a){var b=a.c.passes,d=[];b.filter(function(a,b){"background"===a.ken.pipelinePosition&&d.push(b)});if(0<d.length&&0<d[0]){for(var h=[],k=d.length-1;0<=k;k--){var l=b.splice(d[k],1)[0];h.push(l)}k=0;for(l=h.length;k<l;k++)a.c.insertPass(h[k],0)}var q=[];b.filter(function(a,b){"global"===a.ken.pipelinePosition&&q.push(b)});if(0<q.length&&q[q.length-1]<b.length-1){h=[];k=0;for(l=q.length;k<l;k++){var t=b.splice(q[k],1)[0];h.push(t)}k=0;for(l=h.length;k<l;k++)a.c.addPass(h[k])}h=0;for(k=a.f.length;h<
k;h++)for(var l=a.f[h],t=0,y=l.passes.length;t<y;t++)l.passes[t].clear=!t;h=!1;for(k=b.length-1;0<=k;k--)l=b[k],!0===h?l.renderToScreen=!1:!0===l.enabled&&(h=l.renderToScreen=!0);Za(a)}e.Li=function(a,b){if("undefined"!==typeof b&&b&&0<b.length){b=this.j.postProcessing.qe(b);for(var d=0,h=b.length;d<h;d++)b[d].ken.pipelinePosition="background";$a(this.c,b,0)}a=new THREE.TexturePass(a);a.ken={};a.ken.pipelinePosition="background";this.c.insertPass(a,0);ab(this)};
e.Ni=function(a){for(var b=0,d=a.length;b<d;b++){var h=a[b].sceneComposer;h.ken={};h.ken.name="SubComposer-"+this.f.length;h.ken.enabled=!0;this.f.push(h);h=new THREE.ShaderPass(THREE.hk);h.ken={};h.ken.type="Addition";h.ken.subComposerIndex=this.f.length-1;this.c.addPass(h);ab(this)}ab(this)};e.Mi=function(a){a=this.j.postProcessing.qe(a);for(var b=0,d=a.length;b<d;b++)a[b].ken.pipelinePosition="global";$a(this.c,a);ab(this)};
e.jn=function(a){if(this.c)for(var b=0,d=this.c.passes.length;b<d;b++){var h=this.c.passes[b];if(h.hasOwnProperty("ken")&&h.ken.uid===a)return h}if(this.f)for(b=0,d=this.f.length;b<d;b++)for(var h=this.f[b],k=0,l=h.passes.length;k<l;k++){var q=h.passes[k];if(q.hasOwnProperty("ken")&&q.ken.uid===a)return q}return null};
e.setSize=function(a){for(var b=0,d=this.f.length;b<d;b++){var h=this.f[b];h.setSize(a.width,a.height);for(var k=0,l=h.passes.length;k<l;k++){var q=h.passes[k];q instanceof THREE.ShaderPass&&"undefined"!==typeof q.uniforms.gg&&(q.uniforms.gg.value=new THREE.Vector2(1/a.width,1/a.height))}}this.c.setSize(a.width,a.height);k=0;for(l=this.c.passes.length;k<l;k++)q=this.c.passes[k],q instanceof THREE.ShaderPass&&"undefined"!==typeof q.uniforms.gg&&(q.uniforms.gg.value=new THREE.Vector2(1/a.width,1/a.height))};
e.render=function(a){if(this.c){for(var b=0,d=this.c.passes.length;b<d;b++){var h=this.c.passes[b];if(h.ken.hasOwnProperty("subComposerIndex")){var k=this.f[h.ken.subComposerIndex],l=k.passes[k.passes.length-1];h.uniforms.tAdd.value=!1===k.ken.enabled||l instanceof THREE.RenderPass?k.readBuffer.texture:k.writeBuffer.texture}}b=this.i.getDelta();d=this.f.concat(this.c);h=0;for(k=d.length;h<k;h++)for(var l=d[h],q=0,t=l.passes.length;q<t;q++){var y=l.passes[q];y instanceof THREE.RenderPass&&(y.camera=
a)}a=0;for(d=this.f.length;a<d;a++)this.f[a].render(b);this.c.render(b)}};e.clear=function(){if(this.c){this.c.readBuffer.dispose();this.c.writeBuffer.dispose();for(var a=0,b=this.c.passes.length;a<b;a++){var d=this.c.passes[a];d instanceof THREE.ShaderPass&&d.uniforms.hasOwnProperty("tAdd")&&(d.uniforms.tAdd.value=null)}this.c.passes=[]}this.f=[]};e.destroy=function(){this.clear();this.j=this.c=this.f=this.i=null};
Object.defineProperty(Pa.prototype,"enabled",{get:function(){return this.m},set:function(a){for(var b=this.f.concat(this.c),d=0,h=b.length;d<h;d++){var k=b[d],l=a;!1===l&&(this.m=!1);for(var q=k.passes.length-1;0<=q;q--){var t=k.passes[q];t instanceof THREE.ShaderPass&&(!0!==t.hasOwnProperty("ken")||"Addition"!==t.ken.type)&&(t.enabled=l)}!0===k.hasOwnProperty("ken")&&k.ken.hasOwnProperty("enabled")&&(k.ken.enabled=l);ab(this)}this.m=a}});
function Qa(a){this.j=a;this.o=this.F=!1;this.u=this.f=this.m=this.i=this.c=null;this.I=1;this.D=this.B=null;n.call(this,"RenderDisplay");bb(this)}Qa.prototype=Object.create(n.prototype);e=Qa.prototype;e.constructor=Qa;
function bb(a){var b=a.j.renderer.webGLRenderer;a.I=b.getPixelRatio();a.u=b.getSize();a.f=a.u;a.i=[0,0,.5,1];a.m=[.5,0,.5,1];"VRFrameData"in window&&(a.B=new VRFrameData);!0===g.A.xg?(navigator.getVRDisplays().then(function(b){a.F=0<b.length;for(var d=0,k=b.length;d<k;d++)if("VRDisplay"in window&&b[d]instanceof VRDisplay){a.c=b[d];break}}),cb(a)):a.warn("missing api navigator.getVRDisplays")}
function cb(a){a.j.container.onFullscreenEnter.add(a.Kc,a);a.j.container.onFullscreenExit.add(a.Kc,a);window.addEventListener("vrdisplaypresentchange",a.Kc.bind(a),!1)}
e.Kc=function(){var a=this.o,b=this.j.renderer.webGLRenderer;this.o="undefined"!==typeof this.c&&(!0===this.c.isPresenting||!1===this.F&&document[g.A.fullscreenElement]instanceof window.HTMLElement);if(!0===this.o){var d=this.c.getEyeParameters("left");!0===this.F&&(this.G=d.renderWidth,this.C=d.renderHeight,this.log("Window size: "+window.innerWidth+"x"+window.innerHeight),this.log("Render size: "+this.G+"x"+this.C),this.i=[0,0,.5,1],this.m=[.5,0,.5,1],this.c.getLayers&&(d=this.c.getLayers(),0<d.length&&
d[0].leftBounds&&4===d[0].leftBounds.length&&(this.i=d[0].leftBounds,this.m=d[0].rightBounds)),this.log("Bounds L:["+this.i[0]+", "+this.i[1]+", "+this.i[2]+", "+this.i[3]+"], R:["+this.m[0]+", "+this.m[1]+", "+this.m[2]+", "+this.m[3]+"]"));!1===a&&(this.I=b.getPixelRatio(),this.u=b.getSize(),this.f=new Ca(2*this.G,this.C),b.setPixelRatio(1))}else!0===a&&(this.f=this.u,b.setPixelRatio(this.I));this.o!==a&&this.D&&this.D.H()};
function db(a,b){var d=a.j.renderer.webGLRenderer.domElement;new Promise(function(a,k){"undefined"===typeof this.c?k(Error("No VR hardware found.")):this.o===b?a():!0===this.F&&(b?a(this.c.requestPresent([{source:d}])):a(this.c.exitPresent()))}.bind(a))}e.Ah=function(a){!0===a?(this.j.raf.stop(),this.j.raf.start(this.c),db(this,!0)):(this.j.raf.stop(),this.j.raf.start(window),db(this,!1))};
e.nj=function(){if(!this.c)return null;var a=new THREE.Quaternion;if("function"===typeof this.c.getPose){var b=this.c.getPose();b.orientation&&(a=b.orientation,a=new THREE.Quaternion(-a[1],-a[0],-a[2],a[3]))}return a};
e.pj=function(){var a=this.j.renderer.camera,b=[];if("undefined"!==typeof this.c&&this.c&&!0===this.o){var d=this.f.width*this.i[0],h=this.f.height*this.i[1],k=this.f.width*this.i[2],l=this.f.height*this.i[3],q=new Ba(d,h,k,l),d=this.f.width*this.m[0],h=this.f.height*this.m[1],k=this.f.width*this.m[2],l=this.f.height*this.m[3],d=new Ba(d,h,k,l);b.push(new eb(q,a.left));b.push(new eb(d,a.right))}else b.push(new eb(new Ba(0,0,this.u.width,this.u.height),a.main));return b};
e.setSize=function(a){this.u=a;this.j.renderer.webGLRenderer.setPixelRatio(1)};e.Bh=function(){!0===this.F&&"undefined"!==typeof this.c&&!0===this.o&&!0===this.c.capabilities.hasExternalDisplay&&this.c.submitFrame()};e.destroy=function(){this.j.container.onFullscreenEnter.remove(this.Kc,this);this.j.container.onFullscreenExit.remove(this.Kc,this);window.removeEventListener("vrdisplaypresentchange",this.Kc.bind(this));this.j=this.f=this.m=this.i=this.B=this.c=null};
Object.defineProperty(Qa.prototype,"presentingVR",{get:function(){return this.o}});Object.defineProperty(Qa.prototype,"vrDisplay",{get:function(){return this.c}});Object.defineProperty(Qa.prototype,"vrFrameData",{get:function(){return this.c&&"function"===typeof this.c.getFrameData&&this.B?(this.c.getFrameData(this.B),this.B):null}});Object.defineProperty(Qa.prototype,"rendererSize",{get:function(){return this.f}});
Object.defineProperty(Qa.prototype,"onDisplayChange",{get:function(){this.D||(this.D=new p(this));return this.D}});function eb(a,b){this.f=a||null;this.c=b||null}eb.prototype.constructor=eb;Object.defineProperty(eb.prototype,"rectangle",{get:function(){return this.f}});Object.defineProperty(eb.prototype,"camera",{get:function(){return this.c}});function fb(a,b,d){this.j=a;this.I=this.m=this.f=null;this.B=b||null;n.call(this,d||"BackgroundRenderer");this.Wc()}fb.prototype=Object.create(n.prototype);
e=fb.prototype;e.constructor=fb;e.Wc=function(){this.m=new THREE.Scene;this.B||(this.B=new THREE.WebGLRenderTarget(this.j.renderer.canvasResolution.width,this.j.renderer.canvasResolution.height,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,Wn:!1}))};e.ic=function(){throw Error(this.ab+"::updateAfterViewChange not implemented");};e.setSize=function(a){null!==this.renderTarget&&this.renderTarget.setSize(a.width,a.height)};
e.render=function(a){if(null!==this.j.renderer&&this.B){if(this.f.material instanceof THREE.ShaderMaterial){var b=this.j.renderer.displayResolution;this.f.material.uniforms.hasOwnProperty("tViewportResolution")&&(this.f.material.uniforms.tViewportResolution.value=new THREE.Vector2(b.width,b.height));this.f.material.uniforms.hasOwnProperty("tViewportResolutionRatio")&&(this.f.material.uniforms.tViewportResolutionRatio.value=b.ratio);this.f.material.uniforms.hasOwnProperty("tModelViewMatrixInverse")&&
(this.f.material.uniforms.tModelViewMatrixInverse.value=this.j.renderer.camera.modelViewInverse);this.j.renderer.view.Sc(this.f.material.uniforms)}a?this.j.renderer.webGLRenderer.render(this.m,a,this.B,!0):this.j.renderer.webGLRenderer.render(this.m,this.I,this.B,!0)}};e.destroy=function(){this.I=null;this.B&&(this.B.dispose(),this.B=null);for(;0<this.m.children.length;){var a=this.m.children.pop();null!==a.geometry&&(a.geometry.dispose(),a.geometry=null);this.m.remove(a)}this.j=this.m=null;n.prototype.destroy.call(this)};
Object.defineProperty(fb.prototype,"renderTarget",{get:function(){return this.B}});Object.defineProperty(fb.prototype,"displayObject",{get:function(){return this.N},set:function(a){null===a?this.Kd():this.Di(a)}});g.Va={};g.Va.Gd="undefined";g.Va.Fd="shader";g.Va.Ed="mesh";function Va(a,b,d){this.D=this.u=this.c=this.N=null;this.J=d.order||"RLUDFB";this.i=new THREE.Vector2(0,0);this.M=d.tile;this.C=d.yn||"cubemap";this.o=this.F=0;this.G=1;fb.call(this,a,b,"BackgroundMeshRenderer")}Va.prototype=Object.create(fb.prototype);
e=Va.prototype;e.constructor=Va;e.Wc=function(){fb.prototype.Wc.call(this);this.I=this.j.renderer.camera.main;this.j.renderer.camera.fovMin=this.j.renderer.view.fovMin;this.j.renderer.camera.fovMax=this.j.renderer.view.fovMax;this.F=1E4;this.o=32;this.ic()};
e.Di=function(a){this.N=a;if(g.L.V(a,"Image"))this.c=new THREE.Texture,this.c.image=a.element;else if(g.L.V(a,"Canvas"))this.c=new THREE.Texture,this.c.image=a.element;else if(g.L.V(a,["VideoHTML5","VideoDash"]))"safari"===g.A.tb.toLowerCase()&&1440<a.originalHeight&&(this.G=2),this.u=document.createElement("canvas"),this.u.width=a.originalWidth/this.G,this.u.height=a.originalHeight/this.G,this.D=this.u.getContext("2d"),this.c=new THREE.Texture(this.u);else throw"Wrong type of display object "+a.type;
this.c.format=THREE.RGBAFormat;this.c.mapping=THREE.Texture.DEFAULT_MAPPING;this.c.magFilter=THREE.LinearFilter;this.c.minFilter=THREE.LinearFilter;this.c.wrapS=THREE.ClampToEdgeWrapping;this.c.wrapT=THREE.ClampToEdgeWrapping;this.c.generateMipmaps=!1;this.c.needsUpdate=!0;this.i.x=this.c.image.width/this.M;this.i.y=this.c.image.height/this.M;"equi"===this.C?(this.f.material.uniforms.tEquirect.value=this.c,this.f.material.uniforms.tFlip.value=-1):this.f.material.map=this.c};
function gb(a){function b(a,b,k,Yb,Db){if(-1===a)throw"Unknown face for cube mapping.";var C,xb=a%b/b;a=1-(1+parseInt(a/b,10))/k;if(Db)for(Db=0,k=Yb;Db<=k;Db++)for(b=0,C=Yb;b<=C;b++)d[h.next().value]=t+l*b+xb,d[h.next().value]=y+q*Db+a;else for(Db=0,k=Yb;Db<=k;k--)for(b=0,C=Yb;b<=C;C--)d[h.next().value]=t+l*C+xb,d[h.next().value]=y+q*k+a}var d=new Float32Array((a.o+1)*(a.o+1)*12),h=d.keys(),k=a.J.split(""),l=1/1.01*(1/a.i.x/a.o),q=1/1.01*(1/a.i.y/a.o),t=1/a.i.x*.005,y=1/a.i.y*.005;b(k.indexOf("R"),
a.i.x,a.i.y,a.o);b(k.indexOf("L"),a.i.x,a.i.y,a.o);b(k.indexOf("U"),a.i.x,a.i.y,a.o,!0);b(k.indexOf("D"),a.i.x,a.i.y,a.o,!0);b(k.indexOf("B"),a.i.x,a.i.y,a.o);b(k.indexOf("F"),a.i.x,a.i.y,a.o);return d}
e.render=function(a){if(null!==this.j.renderer){if(this.c&&this.u&&this.D&&this.N&&null!==this.N.element){var b=this.N.element;b&&b.readyState===b.HAVE_ENOUGH_DATA&&this.D&&(this.D.drawImage(b,0,0,b.videoWidth,b.videoHeight,0,0,this.u.width,this.u.height),this.c.needsUpdate=!0,this.log("texture update done"))}fb.prototype.render.call(this,a)}};e.Kd=function(){this.j.renderer.webGLRenderer.clearColor()};
e.ic=function(){var a=this.j.renderer.view.Nc,a="equi"===this.C?a.equirectangular:a.mapping,a=new THREE.ShaderMaterial({fragmentShader:a.fragmentShader,vertexShader:a.vertexShader,uniforms:a.uniforms,Sn:!1,side:THREE.BackSide}),b;this.c&&("equi"===this.C&&"undefined"!==typeof a.uniforms?(a.uniforms.tEquirect.value=this.c,a.uniforms.tFlip.value=-1):a.map=this.c);0===this.m.children.length?(b=new THREE.BoxBufferGeometry(this.F,this.F,this.F,this.o,this.o,this.o),"equi"!==this.C&&b.attributes.uv.set(gb(this)),
this.f=new THREE.Mesh(b,a),this.m.add(this.f)):(this.f=this.m.children[0],this.f.material=null);this.f.material=a;a.needsUpdate=!0};e.destroy=function(){this.Kd();this.D=this.u=this.N=null;this.c&&(this.c.dispose(),this.c=null);fb.prototype.destroy.call(this)};Object.defineProperty(Va.prototype,"texture",{get:function(){return this.c}});function Ua(a,b){this.o=this.i=this.c=this.N=null;this.u=1;fb.call(this,a,b,"BackgroundShaderRenderer")}Ua.prototype=Object.create(fb.prototype);e=Ua.prototype;
e.constructor=Ua;e.Wc=function(){fb.prototype.Wc.call(this);this.ic();this.I=new THREE.OrthographicCamera(-1,1,1,-1,-1,1)};
e.Di=function(a){this.N=a;if(g.L.V(a,"Image")||g.L.V(a,"Canvas"))this.c=new THREE.Texture,this.c.image=a.element;else if(g.L.V(a,["VideoHTML5","VideoDash"]))"safari"===g.A.tb.toLowerCase()&&1440<a.originalHeight&&(this.u=2),this.N.onQualityChange.has(this.Xc,this)&&this.N.onQualityChange.remove(this.Xc,this),this.N.onQualityChange.add(this.Xc,this),this.i=document.createElement("canvas"),this.i.width=a.originalWidth/this.u,this.i.height=a.originalHeight/this.u,this.o=this.i.getContext("2d"),this.c=
new THREE.Texture(this.i);else throw"Wrong type of display object "+a.className;this.c.format=THREE.RGBFormat;this.c.mapping=THREE.Texture.DEFAULT_MAPPING;this.c.magFilter=THREE.LinearFilter;this.c.minFilter=THREE.LinearFilter;this.c.wrapS=THREE.ClampToEdgeWrapping;this.c.wrapT=THREE.ClampToEdgeWrapping;this.c.generateMipmaps=!1;this.c.needsUpdate=!0;this.f.material.uniforms.tEquirect.value=this.c};
e.Xc=function(a){this.log("Media quality has changed");a=a.emitter;this.i.width=a.originalWidth/this.u;this.i.height=a.originalHeight/this.u};e.Kd=function(){this.j.renderer.webGLRenderer.clearColor()};
e.render=function(){if(null!==this.j.renderer){if(this.c&&this.i&&this.o&&this.N&&null!==this.N.element){var a=this.N.element;a instanceof HTMLVideoElement&&a.readyState===a.HAVE_ENOUGH_DATA&&this.o&&(this.o.drawImage(a,0,0,a.videoWidth,a.videoHeight,0,0,this.i.width,this.i.height),this.c.needsUpdate=!0,this.log("texture update done"))}fb.prototype.render.call(this,null)}};
e.ic=function(){var a=this.j.renderer.view.Mc,b=g.ShaderLib.pe(a.vertexShader),d=g.ShaderLib.pe(a.fragmentShader),a=new THREE.ShaderMaterial({uniforms:a.uniforms,vertexShader:b,fragmentShader:d,side:THREE.FrontSide});this.c&&(a.uniforms.tEquirect.value=this.c);0===this.m.children.length?(b=new THREE.PlaneBufferGeometry(2,2),this.f=new THREE.Mesh(b,a),this.m.add(this.f)):(this.f=this.m.children[0],this.f.material=null);this.f.material=a;a.needsUpdate=!0};
e.destroy=function(){this.Kd();"undefined"!==typeof this.N.onQualityChange&&this.N.onQualityChange.has(this.Xc,this)&&this.N.onQualityChange.remove(this.Xc,this);this.o=this.i=this.N=null;this.c&&(this.c.dispose(),this.c=null);fb.prototype.destroy.call(this)};Object.defineProperty(Ua.prototype,"texture",{get:function(){return this.c}});
THREE.hk={uniforms:{tDiffuse:{value:null},tAdd:{value:null}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float tRatio;\nuniform sampler2D tDiffuse;\nuniform sampler2D tAdd;\nvarying vec2 vUv;\nvoid main() {\nvec4 texel = texture2D( tDiffuse, vUv );\nvec4 texelAdd = texture2D( tAdd, vUv );\ngl_FragColor = vec4(vec3(texelAdd.a * texelAdd.rgb + (1.0 - texelAdd.a) * texel.rgb), 1.0);\n}"};
function oa(a){this.j=a;this.c=this.f=null;n.call(this,"PostProcessing");this.c={}}oa.prototype=Object.create(n.prototype);e=oa.prototype;e.constructor=oa;
e.qe=function(a){if("undefined"===typeof a||null===a||0===a.length)return[];for(var b=[],d=0,h=a.length;d<h;d++){var k=a[d],l;if(THREE.hasOwnProperty(k.type)){l=new hb(THREE[k.type],k.uid,k.type);if("undefined"!==typeof l.uniforms)for(var q in k.params){var t=k.params[q],y=t;if("object"===typeof t&&t.hasOwnProperty("type")&&t.hasOwnProperty("args")){var C=t.args;switch(t.type){case "THREE.Color":if(3===C.length)y=new THREE.Color(C[0],C[1],C[2]);else if("string"===typeof C||"number"===typeof C)y=new THREE.Color(C);
else throw Error("Cannot create THREE.Color with "+typeof C+" (length "+C.length+")");break;case "THREE.Vector2":y=new THREE.Vector2(C[0],C[1]);break;case "THREE.Vector3":y=new THREE.Vector3(C[0],C[1],C[2])}}l.uniforms[q].value=y}b.push(l)}else this.warn("Unknown image effect ("+k.type+")")}return b};e.ae=function(a){return this.c[a]};
e.na=function(a){a=this.f=a;this.S=a.uid;if("undefined"!==typeof a.fxSets&&0<a.fxSets.length)for(var b=0,d=a.fxSets.length;b<d;b++){var h=a.fxSets[b];this.c[h.uid]=h.set}};e.destroy=function(){this.c=this.j=null};function hb(a,b,d){THREE.ShaderPass.call(this,a,"tDiffuse");this.ken={uid:b,type:d}}hb.prototype=Object.create(THREE.ShaderPass.prototype);hb.prototype.constructor=hb;
hb.prototype.render=function(a,b,d,h,k){this.uniforms.time&&(this.uniforms.time.value=h);THREE.ShaderPass.prototype.render.call(this,a,b,d,h,k)};hb.prototype.destroy=function(){this.ken=null};g.ShaderChunk={};g.ShaderChunk.coordinates="\r\nvec3 toCartesian(in vec3 rtp) {\r\n    float r = rtp.x;\r\n    float theta = rtp.y;\r\n    float phi = rtp.z;\r\n    float x = r * cos(phi) * sin(theta);\r\n    float y = r * sin(phi);\r\n    float z = r * cos(phi) * cos(theta);\r\n    return vec3(x,y,z);\r\n}\r\n\r\n\r\n\r\nvec3 toSpherical(in vec3 pt) {\r\n    float r = length(pt);\r\n    float theta = -atan(pt.x, pt.z);\r\n    float phi = asin(pt.y / r);\r\n    return vec3(r,theta,phi);\r\n}\r\n\r\n";
g.ShaderChunk.defines="\r\n\r\n#define PI  3.141592653589793\r\n#define PI2 6.28318530717959\r\n\r\n";g.ShaderChunk.helpers="\r\nfloat wrap(in float x, in float min, in float max) {\r\n    return x - ((max - min) * (1.0 - step(x, min) - step(x, max)));\r\n}\r\n\r\n\r\n\r\nvec2 getFragment() {\r\n    return (2.0 * gl_FragCoord.xy / tViewportResolution - 1.0) * vec2(tViewportResolutionRatio, 1.0);\r\n}\r\n\r\n";g.ShaderChunk.texcoords="\r\n\r\nvec2 toEquirectangularTexCoords(in vec2 thetaphi) {\r\n    thetaphi.x = wrap(thetaphi.x + PI, -PI, PI);\r\n    vec2 texel = 0.5 + thetaphi / vec2(PI2, PI);\r\n    return texel;\r\n}\r\n\r\n";
g.ShaderChunk.stw_frag_proj_gopro="// Screen to world GoPro projection \r\n\r\n#include <defines>\r\n\r\nuniform sampler2D tEquirect;\r\nuniform vec2 tViewportResolution;\r\nuniform float tViewportResolutionRatio;\r\nuniform mat4 tModelViewMatrixInverse;\r\nuniform float tProjectionDistance;\r\nuniform float tProjectionScale;\r\n\r\n#include <helpers>\r\n#include <coordinates>\r\n#include <texcoords>\r\n\r\nvec2 projection() {\r\n    vec2 frag = getFragment();\r\n    vec2 c = tProjectionScale * frag;\r\n    float zs = tProjectionDistance;\r\n    float xy2 = dot(c,c);\r\n    float zs12 = (zs+1.0)*(zs+1.0);\r\n    float delta = 4.0*(zs*zs*xy2*xy2 - (xy2+zs12)*(xy2*zs*zs-zs12));\r\n    if (delta < 0.0) {return vec2(-1.);}\r\n    float z = (2.0*zs*xy2 - sqrt(delta)) / (2.0 * (zs12 + xy2));\r\n    float x = c.x * ((zs-z) / (zs+1.0));\r\n    float y = c.y * ((zs-z) / (zs+1.0));\r\n    vec3 vx = vec3(tModelViewMatrixInverse * vec4(x, y, z, 1.0));\r\n    return toSpherical(vx).yz;\r\n}\r\n\r\nvoid main() {\r\n    vec2 texCoords = toEquirectangularTexCoords(projection());\r\n    gl_FragColor = vec4(texture2D(tEquirect, texCoords).rgb, 1.0);\r\n}\r\n";
g.ShaderChunk.stw_frag_proj_rectilinear="// Screen to world rectilinear projection \r\n\r\n#include <defines>\r\n\r\nuniform sampler2D tEquirect;\r\nuniform vec2 tViewportResolution;\r\nuniform float tViewportResolutionRatio;\r\nuniform mat4 tModelViewMatrixInverse;\r\nuniform float tProjectionScale;\r\n\r\n#include <helpers>\r\n#include <coordinates>\r\n#include <texcoords>\r\n\r\nvec2 projection() {\r\n    // [-1 .. 1 , -1 .. 1]\r\n    vec2 frag = tProjectionScale * getFragment();\r\n\r\n    // Screen point is on the zn plane, expressed it in clip space\r\n    vec4 screenPT = vec4(frag, -1.0, 1.0);\r\n\r\n    // World space point\r\n    vec4 worldPT = tModelViewMatrixInverse * screenPT;\r\n\r\n    // Spherical point for texture lookup\r\n    return toSpherical(worldPT.xyz).yz;\r\n}\r\n\r\nvoid main() {\r\n    vec2 texCoords = toEquirectangularTexCoords(projection());\r\n    gl_FragColor = vec4(texture2D(tEquirect, texCoords).rgb, 1.0);\r\n}\r\n";
g.ShaderChunk.stw_vert_proj="// Vertex projection screen to world\r\n\r\n#include <common>\r\n\r\nvoid main() {\r\n   gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\r\n}\r\n\r\n";g.ShaderChunk.wts_frag="// Fragment shader mapping a world position to a point in equirectangular texture space \r\n\r\nuniform sampler2D tTexture;\r\nvarying vec3 vUV;\r\n\r\n#include <common>\r\n\r\nvoid main() {\r\n\r\n    gl_FragColor = texture2D( tTexture, vUV );\r\n}\r\n";
g.ShaderChunk.wts_frag_depth_drawing="// Fragment shader drawing depth of every fragment\r\n\r\nvarying float vDepth;\r\n\r\nvoid main() {\r\n    gl_FragColor = vec4(vDepth, vDepth, vDepth, 1.0);\r\n}\r\n";g.ShaderChunk.wts_frag_equirectangular="// Fragment shader mapping a world position to a point in equirectangular texture space \r\n\r\nuniform sampler2D tEquirect;\r\nvarying vec3 vWorldPosition;\r\n\r\n#include <common>\r\n\r\nvoid main() {\r\n    vec3 direction = normalize( vWorldPosition );\r\n\r\n    vec2 sampleUV;\r\n    sampleUV.y = saturate( direction.y * 0.5 + 0.5 );\r\n    sampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 - 0.25;\r\n    sampleUV.x += (1.0 - step(0.0, sampleUV.x));\r\n\r\n    gl_FragColor = texture2D( tEquirect, sampleUV );\r\n}\r\n";
g.ShaderChunk.wts_vert_gopro="// Vertex shader providing a varying world position\r\n\r\nuniform float tProjectionDistance;\r\nuniform float tProjectionScale;\r\n\r\nvarying vec2 vUv;\r\n\r\n#include <common>\r\n\r\n\r\nvoid main() {\r\n    vUV = uv;\r\n\r\n    vec3 transformed = vec3( position );\r\n    vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\r\n\r\n    float xyfrac = (tProjectionDistance + 1.0) / (tProjectionDistance - mvPosition.z);\r\n    vec2 pt = (1.0 / tProjectionScale) * mvPosition.xy * xyfrac;\r\n    \r\n    gl_Position = vec4(pt, length(pt), 1.0);\r\n}\r\n";
g.ShaderChunk.wts_vert_gopro_equirectangular="varying vec3 vWorldPosition;\r\nvarying float vDepth;\r\n\r\nuniform float tProjectionDistance;\r\nuniform float tProjectionScale;\r\nuniform float tViewportResolutionRatio;\r\n\r\n\r\n#include <common>\r\n\r\nvoid main() {\r\n    vec4 camPt = vec4(transformDirection(position, modelViewMatrix), 1.0);\r\n    camPt.z -= tProjectionDistance * distance(camPt, vec4(vec3(0.0), 1.0));\r\n    camPt.xyz /= tProjectionScale;\r\n\r\n    gl_Position = projectionMatrix * normalize(camPt);\r\n\r\n    vDepth = gl_Position.z;\r\n    vWorldPosition = vec3(position);\r\n}\r\n";
g.ShaderChunk.wts_vert_littleplanet_equirectangular="varying vec3 vWorldPosition;\r\nvarying float vDepth;\r\n\r\nuniform float tProjectionScale;\r\nuniform float tViewportResolutionRatio;\r\n\r\n\r\n#include <common>\r\n\r\nvoid main() {\r\n    vec4 camPt = vec4(transformDirection(position, modelViewMatrix), 1.0);\r\n    camPt.z -= distance(camPt, vec4(vec3(0.0), 1.0));\r\n    camPt.xyz /= tProjectionScale;\r\n\r\n    gl_Position = projectionMatrix * normalize(camPt);\r\n\r\n    vDepth = gl_Position.z;\r\n    vWorldPosition = vec3(position);\r\n}\r\n";
g.ShaderChunk.wts_vert_rectilinear="// Vertex shader providing a varying world position\r\n\r\nuniform float tProjectionScale;\r\n\r\nvarying vec3 vWorldPosition;\r\n\r\n#include <common>\r\n\r\nvoid main() {\r\n    vWorldPosition = transformDirection( position, modelMatrix );\r\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\r\n}\r\n";g.ShaderChunk.wts_vert_rectilinear_equirectangular="varying vec3 vWorldPosition;\r\nvarying float vDepth;\r\n\r\nuniform float tFarPlane;\r\nuniform float tViewportResolutionRatio;\r\n\r\nvoid main() {\r\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\r\n\r\n    vDepth = gl_Position.z / tFarPlane;\r\n    vWorldPosition = vec3( position );\r\n}\r\n";
g.ShaderLib={screenToWorld:{rectilinear:{uniforms:{tEquirect:{type:"t",value:null},tViewportResolution:{type:"v2",value:new THREE.Vector2},tViewportResolutionRatio:{type:"f",value:1},tModelViewMatrixInverse:{type:"m4",value:new THREE.Matrix4},tProjectionScale:{type:"f",value:1}},vertexShader:g.ShaderChunk.stw_vert_proj,fragmentShader:g.ShaderChunk.stw_frag_proj_rectilinear},gopro:{uniforms:{tEquirect:{type:"t",value:null},tViewportResolution:{type:"v2",value:new THREE.Vector2},tViewportResolutionRatio:{type:"f",
value:1},tModelViewMatrixInverse:{type:"m4",value:new THREE.Matrix4},tProjectionDistance:{type:"f",value:0},tProjectionScale:{type:"f",value:1}},vertexShader:g.ShaderChunk.stw_vert_proj,fragmentShader:g.ShaderChunk.stw_frag_proj_gopro}},worldToScreen:{rectilinear:{mapping:{uniforms:{tTexture:{type:"t",value:null},tProjectionScale:{type:"f",value:1},tModelViewMatrixInverse:{type:"m4",value:null}},vertexShader:g.ShaderChunk.wts_vert_rectilinear,fragmentShader:g.ShaderChunk.wts_frag},equirectangular:{uniforms:{tEquirect:{type:"t",
value:null},tFarPlane:{type:"f",value:1E4},tNearPlane:{type:"f",value:.01},tProjectionScale:{type:"f",value:1},tViewportResolutionRatio:{type:"f",value:1},tModelViewMatrixInverse:{type:"m4",value:null}},vertexShader:g.ShaderChunk.wts_vert_rectilinear_equirectangular,fragmentShader:g.ShaderChunk.wts_frag_equirectangular}},littlePlanet:{equirectangular:{uniforms:{tEquirect:{type:"t",value:null},tProjectionScale:{type:"f",value:1},tViewportResolutionRatio:{type:"f",value:1},tModelViewMatrixInverse:{type:"m4",
value:null}},vertexShader:g.ShaderChunk.wts_vert_littleplanet_equirectangular,fragmentShader:g.ShaderChunk.wts_frag_equirectangular}},gopro:{mapping:{uniforms:{tTexture:{type:"t",value:null},tProjectionScale:{type:"f",value:1},tProjectionDistance:{type:"f",value:1},tModelViewMatrixInverse:{type:"m4",value:null}},vertexShader:g.ShaderChunk.wts_vert_gopro,fragmentShader:g.ShaderChunk.wts_frag},equirectangular:{uniforms:{tEquirect:{type:"t",value:null},tProjectionScale:{type:"f",value:1},tProjectionDistance:{type:"f",
value:1},tViewportResolutionRatio:{type:"f",value:1},tModelViewMatrixInverse:{type:"m4",value:null}},vertexShader:g.ShaderChunk.wts_vert_gopro_equirectangular,fragmentShader:g.ShaderChunk.wts_frag_equirectangular}}}};g.ShaderLib.pe=function(a){return a.replace(/#include +<([\w\d.]+)>/g,function(a,d){a=g.ShaderChunk[d];if("undefined"===typeof a&&(a=THREE.ShaderChunk[d],"undefined"===typeof a))throw Error("Can not resolve #include <"+d+">");return g.ShaderLib.pe(a)})};g.La={};g.La.Gd="undefined";
g.La.Cc="rectilinear";g.La.Ac="gopro";function ib(a,b,d){this.j=a;this.c=b;this.f=1;n.call(this,d||"ViewBase")}ib.prototype=Object.create(n.prototype);e=ib.prototype;e.constructor=ib;e.Mc=g.ShaderLib.screenToWorld.rectilinear;e.Nc=g.ShaderLib.worldToScreen.rectilinear;e.Bc=function(){};e.Sc=function(a){this.log(a);throw"Please implement "+this.ab+"::updateScreenToWorld";};e.worldToScreen=function(a,b){this.log(a);this.log(b);throw"Please implement "+this.ab+"::worldToScreen";};
e.screenToWorld=function(a){this.log(a);throw"Please implement "+this.ab+"::screenToWorld";};e.destroy=function(){this.c=this.j=null;n.prototype.destroy.call(this)};Object.defineProperty(ib.prototype,"fovMin",{get:function(){return this.c.fovMin}});Object.defineProperty(ib.prototype,"fovMax",{get:function(){return this.c.fovMax}});function Xa(a,b){ib.call(this,a,b,"ViewGoPro");this.Bc()}Xa.prototype=Object.create(ib.prototype);e=Xa.prototype;e.constructor=Xa;e.Mc=g.ShaderLib.screenToWorld.gopro;
e.Nc=g.ShaderLib.worldToScreen.gopro;e.Bc=function(){ib.prototype.Bc.call(this);this.c.fovMin=10;this.c.fovMax=160};e.Sc=function(a){var b,d=g.Math.fa(this.c.fov,this.c.fovMin,this.c.fovMax);b=60>d?0:180<d?1:.5*(1+Math.sin(Math.PI/2*((d-60)/120*2-1)));a.tProjectionDistance.value=b;d=Math.PI*d/360;this.f=(b+1)*Math.sin(d)/(b+Math.cos(d));a.tProjectionScale.value=this.f};e.worldToScreen=function(a,b){this.log(a);this.log(b);return new THREE.Vector2};e.screenToWorld=function(a){this.log(a);return new THREE.Vector3};
e.destroy=function(){ib.prototype.destroy.call(this)};function Wa(a,b){ib.call(this,a,b,"ViewRectilinear");this.Bc()}Wa.prototype=Object.create(ib.prototype);e=Wa.prototype;e.constructor=Wa;e.Mc=g.ShaderLib.screenToWorld.rectilinear;e.Nc=g.ShaderLib.worldToScreen.rectilinear;e.Bc=function(){ib.prototype.Bc.call(this);this.c.fovMin=10;this.c.fovMax=170};e.Sc=function(a){this.f=Math.tan(g.Math.ca(g.Math.fa(this.c.fov,this.c.fovMin,this.c.fovMax)/2));a.tProjectionScale.value=this.f};
e.worldToScreen=function(a,b){b=b||0;a=new THREE.Vector4(a.x,a.y,a.z,1);var d=g.Math.hg(this.c.modelView),d=g.Math.Xd(d.yaw,d.pitch,d.roll,!0),d=d.transpose();a.applyMatrix4(d);if(0>a.z)return new THREE.Vector2(Infinity,Infinity);d=Math.max(Number.EPSILON,a.z);a=(new THREE.Vector2(a.x,a.y)).divideScalar(d);a.x/=(1+b)*this.f;a.y/=this.f;b=this.j.renderer.displayResolution;a.x=b.width/2*(a.x/b.ratio+1);a.y=b.height/2*(a.y/b.ratio+1);return new THREE.Vector2(Math.round(a.x),b.height-Math.round(a.y))};
e.screenToWorld=function(a){var b=this.j.renderer.displayResolution;a=new THREE.Vector2(2*(a.x/b.width-1)*b.ratio,2*(a.y/b.height-1)*b.ratio);a.multiplyScalar(this.f);a=(new THREE.Vector4(a.x,a.y,-1,0)).applyMatrix4(this.c.modelViewInverse).normalize();return new THREE.Vector3(a.x,a.y,a.z)};e.destroy=function(){ib.prototype.destroy.call(this)};function la(a){this.j=a;this.c=[];n.call(this,"HotspotManager")}la.prototype=Object.create(n.prototype);e=la.prototype;e.constructor=la;
e.Ek=function(){var a=this.j.tour.scene;a.onUnloadStart.ga(this.Fk,this);"undefined"!==typeof a.config.hotspots&&this.na(a.config.hotspots)};e.Fk=function(){this.clear()};e.boot=function(){this.j.tour.onSceneLoadStart.add(this.Ek,this)};e.fn=function(a){return this.c.filter(function(b){return b.type===a})};e.na=function(a){for(var b=0,d=a.length;b<d;b++){var h=a[b],k=null;switch(h.type){case g.Vc.Zh:k=new jb(this.j,h)}k&&this.c.push(k)}};
e.Oi=function(a){if(null!==a.tracks){a=a.tracks;for(var b=0,d=a.length;b<d;b++)g.R.register(a[b])}};e.update=function(){for(var a=0,b=this.c.length;a<b;a++)this.c[a].update()};e.clear=function(){for(var a=this.c.length;a--;)this.c.pop().destroy()};e.destroy=function(){this.clear();this.c=this.j=null;n.prototype.destroy.call(this)};Object.defineProperty(la.prototype,"all",{get:function(){return this.c}});Object.defineProperty(la.prototype,"count",{get:function(){return this.c}});
function jb(a,b){this.G=b;this.J="";this.o=this.C=this.i=this.f=null;G.call(this,a,"Hotspot3D")}jb.prototype=Object.create(G.prototype);e=jb.prototype;e.constructor=jb;
e.Ne=function(){G.prototype.Ne.call(this);this.f=new kb;this.o=new lb(this.j,this.f);this.i=new mb(this.j);if("undefined"!==typeof this.G&&this.G){var a=this.G;this.S=a.uid;this.qb=a.tags;aa(this);this.m=a.type;this.J=a.name;this.M=a.visible;"undefined"!==typeof a.transform&&this.f.load(a.transform);"undefined"!==typeof a.animation&&(this.o.load(a.animation),this.o.onProgress.add(this.Hi,this));this.i.onReady.ga(this.gm,this);var b;"undefined"!==typeof a.material?b=a.material:b=nb.ai;!0===this.bd&&
(b=g.L.ib(b,nb.xd));this.i.load(b);"undefined"!==typeof a.sound&&(this.C=new ob(this.j),this.C.load(a.sound,a.transform));"string"===typeof a.fx&&(this.O=a.fx);if("object"===typeof a.events){var a=a.events,d;for(d in a)b=new pb(this.j),b.c(a[d]),this.u[d]=b}}};
e.gm=function(){this.f.o(this.i);this.c.geometry=new THREE.PlaneGeometry(this.f.size.width,this.f.size.height,2);this.c.material=this.i.material;this.c.material.side=THREE.DoubleSide;this.c.c=this.G;this.Hi();this.K=!0;this.F&&this.F.H();!0===this.o.autoPlay&&this.o.play()};
e.Hi=function(){var a=g.Math.uc(Math.PI-g.Math.ca(this.f.position.theta),-Math.PI,Math.PI),b=g.Math.ca(this.f.position.phi),d=this.f.position.radius,d=d+50*this.j.renderer.camera.parallax,d=g.L.qg(d,a,b);this.c.position.copy((new THREE.Vector3).setFromSpherical(d));!0===this.f.facingCenter?(this.c.rotation.set(b,a+Math.PI,0,"YXZ"),this.c.rotation.x+=-g.Math.ca(this.f.rotation.x),this.c.rotation.y+=g.Math.ca(this.f.rotation.y),this.c.rotation.z+=g.Math.ca(this.f.rotation.z)):this.c.rotation.set(-g.Math.ca(this.f.rotation.x),
g.Math.ca(this.f.rotation.y),g.Math.ca(this.f.rotation.z),"YXZ")};e.update=function(){this.i&&this.i.update();this.C&&this.C.update()};e.destroy=function(){this.f&&(this.f.destroy(),this.f=null);this.o&&(this.o.destroy(),this.o=null);this.i&&(this.i.destroy(),this.i=null);this.C&&(this.C.destroy(),this.C=null);G.prototype.destroy.call(this)};Object.defineProperty(jb.prototype,"type",{get:function(){return this.m}});Object.defineProperty(jb.prototype,"name",{get:function(){return this.J}});
Object.defineProperty(jb.prototype,"animation",{get:function(){return this.o}});function ob(a){this.j=a;this.m="";this.c=this.u=this.f=null;this.D=!1;this.C=1;this.F=!1;this.I=0;this.O=!1;this.o={radius:200,theta:0,phi:0};this.B=this.K=!1;this.J=this.M=0;this.G=360;n.call(this,"HotspotSound")}ob.prototype=Object.create(n.prototype);e=ob.prototype;e.constructor=ob;e.Gk=function(){this.log("Sound load complete");this.f&&this.f.H()};
e.load=function(a,b){"undefined"!==typeof a.url&&""!==a.url&&(this.S=a.uid,this.i=a.url,this.C="number"===typeof a.volume?g.Math.fa(a.volume,0,1):1,this.F="boolean"===typeof a.loop?a.loop:!1,this.I="number"===typeof a.startTime?a.startTime:0,this.O="boolean"===typeof a.autoPlay?a.autoPlay:!1,"undefined"!==typeof a.type&&a.type===g.Na.oc&&(this.m=g.Na.oc,"undefined"!==typeof a.outOfFov&&(this.K="boolean"===typeof a.outOfFov.mute?a.outOfFov.mute:!1,this.B="boolean"===typeof a.outOfFov.fade?a.outOfFov.fade:
!1,this.M="number"===typeof a.outOfFov.fadeTime?a.outOfFov.fadeTime:.5,this.J="number"===typeof a.outOfFov.minVolume?a.outOfFov.minVolume:0),this.G="number"===typeof a.range?g.Math.fa(a.range,1,360):360),""===this.m&&(this.m=g.Na.Xh),"undefined"!==typeof b&&"undefined"!==typeof b.position&&(this.o.theta="number"===typeof b.position.theta?g.Math.fa(b.position.theta,-180,180):0,this.o.phi="number"===typeof b.position.phi?g.Math.fa(b.position.phi,-90,90):0),this.c=new H(this.j,this.S,this.i||""),this.c.onCanPlayThrough.ga(this.Gk,
this),this.m===g.Na.oc===!0&&(a=g.L.qg(1,g.Math.ca(-this.o.theta),g.Math.ca(this.o.phi)),this.u=(new THREE.Vector3).setFromSpherical(a),this.c.spatialized=this.m===g.Na.oc,this.c.x=this.u.x,this.c.y=this.u.y,this.c.z=this.u.z,this.c.volume<=this.J&&(this.B=!1,this.warn("Fade minVolume can't be higher that the current sound volume."))),this.c.volume=this.C,this.c.loop=this.F,this.c.startTime=this.I,!0===this.O&&this.c.play(this.I,this.F,!0))};
e.update=function(){if(!1===this.j.audio.enabled||!1===this.c.enabled)this.c.stop();else if(this.m===g.Na.oc===!0){if(this.m===g.Na.oc===!0&&"number"===typeof this.G){var a=this.j.renderer.camera,a=g.Quaternion.Jb(g.Math.ca(a.yaw),g.Math.ca(a.pitch),0),b=g.Quaternion.Jb(g.Math.ca(this.o.theta),g.Math.ca(this.o.phi),0),a=g.Quaternion.Ud(b,a),b=g.Math.ca(this.G/2);this.c.volume=a<b?this.C*(1-a/b):0}a=this.j.renderer.worldToScreen(this.u);Infinity===a.x||Infinity===a.y?!1===this.D&&(!0===this.K?this.c.mute():
!0===this.B&&!0===this.j.audio.useWebAudio&&this.c.F.gain.linearRampToValueAtTime(Math.min(this.c.volume,this.J),this.c.f.currentTime+this.M),this.D=!0):!0===this.D&&(this.D=!1,!0===this.c.muted&&!0===this.K?this.c.Qe():!0===this.B&&!0===this.j.audio.useWebAudio&&this.c.F.gain.linearRampToValueAtTime(this.c.volume,this.c.f.currentTime+this.M))}};e.destroy=function(){this.c&&(this.c.destroy(),this.c=null);this.o=this.u=null;this.f&&this.f.destroy();n.prototype.destroy.call(this)};
Object.defineProperty(ob.prototype,"type",{get:function(){return this.m}});Object.defineProperty(ob.prototype,"sound",{get:function(){return this.c}});Object.defineProperty(ob.prototype,"onReady",{get:function(){this.f||(this.f=new p(this));return this.f}});function mb(a){this.j=a;this.u=null;this.m="";this.f=this.c=null;this.B=1;this.D=!1;this.o=16777215;this.N=null;this.F=!1;this.i=null;n.call(this,"HotspotMaterial")}mb.prototype=Object.create(n.prototype);mb.prototype.constructor=mb;
var qb={IMAGE:"image",Rh:"plugin",Pg:"graphics"},nb={ai:{color:"#ffffff",opacity:0,transparent:!1},xd:{color:"#00ff00",opacity:.8,transparent:!1}};e=mb.prototype;
e.Xl=function(a){a=a.emitter;this.log("Texture load complete (Image) : "+a.element.src);this.N=a;this.c=new THREE.Texture(a.element);this.c.image.crossOrigin="anonymous";this.c.wrapS=THREE.ClampToEdgeWrapping;this.c.wrapT=THREE.ClampToEdgeWrapping;this.c.minFilter=THREE.LinearFilter;this.c.magFilter=THREE.LinearFilter;this.c.needsUpdate=!0;this.log("Map new texture from image");rb(this)};
e.vi=function(a){a=a.data;a.uid===this.u.plugin&&(this.j.plugins.onInstanceCreate.remove(this.vi,this),sb(this,a))};function sb(a,b){!0===b.instanceReady?tb(a,b):b.onInstanceReady.ga(a.Km,a)}e.Km=function(a){a=a.emitter;if(null===a.instance||!1===a.instanceReady)throw Error("Plugin instance not available");tb(this,a)};
function tb(a,b){a.N=b.instance.texture;a.c=new THREE.Texture(a.N.dom);a.c.format=THREE.RGBAFormat;a.c.wrapS=THREE.ClampToEdgeWrapping;a.c.wrapT=THREE.ClampToEdgeWrapping;a.c.magFilter=THREE.LinearFilter;a.c.minFilter=THREE.LinearFilter;a.c.generateMipmaps=!1;a.c.needsUpdate=!0;a.log("Map new texture from plugin");rb(a)}
function rb(a){a.f=new THREE.MeshBasicMaterial({side:THREE.FrontSide});a.f.opacity=a.B;a.f.color=new THREE.Color(a.o);a.c&&(a.f.transparent=a.D,a.f.map=a.c,a.f.needsUpdate=!0);a.i&&a.i.H()}
e.load=function(a){a=this.u=a;this.B="number"===typeof a.opacity?g.Math.fa(a.opacity,0,1):1;this.D="boolean"===typeof a.transparent?a.transparent:!1;this.o="string"===typeof a.color?a.color:16777215;this.F="boolean"===typeof a.update?a.update:!1;"undefined"!==typeof a.image&&null!==a.image?(a=a.image,this.m=qb.IMAGE,this.N=new ub(this.j,a),this.N.onLoadComplete.ga(this.Xl,this)):"undefined"!==typeof a.plugin&&null!==a.plugin?(a=a.plugin,this.m=qb.Rh,a=this.j.plugins.get(a),"undefined"===typeof a||
null===a?this.j.plugins.onInstanceCreate.add(this.vi,this):sb(this,a)):(this.m=qb.Pg,rb(this))};e.update=function(){this.c&&!0===this.F&&(this.c.needsUpdate=!0)};e.destroy=function(){this.c&&(this.c.dispose(),this.c=null);this.f.dispose();this.f=null;this.m===qb.IMAGE&&this.N&&this.N.destroy();this.N=null;this.i&&(this.i.destroy(),this.i=null);this.j=null;n.prototype.destroy.call(this)};Object.defineProperty(mb.prototype,"type",{get:function(){return this.m}});
Object.defineProperty(mb.prototype,"texture",{get:function(){return this.c}});Object.defineProperty(mb.prototype,"material",{get:function(){return this.f}});Object.defineProperty(mb.prototype,"opacity",{get:function(){return this.B}});Object.defineProperty(mb.prototype,"transparent",{get:function(){return this.D}});Object.defineProperty(mb.prototype,"color",{get:function(){return this.o}});Object.defineProperty(mb.prototype,"displayObject",{get:function(){return this.N}});
Object.defineProperty(mb.prototype,"onReady",{get:function(){this.i||(this.i=new p(this));return this.i}});function kb(a,b){this.f=a||{radius:200,theta:0,phi:0};this.i=b||{x:0,y:0,z:0};this.c={theta:10,phi:10,width:0,height:0};this.m=!1;n.call(this,"HotspotTransform")}kb.prototype=Object.create(n.prototype);kb.prototype.constructor=kb;
kb.prototype.o=function(a){a=a.texture;var b=1,d=1;null!==a&&"undefined"!==typeof a.image&&(b=a.image.width,d=a.image.height);a=b/d;"number"===typeof this.c.phi&&(d=g.Math.ca(this.c.phi),d=2*this.f.radius*Math.tan(d/2),"auto"===this.c.theta&&(b=d*a));"number"===typeof this.c.theta&&(b=g.Math.ca(this.c.theta),b=2*this.f.radius*Math.tan(b/2),"auto"===this.c.phi&&(d=b/a));this.c.width=b;this.c.height=d};
kb.prototype.load=function(a){"undefined"!==typeof a.position&&(this.f.radius="number"===typeof a.position.radius?a.position.radius:0,this.f.theta="number"===typeof a.position.theta?a.position.theta:0,this.f.phi="number"===typeof a.position.phi?a.position.phi:0);if("undefined"!==typeof a.rotation&&"auto"!==a.rotation)this.i.x="number"===typeof a.rotation.x?a.rotation.x:0,this.i.y="number"===typeof a.rotation.y?a.rotation.y:0,this.i.z="number"===typeof a.rotation.z?a.rotation.z:0;else if("undefined"===
typeof a.rotation||"auto"===a.rotation){var b=this.f,d={x:0,y:0,z:0};"undefined"!==typeof b&&(d.y="number"===typeof b.theta?-b.theta:0,d.x="number"===typeof b.phi?-b.phi:0);this.i=d}"undefined"!==typeof a.size&&(this.c.theta="number"===typeof a.size.theta?a.size.theta:"auto",this.c.phi="number"===typeof a.size.phi?a.size.phi:"auto");"boolean"===typeof a.facingCenter&&(this.m=a.facingCenter)};kb.prototype.destroy=function(){n.prototype.destroy.call(this)};
Object.defineProperty(kb.prototype,"position",{get:function(){return this.f}});Object.defineProperty(kb.prototype,"rotation",{get:function(){return this.i}});Object.defineProperty(kb.prototype,"size",{get:function(){return this.c}});Object.defineProperty(kb.prototype,"facingCenter",{get:function(){return this.m},set:function(a){"boolean"===typeof a&&(this.m=a)}});
function lb(a,b){this.j=a;this.F=b;this.i=null;this.C=0;this.G=!1;this.D=this.c=this.I=null;this.f=0;this.O=g.T.nc;this.K=g.T.Dc;this.J=this.M=this.U=!1;this.m=this.u=this.o=null;n.call(this,"HotspotAnimation");this.i=new vb(this.j,this);this.i.onStart.add(this.Ck,this);this.i.onStop.add(this.Dk,this);this.i.onProgress.add(this.Bk,this);this.i.onComplete.add(this.Ak,this);this.j.tween.add(this.i)}lb.prototype=Object.create(n.prototype);e=lb.prototype;e.constructor=lb;
e.load=function(a){!0===a.enabled&&(this.U="boolean"===typeof a.loop?a.loop:!1,this.M="boolean"===typeof a.random?a.random:!1,this.J="boolean"===typeof a.autoPlay?a.autoPlay:!1,null!==a.order&&g.L.Ma(a.order,"string")&&(this.B=!0===this.M?g.L.ud(a.order):a.order))};e.Ck=function(){this.o&&this.o.H()};e.Dk=function(){};
e.Bk=function(){var a=this.i.easing(this.C);this.F.position.radius=(1-a)*this.D.position.radius+a*this.c[this.f].position.radius;this.F.position.theta=g.Math.uc((1-a)*this.D.position.theta+a*this.c[this.f].position.theta,-180,180);this.F.position.phi=g.Math.uc((1-a)*this.D.position.phi+a*this.c[this.f].position.phi,-90,90);this.F.rotation.x=(1-a)*this.D.rotation.x+a*this.c[this.f].rotation.x;this.F.rotation.y=(1-a)*this.D.rotation.y+a*this.c[this.f].rotation.y;this.F.rotation.z=(1-a)*this.D.rotation.z+
a*this.c[this.f].rotation.z;this.u&&this.u.H()};e.Ak=function(){this.f++;if(this.f<this.c.length)wb(this,this.c[this.f].time-this.c[this.f-1].time,this.f===this.c.length-1?this.K:g.T.LINEAR);else{if(1<this.B.length){var a=this.B.indexOf(this.I)+1;if(a<=this.B.length-1){this.play(a);return}}!0===this.U?(!0===this.M&&(this.B=g.L.ud(this.B)),this.play(0)):this.m&&this.m.H()}};function wb(a,b,d){a.D=g.L.clone(a.F);a.i.easing=d||g.T.LINEAR;a.C=0;a.i.Dd({tweenTime:1},b);a.G=!0;a.i.start()}
e.play=function(a,b,d){this.c=null;null!==a&&Array.isArray(a)?(this.c=a,this.I=this.B[0]):"number"===typeof a?this.I=this.B[a]:"string"===typeof a?this.I=a:this.I=this.B[0];a=g.R.get(this.I);this.c||(this.c=a.transforms);this.O="function"===typeof b?b:g.T.nc;this.K="function"===typeof d?d:g.T.Dc;this.f=0;wb(this,this.c[0].time,this.O)};e.pause=function(){this.G=!1;this.i.stop()};e.resume=function(){!1===this.G&&this.c&&this.f<this.c.length&&wb(this,this.c[this.f].time,g.T.nc)};
e.stop=function(){this.G=!1;this.i.stop()};e.destroy=function(){if(this.c){for(var a=0,b=this.c.length;a<b;a++)this.c[a]=null;this.c=null}this.D=null;this.o&&(this.o.destroy(),this.o=null);this.u&&(this.u.destroy(),this.u=null);this.m&&(this.m.destroy(),this.m=null);n.prototype.destroy.call(this)};Object.defineProperty(lb.prototype,"autoPlay",{get:function(){return this.J}});Object.defineProperty(lb.prototype,"tweenTime",{get:function(){return this.C},set:function(a){this.C=a}});
Object.defineProperty(lb.prototype,"onPlay",{get:function(){this.o||(this.o=new p(this));return this.o}});Object.defineProperty(lb.prototype,"onProgress",{get:function(){this.u||(this.u=new p(this));return this.u}});Object.defineProperty(lb.prototype,"onComplete",{get:function(){this.m||(this.m=new p(this));return this.m}});g.Vc={};g.Vc.Zh="3d";
function L(a){this.j=a;this.U=null;this.ha=this.W=this.G=this.$=this.P=this.C=this.Z=this.ma=this.M=0;this.I=Math.PI/2;this.J=this.K=this.O=0;this.f=this.i=this.c=this.o=this.F=this.u=null;this.X=0;this.m=this.D=this.B=null;n.call(this,"Camera");this.u=new THREE.Matrix4;this.F=new THREE.Matrix4;this.o=new THREE.Quaternion;this.D=new yb(this.j);zb(this);this.i=this.c.clone();this.i.name="CameraLeft";this.i.layers.enable(1);this.i.add(this.D.object);this.f=this.c.clone();this.f.name="CameraRight";this.f.layers.enable(2)}
L.prototype=Object.create(n.prototype);L.prototype.constructor=L;var Ab={parallax:0,yaw:{default:0},pitch:{default:0,min:-90,max:90},roll:{default:0},fov:{default:90}};function zb(a){"undefined"!==typeof a.j.renderer&&(a.c=new THREE.PerspectiveCamera(a.I,a.j.renderer.displayResolution.ratio,.01,1E4),a.c.name="CameraMain",a.c.matrixAutoUpdate=!1)}
function Bb(a,b){var d=Math.tan(g.Math.ca(a.upDegrees)),h=Math.tan(g.Math.ca(a.downDegrees)),k=Math.tan(g.Math.ca(a.leftDegrees)),l=Math.tan(g.Math.ca(a.rightDegrees));a=2/(k+l);var k=(k-l)*a*.5,l=2/(d+h),d=(d-h)*l*.5,h=new THREE.Matrix4,q=h.elements;q[0]=a;q[1]=0;q[2]=-k;q[3]=0;q[4]=0;q[5]=l;q[6]=d;q[7]=0;q[8]=0;q[9]=0;q[10]=b.far/(b.near-b.far);q[11]=b.far*b.near/(b.near-b.far);q[12]=0;q[13]=0;q[14]=-1;q[15]=0;h.transpose();return h}
function Cb(a){a.u=g.Math.Xd(a.M,a.C,a.G,!1);a.F=a.u.clone().transpose();a.o=g.Quaternion.Jb(a.M,a.C,a.G)}function Eb(a){a.u=g.Quaternion.$j(a.o);a.F=a.u.clone().transpose();var b=g.Quaternion.we(a.o),d=b.pitch,h=b.roll,k=g.Math.wb;Fb(a,b.yaw,k);Gb(a,d,k);Hb(a,h,k);Ib(a,null,k)}function Jb(a){a.m&&a.m.H(null,!0)}
function Fb(a,b,d){if("number"!==typeof b||!0===isNaN(b))return!1;d=d===g.Math.Qa||d===g.Math.wb?d:g.Math.wb;b=d===g.Math.Qa?g.Math.ca(b):b;b=g.Math.uc(b,-Math.PI,Math.PI);b=g.Math.fa(b,a.ma,a.Z);d=a.M!==b;a.M=b;return d}function Gb(a,b,d){if("number"!==typeof b||!0===isNaN(b))return!1;d=d===g.Math.Qa||d===g.Math.wb?d:g.Math.wb;b=d===g.Math.Qa?g.Math.ca(b):b;b=g.Math.uc(b,-Math.PI,Math.PI);b=g.Math.fa(b,a.P,a.$);d=a.C!==b;a.C=b;return d}
function Hb(a,b,d){if("number"!==typeof b||!0===isNaN(b))return!1;d=d===g.Math.Qa||d===g.Math.wb?d:g.Math.wb;b=d===g.Math.Qa?g.Math.ca(b):b;b=g.Math.uc(b,-Math.PI,Math.PI);b=g.Math.fa(b,a.W,a.ha);d=a.G!==b;a.G=b;return d}function Ib(a,b,d){if("number"!==typeof b||!0===isNaN(b))return!1;d=d===g.Math.Qa||d===g.Math.wb?d:g.Math.wb;b=d===g.Math.Qa?g.Math.ca(b):b;b=g.Math.fa(b,a.O,a.K);d=a.I!==b;a.I=b;return d}
L.prototype.load=function(a){a=this.U=g.L.ib(Ab,a);this.J=a.parallax;this.X=50*this.J;this.ma=g.Math.ca(a.yaw.min);this.Z=g.Math.ca(a.yaw.max);Fb(this,a.yaw["default"],g.Math.Qa);this.P=g.Math.ca(a.pitch.min);this.$=g.Math.ca(a.pitch.max);Gb(this,a.pitch["default"],g.Math.Qa);this.W=g.Math.ca(a.roll.min);this.ha=g.Math.ca(a.roll.max);Hb(this,a.roll["default"],g.Math.Qa);"undefined"!==typeof a.fov.min&&(this.O=g.Math.ca(a.fov.min));"undefined"!==typeof a.fov.max&&(this.K=g.Math.ca(a.fov.max));Ib(this,
a.fov["default"],g.Math.Qa);Cb(this);Jb(this)};L.prototype.Ij=function(a,b,d,h,k,l,q){if("number"!==typeof k||!k)k=g.Math.Qa,Fb(this,a,k),Gb(this,b,k),Hb(this,d,k),Ib(this,h,k),Cb(this),Jb(this);else if(null!==a||null!==b||null!==d||null!==h)this.animation.waypoints=[new Kb(k,a,b,d,h)],this.animation.play(!1,l,q)};
L.prototype.update=function(){if(this.c){var a=(new THREE.Matrix4).copy(this.F);this.J&&a.multiply((new THREE.Matrix4).makeTranslation(0,0,-this.X));this.c.quaternion.setFromRotationMatrix(a);this.c.matrixWorld=a;this.c.matrixWorldInverse.getInverse(a);this.c.fov=g.Math.Pb(this.I);this.c.aspect=this.j.renderer.displayResolution.ratio;this.c.updateProjectionMatrix()}if(!0===this.j.renderer.display.presentingVR){this.D.update();var a=this.j.renderer.display,b=a.nj();null!==b&&(this.o=b,Eb(this));var b=
a.vrDisplay.getEyeParameters("left"),d=a.vrDisplay.getEyeParameters("right");this.c.matrixWorld.decompose(this.i.position,this.i.quaternion,this.i.scale);this.i.matrixWorld=(new THREE.Matrix4).makeRotationFromQuaternion(this.c.quaternion);this.c.matrixWorld.decompose(this.f.position,this.f.quaternion,this.f.scale);this.f.matrixWorld=(new THREE.Matrix4).makeRotationFromQuaternion(this.c.quaternion);this.i.matrixWorld.elements[12]=this.c.matrixWorld.elements[12]+b.offset[0];this.i.matrixWorld.elements[13]=
this.c.matrixWorld.elements[13]+b.offset[1];this.i.matrixWorld.elements[14]=this.c.matrixWorld.elements[14]+b.offset[2];this.f.matrixWorld.elements[12]=this.c.matrixWorld.elements[12]+d.offset[0];this.f.matrixWorld.elements[13]=this.c.matrixWorld.elements[13]+d.offset[1];this.f.matrixWorld.elements[14]=this.c.matrixWorld.elements[14]+d.offset[2];a=a.vrFrameData;null!==a?(this.i.projectionMatrix.elements=a.leftProjectionMatrix,this.f.projectionMatrix.elements=a.rightProjectionMatrix):(this.i.projectionMatrix=
Bb({upDegrees:b.fieldOfView.upDegrees,downDegrees:b.fieldOfView.downDegrees,leftDegrees:b.fieldOfView.leftDegrees,rightDegrees:b.fieldOfView.rightDegrees},this.c),this.f.projectionMatrix=Bb({upDegrees:d.fieldOfView.upDegrees,downDegrees:d.fieldOfView.downDegrees,leftDegrees:d.fieldOfView.leftDegrees,rightDegrees:d.fieldOfView.rightDegrees},this.c));Jb(this);a=0;for(b=this.f.children.length;a<b;a++)this.f.remove(this.f.children[a]);b=0;for(d=this.i.children.length;b<d;b++)a=this.i.children[b].clone(),
this.f.add(a)}};L.prototype.destroy=function(){this.c=this.o=this.F=this.u=null;this.D.destroy();this.D=null;this.m&&(this.m.destroy(),this.m=null);this.B&&(this.B.destroy(),this.B=null);this.j=null;n.prototype.destroy.call(this)};Object.defineProperty(L.prototype,"config",{get:function(){return this.U},set:function(a){this.load(a)}});Object.defineProperty(L.prototype,"yaw",{get:function(){return g.Math.Pb(this.M)},set:function(a){!0===Fb(this,a,g.Math.Qa)&&(Cb(this),Jb(this))}});
Object.defineProperty(L.prototype,"pitch",{get:function(){return g.Math.Pb(this.C)},set:function(a){Gb(this,a,g.Math.Qa)&&(Cb(this),Jb(this))}});Object.defineProperty(L.prototype,"roll",{get:function(){return g.Math.Pb(this.G)},set:function(a){!0===Hb(this,a,g.Math.Qa)&&(Cb(this),Jb(this))}});Object.defineProperty(L.prototype,"fov",{get:function(){return g.Math.Pb(this.I)},set:function(a){!0===Ib(this,a,g.Math.Qa)&&Jb(this)}});
Object.defineProperty(L.prototype,"fovMin",{get:function(){return g.Math.Pb(this.O)},set:function(a){this.O=g.Math.ca(a)}});Object.defineProperty(L.prototype,"fovMax",{get:function(){return g.Math.Pb(this.K)},set:function(a){this.K=g.Math.ca(a)}});Object.defineProperty(L.prototype,"quaternion",{get:function(){return this.o},set:function(a){this.o=a;Eb(this);Jb(this)}});Object.defineProperty(L.prototype,"animation",{get:function(){this.B||(this.B=new Lb(this.j,this));return this.B}});
Object.defineProperty(L.prototype,"parallax",{get:function(){return this.J},set:function(a){this.J=g.Math.fa(a,0,1);Jb(this)}});Object.defineProperty(L.prototype,"modelView",{get:function(){return this.u}});Object.defineProperty(L.prototype,"modelViewInverse",{get:function(){return this.F}});Object.defineProperty(L.prototype,"main",{get:function(){this.c||zb(this);return this.c}});Object.defineProperty(L.prototype,"perspectiveCameraRadius",{get:function(){return this.X}});
Object.defineProperty(L.prototype,"left",{get:function(){return this.i}});Object.defineProperty(L.prototype,"right",{get:function(){return this.f}});Object.defineProperty(L.prototype,"gaze",{get:function(){return this.D}});Object.defineProperty(L.prototype,"onCameraChange",{get:function(){this.m||(this.m=new p(this));return this.m}});
function Lb(a,b){this.j=a;this.m=b;this.c=null;this.U=this.u=0;this.O=this.K=this.D=this.o=null;this.ha=this.P=NaN;this.J=!1;this.i=null;this.X=this.$=g.T.LINEAR;this.M=!1;this.f=null;this.G=!1;this.B=0;this.F=this.C=this.I=null;n.call(this,"CameraAnimation");this.f=new vb(this.j,this);this.f.onStart.add(this.sk,this);this.f.onStop.add(this.tk,this);this.f.onProgress.add(this.rk,this);this.f.onComplete.add(this.qk,this);this.j.tween.add(this.f);this.i=new Mb(this.j)}Lb.prototype=Object.create(n.prototype);
e=Lb.prototype;e.constructor=Lb;function Nb(a,b,d){var h=g.Quaternion.Jb(g.Math.ca(b.yaw),g.Math.ca(b.pitch),g.Math.ca(b.roll));a=g.Quaternion.Ud(a.m.quaternion,h);if(.01>g.Math.Pb(a))return 0;var k=g.Quaternion.Jb(g.Math.ca(d.yaw),g.Math.ca(d.pitch),g.Math.ca(d.roll));return a/(Math.abs(g.Quaternion.Ud(h,k))/Math.abs(b.ts-d.ts))}
function Ob(a,b,d){a.i.keyframes=[];d=d||-1;for(var h=g.Math.ca(a.m.yaw),k=g.Math.ca(a.m.pitch),l=g.Math.ca(a.m.roll),q=a.m.fov,t=0,y=a.c.length;t<y;t++){var C=a.c[t],h="undefined"!==typeof C.yaw&&null!==C.yaw?g.Math.ca(C.yaw):h,k="undefined"!==typeof C.pitch&&null!==C.pitch?g.Math.ca(C.pitch):k,l="undefined"!==typeof C.roll&&null!==C.roll?g.Math.ca(C.roll):l,xb=g.Quaternion.Jb(h,k,l),Zc="undefined"!==typeof C.fov&&null!==C.fov?C.fov:q,q=Zc;t||!0!==b?-1===d&&(d=0):(a.i.keyframes.push(new Pb(0,{quaternion:a.m.quaternion,
fov:a.m.fov,first:!0})),-1===d&&(d=1<a.c.length?Nb(a,C,a.c[1]):0));a.i.keyframes.push(new Pb(C.ts+d,{quaternion:xb,fov:Zc}))}a.U=a.i.keyframes[a.i.keyframes.length-1].timestamp}
function Qb(a){var b=a.i.md(a.u);if(!b||-1===b.previous||-1===b.next)return!1;a.o=a.i.keyframes[b.previous];a.D=a.i.keyframes[b.next];a.P=a.o.data.fov;a.ha=a.D.data.fov;a.f.easing=0===b.previous?a.$||g.T.LINEAR:b.next===a.i.keyframes.length-1?a.X||g.T.LINEAR:g.T.LINEAR;if(!0===a.J){var d=a.i.qj(b);if(!d||d.next===b.next)return!1;var b=(new THREE.Quaternion).copy(a.o.data.quaternion).normalize(),h=(new THREE.Quaternion).copy(a.D.data.quaternion).normalize(),k=(new THREE.Quaternion).copy(a.i.keyframes[d.previous].data.quaternion).normalize(),
d=(new THREE.Quaternion).copy(a.i.keyframes[d.next].data.quaternion).normalize();a.K=g.Quaternion.og(k,b,h);a.O=g.Quaternion.og(b,h,d)}a.f.Dd({tweenTime:1},a.D.timestamp-a.o.timestamp);a.f.start();return!0}e.sk=function(){this.G=!0;this.I&&this.I.H()};e.tk=function(){this.G=!1};
e.rk=function(){var a=this.B;this.u=a*(this.D.timestamp-this.o.timestamp)+this.o.timestamp;var b=this.i.md(this.u);if(this.D&&b&&-1!==b.previous){a=this.f.easing(a);this.m.fov=(1-a)*this.P+a*this.ha;var a=this.o.data.quaternion,d=this.D.data.quaternion,b=!1===this.J||0===b.previous||b.next===this.c.length-1?g.Quaternion.slerp(a,d,this.B):g.Quaternion.Yj(a,this.K,this.O,d,this.B);!0===this.M&&(b=g.Quaternion.cancelRoll(b));this.m.quaternion=b}this.C&&this.C.H({Un:this.u/this.U})};
e.qk=function(){this.G=!1;this.B=0;Qb(this)||this.F&&this.F.H()};
e.play=function(a,b,d,h,k){this.J="boolean"===typeof a?a:!1;this.M="boolean"===typeof b?b:!1;this.$="function"===typeof d?d:g.T.nc;this.X="function"===typeof h?h:g.T.Dc;Ob(this,"boolean"===typeof k?k:!0);!0===this.G&&this.f.stop();(a=1!==this.c.length)||(a=!0===(0>=this.c.length?!1:this.m.fov!==this.c[0].fov&&null!==this.c[0].fov||this.m.yaw!==this.c[0].yaw&&null!==this.c[0].yaw||this.m.pitch!==this.c[0].pitch&&null!==this.c[0].pitch||!1===this.M&&this.m.roll!==this.c[0].roll&&null!==this.c[0].roll));
a&&(this.B=this.u=0,Qb(this))};e.resume=function(a){if(!1!==a){a=this.i.md(this.u);if(!a)return;a=!0===this.i.keyframes[0].first?a.next:a.previous;var b;b=this.c.length-1===a?Nb(this,this.c[a-1],this.c[a]):Nb(this,this.c[a],this.c[a+1]);this.c=this.c.slice(a);Ob(this,!0,b);this.f.stop();this.B=this.u=0}Qb(this)};e.update=function(a){Ob(this,!1);!0===this.G&&this.f.stop();1!==this.c.length&&(this.u=a,this.B=(this.u-this.o.timestamp)/(this.D.timestamp-this.o.timestamp),Qb(this))};
e.stop=function(){!0===this.G&&this.f.stop()};e.destroy=function(){this.i=null;for(var a=0,b=this.c.length;a<b;a++)this.c[a].destroy(),this.c[a]=null;this.D=this.o=this.O=this.K=this.c=null;this.I&&(this.I.destroy(),this.I=null);this.C&&(this.C.destroy(),this.C=null);this.F&&(this.F.destroy(),this.F=null);this.f&&(this.f.destroy(),this.f=null);n.prototype.destroy.call(this)};
Object.defineProperty(Lb.prototype,"waypoints",{get:function(){return this.c},set:function(a){this.c=[];!0===g.L.Ma(a,"CameraWaypoint")?this.c=g.L.clone(a):this.warn("Waypoints array is wrong!")}});Object.defineProperty(Lb.prototype,"tweenTime",{get:function(){return this.B},set:function(a){this.B=a}});Object.defineProperty(Lb.prototype,"cancelRoll",{get:function(){return this.M},set:function(a){this.M=!!a}});
Object.defineProperty(Lb.prototype,"onPlay",{get:function(){this.I||(this.I=new p(this));return this.I}});Object.defineProperty(Lb.prototype,"onProgress",{get:function(){this.C||(this.C=new p(this));return this.C}});Object.defineProperty(Lb.prototype,"onComplete",{get:function(){this.F||(this.F=new p(this));return this.F}});
function Kb(a,b,d,h,k){this.c=a||0;this.o="number"===typeof b?b:null;this.i="number"===typeof d?d:null;this.m="number"===typeof h?h:null;this.f="number"===typeof k?k:null;n.call(this,"CameraWaypoint")}Kb.prototype=Object.create(n.prototype);Kb.prototype.constructor=Kb;Object.defineProperty(Kb.prototype,"ts",{get:function(){return this.c},set:function(a){"number"===typeof a&&(this.c=a)}});Object.defineProperty(Kb.prototype,"fov",{get:function(){return this.f}});
Object.defineProperty(Kb.prototype,"yaw",{get:function(){return this.o}});Object.defineProperty(Kb.prototype,"pitch",{get:function(){return this.i}});Object.defineProperty(Kb.prototype,"roll",{get:function(){return this.m}});g.vb={};g.vb.cb="pointer";g.vb.Ph="keyboard";function ka(a){this.j=a;this.c=[];this.m=!0;this.f=this.i=null;n.call(this,"ControllerManager")}ka.prototype=Object.create(n.prototype);ka.prototype.constructor=ka;
var Rb={enabled:!0,instances:[{uid:"controller-pointer-0",type:g.vb.cb,enabled:!0}]};e=ka.prototype;e.me=function(a){this.i&&this.i.H({controller:a})};e.le=function(a){this.f&&this.f.H({controller:a})};e.update=function(){if(this.c)for(var a=0,b=this.c.length;a<b;a++)"function"===typeof this.c[a].update&&this.c[a].update()};
e.na=function(a){a="undefined"!==typeof a?a:Rb;this.m="boolean"===typeof a.enabled?a.enabled:!0;if("undefined"!==typeof a.instances)for(var b,d=0,h=a.instances.length;d<h;d++){b=a.instances[d];switch(b.type){case g.vb.cb:b=new Sb(this.j,b);break;case g.vb.Ph:b=new Tb(this.j,b);break;default:b=null}b&&this.c.push(b)}};e.destroy=function(){for(var a=this.c.length-1;a--;)this.c[a].destroy(),this.c[a]=null;this.c=null;this.i&&(this.i.destroy(),this.i=null);this.f&&(this.f.destroy(),this.f=null);n.prototype.destroy.call(this)};
Object.defineProperty(ka.prototype,"all",{get:function(){return this.c}});Object.defineProperty(ka.prototype,"enabled",{get:function(){return this.m},set:function(a){this.m=!!a}});Object.defineProperty(ka.prototype,"active",{get:function(){for(var a=0,b=this.c.length;a<b;a++)if(!0===this.c[a].active)return!0;return!1}});Object.defineProperty(ka.prototype,"onControlStart",{get:function(){this.i||(this.i=new p(this));return this.i}});
Object.defineProperty(ka.prototype,"onControlEnd",{get:function(){this.f||(this.f=new p(this));return this.f}});function Ub(a,b){this.j=a;this.c=null;this.D=this.B=!1;this.f=this.i=null;n.call(this,b||"ControllerBase");this.Yc()}Ub.prototype=Object.create(n.prototype);e=Ub.prototype;e.constructor=Ub;e.Yc=function(){this.j.canvas.pointer.enabled=!0;this.c=this.j.renderer.camera};e.enable=function(){!0!==this.B&&(this.B=!0)};e.Zb=function(){!1!==this.B&&(this.B=!0)};
e.destroy=function(){this.j=this.c=null;this.i&&(this.i.destroy(),this.i=null);this.f&&(this.f.destroy(),this.f=null);n.prototype.destroy.call(this)};Object.defineProperty(Ub.prototype,"enabled",{get:function(){return this.B},set:function(a){!0===!!a?this.enable():this.Zb()}});Object.defineProperty(Ub.prototype,"active",{get:function(){return this.D}});Object.defineProperty(Ub.prototype,"onControlStart",{get:function(){this.i||(this.i=new p(this));return this.i}});
Object.defineProperty(Ub.prototype,"onControlEnd",{get:function(){this.f||(this.f=new p(this));return this.f}});function Sb(a,b){this.G=b;this.I=this.m=this.F=this.o=null;Ub.call(this,a,"ControllerPointer")}Sb.prototype=Object.create(Ub.prototype);Sb.prototype.constructor=Sb;var Vb={orientation:{hardness:.6,damping:.15,velocityMax:300,invert:!1},zoom:{hardness:5,invert:!1}};e=Sb.prototype;
e.Yc=function(){Ub.prototype.Yc.call(this);this.I=new THREE.Vector2;this.m=new THREE.Vector2;this.o=new THREE.Vector2;this.F=new THREE.Vector2;var a=this.G;this.S=a.uid;aa(this);var b=a.options||{};this.u=g.L.ib(Vb.orientation,b.orientation);this.C=g.L.ib(Vb.zoom,b.zoom);this.B="boolean"===typeof a.enabled?a.enabled:!0;!0===this.B&&this.enable()};
e.Tg=function(a){!1!==this.j.controllers.enabled&&(this.j.canvas.pointer.onPanMove.add(this.Ge,this),this.log("_panStartHandler ("+a.data.velocityX.toFixed(2)+", "+a.data.velocityY.toFixed(2)+")"),this.D=!0,this.o=new THREE.Vector2(a.data.center.x,a.data.center.y),this.F.copy(this.o),this.m.set(0,0),this.i&&this.i.H(),this.j.controllers.me(this))};e.Ge=function(a){!1!==this.j.controllers.enabled&&this.F.set(a.data.center.x,a.data.center.y)};
e.Sg=function(){this.j.canvas.pointer.onPanMove.remove(this.Ge,this);this.log("_panEndHandler");this.D=!1;this.m.set(0,0);this.o.set(0,0);this.F.copy(this.o);this.f&&this.f.H();this.j.controllers.le(this)};e.Vg=function(a){!1!==this.j.controllers.enabled&&(this.j.canvas.pointer.onPinchMove.add(this.Ug,this),this.log("_pinchStartHandler "+a))};e.Ug=function(a){!1!==this.j.controllers.enabled&&this.log("_pinchMoveHandler "+a.data.pinch)};
e.He=function(a){this.j.canvas.pointer.onPinchMove.remove(this.Ug,this);this.log("_pinchEndHandler "+a)};e.Wg=function(a){if(!1!==this.j.controllers.enabled){var b=(this.C.invert?1:-1)/this.C.hardness;a.data.deltaY&&(b*=a.data.deltaY/5);this.c.fov=this.c.fov-b;this.log("_wheelHandler (fov:"+this.c.fov+")")}};
e.enable=function(){Ub.prototype.enable.call(this);this.j.canvas.pointer.onPanStart.add(this.Tg,this);this.j.canvas.pointer.onPanEnd.add(this.Sg,this);this.j.canvas.pointer.onPinchStart.add(this.Vg,this);this.j.canvas.pointer.onPinchEnd.add(this.He,this);this.j.canvas.pointer.onWheel.add(this.Wg,this)};
e.Zb=function(){Ub.prototype.Zb.call(this);this.j.canvas.pointer.onPanStart.remove(this.Tg,this);this.j.canvas.pointer.onPanMove.remove(this.Ge,this);this.j.canvas.pointer.onPanEnd.remove(this.Sg,this);this.j.canvas.pointer.onPinchStart.remove(this.Vg,this);this.j.canvas.pointer.onPinchMove.remove(this.He,this);this.j.canvas.pointer.onPinchEnd.remove(this.He,this);this.j.canvas.pointer.onWheel.remove(this.Wg,this)};
e.update=function(){var a=this.j.renderer.displayResolution,a=1/(this.u.hardness*Math.min(a.width,a.height));this.m.subVectors(this.F,this.o);this.m.length()>this.u.velocityMax&&this.m.setLength(this.u.velocityMax);this.m.multiplyScalar(a);var a=this.u.invert?-1:1,b=a*(this.m.x+this.I.x);.05<Math.abs(b)&&(this.c.yaw+=b);a*=this.m.y+this.I.y;.05<Math.abs(a)&&(this.c.pitch-=a);this.I.add(this.m).multiplyScalar(g.Math.fa(1-this.u.damping,0,1))};e.destroy=function(){Ub.prototype.destroy.call(this)};
function Tb(a,b){this.M=b;this.m=this.I=this.u=this.o=this.C=null;Ub.call(this,a,"ControllerKeyboard")}Tb.prototype=Object.create(Ub.prototype);Tb.prototype.constructor=Tb;var Wb={orientation:{hardness:.6,damping:.15,velocityMax:300,invert:!1},zoom:{hardness:5,invert:!1}};e=Tb.prototype;
e.Yc=function(){Ub.prototype.Yc.call(this);this.m=[];this.I=new THREE.Vector2;this.u=new THREE.Vector2;this.C=new THREE.Vector2;this.o=new THREE.Vector2;var a=this.M;this.S=a.uid;aa(this);var b=a.options||{};this.F=g.L.ib(Wb.orientation,b.orientation);this.G=g.L.ib(Wb.zoom,b.zoom);this.B="boolean"===typeof a.enabled?a.enabled:!0;!1!==b["default"]&&(a=new M(this.j,[81,37],this.Qd,this.Sd,this.Rd,[68,39],this,"left"),this.m.push(a),a=new M(this.j,[68,39],this.Qd,this.Sd,this.Rd,[81,37],this,"right"),
this.m.push(a),a=new M(this.j,[90,38],this.Qd,this.Sd,this.Rd,[83,40],this,"up"),this.m.push(a),a=new M(this.j,[83,40],this.Qd,this.Sd,this.Rd,[90,38],this,"down"),this.m.push(a),a=new M(this.j,107,this.Ii,this.Ki,this.Ji,109,this,"plus"),this.m.push(a),a=new M(this.j,109,this.Ii,this.Ki,this.Ji,107,this,"minus"),this.m.push(a));if(!0===Array.isArray(b.bindings))for(var a=0,d=b.bindings.length;a<d;a++){var h=b.bindings[a],k=h.in,l=h.out,q=h.name,h=h.events;!1===g.L.V(k,"number")&&!1===g.L.Ma(k,"number")?
this.warn("Can't add custom keyboard binding, keys in are invalid!"):"object"!==typeof h&&null===h?this.warn("Can't add custom keyboard binding, events are invalid!"):(k=new M(this.j,k,h.onDown,h.onUp,h.onHold,l,this,q),this.m.push(k))}!0===this.B&&this.enable()};e.Qd=function(a){if(!1!==this.j.controllers.enabled){this.D=!0;switch(a.name){case "left":case "right":this.u.setX(0);break;case "up":case "down":this.u.setY(0)}this.i&&this.i.H();this.j.controllers.me(this)}};
e.Rd=function(a){if(!1!==this.j.controllers.enabled)switch(a.name){case "left":this.o.setX(this.o.x-5);break;case "right":this.o.setX(this.o.x+5);break;case "up":this.o.setY(this.o.y-5);break;case "down":this.o.setY(this.o.y+5)}};e.Sd=function(a){this.D=!1;switch(a.name){case "left":case "right":this.u.setX(0);this.o.setX(0);break;case "up":case "down":this.u.setY(0),this.o.setY(0)}this.f&&this.f.H();this.j.controllers.le(this)};
e.Ii=function(a){!1!==this.j.controllers.enabled&&(this.D=!0,Xb(this,a),this.i&&this.i.H(),this.j.controllers.me(this))};e.Ji=function(a){Xb(this,a)};e.Ki=function(){this.D=!1;this.f&&this.f.H();this.j.controllers.le(this)};function Xb(a,b){var d=(a.G.invert?1:-1)/a.G.hardness;switch(b.name){case "minus":d*=10;break;case "plus":d*=-10}a.c.fov=a.c.fov-d}e.enable=function(){Ub.prototype.enable.call(this);for(var a,b=0,d=this.m.length;b<d;b++)a=this.m[b],this.j.keyboard.wf(a)};
e.Zb=function(){Ub.prototype.Zb.call(this);for(var a,b=0,d=this.m.length;b<d;b++)a=this.m[b],this.j.keyboard.te(a)};
e.update=function(){var a=this.j.renderer.displayResolution,a=1/(this.F.hardness*Math.min(a.width,a.height));this.u.subVectors(this.o,this.C);this.u.length()>this.F.velocityMax&&this.u.setLength(this.F.velocityMax);this.u.multiplyScalar(a);a=this.F.invert?-1:1;this.c.yaw+=a*(this.u.x+this.I.x);this.c.pitch-=a*(this.u.y+this.I.y);this.I.add(this.u).multiplyScalar(g.Math.fa(1-this.F.damping,0,1))};e.destroy=function(){Ub.prototype.destroy.call(this)};
function v(a){this.j=a;this.K=null;this.i=1;this.$=!1;this.U=this.G=this.X=1;this.C=!1;this.O=!0;this.c=null;this.J=!1;this.m=!0;this.B=this.u=this.I=this.F=this.D=this.o=this.M=this.f=null;n.call(this,"SoundManager")}v.prototype=Object.create(n.prototype);e=v.prototype;e.constructor=v;
e.boot=function(){this.c=[];if(!0===g.A.vg)try{"function"===typeof window.AudioContext?this.f=new window.AudioContext:this.f=new window.webkitAudioContext}catch(a){this.f=null,this.m=!1}!0!==g.A.xf||this.f||(this.m=!1,this.J=!0);this.f&&(this.o="undefined"===typeof this.f.createGain?this.f.createGainNode():this.f.createGain(),this.M=this.f.createAnalyser(),this.M.connect(this.o),this.o.gain.value=this.i,this.o.connect(this.f.destination),this.f.listener.setOrientation(0,0,-1,0,1,0));this.j.tour.onSceneLoadStart.add(this.Eh,
this)};e.Eh=function(){if("undefined"!==typeof this.j.tour.scene.config.audio){var a=g.L.ib(this.K,this.j.tour.scene.config.audio);Zb(this,a)}else Zb(this,this.K);!1===this.O?this.u&&this.u.H():this.B&&this.B.H()};
function Zb(a,b){b&&(a.O="undefined"!==typeof b.enabled?!!b.enabled:!0,a.G="undefined"!==typeof b.volume&&"number"===b.volume.max?g.Math.fa(b.volume.max,0,1):1,a.X=!1===a.$?"undefined"!==typeof b.volume&&"number"===typeof b.volume["default"]?g.Math.fa(b.volume["default"],0,a.G):1:g.Math.fa(a.i,0,a.G))}e.na=function(a){this.K=a;Zb(this,a);"number"===typeof this.X&&!1===this.$&&(this.i=g.Math.fa(this.X,0,1));$b(this)};
e.update=function(){for(var a=0,b=this.c.length;a<b;a++)this.c[a].update();if(!0===this.m&&null!==this.j.renderer.camera.main){a=new THREE.Vector3;b=this.j.renderer.camera.main.quaternion;a.set(0,0,1);a.applyQuaternion(b);var d=a.clone();a.set(0,1,0);a.applyQuaternion(b);this.f.listener.setOrientation(d.x,d.y,d.z,a.x,a.y,a.z)}};e.add=function(a){-1===ac(this,a)&&this.c.push(a)};e.remove=function(a){a=ac(this,a);-1<a&&this.c.splice(a,1)};
function ac(a,b){if(!a.c)return-1;for(var d,h=0,k=a.c.length;h<k;h++)if(d=a.c[h],d===b)return h;return-1}e.zf=function(){if(this.f&&"undefined"!==typeof this.f.suspend&&!0===this.m&&"running"===this.f.state){for(var a=!0,b=0,d=this.c.length;b<d;b++)if(!0===this.c[b].playing||!0===this.c[b].paused){a=!1;break}!0===a&&this.f.suspend()}};
e.yf=function(){if(this.f&&"undefined"!==typeof this.f.resume&&!0===this.m&&"suspended"===this.f.state)for(var a=0,b=this.c.length;a<b;a++)if(!0===this.c[a].playing||!0===this.c[a].paused){this.f.resume();break}};e.mute=function(){!0!==this.C&&(this.C=!0,this.U=this.i,this.i=0,!0===this.m&&(this.U=this.o.gain.value),$b(this),this.D&&this.D.H())};e.Fh=function(){!1!==this.C&&(this.C=!1,this.i=this.U,$b(this),this.F&&this.F.H())};
function $b(a){if(!0===a.m)a.o.gain.value=a.i;else if(!0===a.J)for(var b=0;b<a.c.length;b++)a.c[b].c.data.volume=g.Math.fa(a.c[b].D,0,1)*a.i;a.$=!0;a.I&&a.I.H()}
e.destroy=function(){this.j.tour.onSceneLoadStart.remove(this.Eh,this);this.K=this.j=null;for(var a=this.c.length;a--;)this.c[a].destroy();this.o=this.M=this.f=this.c=null;this.D&&(this.D.destroy(),this.D=null);this.F&&(this.F.destroy(),this.F=null);this.I&&(this.I.destroy(),this.I=null);this.u&&(this.u.destroy(),this.u=null);this.B&&(this.B.destroy(),this.B=null);n.prototype.destroy.call(this)};Object.defineProperty(v.prototype,"context",{get:function(){return this.f}});
Object.defineProperty(v.prototype,"analyser",{get:function(){return this.M}});Object.defineProperty(v.prototype,"inputNode",{get:function(){return this.M}});Object.defineProperty(v.prototype,"masterGain",{get:function(){return this.o}});Object.defineProperty(v.prototype,"useWebAudio",{get:function(){return this.m},set:function(a){"boolean"===typeof a&&(this.m=a,this.J=!a)}});
Object.defineProperty(v.prototype,"useAudioTag",{get:function(){return this.J},set:function(a){"boolean"===typeof a&&(this.J=a,this.m=!a)}});Object.defineProperty(v.prototype,"enabled",{get:function(){return this.O}});Object.defineProperty(v.prototype,"muted",{get:function(){return this.C},set:function(a){"boolean"===typeof a&&(!0===a?this.mute():this.Fh())}});
Object.defineProperty(v.prototype,"volume",{get:function(){return!0===this.m?this.o.gain.value:this.i},set:function(a){"number"===typeof a&&(a=g.Math.fa(a,0,1),this.i=this.G<a?this.G:a,0<this.i&&(this.C=!1),$b(this))}});Object.defineProperty(v.prototype,"onMute",{get:function(){this.D||(this.D=new p(this));return this.D}});Object.defineProperty(v.prototype,"onUnmute",{get:function(){this.F||(this.F=new p(this));return this.F}});
Object.defineProperty(v.prototype,"onVolumeChange",{get:function(){this.I||(this.I=new p(this));return this.I}});Object.defineProperty(v.prototype,"onDisable",{get:function(){this.u||(this.u=new p(this));return this.u}});Object.defineProperty(v.prototype,"onEnable",{get:function(){this.B||(this.B=new p(this));return this.B}});g.Na={};g.Na.Xh="stereo";g.Na.oc="3d";g.Na.Be="ambisonic";
function H(a,b,d,h){this.j=a;this.ka=b;this.i=d;this.va=this.D=1;this.ia=!1;this.K=!0;this.da=!1;this.B=this.Da=this.G=this.M=this.o=0;this.u=this.O=!1;this.Fa=0;this.C=!1;this.F=this.Ha=this.f=this.m=this.oa=this.c=this.J=null;this.Ia=this.wa=this.Ga=0;this.ra=null;this.qa=h||!1;this.Ka=[0,1,2,3];this.ja=this.aa=!1;this.ya=this.xa=null;this.Ba=!1;this.$=this.ma=this.Z=this.sa=this.I=this.Aa=this.ta=this.W=this.X=this.U=this.ha=this.P=this.Ca=null;n.call(this,"Sound");!0===this.qa&&!1===bc(this)&&
(this.log("KEN.Sound: can't manage ambisonic sound without Google Chrome Omnitone library and WebAudio API."),this.qa=!1);this.S=this.ka;aa(this);!0===this.j.audio.useWebAudio&&(this.f=this.j.audio.context,this.Ha=this.j.audio.inputNode,this.F="undefined"===typeof this.f.createGain?this.f.createGainNode():this.f.createGain(),this.F.gain.value=this.D*this.j.audio.volume,this.F.connect(this.Ha));if(!0===this.j.audio.useAudioTag||!0===bc(this))!0===this.j.cache.has(B.xb,this.ka)&&this.Hh(this.j.cache.get(B.xb,
this.ka)),this.j.audio.onVolumeChange.add(this.Ih,this);this.j.audio.onDisable.add(this.Gh,this);""!==this.i&&(this.j.load.sound(this.ka,this.i,this.Hh,this,bc(this)),this.P&&this.P.H());this.j.audio.add(this)}H.prototype=Object.create(n.prototype);e=H.prototype;e.constructor=H;
e.Hh=function(a){this.J=a;this.ja=!0;this.ha&&this.ha.H();!0===this.j.audio.useWebAudio?(a=this.J)&&!1===this.Ba&&(this.xa=this.di.bind(this),this.ya=this.Ql.bind(this),!0===bc(this)?(this.ra=Omnitone.createFOADecoder(this.f,a.data,{channelMap:this.Ka}),this.ra.initialize().then(this.xa,this.ya)):this.f.decodeAudioData(a.data,this.xa,this.ya)):(cc(this),this.di(null))};e.Ql=function(){this.J&&(this.J.data=null,this.Ba=!1)};function cc(a){a.Ca&&a.Ca.H();a.U&&a.U.H();a.X&&a.X.H()}
e.di=function(a){if(this.J){a&&(this.J.data=a);this.Ba=!0;cc(this);if(!0===this.j.audio.useAudioTag||!0===bc(this))this.c=this.j.cache.get(B.xb,this.ka),dc(this),this.o=0,this.c.data.duration&&(this.o=this.c.data.duration,this.M=Math.ceil(1E3*this.o));!0===this.aa&&this.play(this.B,this.O,!0)}};e.Ih=function(){dc(this)};function dc(a){!a.c||!0!==a.j.audio.useAudioTag&&!0!==bc(a)||(a.c.data.volume=g.Math.fa(a.D,0,1)*a.j.audio.volume)}e.Gh=function(){!0===this.u?this.pause():!1===this.paused&&this.stop()};
function ec(a){a.B=0;a.aa=!1;a.u=!1;a.C=!1}function fc(a,b){null===a.m&&(a.m=a.f.createPanner(),a.m.panningModel="HRTF",a.m.distanceModel="inverse",a.m.refDistance=1,a.m.maxDistance=1E4,a.m.rolloffFactor=1,a.m.coneInnerAngle=360,a.m.coneOuterAngle=0,a.m.coneOuterGain=0,a.m.setOrientation(0,0,0),a.m.setPosition(0,0,0));a.m.setPosition(a.Ga,a.wa,a.Ia);!0===b&&(a.c.connect(a.m),a.m.connect(a.F))}function bc(a){return!0===a.qa&&!0===a.j.audio.useWebAudio&&"undefined"!==typeof Omnitone}
e.update=function(){if(!0===this.u&&!1===this.C){var a=this.j.clock.time-this.G;if(a>=this.M){if(this.B=this.M,!0===this.j.audio.useWebAudio||!0===this.j.audio.useAudioTag)this.stop(!0),this.$&&this.$.H(),!0===this.O&&(this.B=0,this.resume())}else this.B=a}this.ra&&!0===this.u&&this.ra.setRotationMatrixFromCamera(this.j.renderer.camera.modelViewInverse)};
e.play=function(a,b,d){if(!1===this.j.audio.enabled||!1===this.K)this.C=this.u=!1;else{this.O=b||this.O;if(!0===this.u)if(!0===d)this.stop();else return;if(!1===this.ja)this.aa=!0;else if(!0===this.j.audio.useWebAudio&&!1===bc(this))!0===this.Ba?(this.oa||(this.oa=this.J.data),this.c=this.f.createBufferSource(),this.c.buffer=this.oa,!0===this.da?fc(this,!0):this.c.connect(this.F),this.o=this.c.buffer.duration,this.M=Math.ceil(1E3*this.o),!isNaN(a)&&a<this.M?this.G=this.j.clock.time-a:(a=0,this.G=
this.j.clock.time),b=g.Math.vd(a/1E3),"undefined"===typeof this.c.start?this.c.noteGrainOn(0,b%this.o,this.o):this.c.start(0,b%this.o,this.o),this.u=!0,this.B=a,this.Fa++,this.I&&this.I.H(),this.j.audio.yf()):(this.log("Sound is not decoded yet"),this.aa=!0);else if(!0===this.j.audio.useAudioTag||!0===bc(this))this.o?Infinity===this.o&&(this.c.data.loop=!0):(this.o=this.c.data.duration,this.M=Math.ceil(1E3*this.o)),!isNaN(a)&&this.M&&a<this.M?(this.c.data.currentTime=g.Math.vd(a/1E3),this.G=this.j.clock.time-
a):(a=0,this.c.data.currentTime=a,this.G=this.j.clock.time),this.c.data.play(),this.u=!0,this.B=a,this.Fa++,this.I&&this.I.H()}};e.stop=function(a){this.c?(gc(this,!0),this.G=this.Da=this.j.clock.time,this.C=this.u=this.aa=!1,this.sa&&!0===a&&this.sa.H(),this.j.audio.zf()):!1!==this.ja&&!0===this.Ba||ec(this)};
function gc(a,b){if(!0===a.j.audio.useWebAudio&&!1===bc(a)){if("undefined"===typeof a.c.stop)a.c.noteOff(0);else try{a.c.stop(0)}catch(d){}a.c.disconnect(0);!0===b&&(a.B=0)}else if(!0===a.j.audio.useAudioTag||!0===bc(a))a.c.data.pause(),!0===b&&(a.B=0,a.c.data.currentTime=0)}e.pause=function(){!0===this.u&&this.c?(gc(this,!1),this.C=!0,this.Da=this.j.clock.time,this.u=this.aa=!1,this.Z&&this.Z.H(),this.j.audio.zf()):!1!==this.ja&&!0===this.Ba||ec(this)};
e.resume=function(){if(!1!==this.j.audio.enabled&&!1!==this.K)if(!0===this.C||!1===this.u)if(this.c){this.G=this.j.clock.time-(this.Da-this.G);this.B=this.j.clock.time-this.G;var a=g.Math.vd(this.B/1E3);if(!0===this.j.audio.useWebAudio&&!1===bc(this)){this.c=this.f.createBufferSource();this.c.buffer=this.oa;!0===this.da?fc(this,!0):this.c.connect(this.F);var b=Math.ceil((this.M-this.B)/1E3);"undefined"===typeof this.c.start?this.c.noteGrainOn(0,a%this.o,b):this.c.start(0,a%this.o,b)}else if(!0===
this.j.audio.useAudioTag||!0===bc(this))this.c.data.currentTime=g.Math.vd(a/1E3),this.c.data.play();this.u=!0;this.C=!1;this.ma&&this.ma.H();this.j.audio.yf()}else this.play(this.B,this.O,!0);else if(!1===this.ja||!1===this.Ba)ec(this),this.aa=!0};
e.mute=function(){!0!==this.ia&&!1!==this.j.audio.enabled&&!1!==this.K&&(this.ia=!0,this.va=this.D,this.D=0,!0===this.j.audio.useWebAudio&&!1===bc(this)?this.F.gain.value=this.D:!0!==this.j.audio.useAudioTag&&!0!==bc(this)||!this.c||(this.c.data.volume=this.D),this.W&&this.W.H())};
e.Qe=function(){!1!==this.ia&&!1!==this.j.audio.enabled&&!1!==this.K&&(this.ia=!1,this.D=this.va,!0===this.j.audio.useWebAudio&&!1===bc(this)?this.F.gain.value=this.va:!0!==this.j.audio.useAudioTag&&!0!==bc(this)||!this.c||(this.c.data.volume=this.va),this.ta&&this.ta.H())};
e.destroy=function(){this.stop();!0!==this.j.audio.useAudioTag&&!0!==bc(this)||this.j.audio.onVolumeChange.remove(this.Ih,this);this.j.audio.onDisable.remove(this.Gh,this);this.j.audio.remove(this);this.ya=this.xa=this.m=this.F=this.Ha=this.f=this.oa=this.c=this.J=this.j=null;this.Ca&&(this.Ca.destroy(),this.Ca=null);this.P&&(this.P.destroy(),this.P=null);this.ha&&(this.ha.destroy(),this.ha=null);this.U&&(this.U.destroy(),this.U=null);this.X&&(this.X.destroy(),this.X=null);this.W&&(this.W.destroy(),
this.W=null);this.ta&&(this.ta.destroy(),this.ta=null);this.Aa&&(this.Aa.destroy(),this.Aa=null);this.I&&(this.I.destroy(),this.I=null);this.sa&&(this.sa.destroy(),this.sa=null);this.Z&&(this.Z.destroy(),this.Z=null);this.ma&&(this.ma.destroy(),this.ma=null);this.$&&(this.$.destroy(),this.$=null);n.prototype.destroy.call(this)};Object.defineProperty(H.prototype,"enabled",{get:function(){return this.K},set:function(a){"boolean"===typeof a&&(this.K=a,!1!==this.K||!0!==this.u&&!0!==this.C||this.stop())}});
Object.defineProperty(H.prototype,"currentTime",{get:function(){return this.B},set:function(a){"number"===typeof a&&(this.pause(),this.B=a,!0===this.u&&this.resume())}});Object.defineProperty(H.prototype,"spatialized",{get:function(){return this.da},set:function(a){"boolean"===typeof a&&(this.da=a)}});Object.defineProperty(H.prototype,"ambisonic",{get:function(){return this.qa}});Object.defineProperty(H.prototype,"duration",{get:function(){return this.o}});
Object.defineProperty(H.prototype,"muted",{get:function(){return this.ia||this.j.audio.mute},set:function(a){"boolean"===typeof a&&(!0===a?this.mute():this.Qe())}});Object.defineProperty(H.prototype,"volume",{get:function(){return this.D},set:function(a){"number"===typeof a&&(a=g.Math.fa(a,0,1),a!==this.D&&!1!==this.j.audio.enabled&&!1!==this.K&&(this.D=a,0<this.D&&(this.ia=!1),!0===this.j.audio.useWebAudio&&!1===bc(this)?this.F.gain.value=a:dc(this),this.Aa&&this.Aa.H()))}});
Object.defineProperty(H.prototype,"decoded",{get:function(){return this.J?this.Ba:!1}});Object.defineProperty(H.prototype,"playCount",{get:function(){return this.Fa}});Object.defineProperty(H.prototype,"playing",{get:function(){return this.u}});Object.defineProperty(H.prototype,"ready",{get:function(){return this.ja}});Object.defineProperty(H.prototype,"paused",{get:function(){return this.C}});
Object.defineProperty(H.prototype,"loop",{get:function(){return this.O},set:function(a){"boolean"===typeof a&&(this.O=a,!0!==this.j.audio.useAudioTag&&!0!==bc(this)||!this.c||Infinity!==this.o||(this.c.data.loop=this.O))}});Object.defineProperty(H.prototype,"x",{get:function(){return this.Ga},set:function(a){"number"===typeof a&&(this.Ga=a,!0===this.j.audio.useWebAudio&&!1===bc(this)&&this.c&&null!==this.m&&!0===this.da&&fc(this))}});
Object.defineProperty(H.prototype,"y",{get:function(){return this.wa},set:function(a){"number"===typeof a&&(this.wa=a,!0===this.j.audio.useWebAudio&&!1===bc(this)&&this.c&&null!==this.m&&!0===this.da&&fc(this))}});Object.defineProperty(H.prototype,"z",{get:function(){return this.wa},set:function(a){"number"===typeof a&&(this.Ia=a,!0===this.j.audio.useWebAudio&&!1===bc(this)&&this.c&&null!==this.m&&!0===this.da&&fc(this))}});
Object.defineProperty(H.prototype,"onSoundDecode",{get:function(){this.Ca||(this.Ca=new p(this));return this.Ca}});Object.defineProperty(H.prototype,"onLoadStart",{get:function(){this.P||(this.P=new p(this));return this.P}});Object.defineProperty(H.prototype,"onLoadedData",{get:function(){this.ha||(this.ha=new p(this));return this.ha}});Object.defineProperty(H.prototype,"onCanPlay",{get:function(){this.U||(this.U=new p(this));return this.U}});
Object.defineProperty(H.prototype,"onCanPlayThrough",{get:function(){this.X||(this.X=new p(this));return this.X}});Object.defineProperty(H.prototype,"onMute",{get:function(){this.W||(this.W=new p(this));return this.W}});Object.defineProperty(H.prototype,"onUnmute",{get:function(){this.ta||(this.ta=new p(this));return this.ta}});Object.defineProperty(H.prototype,"onVolumeChange",{get:function(){this.Aa||(this.Aa=new p(this));return this.Aa}});
Object.defineProperty(H.prototype,"onPlay",{get:function(){this.I||(this.I=new p(this));return this.I}});Object.defineProperty(H.prototype,"onStop",{get:function(){this.sa||(this.sa=new p(this));return this.sa}});Object.defineProperty(H.prototype,"onPause",{get:function(){this.Z||(this.Z=new p(this));return this.Z}});Object.defineProperty(H.prototype,"onResume",{get:function(){this.ma||(this.ma=new p(this));return this.ma}});
Object.defineProperty(H.prototype,"onEnded",{get:function(){this.$||(this.$=new p(this));return this.$}});
function N(a,b){this.j=a;this.i=b;this.M=this.c=null;this.f=this.O="";this.J=this.m=1;this.G=this.K=this.C=!0;this.o=this.F=this.u=this.I=this.B=this.D=null;n.call(this,"Playlist");this.S=this.i.uid;aa(this);this.M=new D(this.j,this.i.name);this.c=[];a=this.i;this.C="undefined"!==typeof a.autoPlay?!!a.autoPlay:!0;this.G="undefined"!==typeof a.loop?!!a.loop:!0;this.m="undefined"!==typeof a.volume&&"number"===typeof a.volume.max?g.Math.fa(a.volume.max,0,1):1;this.J="undefined"!==typeof a.volume&&"number"===
typeof a.volume["default"]?g.Math.fa(a.volume["default"],0,this.m):g.Math.fa(1,0,this.m);a=this.i;"undefined"!==typeof a.tracks&&!0===g.L.Ma(a.tracks,"string")?this.c=a.tracks:this.warn("A playlist has no track in its configuration, or configuration is not valid!");"string"===typeof a["default"]&&""!==a["default"]?this.O=a["default"]:"number"===typeof a["default"]&&0<=a["default"]&&a["default"]<this.c.length?this.O=this.c[a["default"]].uid:this.warn("A playlist has a default track that is not in its tracks array!");
this.f=this.O;this.D&&this.D.H()}N.prototype=Object.create(n.prototype);e=N.prototype;e.constructor=N;e.Td=function(){0<this.c.length&&this.c.indexOf(this.f)+1===this.c.length&&(!1===this.G||!0===this.track.loop)?this.f=this.c[0]:this.td()};e.Tk=function(){this.B&&this.B.H()};e.Vk=function(){this.I&&this.I.H()};e.Sk=function(){this.u&&this.u.H()};e.Uk=function(){this.F&&this.F.H()};e.Rk=function(){this.o&&this.o.H()};e.Wk=function(){return!!this.c.length};
e.play=function(a,b){this.K="undefined"!==typeof b?b:!1;var d;if("string"===typeof a&&g.R.V(a,"PlaylistTrack"))d=a;else if(g.L.V(a,"PlaylistTrack"))d=a.uid;else if("number"===typeof a&&0<=a&&a<this.c.length)d=this.c[a];else if(""!==this.f)d=this.f;else if("undefined"===typeof a||""===a)d=this.c[0];if("undefined"!==typeof d){this.stop();this.f=d;if(!0===this.K&&!1===this.C)return this.warn("KEN.Playlist.play(); autoPlay is disabled"),this.track;this.track.play();!1===this.track.onEnded.has(this.Td,
this)&&this.track.onEnded.add(this.Td,this);this.log("KEN.Playlist.play(); [uid: "+this.f+"]");return this.track}return null};e.stop=function(){null!==this.track&&(this.track.stop(),"undefined"!==typeof this.track.onEnded&&!1===this.track.onEnded.has(this.Td,this)&&this.track.onEnded.remove(this.Td,this))};e.pause=function(){null!==this.track&&this.track.pause()};e.resume=function(){null!==this.track&&this.track.resume()};
e.td=function(){var a=-1;0<this.c.length&&(a=this.c.indexOf(this.f)+1,a===this.c.length&&(a=0));this.play(a,this.K);!0===this.paused&&this.pause()};e.re=function(){var a=-1;0<this.c.length&&(a=this.c.indexOf(this.f)-1,-1===a&&(a=this.c.length-1));this.play(a,this.K);!0===this.paused&&this.pause()};e.destroy=function(){this.stop();this.j=null;this.M.destroy();this.M=null;0<this.c.length&&(this.c.length=0,this.c=null);this.i=null;n.prototype.destroy.call(this)};
Object.defineProperty(N.prototype,"tracks",{get:function(){return this.c}});Object.defineProperty(N.prototype,"name",{get:function(){return this.M.value}});Object.defineProperty(N.prototype,"ready",{get:function(){return null!==this.track?this.track.ready:!1}});Object.defineProperty(N.prototype,"decoded",{get:function(){return null!==this.track?this.track.decoded:!1}});Object.defineProperty(N.prototype,"playing",{get:function(){return null!==this.track?this.track.playing:!1}});
Object.defineProperty(N.prototype,"paused",{get:function(){return null!==this.track?this.track.paused:!1}});Object.defineProperty(N.prototype,"track",{get:function(){return!0===g.R.V(this.f,"PlaylistTrack")?g.R.get(this.f,"PlaylistTrack"):null}});Object.defineProperty(N.prototype,"loop",{get:function(){return this.G},set:function(a){this.G=!!a}});Object.defineProperty(N.prototype,"autoPlay",{get:function(){return this.C},set:function(a){this.C=!!a}});
Object.defineProperty(N.prototype,"volume",{get:function(){return this.J},set:function(a){"number"===typeof a&&(a=g.Math.fa(a,0,1),this.J=this.m<a?this.m:a,!0===g.R.V(this.f,"PlaylistTrack")&&(a=g.R.get(this.f,"PlaylistTrack"),null!==a&&(a.volume=this.J*this.j.playlists.volume)))}});Object.defineProperty(N.prototype,"onPlay",{get:function(){this.B||(this.B=new p(this));return this.B}});Object.defineProperty(N.prototype,"onStop",{get:function(){this.I||(this.I=new p(this));return this.I}});
Object.defineProperty(N.prototype,"onPause",{get:function(){this.u||(this.u=new p(this));return this.u}});Object.defineProperty(N.prototype,"onResume",{get:function(){this.F||(this.F=new p(this));return this.F}});Object.defineProperty(N.prototype,"onEnded",{get:function(){this.o||(this.o=new p(this));return this.o}});Object.defineProperty(N.prototype,"onReady",{get:function(){this.D||(this.D=new p(this));return this.D}});
function z(a){this.j=a;this.u=this.c=this.M=null;this.f=this.i="";this.J=this.B=1;this.m=!0;this.o=this.O=!1;this.D=this.C=this.F=this.G=this.I=this.K=null;n.call(this,"PlaylistManager")}z.prototype=Object.create(n.prototype);e=z.prototype;e.constructor=z;e.boot=function(){this.c=[];this.u=[];this.j.audio.onEnable.add(this.gi,this);this.j.tour.onSceneLoadStart.add(this.mh,this)};
e.gi=function(){!0===this.m&&0<this.c.length&&!0===this.ready&&!0===this.decoded&&!1===this.o&&(!0===this.paused?this.resume():!1===this.playing&&this.play())};
e.mh=function(){if("undefined"!==typeof this.j.tour.scene.config.playlists){var a=g.L.ib(this.M,this.j.tour.scene.config.playlists);hc(this,a);!1===this.o&&(!1===this.m?ic(this):jc(this,this.f)||!0===this.playing&&ic(this))}else hc(this,this.M),!1===this.o&&this.f!==this.i&&(!1!==this.m&&!1!==this.ready&&!1!==this.decoded&&!0!==this.playing||ic(this),jc(this,this.f))};
function hc(a,b){b&&(a.m="undefined"!==typeof b.enabled?!!b.enabled:!0,"undefined"!==typeof b["default"]&&("string"===typeof b["default"]&&""!==b["default"]?a.f=b["default"]:"number"===typeof b["default"]&&0<=b["default"]&&b["default"]<a.c.length&&(a.f=a.c[b["default"]].uid)),a.B="undefined"!==typeof b.volume&&"number"===typeof b.volume.max?g.Math.fa(b.volume.max,0,1):1,a.J="undefined"!==typeof b.volume&&"number"===typeof b.volume["default"]?g.Math.fa(b.volume["default"],0,a.B):g.Math.fa(1,0,a.B))}
e.na=function(a){var b;this.M=a;if("undefined"!==typeof a.lists)for(var d=0,h=a.lists.length;d<h;d++)b=new N(this.j,a.lists[d]),this.add(b);if("undefined"!==typeof a.tracks)for(d=0,h=a.tracks.length;d<h;d++)b=new O(this.j,a.tracks[d]),this.nh(b),!0===this.O&&this.warn("Preload is not supported yet.");hc(this,a);"undefined"!==typeof a.lists&&0<a.lists.length&&("string"===typeof a["default"]&&""!==a["default"]?this.f=a["default"]:"number"===typeof a["default"]&&0<=a["default"]&&a["default"]<this.c.length?
this.f=this.c[a["default"]].uid:this.warn("The playlist manager has a default playlist that is not in its playlists array!"),this.i=this.f);if(!(0>=this.c.length)){var k;"string"===typeof this.f&&""!==this.f?k=this.f:k=this.c[0].uid;void 0===g.R.get(k)&&this.warn('PlaylistManager : uid "'+k+'" is not into playlists');!0===g.R.V(k,"Playlist")?this.play(k,!0):this.warn("Impossible to play the playlist with uid "+k+", it doesn't seem to be a playlist!")}};
function jc(a,b){return null!==b&&!0===g.R.V(b,"Playlist")?(null!==a.playlist&&a.playlist.uid===b?null!==a.playlist.track&&"undefined"!==typeof a.playlist.track.uid&&""!==a.playlist.track.uid?!0===a.paused?a.resume():!1===a.playing&&a.play(b,!0):(a.stop(),a.play(b,!0)):(a.stop(),a.play(b,!0)),!0):!1}function ic(a){!0===a.playing?a.pause():a.stop()}e.Nk=function(){this.I&&this.I.H();null!==this.playlist&&N.prototype.Tk.call(this.playlist)};e.Pk=function(){this.G&&this.G.H();null!==this.playlist&&N.prototype.Vk.call(this.playlist)};
e.Mk=function(){this.F&&this.F.H();null!==this.playlist&&N.prototype.Sk.call(this.playlist)};e.Ok=function(){this.C&&this.C.H();null!==this.playlist&&N.prototype.Uk.call(this.playlist)};e.Lk=function(){this.D&&this.D.H();null!==this.playlist&&N.prototype.Rk.call(this.playlist)};e.add=function(a){this.c.push(a)};e.nh=function(a){this.u.push(a)};e.nn=function(){return!!this.c.length};e.Qk=function(){return!!this.u.length};
e.play=function(a,b){var d;if("string"===typeof a&&g.R.V(a,"Playlist"))d=a;else if(g.L.V(a,"Playlist"))d=a.uid;else if("number"===typeof a&&0<=a&&a<this.c.length)d=this.c[a].uid;else if(""!==this.i)d=this.i;else if("undefined"===typeof a||""===a)d=this.c[0].uid;"undefined"!==typeof d&&(!0===this.playing&&this.stop(),this.i=d,!0===this.m&&(this.o=!1,this.playlist.play(null,b),this.log("KEN.PlaylistManager.play(); [uid: "+this.i+"]")))};e.stop=function(){null!==this.playlist&&this.playlist.stop()};
e.pause=function(){null!==this.playlist&&!0===this.playlist.playing&&(this.o=!0,this.playlist.pause())};e.resume=function(){if(null!==this.playlist&&!0===this.m&&!0===this.playlist.paused){var a=this.o;this.o=!1;!0===a&&this.f!==this.i?jc(this,this.f):this.playlist.resume()}};e.td=function(){null!==this.playlist&&!0===this.m&&this.playlist.td()};e.re=function(){null!==this.playlist&&!0===this.m&&this.playlist.re()};
e.destroy=function(){this.stop();this.j.audio.onEnable.remove(this.gi,this);this.j.tour.onSceneLoadStart.remove(this.mh,this);this.M=this.j=null;for(var a=this.c.length;a--;)this.c[a].destroy();this.c=null;for(a=this.u.length;a--;)this.u[a].destroy();this.u=null;n.prototype.destroy.call(this)};Object.defineProperty(z.prototype,"playlists",{get:function(){return this.c}});Object.defineProperty(z.prototype,"tracks",{get:function(){return this.u}});
Object.defineProperty(z.prototype,"playlist",{get:function(){return!0===g.R.V(this.i,"Playlist")?g.R.get(this.i,"Playlist"):null}});Object.defineProperty(z.prototype,"loop",{get:function(){return null!==this.playlist?this.playlist.loop:!0}});Object.defineProperty(z.prototype,"autoPlay",{get:function(){return null!==this.playlist?this.playlist.autoPlay:!0}});Object.defineProperty(z.prototype,"preload",{get:function(){return this.O},set:function(a){this.O=!!a}});
Object.defineProperty(z.prototype,"enabled",{get:function(){return this.m}});Object.defineProperty(z.prototype,"ready",{get:function(){return null!==this.playlist?this.playlist.ready:!1}});Object.defineProperty(z.prototype,"decoded",{get:function(){return null!==this.playlist?this.playlist.decoded:!1}});Object.defineProperty(z.prototype,"playing",{get:function(){return null!==this.playlist?this.playlist.playing:!1}});
Object.defineProperty(z.prototype,"paused",{get:function(){return null!==this.playlist?this.playlist.paused:!1}});Object.defineProperty(z.prototype,"volume",{get:function(){return this.J},set:function(a){if("number"===typeof a&&(a=g.Math.fa(a,0,1),this.J=this.B<a?this.B:a,!0===g.R.V(this.i,"Playlist")&&(a=g.R.get(this.i,"Playlist"),null!==a))){var b=a.track;null!==b&&(b.volume=a.volume*this.J)}}});Object.defineProperty(z.prototype,"onReady",{get:function(){this.K||(this.K=new p(this));return this.K}});
Object.defineProperty(z.prototype,"onPlay",{get:function(){this.I||(this.I=new p(this));return this.I}});Object.defineProperty(z.prototype,"onStop",{get:function(){this.G||(this.G=new p(this));return this.G}});Object.defineProperty(z.prototype,"onPause",{get:function(){this.F||(this.F=new p(this));return this.F}});Object.defineProperty(z.prototype,"onResume",{get:function(){this.C||(this.C=new p(this));return this.C}});
Object.defineProperty(z.prototype,"onEnded",{get:function(){this.D||(this.D=new p(this));return this.D}});function O(a,b){this.j=a;this.u=b;this.o=this.m=null;this.i="";this.f=!1;this.c=null;n.call(this,"PlaylistTrack");this.S=this.u.uid;aa(this);a=this.u;ba(this);this.S=a.uid;aa(this);this.m=new D(this.j,a.name);this.o=new D(this.j,a.author);this.i=a.url;this.f=a.loop||!1}O.prototype=Object.create(n.prototype);e=O.prototype;e.constructor=O;e.qh=function(){z.prototype.Nk.call(this.j.playlists)};
e.oi=function(){z.prototype.Pk.call(this.j.playlists)};e.ph=function(){z.prototype.Mk.call(this.j.playlists)};e.ni=function(){z.prototype.Ok.call(this.j.playlists)};e.oh=function(){z.prototype.Lk.call(this.j.playlists)};
e.play=function(){this.c||(this.c=new H(this.j,this.S+"-sound",this.i),this.c.volume=this.j.playlists.volume*this.j.playlists.playlist.volume,!0===this.f&&(this.c.loop=this.f),this.c.onPlay.add(this.qh,this),this.c.onStop.add(this.oi,this),this.c.onPause.add(this.ph,this),this.c.onResume.add(this.ni,this),this.c.onEnded.add(this.oh,this));this.c.play()};e.stop=function(){this.c&&this.c.stop(!0)};e.pause=function(){this.c&&this.c.pause()};e.resume=function(){this.c&&this.c.resume()};
e.destroy=function(){this.u=this.j=null;this.m.destroy();this.m=null;this.o.destroy();this.o=null;this.c&&(this.c.onPlay.remove(this.qh,this),this.c.onStop.remove(this.oi,this),this.c.onPause.remove(this.ph,this),this.c.onResume.remove(this.ni,this),this.c.onEnded.remove(this.oh,this),this.c.destroy(),this.c=null);n.prototype.destroy.call(this)};Object.defineProperty(O.prototype,"name",{get:function(){return this.m.value}});Object.defineProperty(O.prototype,"author",{get:function(){return this.o.value}});
Object.defineProperty(O.prototype,"currentTime",{get:function(){return this.c?this.c.currentTime:0},set:function(a){this.c&&(this.c.currentTime=a)}});Object.defineProperty(O.prototype,"volume",{get:function(){return this.c?this.c.volume:!1},set:function(a){if(!this.c)return!1;this.c.volume=a}});Object.defineProperty(O.prototype,"ready",{get:function(){return this.c?this.c.ready:!1}});Object.defineProperty(O.prototype,"decoded",{get:function(){return this.c?this.c.decoded:!1}});
Object.defineProperty(O.prototype,"playing",{get:function(){return this.c?this.c.playing:!1}});Object.defineProperty(O.prototype,"paused",{get:function(){return this.c?this.c.paused:!1}});Object.defineProperty(O.prototype,"loop",{get:function(){return this.f},set:function(a){this.f=!!a}});Object.defineProperty(O.prototype,"onPlay",{get:function(){if(this.c)return this.c.onPlay}});Object.defineProperty(O.prototype,"onStop",{get:function(){if(this.c)return this.c.onStop}});
Object.defineProperty(O.prototype,"onPause",{get:function(){if(this.c)return this.c.onPause}});Object.defineProperty(O.prototype,"onResume",{get:function(){if(this.c)return this.c.onResume}});Object.defineProperty(O.prototype,"onEnded",{get:function(){if(this.c)return this.c.onEnded}});
function na(a){this.j=a;this.f=this.m=null;this.F=this.o=0;this.u=this.i=this.c=null;this.D=this.B=!1;this.I=null;n.call(this,"Director");this.m=[];this.i=this.j.clock.create(!1);this.j.tour.onSceneLoadComplete.add(this.uk,this);this.j.onReady.add(this.Xg,this);this.I=this.Im.bind(this)}na.prototype=Object.create(n.prototype);e=na.prototype;e.constructor=na;e.Xg=function(){this.j.controllers.onControlStart.add(this.dd,this);this.j.controllers.onControlEnd.add(this.cd,this)};
e.uk=function(){var a=this.j.tour.scene;this.stop();this.c=null;"undefined"!==typeof a.config.director&&(a=a.config.director,null!==a.animation&&(kc(this,a.animation),this.j.tour.scene.config.media.type===g.kb.VIDEO&&(this.j.renderer.media.displayObject.onPause.add(this.tf,this),this.j.renderer.media.displayObject.onWaiting.add(this.Lc,this),this.j.renderer.media.displayObject.onStalled.add(this.Lc,this),this.j.renderer.media.displayObject.onEnded.add(this.Ul,this),this.j.renderer.media.displayObject.onCurrentTimeChange.add(this.Qm,
this),document.addEventListener("visibilitychange",this.I))))};e.Im=function(){document.hidden||this.j.renderer.media.displayObject.onCurrentTimeChange.H(this.j.renderer.media.displayObject.currentTime)};e.tf=function(){this.stop();this.j.renderer.media.displayObject.onPause.remove(this.tf,this);this.j.renderer.media.displayObject.onPlay.add(this.ti,this);this.j.controllers.onControlStart.remove(this.dd,this);this.j.controllers.onControlEnd.remove(this.cd,this)};
e.ti=function(){this.f&&this.play(this.f,this.f.tweenToStart,this.f.loop,!0,!1);this.j.renderer.media.displayObject.onPause.add(this.tf,this);this.j.renderer.media.displayObject.onPlay.remove(this.ti,this);this.j.controllers.onControlStart.add(this.dd,this);this.j.controllers.onControlEnd.add(this.cd,this)};
e.Lc=function(){this.stop();this.j.renderer.media.displayObject.onWaiting.remove(this.Lc,this);this.j.renderer.media.displayObject.onStalled.remove(this.Lc,this);this.j.renderer.media.displayObject.onPlaying.add(this.ui,this);this.j.controllers.onControlStart.remove(this.dd,this);this.j.controllers.onControlEnd.remove(this.cd,this)};
e.ui=function(){this.f&&this.play(this.f,this.f.tweenToStart,this.f.loop,!0,!1);this.j.renderer.media.displayObject.onPlaying.remove(this.ui,this);this.j.renderer.media.displayObject.onWaiting.add(this.Lc,this);this.j.renderer.media.displayObject.onStalled.add(this.Lc,this);this.j.controllers.onControlStart.add(this.dd,this);this.j.controllers.onControlEnd.add(this.cd,this)};e.Ul=function(){!0===this.j.renderer.media.displayObject.loop&&kc(this)};
e.dd=function(){this.c&&!0===this.c.user.canStop&&this.stop();this.i.stop(!0)};e.cd=function(){this.u&&this.i.remove(this.u);this.c&&!0===this.c.user.canStop&&(this.f||"number"!==typeof this.c.intro.idleTime?"number"===typeof this.c.user.idleTime&&-1<this.c.user.idleTime&&(this.u=this.i.add(this.c.user.idleTime,this.rf,this,this.f,this.f.tweenToStart,this.f.loop),this.i.start()):(this.u=this.i.add(this.c.intro.idleTime,this.rf,this,null,this.D,this.B),this.i.start()))};
e.rf=function(a,b,d){this.F<this.c.tracks.length&&this.play(a,b,d,!0);this.i.stop(!0)};e.pi=function(){this.f=null;this.F++;if(this.c){var a=!0;!0===this.c.loop?(this.o=(this.o+1)%this.c.tracks.length)||!0!==this.c.loop||(this.c.tracks=g.L.ud(this.c.tracks)):a=++this.o<this.c.tracks.length;a&&this.play(this.c.tracks[this.o],this.D,this.B)}};
e.Qm=function(a){this.f&&this.f.stop();this.f=null;"number"===typeof a?a*=1E3:"number"===typeof a.data?a=1E3*a.data:a=this.j.renderer.media.displayObject.currentTimeMS;var b=0,d,h;h=g.R.get(this.c.tracks[0]);if(h.duration>a)this.f=h;else for(var k=0,l=this.c.tracks.length-1;k<l;k++){d=h;h=g.R.get(this.c.tracks[k+1]);if(d.duration+b<a&&h.duration+d.duration+b>a){this.f=h;b+=d.duration;break}b+=d.duration}null===this.f?(a=h.waypoints.slice(-1)[0],this.j.renderer.camera.Ij(a.yaw,a.pitch,a.roll,a.fov)):
this.f.update(a-b)};
function kc(a,b){b&&"undefined"!==typeof b&&!1===b.enabled?a.c=null:(b&&"undefined"!==typeof b&&(a.c=b),a.c&&!0===Array.isArray(a.c.tracks)&&0<a.c.tracks.length&&(!0===a.c.random&&(a.c.tracks=g.L.ud(a.c.tracks)),a.o=0,b=a.c.tracks[a.o],a.F=0,a.B=2>a.c.tracks.length&&"boolean"===typeof a.c.loop?a.c.loop:!1,a.D="undefined"!==typeof a.c.intro&&"boolean"===typeof a.c.intro.smooth?a.c.intro.smooth:!0,"number"===typeof a.c.intro.idleTime&&(a.u=a.i.add(a.c.intro.idleTime,a.rf,a,b,a.D,a.B),a.i.start())))}
e.na=function(a){if(!0===Array.isArray(a.tracks))for(var b=0,d=a.tracks.length;b<d;b++){var h=new lc(this.j,a.tracks[b]);h.onComplete.add(this.pi,this);this.m.push(h)}};
e.play=function(a,b,d,h,k){this.stop();if(!0===h&&this.f)return this.f.resume(k),!0;h=null;"undefined"===typeof a&&(this.F=0);b="boolean"===typeof b?b:!0;"string"===typeof a&&!0===g.R.V(a,"DirectorTrack")?h=g.R.get(a):!0===g.L.V(a,"DirectorTrack")?h=a:this.f?h=this.f:h=g.R.get(this.c.tracks[this.o]);if(null!==h&&void 0!==h)return this.f=h,this.f.play(b,d),!0;this.warn("No track matching the value passed in arguments to KEN.Director.play");return!1};e.stop=function(){this.f&&this.f.stop()};
e.destroy=function(){this.j.onReady.remove(this.Xg,this);this.j=null;for(var a=this.m.length;a--;)this.m[a].onComplete.remove(this.pi,this),this.m[a].destroy(),this.m[a]=null;this.c=this.f=this.m=null;n.prototype.destroy.call(this)};Object.defineProperty(na.prototype,"tracks",{get:function(){return this.m}});Object.defineProperty(na.prototype,"animation",{get:function(){return this.c}});
function lc(a,b){this.j=a;this.D=b;this.c=null;this.F=this.I="";this.C=!1;this.B=!0;this.m=this.o=null;this.f=this.i=!1;this.G=0;this.u=null;n.call(this,"DirectorTrack");this.c=[];this.S=this.D.uid;this.qb=this.D.tags;aa(this);a=this.D;this.I="string"===typeof a.name?a.name:this.I;this.F="string"===typeof a.description?a.description:this.F;this.C="boolean"===typeof a.smooth?a.smooth:this.C;this.B="boolean"===typeof a.cancelRoll?a.cancelRoll:this.B;this.o=g.T.nc;"string"===typeof a.easingStart&&"function"===
typeof g.T[a.easingStart]&&(this.o=g.T[a.easingStart]);this.m=g.T.Dc;"string"===typeof a.easingEnd&&"function"===typeof g.T[a.easingEnd]&&(this.m=g.T[a.easingEnd]);if(!0===Array.isArray(a.waypoints)){a.waypoints=g.L.Xj(a.waypoints,"time");b=0;for(var d=a.waypoints.length;b<d;b++){var h=a.waypoints[b];this.c.push(new Kb(h.time,h.yaw,h.pitch,h.roll,h.fov))}}}lc.prototype=Object.create(n.prototype);e=lc.prototype;e.constructor=lc;e.lf=function(){mc(this);!0===this.f?this.play(this.i,this.f):this.u.H()};
function mc(a){a.j.renderer.camera.animation.onComplete.remove(a.lf,a)}e.play=function(a,b){this.i="boolean"==typeof a?a:this.i;this.f="boolean"==typeof b?b:this.f;this.j.renderer.camera.animation.waypoints=this.c;this.j.renderer.camera.animation.onComplete.add(this.lf,this);this.j.renderer.camera.animation.play(this.C,this.B,this.o,this.m,this.i);this.G++};e.resume=function(a){this.j.renderer.camera.animation.onComplete.add(this.lf,this);this.j.renderer.camera.animation.resume(a)};
e.update=function(a){this.j.renderer.camera.animation.waypoints=this.c;this.j.renderer.camera.animation.update(a)};e.stop=function(){mc(this);this.j.renderer.camera.animation.stop()};e.destroy=function(){this.m=this.o=this.j=null;for(var a=0,b=this.c.length;a<b;a++)this.c[a].destroy(),this.c[a]=null;this.c=null;n.prototype.destroy.call(this)};Object.defineProperty(lc.prototype,"name",{get:function(){return this.I}});Object.defineProperty(lc.prototype,"description",{get:function(){return this.F}});
Object.defineProperty(lc.prototype,"count",{get:function(){return this.G}});Object.defineProperty(lc.prototype,"tweenToStart",{get:function(){return this.i},set:function(a){this.i=a}});Object.defineProperty(lc.prototype,"loop",{get:function(){return this.f},set:function(a){this.f=a}});Object.defineProperty(lc.prototype,"duration",{get:function(){return this.c[this.c.length-1].ts}});Object.defineProperty(lc.prototype,"waypoints",{get:function(){return this.c}});
Object.defineProperty(lc.prototype,"onComplete",{get:function(){this.u||(this.u=new p(this));return this.u}});function pb(a){this.j=a;this.f=[];n.call(this,"ActionEventDispatcher")}pb.prototype=Object.create(n.prototype);pb.prototype.constructor=pb;pb.prototype.c=function(a){if(!0===g.L.Ma(a,"string")||g.L.V(a,"string"))this.f=this.f.concat(a)};pb.prototype.H=function(){for(var a=0,b=this.f.length;a<b;a++){var d=this.j.actions.get(this.f[a]);"undefined"!==typeof d&&null!==d&&d.Ib()}};
pb.prototype.destroy=function(){this.j=null;n.prototype.destroy.call(this)};function nc(a,b){this.j=a;this.m=b;this.i="";this.c=this.f=null;n.call(this,"Action");a=this.m;this.S=a.uid;this.i=a.target;this.f="undefined"!==typeof a.method?a.method:null;this.c="undefined"!==typeof a.property?a.property:null;aa(this)}nc.prototype=Object.create(n.prototype);nc.prototype.constructor=nc;var oc={ff:"set",Eg:"add",Yh:"substract",Qh:"multiply",Lg:"divide",$h:"toggle"};
function pc(a,b){var d=null;if("undefined"===typeof b)d=window;else{var h=b,k=b;"object"===typeof b&&("string"===typeof b.uid&&(h=b.uid),"string"===typeof b.properties&&(k=b.properties));b=g.R.get(h);"undefined"!==typeof b&&null!==b&&(g.L.V(b,"Plugin")?d=b.instance:d=b);k=k.split(".");b=0;"viewer"===k[0].toLowerCase()&&(d=a.j,b=1);for(h=k.length;b<h;b++)"object"===typeof d[k[b]]&&(d=d[k[b]])}null===d&&a.warn("The target of the action "+a.S+" is invalid.");return d}
nc.prototype.Ib=function(){var a=pc(this,this.i);if(null!==a){if(this.c){var b=this.c;if("undefined"!==typeof a[b.name])switch("undefined"===typeof b.operation&&(b.operation=oc.ff),b.operation){case oc.ff:a[b.name]=b.value;break;case oc.Eg:a[b.name]+=b.value;break;case oc.Yh:a[b.name]-=b.value;break;case oc.Qh:a[b.name]*=b.value;break;case oc.Lg:a[b.name]/=b.value;break;case oc.$h:a[b.name]=!a[b.name]}}this.f&&(b=this.f,"function"===typeof a[b.name]&&a[b.name].apply(a,"undefined"!==typeof b.args?
b.args:null))}};nc.prototype.destroy=function(){this.j=null;n.prototype.destroy.call(this)};Object.defineProperty(nc.prototype,"target",{get:function(){return pc(this,this.i)}});Object.defineProperty(nc.prototype,"count",{get:function(){return 0}});function ma(a){this.j=a;this.c=[];n.call(this,"ActionManager")}ma.prototype=Object.create(n.prototype);ma.prototype.constructor=ma;ma.prototype.get=function(a){return g.R.get(a,"Action")};
ma.prototype.na=function(a){var b;if(!0===Array.isArray(a))for(var d=0,h=a.length;d<h;d++)b=new nc(this.j,a[d]),this.c.push(b);else b=new nc(this.j,a),this.c.push(b)};ma.prototype.destroy=function(){if(g.L.Ma(this.c,"Action"))for(;0<this.c.length;)this.c.pop().destroy()};
function P(a,b,d,h){this.j=a;this.F=b;this.I=d;this.B=this.M=null;this.$=h;this.c=this.i=this.J=this.K=null;this.U=!1;this.C=this.G=this.D=this.f=this.m=null;this.O=this.X=!0;this.u=this.o=null;n.call(this,"Plugin");this.S=this.I.uid;this.qb=this.I.tags;aa(this);this.C={}}P.prototype=Object.create(n.prototype);e=P.prototype;e.constructor=P;
function qc(a){a.B=g.L.ib(a.F.defaultConfig,a.I,a.M);a.K=a.B.options;a.Hb=a.B.data;a.J=a.B.actions;for(var b in a.i)a.i[b].destroy(),a.i[b]=null;b=a.B.events;a.i={};var d,h;for(h in b)d=new pb(a.j),d.c(b[h]),a.i[h]=d}e.Cj=function(){!0===this.F.loaded?rc(this):this.F.onLoadComplete.ga(this.Vl,this)};e.Vl=function(){rc(this)};
function rc(a){a.log("Plugin._instantiatePlugin(); "+a.S);var b=a.I;"string"===typeof b.parent&&(a.m=b.parent);a.X="boolean"===typeof b.keep?b.keep:!0;a.O="boolean"===typeof b.reset?b.reset:!0;a.G||!0!==g.L.Ma(b.scenes,"string")||(a.G=b.scenes);qc(a);a.c=a.F.mj(a);a.c.boot.call(a.c);a.o&&a.o.H()}e.Bn=function(){this.U=!0;this.u&&this.u.H()};e.update=function(){this.c&&this.c.update.call(this.c)};
e.Sj=function(){qc(this);this.c&&("function"===typeof this.c.reset?this.c.reset.call(this.c):this.warn("There is no reset function on plugin "+this.F.uid))};
e.destroy=function(){if(!1!==this.ob){this.c&&(this.c.viewer=null,this.c.plugin=null,this.c.destroy(),this.c=null);this.D&&(this.D.destroy(),this.D=null);this.f&&(this.f.destroy(),this.f=null);this.o&&(this.o.destroy(),this.o=null);this.u&&(this.u.destroy(),this.u=null);for(var a=this.i.length;a--;)this.i[a].destroy();this.C=this.j=this.i=null;n.prototype.destroy.call(this)}};Object.defineProperty(P.prototype,"fullUrl",{get:function(){return this.F.fullUrl}});
Object.defineProperty(P.prototype,"options",{get:function(){return this.K}});Object.defineProperty(P.prototype,"actions",{get:function(){return this.J}});Object.defineProperty(P.prototype,"events",{get:function(){return this.i}});Object.defineProperty(P.prototype,"scenes",{get:function(){return this.G}});Object.defineProperty(P.prototype,"persistentData",{get:function(){return this.C},set:function(a){this.C=a}});Object.defineProperty(P.prototype,"instance",{get:function(){return this.c}});
Object.defineProperty(P.prototype,"instanceReady",{get:function(){return this.U}});Object.defineProperty(P.prototype,"container",{get:function(){if(!this.f){if("string"===typeof this.m&&""!==this.m){this.m=document.getElementById(this.m);if("undefined"===typeof this.m||!this.m||!1===g.la.Sf(this.m))throw"KEN.Plugin.boot : Plugin parent is invalid";this.f=new u(this.j,null,null,this.m)}else this.f=new u(this.j),this.j.pluginContainer.cc(this.f),this.f.Lb(!0);this.f.id=this.S;this.f.index=this.$}return this.f}});
Object.defineProperty(P.prototype,"create",{get:function(){this.D||(this.D=new Q(this.j,this));return this.D}});Object.defineProperty(P.prototype,"keep",{get:function(){return this.X}});Object.defineProperty(P.prototype,"reset",{get:function(){return this.O}});Object.defineProperty(P.prototype,"contextualConfig",{get:function(){return this.M},set:function(a){this.M=a}});Object.defineProperty(P.prototype,"instanceConfig",{get:function(){return this.I}});Object.defineProperty(P.prototype,"config",{get:function(){return this.B}});
Object.defineProperty(P.prototype,"onInstanceCreate",{get:function(){this.o||(this.o=new p(this,!0));return this.o}});Object.defineProperty(P.prototype,"onInstanceReady",{get:function(){this.u||(this.u=new p(this,!0));return this.u}});function sc(a){n.call(this,"PluginEngine");this.j=a;this.D=null;this.o=this.O=this.i=this.K="";this.M=null;this.u="";this.B=null;this.G="";this.m=this.F=this.C=this.I=this.f=null;this.U=0;this.J=!1;this.c=null}sc.prototype=Object.create(n.prototype);
sc.prototype.constructor=sc;var tc=["boot","update","destroy"],uc=["viewer","plugin"];e=sc.prototype;
e.load=function(a){if("undefined"!==typeof a){a=this.D=a;if("undefined"===typeof a.uid)throw"Can't load a plugin engine, missing id in config";this.S=a.uid;aa(this);this.K="string"===typeof a.prefix?a.prefix:this.j.plugins.prefix;if("undefined"===typeof a.url)throw"Can't load a plugin engine, missing url in config";this.i=a.url;this.o=this.K+this.i;if("undefined"===typeof a.manifest)throw"Can't load a plugin engine, missing manifest file name in config";this.O=a.manifest;this.j.load.json(this.S,this.o+
this.O,this.fm,this);return!0}return!1};e.mj=function(a){for(var b=new this.f,d=0,h=uc.length;d<h;d++)if("undefined"!==typeof b[uc[d]])throw"KEN.PluginEngine instance validation failed, "+uc[d]+" is reserved";if(this.m)for(d=0,h=this.m.length;d<h;d++)if("function"!==typeof b[this.m[d]])throw"KEN.PluginEngine instance validation failed, action "+this.m[d]+" is undefined on plugin "+this.G;b.j=this.j;b.bc=a;return b};
e.fm=function(a){a=this.M=this.j.cache.get(B.JSON,a.key).data;if(this.S!==a.uid)throw"Plugin Engine UID doesn't match with manifest UID";var b=a.viewer,d="0.0.0",h="9.9.9";"undefined"!==typeof b&&("undefined"!==typeof b.min&&(d=b.min),"undefined"!==typeof b.max&&(h=b.max));for(var b=g.VERSION.split("."),d=d.split("."),h=h.split("."),k=0,l=0,q=0,t=Math.max(b.length,d.length,h.length)-1;0<=t;t--)"undefined"!==typeof b[t]&&(k=parseInt(b[t],10)),"undefined"!==typeof d[t]&&(l=parseInt(d[t],10)),"undefined"!==
typeof h[t]&&(q=parseInt(h[t],10));if(!1===(k<l||k>q?!1:!0))this.warn("Version compatibility check for plugin "+a.uid+" failed!"),this.warn(a.viewer);else{var y;a:{b=a.device;if("undefined"!==typeof b)for(y in b)if("undefined"===typeof g.A[y])this.warn("Unable to check plugin device compatibility for: "+y);else if(g.A[y]!==b[y]){y=!1;break a}y=!0}if(!1===y)this.warn("Device compatibility check for plugin "+a.uid+" failed!"),this.warn(a.device);else{"undefined"!==typeof a.options&&(this.C=a.options);
"undefined"!==typeof a.data&&(this.Hb=a.data);"undefined"!==typeof a.actions&&(this.m=a.actions);"undefined"!==typeof a.events&&(this.F=a.events);this.u=a.name;this.B=a.sources;this.G=a.constructor;y=null;if("undefined"!==typeof a.i18n&&(y=a.i18n,"undefined"!==typeof y.locales))for(b=0,d=y.locales.length;b<d;b++)if(a=y.locales[b],"undefined"!==typeof a.files)for(k=0,l=a.files.length;k<l;k++)h=a.files[k],h.key=this.S+"-"+h.key,h.url=this.o+h.url;this.I=y;a=this.B;y=0;for(b=a.length;y<b;y++)d="http://"===
String(a[y]).substring(0,7)||"https://"===String(a[y]).substring(0,8)?a[y]:this.o+a[y],"css"===ya(d).extension?this.j.load.Wi(d,this.ki,this):this.j.load.lg(d,this.ki,this)}}this.log("KEN.Plugin._manifestLoadComplete();")};
e.ki=function(){this.U++;if(this.U===this.B.length){var a;a:{a=this.G;if("string"===typeof a&&""!==a){a=a.split(".");for(var b=window,d=0,h=a.length;d<h;d++){if(d===a.length-1&&"function"===typeof b[a[d]]){a=b[a[d]];break a}if("object"===typeof b[a[d]])b=b[a[d]];else break}}a=null}this.f=a;!0===vc(this)&&((a=this.I)&&this.j.i18n.na(a),this.J=!0,this.c&&this.c.H())}};
function vc(a){if(!a.f||"function"!==typeof a.f)throw"Plugin engine "+a.S+" can't find it's constructor";for(var b=0,d=tc.length;b<d;b++)if("function"!==typeof a.f.prototype[tc[b]])throw"KEN.PluginEngine engine validation failed, missing required method "+tc[b]+" on plugin engine "+a.u;Object.defineProperty(a.f.prototype,"viewer",{get:function(){return this.j}});Object.defineProperty(a.f.prototype,"plugin",{get:function(){return this.bc}});return!0}
e.destroy=function(){this.I=this.f=this.B=this.u=this.M=this.D=this.j=null;this.c&&(this.c.destroy(),this.c=null);n.prototype.destroy.call(this)};Object.defineProperty(sc.prototype,"name",{get:function(){return this.u}});Object.defineProperty(sc.prototype,"loaded",{get:function(){return this.J}});Object.defineProperty(sc.prototype,"url",{get:function(){return this.i}});Object.defineProperty(sc.prototype,"fullUrl",{get:function(){return this.o}});Object.defineProperty(sc.prototype,"options",{get:function(){return this.C}});
Object.defineProperty(sc.prototype,"actions",{get:function(){return this.m}});Object.defineProperty(sc.prototype,"events",{get:function(){return this.F}});Object.defineProperty(sc.prototype,"defaultConfig",{get:function(){return{data:this.Hb,options:this.C,actions:this.m,events:this.F}}});Object.defineProperty(sc.prototype,"onLoadComplete",{get:function(){this.c||(this.c=new p(this));return this.c}});
function A(a){n.call(this,"PluginManager");this.j=a;this.m=!0;this.u="";this.f=this.c=this.i=null}A.prototype=Object.create(n.prototype);e=A.prototype;e.constructor=A;
e.Xk=function(a){a=a.data.uid;for(var b,d=this.c.size;d--;)b=this.c.get(d),(!1===b.keep||null!==b.scenes&&-1===b.scenes.indexOf(a))&&this.remove(b.uid);!0===this.m&&"undefined"!==typeof this.o&&(a=this.o,wc(this,a.engines),xc(this,a.instances),yc(this,a.configurations));!0===this.m&&"undefined"!==typeof this.j.tour.scene.config.plugins&&(a=this.j.tour.scene.config.plugins,wc(this,a.engines),xc(this,a.instances),yc(this,a.configurations));for(b=this.c.size;b--;)a=this.c.get(b),!0===a.reset&&a.Sj()};
function wc(a,b){if("undefined"!==typeof b)for(var d=0,h=b.length;d<h;d++){var k=b[d];if("string"===typeof k.uid&&!1===g.R.hb(k.uid)){var l=new sc(a.j);a.i.add(l);l.load(k)}}}
function xc(a,b){if("undefined"!==typeof b)for(var d=0,h=b.length;d<h;d++){var k=!1!==b[d].enabled?!0:!1,l=a.Zd(b[d].uid),q=a.j.tour.sceneUid,t=g.L.Ma(b[d].scenes,"string")?b[d].scenes:[],q=0===t.length||""===q&&0===t.length||-1!==t.indexOf(q);if(!0===k&&!l&&!0===q){k=a;l=b[d];if("undefined"===typeof l.engine)throw"Can't create plugin instance, engineUid is undefined";a:{for(var q=k,t=l.engine,y,C=0,xb=q.i.size;C<xb;C++)if(y=q.i.get(C),y.uid===t){q=y;break a}q=null}if(!q)throw"Plugin Engine "+l.engine+
" doesn't exist";l=new P(k.j,q,l,"number"===typeof l.index?l.index:k.c.size);l.onInstanceCreate.ga(k.om,k);k.c.add(l);l.Cj()}}}function yc(a,b){if("undefined"!==typeof b)for(var d=0,h=b.length;d<h;d++){var k=!1!==b[d].enabled?!0:!1,l=a.Zd(b[d].instance),q=null;!0===k&&(q=b[d]);l&&(l.contextualConfig=q)}}e.om=function(a){a=a.emitter;this.f&&this.f.H(a)};e.boot=function(){this.i=new zc;this.c=new zc;this.j.tour.onSceneLoadStart.add(this.Xk,this)};
e.na=function(a){this.o=a;this.m="boolean"===typeof a.enabled?a.enabled:!0;this.u="string"===typeof a.prefix?a.prefix:"./"};e.Zd=function(a){for(var b,d=0,h=this.c.size;d<h;d++)if(b=this.c.get(d),b.uid===a)return b;return null};e.kj=function(a){a=this.c.get(a);return"undefined"!==typeof a?a:null};e.get=function(a){var b=null;"string"===typeof a?b=this.Zd(a):"number"===typeof a&&(b=this.kj(a));return b};e.remove=function(a){a=this.get(a);a.destroy();this.c.remove(a)};
e.update=function(){for(var a,b=0,d=this.c.size;b<d;b++)a=this.c.get(b),a.update()};e.render=function(){};e.destroy=function(){this.j=null;this.f&&(this.f.destroy(),this.f=null);for(var a=0,b=this.i.size;a<b;a++)this.i.get(a).destroy();this.i=null;a=0;for(b=this.c.size;a<b;a++)this.c.get(a).destroy();this.c=null;n.prototype.destroy.call(this)};Object.defineProperty(A.prototype,"all",{get:function(){return this.c}});Object.defineProperty(A.prototype,"enabled",{get:function(){return this.m}});
Object.defineProperty(A.prototype,"prefix",{get:function(){return this.u}});Object.defineProperty(A.prototype,"onInstanceCreate",{get:function(){this.f||(this.f=new p(this,!0));return this.f}});function Q(a,b){this.j=a;this.bc=b;this.ba=[];n.call(this,"PluginObjectFactory")}Q.prototype=Object.create(n.prototype);e=Q.prototype;e.constructor=Q;e.sb=function(a){a:{for(var b=this.ba.length,d;b--;)if(d=this.ba[b],d===a.emitter){a=b;break a}a=-1}this.ba.splice(a,1)};
e.Kn=function(a){a=new D(this.j,a);a.onDestroy.ga(this.sb,this);this.ba.push(a);return a};e.Ln=function(a){a=new R(this.j,a);a.onDestroy.ga(this.sb,this);this.ba.push(a);return a};e.sound=function(a,b){a=new H(this.j,a,b);a.onDestroy.ga(this.sb,this);this.ba.push(a);return a};e.an=function(a){a=new u(this.j,a);a.onDestroy.ga(this.sb,this);this.ba.push(a);return a};e.Zk=function(a){a=new T(this.j,a);a.onDestroy.ga(this.sb,this);this.ba.push(a);return a};
e.image=function(a,b){var d=a;"string"===typeof a&&(d={key:null,url:a});d.key=this.bc.uid+"-"+d.key;!1!==b&&(d.url=this.bc.fullUrl+d.url);a=new I(this.j,d);a.onDestroy.ga(this.sb,this);this.ba.push(a);return a};e.In=function(a,b){a.key=this.bc.uid+"-"+a.key;!1!==b&&(a.url=this.bc.fullUrl+a.url,a.frames=this.bc.fullUrl+a.frames);a=new Ac(this.j,a);a.onDestroy.ga(this.sb,this);this.ba.push(a);return a};e.Yk=function(a){a=new Bc(this.j,a);a.onDestroy.ga(this.sb,this);this.ba.push(a);return a};
e.al=function(a,b,d,h,k){var l;d===g.fb.De?l=new J(this.j,a,b,h):l=new K(this.j,a,b,h,k);l.onDestroy.ga(this.sb,this);this.ba.push(l);return l};e.canvas=function(){var a=new ea(this.j);a.onDestroy.ga(this.sb,this);this.ba.push(a);return a};e.$k=function(a){a=new vb(this.j,a);a.onDestroy.ga(this.sb,this);this.j.tween.add(a);this.ba.push(a);return a};e.$i=function(){this.log("destroyAllObjects();");for(var a=this.ba.length;a--;)this.ba[a].destroy()};
e.destroy=function(){this.$i();this.ba=this.bc=this.j=null;n.prototype.destroy.call(this)};
g.A=function(a){a=a();a.prototype=Object.create(null);a.prototype.constructor=a;a.prototype.Ml=function(){if(/Playstation Vita/.test(this.ea))this.jb="Playstation Vita",this.sg=!0;else if(/Xbox/.test(this.ea))this.jb="Xbox",this.Dg=!0;else if(/Kindle/.test(this.ea)||/\bKF[A-Z][A-Z]+/.test(this.ea)||/Silk.*Mobile Safari/.test(this.ea))this.jb="Kindle",this.Vf=!0;else if(/Windows Phone/i.test(this.ea)||/IEMobile/i.test(this.ea))this.jb="Windows Phone",this.Ae=!0,/Windows Phone (\d+)/.test(this.ea)&&
(this.ec=parseInt(RegExp.$1,10));else if(/Android/.test(this.ea))this.jb="Android",this.Pi=!0,/Android ([\.\_\d]+)/.test(this.ea)&&(this.ec=parseInt(RegExp.$1,10));else if(/CrOS/.test(this.ea))this.jb="Chrome OS",this.Bf=!0;else if(/iP[ao]d|iPhone/i.test(this.ea))this.jb="iOS",this.Qc=!0,/OS (\d+)/.test(navigator.appVersion)&&(this.ec=parseInt(RegExp.$1,10));else if(/(Linux|X11)/.test(this.ea))this.jb="Linux",this.Wf=!0;else if(/Mac OS X/.test(this.ea))this.jb="Mac OS X",this.Zf=!0,/Mac OS X (10[\.\_\d]+)/.test(this.ea)&&
(this.ec=parseInt(RegExp.$1,10));else if(/Windows/.test(this.ea)||/WPDesktop/i.test(this.ea))/WPDesktop/i.test(this.ea)?(this.jb="Windows Phone",this.Ae=!0):(this.jb="Windows",this.Bg=!0),/(Windows 10.0|Windows NT 10.0)/.test(this.ea)?this.ec=10:/(Windows 8.1|Windows NT 6.3)/.test(this.ea)||/(Windows 8|Windows NT 6.2)/.test(this.ea)?this.ec=8:/(Windows 7|Windows NT 6.1)/.test(this.ea)&&(this.ec=7)};a.prototype.Dl=function(){this.pd="undefined"!==typeof document.documentMode;this.Wd=!1===this.pd&&
!0===!!window.StyleMedia;this.If="undefined"!==typeof window.InstallTrigger;this.opera=!0===!!window.opr||0<=this.ea.indexOf(" OPR/")||0<=this.ea.indexOf("Opera");this.ig=0<Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor");this.chrome=!1===this.pd&&!1===this.Wd&&!1===this.opera&&(!0===!!window.chrome||0<=this.ea.indexOf("CriOS"));if(this.Wd)this.tb="Edge",/Edge\/(\d+)/.test(this.ea)&&(this.gb=this.bj=parseInt(RegExp.$1,10));else if(this.chrome)this.tb="Chrome",/CriOS\/(\d+)/.test(this.ea)?
this.gb=this.Cf=parseInt(RegExp.$1,10):/Chrome\/(\d+)/.test(this.ea)&&(this.gb=this.Cf=parseInt(RegExp.$1,10));else if(this.If)this.tb="Firefox",/Firefox\D+(\d+)/.test(this.ea)&&(this.gb=this.ej=parseInt(RegExp.$1,10));else if(this.Vf)/Silk/.test(this.ea)&&(this.tb="Silk",this.ng=!0);else if(this.pd)this.tb="Internet Explorer",/MSIE (\d+\.\d+);/.test(this.ea)?this.gb=this.Rf=parseInt(RegExp.$1,10):/Trident\/(\d+\.\d+)(.*)rv:(\d+\.\d+)/.test(this.ea)&&(this.gb=this.Rf=parseInt(RegExp.$3,10));else if(this.opera)this.tb=
"Opera",/OPR\/(\d+)/.test(this.ea)?this.gb=this.ne=parseInt(RegExp.$1,10):0<=this.ea.indexOf("Opera/")?/Version\/(\d+)/.test(this.ea)&&(this.gb=this.ne=parseInt(RegExp.$1,10)):/Opera (\d+)/.test(this.ea)&&(this.gb=this.ne=parseInt(RegExp.$1,10));else if(this.ig)this.tb="Safari",/version\/(\d+(\.\d+)?)/i.test(this.ea)&&(this.gb=this.Uj=parseInt(RegExp.$1,10));else{var a=this.ea.match(/Android.*AppleWebKit\/([\d.]+)/);a&&537>a[1]&&(this.tb="Android Stock",this.Dj=!0,this.gb=this.Qi=parseFloat(this.ea.slice(this.ea.indexOf("Android")+
8)))}navigator.o&&(this.gk=!0);this.Rj="CSS1Compat"===document.compatMode?!1:!0};a.prototype.Fl=function(){this.tc=window.devicePixelRatio||1;this.Aj=!0===this.Qc&&-1!==this.ea.toLowerCase().indexOf("iphone");this.Bj=!0===this.Qc&&-1!==this.ea.toLowerCase().indexOf("ipod");this.Qf=!0===this.Qc&&-1!==this.ea.toLowerCase().indexOf("ipad");this.Tj=2<=this.tc&&!0===this.Qc;this.Bg&&!this.Ae||this.Zf||this.Wf&&!this.ng||this.Bf?this.Oc=!0:/Mobi/i.test(this.ea)&&!1===this.Qf?this.ke=!0:this.pg=!0;if(/TV/i.test(this.ea)||
!0===this.sg||!0===this.Dg||this.Oc&&/Windows NT/i.test(this.ea)&&/Touch/i.test(this.ea))this.Nj=!0,this.Oc=this.pg=this.ke=!1};a.prototype.Ol=function(){var a=document.createElement("video");try{"function"===typeof a.canPlayType&&(a.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,"")&&(this.dg=!0),a.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,"")&&(this.bg=this.Mf=!0),a.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,"")&&(this.Ag=!0),a.canPlayType('video/webm; codecs="vp9"').replace(/^no$/,
"")&&(this.tg=!0),a.canPlayType('application/x-mpegURL; codecs="avc1.42E01E"').replace(/^no$/,"")&&(this.Pf=!0))}catch(d){}};a.prototype.Bl=function(){this.xf="undefined"!==typeof window.Audio;this.vg="undefined"!==typeof window.AudioContext||"undefined"!==typeof window.webkitAudioContext;var a=document.createElement("audio");try{if("function"===typeof a.canPlayType){a.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.cg=!0);a.canPlayType("audio/mpeg;").replace(/^no$/,"")&&(this.$f=
!0);if(a.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,"")||a.canPlayType("audio/opus;").replace(/^no$/,""))this.oe=!0;a.canPlayType('audio/wav; codecs="1"').replace(/^no$/,"")&&(this.ug=!0);a.canPlayType("audio/aac;").replace(/^no$/,"")&&(this.vf=!0);if(a.canPlayType("audio/x-m4a;")||a.canPlayType("audio/m4a;")||a.canPlayType("audio/aac;").replace(/^no$/,""))this.Yf=!0;if(a.canPlayType("audio/x-mp4;")||a.canPlayType("audio/mp4;")||a.canPlayType("audio/aac;").replace(/^no$/,""))this.ag=!0;
a.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")&&(this.yg=this.zg=!0)}}catch(d){}};a.prototype.Gl=function(){this.rg="undefined"!==typeof navigator.rg||"undefined"!==typeof navigator.D||"undefined"!==typeof navigator.S||"undefined"!==typeof navigator.i;this.Af="function"===typeof navigator.getBattery};a.prototype.Il=function(){this.canvas="undefined"!==typeof window.CanvasRenderingContext2D;if(!0===this.canvas){this.Ti="function"===typeof document.createElement("canvas").getContext("2d").fillText;
var a=document.createElement("canvas").getContext("2d");a.rect(0,0,10,10);a.rect(2,2,6,6);this.Ui=!1===a.isPointInPath(5,5,"evenodd")}try{this.localStorage="object"===typeof window.localStorage&&"function"===typeof window.localStorage.getItem}catch(h){this.localStorage=!1}this.Kj="function"===typeof window.MediaSource;this.cj="function"===typeof window.HTMLMediaElement&&"function"===typeof window.S&&"function"===typeof window.f&&"function"===typeof navigator.m;this.applicationCache="object"===typeof window.applicationCache;
this.addEventListener="function"===typeof window.addEventListener;this.raf="function"===typeof window.requestAnimationFrame||"function"===typeof window.webkitRequestAnimationFrame||"function"===typeof window.mozRequestAnimationFrame;try{var d=document.createElement("canvas");d.f=!1;this.wg="function"===typeof d.getContext&&"undefined"!==typeof window.WebGLRenderingContext&&!(!d.getContext("webgl")&&!d.getContext("experimental-webgl"))}catch(h){this.wg=!1}this.xg="function"===typeof navigator.getVRDisplays?
!0:!1;this.JSON="object"===typeof window.JSON&&"function"===typeof window.JSON.parse&&"function"===typeof window.JSON.stringify;this.geolocation="object"===typeof navigator.geolocation;this.history="object"===typeof window.history&&"function"===typeof window.history.pushState;this.Zj="function"===typeof document.createElementNS&&"function"===typeof document.createElementNS("http://www.w3.org/2000/svg","svg").c;this.contextMenu="undefined"!==typeof document.documentElement.contextMenu&&"function"===
typeof window.HTMLMenuItemElement};a.prototype.Hl=function(){this.Fj=/^https/i.test(window.location.protocol);try{this.Tf=window.self!==window.top}catch(b){this.Tf=!0}};a.prototype.Ll=function(){this.ak="undefined"!==typeof window.ontouchstart||"undefined"!==typeof window.c&&document instanceof window.c||"number"===typeof navigator.c&&0<navigator.c||"number"===typeof navigator.msMaxTouchPoints&&0<navigator.msMaxTouchPoints;if("undefined"!==typeof window.i||"undefined"!==typeof window.m)this.bk=!(!MouseEvent.f||
!MouseEvent.c);this.jj="function"===typeof navigator.f||"function"===typeof navigator.B};a.prototype.Jl=function(){for(var a="requestFullscreen requestFullScreen webkitRequestFullscreen webkitRequestFullScreen mozRequestFullScreen mozRequestFullscreen msRequestFullscreen msRequestFullScreen".split(" "),d="cancelFullscreen cancelFullScreen exitFullscreen exitFullScreen webkitCancelFullscreen webkitCancelFullScreen webkitExitFullscreen webkitExitFullScreen mozCancelFullscreen mozCancelFullScreen mozExitFullscreen mozExitFullScreen msCancelFullscreen msCancelFullScreen msExitFullscreen msExitFullScreen".split(" "),
h=document.createElement("div"),k=0,l=a.length;k<l;k++)if(h[a[k]]){this.requestFullscreen=a[k];break}a=0;for(h=d.length;a<h;a++)if(document[d[a]]){this.exitFullscreen=d[a];break}"function"===typeof window.Element&&Element.ALLOW_KEYBOARD_INPUT&&(this.ij=!0);d=["fullscreenElement","mozFullScreenElement","webkitFullscreenElement","msFullscreenElement"];a=0;for(h=d.length;a<h;a++)if("undefined"!==typeof document[d[a]]){this.fullscreenElement=d[a];break}d=["fullscreenEnabled","mozFullScreenEnabled","webkitFullscreenEnabled",
"msFullscreenEnabled"];a=0;for(h=d.length;a<h;a++)if("undefined"!==typeof document[d[a]]){this.fullscreenEnabled=d[a];break}};a.prototype.Cl=function(){for(var a=["visibilitychange","mozvisibilitychange","webkitvisibilitychange","msvisibilitychange"],d=["hidden","mozHidden","webkitHidden","msHidden"],h=0,k=d.length;h<k;h++)if("undefined"!==typeof document[d[h]]){this.visibilityState=d[h];this.fk=a[h];break}a=["orientation","mozOrientation","msOrientation"];d=0;for(h=a.length;d<h;d++)if("string"===
typeof screen[a[d]]){this.orientation=a[d];break}this.Vj="object"===typeof screen.orientation&&"string"===typeof screen.orientation.type&&"function"===typeof screen.orientation.lock;a=["lockOrientation","mozLockOrientation","msLockOrientation"];d=["unlockOrientation","mozUnlockOrientation","msUnlockOrientation"];h=0;for(k=a.length;h<k;h++)if("function"===typeof screen[a[h]]){this.Hj=a[h];this.ck=d[h];break}this.file="undefined"!==typeof window.File&&"undefined"!==typeof window.FileReader&&"undefined"!==
typeof window.FileList&&"undefined"!==typeof window.Blob;this.dj="undefined"!==typeof window.requestFileSystem||"undefined"!==typeof window.webkitRequestFileSystem;this.Qj="undefined"!==typeof document.f||"undefined"!==typeof document.c||"undefined"!==typeof document.S};a.prototype.El=function(){var a=document.createElement("a").style;a.cssText="pointer-events:auto";this.jd="auto"===a.pointerEvents;a.cssText="background-color:rgba(150,255,150,.5)";this.Zi=-1<(""+a.backgroundColor).indexOf("rgba");
this.Yi="undefined"!==typeof a.animationName||"undefined"!==typeof a.webkitAnimationName||"undefined"!==typeof a.m||"undefined"!==typeof a.o;var a=document.createElement("p"),d,h={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"};document.body.insertBefore(a,null);for(var k in h)"undefined"!==typeof a.style[k]&&(a.style[k]="translate3d(1px,1px,1px)",d=window.getComputedStyle(a).getPropertyValue(h[k]));document.body.removeChild(a);
this.Xi="undefined"!==typeof d&&0<d.length&&"none"!==d};a.prototype.Sl=function(a){null!==a.rotationRate&&"undefined"!==typeof a.rotationRate.alpha&&"undefined"!==typeof a.rotationRate.beta&&"undefined"!==typeof a.rotationRate.gamma&&(this.Ff=!0);"undefined"!==typeof a.acceleration&&"undefined"!==typeof a.acceleration.x&&"undefined"!==typeof a.acceleration.y&&"undefined"!==typeof a.acceleration.z&&(this.Ef=!0);this.wi();"function"!==typeof this.Jc&&this.mf()};a.prototype.Tl=function(a){"undefined"!==
typeof a.alpha&&"undefined"!==typeof a.beta&&"undefined"!==typeof a.gamma&&(this.Hf=!0);this.xi();"function"!==typeof this.Ic&&this.mf()};a.prototype.wi=function(){window.removeEventListener("devicemotion",this.Ic,!1);this.Ic=null};a.prototype.xi=function(){window.removeEventListener("deviceorientation",this.Jc,!1);this.Jc=null};a.prototype.Kl=function(){this.Df="undefined"!==typeof window.DeviceMotionEvent;this.Gf="undefined"!==typeof window.DeviceOrientationEvent;window.addEventListener("deviceorientation",
this.Jc,!1);window.addEventListener("devicemotion",this.Ic,!1)};a.prototype.Nl=function(){var a=document.createElement("div");a.style.width="1in";a.style.height="1in";document.body.appendChild(a);this.aj=a.offsetWidth;document.body.removeChild(a);this.ke?(this.kg=Math.floor(Math.min(window.screen.width,window.screen.height)*this.tc),this.jg=Math.floor(Math.max(window.screen.width,window.screen.height)*this.tc)):(this.kg=Math.floor(Math.max(window.screen.width,window.screen.height)*this.tc),this.jg=
Math.floor(Math.min(window.screen.width,window.screen.height)*this.tc))};a.prototype.Al=function(){this.ea=navigator.userAgent;this.language=navigator.languages&&navigator.languages[0]||navigator.language||navigator.u||"";this.Ml();this.Dl();this.Fl();this.Bl();this.Ol();this.Gl();this.Il();this.Hl();this.Cl();this.Jl();this.Ll();this.El();this.Ic=this.Sl.bind(this);this.Jc=this.Tl.bind(this);this.Kl();this.Nl();!1===this.Df&&!1===this.Gf&&this.mf()};a.prototype.mf=function(){"function"===typeof this.Ic&&
this.wi();"function"===typeof this.Jc&&this.xi();!0===this.Ff&&!0===this.Ef&&!0===this.Hf&&(this.vj=!0);this.ready=!0;Object.freeze(g.A)};a.prototype.Ym=function(a){return"mp3"===a&&!0===this.$f||"ogg"===a&&(!0===this.cg||!0===this.oe)||"m4a"===a&&!0===this.Yf||"mp4"===a&&!0===this.ag||"opus"===a&&!0===this.oe||"wav"===a&&!0===this.ug||"aac"===a&&!0===this.vf||"webm"===a&&!0===this.zg||"weba"===a&&!0===this.yg?!0:!1};a.prototype.Zm=function(a){if("webm"!==a||!0!==this.Ag&&!0!==this.tg)if("mp4"!==
a||!0!==this.bg&&!0!==this.Mf){if(("ogg"===a||"ogv"===a)&&!0===this.dg||"mpeg"===a&&!0===this.Pf)return!0}else return!0;else return!0;return!1};a.prototype.wn=function(){return navigator.getBattery().then(function(a){return this.Af&&!a.charging&&.2>=a.level}.bind(this),function(){return!1})};return new a}(function(){return function(){this.ready=!1;this.jb=this.language=this.ea="";this.ec=0;this.If=this.Ae=this.Bg=this.Zf=this.Wf=this.Qc=this.Bf=this.Pi=this.Vf=this.Dg=this.sg=!1;this.ej=0;this.chrome=
!1;this.Cf=0;this.pd=!1;this.Rf=0;this.opera=!1;this.ne=0;this.Wd=!1;this.bj=0;this.ig=!1;this.Uj=0;this.ng=!1;this.tb="";this.gb=0;this.Dj=this.gk=!1;this.Qi=0;this.Rj=!1;this.fullscreenElement=this.exitFullscreen=this.requestFullscreen=this.fullscreenEnabled="";this.Qf=this.Bj=this.Tj=this.Aj=this.ij=!1;this.tc=1;this.Tf=this.Fj=this.Zj=this.history=this.JSON=this.cj=this.Kj=this.contextMenu=this.Qj=this.geolocation=this.applicationCache=this.localStorage=this.dj=this.file=this.xg=this.wg=this.raf=
this.addEventListener=this.Ti=this.Ui=this.canvas=this.Pf=this.tg=this.Ag=this.bg=this.Mf=this.dg=this.yg=this.zg=this.vf=this.ag=this.Yf=this.ug=this.oe=this.$f=this.cg=this.vg=this.xf=this.bk=this.jj=this.ak=this.Nj=this.ke=this.pg=this.Oc=this.Af=this.rg=!1;this.fk=this.visibilityState="";this.Hf=this.Ff=this.Ef=this.Gf=this.Df=this.vj=this.Yi=this.jd=this.Zi=this.Xi=!1;this.Jc=this.Ic=null;this.jg=this.kg=this.aj=0;this.Vj=!1;this.ck=this.Hj=this.orientation="";this.Al()}});
function ha(a){this.j=a;this.m=!1;this.c=null;this.i=!1;this.f=null}e=ha.prototype;e.constructor=ha;e.boot=function(){for(var a=["ms","moz","webkit","o"],b=0;b<a.length&&!window.requestAnimationFrame;b++)window.requestAnimationFrame=window[a[b]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[a[b]+"CancelAnimationFrame"];this.f=window};
e.start=function(a){this.f="undefined"!==typeof a&&(a===window||a instanceof VRDisplay)?a:window;this.i=!0;"undefined"===typeof this.f.requestAnimationFrame||"timeout"===this.j.config.update?(this.m=!0,this.c=function(){!0===this.i&&(this.j.update(0),this.S=window.setTimeout(this.c.bind(this),1E3/30))},this.S=window.setTimeout(this.c.bind(this),0)):(this.m=!1,this.c=function(a){!0===this.i&&(this.j.update(Math.floor(a)),this.S=window.requestAnimationFrame(this.c.bind(this)))},this.S=this.f.requestAnimationFrame(this.c.bind(this)))};
e.stop=function(){this.m?clearTimeout(this.S):(this.f.cancelAnimationFrame(this.S),this.S=null);this.i=!1};e.destroy=function(){this.stop();this.f=this.c=this.j=null};Object.defineProperty(ha.prototype,"running",{get:function(){return this.i}});function ja(a){this.j=a;this.c=!0;n.call(this,"History")}ja.prototype=Object.create(n.prototype);e=ja.prototype;e.constructor=ja;
e.gh=function(){this.log("_addState");var a=this.j.tour.scene,b={viewer:{uid:this.j.uid},scene:{uid:a.uid},locale:this.j.i18n.locale},d=window.history.state;null===d?window.history.replaceState(b,a.name,Cc(a)):d.scene.uid!==b.scene.uid&&window.history.pushState(b,a.name,Cc(a))};
e.fh=function(){this.log("_updateState");var a=window.history.state,b;a?(b="undefined"!==typeof a.scene&&"string"===typeof a.scene.uid,b=!0===("undefined"!==typeof a.viewer&&"string"===typeof a.viewer.uid)&&!0===b):b=!1;b&&(b=g.R.get(a.scene.uid),a.locale=this.j.i18n.locale,window.history.replaceState(a,b.name,Cc(b)))};function Cc(a){return"#"+a.slug+"&uid="+a.uid}e.mi=function(a){if(null!==a.state){var b=g.R.get(a.state.viewer.uid);b.history.log("_onPopStateHandler");b.tour.scene=a.state.scene.uid}};
e.na=function(a){this.c="boolean"===typeof a.enabled?a.enabled:!0;!0===this.c&&(this.j.tour.onSceneLoadStart.add(this.gh,this),this.j.i18n.onLocaleChangeComplete.add(this.fh,this),window.addEventListener("popstate",this.mi,!1))};e.destroy=function(){this.j.tour.onSceneLoadStart.remove(this.gh,this);this.j.i18n.onLocaleChangeComplete.remove(this.fh,this);window.removeEventListener("popstate",this.mi,!1);this.j=null;n.prototype.destroy.call(this)};Object.defineProperty(ja.prototype,"enabled",{get:function(){return this.c}});
function p(a,b){this.o=a;this.i=b||!1;this.c=this.m=null;this.f=!0;n.call(this,"EventDispatcher")}p.prototype=Object.create(n.prototype);e=p.prototype;e.constructor=p;
function Dc(a,b,d,h,k){if("function"!==typeof b)a.warn("You're trying to add an undefined listener");else if(!0===a.has(b,h))a.warn("You're trying to add a duplicate listener for this context");else{b=new Ec(a,b,d,h,k);a.c||(a.c=[]);if(a.c.length){d=a.c.length;do d--;while(a.c[d]&&b.uf<=a.c[d].uf);a.c.splice(d+1,0,b)}else a.c.push(b);!0===a.i&&!0===a.f&&null!==a.m&&b.Ib(a.m)}}
function Fc(a,b,d){if(!a.c)return-1;"undefined"===typeof d&&(d=null);for(var h,k=0,l=a.c.length;k<l;k++)if(h=a.c[k],h.listener===b&&h.context===d)return k;return-1}e.add=function(a,b,d){Dc(this,a,!1,b,d)};e.ga=function(a,b,d){Dc(this,a,!0,b,d)};e.remove=function(a,b){a=Fc(this,a,b);-1!==a&&(this.c[a].destroy(),this.c.splice(a,1))};e.has=function(a,b){return-1!==Fc(this,a,b)};
e.H=function(a,b){!0===this.i&&(this.m=void 0===a?null:a);if(!1!==this.f&&this.c)for(var d=this.c.length;d--;)this.c[d].Ib(a,b)};e.destroy=function(){if(!1!==this.ob){if(this.c){for(var a=this.c.length;a--;)this.c[a].destroy();this.c=null}this.m=this.o=null;n.prototype.destroy.call(this)}};Object.defineProperty(p.prototype,"emitter",{get:function(){return this.o}});Object.defineProperty(p.prototype,"memorize",{get:function(){return this.i},set:function(a){this.i=!!a}});
Object.defineProperty(p.prototype,"active",{get:function(){return this.f},set:function(a){this.f=!!a}});function Gc(a,b){this.f=a;this.c=b||null}Gc.prototype.constructor=Gc;Object.defineProperty(Gc.prototype,"emitter",{get:function(){return this.f}});Object.defineProperty(Gc.prototype,"data",{get:function(){return this.c}});function Ec(a,b,d,h,k){this.i=a;this.c=b;this.f=h||null;this.o=d||!1;this.uf=k||0;this.m=0;this.S=!1}e=Ec.prototype;e.constructor=Ec;
e.ii=function(a){this.c.call(this.f,new Gc(this.i.emitter,a));this.m++;!0===this.o&&this.ih();this.S=!1};e.Ib=function(a,b){this.c&&(!0===b&&!1===this.S?(this.S=!0,window.setTimeout(this.ii.bind(this,a),0)):!0!==b&&this.ii(a))};e.ih=function(){return this.i.remove(this.c,this.f)};e.destroy=function(){this.f=this.c=this.i=null};Object.defineProperty(Ec.prototype,"listener",{get:function(){return this.c}});Object.defineProperty(Ec.prototype,"context",{get:function(){return this.f}});
Object.defineProperty(Ec.prototype,"priority",{get:function(){return this.uf}});Object.defineProperty(Ec.prototype,"callCount",{get:function(){return this.m}});function ia(a){this.j=a;this.c=null;this.f=-1;this.o="";this.u=!0;this.i=this.m=null;n.call(this,"LocaleManager");this.log("KEN.LocaleManager._boot();");this.c=new zc}ia.prototype=Object.create(n.prototype);e=ia.prototype;e.constructor=ia;
e.na=function(a){this.u="boolean"===typeof a.enabled?a.enabled:!0;"undefined"!==typeof a.auto&&!0===a.auto&&""!==g.A.language?this.o=g.A.language:"string"===typeof a["default"]&&(this.o=a["default"]);if(!1===this.u)this.warn("KEN.LocaleManager: locale management is deactivated");else if("undefined"!==typeof a.locales){for(var b=!1,d=0,h=a.locales.length;d<h;d++){var k;k=a.locales[d];var l,q=Hc(this,k.uid);-1===q?(l=new Ic(this.j),l.f.add(this.em,this),q=this.c.add(l)-1):l=this.c.get(q);l.na(k);q===
this.f||this.o.toLowerCase()===k.uid.toLowerCase()?(l.Xf(),-1===this.f&&Jc(this,q),k=!0):k=!1;!0===k&&(b=!0)}!1===b&&(-1===Hc(this,this.o)&&(this.o=a.locales[0].uid),Jc(this,Hc(this,a.locales[0].uid)))}};function Hc(a,b){for(var d,h=0,k=a.c.size;h<k;h++)if(d=a.c.get(h),d.uid.toLowerCase()===b.toLowerCase())return h;return-1}
function Jc(a,b){if(0>b||b>=a.c.size)throw"The locale you are trying to set doesn't exist";a.f===b?a.warn("KEN.LocaleManager: You're trying to set a locale that is already the actual locale"):(a.f=b,a.m&&a.m.H(),a.c.get(a.f).Xf())}e.em=function(){this.log("KEN.LocaleManager._localeAllFilesLoaded();");this.i&&this.i.H()};
e.dc=function(a,b){if(-1===this.f)return this.warn("KEN.LocaleManager: You trying to get a value with no locale selected!"),a;var d=this.c.get(this.f).dc(a,b),h=Hc(this,this.o);this.f!==h&&-1!==h&&d===a&&(d=this.c.get(h).dc(a,b));return d};e.Eb=function(a,b){if(-1===this.f)return!1;var d=this.c.get(this.f).Eb(a,b),h=Hc(this,this.o);this.f!==h&&-1!==h&&!1===d&&(d=this.c.get(h).Eb(a,b));return d};
e.destroy=function(){this.j=null;if(this.c){for(var a=0,b=this.c.size;a<b;a++)this.c.get(a).destroy();this.c=null}this.m&&(this.m.destroy(),this.m=null);this.i&&(this.i.destroy(),this.i=null);n.prototype.destroy.call(this)};Object.defineProperty(ia.prototype,"locale",{get:function(){return-1!==this.f?this.c.get(this.f).uid:""},set:function(a){var b;"number"===typeof a&&a<this.c.size?b=a:"string"===typeof a&&(b=Hc(this,a));Jc(this,b)}});
Object.defineProperty(ia.prototype,"localeIndex",{get:function(){return this.f},set:function(a){"number"===typeof a&&a<this.c.size&&Jc(this,a)}});Object.defineProperty(ia.prototype,"localeObject",{get:function(){return-1!==this.f?this.c.get(this.f):null}});Object.defineProperty(ia.prototype,"locales",{get:function(){for(var a=[],b=0,d=this.c.size;b<d;b++)a.push(this.c.get(b).uid);return a}});Object.defineProperty(ia.prototype,"onLocaleChangeRequest",{get:function(){this.m||(this.m=new p(this));return this.m}});
Object.defineProperty(ia.prototype,"onLocaleChangeComplete",{get:function(){this.i||(this.i=new p(this));return this.i}});function D(a,b,d,h){this.j=a;this.c=b;this.m=d;this.i=h;this.f=null;n.call(this,"LocaleString")}D.prototype=Object.create(n.prototype);D.prototype.constructor=D;D.prototype.destroy=function(){this.j=null;n.prototype.destroy.call(this)};Object.defineProperty(D.prototype,"key",{get:function(){return this.c},set:function(a){this.c=a}});
Object.defineProperty(D.prototype,"jsonKey",{get:function(){return this.m},set:function(a){this.m=a}});Object.defineProperty(D.prototype,"value",{get:function(){if(""===this.j.i18n.locale)return"undefined"!==typeof this.i?this.i:this.c;this.f=this.j.i18n.dc(this.c,this.m);this.f===this.c&&"undefined"!==typeof this.i&&(this.f=this.i);return this.f}});Object.defineProperty(D.prototype,"loaded",{get:function(){var a=this.j.i18n.dc(this.c,this.m);return"undefined"!==typeof a&&a!==this.c}});
function Ic(a){this.j=a;this.m="";this.f=this.i=this.c=null;n.call(this,"Locale");this.c=new zc;this.i=new p(this);this.f=new p(this)}Ic.prototype=Object.create(n.prototype);e=Ic.prototype;e.constructor=Ic;
e.na=function(a){"string"===typeof a.uid&&(this.S=a.uid);""===this.m&&"string"===typeof a.name&&(this.m=a.name);if("undefined"!==typeof a.files)for(var b,d=0,h=a.files.length;d<h;d++)b=a.files[d],null===Kc(this,b.key)&&(b.Kb=!1,b.loaded=!1,this.c.add(b));this.log("Locale.addConfig(); number of files : "+this.c.size)};
e.Xf=function(){if(!0===Lc(this))return this.f.H(),!0;for(var a,b=0,d=this.c.size;b<d;b++)a=this.c.get(b),!1===a.Kb&&!1===a.loaded&&!1===a.Kb&&!1===a.loaded&&(a.Kb=!0,this.j.load.json(a.key,a.url,this.cm,this))};function Kc(a,b){for(var d,h=0,k=a.c.size;h<k;h++)if(d=a.c.get(h),d.key===b)return d;return null}e.cm=function(a){a=Kc(this,a.key);a.Kb=!1;a.loaded=!0;this.log("loadFileComplete(); "+a.key);this.i.H();!0===Lc(this)&&this.f.H()};
function Lc(a){for(var b,d=0,h=a.c.size;d<h;d++)if(b=a.c.get(d),!1===b.loaded)return!1;return!0}e.dc=function(a,b){for(var d,h=0,k=this.c.size;h<k;h++)if(d=this.c.get(h),!0===this.j.cache.has(B.JSON,d.key)&&("undefined"===typeof b||b===d.key)&&(d=this.j.cache.get(B.JSON,d.key),"undefined"!==typeof d.data[a]))return d.data[a];"undefined"!==typeof b&&(this.warn("KEN.Locale: value not found into the specified JSON file, try to find it in all files."),this.dc(a));return a};
e.Eb=function(a,b){for(var d,h=0,k=this.c.size;h<k;h++)if(d=this.c.get(h),!0===this.j.cache.has(B.JSON,d.key)&&("undefined"===typeof b||b===d.key)&&(d=this.j.cache.get(B.JSON,d.key),"undefined"!==typeof d.data[a]))return!0;"undefined"!==typeof b&&(this.warn("KEN.Locale: key not found into the specified JSON file, try to find it in all files."),this.Eb(a));return!1};
e.jh=function(a,b){for(var d,h=0,k=this.c.size;h<k;h++)if(d=this.c.get(h),!0===this.j.cache.has(B.JSON,d.key)&&("undefined"===typeof b||b===d.key)){d=this.j.cache.get(B.JSON,d.key);for(var l in d.data)if(d.data[l]===a)return l}"undefined"!==typeof b&&(this.warn("KEN.Locale: value not found into the specified JSON file, try to find it in all files."),this.jh(a))};e.destroy=function(){this.c=this.j=null;this.i.destroy();this.i=null;this.f.destroy();this.f=null;n.prototype.destroy.call(this)};
Object.defineProperty(Ic.prototype,"name",{get:function(){return this.m}});function qa(a){this.j=a;this.i=!0;this.o=this.m=this.f=this.c=null;n.call(this,"Keyboard");this.c=[];this.f=[];this.m=this.$l.bind(this);this.o=this.am.bind(this);window.addEventListener("keydown",this.m,!1);window.addEventListener("keyup",this.o,!1)}qa.prototype=Object.create(n.prototype);e=qa.prototype;e.constructor=qa;
e.$l=function(a){if(!1!==this.i){var b=a.keyCode;this.log("keyDown "+b);-1===this.f.indexOf(b)?(this.f.push(b),b=!0):b=!1;!0===b&&Mc(this,a)}};
e.am=function(a){if(!1!==this.i){var b=a.keyCode;this.log("keyUp "+b);b=this.f.indexOf(b);-1!==b?(this.f.splice(b,1),b=!0):b=!1;if(!0===b)a:if(b=a.keyCode,!0!==this.Uf(b))for(var b=this.Kf(b),d,h=0,k=b.length;h<k;h++){d=b[h];for(var l=0,q=this.f.length;l<q;l++)if(d.ce(this.f[l]))break a;d.dk(a);l=0;for(q=this.f.length;l<q;l++)if(d.Nf(this.f[l])){var t=new KeyboardEvent("keydown",{Tn:this.f[l],ctrlKey:a.ctrlKey,shiftKey:a.shiftKey,altKey:a.altKey});Mc(this,t)}}}};
function Nc(a,b){if(!a.c||!a.c.length)return-1;if("object"===typeof b&&"KeyBinding"===b.type)return a.c.indexOf(b);if("number"===typeof b)for(var d=0,h=a.c.length;d<h;d++)if(!0===a.c[d].ce(b))return d;return-1}function Mc(a,b){var d=b.keyCode;if(!0!==a.Uf(d)){a=a.Kf(d);for(var h=0,k=a.length;h<k;h++)d=a[h],!1===d.pressed&&d.hh(b)}}e.update=function(){for(var a,b=0,d=this.c.length;b<d;b++)if(a=this.c[b],!0===a.pressed){if(!0===a.hasToWaitToHold&&!1===a.downComplete)break;a.zj()}};
e.vn=function(a){return-1!==this.f.indexOf(a)};e.Uf=function(a){for(var b,d=0,h=this.c.length;d<h;d++)if(b=this.c[d],!0===b.pressed&&!0===b.Nf(a))return!0;return!1};e.wf=function(a){if("object"!==typeof a&&"KeyBinding"!==a.type)return!1;if(-1===Nc(this,a))return this.c.push(a),!0;this.warn("Trying to add a duplicate key binding on keyboard!");return!1};e.te=function(a){a=Nc(this,a);return-1!==a?(this.c[a].destroy(),this.c.splice(a,1),!0):!1};e.kn=function(a){return-1!==Nc(this,a)};
e.Kf=function(a){for(var b=[],d=0,h=this.c.length;d<h;d++)!0===this.c[d].ce(a)&&b.push(this.c[d]);return b};e.destroy=function(){this.j=null;window.removeEventListener("keydown",this.m,!1);window.removeEventListener("keyup",this.o,!1);for(var a=this.c.length;a--;)this.te(this.c[a]);this.o=this.m=this.c=null;n.prototype.destroy.call(this)};Object.defineProperty(qa.prototype,"enabled",{get:function(){return this.i},set:function(a){this.i=!!a}});
function M(a,b,d,h,k,l,q,t){this.j=a;this.F=b||[];this.o=d||null;this.D=h||null;this.u=k||null;this.B=l||null;this.f=q||this;this.J=t||"";this.pf=this.I=this.M=!1;this.G=this.C=this.ed=0;this.m=this.i=this.c=null;n.call(this,"KeyBinding");if(!0===g.L.V(this.o,"string")||g.L.Ma(this.o,"string"))this.c=new pb(this.j),this.c.c(this.o);if(!0===g.L.V(this.u,"string")||g.L.Ma(this.u,"string"))this.i=new pb(this.j),this.i.c(this.u);if(!0===g.L.V(this.D,"string")||g.L.Ma(this.D,"string"))this.m=new pb(this.j),
this.m.c(this.D)}M.prototype=Object.create(n.prototype);e=M.prototype;e.constructor=M;e.ce=function(a){return"number"===typeof this.F&&this.F===a?!0:"function"===typeof this.F.indexOf?-1!==this.F.indexOf(a):!1};e.Nf=function(a){if(null!==this.B){if("number"===typeof this.B&&this.B===a)return!0;if("function"===typeof this.B.indexOf)return-1!==this.B.indexOf(a)}return!1};e.hh=function(a){this.log("down");this.ed++;this.I=!0;"function"===typeof this.o?this.o.call(this.f,this,a):this.c&&this.c.H()};
e.On=function(){this.M=!0;var a=this.ed;return function(){this.log("downCompleteCallback "+a+" "+this.ed);a===this.ed&&(this.pf=!0)}.bind(this)};e.dk=function(a){this.log("up");this.G++;this.pf=this.I=!1;"function"===typeof this.D?this.D.call(this.f,this,a):this.m&&this.m.H()};e.zj=function(){this.log("hold");this.C++;"function"===typeof this.u?this.u.call(this.f,this):this.i&&this.i.H()};
e.destroy=function(){this.f=this.B=this.u=this.D=this.o=this.F=null;this.c&&(this.c.destroy(),this.c=null);this.i&&(this.i.destroy(),this.i=null);this.m&&(this.m.destroy(),this.m=null);n.prototype.destroy.call(this)};Object.defineProperty(M.prototype,"name",{get:function(){return this.J}});Object.defineProperty(M.prototype,"pressed",{get:function(){return this.I}});Object.defineProperty(M.prototype,"downCount",{get:function(){return this.ed}});Object.defineProperty(M.prototype,"upCount",{get:function(){return this.G}});
Object.defineProperty(M.prototype,"holdCount",{get:function(){return this.C}});Object.defineProperty(M.prototype,"hasToWaitToHold",{get:function(){return this.M}});Object.defineProperty(M.prototype,"downComplete",{get:function(){return this.pf}});function Oc(a){this.f=this.N=a;this.K=!1;this.c=null;this.i="";this.F=this.J=null;this.M=this.C=this.I=!1;this.m=null;this.U=200;this.G=this.O=1;this.X=g.T.LINEAR;this.D=this.u=this.B=this.o=null;n.call(this,"Drag");this.G=this.N.alpha}Oc.prototype=Object.create(n.prototype);
e=Oc.prototype;e.constructor=Oc;function Pc(a,b){a.f&&(a.f&&(a.f.pointer.onPanStart.remove(a.dh,a),a.f.pointer.onPanMove.remove(a.bh,a),a.f.pointer.onPanEnd.remove(a.ah,a)),a.f=null);a.f=b;a.f.pointer.enabled=!0;a.f.pointer.onPanStart.add(a.dh,a);a.f.pointer.onPanMove.add(a.bh,a);a.f.pointer.onPanEnd.add(a.ah,a)}
e.dh=function(a){this.log("_panStartHandler");var b=a.data;a=a.data.srcEvent;"undefined"!==typeof a.touches&&"object"===typeof a.touches[0]&&(a=a.touches[0]);if(b=!0!==this.M&&b.target===this.f.dom){if(this.c)var b=this.N.globalOffset,d=this.c.globalOffset,h=b.left+this.N.pixelWidth>d.left+this.c.innerWidth,k=b.top<d.top,l=b.top+this.N.pixelHeight>d.top+this.c.innerHeight,b=!0===b.left<d.left||!0===h||!0===k||!0===l?!1:!0;else b=!0;b=!1!==b}b&&(this.I=!0,this.J={x:this.N.x,y:this.N.y},this.N.top=
null,this.N.right=null,this.N.bottom=null,this.N.left=null,this.F={x:a.pageX,y:a.pageY},this.O=this.N.alpha,this.N.alpha=this.G,this.o&&this.o.H())};e.ah=function(){this.log("_panEndHandler");!0===this.I&&(this.I=!1,this.u&&this.u.H(),!0===this.C&&this.m?(this.M=!0,this.m.Dd({x:this.J.x,y:this.J.y},this.U,this.X).start()):this.N.alpha=this.O,this.F=this.J=null)};
e.bh=function(a){this.log("_panMoveHandler");if(!0===this.I){a=a.data.srcEvent;"undefined"!==typeof a.touches&&"object"===typeof a.touches[0]&&(a=a.touches[0]);var b={x:a.pageX,y:a.pageY};a=b.x-this.F.x;var d=b.y-this.F.y;this.F=b;if(this.c){var b=this.N.globalOffset,h=this.N.parent.globalOffset,k=this.c.globalOffset;if(""===this.i||"x"===this.i)b.left+a<k.left?(this.log("out left"),this.N.x=Math.abs(h.left-k.left)):b.left+a+this.N.pixelWidth>k.left+this.c.innerWidth?(this.log("out right"),this.N.x=
Math.abs(h.left-k.left)+this.c.innerWidth-this.N.pixelWidth):this.N.x+=a;if(""===this.i||"y"===this.i)b.top+d<k.top?(this.log("out top"),this.N.y=Math.abs(h.top-k.top)):b.top+d+this.N.pixelHeight>k.top+this.c.innerHeight?(this.log("out bottom"),this.N.y=Math.abs(h.top-k.top)+this.c.innerHeight-this.N.pixelHeight):this.N.y+=d}else{if(""===this.i||"x"===this.i)this.N.x+=a;if(""===this.i||"y"===this.i)this.N.y+=d}this.B&&this.B.H()}};
e.zi=function(){this.log("_revertCompleteHandler");this.M=!1;this.N.alpha=this.O;this.D&&this.D.H()};e.enable=function(){this.K=!0;Pc(this,this.f)};e.eh=function(){this.K=!1};e.destroy=function(){this.revert=!1;this.o&&(this.o.destroy(),this.o=null);this.B&&(this.B.destroy(),this.B=null);this.u&&(this.u.destroy(),this.u=null);this.D&&(this.D.destroy(),this.D=null);this.F=this.c=this.N=this.f=null;n.prototype.destroy.call(this)};
Object.defineProperty(Oc.prototype,"enabled",{get:function(){return this.K},set:function(a){!0===!!a?this.enable():this.eh()}});Object.defineProperty(Oc.prototype,"dragging",{get:function(){return this.I}});Object.defineProperty(Oc.prototype,"handle",{get:function(){return this.f},set:function(a){Pc(this,a)}});Object.defineProperty(Oc.prototype,"constrain",{get:function(){return this.c},set:function(a){this.c=a}});
Object.defineProperty(Oc.prototype,"progress",{get:function(){if(this.c){var a=this.N.globalOffset,b=this.c.globalOffset;return{x:(a.left-b.left)/(this.c.innerWidth-this.N.pixelWidth),y:(a.top-b.top)/(this.c.innerHeight-this.N.pixelHeight)}}}});Object.defineProperty(Oc.prototype,"axis",{get:function(){return this.i},set:function(a){"x"===a||"y"===a?this.i=a:this.i=""}});Object.defineProperty(Oc.prototype,"alpha",{get:function(){return this.G},set:function(a){"number"===typeof a&&(this.G=a)}});
Object.defineProperty(Oc.prototype,"reverting",{get:function(){return this.M}});Object.defineProperty(Oc.prototype,"revert",{get:function(){return this.C},set:function(a){this.C=!!a;!0!==this.C||this.m?!1===this.C&&this.m&&(this.N.viewer.tween.remove(this.m),this.m.onComplete.remove(this.zi,this),this.m.destroy(),this.m=null):(this.m=new vb(this.N.viewer,this.N),this.m.onComplete.add(this.zi,this),this.N.viewer.tween.add(this.m))}});
Object.defineProperty(Oc.prototype,"revertDuration",{get:function(){return this.U},set:function(a){"number"===typeof a&&(this.U=a)}});Object.defineProperty(Oc.prototype,"revertEasing",{get:function(){return this.X},set:function(a){"function"===typeof a&&(this.X=a)}});Object.defineProperty(Oc.prototype,"onStart",{get:function(){this.o||(this.o=new p(this.N));return this.o}});Object.defineProperty(Oc.prototype,"onDrag",{get:function(){this.B||(this.B=new p(this.N));return this.B}});
Object.defineProperty(Oc.prototype,"onStop",{get:function(){this.u||(this.u=new p(this.N));return this.u}});Object.defineProperty(Oc.prototype,"onRevert",{get:function(){this.D||(this.D=new p(this.N));return this.D}});
function U(a){this.N=a;this.c=!1;this.da=Qc.DEFAULT;this.bb=null;this.Cd=[];this.ha=this.f=this.i=this.m=this.B=this.u=this.$=this.O=this.U=this.X=this.C=this.G=this.M=this.D=this.F=this.I=this.J=this.K=this.o=this.P=this.W=this.Z=this.aa=this.Ca=this.ta=this.sa=this.Ba=this.Aa=this.ma=null;n.call(this,"Pointer");this.bb=new Hammer.Manager(this.N.dom);this.bb.set({enable:!1})}U.prototype=Object.create(n.prototype);e=U.prototype;e.constructor=U;
function Rc(a,b,d,h){for(var k,l=0,q=a.Cd.length;l<q;l++)if(k=a.Cd[l],k.event===b&&k.Xm===d&&k.type===h)return l;return-1}function Sc(a,b,d,h){if(-1===Rc(a,b,d,h))if(a.Cd.push({event:b,Xm:d,type:h}),h===V.$a)a.N.dom.addEventListener(b,Hammer.bindFn(d,a));else if(h===V.pa)a.bb.on(b,Hammer.bindFn(d,a))}function Tc(a,b,d){return function(){var h=Rc(this,a,b,d);-1!==h&&(this.Cd.splice(h,1),d===V.$a?this.N.dom.removeEventListener(a,b):d===V.pa&&this.bb.off(a))}}e.Gi=function(a){this.P&&!0===this.c&&this.P.H(a)};
e.fi=function(a){this.o&&!0===this.c&&this.o.H(a)};e.yh=function(a){this.K&&!0===this.c&&this.K.H(a)};e.xh=function(a){this.J&&!0===this.c&&this.J.H(a)};e.th=function(a){this.I&&!0===this.c&&this.I.H(a)};e.sh=function(a){this.F&&!0===this.c&&this.F.H(a)};e.rh=function(a){this.D&&!0===this.c&&this.D.H(a)};e.wh=function(a){this.M&&!0===this.c&&this.M.H(a)};e.vh=function(a){this.G&&!0===this.c&&this.G.H(a)};e.uh=function(a){this.C&&!0===this.c&&this.C.H(a)};e.Ci=function(a){this.X&&!0===this.c&&this.X.H(a)};
e.Bi=function(a){this.U&&!0===this.c&&this.U.H(a)};e.Ai=function(a){this.O&&!0===this.c&&this.O.H(a)};e.Fi=function(a){this.$&&!0===this.c&&this.$.H(a)};e.hi=function(a){this.u&&!0===this.c&&this.u.H(a)};e.ji=function(a){this.B&&!0===this.c&&this.B.H(a)};e.si=function(a){this.m&&!0===this.c&&this.m.H(a)};e.ri=function(a){this.i&&!0===this.c&&this.i.H(a)};e.li=function(a){this.f&&!0===this.c&&this.f.H(a)};e.zh=function(a){this.ha&&!0===this.c&&this.ha.H(a)};
e.enable=function(){!0===g.A.jd&&(this.N.dom.style.pointerEvents="auto");this.bb.set({enable:!0});this.ma||(this.ma=new Hammer.Tap,this.bb.add(this.ma));this.Aa||(this.Aa=(new Hammer.Tap({event:W.yd,Xn:2})).recognizeWith(this.ma),this.bb.add(this.Aa));this.Ba||(this.Ba=(new Hammer.Press).recognizeWith(this.ma),this.bb.add(this.Ba));this.sa||(this.sa=new Hammer.Pan,this.bb.add(this.sa));this.ta||(this.ta=new Hammer.Pinch,this.bb.add(this.ta));this.Ca||(this.Ca=(new Hammer.Rotate).recognizeWith(this.ta),
this.bb.add(this.Ca));this.aa||(this.aa=(new Hammer.Swipe).recognizeWith(this.sa),this.bb.add(this.aa));this.c=!0;this.Z&&this.Z.H()};e.Oe=function(){!0===g.A.jd&&(this.N.dom.style.pointerEvents="none");this.c=!1;this.bb.set({enable:!1});this.W&&this.W.H()};
e.destroy=function(){this.Oe();this.aa=this.Ca=this.ta=this.sa=this.Ba=this.Aa=this.ma=null;this.Z&&(this.Z.destroy(),this.Z=null);this.W&&(this.W.destroy(),this.W=null);this.P&&(this.P.destroy(),this.P=null);this.o&&(this.o.destroy(),this.o=null);this.K&&(this.K.destroy(),this.K=null);this.J&&(this.J.destroy(),this.J=null);this.I&&(this.I.destroy(),this.I=null);this.F&&(this.F.destroy(),this.F=null);this.D&&(this.D.destroy(),this.D=null);this.M&&(this.M.destroy(),this.M=null);this.G&&(this.G.destroy(),
this.G=null);this.C&&(this.C.destroy(),this.C=null);this.X&&(this.X.destroy(),this.X=null);this.U&&(this.U.destroy(),this.U=null);this.O&&(this.O.destroy(),this.O=null);this.$&&(this.$.destroy(),this.$=null);this.u&&(this.u.destroy(),this.u=null);this.B&&(this.B.destroy(),this.B=null);this.m&&(this.m.destroy(),this.m=null);this.i&&(this.i.destroy(),this.i=null);this.f&&(this.f.destroy(),this.f=null);this.ha&&(this.ha.destroy(),this.ha=null);this.N=null;n.prototype.destroy.call(this)};
Object.defineProperty(U.prototype,"enabled",{get:function(){return this.c},set:function(a){!0===!!a?this.enable():this.Oe()}});Object.defineProperty(U.prototype,"cursor",{get:function(){return this.da},set:function(a){this.N.dom.style.cursor=a;if(a!==this.N.dom.style.cursor||""===this.N.dom.style.cursor)this.N.dom.style.cursor="-webkit-"+a;this.da=a}});Object.defineProperty(U.prototype,"onEnable",{get:function(){this.Z||(this.Z=new p(this));return this.Z}});
Object.defineProperty(U.prototype,"onDisable",{get:function(){this.W||(this.W=new p(this));return this.W}});Object.defineProperty(U.prototype,"onTap",{get:function(){this.P||(this.P=new p(this.N),this.P.onDestroy.ga(Tc(W.hf,this.Gi,V.pa),this),Sc(this,W.hf,this.Gi,V.pa));return this.P}});Object.defineProperty(U.prototype,"onClick",{get:function(){return this.onTap}});
Object.defineProperty(U.prototype,"onDoubleTap",{get:function(){this.o||(this.o=new p(this.N),this.o.onDestroy.ga(Tc(W.yd,this.fi,V.pa),this),Sc(this,W.yd,this.fi,V.pa));return this.o}});Object.defineProperty(U.prototype,"onDoubleClick",{get:function(){return this.onDoubleTap}});Object.defineProperty(U.prototype,"onPressStart",{get:function(){this.K||(this.K=new p(this.N),this.K.onDestroy.ga(Tc(W.bf,this.yh,V.pa),this),Sc(this,W.bf,this.yh,V.pa));return this.K}});
Object.defineProperty(U.prototype,"onDown",{get:function(){return this.onPressStart}});Object.defineProperty(U.prototype,"onPressEnd",{get:function(){this.J||(this.J=new p(this.N),this.J.onDestroy.ga(Tc(W.af,this.xh,V.pa),this),Sc(this,W.af,this.xh,V.pa));return this.J}});Object.defineProperty(U.prototype,"onUp",{get:function(){return this.onPressEnd}});
Object.defineProperty(U.prototype,"onPanStart",{get:function(){this.I||(this.I=new p(this.N),this.I.onDestroy.ga(Tc(W.Xe,this.th,V.pa),this),Sc(this,W.Xe,this.th,V.pa));return this.I}});Object.defineProperty(U.prototype,"onPanMove",{get:function(){this.F||(this.F=new p(this.N),this.F.onDestroy.ga(Tc(W.We,this.sh,V.pa),this),Sc(this,W.We,this.sh,V.pa));return this.F}});
Object.defineProperty(U.prototype,"onPanEnd",{get:function(){this.D||(this.D=new p(this.N),this.D.onDestroy.ga(Tc(W.Ve,this.rh,V.pa),this),Sc(this,W.Ve,this.rh,V.pa));return this.D}});Object.defineProperty(U.prototype,"onPinchStart",{get:function(){this.M||(this.M=new p(this.N),this.M.onDestroy.ga(Tc(W.$e,this.wh,V.pa),this),Sc(this,W.$e,this.wh,V.pa));return this.M}});
Object.defineProperty(U.prototype,"onPinchMove",{get:function(){this.G||(this.G=new p(this.N),this.G.onDestroy.ga(Tc(W.Ze,this.vh,V.pa),this),Sc(this,W.Ze,this.vh,V.pa));return this.G}});Object.defineProperty(U.prototype,"onPinchEnd",{get:function(){this.C||(this.C=new p(this.N),this.C.onDestroy.ga(Tc(W.Ye,this.uh,V.pa),this),Sc(this,W.Ye,this.uh,V.pa));return this.C}});
Object.defineProperty(U.prototype,"onRotateStart",{get:function(){this.X||(this.X=new p(this.N),this.X.onDestroy.ga(Tc(W.ef,this.Ci,V.pa),this),Sc(this,W.ef,this.Ci,V.pa));return this.X}});Object.defineProperty(U.prototype,"onRotateMove",{get:function(){this.U||(this.U=new p(this.N),this.U.onDestroy.ga(Tc(W.df,this.Bi,V.pa),this),Sc(this,W.df,this.Bi,V.pa));return this.U}});
Object.defineProperty(U.prototype,"onRotateEnd",{get:function(){this.O||(this.O=new p(this.N),this.O.onDestroy.ga(Tc(W.cf,this.Ai,V.pa),this),Sc(this,W.cf,this.Ai,V.pa));return this.O}});Object.defineProperty(U.prototype,"onSwipe",{get:function(){this.$||(this.$=new p(this.N),this.$.onDestroy.ga(Tc(W.gf,this.Fi,V.pa),this),Sc(this,W.gf,this.Fi,V.pa));return this.$}});
Object.defineProperty(U.prototype,"onEnter",{get:function(){this.u||(this.u=new p(this.N),this.u.onDestroy.ga(Tc(W.Fe,this.hi,V.$a),this),Sc(this,W.Fe,this.hi,V.$a));return this.u}});Object.defineProperty(U.prototype,"onLeave",{get:function(){this.B||(this.B=new p(this.N),this.B.onDestroy.ga(Tc(W.Te,this.ji,V.$a),this),Sc(this,W.Te,this.ji,V.$a));return this.B}});
Object.defineProperty(U.prototype,"onOver",{get:function(){this.m||(this.m=new p(this.N),this.m.onDestroy.ga(Tc(W.mc,this.si,V.$a),this),Sc(this,W.mc,this.si,V.$a));return this.m}});Object.defineProperty(U.prototype,"onOut",{get:function(){this.i||(this.i=new p(this.N),this.i.onDestroy.ga(Tc(W.Gb,this.ri,V.$a),this),Sc(this,W.Gb,this.ri,V.$a));return this.i}});
Object.defineProperty(U.prototype,"onMove",{get:function(){this.f||(this.f=new p(this.N),this.f.onDestroy.ga(Tc(W.Ue,this.li,V.$a),this),Sc(this,W.Ue,this.li,V.$a));return this.f}});Object.defineProperty(U.prototype,"onWheel",{get:function(){this.ha||(this.ha=new p(this.N),this.ha.onDestroy.ga(Tc(W.kf,this.zh,V.$a),this),Sc(this,W.kf,this.zh,V.$a));return this.ha}});
var V={$a:0,pa:1},W={hf:"tap",yd:"doubletap",bf:"press",af:"pressup",Xe:"panstart",We:"panmove",Ve:"panend",$e:"pinchstart",Ze:"pinchmove",Ye:"pinchend",ef:"rotatestart",df:"rotatemove",cf:"rotateend",gf:"swipe",Fe:"mouseenter",Te:"mouseleave",mc:"mouseover",Gb:"mouseout",Ue:"mousemove",kf:"wheel"},Qc={DEFAULT:"default",cb:"pointer",ik:"grab",jk:"grabbing"};
function yb(a){this.j=a;this.c=null;this.o=!1;this.i=this.f=null;n.call(this,"GazeBase");this.f=this.j.clock.create(!1);this.c=new THREE.Object3D;this.c.name="GazeBase";this.c.position.z=-2;a=new THREE.MeshBasicMaterial({color:16777215,opacity:.5,transparent:!0});a=new THREE.Mesh(Uc(),a);a.name="ring-00";this.c.add(a)}yb.prototype=Object.create(n.prototype);e=yb.prototype;e.constructor=yb;
function Uc(a,b,d,h,k,l){l=l||2*Math.PI;return new THREE.RingBufferGeometry(a||.02,b||.04,d||32,h||1,k||0,l)}function Vc(a,b){var d=a.c.children[1];"undefined"!==typeof d&&null!==d&&(a.c.remove(d),d.geometry.dispose(),d.material.dispose());d=new THREE.MeshBasicMaterial({color:16711680,opacity:.5,transparent:!0});d=new THREE.Mesh(Uc(.02,.04,32,1,0,b/100*g.Math.bi),d);d.name="ring-01";a.c.add(d)}e.Rm=function(){this.stop();this.j.raycaster.click()};
e.start=function(){this.log("startGazeAnimation");this.o=!0;Vc(this,0);this.f&&(this.f.stop(),this.i=this.f.add(2E3,this.Rm,this),this.f.start())};e.stop=function(){this.log("stopGazeAnimation");this.o=!1;this.f.stop();this.i=null;var a=this.c.children[1];"undefined"!==typeof a&&null!==a&&(this.c.remove(a),a.geometry.dispose(),a.material.dispose())};e.update=function(){if(!0===this.o&&this.i){var a=100*(this.i.f-this.f.duration)/this.i.f;this.log("timer update : "+a+"%");Vc(this,a)}};
e.destroy=function(){this.stop();this.c&&(this.c.geometry.dispose(),this.c.material.dispose(),this.c=null);this.m=null};Object.defineProperty(yb.prototype,"visible",{get:function(){return this.c.visible},set:function(a){this.c.visible=a}});Object.defineProperty(yb.prototype,"object",{get:function(){return this.c}});
function da(a){this.j=a;this.ba=[];this.f=[];this.i=this.c=null;n.call(this,"DisplayList");this.c=this.Wl.bind(this);document.addEventListener("fullscreenchange",this.c,!1);document.addEventListener("mozfullscreenchange",this.c,!1);document.addEventListener("webkitfullscreenchange",this.c,!1);document.addEventListener("MSFullscreenChange",this.c,!1)}da.prototype=Object.create(n.prototype);e=da.prototype;e.constructor=da;
e.Wl=function(){this.log("_fullScreenChangeHandler");if(null!==document[g.A.fullscreenElement])for(var a,b=this.ba.length;b--;){if(a=this.ba[b],a.dom===document[g.A.fullscreenElement]){a=this.i=a;a.log("_notifyFullscreenEnter");b=a;b.log("_fullscreenSaveData");b.X={x:b.F,y:b.I,width:b.u,unitWidth:b.D,height:b.o,unitHeight:b.B,top:b.$b,right:b.Ca,bottom:b.jc,left:b.ta};b.F=0;b.I=0;b.u=screen.width;b.D="px";b.c.style.width=b.u+"px";b.o=screen.height;b.B="px";b.c.style.height=b.o+"px";b.$b=null;b.Ca=
null;b.jc=null;b.ta=null;b.c.style.top="0";b.c.style.left="0";b.za({property:"both"});a.Wb&&a.Wb.H();break}}else a=this.i,a.log("_notifyFullscreenChange"),a.log("_fullscreenRestoreData"),a.F=a.X.x,a.c.style.left=a.F+"px",a.I=a.X.y,a.c.style.top=a.I+"px",a.u=a.X.width,a.D=a.X.unitWidth,a.c.style.width=a.pixelWidth+"px",a.o=a.X.height,a.B=a.X.unitHeight,a.c.style.height=a.pixelHeight+"px",a.$b=a.X.top,a.Ca=a.X.right,a.jc=a.X.bottom,a.ta=a.X.left,a.za({property:"both"}),a.X=null,a.Xb&&a.Xb.H(),this.i=
null};e.register=function(a,b){this.ba.push(a);!0===b&&this.f.push(a)};e.unregister=function(a){this.ba.splice(this.ba.indexOf(a),1);a=this.f.indexOf(a);-1!==a&&this.f.splice(a,1)};e.update=function(){for(var a=0,b=this.f.length;a<b;a++)this.f[a].update()};
e.destroy=function(){for(var a=this.ba.length;a--;)this.ba[a].destroy();this.ba=[];this.f=[];document.removeEventListener("fullscreenchange",this.c,!1);document.removeEventListener("mozfullscreenchange",this.c,!1);document.removeEventListener("webkitfullscreenchange",this.c,!1);document.removeEventListener("MSFullscreenChange",this.c,!1);this.i=this.c=null};var Wc="DisplayObject DisplayObjectContainer Image TextField Button Video Canvas Sprite Iframe".split(" ");
function T(a,b,d){this.j=a;this.c=b||null;this.m=null;this.fe=0;this.Cg="";this.I=this.F=0;this.kc=!1;this.u=0;this.D="px";this.sa=1;this.o=0;this.B="px";this.ma=1;this.Hc=this.Fc=!1;this.ta=this.jc=this.Ca=this.$b=null;this.ee=1;this.je=0;this.Ec=this.Gc=null;this.Zc="";this.ad="solid";this.O=0;this.$c="rgb(0, 0, 0)";this.se=0;this.U=!1;this.ye="";this.Hb=null;this.ge=!1;this.$=!0;this.Ba=null;this.ha=!1;this.Xb=this.Wb=this.hd=this.od=this.Sb=this.Tb=this.M=this.Vb=this.Yb=this.Aa=this.X=null;n.call(this,
d||"DisplayObject");this.Ja()}T.prototype=Object.create(n.prototype);e=T.prototype;e.constructor=T;
e.Ja=function(){!0!==this.ge&&("undefined"!==typeof this.c&&this.c?(this.u=g.la.uj(this.c),this.D=g.la.sj(this.c),this.o=g.la.tj(this.c),this.B=g.la.rj(this.c)):this.c=document.createElement("div"),this.c.style.width=this.u+""+this.D,this.c.style.height=this.o+""+this.B,this.c.style.display="block",this.c.style.position="relative",this.c.style.margin="0px",this.c.style.padding="0px",this.c.style.top=this.I+"px",this.c.style.left=this.F+"px",this.c.style.overflow="hidden",this.c.style.boxSizing="border-box",
!0===g.A.jd&&(this.c.style.pointerEvents="none"),this.c.style.S="none",this.c.style.webkitUserSelect="none",this.c.style.c="none",this.c.style.f="none",this.c.style.i="none",this.c.style.borderStyle=this.ad,this.c.style.borderWidth=this.O+"px",this.c.style.borderColor=this.$c,this.c.style.background=this.Zc,this.Ba=[],"DisplayObject"===this.ab&&(this.j.display.register(this),Xc(this),Yc(this)))};function Xc(a){!0!==a.ge&&(a.log("_notifyReady"),a.ge=!0,a.Aa&&a.Aa.H())}
e.Od=function(){this.log("_notifyAddedToDom");this.Sb&&this.Sb.H()};e.pc=function(){this.log("_notifyShow");!1!==this.rd()&&this.od&&!0===this.visible&&this.od.H()};e.Pd=function(){this.log("_notifyHide");this.hd&&!1===this.visible&&this.hd.H()};e.sf=function(){this.Vb&&this.Vb.H()};e.za=function(a){$c(this);this.Yb&&this.Yb.H(a)};
function $c(a){a.m&&a.u&&a.o&&(a.log("_updateAnchors"),!0===a.Fc?a.horizontalCenter=!0:(a.left=a.ta,a.right=a.Ca),!0===a.Hc?a.verticalCenter=!0:(a.top=a.$b,a.bottom=a.jc))}
function ad(a,b){var d=-1!==b.toLowerCase().indexOf("height")||"both"===b;!0===(-1!==b.toLowerCase().indexOf("width")||"both"===b)&&"%"===a.D&&(a.c.style.width=a.pixelWidth+"px",a.c.width=a.pixelWidth,a.za({property:"width"}));!0===d&&"%"===a.B&&(a.c.style.height=a.pixelHeight+"px",a.c.height=a.pixelHeight,a.za({property:"height"}))}function bd(a,b,d){a.Ba.push({Cn:b,value:d})}
function Yc(a){a.log("_applyPending");a.$=!1;if(a.Ba&&0!==a.Ba.length){a.ha=!0;for(var b=0,d=a.Ba.length;b<d;b++)a[a.Ba[b].Cn]=a.Ba[b].value;a.ha=!1;a.Ba=[]}}e.$g=function(){this.c.style.display="block";this.pc()};e.yj=function(){this.c.style.display="none";this.Pd()};e.Mn=function(){this.visible=!this.visible};
e.Lb=function(a){!0===a&&(this.U=!0,!0===this.$&&bd(this,"maximized",!0));this.m&&(this.kc=!1,a=this.pixelWidth,this.u=this.m.innerWidth,this.D="px",this.c.style.width=this.m.innerWidth+"px",this.c.width=this.m.innerWidth,a!==this.pixelWidth&&this.za({property:"width"}),a=this.pixelHeight,this.o=this.m.innerHeight,this.B="px",this.c.style.height=this.m.innerHeight+"px",this.c.height=this.m.innerHeight,a!==this.pixelHeight&&this.za({property:"height"}))};e.rd=function(){return g.la.has(this.c)};
e.Zg=function(a,b){null!==a&&"undefined"!==typeof a&&(this.width=a);null!==b&&"undefined"!==typeof b&&(this.height=b)};e.gj=function(){if(!0===document[g.A.fullscreenEnabled]&&!1===this.qd())this.c[g.A.requestFullscreen]()};e.hj=function(){if(!0===document[g.A.fullscreenEnabled]&&!0===this.qd())document[g.A.exitFullscreen]()};e.qd=function(){return document[g.A.fullscreenElement]===this.c};
e.destroy=function(){!1!==this.ob&&(this.j.display.unregister(this),this.m&&(this.m.removeChild(this,!1),this.m=null),this.Gc&&(this.Gc.destroy(),this.Gc=null),this.Ec&&(this.Ec.destroy(),this.Ec=null),this.Yb&&(this.Yb.destroy(),this.Yb=null),this.Vb&&(this.Vb.destroy(),this.Vb=null),this.Aa&&(this.Aa.destroy(),this.Aa=null),this.Tb&&(this.Tb.destroy(),this.Tb=null),this.Sb&&(this.Sb.destroy(),this.Sb=null),this.Wb&&(this.Wb.destroy(),this.Wb=null),this.Xb&&(this.Xb.destroy(),this.Xb=null),this.j=
this.Hb=this.c=null,n.prototype.destroy.call(this))};Object.defineProperty(T.prototype,"viewer",{get:function(){return this.j}});Object.defineProperty(T.prototype,"dom",{get:function(){return this.c}});Object.defineProperty(T.prototype,"id",{get:function(){return this.Cg},set:function(a){this.Cg=a;this.c.id=this.Cg}});Object.defineProperty(T.prototype,"ready",{get:function(){return this.ge}});
Object.defineProperty(T.prototype,"parent",{get:function(){return this.m},set:function(a){"object"===typeof a&&!1!==Array.isArray(a.children)&&a!==this.m&&(this.m=a,this.c.style.position="absolute",!0===this.U&&this.Lb(this.U),ad(this,"both"),$c(this),this.Tb&&this.Tb.H(),!0===this.m.rd()&&(this.Od(),this.pc()))}});Object.defineProperty(T.prototype,"visible",{get:function(){return"block"===this.c.style.display},set:function(a){"boolean"===typeof a&&(!0===a?this.$g():this.yj())}});
Object.defineProperty(T.prototype,"x",{get:function(){return this.F},set:function(a){if("number"===typeof a){var b=this.F;this.F=a;this.c.style.left=this.F+"px";this.M&&b!==this.F&&this.M.H({property:"x"})}}});Object.defineProperty(T.prototype,"y",{get:function(){return this.I},set:function(a){if("number"===typeof a){var b=this.I;this.I=a;this.c.style.top=this.I+"px";this.M&&b!==this.I&&this.M.H({property:"y"})}}});
Object.defineProperty(T.prototype,"keepRatio",{get:function(){return this.kc},set:function(a){"boolean"===typeof a&&a!==this.kc&&(this.kc=a)}});
Object.defineProperty(T.prototype,"width",{get:function(){return this.u},set:function(a){var b=this.u,d=this.D;if("string"===typeof a){var h=g.L.eg(a);if(null===h.value||null===h.Rc)throw"KEN.DisplayObject.width value "+a+" is incorrect";this.D=h.Rc;this.u=h.value}else if("number"===typeof a)this.u=a;else return;!0===this.$?bd(this,"width",this.u):(this.U=!1,this.c.style.width=this.pixelWidth+"px",this.c.width=this.pixelWidth,b===this.u&&d===this.D&&!0!==this.ha||this.za({property:"width"}))}});
Object.defineProperty(T.prototype,"pixelWidth",{get:function(){if("px"===this.D)return this.u;if("%"===this.D)return this.m?this.m.innerWidth*this.u/100:0},set:function(a){if("number"===typeof a){var b=this.u,d=this.D;this.u=a;this.D="px";!0===this.$?bd(this,"pixelWidth",a):(this.U=!1,this.c.style.width=this.pixelWidth+"px",this.c.width=this.pixelWidth,b===this.u&&"px"===d&&!0!==this.ha||this.za({property:"pixelWidth"}))}}});
Object.defineProperty(T.prototype,"percentWidth",{get:function(){if("%"===this.D)return this.u;if("px"===this.D)return this.m?this.u/this.m.innerWidth*100:0},set:function(a){if("number"===typeof a){var b=this.u,d=this.D;this.u=a;this.D="%";!0===this.$?bd(this,"percentWidth",a):(this.U=!1,this.c.style.width=this.pixelWidth+"px",this.c.width=this.pixelWidth,b===this.u&&"%"===d&&!0!==this.ha||this.za({property:"percentWidth"}))}}});
Object.defineProperty(T.prototype,"unitWidth",{get:function(){return this.D},set:function(a){if("string"===typeof a&&("px"===a||"%"===a)){var b=this.D;this.D=a;!0===this.$?bd(this,"unitWidth",a):(this.U=!1,this.c.style.width=this.pixelWidth+"px",this.c.width=this.pixelWidth,b===this.D&&!0!==this.ha||this.za({property:"unitWidth"}))}}});Object.defineProperty(T.prototype,"innerWidth",{get:function(){return this.pixelWidth-2*this.O}});
Object.defineProperty(T.prototype,"height",{get:function(){return this.o},set:function(a){var b=this.o,d=this.B;if("string"===typeof a){var h=g.L.eg(a);if(null===h.value||null===h.Rc)throw"KEN.DisplayObject.height value "+a+" is incorrect";this.B=h.Rc;this.o=h.value}else if("number"===typeof a)this.o=a;else return;!0===this.$?bd(this,"height",this.o):(this.U=!1,this.c.style.height=this.pixelHeight+"px",this.c.height=this.pixelHeight,b===this.o&&d===this.B&&!0!==this.ha||this.za({property:"height"}))}});
Object.defineProperty(T.prototype,"pixelHeight",{get:function(){if("px"===this.B)return this.o;if("%"===this.B)return this.m?this.m.innerHeight*this.o/100:0},set:function(a){if("number"===typeof a){var b=this.o,d=this.B;this.o=a;this.B="px";!0===this.$?bd(this,"pixelHeight",a):(this.U=!1,this.c.style.height=this.pixelHeight+"px",this.c.height=this.pixelHeight,b===this.o&&"px"===d&&!0!==this.ha||this.za({property:"pixelHeight"}))}}});
Object.defineProperty(T.prototype,"percentHeight",{get:function(){if("%"===this.B)return this.o;if("px"===this.B)return this.m?this.o/this.m.innerHeight*100:0},set:function(a){if("number"===typeof a){var b=this.o,d=this.B;this.o=a;this.B="%";!0===this.$?bd(this,"percentHeight",a):(this.U=!1,this.c.style.height=this.pixelHeight+"px",this.c.height=this.pixelHeight,b===this.o&&"%"===d&&!0!==this.ha||this.za({property:"percentHeight"}))}}});
Object.defineProperty(T.prototype,"unitHeight",{get:function(){return this.B},set:function(a){if("string"===typeof a){var b=this.B;this.B=a;!0===this.$?bd(this,"unitHeight",a):(this.U=!1,this.c.style.height=this.pixelHeight+"px",this.c.height=this.pixelHeight,b===this.B&&!0!==this.ha||this.za({property:"unitHeight"}))}}});Object.defineProperty(T.prototype,"innerHeight",{get:function(){return this.pixelHeight-2*this.O}});
Object.defineProperty(T.prototype,"maximized",{get:function(){return this.U},set:function(a){"boolean"===typeof a&&(this.U=a,!0===this.U&&this.Lb(!0))}});Object.defineProperty(T.prototype,"horizontalCenter",{get:function(){return this.Fc},set:function(a){"boolean"===typeof a&&(this.Fc=a,!0===this.Fc&&(this.Ca=this.ta=null),this.m&&(a=this.F,this.F=(this.m.innerWidth-this.pixelWidth)/2,this.c.style.left=this.F+"px",this.M&&a!==this.F&&this.M.H({property:"x"})))}});
Object.defineProperty(T.prototype,"verticalCenter",{get:function(){return this.Hc},set:function(a){"boolean"===typeof a&&(this.Hc=a,!0===this.Hc&&(this.jc=this.$b=null),this.m&&(a=this.I,this.I=(this.m.innerHeight-this.pixelHeight)/2,this.c.style.top=this.I+"px",this.M&&a!==this.I&&this.M.H({property:"y"})))}});
Object.defineProperty(T.prototype,"top",{get:function(){return this.$b},set:function(a){if("number"===typeof a||null===a)if(this.$b=a,this.Hc=!1,this.m&&null!==this.$b){var b=this.I;this.I=a;this.c.style.top=this.I+"px";this.M&&b!==this.I&&this.M.H({property:"y"})}}});
Object.defineProperty(T.prototype,"right",{get:function(){return this.Ca},set:function(a){if("number"===typeof a||null===a)if(this.Ca=a,this.Fc=!1,this.m&&null!==this.Ca){var b=this.F;this.F=this.m.innerWidth-this.pixelWidth-a;this.c.style.left=this.F+"px";this.M&&b!==this.F&&this.M.H({property:"x"})}}});
Object.defineProperty(T.prototype,"bottom",{get:function(){return this.jc},set:function(a){if("number"===typeof a||null===a)if(this.jc=a,this.Hc=!1,this.m&&null!==this.jc){var b=this.I;this.I=this.m.innerHeight-this.pixelHeight-a;this.c.style.top=this.I+"px";this.M&&b!==this.I&&this.M.H({property:"y"})}}});
Object.defineProperty(T.prototype,"left",{get:function(){return this.ta},set:function(a){if("number"===typeof a||null===a)if(this.ta=a,this.Fc=!1,this.m&&null!==this.ta){var b=this.F;this.F=a;this.c.style.left=this.F+"px";this.M&&b!==this.F&&this.M.H({property:"x"})}}});Object.defineProperty(T.prototype,"alpha",{get:function(){return this.ee},set:function(a){"number"===typeof a&&a!==this.ee&&(this.ee=a,this.c.style.opacity=this.ee)}});
Object.defineProperty(T.prototype,"rotation",{get:function(){return this.je},set:function(a){"number"===typeof a&&a!==this.je&&(this.je=a,this.c.style.transform="rotate("+this.je+"deg)")}});Object.defineProperty(T.prototype,"background",{get:function(){return this.Zc},set:function(a){"string"===typeof a&&a!==this.Zc&&(this.Zc=a,this.c.style.background=this.Zc)}});
Object.defineProperty(T.prototype,"borderStyle",{get:function(){return this.ad},set:function(a){-1!=="none dotted dashed solid double groove ridge inset outset".split(" ").indexOf(a)&&a!==this.ad&&(this.ad=a,!0===this.$?bd(this,"borderStyle",a):this.c.style.borderStyle=this.ad)}});
Object.defineProperty(T.prototype,"borderWidth",{get:function(){return this.O},set:function(a){if("number"===typeof a){var b=this.O;this.O=a;!0===this.$?bd(this,"borderWidth",a):(this.c.style.borderWidth=this.O+"px",b===this.O&&!0!==this.ha||this.sf())}}});Object.defineProperty(T.prototype,"borderColor",{get:function(){return this.$c},set:function(a){"string"===typeof a&&a!==this.$c&&(this.$c=a,this.c.style.borderColor=this.$c)}});
Object.defineProperty(T.prototype,"borderRadius",{get:function(){return this.se},set:function(a){"number"!==typeof a&&"string"!==typeof a||a===this.se||("string"===typeof a&&(a=parseInt(a,10)),isNaN(a)||(this.se=a,this.c.style.borderRadius=this.se+"px"))}});Object.defineProperty(T.prototype,"globalOffset",{get:function(){var a=this.c,b=0,d=0;do b+=a.offsetTop||0,d+=a.offsetLeft||0,a=a.offsetParent;while(a);return{top:b,left:d}}});
Object.defineProperty(T.prototype,"tooltip",{get:function(){return this.ye},set:function(a){"string"===typeof a&&a!==this.ye&&(this.ye=a,this.c.title=this.ye)}});Object.defineProperty(T.prototype,"index",{get:function(){return this.fe},set:function(a){"number"===typeof a&&a!==this.fe&&(this.fe=a,this.c.style.zIndex=this.fe)}});Object.defineProperty(T.prototype,"fullscreen",{set:function(a){"boolean"===typeof a&&(!0===a?this.gj():this.hj())}});
Object.defineProperty(T.prototype,"pointer",{get:function(){this.Gc||(this.Gc=new U(this));return this.Gc}});Object.defineProperty(T.prototype,"drag",{get:function(){this.Ec||(this.Ec=new Oc(this));return this.Ec}});Object.defineProperty(T.prototype,"onResize",{get:function(){this.Yb||(this.Yb=new p(this));return this.Yb}});Object.defineProperty(T.prototype,"onBorderResize",{get:function(){this.Vb||(this.Vb=new p(this));return this.Vb}});
Object.defineProperty(T.prototype,"onMove",{get:function(){this.M||(this.M=new p(this));return this.M}});Object.defineProperty(T.prototype,"onReady",{get:function(){this.Aa||(this.Aa=new p(this,!0));return this.Aa}});Object.defineProperty(T.prototype,"onAddedToParent",{get:function(){this.Tb||(this.Tb=new p(this));return this.Tb}});Object.defineProperty(T.prototype,"onAddedToDom",{get:function(){this.Sb||(this.Sb=new p(this));return this.Sb}});
Object.defineProperty(T.prototype,"onShow",{get:function(){this.od||(this.od=new p(this));return this.od}});Object.defineProperty(T.prototype,"onHide",{get:function(){this.hd||(this.hd=new p(this));return this.hd}});Object.defineProperty(T.prototype,"onFullscreenEnter",{get:function(){this.Wb||(this.Wb=new p(this));return this.Wb}});Object.defineProperty(T.prototype,"onFullscreenExit",{get:function(){this.Xb||(this.Xb=new p(this));return this.Xb}});
function u(a,b,d,h){this.f=[];this.P="undefined"!==typeof h?h:null;this.C=null;this.qf=!1;this.ja="hidden";T.call(this,a,b,d||"DisplayObjectContainer")}u.prototype=Object.create(T.prototype);e=u.prototype;e.constructor=u;
e.Ja=function(){T.prototype.Ja.call(this);if("DisplayObjectContainer"===this.ab){var a=!!this.P;!0===a&&(this.C={originalWidth:this.P.clientWidth,originalHeight:this.P.clientHeight,currentWidth:this.P.clientWidth,currentHeight:this.P.clientHeight,scaleWidth:1,scaleHeight:1,frameCount:0,frameInterval:10},this.u=this.C.currentWidth,this.c.style.width=this.pixelWidth+"px",this.o=this.C.currentHeight,this.c.style.height=this.pixelHeight+"px",this.P.style.position="relative",this.c.style.position="absolute",
this.P.appendChild(this.c));this.j.display.register(this,a);Xc(this);Yc(this)}};e.za=function(a){for(var b=0,d=this.f.length;b<d;b++){var h=this.f[b],k=a;!0===h.U&&h.Lb(h.U);ad(h,k.property);$c(h)}T.prototype.za.call(this,a)};e.Od=function(){T.prototype.Od.call(this);for(var a=0,b=this.f.length;a<b;a++)this.f[a].Od()};e.pc=function(){T.prototype.pc.call(this);for(var a=0,b=this.f.length;a<b;a++)this.f[a].pc()};e.Pd=function(){T.prototype.Pd.call(this);for(var a=0,b=this.f.length;a<b;a++)this.f[a].Pd()};
function cd(a,b){if(!a.f)return-1;for(var d=0,h=a.f.length;d<h;d++)if(a.f[d]===b)return d;return-1}
e.update=function(){this.C.frameCount++;if(!(this.C.frameCount<this.C.frameInterval)){this.C.frameCount=0;var a=this.P.clientWidth,b=this.P.clientHeight,d=!1;a!==this.C.currentWidth&&(this.C.currentWidth=a,this.C.scaleWidth=this.C.currentWidth/this.C.originalWidth,d=!0);b!==this.C.currentHeight&&(this.C.currentHeight=b,this.C.scaleHeight=this.C.currentHeight/this.C.scaleHeight,d=!0);!0===d&&this.Zg(this.C.currentWidth,this.C.currentHeight)}};
e.cc=function(a){if(a===this)throw"You can't add a KEN.DisplayObjectContainer to itself!";var b=a;a instanceof Element&&(b=new T(a));this.c.appendChild(b.dom);b.parent=this;a=this.f.push(b)-1;null===b.index&&(b.index=a)};e.Wm=function(a,b){var d=a;a instanceof Element&&(d=new T(a));this.c.appendChild(d.dom);d.parent=this;this.f.splice(b,0,d);d.index=b;b=0;for(d=this.f.length;b<d;b++)a=this.f[b],a.index=b};
e.fj=function(){var a=this.f;if(0<a.length){this.qf=!0;for(var b=0,d=a.length;b<d;b++)if(!0===a[b].rd()&&!0===a[b].visible){var h=Math.max(a[b].width+a[b].x,a[b].width+a[b].left,a[b].width+a[b].right),k=Math.max(a[b].height+a[b].y,a[b].height+a[b].top,a[b].height+a[b].bottom);h>this.pixelWidth&&(this.width=h);k>this.pixelHeight&&(this.height=k)}}null!==this.parent&&!0===g.L.V(this.parent,"DisplayObjectContainer")&&!0===this.parent.qf&&this.parent.fj()};
e.removeChild=function(a,b){a=cd(this,a);-1!==a&&this.fg(a,b)};e.fg=function(a,b){if(0<=a&&a<this.f.length){var d=this.f[a];this.f.splice(a,1);this.c.removeChild(d.dom);"undefined"!==typeof b&&!0!==b||d.destroy();!0!==this.qf||this.f.length||(this.height=this.width=0)}};e.Yg=function(a){for(var b=this.f.length;b--;)this.fg(b,a)};e.vk=function(a){return-1!==cd(this,a)};e.destroy=function(){this.Yg(!1);this.C=this.P=this.f=null;T.prototype.destroy.call(this)};
Object.defineProperty(u.prototype,"children",{get:function(){return this.f}});Object.defineProperty(u.prototype,"overflow",{get:function(){return this.ja},set:function(a){-1!==["hidden","visible","scroll"].indexOf(a)&&(this.ja=a,this.c.style.overflow=a)}});
function I(a,b,d){this.xa=b||null;this.oa=this.P="";this.ja=!1;this.ka=this.ya="";this.C=this.aa=null;this.da=!1;this.ia=this.f=null;this.ra="";this.W=this.qa=!1;this.va=this.wa=!0;this.G=dd;this.K=this.Z=this.i=null;T.call(this,a,null,d||"Image")}I.prototype=Object.create(T.prototype);I.prototype.constructor=I;var ed={CSS:"css",Ub:"canvas"},dd=ed.CSS;e=I.prototype;
e.Ja=function(){T.prototype.Ja.call(this);this.kc=!0;this.G===ed.CSS?this.c.style.backgroundRepeat="no-repeat":this.G===ed.Ub&&(this.i=document.createElement("canvas"),this.i.style.position="absolute",this.i.style.top="0px",this.i.style.left="0px",this.c.appendChild(this.i));null!==this.xa&&this.load(this.xa);this.j.display.register(this);Xc(this)};
e.za=function(a){var b=a.property;-1!==b.toLowerCase().indexOf("width")&&"autoWidth"!==b&&(this.wa=!1);-1!==b.toLowerCase().indexOf("height")&&"autoHeight"!==b&&(this.va=!1);this.C&&(this.G===ed.CSS?(fd(this),gd(this)):this.G===ed.Ub&&this.f&&this.fd(this.f),!0===this.kc&&(-1!==b.toLowerCase().indexOf("width")?(b=this.pixelWidth/this.f.w,b!==this.sa&&(this.sa=b,!0===this.kc&&(this.ma=b,this.height=this.f.h*this.ma))):-1!==b.toLowerCase().indexOf("height")&&(b=this.pixelHeight/this.f.h,b!==this.ma&&
(this.ma=b,!0===this.kc&&(this.sa=b,this.width=this.f.w*this.sa)))),T.prototype.za.call(this,a))};e.sf=function(){this.G===ed.CSS?this.c.style.backgroundPosition=-this.O+"px "+-this.O+"px":this.G===ed.Ub&&(this.i.style.top=-this.O+"px",this.i.style.left=-this.O+"px");T.prototype.sf.call(this)};e.Le=function(){var a=this.P+"_"+this.j.i18n.locale;if(a!==this.ya&&(this.ya=a,!0===this.j.i18n.Eb(this.ka))){var b=this.aa.value;this.W=!1;this.j.load.image(a,b,this.Nd,this)}};
function hd(a,b){a.f=b;!0===a.wa&&(a.u=a.f.w,a.D="px",a.c.style.width=a.pixelWidth+"px");!0===a.va&&(a.o=a.f.h,a.B="px",a.c.style.height=a.pixelHeight+"px");a.G===ed.CSS?(fd(a),gd(a)):a.G===ed.Ub&&a.fd(a.f)}e.fd=function(a){if(this.C&&!1!==this.da){this.i.width=this.innerWidth;this.i.height=this.innerHeight;var b=this.i.getContext("2d");b.clearRect(0,0,this.innerWidth,this.innerHeight);b.drawImage(this.C,a.x,a.y,a.w,a.h,0,0,this.innerWidth,this.innerHeight)}};
function fd(a){a.c.style.backgroundSize=a.pixelWidth/a.f.w*a.C.naturalWidth+"px "+a.pixelHeight/a.f.h*a.C.naturalHeight+"px"}function gd(a){a.c.style.backgroundPosition=a.pixelWidth/a.f.w*(-a.f.x-a.O)+"px "+a.pixelHeight/a.f.h*(-a.f.y-a.O)+"px"}e.Nd=function(a){!1!==this.ob&&(this.C=a.data,this.G===ed.CSS&&(this.c.style.backgroundImage="url('"+a.url+"')"),this.da=!0,id(this))};
e.dm=function(a){"undefined"!==typeof a.data.frames?this.ia=a.data.frames:this.warn("No frames found in file!");this.qa=!0;id(this)};function id(a){if(!0!==a.W&&!0===a.da&&!0===a.qa){a.W=!0;var b;a.f?b=a.f:a.ia?b=a.ia[0].frame:b={x:0,y:0,w:a.C.naturalWidth,h:a.C.naturalHeight};hd(a,b);$c(a);Yc(a);a.K&&a.K.H()}}
e.load=function(a){this.qa=this.da=this.W=!1;"object"===typeof a&&a?(this.P=a.key||"",this.ja=a.i18n||!1,!0===this.ja?(this.oa="",this.ka=a.url):this.oa=a.url,this.f=a.frame||null,"string"===typeof a.frames?this.ra=a.frames:"object"===typeof a.frames&&null!==a.frames&&(this.ia=a.frames),this.alpha=a.alpha,this.keepRatio=a.keepRatio,this.maximized=a.maximized,this.width=a.width,this.height=a.height):(this.oa=this.P="",this.ja=!1,"string"===typeof a&&(this.oa=a));a=this.P;var b=this.oa;if(!0===this.ja&&
"string"===typeof this.ka){this.aa=new D(this.j,this.ka);!1===this.j.i18n.onLocaleChangeComplete.has(this.Le,this)&&this.j.i18n.onLocaleChangeComplete.add(this.Le,this);var d=this.j.i18n.locale;""!==d&&(a=this.P+"_"+d);!0===this.j.i18n.Eb(this.ka)&&(b=this.aa.value)}""!==b?(this.W=!1,this.j.load.image(a,b,this.Nd,this)):this.da=!0;"string"===typeof this.ra&&""!==this.ra?(a=this.ra,this.W=!1,this.j.load.json(this.P+"-frames",a,this.dm,this)):this.qa=!0};
e.xe=function(){this.c.style.backgroundImage="";this.C=null};e.destroy=function(a){if(!1!==this.ob){this.aa&&(this.aa.destroy(),this.aa=null,this.j.i18n.onLocaleChangeComplete.remove(this.Le,this));this.Z&&(this.Z.destroy(),this.Z=null);this.K&&(this.K.destroy(),this.K=null);this.C=null;if("undefined"===typeof a||!0===a)if(!0===this.ja){a=this.j.i18n.locales;for(var b,d=0,h=a.length;d<h;d++)b=this.P+"_"+a[d],this.j.cache.remove(B.IMAGE,b)}else this.j.cache.remove(B.IMAGE,this.P);T.prototype.destroy.call(this)}};
Object.defineProperty(I.prototype,"loaded",{get:function(){return this.W}});Object.defineProperty(I.prototype,"element",{get:function(){return this.C}});Object.defineProperty(I.prototype,"frame",{get:function(){return this.f},set:function(a){hd(this,a)}});Object.defineProperty(I.prototype,"frames",{get:function(){return this.ia}});Object.defineProperty(I.prototype,"originalWidth",{get:function(){if(this.C)return this.C.naturalWidth}});Object.defineProperty(I.prototype,"originalHeight",{get:function(){if(this.C)return this.C.naturalHeight}});
Object.defineProperty(I.prototype,"onLoadStart",{get:function(){this.Z||(this.Z=new p(this));return this.Z}});Object.defineProperty(I.prototype,"onLoadComplete",{get:function(){this.K||(this.K=new p(this));return this.K}});function ub(a,b){this.ma=this.sa=1;this.J=null;I.call(this,a,b,"ImageScalable");this.Ja()}ub.prototype=Object.create(I.prototype);e=ub.prototype;e.constructor=ub;e.Ja=function(){this.warn(this.ab+" test both render modes");this.G=ed.Ub;I.prototype.Ja.call(this)};
e.Nd=function(a){var b=a.data;this.J=new Ca(b.naturalWidth,b.naturalHeight);I.prototype.Nd.call(this,a)};
e.fd=function(a){this.log(a);this.G!==ed.Ub?this.warn("Invalid render mode for "+this.ab):this.C&&!1!==this.da&&(this.u=this.i.width=this.J.width*this.sa,this.c.style.width=this.i.width+"px",this.o=this.i.height=this.J.height*this.ma,this.c.style.height=this.i.height+"px",a=this.i.getContext("2d"),a.clearRect(0,0,this.i.width,this.i.height),a.drawImage(this.C,0,0,this.J.width,this.J.height,0,0,this.i.width,this.i.height))};e.destroy=function(){this.J=null;I.prototype.destroy.call(this)};
Object.defineProperty(ub.prototype,"scaleWidth",{get:function(){return this.sa},set:function(a){a=Math.max(Number.EPSILON,a);this.sa!==a&&(this.sa=a,this.fd(this.frame))}});Object.defineProperty(ub.prototype,"scaleHeight",{get:function(){return this.ma},set:function(a){a=Math.max(Number.EPSILON,a);this.ma!==a&&(this.ma=a,this.fd(this.frame))}});function Ac(a,b){this.J=null;I.call(this,a,b,"Sprite")}Ac.prototype=Object.create(I.prototype);e=Ac.prototype;e.constructor=Ac;
e.Ja=function(){this.G=ed.Ub;I.prototype.Ja.call(this);this.J=new jd(this);this.j.display.register(this,!0)};e.play=function(a,b,d){this.J.play(a,b,d)};e.pause=function(a){this.J.pause(a)};e.resume=function(a){this.J.resume(a)};e.stop=function(){this.J.stop()};e.update=function(){this.J.update()};e.destroy=function(){!1!==this.ob&&(this.J.destroy(),this.J=null,I.prototype.destroy.call(this))};Object.defineProperty(Ac.prototype,"animations",{get:function(){return this.J}});
Object.defineProperty(Ac.prototype,"animation",{get:function(){return this.J.currentAnimation}});function kd(a,b){this.f=null;this.aa=b||null;this.i="";this.P=!1;this.C="";this.Z=this.K=null;this.W=!1;this.G=this.J=null;T.call(this,a,null,"Iframe")}kd.prototype=Object.create(T.prototype);e=kd.prototype;e.constructor=kd;
e.Ja=function(){T.prototype.Ja.call(this);this.Z=this.bm.bind(this);this.f=document.createElement("iframe");this.f.style.width="100%";this.f.style.height="100%";this.f.style.border=0;this.f.style.overflow="hidden";this.f.addEventListener("load",this.Z,!!this&&!!this);this.f.setAttribute("allowFullScreen","");this.c.appendChild(this.f);null!==this.aa&&this.load(this.aa);this.j.display.register(this);Xc(this);Yc(this)};
e.Ke=function(){this.log("_localeChangeComplete");!0===this.j.i18n.Eb(this.C)&&ld(this,this.K.value)};function ld(a,b){a.log("_loadIframe url: "+b);a.W=!1;a.J&&a.J.H();a.i=b;a.f.src=a.i}e.bm=function(){""!==this.i&&(this.log("_loadCompleteHandler url: "+this.i),this.W=!0,this.G&&this.G.H())};function md(a){!1===a.j.i18n.onLocaleChangeComplete.has(a.Ke,a)&&a.j.i18n.onLocaleChangeComplete.add(a.Ke,a)}
e.load=function(a){"object"===typeof a&&a?(this.P=a.i18n||!1,!0===this.P?(this.i="",this.C=a.url):this.i=a.url):(this.P=!1,this.i="","string"===typeof a&&(this.i=a));var b;!0===this.P&&"string"===typeof this.C&&""!==this.C?(this.K=new D(this.j,this.C),md(this),b=this.K.value):"string"===typeof this.i&&""!==this.i&&(b=this.i);"undefined"!==typeof b&&ld(this,b)};
e.destroy=function(){!1!==this.ob&&(this.K&&(this.K.destroy(),this.K=null,this.j.i18n.onLocaleChangeComplete.remove(this.Ke,this)),this.J&&(this.J.destroy(),this.J=null),this.G&&(this.G.destroy(),this.G=null),this.Z=this.f=null,T.prototype.destroy.call(this))};
Object.defineProperty(kd.prototype,"i18nUrl",{get:function(){return this.C},set:function(a){if("string"===typeof a){this.P=!0;this.C=a;var b;""!==this.C&&(this.K=new D(this.j,this.C),md(this),b=this.K.value);"undefined"!==typeof b&&ld(this,b)}}});Object.defineProperty(kd.prototype,"url",{get:function(){return this.i},set:function(a){"string"===typeof a&&(this.P=!1,ld(this,a))}});Object.defineProperty(kd.prototype,"loaded",{get:function(){return this.W}});
Object.defineProperty(kd.prototype,"onLoadStart",{get:function(){this.J||(this.J=new p(this));return this.J}});Object.defineProperty(kd.prototype,"onLoadComplete",{get:function(){this.G||(this.G=new p(this));return this.G}});
function R(a,b){this.ja=b;this.G="";this.i=!1;this.J=null;this.aa="";this.ia="rgb(0, 0, 0)";this.W=this.Z=!0;this.Ha=0;this.P=this.Ia=!1;this.da=null;this.Wa=!1;this.Ga=this.Da=this.Fa=this.ya=this.xa=this.wa=this.va=this.Ua=this.Ra=this.Ta=this.Sa=this.Pa=this.Oa="";this.oa=this.qa=this.ra=this.f=this.Ka=null;this.ka=!1;this.C=this.K=null;T.call(this,a,null,"TextField")}R.prototype=Object.create(T.prototype);e=R.prototype;e.constructor=R;
e.Ja=function(){T.prototype.Ja.call(this);this.ra=this.Pl.bind(this);this.qa=this.zl.bind(this);this.oa=this.yl.bind(this);this.Ka=document.createElement("span");this.c.appendChild(this.Ka);"undefined"!==typeof this.ja&&null!==this.ja&&this.load(this.ja);this.j.display.register(this);Xc(this);Yc(this)};
e.za=function(a){var b=a.property;-1!==b.toLowerCase().indexOf("width")&&"autoWidth"!==b&&(this.Z=!1);-1!==b.toLowerCase().indexOf("height")&&"autoHeight"!==b&&(this.W=!1);T.prototype.za.call(this,a)};e.pc=function(){nd(this);T.prototype.pc.call(this)};function od(a,b){b!==a.aa&&(a.aa=String(b),a.Ka.innerHTML=b,nd(a),$c(a),a.K&&a.K.H());if(!1===a.i||!0===a.i&&!0===a.J.loaded)a.ka=!0,a.C&&a.C.H()}
function nd(a){if(!1!==a.rd()){if(!0===a.Z){var b=a.pixelWidth;a.c.style.width="";var d=a.c.offsetWidth;0<d&&(d+=1);a.u=d;a.D="px";a.c.style.width=a.u+"px";b!==a.u&&a.za({property:"autoWidth"})}!0===a.W&&(b=a.pixelHeight,a.c.style.height="",d=a.c.offsetHeight,0<d&&(d+=1),a.o=d,a.B="px",a.c.style.height=a.o+"px",b!==a.o&&a.za({property:"autoHeight"}))}}function pd(a){a.J||(a.J=new D(a.j,a.G));od(a,a.J.value)}
function qd(a){!1===a.j.i18n.onLocaleChangeComplete.has(a.Re,a)&&a.j.i18n.onLocaleChangeComplete.add(a.Re,a)}e.Re=function(){this.log("_localeChangeComplete");!0===this.j.i18n.Eb(this.G)&&(this.value=this.J.value)};
e.Pl=function(){!0!==this.P||this.f||(this.f=document.createElement("textarea"),this.f.style.position="absolute",this.f.style.top="0px",this.f.style.left="0px",this.f.style.width="100%",this.f.style.height="100%",this.f.style.resize="none",this.f.style.margin="0px",this.f.style.padding="0px",this.f.style.overflowX="hidden",this.f.style.overflowY="auto",this.f.style.boxSizing="border-box",this.f.value=this.aa,this.f.addEventListener("input",this.qa,!1),this.f.addEventListener("blur",this.oa,!1),this.c.appendChild(this.f),
this.f.focus())};e.zl=function(){od(this,this.f.value)};e.yl=function(){this.nf()};e.nf=function(){this.f&&(this.f.removeEventListener("input",this.qa,!1),this.f.removeEventListener("blur",this.oa,!1),this.c.removeChild(this.f),this.f=null)};
e.load=function(a){this.ka=!1;"object"===typeof a&&a?(a.color&&(this.color=a.color),a.font&&(this.font=a.font),a.fontFamily&&(this.fontFamily=a.fontFamily),a.fontWeight&&(this.fontWeight=a.fontWeight),a.fontSize&&(this.fontSize=a.fontSize),a.fontStyle&&(this.fontStyle=a.fontStyle),a.fontVariant&&(this.fontVariant=a.fontVariant),a.textAlign&&(this.textAlign=a.textAlign),a.textShadow&&(this.textShadow=a.textShadow),a.textDecoration&&(this.textDecoration=a.textDecoration),a.textOverflow&&(this.textOverflow=
a.textOverflow),a.textTransform&&(this.textTransform=a.textTransform),a.whiteSpace&&(this.whiteSpace=a.whiteSpace),a.wordWrap&&(this.wordWrap=a.wordWrap),a.lineHeight&&(this.lineHeight=a.lineHeight),a.autoWidth&&(this.autoWidth=a.autoWidth),a.autoHeight&&(this.autoHeight=a.autoHeight),a.padding&&(this.padding=a.padding),a.selectable&&(this.selectable=a.selectable),a.editable&&(this.editable=a.editable),this.i=a.i18n||!1,!0===this.i?this.G=a.value:this.value=a.value):"string"===typeof a&&(this.i=!1,
this.value=a);!0===this.i&&"string"===typeof this.G&&""!==this.G&&(pd(this),qd(this))};e.destroy=function(){!1!==this.ob&&(this.J&&(this.J.destroy(),this.J=null,this.j.i18n.onLocaleChangeComplete.remove(this.Re,this)),this.nf(),this.C&&(this.C.destroy(),this.C=null),this.K&&(this.K.destroy(),this.K=null),T.prototype.destroy.call(this))};Object.defineProperty(R.prototype,"i18nValue",{get:function(){return this.G},set:function(a){"string"===typeof a&&(""===this.G&&qd(this),this.i=!0,this.G=a,pd(this))}});
Object.defineProperty(R.prototype,"i18n",{get:function(){return this.i}});Object.defineProperty(R.prototype,"value",{get:function(){return this.aa},set:function(a){if("string"===typeof a||"number"===typeof a)this.i=!1,od(this,a)}});Object.defineProperty(R.prototype,"color",{get:function(){return this.ia},set:function(a){"string"===typeof a&&(this.ia=a,this.c.style.color=this.ia)}});
Object.defineProperty(R.prototype,"font",{get:function(){return this.va},set:function(a){"string"!==typeof a||2>a.split(" ").toString().length||(this.va=a.replace(/"/g,'"'),this.c.style.font=this.va)}});Object.defineProperty(R.prototype,"fontFamily",{get:function(){return this.wa},set:function(a){"string"===typeof a&&(this.wa=a.replace(/"/g,'"'),this.c.style.fontFamily=this.wa,nd(this))}});
Object.defineProperty(R.prototype,"fontSize",{get:function(){return this.xa},set:function(a){if("number"===typeof a||"string"===typeof a)"number"===typeof a&&(a+="px"),this.xa=a,this.c.style.fontSize=this.xa}});Object.defineProperty(R.prototype,"fontStyle",{get:function(){return this.ya},set:function(a){"string"===typeof a&&(this.ya=a,this.c.style.fontStyle=this.ya)}});
Object.defineProperty(R.prototype,"fontWeight",{get:function(){return this.Fa},set:function(a){"string"===typeof a&&"number"===typeof a&&(this.Fa=a,this.c.style.fontWeight=this.Fa)}});Object.defineProperty(R.prototype,"fontVariant",{get:function(){return this.Da},set:function(a){"string"===typeof a&&(this.Da=a,this.c.style.fontVariant=this.Da)}});
Object.defineProperty(R.prototype,"lineHeight",{get:function(){return this.Ga},set:function(a){if("number"===typeof a||"string"===typeof a)"number"===typeof a&&(a+="px"),this.Ga=a,this.c.style.lineHeight=this.Ga}});Object.defineProperty(R.prototype,"textAlign",{get:function(){return this.Oa},set:function(a){"string"===typeof a&&(this.Oa=a,this.c.style.textAlign=this.Oa)}});
Object.defineProperty(R.prototype,"textShadow",{get:function(){return this.Sa},set:function(a){"string"===typeof a&&(this.Sa=a,this.c.style.textShadow=this.Sa)}});Object.defineProperty(R.prototype,"textDecoration",{get:function(){return this.Pa},set:function(a){"string"===typeof a&&(this.Pa=a,this.c.style.textDecoration=this.Pa)}});Object.defineProperty(R.prototype,"textTransform",{get:function(){return this.Ta},set:function(a){"string"===typeof a&&(this.Ta=a,this.c.style.textTransform=this.Ta)}});
Object.defineProperty(R.prototype,"autoWidth",{get:function(){return this.Z},set:function(a){"boolean"===typeof a&&(this.Z=a,nd(this))}});Object.defineProperty(R.prototype,"autoHeight",{get:function(){return this.W},set:function(a){"boolean"===typeof a&&(this.W=a,nd(this))}});
Object.defineProperty(R.prototype,"padding",{get:function(){return this.Ha},set:function(a){if("number"===typeof a||"string"===typeof a)this.Ha=a="string"===typeof a?a.split(" ",4).toString().replace(/,/g," "):a+"px",this.c.style.padding=this.Ha}});
Object.defineProperty(R.prototype,"selectable",{get:function(){return this.Ia},set:function(a){"boolean"===typeof a&&(this.Ia=a,!1===this.Ia?(!1===this.P&&!0===this.Ya&&(this.Ya=this.pointer.enabled=!1),this.c.style.S="none",this.c.style.webkitUserSelect="none",this.c.style.c="none",this.c.style.f="none",this.c.style.i="none"):(!1===this.pointer.enabled&&(this.Ya=this.pointer.enabled=!0),this.c.style.S="text",this.c.style.webkitUserSelect="text",this.c.style.c="text",this.c.style.f="text",this.c.style.i=
"inherit"))}});Object.defineProperty(R.prototype,"wordWrap",{get:function(){return this.Wa},set:function(a){"boolean"===typeof a&&(this.Wa=a,this.c.style.wordWrap=!1===this.Wa?"normal":"break-word")}});Object.defineProperty(R.prototype,"whiteSpace",{get:function(){return this.Ua},set:function(a){"string"===typeof a&&(this.Ua=a,this.c.style.whiteSpace=this.Ua)}});
Object.defineProperty(R.prototype,"textOverflow",{get:function(){return this.Ra},set:function(a){"string"===typeof a&&(this.Ra=a,this.c.style.textOverflow=this.Ra)}});
Object.defineProperty(R.prototype,"editable",{get:function(){return this.P},set:function(a){a=!!a;this.P!==a&&(this.P=a,!1===this.P?(this.c.removeEventListener("click",this.ra,!!this&&!!this),this.j.keyboard.te(this.da),this.da=null,this.pointer.enabled=!0,this.c.style.cursor="text"):(this.c.addEventListener("click",this.ra,!!this&&!!this),this.da=new M(this.j,[13,27],this.nf,null,null,null,this),this.j.keyboard.wf(this.da),this.c.style.cursor="default"))}});
Object.defineProperty(R.prototype,"loaded",{get:function(){return this.ka}});Object.defineProperty(R.prototype,"onLoadComplete",{get:function(){this.C||(this.C=new p(this));return this.C}});Object.defineProperty(R.prototype,"onValueChange",{get:function(){this.K||(this.K=new p(this));return this.K}});function Bc(a,b){this.ka=b||null;this.G={};this.da=this.J=this.W="";this.i=this.K=null;this.Z=this.aa=!1;this.ia=0;u.call(this,a,null,"Button")}Bc.prototype=Object.create(u.prototype);
Bc.prototype.constructor=Bc;var rd={Gb:"out",mc:"over",Mg:"down"};e=Bc.prototype;
e.Ja=function(){u.prototype.Ja.call(this);this.J=rd.Gb;this.K=new I(this.j);this.K.onLoadComplete.add(this.Ld,this);this.K.onResize.add(this.Md,this);this.cc(this.K);this.i=new R(this.j);this.i.onLoadComplete.add(this.Ld,this);this.i.onResize.add(this.Md,this);this.i.autoWidth=!0;this.i.autoHeight=!0;this.cc(this.i);this.pointer.enabled=!0;this.pointer.cursor=Qc.cb;this.pointer.onEnter.add(this.im,this);this.pointer.onLeave.add(this.jm,this);this.pointer.onPressStart.add(this.pk,this);this.pointer.onPressEnd.add(this.nk,
this);this.j.display.register(this);Xc(this);Yc(this);this.j.i18n.onLocaleChangeComplete.add(this.Rg,this);this.load(this.ka)};e.im=function(){sd(this,rd.mc)};e.jm=function(){sd(this,rd.Gb)};e.pk=function(){sd(this,rd.Mg)};e.nk=function(){sd(this,rd.mc)};e.Rg=function(){sd(this,this.J)};e.Ld=function(a){this.log("_itemLoadComplete "+a.emitter.className);this.ia++;2===this.ia&&(this.log("_allItemsLoaded"),td(this),ud(this))};e.Md=function(){td(this);ud(this)};function vd(a,b){a.W=b;sd(a,a.J)}
function sd(a,b){a.J=b;b=a.G[a.W];a.ia=0;var d=b.wj(a.J);a.background=b.Xa("background",a.J);a.borderStyle=b.Xa("borderStyle",a.J);a.borderColor=b.Xa("borderColor",a.J);a.borderRadius=b.Xa("borderRadius",a.J);a.borderWidth=b.Xa("borderWidth",a.J);a.aa=b.Xa("autoWidth",a.J);a.Z=b.Xa("autoHeight",a.J);var h=b.Xa("label",a.J);"undefined"!==typeof h&&a.i.load(h);!0===d&&a.K.load(b.Xa("image",a.J))}
function td(a){a.log("_updateLayout");var b=a.G[a.W],d=b.Xa("align",a.J),h=b.Xa("padding",a.J),k=b.Xa("spacing",a.J);"label"===b.Xa("first",a.J)?(b=a.i,a=a.K):(b=a.K,a=a.i);switch(d){case "left":b.left=h;b.verticalCenter=!0;a.left=b.left+k+b.pixelWidth;a.verticalCenter=!0;break;case "right":b.right=h;b.verticalCenter=!0;a.right=b.right+k+b.pixelWidth;a.verticalCenter=!0;break;case "top":b.top=h;b.horizontalCenter=!0;a.top=b.top+b.pixelHeight+k;a.horizontalCenter=!0;break;case "bottom":b.bottom=h;
b.horizontalCenter=!0;a.bottom=b.bottom+k+b.pixelHeight;a.horizontalCenter=!0;break;default:b.horizontalCenter=!0,b.verticalCenter=!0,a.horizontalCenter=!0,a.verticalCenter=!0}}
function ud(a){a.log("_updateAutoSize");if(!1!==a.aa||!1!==a.Z){var b=a.G[a.W].Xa("padding",a.J);if(!0===a.aa){var d=a.pixelWidth;a.u=Math.max(a.i.x+a.i.pixelWidth,a.K.x+a.K.pixelWidth)-Math.min(a.i.x,a.K.x)+2*b+2*a.O;a.D="px";a.c.style.width=a.u+"px";d!==a.pixelWidth&&a.za({property:"autoWidth"})}!0===a.Z&&(d=a.pixelHeight,a.o=Math.max(a.i.y+a.i.pixelHeight,a.K.y+a.K.pixelHeight)-Math.min(a.i.y,a.K.y)+2*b+2*a.O,a.B="px",a.c.style.height=a.o+"px",d!==a.pixelHeight&&a.za({property:"autoHeight"}))}}
e.load=function(a){if("undefined"!==typeof a&&a){if(!0===g.L.Ma(a.skins,"ButtonSkin"))for(var b=0,d=a.skins.length;b<d;b++)this.qc(a.skins[b]);else if("object"===typeof a.skins&&0<a.skins.length)for(var d=0,h=a.skins.length;d<h;d++)b=new X(a.skins[d].name,a.skins[d].states),this.qc(b);g.L.V(a.skin,"ButtonSkin")?this.qc(a.skin):"object"===typeof a.skin&&(b=new X(a.skin.name,a.skin.states),this.qc(b));!0===g.L.V(a["default"],"string")&&!0===this.xj(a["default"])&&(this.da=a["default"])}a=this.G||{};
Object.keys(a).length||(b=new X("default"),this.qc(b));""===this.da&&(this.da=this.G[Object.keys(a)[0]].name);vd(this,this.da)};e.qc=function(a,b){if(!1===g.L.V(a,"ButtonSkin"))throw"KEN.Button: Invalid button skin!";a.mg(rd.Gb);this.G[a.name]=a;!0===b&&vd(this,a.name)};e.Wj=function(a){"string"===typeof a&&!0===g.L.V(this.G[a],"ButtonSkin")?vd(this,a):!0===g.L.V(a,"ButtonSkin")&&(this.G[a.name]===a?vd(this,a.name):"undefined"!==typeof this.G[a.name]&&null!==this.G[a.name]||this.qc(a,!0))};
e.xj=function(a){return"undefined"!==typeof this.G[a]};e.Nn=function(){this.G[this.W].mg(rd.Gb);vd(this,this.W)};
e.destroy=function(){this.j.i18n.onLocaleChangeComplete.remove(this.Rg,this);if("undefined"!==typeof this.G&&0<this.G.length)for(var a in this.G)this.G.hasOwnProperty(a)&&this.G[a].destroy();this.G={};this.K&&(this.K.onLoadComplete.remove(this.Ld,this),this.K.onResize.remove(this.Md,this),this.removeChild(this.K,!0),this.K=null);this.i&&(this.i.onLoadComplete.remove(this.Ld,this),this.i.onResize.remove(this.Md,this),this.removeChild(this.i,!0),this.i=null);u.prototype.destroy.call(this)};
Object.defineProperty(Bc.prototype,"skins",{get:function(){return this.G}});Object.defineProperty(Bc.prototype,"skin",{get:function(){return this.G[this.W]},set:function(a){this.Wj(a)}});Object.defineProperty(Bc.prototype,"autoWidth",{get:function(){return this.aa},set:function(a){"boolean"===typeof a&&(this.aa=a,ud(this))}});Object.defineProperty(Bc.prototype,"autoHeight",{get:function(){return this.Z},set:function(a){"boolean"===typeof a&&(this.Z=a,ud(this))}});
function X(a,b){this.i=a||"";this.f=g.L.rc(wd,{});this.c=g.L.rc(b||{},{out:{},over:{},down:{}});n.call(this,"ButtonSkin")}X.prototype=Object.create(n.prototype);X.prototype.constructor=X;
var xd={key:"",url:"",i18n:!1,keepRatio:!0,maximized:!1,alpha:1},yd={value:"",i18n:!1,color:"",fontFamily:"",fontWeight:""},zd={name:"",background:"",borderStyle:"solid",borderColor:"",borderRadius:0,borderWidth:0,autoWidth:!0,autoHeight:!0,align:"center",padding:0,spacing:0,first:"image",image:xd,label:yd},Ad={key:"",url:"",i18n:!1,keepRatio:!0,maximized:!1,alpha:1},Bd={value:"Button",i18n:!1,color:"",fontFamily:"",fontWeight:""},wd={name:"default",background:"#eee",borderStyle:"solid",borderColor:"#555",
borderRadius:5,borderWidth:2,autoWidth:!0,autoHeight:!0,align:"left",padding:5,spacing:0,first:"image",image:Ad,label:Bd};X.prototype.mg=function(a){"undefined"!==typeof this.c[a]&&(this.f=this.c[a])};X.prototype.Xa=function(a,b){b=g.L.be(this.c,b+"."+a,g.L.be(this.f,a,g.L.be(zd,a)));"object"===typeof b&&(b=g.L.rc(this.f[a],b));return b};X.prototype.wj=function(a){a=this.Xa("image",a);return"undefined"!==typeof a&&"string"===typeof a.url&&""!==a.url};
X.prototype.m=function(a){a=this.Xa("label",a);return"undefined"!==typeof a&&"string"===typeof a.value&&""!==a.value};Object.defineProperty(X.prototype,"name",{get:function(){return this.i}});Object.defineProperty(X.prototype,"default",{get:function(){return this.f},set:function(a){this.f=a}});Object.defineProperty(X.prototype,"out",{get:function(){return this.c.out},set:function(a){this.c.out=a}});
Object.defineProperty(X.prototype,"over",{get:function(){return this.c.over},set:function(a){this.c.over=a}});Object.defineProperty(X.prototype,"down",{get:function(){return this.c.down},set:function(a){this.c.down=a}});function ea(a){T.call(this,a,document.createElement("canvas"),"Canvas")}ea.prototype=Object.create(T.prototype);ea.prototype.constructor=ea;ea.prototype.Ja=function(){T.prototype.Ja.call(this);this.j.display.register(this);Xc(this);Yc(this)};
Object.defineProperty(ea.prototype,"context2D",{get:function(){return this.c.getContext("2d")}});Object.defineProperty(ea.prototype,"context3D",{get:function(){return this.c.getContext("webgl")}});Object.defineProperty(ea.prototype,"element",{get:function(){return this.c}});
function K(a,b,d,h,k){this.j=a;this.Bd=b;this.fc=d||null;this.G=null;this.Ad=h||g.Ea.Rb;this.mb="";this.K=null;this.J=this.C=-1;this.Ya=null;this.ub=!1;this.pb=null;this.gc=!1;this.nb=1;this.lb=!1;this.xc=0;this.Ob=null;this.Mb=k||!1;this.zd=[0,1,2,3];this.wc=!1;this.Ga=this.Z=this.Da=this.Fa=this.Ha=this.Oa=this.va=this.Sa=this.Ua=this.Ta=this.Wa=this.ka=this.ja=this.Ia=this.Pa=this.Ra=this.Ka=this.wa=this.xa=this.da=this.aa=this.ia=this.ya=this.qa=this.ra=this.oa=null;this.Nb=this.P=!1;this.Tc=
this.yc=0;this.hc=this.vc=this.i=this.Qb=this.yb=this.Fb=this.zb=this.Bb=this.Db=this.Ab=this.W=null;T.call(this,a,null,"VideoHTML5")}K.prototype=Object.create(T.prototype);e=K.prototype;e.constructor=K;
e.Ja=function(){T.prototype.Ja.call(this);!0===this.Mb&&!1===Cd(this)&&(this.log("KEN.VideoHTML5: can't manage ambisonic sound without Google Chrome Omnitone library and WebAudio API."),this.Mb=!1);this.S=this.Bd;aa(this);this.W=this.xm.bind(this);this.Ab=this.ym.bind(this);this.Db=this.Am.bind(this);this.Bb=this.zm.bind(this);this.zb=this.wm.bind(this);this.Fb=this.Bm.bind(this);this.yb=this.vm.bind(this);this.Qb=this.Cm.bind(this);this.i=this.nm.bind(this);this.Ya=this.j.clock.create(!1);this.pb=
this.j.clock.create(!1);this.pb.Se(500,this.xl,this);this.j.audio.onVolumeChange.add(this.Nh,this);this.j.audio.onDisable.add(this.Mh,this);this.Z=new p(this,!0);null!==this.fc&&this.load(this.fc);this.j.display.register(this,Cd(this));Xc(this);Yc(this)};e.za=function(a){var b=Dd(this);b&&null!==b.element&&(b.element.setAttribute("width",this.pixelWidth),b.element.setAttribute("height",this.pixelHeight));T.prototype.za.call(this,a)};
function Ed(a,b){for(var d,h=0,k=a.K.length;h<k;h++)if(d=a.K[h],d===b)return h;return-1}function Fd(a,b){return a.K?(a=a.K[b])&&"undefined"!==typeof a?a:null:null}function Gd(a){return Fd(a,a.C)}function Dd(a){return Fd(a,a.J)}function Hd(a,b){return(a=Dd(a))&&null!==a.element?a.element[b]:0}
function Id(a,b){if(-1!==b){a.log("_destroyVideoAt "+b);b=a.K[b];var d=b.element;if("undefined"!==typeof d&&null!==d){d.removeEventListener("loadstart",a.i,!1);d.removeEventListener("durationchange",a.i,!1);d.removeEventListener("loadedmetadata",a.i,!1);d.removeEventListener("loadeddata",a.i,!1);d.removeEventListener("progress",a.i,!1);d.removeEventListener("canplay",a.i,!1);d.removeEventListener("canplaythrough",a.i,!1);d.removeEventListener("play",a.i,!1);d.removeEventListener("pause",a.i,!1);d.removeEventListener("timeupdate",
a.i,!1);d.removeEventListener("volumechange",a.i,!1);d.removeEventListener("seeked",a.i,!1);d.removeEventListener("ended",a.i,!1);d.removeEventListener("error",a.i,!1);d.removeEventListener("waiting",a.i,!1);d.removeEventListener("stalled",a.i,!1);d.removeEventListener("suspend",a.i,!1);d.removeEventListener("playing",a.i,!1);d.removeEventListener("error",a.W,!1);d.pause();d.src="";for(var h,k=0,l=d.children.length;k<l;k++)h=d.children[k],h.removeEventListener("error",a.W,!1),h.src="",d.removeChild(h);
d.load();d.parentNode===a.c&&a.c.removeChild(d)}b.element=null;null!==b.buffer&&(b.buffer.destroy(),b.buffer=null);null!==b.played&&(b.played.destroy(),b.played=null)}}
function Jd(a,b,d){a.ub=d||!1;a.log("Requesting index: "+b+", force: "+a.ub);-1!==a.C&&a.C!==b&&Kd(a);d=b===a.C?!0:!1;a.C=b;a.Ha&&a.Ha.H(b);if(b!==a.J&&!0!==d){d=a.C;var h=document.createElement("video");h.setAttribute("webkit-playsinline","webkit-playsinline");h.setAttribute("width",a.pixelWidth);h.setAttribute("height",a.pixelHeight);h.volume=0;h.crossOrigin="anonymous";h.id="KEN-VideoHTML5-"+a.S+"-"+d;var k=new Ld(h,"buffered"),l=new Ld(h,"played");d=a.K[d];d.element=h;d.buffer=k;d.played=l;d.lastTimeStamp=
0;d.requestCount++;h=a.G[a.C];-1<a.J&&(d.element.addEventListener("loadstart",a.Ab,!1),d.element.addEventListener("error",a.W,!1));k=document.createElement("source");k.addEventListener("error",a.W,!1);k.src=h.url;k.type=h.mimeType;d.element.appendChild(k);a.vc=a.ei.bind(a);!0===Cd(a)?(a.f=a.j.audio.context,a.Ob=Omnitone.createFOADecoder(a.f,d.element,{channelMap:a.zd}),a.hc=a.Rl.bind(a),a.Ob.initialize().then(a.vc,a.hc)):a.ei();-1===a.J?(a.log("No current video, set directly the current index"),Md(a,
b)):(a.Ya.add(2E4,a.Lm,a),a.Ya.start())}}e.ei=function(){-1===this.C?Dd(this).element.load():Gd(this).element.load()};e.Rl=function(){this.log("FOA decoder could not be initialized")};e.ym=function(){var a=Gd(this).element;this.log("_onRequestLoadStart [readyState: "+a.readyState+"]");a.removeEventListener("loadstart",this.Ab,!1);a.addEventListener("loadedmetadata",this.Db,!1)};
e.Am=function(){var a=Gd(this).element;this.log("_onRequestLoadedMetaData [readyState: "+a.readyState+"]");a.removeEventListener("loadedmetadata",this.Db,!1);a.addEventListener("loadeddata",this.Bb,!1)};e.zm=function(){var a=Gd(this).element;this.log("_onRequestLoadedData [readyState: "+a.readyState+"]");a.removeEventListener("loadeddata",this.Bb,!1);!0===g.A.Oc?(a.addEventListener("play",this.zb,!1),a.play()):Md(this,this.C,!0)};
e.wm=function(){var a=Gd(this).element;this.log("_onRequestCanPlayBeforeSeek [readyState: "+a.readyState+"]");a.pause();a.removeEventListener("play",this.zb,!1);a.addEventListener("seeked",this.Fb,!1);var b=this.currentTime;a.currentTime=!0===this.P&&!1===this.ub?b+6:b};
e.Bm=function(){var a=Gd(this).element;this.log("_onRequestSeeked [readyState: "+a.readyState+"]");a.removeEventListener("seeked",this.Fb,!1);4===a.readyState?(a.removeEventListener("error",this.W,!1),Nd(this)):a.addEventListener("canplay",this.yb,!1)};e.vm=function(){var a=Gd(this).element;this.log("_onRequestCanPlayAfterSeek [readyState: "+a.readyState+"]");a.removeEventListener("canplay",this.yb,!1);a.removeEventListener("error",this.W,!1);Nd(this)};
function Nd(a){var b=Dd(a);b&&null!==b.element&&!1===a.ub&&(a.log("Current video listen to seek, wait both video to sync"),b.element.addEventListener("seeked",a.Qb,!1),a.Ya.Se(10,a.Tm,a));for(var b=Gd(a).element,d,h=0,k=b.children.length;h<k;h++)d=b.children[h],d.removeEventListener("error",a.W,!1);!0===a.ub&&Md(a,a.C)}e.Cm=function(){this.log("_onRequestSeekedWhileSync "+this.currentTime);var a=this.C;Od(this,!1);Jd(this,a)};
e.Tm=function(){this.log("_videoSyncTimerLoop "+this.C);var a=Gd(this);a&&this.currentTime>=a.element.currentTime&&this.currentTime<a.element.currentTime+.05&&Md(this,this.C)};e.Lm=function(){this.log("_requestTimeOutHandler");Od(this,!0)};e.xm=function(a){this.log("_onRequestError");this.log(a);Od(this,!0)};
function Md(a,b,d){if(b!==a.J){a.c.innerHTML="";var h=Gd(a);!0===a.P&&h.element.play();Pd(a,h);h=Dd(a);a.C=-1;a.J=b;b=Dd(a);b.currentCount++;!0===d&&h&&(b.element.currentTime=h.element.currentTime);d=b.element;d.addEventListener("loadstart",a.i,!1);d.addEventListener("durationchange",a.i,!1);d.addEventListener("loadedmetadata",a.i,!1);d.addEventListener("loadeddata",a.i,!1);d.addEventListener("progress",a.i,!1);d.addEventListener("canplay",a.i,!1);d.addEventListener("canplaythrough",a.i,!1);d.addEventListener("play",
a.i,!1);d.addEventListener("pause",a.i,!1);d.addEventListener("timeupdate",a.i,!1);d.addEventListener("volumechange",a.i,!1);d.addEventListener("seeked",a.i,!1);d.addEventListener("ended",a.i,!1);d.addEventListener("error",a.i,!1);d.addEventListener("waiting",a.i,!1);d.addEventListener("stalled",a.i,!1);d.addEventListener("suspend",a.i,!1);d.addEventListener("playing",a.i,!1);a.c.appendChild(b.element);h&&null!==h.element&&(h.element.removeEventListener("seeked",a.Qb,!1),d=Ed(a,h),-1!==d&&Id(a,d));
a.Ya.stop(!0);a.Fa&&a.Fa.H(a.J);""===a.mb&&Qd(a,a.Ad)}}
e.xl=function(){this.log("Auto quality timer loop");if(!1!==this.P&&-1===this.C){var a;a=Dd(this);var b=a.element.currentTime;!1===a.element.playing?a=!1:b===a.lastTimeStamp?(a.lastTimeStamp=0,a=!0):(a.lastTimeStamp=b,a=!1);!0===a?(this.log("AutoQuality downgrade quality"),Dd(this).leaveCount++,0<=this.J-1?Jd(this,this.J-1,!0):this.log("Can't downgrade video quality anymore!")):(a=Dd(this),!0===(a&&null!==a.buffer&&a.buffer.Ej(a.element.currentTime,6)?!0:!1)&&this.J!==this.G.length-1&&(a=this.J+1,
this.K[a].abortCount||this.K[a].leaveCount?this.log("AutoQuality do not attempt to load an already aborted video"):(this.log("AutoQuality upgrade quality"),Jd(this,a))))}};function Qd(a,b){!1===g.A.Oc&&(b=g.Ea.MANUAL,a.warn("Quality mode force to manual, you are not on desktop"));a.mb===b||b!==g.Ea.Rb&&b!==g.Ea.MANUAL||(a.mb=b,a.pb.stop(!1),a.mb===g.Ea.Rb&&a.pb.start(),a.Ga&&a.Ga.H(a.mb))}function Od(a,b){var d=Gd(a);d&&(!0===b&&d.abortCount++,Kd(a),a.Ya.stop(!0),a.Da&&a.Da.H())}
function Kd(a){var b=Gd(a),d;b&&(d=b.element,d.removeEventListener("loadstart",a.Ab,!1),d.removeEventListener("loadedmetadata",a.Db,!1),d.removeEventListener("loadeddata",a.Bb,!1),d.removeEventListener("play",a.zb,!1),d.removeEventListener("seeked",a.Fb,!1),d.removeEventListener("canplay",a.yb,!1),d.removeEventListener("error",a.W,!1),b=Ed(a,b),-1!==b&&Id(a,b),a.C=-1)}e.Nh=function(){Pd(this)};
function Pd(a,b){(b=b||Dd(a))&&null!==b.element&&!0===a.j.audio.enabled&&(b.element.volume=a.nb*a.j.audio.volume)}e.Mh=function(){var a=Dd(this);a&&null!==a.element&&!1===this.j.audio.enabled&&(a.element.volume=0)};
e.nm=function(a){var b=Dd(this).element;this.log(a.type+" [readyState: "+b.readyState+"]");switch(a.type){case "loadstart":this.oa&&this.oa.H(a);break;case "durationchange":this.ia&&1===b.readyState&&this.ia.H(a);break;case "loadedmetadata":this.wc=!0;this.ra&&this.ra.H(a);break;case "loadeddata":this.qa&&this.qa.H(a);break;case "progress":this.ya&&this.ya.H(a);break;case "canplay":this.Nb=!0;this.aa&&this.aa.H(a);break;case "canplaythrough":this.Nb=!0;this.da&&this.da.H(a);break;case "play":this.xa&&
this.xa.H(a);break;case "pause":this.P=!1;this.wa&&this.wa.H(a);break;case "timeupdate":this.Ka&&this.Ka.H(a);break;case "volumechange":this.Pa&&0!==b.readyState&&this.Pa.H(a);break;case "seeked":this.Nb=!1;this.Ia&&this.Ia.H(a);break;case "ended":this.P=!1;this.c.currentTime=0;this.Tc++;!0===this.gc&&this.play(0);this.ja&&this.ja.H(a);break;case "error":this.ka&&this.ka.H(a);break;case "waiting":this.Wa&&this.Wa.H(a);break;case "stalled":this.Ta&&this.Ta.H(a);break;case "suspend":this.Ua&&this.Ua.H(a);
break;case "playing":this.Sa&&this.Sa.H(a);break;default:this.warn('The event "'+a.type+'" is not handled.')}};function Cd(a){return!0===a.Mb&&!0===a.j.audio.useWebAudio&&"undefined"!==typeof Omnitone}e.update=function(){this.Ob&&!0===this.P&&this.Ob.setRotationMatrixFromCamera(this.j.renderer.camera.modelViewInverse)};
e.load=function(a){if(null!==a)if(!0===g.L.V(a,"string")?a=[a]:!0===g.L.V(a,"VideoQuality")&&(a=[a]),!0===g.L.Ma(a,"string")){for(var b=[],d,h=0,k=a.length;h<k;h++)d=new Rd(a[h]),b.push(d);this.G=b}else!0===g.L.Ma(a,"VideoQuality")&&(this.G=a);this.Z&&this.Z.H(this.G);if(!this.G||!this.G.length)throw"KEN.VideoHTML5.load: Can't create video with no qualities set!";a=this.G.length;b=[];for(h=0;h<a;h++)d={index:h,element:null,buffer:null,played:null,requestCount:0,currentCount:0,abortCount:0,leaveCount:0,
lastTimeStamp:0},b[h]=d;this.K=b;Jd(this,0)};e.play=function(a,b){this.currentTime=a;this.loop=b;(a=Dd(this))&&null!==a.element&&(a.element.play(),this.P=!0,this.yc++)};e.pause=function(){var a=Dd(this);a&&null!==a.element&&(a.element.pause(),this.P=!1)};e.stop=function(){var a=Dd(this);a&&null!==a.element&&(a.element.pause(),a.element.currentTime=0,this.P=!1)};e.rl=function(){!0===this.P||!1===this.j.audio.enabled?this.pause():this.play()};
e.mute=function(){!0!==this.lb&&!1!==this.j.audio.enabled&&(this.lb=!0,this.xc=this.nb,this.nb=0,Pd(this),this.va&&this.va.H())};e.Oh=function(a){!1!==this.lb&&(a="number"===typeof a?a:this.xc,this.lb=!1,this.nb=g.Math.fa(a,0,1),Pd(this),this.Oa&&this.Oa.H())};
e.destroy=function(){Kd(this);this.Ya.destroy();this.Ya=null;this.pb.destroy();this.pb=null;this.oa&&(this.oa.destroy(),this.oa=null);this.ra&&(this.ra.destroy(),this.ra=null);this.qa&&(this.qa.destroy(),this.qa=null);this.ya&&(this.ya.destroy(),this.ya=null);this.ia&&(this.ia.destroy(),this.ia=null);this.aa&&(this.aa.destroy(),this.aa=null);this.da&&(this.da.destroy(),this.da=null);this.xa&&(this.xa.destroy(),this.xa=null);this.wa&&(this.wa.destroy(),this.wa=null);this.Ka&&(this.Ka.destroy(),this.Ka=
null);this.Ra&&(this.Ra.destroy(),this.Ra=null);this.Pa&&(this.Pa.destroy(),this.Pa=null);this.Ia&&(this.Ia.destroy(),this.Ia=null);this.ja&&(this.ja.destroy(),this.ja=null);this.ka&&(this.ka.destroy(),this.ka=null);this.Wa&&(this.Wa.destroy(),this.Wa=null);this.Ta&&(this.Ta.destroy(),this.Ta=null);this.Ua&&(this.Ua.destroy(),this.Ua=null);this.Sa&&(this.Sa.destroy(),this.Sa=null);this.va&&(this.va.destroy(),this.va=null);this.Oa&&(this.Oa.destroy(),this.Oa=null);this.Ha&&(this.Ha.destroy(),this.Ha=
null);this.Fa&&(this.Fa.destroy(),this.Fa=null);this.Da&&(this.Da.destroy(),this.Da=null);this.Ga&&(this.Ga.destroy(),this.Ga=null);this.Z&&(this.Z.destroy(),this.Z=null);for(var a=0,b=this.K.length;a<b;a++)Id(this,a);this.i=this.Qb=this.yb=this.Fb=this.zb=this.Bb=this.Db=this.Ab=this.W=this.hc=this.vc=null;this.j.audio.onVolumeChange.remove(this.Nh,this);this.j.audio.onDisable.remove(this.Mh,this);this.K=this.G=this.fc=null;T.prototype.destroy.call(this)};
Object.defineProperty(K.prototype,"quality",{get:function(){return this.G[this.J]},set:function(a){if("number"===typeof a&&0<=a&&a<this.G.length)Qd(this,g.Ea.MANUAL),Jd(this,a);else if(!0===g.L.V(a,"VideoQuality")){a:{for(var b,d=0,h=this.G.length;d<h;d++)if(b=this.G[d],b===a){a=d;break a}a=-1}if(-1!==a)Qd(this,g.Ea.MANUAL),Jd(this,a);else throw"Unknown quality";}else throw"Video quality "+a+" out of bounds";}});
Object.defineProperty(K.prototype,"qualityMode",{get:function(){return this.mb},set:function(a){a!==g.Ea.Rb&&a!==g.Ea.MANUAL||Qd(this,a)}});Object.defineProperty(K.prototype,"qualities",{get:function(){return this.G}});Object.defineProperty(K.prototype,"requestIndex",{get:function(){return this.C}});Object.defineProperty(K.prototype,"currentIndex",{get:function(){return this.J}});Object.defineProperty(K.prototype,"videos",{get:function(){return this.K}});
Object.defineProperty(K.prototype,"element",{get:function(){var a=Dd(this);return a&&null!==a.element?a.element:null}});Object.defineProperty(K.prototype,"buffer",{get:function(){var a=Dd(this);return a&&null!==a.buffer?a.buffer:null}});Object.defineProperty(K.prototype,"played",{get:function(){var a=Dd(this);return a&&null!==a.played?a.played:null}});Object.defineProperty(K.prototype,"originalWidth",{get:function(){return Hd(this,"videoWidth")}});
Object.defineProperty(K.prototype,"originalHeight",{get:function(){return Hd(this,"videoHeight")}});Object.defineProperty(K.prototype,"currentTime",{get:function(){return Hd(this,"currentTime")},set:function(a){if("number"===typeof a){var b=Dd(this);b&&null!==b.element&&(b.element.currentTime=a,this.Ra&&this.Ra.H(a))}}});Object.defineProperty(K.prototype,"currentTimeMS",{get:function(){return 1E3*this.currentTime},set:function(a){this.currentTime=a/1E3}});
Object.defineProperty(K.prototype,"remainingTime",{get:function(){return this.duration-this.currentTime}});Object.defineProperty(K.prototype,"duration",{get:function(){return Hd(this,"duration")}});Object.defineProperty(K.prototype,"durationMS",{get:function(){return Math.round(1E3*this.duration)}});Object.defineProperty(K.prototype,"playing",{get:function(){return this.P}});Object.defineProperty(K.prototype,"playCount",{get:function(){return this.yc}});
Object.defineProperty(K.prototype,"canPlay",{get:function(){return this.Nb}});Object.defineProperty(K.prototype,"endCount",{get:function(){return this.Tc}});Object.defineProperty(K.prototype,"metaDataLoaded",{get:function(){return this.wc}});Object.defineProperty(K.prototype,"loop",{get:function(){return this.gc},set:function(a){"boolean"===typeof a&&(this.gc=a)}});
Object.defineProperty(K.prototype,"volume",{get:function(){return this.nb},set:function(a){"number"===typeof a&&(this.nb=g.Math.fa(a,0,1),this.lb=!1,Pd(this))}});Object.defineProperty(K.prototype,"muted",{get:function(){return this.lb},set:function(a){!0===!!a?this.mute():this.Oh()}});Object.defineProperty(K.prototype,"ambisonic",{get:function(){return this.Mb}});Object.defineProperty(K.prototype,"onLoadStart",{get:function(){this.oa||(this.oa=new p(this));return this.oa}});
Object.defineProperty(K.prototype,"onLoadedMetaData",{get:function(){this.ra||(this.ra=new p(this));return this.ra}});Object.defineProperty(K.prototype,"onLoadedData",{get:function(){this.qa||(this.qa=new p(this));return this.qa}});Object.defineProperty(K.prototype,"onProgress",{get:function(){this.ya||(this.ya=new p(this));return this.ya}});Object.defineProperty(K.prototype,"onDurationChange",{get:function(){this.ia||(this.ia=new p(this));return this.ia}});
Object.defineProperty(K.prototype,"onCanPlay",{get:function(){this.aa||(this.aa=new p(this));return this.aa}});Object.defineProperty(K.prototype,"onCanPlayThrough",{get:function(){this.da||(this.da=new p(this));return this.da}});Object.defineProperty(K.prototype,"onPlay",{get:function(){this.xa||(this.xa=new p(this));return this.xa}});Object.defineProperty(K.prototype,"onPause",{get:function(){this.wa||(this.wa=new p(this));return this.wa}});
Object.defineProperty(K.prototype,"onTimeUpdate",{get:function(){this.Ka||(this.Ka=new p(this));return this.Ka}});Object.defineProperty(K.prototype,"onCurrentTimeChange",{get:function(){this.Ra||(this.Ra=new p(this));return this.Ra}});Object.defineProperty(K.prototype,"onVolumeChange",{get:function(){this.Pa||(this.Pa=new p(this));return this.Pa}});Object.defineProperty(K.prototype,"onSeeked",{get:function(){this.Ia||(this.Ia=new p(this));return this.Ia}});
Object.defineProperty(K.prototype,"onEnded",{get:function(){this.ja||(this.ja=new p(this));return this.ja}});Object.defineProperty(K.prototype,"onError",{get:function(){this.ka||(this.ka=new p(this));return this.ka}});Object.defineProperty(K.prototype,"onWaiting",{get:function(){this.Wa||(this.Wa=new p(this));return this.Wa}});Object.defineProperty(K.prototype,"onStalled",{get:function(){this.Ta||(this.Ta=new p(this));return this.Ta}});
Object.defineProperty(K.prototype,"onSuspend",{get:function(){this.Ua||(this.Ua=new p(this));return this.Ua}});Object.defineProperty(K.prototype,"onPlaying",{get:function(){this.Sa||(this.Sa=new p(this));return this.Sa}});Object.defineProperty(K.prototype,"onMute",{get:function(){this.va||(this.va=new p(this));return this.va}});Object.defineProperty(K.prototype,"onUnmute",{get:function(){this.Oa||(this.Oa=new p(this));return this.Oa}});
Object.defineProperty(K.prototype,"onQualityRequest",{get:function(){this.Ha||(this.Ha=new p(this));return this.Ha}});Object.defineProperty(K.prototype,"onQualityChange",{get:function(){this.Fa||(this.Fa=new p(this));return this.Fa}});Object.defineProperty(K.prototype,"onQualityAbort",{get:function(){this.Da||(this.Da=new p(this));return this.Da}});Object.defineProperty(K.prototype,"onQualityModeChange",{get:function(){this.Ga||(this.Ga=new p(this));return this.Ga}});
Object.defineProperty(K.prototype,"onQualitiesLoaded",{get:function(){this.Z||(this.Z=new p(this,!0));return this.Z}});
function J(a,b,d,h){this.j=a;this.ul=b;this.vc=d||null;this.Ta="";this.Ha=null;this.mk=h||g.Ea.Rb;this.Ra="";this.i=null;this.Tc=!1;this.Oa=1;this.Fa=!1;this.Bd=0;this.Ad=!1;this.Ua=this.f=null;this.xc=this.wc=this.Ia=this.Sa=0;this.Ya=this.ya=this.gc=this.hc=null;this.Wa=this.Ga=!1;this.zd=this.Qg=0;this.Ab=this.yc=this.Mb=this.Nb=this.Pa=this.pb=this.Ob=this.fc=this.Qb=this.Bb=this.Db=this.mb=this.lb=this.nb=this.Fb=this.yb=this.zb=this.ub=this.Da=this.qa=this.C=this.Ka=this.oa=this.ra=this.W=this.P=
this.va=this.xa=this.wa=this.ia=this.ja=this.J=this.G=this.K=this.ka=this.aa=this.da=this.Z=null;T.call(this,a,null,"VideoDash")}J.prototype=Object.create(T.prototype);J.prototype.constructor=J;var Sd={VIDEO:"video",AUDIO:"audio"};e=J.prototype;
e.Ja=function(){T.prototype.Ja.call(this);if("undefined"===typeof dashjs)throw"KEN.VideoDash._boot: Can't create MPEG-DASH video stream without dash.js Media Player.";this.S=this.ul;aa(this);this.ub=this.pm.bind(this);this.nb=this.lm.bind(this);this.zb=this.ml.bind(this);this.yb=this.qm.bind(this);this.Fb=this.sm.bind(this);this.lb=this.km.bind(this);this.mb=this.kl.bind(this);this.Db=this.ol.bind(this);this.Bb=this.nl.bind(this);this.Qb=this.Gm.bind(this);this.fc=this.Jm.bind(this);this.Ob=this.Em.bind(this);
this.pb=this.ll.bind(this);this.Pa=this.mm.bind(this);this.Nb=this.um.bind(this);this.Mb=this.tm.bind(this);this.yc=this.Fm.bind(this);this.Ab=this.rm.bind(this);this.j.audio.onVolumeChange.add(this.Kh,this);this.j.audio.onDisable.add(this.Jh,this);this.C=new p(this,!0);null!==this.vc&&this.load(this.vc);this.j.display.register(this);Xc(this);Yc(this)};
e.za=function(a){var b=this.i;b&&null!==b.element&&(b.element.setAttribute("width",this.pixelWidth),b.element.setAttribute("height",this.pixelHeight));T.prototype.za.call(this,a)};function Td(a,b){return(a=a.i)&&null!==a.element?a.element[b]:0}
e.pm=function(a){this.log("onLoadStart [readyState: "+this.i.element.readyState+"]");var b=this.Ta,d=this.f.getBitrateInfoListFor(Sd.VIDEO),h=[],k;if(d){for(var l=0,q=d.length;l<q;l++)k=new Rd(b),k.id=d[l].qualityIndex,k.bitrate=d[l].bitrate,k.width=d[l].width,k.height=d[l].height,h.push(k);this.Ha=h;this.C&&this.C.H(h)}else this.destroy();this.Z&&this.Z.H(a)};e.Fm=function(a){this.log("_onSwitchCompleted [readyState: "+this.i.element.readyState+"]");this.Ua=a.toStreamInfo};
e.rm=function(a){this.log("_onMetricsChangedHandler [readyState: "+this.i.element.readyState+"]");this.hc||(this.hc=this.f.getMetricsFor(Sd.VIDEO));this.gc||(this.gc=this.f.getMetricsFor(Sd.AUDIO));this.ya||(this.ya=this.f.getDashMetrics());if(this.Da){var b;a.mediaType===Sd.VIDEO&&(b=Ud(this,Sd.VIDEO,this.hc,this.ya))&&(this.Ya={videoBitrate:b.bitrate,videoIndex:b.index,videoPendingIndex:b.Pj,videoMaxIndex:b.Jj,videoBufferLength:b.Si,videoDroppedFrames:b.droppedFrames});a.mediaType===Sd.AUDIO&&(b=
Ud(this,Sd.AUDIO,this.gc,this.ya))&&(this.Ya={audioBitrate:b.bitrate,audioIndex:b.index,audioPendingIndex:b.Pj,audioMaxIndex:b.Jj,audioBufferLength:b.Si,audioDroppedFrames:b.droppedFrames});this.Da.H(a)}};
function Ud(a,b,d,h){if(d&&h){var k=a.Ua.index,l,q,t,y,C,xb;(l=h.getCurrentRepresentationSwitch(d))&&(q=Math.round(h.getBandwidthForRepresentation(l.to,k)/1E3));if(isNaN(q)||void 0===q)q=0;b===Sd.VIDEO?(t=a.Sa+1,y=a.Ia+1):b===Sd.AUDIO&&(t=a.wc+1,y=a.xc+1);if(isNaN(t)||void 0===t)t=0;if(isNaN(y)||void 0===y)y=0;a=h.getMaxIndexForBufferType(b,k);if(isNaN(a)||void 0===a)a=0;b=h.getCurrentBufferLevel(d);null!==b&&(C=b.toPrecision(5));if(isNaN(C)||void 0===C)C=0;if(d=h.getCurrentDroppedFrames(d))xb=d.droppedFrames;
return{bitrate:q,index:t,Pj:y,Jj:a,Si:C,droppedFrames:xb}}return null}e.tm=function(a){this.log("onQualityChange [readyState: "+this.i.element.readyState+"]");a.mediaType===Sd.AUDIO?this.xc=this.wc=a.newQuality:a.mediaType===Sd.VIDEO&&(this.Ia=this.Sa=a.newQuality,this.oa&&this.oa.H(this.Ia))};
e.um=function(a){this.log("onQualityRequest [readyState: "+this.i.element.readyState+"]");a.mediaType===Sd.AUDIO?(this.wc=a.oldQuality,this.xc=a.newQuality):a.mediaType===Sd.VIDEO&&(this.Sa=a.oldQuality,this.Ia=a.newQuality,this.ra&&this.ra.H(this.Ia))};e.lm=function(a){var b=this.i.element;this.log("onDurationChange [readyState: "+b.readyState+"]");this.K&&1===b.readyState&&this.K.H(a)};
e.ml=function(a){this.log("onLoadedMetaData [readyState: "+this.i.element.readyState+"]");this.Ad=!0;this.da&&this.da.H(a)};e.qm=function(a){this.log("onLoadedData [readyState: "+this.i.element.readyState+"]");this.aa&&this.aa.H(a)};e.sm=function(a){this.ka&&this.ka.H(a)};e.km=function(a){this.log("onCanPlay [readyState: "+this.i.element.readyState+"]");this.Wa=!0;this.G&&this.G.H(a)};e.kl=function(a){this.log("onCanPlayThrough [readyState: "+this.i.element.readyState+"]");this.Wa=!0;this.J&&this.J.H(a)};
e.ol=function(a){this.log("onPlay [readyState: "+this.i.element.readyState+"]");this.ja&&this.ja.H(a)};e.nl=function(a){this.log("onPause [readyState: "+this.i.element.readyState+"]");this.Ga=!1;this.ia&&this.ia.H(a)};e.Gm=function(a){this.wa&&this.wa.H(a)};e.Jm=function(a){var b=this.i.element;this.log("onVolumeChange [readyState: "+b.readyState+"]");this.xa&&0!==b.readyState&&this.xa.H(a)};e.Em=function(a){this.log("onSeeked [readyState: "+this.i.element.readyState+"]");this.Wa=!1;this.va&&this.va.H(a)};
e.ll=function(a){this.log("onEnded [readyState: "+this.i.element.readyState+"]");this.Ga=!1;this.zd++;!0===this.Tc&&this.play();this.P&&this.P.H(a)};e.mm=function(a){this.log("onError [readyState: "+this.i.element.readyState+"]");this.W&&this.W.H(a)};e.Jh=function(){var a=this.i;a&&null!==a.element&&!1===this.j.audio.enabled&&this.f.setVolume(0)};e.Kh=function(){Vd(this)};
function Vd(a){var b=a.i;b&&null!==b.element&&!0===a.j.audio.enabled&&(a.f.setVolume(a.Oa*a.j.audio.volume),!0===a.Fa?a.f.setMute(!0):a.f.setMute(!1))}function Wd(a,b){a.Ia=b;if(a.Ua&&a.f&&!0===a.f.isReady()&&a.ya){var d=a.Ua.index,h=a.ya.getMaxIndexForBufferType(Sd.VIDEO,d),d=a.ya.getMaxIndexForBufferType(Sd.AUDIO,d),k=b;k>=h&&(k=h-1);0>k&&(k=0);b>=d&&(b=d-1);0>b&&(b=0);a.f.setQualityFor(Sd.VIDEO,k);a.f.setQualityFor(Sd.AUDIO,b)}Vd(a)}
function Xd(a,b){a.Ra===b||b!==g.Ea.Rb&&b!==g.Ea.MANUAL||(a.Ra=b,a.f&&!0===a.f.isReady()&&(b===g.Ea.MANUAL?(a.f.setAutoSwitchQualityFor(Sd.VIDEO,!1),a.f.setAutoSwitchQualityFor(Sd.AUDIO,!1)):(a.f.setAutoSwitchQualityFor(Sd.VIDEO,!0),a.f.setAutoSwitchQualityFor(Sd.AUDIO,!0))),a.qa&&a.qa.H(a.Ra))}
e.load=function(a){null!==a&&(!0===g.L.V(a,"string")?a=[a]:!0===g.L.V(a,"VideoQuality")&&(a=[a]),!0===g.L.Ma(a,"string")?this.Ta=a[0]:!0===g.L.Ma(a,"VideoQuality")&&(this.Ta=a[0].url));if(""===this.Ta)throw"KEN.VideoDash : Can't create video with no manifest!";this.i={index:0,element:null,buffer:null,played:null};a=document.createElement("video");a.setAttribute("webkit-playsinline","webkit-playsinline");a.setAttribute("width",this.pixelWidth);a.setAttribute("height",this.pixelHeight);a.volume=0;a.crossOrigin=
"anonymous";a.id="KEN-VideoDash-"+this.S;var b=new Ld(a,"buffered"),d=new Ld(a,"played"),h=this.i;h.element=a;h.buffer=b;h.played=d;h.lastTimeStamp=0;this.f=dashjs.MediaPlayer().create();this.f.getDebug().setLogToBrowserConsole(!1);this.f.initialize();this.f.setAutoPlay(!1);this.f.attachView(this.i.element);this.f.attachSource(this.Ta);!0===this.f.isReady()&&(this.f.on(dashjs.MediaPlayer.events.CAN_PLAY,this.lb),this.f.on(dashjs.MediaPlayer.events.ERROR,this.Pa),this.f.on(dashjs.MediaPlayer.events.PLAYBACK_ENDED,
this.pb),this.f.on(dashjs.MediaPlayer.events.PLAYBACK_ERROR,this.Pa),this.f.on(dashjs.MediaPlayer.events.PLAYBACK_METADATA_LOADED,this.zb),this.f.on(dashjs.MediaPlayer.events.PLAYBACK_PAUSED,this.Bb),this.f.on(dashjs.MediaPlayer.events.PLAYBACK_PROGRESS,this.Fb),this.f.on(dashjs.MediaPlayer.events.PLAYBACK_SEEKED,this.Ob),this.f.on(dashjs.MediaPlayer.events.PLAYBACK_STARTED,this.Db),this.f.on(dashjs.MediaPlayer.events.PLAYBACK_TIME_UPDATED,this.Qb),this.f.on(dashjs.MediaPlayer.events.QUALITY_CHANGE_RENDERED,
this.Mb),this.f.on(dashjs.MediaPlayer.events.QUALITY_CHANGE_REQUESTED,this.Nb),this.f.on(dashjs.MediaPlayer.events.STREAM_INITIALIZED,this.ub),this.f.on(dashjs.MediaPlayer.events.PERIOD_SWITCH_COMPLETED,this.yc),this.f.on(dashjs.MediaPlayer.events.METRIC_CHANGED,this.Ab),this.i.element.addEventListener("loadeddata",this.yb,!1),this.i.element.addEventListener("durationchange",this.nb,!1),this.i.element.addEventListener("canplaythrough",this.mb,!1),this.i.element.addEventListener("volumechange",this.fc,
!1),this.c.innerHTML="",this.c.appendChild(this.i.element));""===this.Ra&&Xd(this,this.mk)};e.play=function(a,b){this.currentTime=a;this.loop=b;this.f&&!0===this.f.isReady()&&(this.f.play(),this.Ga=!0,this.Qg++)};e.pause=function(){this.f&&!0===this.f.isReady()&&(this.f.pause(),this.Ga=!1)};e.stop=function(){this.f&&!0===this.f.isReady()&&(this.f.pause(),this.f.seek(0),this.i.element.currentTime=0,this.Ga=!1)};e.ql=function(){!0===this.Ga||!1===this.j.audio.enabled?this.pause():this.play()};
e.mute=function(){!0!==this.Fa&&!1!==this.j.audio.enabled&&(this.Fa=!0,this.Bd=this.Oa,this.Oa=0,Vd(this))};e.Lh=function(a){!1!==this.Fa&&(a="number"===typeof a?a:this.Bd,this.Fa=!1,this.Oa=g.Math.fa(a,0,1),Vd(this))};e.pl=function(a){this.f&&!0===this.f.isReady()&&this.f.enableBufferOccupancyABR(a)};
e.destroy=function(){this.log("_destroyVideo");this.f&&!0===this.f.isReady()&&(this.f.off(dashjs.MediaPlayer.events.CAN_PLAY,this.lb),this.f.off(dashjs.MediaPlayer.events.ERROR,this.Pa),this.f.off(dashjs.MediaPlayer.events.PLAYBACK_ENDED,this.pb),this.f.off(dashjs.MediaPlayer.events.PLAYBACK_ERROR,this.Pa),this.f.off(dashjs.MediaPlayer.events.PLAYBACK_METADATA_LOADED,this.zb),this.f.off(dashjs.MediaPlayer.events.PLAYBACK_PAUSED,this.Bb),this.f.off(dashjs.MediaPlayer.events.PLAYBACK_PROGRESS,this.Fb),
this.f.off(dashjs.MediaPlayer.events.PLAYBACK_SEEKED,this.Ob),this.f.off(dashjs.MediaPlayer.events.PLAYBACK_STARTED,this.Db),this.f.off(dashjs.MediaPlayer.events.PLAYBACK_TIME_UPDATED,this.Qb),this.f.off(dashjs.MediaPlayer.events.QUALITY_CHANGE_RENDERED,this.Mb),this.f.off(dashjs.MediaPlayer.events.QUALITY_CHANGE_REQUESTED,this.Nb),this.f.off(dashjs.MediaPlayer.events.STREAM_INITIALIZED,this.ub),this.f.off(dashjs.MediaPlayer.events.PERIOD_SWITCH_COMPLETED,this.yc),this.f.off(dashjs.MediaPlayer.events.METRIC_CHANGED,
this.Ab),this.i.element.removeEventListener("loadeddata",this.yb,!1),this.i.element.removeEventListener("durationchange",this.nb,!1),this.i.element.removeEventListener("canplaythrough",this.mb,!1),this.i.element.removeEventListener("volumechange",this.fc,!1),this.f.pause(),this.f.reset());var a=this.i,b=a.element;"undefined"!==typeof b&&null!==b&&b.parentNode===this.c&&this.c.removeChild(b);a.element=null;null!==a.buffer&&(a.buffer.destroy(),a.buffer=null);null!==a.played&&(a.played.destroy(),a.played=
null);this.Z&&(this.Z.destroy(),this.Z=null);this.da&&(this.da.destroy(),this.da=null);this.aa&&(this.aa.destroy(),this.aa=null);this.ka&&(this.ka.destroy(),this.ka=null);this.K&&(this.K.destroy(),this.K=null);this.G&&(this.G.destroy(),this.G=null);this.J&&(this.J.destroy(),this.J=null);this.ja&&(this.ja.destroy(),this.ja=null);this.ia&&(this.ia.destroy(),this.ia=null);this.wa&&(this.wa.destroy(),this.wa=null);this.xa&&(this.xa.destroy(),this.xa=null);this.va&&(this.va.destroy(),this.va=null);this.P&&
(this.P.destroy(),this.P=null);this.W&&(this.W.destroy(),this.W=null);this.ra&&(this.ra.destroy(),this.ra=null);this.oa&&(this.oa.destroy(),this.oa=null);this.Ka&&(this.Ka.destroy(),this.Ka=null);this.C&&(this.C.destroy(),this.C=null);this.qa&&(this.qa.destroy(),this.qa=null);this.Da&&(this.Da.destroy(),this.Da=null);this.Ab=this.Mb=this.Nb=this.Pa=this.pb=this.Ob=this.fc=this.Qb=this.Bb=this.Db=this.mb=this.lb=this.nb=this.Fb=this.yb=this.zb=this.ub=null;this.j.audio.onVolumeChange.remove(this.Kh,
this);this.j.audio.onDisable.remove(this.Jh,this);this.i=this.Ha=this.vc=this.Ua=this.Ya=this.ya=this.gc=this.hc=this.f=null;T.prototype.destroy.call(this)};Object.defineProperty(J.prototype,"monitoring",{get:function(){return this.Ya}});
Object.defineProperty(J.prototype,"quality",{get:function(){return this.Ha[this.Sa]},set:function(a){if("number"===typeof a&&0<=a&&a<this.Ha.length)Xd(this,g.Ea.MANUAL),Wd(this,a);else if(!0===g.L.V(a,"VideoQuality")){a:{for(var b,d=0,h=this.Ha.length;d<h;d++)if(b=this.Ha[d],b===a){a=d;break a}a=-1}if(-1!==a)Xd(this,g.Ea.MANUAL),Wd(this,a);else throw"Unknown quality";}else throw"Video quality "+a+" out of bounds";}});
Object.defineProperty(J.prototype,"qualityMode",{get:function(){return this.Ra},set:function(a){a!==g.Ea.Rb&&a!==g.Ea.MANUAL||Xd(this,a)}});Object.defineProperty(J.prototype,"qualities",{get:function(){return this.Ha}});Object.defineProperty(J.prototype,"requestIndex",{get:function(){return this.Ia}});Object.defineProperty(J.prototype,"currentIndex",{get:function(){return this.Sa}});Object.defineProperty(J.prototype,"video",{get:function(){return this.i}});
Object.defineProperty(J.prototype,"element",{get:function(){var a=this.i;return a&&null!==a.element?a.element:null}});Object.defineProperty(J.prototype,"buffer",{get:function(){var a=this.i;return a&&null!==a.buffer?a.buffer:null}});Object.defineProperty(J.prototype,"played",{get:function(){var a=this.i;return a&&null!==a.played?a.played:null}});Object.defineProperty(J.prototype,"originalWidth",{get:function(){return Td(this,"videoWidth")}});
Object.defineProperty(J.prototype,"originalHeight",{get:function(){return Td(this,"videoHeight")}});Object.defineProperty(J.prototype,"currentTime",{get:function(){return this.f.time()},set:function(a){"number"===typeof a&&this.f.seek(a)}});Object.defineProperty(J.prototype,"currentTimeMS",{get:function(){return 1E3*this.currentTime},set:function(a){this.currentTime=a/1E3}});Object.defineProperty(J.prototype,"remainingTime",{get:function(){return this.duration-this.currentTime}});
Object.defineProperty(J.prototype,"duration",{get:function(){return this.f.duration()}});Object.defineProperty(J.prototype,"durationMS",{get:function(){return Math.round(1E3*this.duration)}});Object.defineProperty(J.prototype,"playing",{get:function(){return this.Ga}});Object.defineProperty(J.prototype,"playCount",{get:function(){return this.Qg}});Object.defineProperty(J.prototype,"canPlay",{get:function(){return this.Wa}});Object.defineProperty(J.prototype,"endCount",{get:function(){return this.zd}});
Object.defineProperty(J.prototype,"metaDataLoaded",{get:function(){return this.Ad}});Object.defineProperty(J.prototype,"loop",{get:function(){return this.Tc},set:function(a){"boolean"===typeof a&&(this.Tc=a)}});Object.defineProperty(J.prototype,"volume",{get:function(){return this.Oa},set:function(a){"number"===typeof a&&(this.Oa=g.Math.fa(a,0,1),this.Fa=!1,Vd(this))}});Object.defineProperty(J.prototype,"muted",{get:function(){return this.Fa},set:function(a){!0===!!a?this.mute():this.Lh()}});
Object.defineProperty(J.prototype,"onLoadStart",{get:function(){this.Z||(this.Z=new p(this));return this.Z}});Object.defineProperty(J.prototype,"onLoadedMetaData",{get:function(){this.da||(this.da=new p(this));return this.da}});Object.defineProperty(J.prototype,"onLoadedData",{get:function(){this.aa||(this.aa=new p(this));return this.aa}});Object.defineProperty(J.prototype,"onProgress",{get:function(){this.ka||(this.ka=new p(this));return this.ka}});
Object.defineProperty(J.prototype,"onDurationChange",{get:function(){this.K||(this.K=new p(this));return this.K}});Object.defineProperty(J.prototype,"onCanPlay",{get:function(){this.G||(this.G=new p(this));return this.G}});Object.defineProperty(J.prototype,"onCanPlayThrough",{get:function(){this.J||(this.J=new p(this));return this.J}});Object.defineProperty(J.prototype,"onPlay",{get:function(){this.ja||(this.ja=new p(this));return this.ja}});
Object.defineProperty(J.prototype,"onPause",{get:function(){this.ia||(this.ia=new p(this));return this.ia}});Object.defineProperty(J.prototype,"onTimeUpdate",{get:function(){this.wa||(this.wa=new p(this));return this.wa}});Object.defineProperty(J.prototype,"onVolumeChange",{get:function(){this.xa||(this.xa=new p(this));return this.xa}});Object.defineProperty(J.prototype,"onSeeked",{get:function(){this.va||(this.va=new p(this));return this.va}});
Object.defineProperty(J.prototype,"onEnded",{get:function(){this.P||(this.P=new p(this));return this.P}});Object.defineProperty(J.prototype,"onError",{get:function(){this.W||(this.W=new p(this));return this.W}});Object.defineProperty(J.prototype,"onQualityRequest",{get:function(){this.ra||(this.ra=new p(this));return this.ra}});Object.defineProperty(J.prototype,"onQualityChange",{get:function(){this.oa||(this.oa=new p(this));return this.oa}});
Object.defineProperty(J.prototype,"onQualityAbort",{get:function(){this.Ka||(this.Ka=new p(this));return this.Ka}});Object.defineProperty(J.prototype,"onMetricsChanged",{get:function(){this.Da||(this.Da=new p(this));return this.Da}});Object.defineProperty(J.prototype,"onQualitiesLoaded",{get:function(){this.C||(this.C=new p(this,!0));return this.C}});Object.defineProperty(J.prototype,"onQualityModeChange",{get:function(){this.qa||(this.qa=new p(this));return this.qa}});
function Ld(a,b){this.c=a;this.f=b;n.call(this,"VideoTimeRanges")}Ld.prototype=Object.create(n.prototype);Ld.prototype.constructor=Ld;
Ld.prototype.i=function(a){var b=this.c[this.f];if(!this.length)return this.warn("No available range for now"),null;if(a>this.length-1)return this.warn("Time range out of bounds, returning the last available range"),this.i(this.length-1);if(0>a)return this.warn("Time range out of bounds, returning the first available range"),this.i(0);var d=b.start(a);a=b.end(a);return{start:d,end:a}};
Ld.prototype.Ej=function(a,b){"number"!==typeof b&&(b=0);for(var d=this.c[this.f],h,k,l=this.length;l--;)if(h=d.start(l),k=d.end(l),a>=h&&a+b<=k)return!0;return!1};Object.defineProperty(Ld.prototype,"length",{get:function(){return this.c[this.f].length}});function Rd(a){this.m="";this.i=a||"";this.o=this.c="";this.f=this.u=this.B=0;n.call(this,"VideoQuality")}Rd.prototype=Object.create(n.prototype);Rd.prototype.constructor=Rd;
function Yd(a){var b=["mp4","webm","ogg"];a=ya(a);if(""!==a.extension&&-1!==b.indexOf(a.extension))return"video/"+a.extension;b=["mpd"];return""!==a.extension&&-1!==b.indexOf(a.extension)?"application/dash+xml":""}Object.defineProperty(Rd.prototype,"id",{get:function(){return this.m},set:function(a){if("number"===typeof a||"string"===typeof a)this.m=a}});Object.defineProperty(Rd.prototype,"url",{get:function(){return this.i},set:function(a){"string"===typeof a&&(this.i=a)}});
Object.defineProperty(Rd.prototype,"mimeType",{get:function(){""===this.c&&""!==this.i&&(this.c=Yd(this.i));return this.c}});Object.defineProperty(Rd.prototype,"name",{get:function(){return this.o},set:function(a){"string"===typeof a&&(this.o=a)}});Object.defineProperty(Rd.prototype,"framerate",{get:function(){return 0}});Object.defineProperty(Rd.prototype,"bitrate",{get:function(){return this.B},set:function(a){"number"===typeof a&&(this.B=a)}});
Object.defineProperty(Rd.prototype,"width",{get:function(){return this.u},set:function(a){"number"===typeof a&&(this.u=a)}});Object.defineProperty(Rd.prototype,"height",{get:function(){return this.f},set:function(a){"number"===typeof a&&(this.f=a)}});Object.defineProperty(Rd.prototype,"speed",{get:function(){return 1}});g.Ea={};g.Ea.Rb="auto";g.Ea.MANUAL="manual";g.fb={};g.fb.De="dash";g.fb.lk="html5";g.fb.vl="unknown";
function jd(a){this.m=a;this.f={};this.c=null;this.i=[];n.call(this,"AnimationManager");!1===this.m.loaded&&this.m.onLoadComplete.ga(this.Pm,this)}jd.prototype=Object.create(n.prototype);e=jd.prototype;e.constructor=jd;e.Pm=function(){this.log("_spriteLoadComplete");for(var a,b,d=0,h=this.i.length;d<h;d++)a=this.i[d].method,b=this.i[d].args,jd.prototype[a].apply(this,b);this.i=[]};
e.add=function(a,b,d,h,k){if(!1===this.m.loaded)this.i.push({method:"add",args:arguments});else{this.log("add");"string"!==typeof a&&(a="default");b=parseInt(b,10);d=parseInt(d,10);var l=this.m.frames;if("number"!==typeof b||!0===isNaN(b)||0>b||b>=l.length)b=0;if("number"!==typeof d||!0===isNaN(d)||0>d||d>=l.length)d=l.length;k="undefined"===typeof k?!1:!!k;this.f[a]=new Y(this.m,a,l.slice(b,d),h||60);this.c=this.f[a]}};
e.play=function(a,b,d){if(!1===this.m.loaded)this.i.push({method:"play",args:arguments});else{var h=this.c;"string"===typeof a&&null!==a&&(h=this.get(a));h&&h.play(b,d)}};e.pause=function(a){var b=this.c;b&&b.pause(a)};e.resume=function(a){var b=this.c;b&&b.resume(a)};e.stop=function(){var a=this.c;a&&a.stop()};e.get=function(a){return!0===g.L.V(this.f[a],"Animation")?this.f[a]:null};e.update=function(){this.c&&this.c.update()};
e.destroy=function(){for(var a in this.f)this.f[a].destroy(),this.f[a]=null;this.i=this.c=this.f=this.m=null;n.prototype.destroy.call(this)};Object.defineProperty(jd.prototype,"currentAnimation",{get:function(){return this.c},set:function(a){!0===g.L.V(a,"Animation")&&(this.c=a)}});
function Y(a,b,d,h){this.C=a;this.P=b;this.F=d||[];this.O=0;this.X=h||60;this.K=!1;this.$=0;this.D=1E3/h;this.G=this.M=0;this.U=1;this.J=this.c=this.I=!1;this.f=this.B=this.i=this.u=this.m=this.o=null;n.call(this,"Animation")}Y.prototype=Object.create(n.prototype);e=Y.prototype;e.constructor=Y;function Zd(a,b){a.O="number"===typeof b&&0<=b&&b<a.F.length?b:0;a.C.frame=a.F[a.O].frame}
e.play=function(a,b){"boolean"===typeof a&&(this.K=a);this.I=!0;this.c=this.J=!1;this.$=0;this.M=this.C.viewer.clock.time+this.D;Zd(this,b);this.C.animations.currentAnimation=this;this.o&&this.o.H()};e.pause=function(a){!0!==this.c&&(this.c=!0,"number"===typeof a&&Zd(this,a),this.m&&this.m.H())};e.resume=function(a){!1!==this.c&&(this.c=!1,"number"===typeof a&&Zd(this,a),this.I&&(this.M=this.C.viewer.clock.time+this.D),this.u&&this.u.H())};
e.stop=function(){this.I=!1;this.J=!0;this.c=!1;Zd(this,0);this.B&&this.B.H()};e.update=function(){if(!0!==this.c){var a=this.C.viewer.clock.time;!0===this.I&&a>=this.M&&(this.U=1,this.G=a-this.M,this.G>this.D&&(this.U=Math.floor(this.G/this.D),this.G-=this.U*this.D),this.M=a+(this.D-this.G),a=this.O+this.U,a>=this.F.length?!0===this.K?(a%=this.F.length,this.$++,this.i&&this.i.H(),Zd(this,a)):(Zd(this,this.F.length-1),this.I=!1,this.J=!0,this.c=!1,this.f&&this.f.H()):Zd(this,a))}};
e.destroy=function(){this.F=this.C=null;this.o&&(this.o.destroy(),this.o=null);this.m&&(this.m.destroy(),this.m=null);this.u&&(this.u.destroy(),this.u=null);this.f&&(this.f.destroy(),this.f=null);this.i&&(this.i.destroy(),this.i=null);this.B&&(this.B.destroy(),this.B=null);n.prototype.destroy.call(this)};Object.defineProperty(Y.prototype,"name",{get:function(){return this.P}});Object.defineProperty(Y.prototype,"frames",{get:function(){return this.F}});
Object.defineProperty(Y.prototype,"frameIndex",{get:function(){return this.O}});Object.defineProperty(Y.prototype,"frameRate",{get:function(){return this.X},set:function(a){"number"===typeof a&&(this.X=a,this.D=1E3/this.X)}});Object.defineProperty(Y.prototype,"loop",{get:function(){return this.K},set:function(a){this.K=!!a}});Object.defineProperty(Y.prototype,"loopCount",{get:function(){return this.$}});Object.defineProperty(Y.prototype,"playing",{get:function(){return this.I}});
Object.defineProperty(Y.prototype,"paused",{get:function(){return this.c},set:function(a){!0===!!a?this.pause():this.resume()}});Object.defineProperty(Y.prototype,"complete",{get:function(){return this.J}});Object.defineProperty(Y.prototype,"onPlay",{get:function(){this.o||(this.o=new p(this));return this.o}});Object.defineProperty(Y.prototype,"onPause",{get:function(){this.m||(this.m=new p(this));return this.m}});
Object.defineProperty(Y.prototype,"onResume",{get:function(){this.u||(this.u=new p(this));return this.u}});Object.defineProperty(Y.prototype,"onLoop",{get:function(){this.i||(this.i=new p(this));return this.i}});Object.defineProperty(Y.prototype,"onComplete",{get:function(){this.f||(this.f=new p(this));return this.f}});Object.defineProperty(Y.prototype,"onStop",{get:function(){this.B||(this.B=new p(this));return this.B}});
function ra(a){this.j=a;this.S=new $d;this.m=new $d;this.f=new $d;this.c=new $d;this.i=0}var B={JSON:"json",ac:"xml",IMAGE:"image",xb:"sound"},ae={Uc:["ken"]};ae.JSON=["tour.config"].concat(ae.Uc);ae.ac=[].concat(ae.Uc);ae.IMAGE=[].concat(ae.Uc);ae.xb=[].concat(ae.Uc);function be(a,b){var d=null;switch(b){case B.JSON:d=a.S;break;case B.ac:d=a.m;break;case B.IMAGE:d=a.f;break;case B.xb:d=a.c}return d}
function ce(a,b,d){var h=be(a,b),k=(d||"ken-cache")+"-"+a.i;a.i++;return!1===h.has(k)&&!1===de(b,k)?k:ce(a,b,d)}function de(a,b){var d=null;switch(a){case B.JSON:d=ae.JSON;break;case B.ac:d=ae.ac;break;case B.IMAGE:d=ae.IMAGE;break;case B.xb:d=ae.xb}return(a=d)?-1!==a.indexOf(b.toLowerCase()):!1}e=ra.prototype;e.has=function(a,b){return(a=be(this,a))?a.has(b):!1};e.get=function(a,b){return!0===this.has(a,b)&&(a=be(this,a))?a.get(b):null};
e.add=function(a,b,d){var h;(h="string"!==typeof b||""===b)||(h=be(this,a),h=!0===(!0===de(a,b)&&!0===h.has(b)));h&&(b=ce(this,a,a+"-cache"));return!1===this.has(b,a)&&(a=be(this,a))?(a.set(b,d),!0):!1};e.remove=function(a,b){return!0===this.has(a,b)&&(a=be(this,a))?(a.Me(b),!0):!1};e.destroy=function(){this.c=this.f=this.S=this.j=null};function ee(){}e=ee.prototype;e.key="";e.url="";e.type="";e.data=null;e.Pn=null;e.Kb=!1;e.xk=!1;e.wk="";e.constructor=ee;
function sa(a){this.j=a;n.call(this,"Loader")}sa.prototype=Object.create(n.prototype);e=sa.prototype;e.constructor=sa;e.json=function(a,b,d,h,k,l){var q=new ee;q.type="json";q.key=a;q.url=b;q.c=d;q.f=h;q.S=k;q.i=l;fe(this,q,"text",this.Yl,this.Zl)};
e.Yl=function(a,b){if(b.responseText){if(a.data=Object(JSON.parse(b.responseText)),!1===this.j.cache.has(B.JSON,a.key)?this.j.cache.add(B.JSON,a.key,a):this.log("KEN.Loader.json : JSON file already exists"),"function"===typeof a.c&&null!==a.f){b=a.c;var d=a.f;a.c=null;a.f=null;a.S=null;a.i=null;b.call(d,a)}}else throw"KEN.Loader.json : JSON file empty ?";};
e.Zl=function(a,b){if(b.responseText){if("function"===typeof a.S&&null!==a.i){b=a.S;var d=a.i;a.c=null;a.f=null;a.S=null;a.i=null;b.call(d,a)}}else throw"KEN.Loader.json : JSON file empty ?";};e.Hk=function(a,b,d,h,k,l){k=new ee;k.type="xml";k.key=a;k.url=b;k.c=d;k.f=h;k.S=d;k.i=l;fe(this,k,"document",this.Um,this.Vm)};
e.Um=function(a,b){if(b.responseXML){if(a.data=b.responseXML,!1===this.j.cache.has(B.ac,a.key)?this.j.cache.add(B.ac,a.key,a):this.log("KEN.Loader.xml : XML file already exists"),"function"===typeof a.c&&null!==a.f){b=a.c;var d=a.f;a.c=null;a.f=null;a.S=null;a.i=null;b.call(d,a)}}else throw"KEN.Loader.xml : XML file empty ?";};
e.Vm=function(a,b){if(b.responseXML){if("function"===typeof a.S&&null!==a.i){b=a.S;var d=a.i;a.c=null;a.f=null;a.S=null;a.i=null;b.call(d,a)}}else throw"KEN.Loader.xml : JSON file empty ?";};e.sound=function(a,b,d,h,k){var l=new ee;l.type="sound";l.key=a;l.url=b;l.c=d;l.f=h;!0===this.j.audio.useWebAudio&&!0!==k?fe(this,l,"arraybuffer",this.Ei):!0!==this.j.audio.useAudioTag&&!0!==k||ge(l,this.Ei,this)};
e.Ei=function(a,b){!0===this.j.audio.useWebAudio&&"undefined"!==typeof b&&(a.data=b.response);this.j.cache.add(B.xb,a.key,a);"function"===typeof a.c&&null!==a.f&&a.c.call(a.f,a)};
function ge(a,b,d){function h(){a.data.removeEventListener(k,h,!1);a.data.onerror=null;"function"===typeof b&&b.call(d,a)}a.data=new Audio;a.data.preload="auto";a.data.crossOrigin="anonymous";a.data.src=a.url;var k="canplaythrough";a.data.onerror=function(){a.data.removeEventListener(k,h,!1);a.data.onerror=null;throw"KEN.Loader._loadAudioTag : Could not load "+a.url;};"undefined"===typeof a.data.oncanplaythrough&&(k="canplay");a.data.addEventListener(k,h,!1);a.data.load()}
function fe(a,b,d,h,k){b.Kb=!0;var l=new XMLHttpRequest;l.open("GET",b.url,!0);l.responseType=d;l.onreadystatechange=function(){if(l.readyState===XMLHttpRequest.DONE){if(200!==l.status&&l.status)throw"KEN.Loader._xhr : Could not load "+b.url;this.onreadystatechange=null;"function"===typeof h&&(b.loaded=!0,h.call(this,b,l))}}.bind(a);l.onerror=function(){"function"===typeof k&&k.call(this,b,l)}.bind(a);l.send()}
e.image=function(a,b,d,h){var k=new ee;k.type="image";k.key=a;k.url=b;k.data=new Image;k.data.crossOrigin="anonymous";k.data.onload=function(){k.data.onload=null;k.data.onerror=null;k.Kb=!1;k.loaded=!0;this.j.cache.add(B.IMAGE,k.key,k);d.call(h,k)}.bind(this);k.data.onerror=function(){k.data.onload=null;k.data.onerror=null;throw"ERROR : KEN.Loader.image, failed to load image key : "+a+" at url "+b;};k.data.src=k.url;k.Kb=!0};
e.lg=function(a,b,d){for(var h=document.getElementsByTagName("head")[0],k=h.getElementsByTagName("script"),l=0,q=k.length;l<q;l++)if(k[l].src===a){this.warn("Attempt to load an already loaded script!");b.call(d);return}var t=document.createElement("script");t.type="text/javascript";t.onload=function(){t.onload=null;b.call(d)};t.src=a;h.appendChild(t)};
e.Wi=function(a,b,d){var h=document.createElement("link");h.type="text/css";h.rel="stylesheet";"undefined"!==typeof b&&"undefined"!==typeof d&&(h.onload=function(){h.onload=null;b.call(d)});h.href=a;document.getElementsByTagName("head")[0].appendChild(h)};e.destroy=function(){this.j=null;n.prototype.destroy.call(this)};function fa(a){this.j=a;this.i=this.f=0;this.c=null;n.call(this,"DependencyManager")}fa.prototype=Object.create(n.prototype);fa.prototype.constructor=fa;
fa.prototype.add=function(a){"undefined"!==typeof a&&"string"===typeof a.url&&(this.f++,this.j.load.lg(a.url,this.m,this))};fa.prototype.m=function(){this.i++;this.f-this.i||(console.log("DependencyManager : all scripts loaded"),this.c&&this.c.H())};fa.prototype.destroy=function(){this.j=null;n.prototype.destroy.call(this)};Object.defineProperty(fa.prototype,"dependencies",{get:function(){return this.f}});
Object.defineProperty(fa.prototype,"onAllScriptsLoaded",{get:function(){this.c||(this.c=new p(this));return this.c}});function ga(a){this.j=a;this.f=0;this.c=null;n.call(this,"Clock");this.f=Date.now();this.c=[]}ga.prototype=Object.create(n.prototype);e=ga.prototype;e.constructor=ga;e.Hm=function(a){a:{if(this.c)for(var b,d=0,h=this.c.length;d<h;d++)if(b=this.c[d],b===a.emitter){a=d;break a}a=-1}-1!==a&&this.c.splice(a,1)};e.create=function(a){return this.add(new Z(this.j,a))};
e.add=function(a){this.c.push(a);a.onDestroy.add(this.Hm,this);return a};e.update=function(){this.f=Date.now();for(var a=0,b=this.c.length;a<b;a++)this.c[a].update(this.f)};e.destroy=function(){this.j=null;for(var a=this.c.length;a--;)this.c[a].destroy();this.c=null};Object.defineProperty(ga.prototype,"time",{get:function(){return this.f}});
function Z(a,b){this.j=a;this.K="undefined"!==typeof b?b:!0;this.C=0;this.i=!1;this.M=this.J=0;this.m=!1;this.f=0;this.G=!1;this.u=this.I=this.D=this.B=this.F=this.c=null;n.call(this,"Timer");this.c=[];this.f=Date.now()}Z.prototype=Object.create(n.prototype);e=Z.prototype;e.constructor=Z;function he(a,b){for(var d=0;d<a.c.length;d++){var h=a.c[d];if(!1===h.S){var k=h.c-b;0>k&&(k=0);h.c=a.f+k}}b=a.o-b;a.o=0>b?a.f:a.f+b}function ie(a){0<a.c.length&&(a.c.sort(a.Om),a.o=a.c[0].c)}
e.Om=function(a,b){return a.c<b.c?-1:a.c>b.c?1:0};e.create=function(a,b,d,h,k,l){var q=a=Math.round(a);this.f?q+=this.f:q+=this.j.clock.time;a=new je(0,a,q,d,b,h,k,l);this.c.push(a);ie(this);this.G=!1;return a};e.add=function(a,b,d,h){return this.create(a,!1,0,b,d,Array.prototype.splice.call(arguments,3))};e.fl=function(a,b,d,h){return this.create(a,!1,b,d,h,Array.prototype.splice.call(arguments,4))};e.Se=function(a,b,d){return this.create(a,!0,0,b,d,Array.prototype.splice.call(arguments,3))};
e.remove=function(a){for(var b=0;b<this.c.length;b++)if(this.c[b]===a)return this.c[b].S=!0;return!1};e.start=function(){if(!0!==this.i){this.C=this.j.clock.time;this.i=!0;for(var a,b=0;b<this.c.length;b++)a=this.c[b],a.c=a.f+this.C;this.F&&this.F.H()}};e.stop=function(a){this.i=!1;!1!==a&&(this.c.length=0);this.I&&this.I.H()};e.pause=function(){!1!==this.i&&!0!==this.m&&(this.J=this.j.clock.time,this.m=!0,this.B&&this.B.H())};
e.resume=function(){if(!1!==this.m){var a=this.j.clock.time;this.M+=a-this.f;this.f=a;he(this,this.J);this.m=!1;this.D&&this.D.H()}};
e.update=function(a){if(!0!==this.m){var b=a-this.f;this.f=a;1E3<b&&he(this,a-b);for(a=this.c.length;a--;)!0===this.c[a].S&&this.c.splice(a,1);a=this.c.length;var d=b=0;if(!0===this.i&&this.f>=this.o&&0<a){for(var h;b<a&&!0===this.i;)if(h=this.c[b],this.f>=h.c&&!1===h.S){var k=this.f+h.f-(this.f-h.c);0>k&&(k=this.f+h.f);!0===h.loop?h.c=k:0<h.i?(h.i--,h.c=k):(d++,h.S=!0);h.Ib();b++}else break;this.c.length>d?ie(this):(this.G=!0,this.i=!1,this.u&&this.u.H())}this.G&&this.K&&this.destroy()}};
e.destroy=function(){this.i=!1;this.c=[];n.prototype.destroy.call(this)};Object.defineProperty(Z.prototype,"autoDestroy",{get:function(){return this.K}});Object.defineProperty(Z.prototype,"running",{get:function(){return this.i}});Object.defineProperty(Z.prototype,"paused",{get:function(){return this.m}});Object.defineProperty(Z.prototype,"next",{get:function(){return this.o}});Object.defineProperty(Z.prototype,"duration",{get:function(){return this.i&&this.o>this.f?this.o-this.f:0}});
Object.defineProperty(Z.prototype,"length",{get:function(){return this.c.length}});Object.defineProperty(Z.prototype,"ms",{get:function(){return this.i?this.f-this.C-this.M:0}});Object.defineProperty(Z.prototype,"seconds",{get:function(){return this.i?.001*this.ms:0}});Object.defineProperty(Z.prototype,"onStart",{get:function(){this.F||(this.F=new p(this));return this.F}});Object.defineProperty(Z.prototype,"onPause",{get:function(){this.B||(this.B=new p(this));return this.B}});
Object.defineProperty(Z.prototype,"onResume",{get:function(){this.D||(this.D=new p(this));return this.D}});Object.defineProperty(Z.prototype,"onStop",{get:function(){this.I||(this.I=new p(this));return this.I}});Object.defineProperty(Z.prototype,"onComplete",{get:function(){this.u||(this.u=new p(this));return this.u}});function je(a,b,d,h,k,l,q,t){this.f=b;this.c=d;this.i=h-1;this.loop=k;this.o=l;this.u=q;this.m=t;this.S=!1}je.prototype.constructor=je;
je.prototype.Ib=function(){this.o.apply(this.u,this.m)};function Mb(a,b){this.j=a;this.c=b||[];n.call(this,"Timeline")}Mb.prototype=Object.create(n.prototype);e=Mb.prototype;e.constructor=Mb;e.mn=function(){return!!this.c&&0<this.c.length};e.md=function(a){for(var b=-1,d=this.c.length-1;0<=d;d--)if(a>=this.c[d].timestamp){b=d;break}return b===this.c.length-1?null:{previous:b,next:b+1}};
e.qj=function(a,b){var d=-1,h=-1;null!==a.previous&&(b=a.next,a=a.previous);if(!this.c.length)return null;Math.abs(a<this.c.length)&&(d=(a-1+this.c.length)%this.c.length);Math.abs(b<this.c.length)&&(h=(b+1+this.c.length)%this.c.length);return{previous:d,next:h}};e.hn=function(a){var b=this.md(a);return null===b.previous||null===b.next?0:(a-this.c[b.previous].timestamp)/(this.c[b.next].timestamp-this.c[b.previous].timestamp)};e.destroy=function(){this.c=this.j=null;n.prototype.destroy.call(this)};
Object.defineProperty(Mb.prototype,"keyframes",{get:function(){return this.c},set:function(a){g.L.Ma(a,"Keyframe")&&(this.c=a)}});function Pb(a,b){n.call(this,"Keyframe");this.c=a;this.Hb=b}Pb.prototype=Object.create(n.prototype);Pb.prototype.constructor=Pb;Object.defineProperty(Pb.prototype,"timestamp",{get:function(){return this.c},set:function(a){"number"===typeof a&&(this.c=a)}});function ta(a){this.j=a;this.c=[];n.call(this,"TweenManager")}ta.prototype=Object.create(n.prototype);e=ta.prototype;
e.constructor=ta;e.Sm=function(a){this.remove(a.emitter)};e.add=function(a){this.c.push(a);a.onDestroy.ga(this.Sm,this)};e.remove=function(a){a:{for(var b=0,d=this.c.length;b<d;b++)if(a===this.c[b]){a=b;break a}a=-1}-1!==a&&this.c.splice(a,1)};e.update=function(){for(var a=0,b=this.c.length;a<b;a++)this.c[a].update()};e.destroy=function(){for(var a=this.c.length;a--;)this.c[a].destroy();this.j=this.c=null;n.prototype.destroy.call(this)};
function vb(a,b){this.j=a;this.B=b;this.c=null;this.D=g.T.LINEAR;this.I=null;this.u=this.F=this.C=!1;this.o=this.f=this.i=this.m=null;n.call(this,"Tween")}vb.prototype=Object.create(n.prototype);e=vb.prototype;e.constructor=vb;e.Dd=function(a,b,d){this.c||(this.c={});for(var h in a)this.c[h]={name:h,min:null,max:a[h],duration:"number"===typeof b?b:0,easing:"function"===typeof d?d:null,started:!1,complete:!1,startTime:null};return this};
e.start=function(){this.I=Date.now();this.C=!0;this.u=this.F=!1;var a,b;for(b in this.c)a=this.c[b],a.min=this.B[b],a.max="string"===typeof this.c[b].max?a.min+parseInt(this.c[b].max,10):a.max,a.started=!0,a.startTime=this.I;this.m&&this.m.H();return this};e.stop=function(){this.F=!0;this.o&&this.o.H();return this};
e.update=function(){if(!1!==this.C&&!0!==this.u&&!0!==this.F){var a,b=0,d;for(d in this.c){a=this.c[d];if(!1===a.complete){var h=a,k=Date.now()-h.startTime;h.complete=k>=h.duration;!1===h.complete?(k=(null!==h.easing?h.easing:this.D)(k/h.duration),this.B[h.name]=k*(h.max-h.min)+h.min):this.B[h.name]=h.max}!1===a.complete&&b++}this.i&&this.i.H();b||(this.u=!0,this.f&&this.f.H())}};
e.destroy=function(){this.stop();this.D=this.c=this.B=this.j=null;this.m&&(this.m.destroy(),this.m=null);this.i&&(this.i.destroy(),this.i=null);this.f&&(this.f.destroy(),this.f=null);this.o&&(this.o.destroy(),this.o=null);n.prototype.destroy.call(this)};Object.defineProperty(vb.prototype,"easing",{get:function(){return this.D},set:function(a){"function"===typeof a&&(this.D=a)}});Object.defineProperty(vb.prototype,"complete",{get:function(){return this.u}});
Object.defineProperty(vb.prototype,"onStart",{get:function(){this.m||(this.m=new p(this));return this.m}});Object.defineProperty(vb.prototype,"onProgress",{get:function(){this.i||(this.i=new p(this));return this.i}});Object.defineProperty(vb.prototype,"onComplete",{get:function(){this.f||(this.f=new p(this));return this.f}});Object.defineProperty(vb.prototype,"onStop",{get:function(){this.o||(this.o=new p(this));return this.o}});g.T={};g.T.LINEAR=function(a){return g.Math.fa(a,0,1)};
g.T.nc=function(a){return g.Math.fa(1+Math.sin(Math.PI/2*(a-1)),0,1)};g.T.Wh=function(a){return g.Math.fa(.5*(1+Math.sin(Math.PI/2*(2*a-1))),0,1)};g.T.Dc=function(a){return g.Math.fa(Math.sin(Math.PI/2*a),0,1)};g.T.Sh=function(a){return g.Math.fa(a*a,0,1)};g.T.Th=function(a){return g.Math.fa(.5>a?2*a*a:1-2*(a-1)*(a-1),0,1)};g.T.Uh=function(a){a=1-a;return g.Math.fa(1-a*a,0,1)};g.T.Hg=function(a){return g.Math.fa(a*a*a,0,1)};
g.T.Ig=function(a){return g.Math.fa(.5>a?4*a*a*a:1+4*(a-1)*(a-1)*(a-1),0,1)};g.T.Jg=function(a){a=1-a;return g.Math.fa(1-a*a*a,0,1)};g.T.Ce=function(a){a<1/2.75?a*=7.5625*a:a<2/2.75?(a-=1.5/2.75,a=7.5625*a*a+.75):a<2.5/2.75?(a-=2.25/2.75,a=7.5625*a*a+.9375):(a-=2.625/2.75,a=7.5625*a*a+.984375);return g.Math.fa(a,0,1)};g.T.Fg=function(a){return 1-g.T.Ce(1-a)};g.L={};
g.L.eg=function(a){var b={value:null,Rc:null};if("string"===typeof a){var d=parseInt(a,10);!1===isNaN(d)&&(b.value=d);-1<a.indexOf("%")?b.Rc="%":-1<a.indexOf("px")&&(b.Rc="px")}return b};g.L.rc=function(a,b,d){var h={};a="undefined"!==typeof a?a:{};b="undefined"!==typeof b?b:{};for(var k in a)a.hasOwnProperty(k)&&(h[k]=a[k]);for(var l in b)b.hasOwnProperty(l)&&(h[l]=!1!==d&&a&&null!==b[l]&&"undefined"!==typeof b[l]&&b[l].constructor===Object?g.L.rc(a[l],b[l],!0):b[l]);return h};
g.L.ib=function(a){for(var b=arguments,d={},h=0,k=b.length;h<k;h++)d=g.L.rc(d,b[h],!0);return d};g.L.clone=function(a){if(!(a instanceof Object))return a;var b=new a.constructor,d;for(d in a)b[d]=g.L.clone(a[d]);return b};g.L.un=function(a){return a&&"object"===typeof a&&"string"===typeof a.className&&-1!==Wc.indexOf(a.className)?!0:!1};
g.L.V=function(a,b){if("string"===typeof b&&(null!==a&&"object"===typeof a&&"string"===typeof a.className&&a.className.toLowerCase()===b.toLowerCase()||typeof a===b.toLowerCase()))return!0;if(!0===Array.isArray(b)&&!0===g.L.Ma(b,"string"))for(var d=0,h=b.length;d<h;d++)if(!0===g.L.V(a,b[d]))return!0;return!1};g.L.xn=function(a,b,d){b=b.split(".");for(var h=0,k=b.length;h<k;h++){a=a[b[h]];if(h===k-1)return g.L.V(a,d);if("undefined"===typeof a)break}return!1};
g.L.Ma=function(a,b){if("object"===typeof a&&!0===Array.isArray(a)){for(var d=0,h=a.length;d<h;d++)if(!1===g.L.V(a[d],b))return!1;return!0}return!1};g.L.be=function(a,b,d){b=b.split(".");for(var h=0,k=b.length;h<k;h++){a=a[b[h]];if("undefined"===typeof a)break;if(h===k-1)return a}return d};g.L.Xj=function(a,b){var d=b.split("."),h=d.length;a.sort(function(a,b){for(var k=0;k<h;)a=a[d[k]],b=b[d[k]],k++;return a<b?-1:a>b?1:0});return a};
g.L.ud=function(a){a=a.slice();for(var b,d,h=a.length-1;0<h;h--)d=~~(Math.random()*(h+1)),b=a[h],a[h]=a[d],a[d]=b;return a};g.L.he=function(a,b,d){for(a=String(a);a.length<d;)a=b+a;return a};g.L.Oj=function(a){a={input:a,hours:0,minutes:0,seconds:0};if("number"!==typeof a.input||isNaN(a.input))return a;a.rn=parseInt(a.input/3600,10)%24;a.zn=parseInt(a.input/60,10)%60;a.seconds=parseInt(a.input%60,10);return a};
g.L.bn=function(a,b){a=g.L.Oj(a);var d="string"===typeof b?b:"H:M:S";b=0;-1!==d.indexOf("H")?b=2:-1!==d.indexOf("h")&&(b=1);var h=0;-1!==d.indexOf("M")?h=2:-1!==d.indexOf("m")&&(h=1);var k=0;-1!==d.indexOf("S")?k=2:-1!==d.indexOf("s")&&(k=1);d=d.toLowerCase();0<b&&(d=d.replace("h",g.L.he(a.rn,0,b)));0<h&&(d=d.replace("m",g.L.he(a.zn,0,h)));0<k&&(d=d.replace("s",g.L.he(a.seconds,0,k)));return d};g.L.qg=function(a,b,d){return new THREE.Spherical(a,Math.PI/2-d,b)};
g.L.en=function(a){return{radius:a.radius,theta:a.theta,phi:Math.PI/2-a.phi}};g.L.Ri=function(a,b){return a.filter(function(a){return 0>b.indexOf(a)})};g.L.endsWith=function(a,b){return"function"!==typeof String.prototype.endsWith?-1!==a.indexOf(b,a.length-b.length):a.endsWith(b)};g.la={};g.la.ld=function(a,b){var d=window.getComputedStyle(a,null).getPropertyValue("display");a.style.display="none";b=window.getComputedStyle(a,null).getPropertyValue(b);a.style.display=d;return b};
g.la.sj=function(a){a=g.la.ld(a,"width");var b="px";-1<a.indexOf("%")&&(b="%");-1<a.indexOf("px")&&(b="px");return b};g.la.uj=function(a){a=parseInt(g.la.ld(a,"width"),10);return isNaN(a)?0:a};g.la.rj=function(a){a=g.la.ld(a,"height");var b="px";-1<a.indexOf("%")&&(b="%");-1<a.indexOf("px")&&(b="px");return b};g.la.tj=function(a){a=parseInt(g.la.ld(a,"height"),10);return isNaN(a)?0:a};g.la.has=function(a){return document.body.contains(a)};g.la.Sf=function(a){return a instanceof HTMLElement};
g.la.gn=function(a){var b,d;d=["MouseEvent","PointerEvent","TouchEvent"];"object"===typeof a.srcEvent&&d.indexOf(a.srcEvent.constructor.toString())?(b=a.target.getBoundingClientRect(),d=a.srcEvent.clientX-b.left,a=a.srcEvent.clientY-b.top):(b=(a.currentTarget||a.target||a.srcElement).getBoundingClientRect(),d=a.clientX-b.left,a=a.clientY-b.top);return{x:d,y:a}};function $d(){this.f=0;this.c={}}e=$d.prototype;e.constructor=$d;
e.set=function(a,b){if("undefined"!==typeof a)return void 0===this.c[a]&&this.f++,this.c[a]=b,this.f};e.Me=function(a){if("undefined"!==typeof a&&void 0!==this.c[a])return delete this.c[a],--this.f};e.get=function(a){return this.c[a]};e.Jk=function(){var a=new zc,b;for(b in this.c)a.add(b);return a.ve()};e.Kk=function(){var a=new zc,b;for(b in this.c)a.add(this.c[b]);return a.ve()};e.Ik=function(){var a=new zc,b;for(b in this.c){var d=[];d.push(b);d.push(this.c[b]);a.add(d)}return a.ve()};
e.clear=function(){for(var a in this.c)this.Me(a)};e.has=function(a){return 0<this.f&&void 0!==this.c[a]};Object.defineProperty($d.prototype,"size",{get:function(){return this.f}});function zc(){this.c=[]}e=zc.prototype;e.constructor=zc;e.add=function(a){this.c.push(a);return this.c.length};e.remove=function(a){for(var b=0,d=this.c.length;b<d;b++)this.c[b]===a&&this.c.splice(b,1)};e.get=function(a){return this.c[a]};e.ve=function(){return this.c};Object.defineProperty(zc.prototype,"size",{get:function(){return this.c.length}});
function ke(a){this.i=a;this.c=this.F=this.f=this.B=this.u=this.D="";this.o=null;this.m="";n.call(this,"URL")}ke.prototype=Object.create(n.prototype);ke.prototype.constructor=ke;
function ya(a){var b=new ke;"string"!==typeof a&&(a=window.location.toString());b.i=a;a=document.createElement("a");a.href=b.i;b.D=a.protocol;b.u=a.hostname;b.B=a.port;b.f=a.pathname;b.F=a.search;b.c=a.hash;b.m=b.f.substr(b.f.lastIndexOf(".")+1);if(""!==b.c){a=b.c.replace("#","").split("&");var d={};d.slug=a[0];for(var h=1,k=a.length;h<k;h++){var l=a[h].split("=");d[l[0]]=decodeURIComponent(l[1])}b.o=d}return b}Object.defineProperty(ke.prototype,"url",{get:function(){return this.i}});
Object.defineProperty(ke.prototype,"protocol",{get:function(){return this.D}});Object.defineProperty(ke.prototype,"host",{get:function(){return this.u}});Object.defineProperty(ke.prototype,"port",{get:function(){return this.B}});Object.defineProperty(ke.prototype,"path",{get:function(){return this.f}});Object.defineProperty(ke.prototype,"query",{get:function(){return this.F}});Object.defineProperty(ke.prototype,"hash",{get:function(){return this.c}});
Object.defineProperty(ke.prototype,"hashParameters",{get:function(){return this.o}});Object.defineProperty(ke.prototype,"extension",{get:function(){return this.m}});g.Color={};g.Color.En=function(a,b,d){a/=255;b/=255;d/=255;var h=Math.max(a,b,d),k=Math.min(a,b,d),l,q=(h+k)/2;if(h===k)l=k=0;else{var t=h-k,k=.5<q?t/(2-h-k):t/(h+k);switch(h){case a:l=(b-d)/t+(b<d?6:0);break;case b:l=(d-a)/t+2;break;case d:l=(a-b)/t+4}l/=6}return{h:l,s:k,l:q}};
g.Color.sn=function(a,b,d){if(b){var h=.5>d?d*(1+b):d+b-d*b,k=2*d-h;d=g.Color.de(k,h,a+1/3);b=g.Color.de(k,h,a);a=g.Color.de(k,h,a-1/3)}else d=b=a=d;return{r:255*d,g:255*b,b:255*a}};g.Color.de=function(a,b,d){if(!(0>d||1<d)){if(d<1/6)return a+6*(b-a)*d;if(.5>d)return b;if(d<2/3)return a+(b-a)*(2/3-d)*6}return a};
g.Color.Fn=function(a,b,d){a/=255;b/=255;d/=255;var h=Math.max(a,b,d),k=Math.min(a,b,d),l,q=h-k;if(h===k)l=0;else{switch(h){case a:l=(b-d)/q+(b<d?6:0);break;case b:l=(d-a)/q+2;break;case d:l=(a-b)/q+4}l/=6}return{h:l,s:h?q/h:0,v:h}};
g.Color.tn=function(a,b,d){var h,k,l,q=Math.floor(6*a),t=6*a-q;a=d*(1-b);var y=d*(1-t*b);b=d*(1-(1-t)*b);switch(q%6){case 0:h=d;k=b;l=a;break;case 1:h=y;k=d;l=a;break;case 2:h=a;k=d;l=b;break;case 3:h=a;k=y;l=d;break;case 4:h=b;k=a;l=d;break;case 5:h=d,k=a,l=y}return{r:255*h,g:255*k,b:255*l}};g.Color.Vd=function(a){a=a.toString(16);return 1===a.length?"0"+a:a};g.Color.Dn=function(a,b,d){return"#"+g.Color.Vd(a)+g.Color.Vd(b)+g.Color.Vd(d)};
g.Color.cn=function(a){a=a.split("(")[1].split(")")[0].split(",");var b={r:parseInt(a[0],10),g:parseInt(a[1],10),b:parseInt(a[2],10)};3<a.length&&(b.a=parseInt(a[3],10));return b};g.Color.qn=function(a){a=a.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(a,d,h,k){return d+d+h+h+k+k});return(a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a))?{r:parseInt(a[1],16),g:parseInt(a[2],16),b:parseInt(a[3],16)}:null};
g.Color.Gn=function(a){a=new THREE.Vector3(a.r,a.g,a.b);var b=(new THREE.Matrix3).set(.299,.587,.114,-.169,-.331,.5,.5,-.419,-.081),d=new THREE.Vector3(0,128,128);a.applyMatrix3(b).add(d);return{Y:a.x,Cr:a.y,Cb:a.z}};g.Color.Rn=function(a){a=new THREE.Vector3(a.Y,a.Cr,a.Cb);var b=new THREE.Vector3(0,-128,-128),d=(new THREE.Matrix3).set(1,0,1.4,1,-.343,-.711,1,1.765,0);a.add(b).applyMatrix3(d);return{r:a.x,g:a.y,b:a.z}};
g.Color.Qn=function(a,b){var d=g.Math.ca(b);b=Math.cos(d);d=Math.sin(d);return{Y:a.Y,Cb:a.Cb*b-a.Cr*d,Cr:a.Cb*d+a.Cr*b}};g.Color.distance=function(a,b){return Math.sqrt((a.Cb-b.Cb)*(a.Cb-b.Cb)+(a.Cr-b.Cr)*(a.Cr-b.Cr))};function Na(a,b,d,h){this.alpha=h}window.KEN=g;window.KEN.BaseObject=n;window.KEN.Viewer=r;window.KEN.Tags=g.eb;window.KEN.UID=g.R;window.KEN.Tour=w;window.KEN.Group=F;window.KEN.Scene=E;window.KEN.Rectangle=Ba;window.KEN.Size=Ca;window.KEN.Object3D=G;window.KEN.ObjectRenderer=Da;
window.KEN.Raycaster=pa;window.KEN.Media=Oa;window.KEN.RenderManager=x;window.KEN.RenderScene=Ha;window.KEN.RenderPipeline=Pa;window.KEN.RenderDisplay=Qa;window.KEN.RenderParams=eb;window.KEN.BackgroundRenderer=fb;window.KEN.BackgroundMeshRenderer=Va;window.KEN.BackgroundShaderRenderer=Ua;window.KEN.PostProcessing=oa;window.KEN.ShaderPass=hb;window.KEN.ViewBase=ib;window.KEN.ViewGoPro=Xa;window.KEN.ViewRectilinear=Wa;window.KEN.HotspotManager=la;window.KEN.Hotspot3D=jb;window.KEN.HotspotSound=ob;
window.KEN.HotspotMaterial=mb;window.KEN.HotspotTransform=kb;window.KEN.HotspotAnimation=lb;window.KEN.Camera=L;window.KEN.CameraAnimation=Lb;window.KEN.CameraWaypoint=Kb;window.KEN.ControllerManager=ka;window.KEN.ControllerBase=Ub;window.KEN.ControllerPointer=Sb;window.KEN.ControllerKeyboard=Tb;window.KEN.SoundManager=v;window.KEN.Sound=H;window.KEN.Playlist=N;window.KEN.PlaylistManager=z;window.KEN.PlaylistTrack=O;window.KEN.Director=na;window.KEN.DirectorTrack=lc;
window.KEN.ActionEventDispatcher=pb;window.KEN.Action=nc;window.KEN.ActionManager=ma;window.KEN.Plugin=P;window.KEN.PluginEngine=sc;window.KEN.PluginManager=A;window.KEN.PluginObjectFactory=Q;window.KEN.Device=g.A;window.KEN.RequestAnimationFrame=ha;window.KEN.History=ja;window.KEN.EventDispatcher=p;window.KEN.Event=Gc;window.KEN.Listener=Ec;window.KEN.LocaleManager=ia;window.KEN.LocaleString=D;window.KEN.Locale=Ic;window.KEN.Keyboard=qa;window.KEN.KeyBinding=M;window.KEN.Drag=Oc;
window.KEN.Pointer=U;window.KEN.GazeBase=yb;window.KEN.DisplayList=da;window.KEN.DisplayObject=T;window.KEN.DisplayObjectContainer=u;window.KEN.Image=I;window.KEN.ImageScalable=ub;window.KEN.Sprite=Ac;window.KEN.Iframe=kd;window.KEN.TextField=R;window.KEN.Button=Bc;window.KEN.ButtonSkin=X;window.KEN.Canvas=ea;window.KEN.VideoHTML5=K;window.KEN.VideoDash=J;window.KEN.VideoTimeRanges=Ld;window.KEN.VideoQuality=Rd;window.KEN.AnimationManager=jd;window.KEN.Animation=Y;window.KEN.Cache=ra;
window.KEN.File=ee;window.KEN.Loader=sa;window.KEN.DependencyManager=fa;window.KEN.Clock=ga;window.KEN.Timer=Z;window.KEN.TimerEvent=je;window.KEN.Timeline=Mb;window.KEN.Keyframe=Pb;window.KEN.TweenManager=ta;window.KEN.Tween=vb;window.KEN.Map=$d;window.KEN.Collection=zc;window.KEN.URL=ke;window.KEN.ColorRGBA=Na;n.prototype.log=n.prototype.log;n.prototype.warn=n.prototype.warn;n.prototype.destroy=n.prototype.destroy;r.prototype.update=r.prototype.update;r.prototype.pause=r.prototype.pause;
r.prototype.resume=r.prototype.resume;r.prototype.destroy=r.prototype.destroy;w.prototype.boot=w.prototype.boot;w.prototype.load=w.prototype.load;w.prototype.hasScenes=w.prototype.hl;w.prototype.hasGroups=w.prototype.sc;w.prototype.nextScene=w.prototype.il;w.prototype.previousScene=w.prototype.jl;w.prototype.notifySceneConfigLoadComplete=w.prototype.Mj;w.prototype.loadScene=w.prototype.sd;w.prototype.loadGroup=w.prototype.Gj;w.prototype.destroy=w.prototype.destroy;F.prototype.load=F.prototype.load;
F.prototype.hasChild=F.prototype.Ie;F.prototype.hasScene=F.prototype.Pc;F.prototype.hasGroup=F.prototype.nd;F.prototype.hasChildren=F.prototype.ln;F.prototype.hasTypeOfChild=F.prototype.Of;F.prototype.hasScenes=F.prototype.Je;F.prototype.hasGroups=F.prototype.sc;F.prototype.getChildrenUids=F.prototype.kd;F.prototype.getChildren=F.prototype.$d;F.prototype.nextScene=F.prototype.yk;F.prototype.previousScene=F.prototype.zk;F.prototype.destroy=F.prototype.destroy;E.prototype.load=E.prototype.load;
E.prototype.unload=E.prototype.xe;E.prototype.hasGroup=E.prototype.nd;E.prototype.hasGroups=E.prototype.sc;E.prototype.destroy=E.prototype.destroy;G.prototype.click=G.prototype.click;G.prototype.over=G.prototype.lh;G.prototype.out=G.prototype.kh;G.prototype.destroy=G.prototype.destroy;Da.prototype.register=Da.prototype.register;Da.prototype.unregister=Da.prototype.unregister;Da.prototype.createRenderScenes=Da.prototype.Vi;Da.prototype.getRaycastable=Da.prototype.oj;Da.prototype.getByMesh=Da.prototype.lj;
Da.prototype.clear=Da.prototype.clear;Da.prototype.destroy=Da.prototype.destroy;pa.prototype.click=pa.prototype.click;Oa.prototype.destroy=Oa.prototype.destroy;x.prototype.render=x.prototype.render;x.prototype.screenToWorld=x.prototype.screenToWorld;x.prototype.worldToScreen=x.prototype.worldToScreen;x.prototype.enableVR=x.prototype.dl;x.prototype.setView=x.prototype.wd;x.prototype.destroy=x.prototype.destroy;Ha.prototype.setSize=Ha.prototype.setSize;Ha.prototype.destroy=Ha.prototype.destroy;
Pa.prototype.addBackground=Pa.prototype.Li;Pa.prototype.addRenderScenes=Pa.prototype.Ni;Pa.prototype.addGlobalFx=Pa.prototype.Mi;Pa.prototype.getShaderPassByUID=Pa.prototype.jn;Pa.prototype.setSize=Pa.prototype.setSize;Pa.prototype.render=Pa.prototype.render;Pa.prototype.clear=Pa.prototype.clear;Pa.prototype.destroy=Pa.prototype.destroy;Qa.prototype.enableVR=Qa.prototype.Ah;Qa.prototype.getQuaternionFromPose=Qa.prototype.nj;Qa.prototype.getRenderParams=Qa.prototype.pj;Qa.prototype.setSize=Qa.prototype.setSize;
Qa.prototype.submitFrame=Qa.prototype.Bh;Qa.prototype.destroy=Qa.prototype.destroy;fb.prototype.updateAfterViewChange=fb.prototype.ic;fb.prototype.setSize=fb.prototype.setSize;fb.prototype.render=fb.prototype.render;fb.prototype.destroy=fb.prototype.destroy;Va.prototype.render=Va.prototype.render;Va.prototype.updateAfterViewChange=Va.prototype.ic;Va.prototype.destroy=Va.prototype.destroy;Ua.prototype.render=Ua.prototype.render;Ua.prototype.updateAfterViewChange=Ua.prototype.ic;
Ua.prototype.destroy=Ua.prototype.destroy;oa.prototype.parseShaderPasses=oa.prototype.qe;oa.prototype.getFxSetByUID=oa.prototype.ae;oa.prototype.addConfig=oa.prototype.na;oa.prototype.destroy=oa.prototype.destroy;hb.prototype.render=hb.prototype.render;hb.prototype.destroy=hb.prototype.destroy;ib.prototype.backgroundShaderSTW=ib.prototype.Mc;ib.prototype.backgroundShaderWTS=ib.prototype.Nc;ib.prototype.updateScreenToWorld=ib.prototype.Sc;ib.prototype.worldToScreen=ib.prototype.worldToScreen;
ib.prototype.screenToWorld=ib.prototype.screenToWorld;ib.prototype.destroy=ib.prototype.destroy;Xa.prototype.backgroundShaderSTW=Xa.prototype.Mc;Xa.prototype.backgroundShaderWTS=Xa.prototype.Nc;Xa.prototype.updateScreenToWorld=Xa.prototype.Sc;Xa.prototype.worldToScreen=Xa.prototype.worldToScreen;Xa.prototype.screenToWorld=Xa.prototype.screenToWorld;Xa.prototype.destroy=Xa.prototype.destroy;Wa.prototype.backgroundShaderSTW=Wa.prototype.Mc;Wa.prototype.backgroundShaderWTS=Wa.prototype.Nc;
Wa.prototype.updateScreenToWorld=Wa.prototype.Sc;Wa.prototype.worldToScreen=Wa.prototype.worldToScreen;Wa.prototype.screenToWorld=Wa.prototype.screenToWorld;Wa.prototype.destroy=Wa.prototype.destroy;la.prototype.boot=la.prototype.boot;la.prototype.getByType=la.prototype.fn;la.prototype.addConfig=la.prototype.na;la.prototype.addTracks=la.prototype.Oi;la.prototype.update=la.prototype.update;la.prototype.clear=la.prototype.clear;la.prototype.destroy=la.prototype.destroy;jb.prototype.update=jb.prototype.update;
jb.prototype.destroy=jb.prototype.destroy;ob.prototype.load=ob.prototype.load;ob.prototype.update=ob.prototype.update;ob.prototype.destroy=ob.prototype.destroy;mb.prototype.load=mb.prototype.load;mb.prototype.update=mb.prototype.update;mb.prototype.destroy=mb.prototype.destroy;kb.prototype.computeSizeFromAnglesAndMaterial=kb.prototype.o;kb.prototype.load=kb.prototype.load;kb.prototype.destroy=kb.prototype.destroy;lb.prototype.load=lb.prototype.load;lb.prototype.play=lb.prototype.play;
lb.prototype.pause=lb.prototype.pause;lb.prototype.resume=lb.prototype.resume;lb.prototype.stop=lb.prototype.stop;lb.prototype.destroy=lb.prototype.destroy;L.prototype.load=L.prototype.load;L.prototype.lookAt=L.prototype.Ij;L.prototype.update=L.prototype.update;L.prototype.destroy=L.prototype.destroy;Lb.prototype.play=Lb.prototype.play;Lb.prototype.resume=Lb.prototype.resume;Lb.prototype.update=Lb.prototype.update;Lb.prototype.stop=Lb.prototype.stop;Lb.prototype.destroy=Lb.prototype.destroy;
ka.prototype.notifyControlStart=ka.prototype.me;ka.prototype.notifyControlEnd=ka.prototype.le;ka.prototype.update=ka.prototype.update;ka.prototype.addConfig=ka.prototype.na;ka.prototype.destroy=ka.prototype.destroy;Ub.prototype.enable=Ub.prototype.enable;Ub.prototype.disable=Ub.prototype.Zb;Ub.prototype.destroy=Ub.prototype.destroy;Sb.prototype.enable=Sb.prototype.enable;Sb.prototype.disable=Sb.prototype.Zb;Sb.prototype.update=Sb.prototype.update;Sb.prototype.destroy=Sb.prototype.destroy;
Tb.prototype.enable=Tb.prototype.enable;Tb.prototype.disable=Tb.prototype.Zb;Tb.prototype.update=Tb.prototype.update;Tb.prototype.destroy=Tb.prototype.destroy;v.prototype.boot=v.prototype.boot;v.prototype.addConfig=v.prototype.na;v.prototype.update=v.prototype.update;v.prototype.add=v.prototype.add;v.prototype.remove=v.prototype.remove;v.prototype.autoSuspend=v.prototype.zf;v.prototype.autoResume=v.prototype.yf;v.prototype.mute=v.prototype.mute;v.prototype.unmute=v.prototype.Fh;
v.prototype.destroy=v.prototype.destroy;H.prototype.update=H.prototype.update;H.prototype.play=H.prototype.play;H.prototype.stop=H.prototype.stop;H.prototype.pause=H.prototype.pause;H.prototype.resume=H.prototype.resume;H.prototype.mute=H.prototype.mute;H.prototype.unmute=H.prototype.Qe;H.prototype.destroy=H.prototype.destroy;N.prototype.hasTracks=N.prototype.Wk;N.prototype.play=N.prototype.play;N.prototype.stop=N.prototype.stop;N.prototype.pause=N.prototype.pause;N.prototype.resume=N.prototype.resume;
N.prototype.nextTrack=N.prototype.td;N.prototype.previousTrack=N.prototype.re;N.prototype.destroy=N.prototype.destroy;z.prototype.boot=z.prototype.boot;z.prototype.addConfig=z.prototype.na;z.prototype.add=z.prototype.add;z.prototype.addTrack=z.prototype.nh;z.prototype.hasPlaylists=z.prototype.nn;z.prototype.hasTracks=z.prototype.Qk;z.prototype.play=z.prototype.play;z.prototype.stop=z.prototype.stop;z.prototype.pause=z.prototype.pause;z.prototype.resume=z.prototype.resume;z.prototype.nextTrack=z.prototype.td;
z.prototype.previousTrack=z.prototype.re;z.prototype.destroy=z.prototype.destroy;O.prototype.play=O.prototype.play;O.prototype.stop=O.prototype.stop;O.prototype.pause=O.prototype.pause;O.prototype.resume=O.prototype.resume;O.prototype.destroy=O.prototype.destroy;na.prototype.addConfig=na.prototype.na;na.prototype.play=na.prototype.play;na.prototype.stop=na.prototype.stop;na.prototype.destroy=na.prototype.destroy;lc.prototype.play=lc.prototype.play;lc.prototype.resume=lc.prototype.resume;
lc.prototype.update=lc.prototype.update;lc.prototype.stop=lc.prototype.stop;lc.prototype.destroy=lc.prototype.destroy;pb.prototype.addActions=pb.prototype.c;pb.prototype.dispatch=pb.prototype.H;pb.prototype.destroy=pb.prototype.destroy;nc.prototype.execute=nc.prototype.Ib;nc.prototype.destroy=nc.prototype.destroy;ma.prototype.get=ma.prototype.get;ma.prototype.addConfig=ma.prototype.na;ma.prototype.destroy=ma.prototype.destroy;P.prototype.instantiate=P.prototype.Cj;
P.prototype.notifyInstanceReady=P.prototype.Bn;P.prototype.update=P.prototype.update;P.prototype.resetInstance=P.prototype.Sj;P.prototype.destroy=P.prototype.destroy;sc.prototype.load=sc.prototype.load;sc.prototype.getNewInstance=sc.prototype.mj;sc.prototype.destroy=sc.prototype.destroy;A.prototype.boot=A.prototype.boot;A.prototype.addConfig=A.prototype.na;A.prototype.getById=A.prototype.Zd;A.prototype.getByIndex=A.prototype.kj;A.prototype.get=A.prototype.get;A.prototype.remove=A.prototype.remove;
A.prototype.update=A.prototype.update;A.prototype.render=A.prototype.render;A.prototype.destroy=A.prototype.destroy;Q.prototype.string=Q.prototype.Kn;Q.prototype.textField=Q.prototype.Ln;Q.prototype.sound=Q.prototype.sound;Q.prototype.displayObjectContainer=Q.prototype.an;Q.prototype.displayObject=Q.prototype.Zk;Q.prototype.image=Q.prototype.image;Q.prototype.sprite=Q.prototype.In;Q.prototype.button=Q.prototype.Yk;Q.prototype.video=Q.prototype.al;Q.prototype.canvas=Q.prototype.canvas;
Q.prototype.tween=Q.prototype.$k;Q.prototype.destroyAllObjects=Q.prototype.$i;Q.prototype.destroy=Q.prototype.destroy;ha.prototype.boot=ha.prototype.boot;ha.prototype.start=ha.prototype.start;ha.prototype.stop=ha.prototype.stop;ha.prototype.destroy=ha.prototype.destroy;ja.prototype.addConfig=ja.prototype.na;ja.prototype.destroy=ja.prototype.destroy;p.prototype.add=p.prototype.add;p.prototype.addOnce=p.prototype.ga;p.prototype.remove=p.prototype.remove;p.prototype.has=p.prototype.has;
p.prototype.dispatch=p.prototype.H;p.prototype.destroy=p.prototype.destroy;Ec.prototype.execute=Ec.prototype.Ib;Ec.prototype.detach=Ec.prototype.ih;Ec.prototype.destroy=Ec.prototype.destroy;ia.prototype.addConfig=ia.prototype.na;ia.prototype.getValue=ia.prototype.dc;ia.prototype.hasValue=ia.prototype.Eb;ia.prototype.destroy=ia.prototype.destroy;D.prototype.destroy=D.prototype.destroy;Ic.prototype.addConfig=Ic.prototype.na;Ic.prototype.loadFiles=Ic.prototype.Xf;Ic.prototype.getValue=Ic.prototype.dc;
Ic.prototype.hasValue=Ic.prototype.Eb;Ic.prototype.getKey=Ic.prototype.jh;Ic.prototype.destroy=Ic.prototype.destroy;qa.prototype.update=qa.prototype.update;qa.prototype.isKeyPressed=qa.prototype.vn;qa.prototype.isKeyOut=qa.prototype.Uf;qa.prototype.addBinding=qa.prototype.wf;qa.prototype.removeBinding=qa.prototype.te;qa.prototype.hasBinding=qa.prototype.kn;qa.prototype.getBindings=qa.prototype.Kf;qa.prototype.destroy=qa.prototype.destroy;M.prototype.hasKeyIn=M.prototype.ce;M.prototype.hasKeyOut=M.prototype.Nf;
M.prototype.down=M.prototype.hh;M.prototype.waitToHold=M.prototype.On;M.prototype.up=M.prototype.dk;M.prototype.hold=M.prototype.zj;M.prototype.destroy=M.prototype.destroy;Oc.prototype.enable=Oc.prototype.enable;Oc.prototype.disable=Oc.prototype.eh;Oc.prototype.destroy=Oc.prototype.destroy;U.prototype.enable=U.prototype.enable;U.prototype.disable=U.prototype.Oe;U.prototype.destroy=U.prototype.destroy;yb.prototype.start=yb.prototype.start;yb.prototype.stop=yb.prototype.stop;yb.prototype.update=yb.prototype.update;
yb.prototype.destroy=yb.prototype.destroy;da.prototype.register=da.prototype.register;da.prototype.unregister=da.prototype.unregister;da.prototype.update=da.prototype.update;da.prototype.destroy=da.prototype.destroy;T.prototype.show=T.prototype.$g;T.prototype.hide=T.prototype.yj;T.prototype.toggleVisibility=T.prototype.Mn;T.prototype.maximize=T.prototype.Lb;T.prototype.isInDom=T.prototype.rd;T.prototype.resize=T.prototype.Zg;T.prototype.fullscreenEnter=T.prototype.gj;T.prototype.fullscreenExit=T.prototype.hj;
T.prototype.isFullscreen=T.prototype.qd;T.prototype.destroy=T.prototype.destroy;u.prototype.update=u.prototype.update;u.prototype.addChild=u.prototype.cc;u.prototype.addChildAt=u.prototype.Wm;u.prototype.fitToContent=u.prototype.fj;u.prototype.removeChild=u.prototype.removeChild;u.prototype.removeChildAt=u.prototype.fg;u.prototype.empty=u.prototype.Yg;u.prototype.hasChild=u.prototype.vk;u.prototype.destroy=u.prototype.destroy;I.prototype.load=I.prototype.load;I.prototype.unload=I.prototype.xe;
I.prototype.destroy=I.prototype.destroy;ub.prototype.destroy=ub.prototype.destroy;Ac.prototype.play=Ac.prototype.play;Ac.prototype.pause=Ac.prototype.pause;Ac.prototype.resume=Ac.prototype.resume;Ac.prototype.stop=Ac.prototype.stop;Ac.prototype.update=Ac.prototype.update;Ac.prototype.destroy=Ac.prototype.destroy;kd.prototype.load=kd.prototype.load;kd.prototype.destroy=kd.prototype.destroy;R.prototype.load=R.prototype.load;R.prototype.destroy=R.prototype.destroy;Bc.prototype.load=Bc.prototype.load;
Bc.prototype.addSkin=Bc.prototype.qc;Bc.prototype.setSkin=Bc.prototype.Wj;Bc.prototype.hasSkin=Bc.prototype.xj;Bc.prototype.updateSkin=Bc.prototype.Nn;Bc.prototype.destroy=Bc.prototype.destroy;X.prototype.setDefaultFromState=X.prototype.mg;X.prototype.getProperty=X.prototype.Xa;X.prototype.hasImage=X.prototype.wj;X.prototype.hasLabel=X.prototype.m;K.prototype.update=K.prototype.update;K.prototype.load=K.prototype.load;K.prototype.play=K.prototype.play;K.prototype.pause=K.prototype.pause;
K.prototype.stop=K.prototype.stop;K.prototype.togglePlayback=K.prototype.rl;K.prototype.mute=K.prototype.mute;K.prototype.unmute=K.prototype.Oh;K.prototype.destroy=K.prototype.destroy;J.prototype.load=J.prototype.load;J.prototype.play=J.prototype.play;J.prototype.pause=J.prototype.pause;J.prototype.stop=J.prototype.stop;J.prototype.togglePlayback=J.prototype.ql;J.prototype.mute=J.prototype.mute;J.prototype.unmute=J.prototype.Lh;J.prototype.enableBufferOccupancyABR=J.prototype.pl;
J.prototype.destroy=J.prototype.destroy;Ld.prototype.getTimeRange=Ld.prototype.i;Ld.prototype.isInRanges=Ld.prototype.Ej;jd.prototype.add=jd.prototype.add;jd.prototype.play=jd.prototype.play;jd.prototype.pause=jd.prototype.pause;jd.prototype.resume=jd.prototype.resume;jd.prototype.stop=jd.prototype.stop;jd.prototype.get=jd.prototype.get;jd.prototype.update=jd.prototype.update;jd.prototype.destroy=jd.prototype.destroy;Y.prototype.play=Y.prototype.play;Y.prototype.pause=Y.prototype.pause;
Y.prototype.resume=Y.prototype.resume;Y.prototype.stop=Y.prototype.stop;Y.prototype.update=Y.prototype.update;Y.prototype.destroy=Y.prototype.destroy;ra.prototype.has=ra.prototype.has;ra.prototype.get=ra.prototype.get;ra.prototype.add=ra.prototype.add;ra.prototype.remove=ra.prototype.remove;ra.prototype.destroy=ra.prototype.destroy;ee.prototype.key=ee.prototype.key;ee.prototype.url=ee.prototype.url;ee.prototype.type=ee.prototype.type;ee.prototype.data=ee.prototype.data;ee.prototype.xhr=ee.prototype.Pn;
ee.prototype.loading=ee.prototype.Kb;ee.prototype.loaded=ee.prototype.xk;ee.prototype.error=ee.prototype.wk;sa.prototype.json=sa.prototype.json;sa.prototype.xml=sa.prototype.Hk;sa.prototype.sound=sa.prototype.sound;sa.prototype.image=sa.prototype.image;sa.prototype.script=sa.prototype.lg;sa.prototype.css=sa.prototype.Wi;sa.prototype.destroy=sa.prototype.destroy;fa.prototype.add=fa.prototype.add;fa.prototype.destroy=fa.prototype.destroy;ga.prototype.create=ga.prototype.create;ga.prototype.add=ga.prototype.add;
ga.prototype.update=ga.prototype.update;ga.prototype.destroy=ga.prototype.destroy;Z.prototype.create=Z.prototype.create;Z.prototype.add=Z.prototype.add;Z.prototype.repeat=Z.prototype.fl;Z.prototype.loop=Z.prototype.Se;Z.prototype.remove=Z.prototype.remove;Z.prototype.start=Z.prototype.start;Z.prototype.stop=Z.prototype.stop;Z.prototype.pause=Z.prototype.pause;Z.prototype.resume=Z.prototype.resume;Z.prototype.update=Z.prototype.update;Z.prototype.destroy=Z.prototype.destroy;je.prototype.execute=je.prototype.Ib;
Mb.prototype.hasKeyframes=Mb.prototype.mn;Mb.prototype.getKeyframesFromTime=Mb.prototype.md;Mb.prototype.getSideKeyframes=Mb.prototype.qj;Mb.prototype.getNormalizedTime=Mb.prototype.hn;Mb.prototype.destroy=Mb.prototype.destroy;ta.prototype.add=ta.prototype.add;ta.prototype.remove=ta.prototype.remove;ta.prototype.update=ta.prototype.update;ta.prototype.destroy=ta.prototype.destroy;vb.prototype.to=vb.prototype.Dd;vb.prototype.start=vb.prototype.start;vb.prototype.stop=vb.prototype.stop;
vb.prototype.update=vb.prototype.update;vb.prototype.destroy=vb.prototype.destroy;$d.prototype.set=$d.prototype.set;$d.prototype["delete"]=$d.prototype.Me;$d.prototype.get=$d.prototype.get;$d.prototype.keys=$d.prototype.Jk;$d.prototype.values=$d.prototype.Kk;$d.prototype.entries=$d.prototype.Ik;$d.prototype.clear=$d.prototype.clear;$d.prototype.has=$d.prototype.has;zc.prototype.add=zc.prototype.add;zc.prototype.remove=zc.prototype.remove;zc.prototype.get=zc.prototype.get;zc.prototype.toArray=zc.prototype.ve;
window.KEN.Math=g.Math;g.Math.degToRad=g.Math.ca;g.Math.radToDeg=g.Math.Pb;g.Math.round10=g.Math.vd;g.Math.clamp=g.Math.fa;g.Math.wrap=g.Math.uc;g.Math.mix=g.Math.An;g.Math.smoothStep=g.Math.Hn;g.Math.rotationMatrixToEuler=g.Math.hg;g.Math.eulerToRotationMatrix=g.Math.Xd;window.KEN.Quaternion=g.Quaternion;g.Quaternion.toEuler=g.Quaternion.we;g.Quaternion.fromEuler=g.Quaternion.Jb;g.Quaternion.toRotationMatrix=g.Quaternion.$j;g.Quaternion.fromRotationMatrix=g.Quaternion.dn;
g.Quaternion.cancelRoll=g.Quaternion.cancelRoll;g.Quaternion.diffBetweenQuaternions=g.Quaternion.$m;g.Quaternion.angularDistance=g.Quaternion.Ud;g.Quaternion.multiplyScalar=g.Quaternion.multiplyScalar;g.Quaternion.add=g.Quaternion.add;g.Quaternion.log=g.Quaternion.log;g.Quaternion.exp=g.Quaternion.exp;g.Quaternion.slerp=g.Quaternion.slerp;g.Quaternion.squad=g.Quaternion.Jn;g.Quaternion.nlerpNoInvert=g.Quaternion.Lj;g.Quaternion.slerpNoInvert=g.Quaternion.ue;g.Quaternion.squadNoInvert=g.Quaternion.Yj;
g.Quaternion.spline=g.Quaternion.og;g.ShaderLib.parseIncludes=g.ShaderLib.pe;X.isValid=function(a){return a?!0:!1};Rd.mimeTypeFromURL=Yd;window.KEN.Easing=g.T;g.T.LINEAR=g.T.LINEAR;g.T.SINE_IN=g.T.nc;g.T.SINE_IN_OUT=g.T.Wh;g.T.SINE_OUT=g.T.Dc;g.T.QUAD_IN=g.T.Sh;g.T.QUAD_IN_OUT=g.T.Th;g.T.QUAD_OUT=g.T.Uh;g.T.CUBIC_IN=g.T.Hg;g.T.CUBIC_IN_OUT=g.T.Ig;g.T.CUBIC_OUT=g.T.Jg;g.T.BOUNCE_OUT=g.T.Ce;g.T.BOUNCE_IN=g.T.Fg;window.KEN.Utils=g.L;g.L.parseSizeString=g.L.eg;g.L.extendSimpleObject=g.L.rc;
g.L.extendMultipleObjects=g.L.ib;g.L.clone=g.L.clone;g.L.isDisplayObject=g.L.un;g.L.isTypeOf=g.L.V;g.L.isTypeOfRecursive=g.L.xn;g.L.isArrayOf=g.L.Ma;g.L.getObjectProperty=g.L.be;g.L.sortArrayByProperty=g.L.Xj;g.L.randomize=g.L.ud;g.L.leftFill=g.L.he;g.L.parseTime=g.L.Oj;g.L.formatTime=g.L.bn;g.L.toTHREESpherical=g.L.qg;g.L.fromTHREESpherical=g.L.en;g.L.arrayByDifference=g.L.Ri;g.L.endsWith=g.L.endsWith;window.KEN.Dom=g.la;g.la.getCssProperty=g.la.ld;g.la.getUnitWidth=g.la.sj;g.la.getValueWidth=g.la.uj;
g.la.getUnitHeight=g.la.rj;g.la.getValueHeight=g.la.tj;g.la.has=g.la.has;g.la.isHtmlElement=g.la.Sf;g.la.getMouseEventOffset=g.la.gn;ke.parse=ya;ke.exists=function(a,b,d,h){var k=new XMLHttpRequest,l=null;k.onreadystatechange=function(){4===this.readyState&&200===this.status&&(clearTimeout(l),"function"===typeof b&&b.call(h))};k.onerror=function(a){console.log(a)};k.open("HEAD",a);k.send();l=window.setTimeout(function(){"function"===typeof d&&d.call(h)},500)};
ke.isValid=function(a){return/((([A-Za-z]{3,9}:(?:\/\/)?)(?:[\-;:&=\+\$,\w]+@)?[A-Za-z0-9\.\-]+|(?:www\.|[\-;:&=\+\$,\w]+@)[A-Za-z0-9\.\-]+)((?:\/[\+~%\/\.\w\-]*)?\??(?:[\-\+=&;%@\.\w]*)#?(?:[\.\!\/\\\w]*))?)/.test(a)?!0:!1};window.KEN.Color=g.Color;g.Color.rgbToHsl=g.Color.En;g.Color.hslToRgb=g.Color.sn;g.Color.hueToRgb=g.Color.de;g.Color.rgbToHsv=g.Color.Fn;g.Color.hsvToRgb=g.Color.tn;g.Color.componentToHex=g.Color.Vd;g.Color.rgbToHex=g.Color.Dn;g.Color.fromRgbaString=g.Color.cn;
g.Color.hexToRgb=g.Color.qn;g.Color.rgbToYcbcr=g.Color.Gn;g.Color.ycbcrToRgb=g.Color.Rn;g.Color.ycbcrRotate=g.Color.Qn;g.Color.distance=g.Color.distance;g.A.canPlayAudio=g.A.Ym;g.A.canPlayVideo=g.A.Zm;g.A.isLowBattery=g.A.wn;g.A.os=g.A.jb;g.A.vita=g.A.sg;g.A.xbox=g.A.Dg;g.A.kindle=g.A.Vf;g.A.windowsPhone=g.A.Ae;g.A.osVersion=g.A.ec;g.A.android=g.A.Pi;g.A.chromeOS=g.A.Bf;g.A.iOS=g.A.Qc;g.A.linux=g.A.Wf;g.A.macOS=g.A.Zf;g.A.windows=g.A.Bg;g.A.ie=g.A.pd;g.A.edge=g.A.Wd;g.A.firefox=g.A.If;g.A.opera=g.A.opera;
g.A.safari=g.A.ig;g.A.chrome=g.A.chrome;g.A.browser=g.A.tb;g.A.browserVersion=g.A.gb;g.A.edgeVersion=g.A.bj;g.A.chromeVersion=g.A.Cf;g.A.firefoxVersion=g.A.ej;g.A.silk=g.A.ng;g.A.ieVersion=g.A.Rf;g.A.operaVersion=g.A.ne;g.A.safariVersion=g.A.Uj;g.A.isAndroidStockBrowser=g.A.Dj;g.A.androidStockBrowserVersion=g.A.Qi;g.A.webApp=g.A.gk;g.A.quirksMode=g.A.Rj;g.A.pixelRatio=g.A.tc;g.A.iPhone=g.A.Aj;g.A.iPod=g.A.Bj;g.A.iPad=g.A.Qf;g.A.retina=g.A.Tj;g.A.desktop=g.A.Oc;g.A.mobile=g.A.ke;g.A.tablet=g.A.pg;
g.A.other=g.A.Nj;g.A.oggVideo=g.A.dg;g.A.h264Video=g.A.Mf;g.A.mp4Video=g.A.bg;g.A.webmVideo=g.A.Ag;g.A.vp9Video=g.A.tg;g.A.hlsVideo=g.A.Pf;g.A.audioTag=g.A.xf;g.A.webAudio=g.A.vg;g.A.ogg=g.A.cg;g.A.mp3=g.A.$f;g.A.opus=g.A.oe;g.A.wav=g.A.ug;g.A.aac=g.A.vf;g.A.m4a=g.A.Yf;g.A.mp4=g.A.ag;g.A.webm=g.A.zg;g.A.weba=g.A.yg;g.A.vibrate=g.A.rg;g.A.battery=g.A.Af;g.A.canvas=g.A.canvas;g.A.canvasText=g.A.Ti;g.A.canvasWinding=g.A.Ui;g.A.localStorage=g.A.localStorage;g.A.mediaSource=g.A.Kj;g.A.encryptedMedia=g.A.cj;
g.A.applicationCache=g.A.applicationCache;g.A.addEventListener=g.A.addEventListener;g.A.raf=g.A.Vn;g.A.webGL=g.A.wg;g.A.webVR=g.A.xg;g.A.geolocation=g.A.geolocation;g.A.history=g.A.history;g.A.svg=g.A.Zj;g.A.contextMenu=g.A.contextMenu;g.A.isSecure=g.A.Fj;g.A.isIframe=g.A.Tf;g.A.touch=g.A.ak;g.A.touchForce=g.A.bk;g.A.gamepad=g.A.jj;g.A.requestFullscreen=g.A.requestFullscreen;g.A.exitFullscreen=g.A.exitFullscreen;g.A.fullscreenKeyboard=g.A.ij;g.A.fullscreenElement=g.A.fullscreenElement;
g.A.fullscreenEnabled=g.A.fullscreenEnabled;g.A.visibilityState=g.A.visibilityState;g.A.visibilityChange=g.A.fk;g.A.orientation=g.A.orientation;g.A.screenOrientation=g.A.Vj;g.A.lockOrientation=g.A.Hj;g.A.unlockOrientation=g.A.ck;g.A.file=g.A.file;g.A.fileSystem=g.A.dj;g.A.pointerLock=g.A.Qj;g.A.cssPointerEvents=g.A.jd;g.A.cssRgba=g.A.Zi;g.A.cssAnimation=g.A.Yi;g.A.css3D=g.A.Xi;g.A.deviceMotionRotationRate=g.A.Ff;g.A.deviceMotionAcceleration=g.A.Ef;g.A.deviceOrientationMagnetometer=g.A.Hf;
g.A.deviceMotion=g.A.Df;g.A.deviceOrientation=g.A.Gf;g.A.dpi=g.A.aj;g.A.screenWidth=g.A.kg;g.A.screenHeight=g.A.jg;g.A.ua=g.A.ea;g.A.language=g.A.language;g.A.gyroscope=g.A.vj;g.A.ready=g.A.ready;g.R.generate=g.R.Jf;g.R.validate=g.R.ek;g.R.register=g.R.register;g.R.unregister=g.R.unregister;g.R.getUids=g.R.Lf;g.R.filterType=g.R.Yd;g.R.get=g.R.get;g.R.isTypeOf=g.R.V;g.R.exists=g.R.hb;g.eb.register=g.eb.register;g.eb.getUids=g.eb.Lf;g.eb.get=g.eb.get;g.eb.hasTypeOf=g.eb.pn;g.eb.exists=g.eb.hb;
window.KEN.Cache.types=B;B.JSON=B.JSON;window.KEN.Math=g.Math;g.Math.DEGREES=g.Math.Qa;g.Math.RADIANS=g.Math.wb;g.Math.DEG2RAD=g.Math.Kg;g.Math.RAD2DEG=g.Math.Vh;g.Math.TWOPI=g.Math.bi;window.KEN.Raycaster.modes=Ia;Ia.POINTER=Ia.cb;Ia.GAZE=Ia.zc;window.KEN.MediaType=g.kb;g.kb.IMAGE=g.kb.IMAGE;g.kb.VIDEO=g.kb.VIDEO;window.KEN.MediaFormat=g.Za;g.Za.EQUIRECTANGULAR=g.Za.Ng;g.Za.CUBE=g.Za.Gg;g.Za.FLAT=g.Za.Og;g.Za.HOTSPOT=g.Za.kk;window.KEN.SoundType=g.Na;g.Na.AMBISONIC=g.Na.Be;
window.KEN.VideoFormat=g.fb;g.fb.DASH=g.fb.De;window.KEN.BackgroundType=g.Va;g.Va.UNDEFINED=g.Va.Gd;window.KEN.ViewType=g.La;g.La.RECTILINEAR=g.La.Cc;g.La.GOPRO=g.La.Ac;g.Va.MESH=g.Va.Ed;g.Va.SHADER=g.Va.Fd;g.La.UNDEFINED=g.La.Gd;window.KEN.HotspotType=g.Vc;g.Vc.THREE_DIMENSIONAL=g.Vc.Zh;window.KEN.HotspotMaterial.presets=nb;nb.TRANSPARENT=nb.ai;nb.DEBUG=nb.xd;L.RADIUS=50;ob.DEFAULT_RAMP_TIME=.5;g.Na.SPATIAL=g.Na.oc;g.Na.STEREO=g.Na.Xh;qb.IMAGE=qb.IMAGE;qb.PLUGIN=qb.Rh;qb.GRAPHICS=qb.Pg;
window.KEN.Easing=g.T;g.T.SINE_IN=g.T.nc;g.T.SINE_OUT=g.T.Dc;g.T.LINEAR=g.T.LINEAR;L.DEFAULT_CONFIG=Ab;window.KEN.ControllerType=g.vb;g.vb.POINTER=g.vb.cb;g.vb.KEYBOARD=g.vb.Ph;ka.DEFAULT_CONFIG=Rb;Sb.DEFAULT_OPTIONS=Vb;Tb.DEFAULT_OPTIONS=Wb;B.SOUND=B.xb;window.KEN.Action.operation=oc;oc.SET=oc.ff;oc.ADD=oc.Eg;oc.SUBSTRACT=oc.Yh;oc.MULTIPLY=oc.Qh;oc.DIVIDE=oc.Lg;oc.TOGGLE=oc.$h;window.KEN.Pointer.cursors=Qc;Qc.DEFAULT=Qc.DEFAULT;window.KEN.Pointer.listenerTypes=V;V.NATIVE=V.$a;V.HAMMER=V.pa;
window.KEN.Pointer.events=W;W.DOUBLE_TAP=W.yd;W.TAP=W.hf;W.PRESS_START=W.bf;W.PRESS_END=W.af;W.PAN_START=W.Xe;W.PAN_MOVE=W.We;W.PAN_END=W.Ve;W.PINCH_START=W.$e;W.PINCH_MOVE=W.Ze;W.PINCH_END=W.Ye;W.ROTATE_START=W.ef;W.ROTATE_MOVE=W.df;W.ROTATE_END=W.cf;W.SWIPE=W.gf;W.ENTER=W.Fe;W.LEAVE=W.Te;W.OVER=W.mc;W.OUT=W.Gb;W.MOVE=W.Ue;W.WHEEL=W.kf;Qc.POINTER=Qc.cb;Qc.GRAB=Qc.ik;Qc.GRABBING=Qc.jk;window.KEN.Image.renderModes=ed;ed.CSS=ed.CSS;ed.CANVAS=ed.Ub;B.IMAGE=B.IMAGE;window.KEN.Button.states=rd;
rd.OUT=rd.Gb;rd.OVER=rd.mc;rd.DOWN=rd.Mg;X.DEFAULT_STATE=wd;X.EMPTY_STATE_IMAGE=xd;X.EMPTY_STATE_LABEL=yd;X.EMPTY_STATE=zd;X.DEFAULT_STATE_IMAGE=Ad;X.DEFAULT_STATE_LABEL=Bd;window.KEN.VideoQualityMode=g.Ea;g.Ea.AUTO=g.Ea.Rb;g.Ea.MANUAL=g.Ea.MANUAL;window.KEN.VideoDash.mediaType=Sd;Sd.VIDEO=Sd.VIDEO;Sd.AUDIO=Sd.AUDIO;g.fb.HTML5=g.fb.lk;g.fb.UNKNOWN=g.fb.vl;B.XML=B.ac;window.KEN.Cache.reserved=ae;ae.COMMON=ae.Uc;ae.JSON=ae.JSON;ae.XML=ae.ac;ae.IMAGE=ae.IMAGE;ae.SOUND=ae.xb;g.T.SINE_IN_OUT=g.T.Wh;
g.T.QUAD_IN=g.T.Sh;g.T.QUAD_IN_OUT=g.T.Th;g.T.QUAD_OUT=g.T.Uh;g.T.CUBIC_IN=g.T.Hg;g.T.CUBIC_IN_OUT=g.T.Ig;g.T.CUBIC_OUT=g.T.Jg;g.T.BOUNCE_OUT=g.T.Ce;g.T.BOUNCE_IN=g.T.Fg;
  root.KEN = window.KEN;
}).call(this);

