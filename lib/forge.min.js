( function() {

	function _h( f, c ) {
		return function() {
			var res = f.apply( this, arguments );
			c.apply( this, arguments );
			return res;
		}
	}

	function processErrors( errors, source ) {

		var css = '#shaderReport{ box-sizing: border-box; position: absolute; left: 0; top: 0; \
			right: 0; font-family: monaco, monospace; font-size: 12px; z-index: 1000; \
			background-color: #b70000; color: #ffffff; white-space: normal; \
			text-shadow: 0 -1px 0 rgba(0,0,0,.6); line-height: 1.2em; list-style-type: none; \
			padding: 0; margin: 0; max-height: 300px; overflow: auto; } \
			#shaderReport li{ padding: 10px; border-top: 1px solid rgba( 255, 255, 255, .2 ); \
			border-bottom: 1px solid rgba( 0, 0, 0, .2 ) } \
			#shaderReport li p{ padding: 0; margin: 0 } \
			#shaderReport li:nth-child(odd){ background-color: #c9542b }\
			#shaderReport li p:first-child{ color: #eee }';

		var el = document.createElement( 'style' );
		document.getElementsByTagName( 'head' )[ 0 ].appendChild( el );
		el.textContent = css;

		var report = document.createElement( 'ul' );
		report.setAttribute( 'id', 'shaderReport' );
		document.body.appendChild( report );

		var re = /ERROR: [\d]+:([\d]+): (.+)/gmi; 
		var lines = source.split( '\n' );

		var m;
		while ((m = re.exec( errors )) != null) {
			if (m.index === re.lastIndex) {
				re.lastIndex++;
			}
			var li = document.createElement( 'li' );
			var code = '<p>ERROR "<b>' + m[ 2 ] + '</b>" in line ' + m[ 1 ] + '</p>'
			code += '<p>' + lines[ m[ 1 ] - 1 ].replace( /^[ \t]+/g, '' ) + '</p>';
			li.innerHTML = code;
			report.appendChild( li );
		}
	    
	}

	WebGLRenderingContext.prototype.compileShader = _h( 
		WebGLRenderingContext.prototype.compileShader, 
		function( shader ) {

			if ( !this.getShaderParameter( shader, this.COMPILE_STATUS ) ) {

				var errors = this.getShaderInfoLog( shader );
				var source = this.getShaderSource( shader );

				processErrors( errors, source );

			}
		} 
	);

} )();
// threejs.org/license
(function(l,oa){"object"===typeof exports&&"undefined"!==typeof module?oa(exports):"function"===typeof define&&define.amd?define(["exports"],oa):oa(l.THREE=l.THREE||{})})(this,function(l){function oa(){}function C(a,b){this.x=a||0;this.y=b||0}function ea(a,b,c,d,e,f,g,h,k,m){Object.defineProperty(this,"id",{value:Oe++});this.uuid=Q.generateUUID();this.name="";this.image=void 0!==a?a:ea.DEFAULT_IMAGE;this.mipmaps=[];this.mapping=void 0!==b?b:ea.DEFAULT_MAPPING;this.wrapS=void 0!==c?c:1001;this.wrapT=
void 0!==d?d:1001;this.magFilter=void 0!==e?e:1006;this.minFilter=void 0!==f?f:1008;this.anisotropy=void 0!==k?k:1;this.format=void 0!==g?g:1023;this.type=void 0!==h?h:1009;this.offset=new C(0,0);this.repeat=new C(1,1);this.generateMipmaps=!0;this.premultiplyAlpha=!1;this.flipY=!0;this.unpackAlignment=4;this.encoding=void 0!==m?m:3E3;this.version=0;this.onUpdate=null}function ga(a,b,c,d){this.x=a||0;this.y=b||0;this.z=c||0;this.w=void 0!==d?d:1}function Db(a,b,c){this.uuid=Q.generateUUID();this.width=
a;this.height=b;this.scissor=new ga(0,0,a,b);this.scissorTest=!1;this.viewport=new ga(0,0,a,b);c=c||{};void 0===c.minFilter&&(c.minFilter=1006);this.texture=new ea(void 0,void 0,c.wrapS,c.wrapT,c.magFilter,c.minFilter,c.format,c.type,c.anisotropy,c.encoding);this.depthBuffer=void 0!==c.depthBuffer?c.depthBuffer:!0;this.stencilBuffer=void 0!==c.stencilBuffer?c.stencilBuffer:!0;this.depthTexture=void 0!==c.depthTexture?c.depthTexture:null}function Eb(a,b,c){Db.call(this,a,b,c);this.activeMipMapLevel=
this.activeCubeFace=0}function da(a,b,c,d){this._x=a||0;this._y=b||0;this._z=c||0;this._w=void 0!==d?d:1}function q(a,b,c){this.x=a||0;this.y=b||0;this.z=c||0}function H(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);0<arguments.length&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}function Za(a,b,c,d,e,f,g,h,k,m){a=void 0!==a?a:[];ea.call(this,a,void 0!==b?b:301,c,d,e,f,g,h,k,m);this.flipY=!1}function Fb(a,b,c){var d=a[0];if(0>=
d||0<d)return a;var e=b*c,f=pe[e];void 0===f&&(f=new Float32Array(e),pe[e]=f);if(0!==b)for(d.toArray(f,0),d=1,e=0;d!==b;++d)e+=c,a[d].toArray(f,e);return f}function qe(a,b){var c=re[b];void 0===c&&(c=new Int32Array(b),re[b]=c);for(var d=0;d!==b;++d)c[d]=a.allocTextureUnit();return c}function Pe(a,b){a.uniform1f(this.addr,b)}function Qe(a,b){a.uniform1i(this.addr,b)}function Re(a,b){void 0===b.x?a.uniform2fv(this.addr,b):a.uniform2f(this.addr,b.x,b.y)}function Se(a,b){void 0!==b.x?a.uniform3f(this.addr,
b.x,b.y,b.z):void 0!==b.r?a.uniform3f(this.addr,b.r,b.g,b.b):a.uniform3fv(this.addr,b)}function Te(a,b){void 0===b.x?a.uniform4fv(this.addr,b):a.uniform4f(this.addr,b.x,b.y,b.z,b.w)}function Ue(a,b){a.uniformMatrix2fv(this.addr,!1,b.elements||b)}function Ve(a,b){a.uniformMatrix3fv(this.addr,!1,b.elements||b)}function We(a,b){a.uniformMatrix4fv(this.addr,!1,b.elements||b)}function Xe(a,b,c){var d=c.allocTextureUnit();a.uniform1i(this.addr,d);c.setTexture2D(b||se,d)}function Ye(a,b,c){var d=c.allocTextureUnit();
a.uniform1i(this.addr,d);c.setTextureCube(b||te,d)}function ue(a,b){a.uniform2iv(this.addr,b)}function ve(a,b){a.uniform3iv(this.addr,b)}function we(a,b){a.uniform4iv(this.addr,b)}function Ze(a){switch(a){case 5126:return Pe;case 35664:return Re;case 35665:return Se;case 35666:return Te;case 35674:return Ue;case 35675:return Ve;case 35676:return We;case 35678:return Xe;case 35680:return Ye;case 5124:case 35670:return Qe;case 35667:case 35671:return ue;case 35668:case 35672:return ve;case 35669:case 35673:return we}}
function $e(a,b){a.uniform1fv(this.addr,b)}function af(a,b){a.uniform1iv(this.addr,b)}function bf(a,b){a.uniform2fv(this.addr,Fb(b,this.size,2))}function cf(a,b){a.uniform3fv(this.addr,Fb(b,this.size,3))}function df(a,b){a.uniform4fv(this.addr,Fb(b,this.size,4))}function ef(a,b){a.uniformMatrix2fv(this.addr,!1,Fb(b,this.size,4))}function ff(a,b){a.uniformMatrix3fv(this.addr,!1,Fb(b,this.size,9))}function gf(a,b){a.uniformMatrix4fv(this.addr,!1,Fb(b,this.size,16))}function hf(a,b,c){var d=b.length,
e=qe(c,d);a.uniform1iv(this.addr,e);for(a=0;a!==d;++a)c.setTexture2D(b[a]||se,e[a])}function jf(a,b,c){var d=b.length,e=qe(c,d);a.uniform1iv(this.addr,e);for(a=0;a!==d;++a)c.setTextureCube(b[a]||te,e[a])}function kf(a){switch(a){case 5126:return $e;case 35664:return bf;case 35665:return cf;case 35666:return df;case 35674:return ef;case 35675:return ff;case 35676:return gf;case 35678:return hf;case 35680:return jf;case 5124:case 35670:return af;case 35667:case 35671:return ue;case 35668:case 35672:return ve;
case 35669:case 35673:return we}}function lf(a,b,c){this.id=a;this.addr=c;this.setValue=Ze(b.type)}function mf(a,b,c){this.id=a;this.addr=c;this.size=b.size;this.setValue=kf(b.type)}function xe(a){this.id=a;this.seq=[];this.map={}}function $a(a,b,c){this.seq=[];this.map={};this.renderer=c;c=a.getProgramParameter(b,a.ACTIVE_UNIFORMS);for(var d=0;d!==c;++d){var e=a.getActiveUniform(b,d),f=a.getUniformLocation(b,e.name),g=this,h=e.name,k=h.length;for(Id.lastIndex=0;;){var m=Id.exec(h),x=Id.lastIndex,
p=m[1],n=m[3];"]"===m[2]&&(p|=0);if(void 0===n||"["===n&&x+2===k){h=g;e=void 0===n?new lf(p,e,f):new mf(p,e,f);h.seq.push(e);h.map[e.id]=e;break}else n=g.map[p],void 0===n&&(n=new xe(p),p=g,g=n,p.seq.push(g),p.map[g.id]=g),g=n}}}function N(a,b,c){return void 0===b&&void 0===c?this.set(a):this.setRGB(a,b,c)}function db(a,b,c,d,e,f,g,h,k,m,x,p){ea.call(this,null,f,g,h,k,m,d,e,x,p);this.image={data:a,width:b,height:c};this.magFilter=void 0!==k?k:1003;this.minFilter=void 0!==m?m:1003;this.flipY=this.generateMipmaps=
!1;this.unpackAlignment=1}function pc(a,b){this.min=void 0!==a?a:new C(Infinity,Infinity);this.max=void 0!==b?b:new C(-Infinity,-Infinity)}function nf(a,b){var c,d,e,f,g,h,k,m,x,p,n=a.context,r=a.state,w,l,F,t,v,M;this.render=function(z,A,I){if(0!==b.length){z=new q;var E=I.w/I.z,K=.5*I.z,la=.5*I.w,J=16/I.w,ca=new C(J*E,J),Da=new q(1,1,0),eb=new C(1,1),Na=new pc;Na.min.set(I.x,I.y);Na.max.set(I.x+(I.z-16),I.y+(I.w-16));if(void 0===t){var J=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]),O=
new Uint16Array([0,1,2,0,2,3]);w=n.createBuffer();l=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,w);n.bufferData(n.ARRAY_BUFFER,J,n.STATIC_DRAW);n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,l);n.bufferData(n.ELEMENT_ARRAY_BUFFER,O,n.STATIC_DRAW);v=n.createTexture();M=n.createTexture();r.bindTexture(n.TEXTURE_2D,v);n.texImage2D(n.TEXTURE_2D,0,n.RGB,16,16,0,n.RGB,n.UNSIGNED_BYTE,null);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE);
n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST);r.bindTexture(n.TEXTURE_2D,M);n.texImage2D(n.TEXTURE_2D,0,n.RGBA,16,16,0,n.RGBA,n.UNSIGNED_BYTE,null);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST);n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST);var J=F={vertexShader:"uniform lowp int renderType;\nuniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nuniform sampler2D occlusionMap;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif ( renderType == 2 ) {\nvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );\nvVisibility =        visibility.r / 9.0;\nvVisibility *= 1.0 - visibility.g / 9.0;\nvVisibility *=       visibility.b / 9.0;\nvVisibility *= 1.0 - visibility.a / 9.0;\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",
fragmentShader:"uniform lowp int renderType;\nuniform sampler2D map;\nuniform float opacity;\nuniform vec3 color;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nif ( renderType == 0 ) {\ngl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );\n} else if ( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * vVisibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"},O=n.createProgram(),P=n.createShader(n.FRAGMENT_SHADER),
R=n.createShader(n.VERTEX_SHADER),T="precision "+a.getPrecision()+" float;\n";n.shaderSource(P,T+J.fragmentShader);n.shaderSource(R,T+J.vertexShader);n.compileShader(P);n.compileShader(R);n.attachShader(O,P);n.attachShader(O,R);n.linkProgram(O);t=O;x=n.getAttribLocation(t,"position");p=n.getAttribLocation(t,"uv");c=n.getUniformLocation(t,"renderType");d=n.getUniformLocation(t,"map");e=n.getUniformLocation(t,"occlusionMap");f=n.getUniformLocation(t,"opacity");g=n.getUniformLocation(t,"color");h=n.getUniformLocation(t,
"scale");k=n.getUniformLocation(t,"rotation");m=n.getUniformLocation(t,"screenPosition")}n.useProgram(t);r.initAttributes();r.enableAttribute(x);r.enableAttribute(p);r.disableUnusedAttributes();n.uniform1i(e,0);n.uniform1i(d,1);n.bindBuffer(n.ARRAY_BUFFER,w);n.vertexAttribPointer(x,2,n.FLOAT,!1,16,0);n.vertexAttribPointer(p,2,n.FLOAT,!1,16,8);n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,l);r.disable(n.CULL_FACE);r.setDepthWrite(!1);O=0;for(P=b.length;O<P;O++)if(J=16/I.w,ca.set(J*E,J),R=b[O],z.set(R.matrixWorld.elements[12],
R.matrixWorld.elements[13],R.matrixWorld.elements[14]),z.applyMatrix4(A.matrixWorldInverse),z.applyProjection(A.projectionMatrix),Da.copy(z),eb.x=I.x+Da.x*K+K-8,eb.y=I.y+Da.y*la+la-8,!0===Na.containsPoint(eb)){r.activeTexture(n.TEXTURE0);r.bindTexture(n.TEXTURE_2D,null);r.activeTexture(n.TEXTURE1);r.bindTexture(n.TEXTURE_2D,v);n.copyTexImage2D(n.TEXTURE_2D,0,n.RGB,eb.x,eb.y,16,16,0);n.uniform1i(c,0);n.uniform2f(h,ca.x,ca.y);n.uniform3f(m,Da.x,Da.y,Da.z);r.disable(n.BLEND);r.enable(n.DEPTH_TEST);n.drawElements(n.TRIANGLES,
6,n.UNSIGNED_SHORT,0);r.activeTexture(n.TEXTURE0);r.bindTexture(n.TEXTURE_2D,M);n.copyTexImage2D(n.TEXTURE_2D,0,n.RGBA,eb.x,eb.y,16,16,0);n.uniform1i(c,1);r.disable(n.DEPTH_TEST);r.activeTexture(n.TEXTURE1);r.bindTexture(n.TEXTURE_2D,v);n.drawElements(n.TRIANGLES,6,n.UNSIGNED_SHORT,0);R.positionScreen.copy(Da);R.customUpdateCallback?R.customUpdateCallback(R):R.updateLensFlares();n.uniform1i(c,2);r.enable(n.BLEND);for(var T=0,y=R.lensFlares.length;T<y;T++){var V=R.lensFlares[T];.001<V.opacity&&.001<
V.scale&&(Da.x=V.x,Da.y=V.y,Da.z=V.z,J=V.size*V.scale/I.w,ca.x=J*E,ca.y=J,n.uniform3f(m,Da.x,Da.y,Da.z),n.uniform2f(h,ca.x,ca.y),n.uniform1f(k,V.rotation),n.uniform1f(f,V.opacity),n.uniform3f(g,V.color.r,V.color.g,V.color.b),r.setBlending(V.blending,V.blendEquation,V.blendSrc,V.blendDst),a.setTexture2D(V.texture,1),n.drawElements(n.TRIANGLES,6,n.UNSIGNED_SHORT,0))}}r.enable(n.CULL_FACE);r.enable(n.DEPTH_TEST);r.setDepthWrite(!0);a.resetGLState()}}}function of(a,b){var c,d,e,f,g,h,k,m,x,p,n,r,w,l,
F,t,v;function M(a,b){return a.renderOrder!==b.renderOrder?a.renderOrder-b.renderOrder:a.z!==b.z?b.z-a.z:b.id-a.id}var z=a.context,A=a.state,I,E,K,la,J=new q,ca=new da,Da=new q;this.render=function(q,Na){if(0!==b.length){if(void 0===K){var O=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),P=new Uint16Array([0,1,2,0,2,3]);I=z.createBuffer();E=z.createBuffer();z.bindBuffer(z.ARRAY_BUFFER,I);z.bufferData(z.ARRAY_BUFFER,O,z.STATIC_DRAW);z.bindBuffer(z.ELEMENT_ARRAY_BUFFER,E);z.bufferData(z.ELEMENT_ARRAY_BUFFER,
P,z.STATIC_DRAW);var O=z.createProgram(),P=z.createShader(z.VERTEX_SHADER),R=z.createShader(z.FRAGMENT_SHADER);z.shaderSource(P,["precision "+a.getPrecision()+" float;","uniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform float rotation;\nuniform vec2 scale;\nuniform vec2 uvOffset;\nuniform vec2 uvScale;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uvOffset + uv * uvScale;\nvec2 alignedPosition = position * scale;\nvec2 rotatedPosition;\nrotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\nrotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\nvec4 finalPosition;\nfinalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\nfinalPosition.xy += rotatedPosition;\nfinalPosition = projectionMatrix * finalPosition;\ngl_Position = finalPosition;\n}"].join("\n"));
z.shaderSource(R,["precision "+a.getPrecision()+" float;","uniform vec3 color;\nuniform sampler2D map;\nuniform float opacity;\nuniform int fogType;\nuniform vec3 fogColor;\nuniform float fogDensity;\nuniform float fogNear;\nuniform float fogFar;\nuniform float alphaTest;\nvarying vec2 vUV;\nvoid main() {\nvec4 texture = texture2D( map, vUV );\nif ( texture.a < alphaTest ) discard;\ngl_FragColor = vec4( color * texture.xyz, texture.a * opacity );\nif ( fogType > 0 ) {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat fogFactor = 0.0;\nif ( fogType == 1 ) {\nfogFactor = smoothstep( fogNear, fogFar, depth );\n} else {\nconst float LOG2 = 1.442695;\nfogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n}\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n}\n}"].join("\n"));
z.compileShader(P);z.compileShader(R);z.attachShader(O,P);z.attachShader(O,R);z.linkProgram(O);K=O;t=z.getAttribLocation(K,"position");v=z.getAttribLocation(K,"uv");c=z.getUniformLocation(K,"uvOffset");d=z.getUniformLocation(K,"uvScale");e=z.getUniformLocation(K,"rotation");f=z.getUniformLocation(K,"scale");g=z.getUniformLocation(K,"color");h=z.getUniformLocation(K,"map");k=z.getUniformLocation(K,"opacity");m=z.getUniformLocation(K,"modelViewMatrix");x=z.getUniformLocation(K,"projectionMatrix");p=
z.getUniformLocation(K,"fogType");n=z.getUniformLocation(K,"fogDensity");r=z.getUniformLocation(K,"fogNear");w=z.getUniformLocation(K,"fogFar");l=z.getUniformLocation(K,"fogColor");F=z.getUniformLocation(K,"alphaTest");O=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");O.width=8;O.height=8;P=O.getContext("2d");P.fillStyle="white";P.fillRect(0,0,8,8);la=new ea(O);la.needsUpdate=!0}z.useProgram(K);A.initAttributes();A.enableAttribute(t);A.enableAttribute(v);A.disableUnusedAttributes();
A.disable(z.CULL_FACE);A.enable(z.BLEND);z.bindBuffer(z.ARRAY_BUFFER,I);z.vertexAttribPointer(t,2,z.FLOAT,!1,16,0);z.vertexAttribPointer(v,2,z.FLOAT,!1,16,8);z.bindBuffer(z.ELEMENT_ARRAY_BUFFER,E);z.uniformMatrix4fv(x,!1,Na.projectionMatrix.elements);A.activeTexture(z.TEXTURE0);z.uniform1i(h,0);P=O=0;(R=q.fog)?(z.uniform3f(l,R.color.r,R.color.g,R.color.b),R.isFog?(z.uniform1f(r,R.near),z.uniform1f(w,R.far),z.uniform1i(p,1),P=O=1):R.isFogExp2&&(z.uniform1f(n,R.density),z.uniform1i(p,2),P=O=2)):(z.uniform1i(p,
0),P=O=0);for(var R=0,T=b.length;R<T;R++){var y=b[R];y.modelViewMatrix.multiplyMatrices(Na.matrixWorldInverse,y.matrixWorld);y.z=-y.modelViewMatrix.elements[14]}b.sort(M);for(var V=[],R=0,T=b.length;R<T;R++){var y=b[R],ra=y.material;!1!==ra.visible&&(z.uniform1f(F,ra.alphaTest),z.uniformMatrix4fv(m,!1,y.modelViewMatrix.elements),y.matrixWorld.decompose(J,ca,Da),V[0]=Da.x,V[1]=Da.y,y=0,q.fog&&ra.fog&&(y=P),O!==y&&(z.uniform1i(p,y),O=y),null!==ra.map?(z.uniform2f(c,ra.map.offset.x,ra.map.offset.y),
z.uniform2f(d,ra.map.repeat.x,ra.map.repeat.y)):(z.uniform2f(c,0,0),z.uniform2f(d,1,1)),z.uniform1f(k,ra.opacity),z.uniform3f(g,ra.color.r,ra.color.g,ra.color.b),z.uniform1f(e,ra.rotation),z.uniform2fv(f,V),A.setBlending(ra.blending,ra.blendEquation,ra.blendSrc,ra.blendDst),A.setDepthTest(ra.depthTest),A.setDepthWrite(ra.depthWrite),ra.map?a.setTexture2D(ra.map,0):a.setTexture2D(la,0),z.drawElements(z.TRIANGLES,6,z.UNSIGNED_SHORT,0))}A.enable(z.CULL_FACE);a.resetGLState()}}}function W(){Object.defineProperty(this,
"id",{value:pf++});this.uuid=Q.generateUUID();this.name="";this.type="Material";this.lights=this.fog=!0;this.blending=1;this.side=0;this.shading=2;this.vertexColors=0;this.opacity=1;this.transparent=!1;this.blendSrc=204;this.blendDst=205;this.blendEquation=100;this.blendEquationAlpha=this.blendDstAlpha=this.blendSrcAlpha=null;this.depthFunc=3;this.depthWrite=this.depthTest=!0;this.clippingPlanes=null;this.clipShadows=this.clipIntersection=!1;this.colorWrite=!0;this.precision=null;this.polygonOffset=
!1;this.alphaTest=this.polygonOffsetUnits=this.polygonOffsetFactor=0;this.premultipliedAlpha=!1;this.overdraw=0;this._needsUpdate=this.visible=!0}function Ia(a){W.call(this);this.type="ShaderMaterial";this.defines={};this.uniforms={};this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}";this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";this.linewidth=1;this.wireframe=!1;this.wireframeLinewidth=1;this.morphNormals=
this.morphTargets=this.skinning=this.clipping=this.lights=this.fog=!1;this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1};this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]};this.index0AttributeName=void 0;void 0!==a&&(void 0!==a.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(a))}function ab(a){W.call(this);this.type="MeshDepthMaterial";this.depthPacking=3200;this.morphTargets=
this.skinning=!1;this.displacementMap=this.alphaMap=this.map=null;this.displacementScale=1;this.displacementBias=0;this.wireframe=!1;this.wireframeLinewidth=1;this.lights=this.fog=!1;this.setValues(a)}function ya(a,b){this.min=void 0!==a?a:new q(Infinity,Infinity,Infinity);this.max=void 0!==b?b:new q(-Infinity,-Infinity,-Infinity)}function Fa(a,b){this.center=void 0!==a?a:new q;this.radius=void 0!==b?b:0}function za(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1]);0<arguments.length&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}
function ma(a,b){this.normal=void 0!==a?a:new q(1,0,0);this.constant=void 0!==b?b:0}function qc(a,b,c,d,e,f){this.planes=[void 0!==a?a:new ma,void 0!==b?b:new ma,void 0!==c?c:new ma,void 0!==d?d:new ma,void 0!==e?e:new ma,void 0!==f?f:new ma]}function ye(a,b,c,d){function e(b,c,d,e){var f=b.geometry,g;g=F;var h=b.customDepthMaterial;d&&(g=t,h=b.customDistanceMaterial);h?g=h:(h=!1,c.morphTargets&&(f&&f.isBufferGeometry?h=f.morphAttributes&&f.morphAttributes.position&&0<f.morphAttributes.position.length:
f&&f.isGeometry&&(h=f.morphTargets&&0<f.morphTargets.length)),b=b.isSkinnedMesh&&c.skinning,f=0,h&&(f|=1),b&&(f|=2),g=g[f]);a.localClippingEnabled&&!0===c.clipShadows&&0!==c.clippingPlanes.length&&(f=g.uuid,h=c.uuid,b=v[f],void 0===b&&(b={},v[f]=b),f=b[h],void 0===f&&(f=g.clone(),b[h]=f),g=f);g.visible=c.visible;g.wireframe=c.wireframe;h=c.side;ca.renderSingleSided&&2==h&&(h=0);ca.renderReverseSided&&(0===h?h=1:1===h&&(h=0));g.side=h;g.clipShadows=c.clipShadows;g.clippingPlanes=c.clippingPlanes;g.wireframeLinewidth=
c.wireframeLinewidth;g.linewidth=c.linewidth;d&&void 0!==g.uniforms.lightPos&&g.uniforms.lightPos.value.copy(e);return g}function f(a,b,c){if(!1!==a.visible){0!==(a.layers.mask&b.layers.mask)&&(a.isMesh||a.isLine||a.isPoints)&&a.castShadow&&(!1===a.frustumCulled||!0===k.intersectsObject(a))&&!0===a.material.visible&&(a.modelViewMatrix.multiplyMatrices(c.matrixWorldInverse,a.matrixWorld),l.push(a));a=a.children;for(var d=0,e=a.length;d<e;d++)f(a[d],b,c)}}var g=a.context,h=a.state,k=new qc,m=new H,
x=b.shadows,p=new C,n=new C(d.maxTextureSize,d.maxTextureSize),r=new q,w=new q,l=[],F=Array(4),t=Array(4),v={},M=[new q(1,0,0),new q(-1,0,0),new q(0,0,1),new q(0,0,-1),new q(0,1,0),new q(0,-1,0)],z=[new q(0,1,0),new q(0,1,0),new q(0,1,0),new q(0,1,0),new q(0,0,1),new q(0,0,-1)],A=[new ga,new ga,new ga,new ga,new ga,new ga];b=new ab;b.depthPacking=3201;b.clipping=!0;d=Gb.distanceRGBA;for(var I=Ja.clone(d.uniforms),E=0;4!==E;++E){var K=0!==(E&1),la=0!==(E&2),J=b.clone();J.morphTargets=K;J.skinning=
la;F[E]=J;K=new Ia({defines:{USE_SHADOWMAP:""},uniforms:I,vertexShader:d.vertexShader,fragmentShader:d.fragmentShader,morphTargets:K,skinning:la,clipping:!0});t[E]=K}var ca=this;this.enabled=!1;this.autoUpdate=!0;this.needsUpdate=!1;this.type=1;this.renderSingleSided=this.renderReverseSided=!0;this.render=function(b,d){if(!1!==ca.enabled&&(!1!==ca.autoUpdate||!1!==ca.needsUpdate)&&0!==x.length){h.buffers.color.setClear(1,1,1,1);h.disable(g.BLEND);h.setDepthTest(!0);h.setScissorTest(!1);for(var v,
q,t=0,F=x.length;t<F;t++){var I=x[t],E=I.shadow;if(void 0===E)console.warn("THREE.WebGLShadowMap:",I,"has no shadow.");else{var K=E.camera;p.copy(E.mapSize);p.min(n);if(I&&I.isPointLight){v=6;q=!0;var J=p.x,la=p.y;A[0].set(2*J,la,J,la);A[1].set(0,la,J,la);A[2].set(3*J,la,J,la);A[3].set(J,la,J,la);A[4].set(3*J,0,J,la);A[5].set(J,0,J,la);p.x*=4;p.y*=2}else v=1,q=!1;null===E.map&&(E.map=new Db(p.x,p.y,{minFilter:1003,magFilter:1003,format:1023}),K.updateProjectionMatrix());E.isSpotLightShadow&&E.update(I);
E&&E.isRectAreaLightShadow&&E.update(I);J=E.map;E=E.matrix;w.setFromMatrixPosition(I.matrixWorld);K.position.copy(w);a.setRenderTarget(J);a.clear();for(J=0;J<v;J++){q?(r.copy(K.position),r.add(M[J]),K.up.copy(z[J]),K.lookAt(r),h.viewport(A[J])):(r.setFromMatrixPosition(I.target.matrixWorld),K.lookAt(r));K.updateMatrixWorld();K.matrixWorldInverse.getInverse(K.matrixWorld);E.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1);E.multiply(K.projectionMatrix);E.multiply(K.matrixWorldInverse);m.multiplyMatrices(K.projectionMatrix,
K.matrixWorldInverse);k.setFromMatrix(m);l.length=0;f(b,d,K);for(var la=0,y=l.length;la<y;la++){var C=l[la],Jd=c.update(C),Ta=C.material;if(Ta&&Ta.isMultiMaterial)for(var G=Jd.groups,Ta=Ta.materials,D=0,Ga=G.length;D<Ga;D++){var N=G[D],H=Ta[N.materialIndex];!0===H.visible&&(H=e(C,H,q,w),a.renderBufferDirect(K,null,Jd,H,C,N))}else H=e(C,Ta,q,w),a.renderBufferDirect(K,null,Jd,H,C,null)}}}}v=a.getClearColor();q=a.getClearAlpha();a.setClearColor(v,q);ca.needsUpdate=!1}}}function bb(a,b){this.origin=void 0!==
a?a:new q;this.direction=void 0!==b?b:new q}function cb(a,b,c,d){this._x=a||0;this._y=b||0;this._z=c||0;this._order=d||cb.DefaultOrder}function gd(){this.mask=1}function G(){Object.defineProperty(this,"id",{value:qf++});this.uuid=Q.generateUUID();this.name="";this.type="Object3D";this.parent=null;this.children=[];this.up=G.DefaultUp.clone();var a=new q,b=new cb,c=new da,d=new q(1,1,1);b.onChange(function(){c.setFromEuler(b,!1)});c.onChange(function(){b.setFromQuaternion(c,void 0,!1)});Object.defineProperties(this,
{position:{enumerable:!0,value:a},rotation:{enumerable:!0,value:b},quaternion:{enumerable:!0,value:c},scale:{enumerable:!0,value:d},modelViewMatrix:{value:new H},normalMatrix:{value:new za}});this.matrix=new H;this.matrixWorld=new H;this.matrixAutoUpdate=G.DefaultMatrixAutoUpdate;this.matrixWorldNeedsUpdate=!1;this.layers=new gd;this.visible=!0;this.receiveShadow=this.castShadow=!1;this.frustumCulled=!0;this.renderOrder=0;this.userData={};this.onBeforeRender=function(){};this.onAfterRender=function(){}}
function gb(a,b){this.start=void 0!==a?a:new q;this.end=void 0!==b?b:new q}function Aa(a,b,c){this.a=void 0!==a?a:new q;this.b=void 0!==b?b:new q;this.c=void 0!==c?c:new q}function ha(a,b,c,d,e,f){this.a=a;this.b=b;this.c=c;this.normal=d&&d.isVector3?d:new q;this.vertexNormals=Array.isArray(d)?d:[];this.color=e&&e.isColor?e:new N;this.vertexColors=Array.isArray(e)?e:[];this.materialIndex=void 0!==f?f:0}function Ka(a){W.call(this);this.type="MeshBasicMaterial";this.color=new N(16777215);this.lightMap=
this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.envMap=this.alphaMap=this.specularMap=null;this.combine=0;this.reflectivity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.lights=this.morphTargets=this.skinning=!1;this.setValues(a)}function y(a,b,c){if(Array.isArray(a))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.uuid=Q.generateUUID();this.array=a;
this.itemSize=b;this.count=void 0!==a?a.length/b:0;this.normalized=!0===c;this.dynamic=!1;this.updateRange={offset:0,count:-1};this.onUploadCallback=function(){};this.version=0}function rc(a,b){y.call(this,new Int8Array(a),b)}function sc(a,b){y.call(this,new Uint8Array(a),b)}function tc(a,b){y.call(this,new Uint8ClampedArray(a),b)}function uc(a,b){y.call(this,new Int16Array(a),b)}function Ra(a,b){y.call(this,new Uint16Array(a),b)}function vc(a,b){y.call(this,new Int32Array(a),b)}function Ua(a,b){y.call(this,
new Uint32Array(a),b)}function X(a,b){y.call(this,new Float32Array(a),b)}function wc(a,b){y.call(this,new Float64Array(a),b)}function ze(){this.indices=[];this.vertices=[];this.normals=[];this.colors=[];this.uvs=[];this.uvs2=[];this.groups=[];this.morphTargets={};this.skinWeights=[];this.skinIndices=[];this.boundingSphere=this.boundingBox=null;this.groupsNeedUpdate=this.uvsNeedUpdate=this.colorsNeedUpdate=this.normalsNeedUpdate=this.verticesNeedUpdate=!1}function S(){Object.defineProperty(this,"id",
{value:Kd++});this.uuid=Q.generateUUID();this.name="";this.type="Geometry";this.vertices=[];this.colors=[];this.faces=[];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphNormals=[];this.skinWeights=[];this.skinIndices=[];this.lineDistances=[];this.boundingSphere=this.boundingBox=null;this.groupsNeedUpdate=this.lineDistancesNeedUpdate=this.colorsNeedUpdate=this.normalsNeedUpdate=this.uvsNeedUpdate=this.verticesNeedUpdate=this.elementsNeedUpdate=!1}function D(){Object.defineProperty(this,"id",
{value:Kd++});this.uuid=Q.generateUUID();this.name="";this.type="BufferGeometry";this.index=null;this.attributes={};this.morphAttributes={};this.groups=[];this.boundingSphere=this.boundingBox=null;this.drawRange={start:0,count:Infinity}}function Ba(a,b){G.call(this);this.type="Mesh";this.geometry=void 0!==a?a:new D;this.material=void 0!==b?b:new Ka({color:16777215*Math.random()});this.drawMode=0;this.updateMorphTargets()}function hb(a,b,c,d,e,f){function g(a,b,c,d,e,f,g,k,m,y,C){var Na=f/m,O=g/y,
P=f/2,R=g/2,T=k/2;g=m+1;for(var G=y+1,V=f=0,D=new q,L=0;L<G;L++)for(var N=L*O-R,H=0;H<g;H++)D[a]=(H*Na-P)*d,D[b]=N*e,D[c]=T,p[w]=D.x,p[w+1]=D.y,p[w+2]=D.z,D[a]=0,D[b]=0,D[c]=0<k?1:-1,n[w]=D.x,n[w+1]=D.y,n[w+2]=D.z,r[l]=H/m,r[l+1]=1-L/y,w+=3,l+=2,f+=1;for(L=0;L<y;L++)for(H=0;H<m;H++)a=t+H+g*(L+1),b=t+(H+1)+g*(L+1),c=t+(H+1)+g*L,x[F]=t+H+g*L,x[F+1]=a,x[F+2]=c,x[F+3]=a,x[F+4]=b,x[F+5]=c,F+=6,V+=6;h.addGroup(v,V,C);v+=V;t+=f}D.call(this);this.type="BoxBufferGeometry";this.parameters={width:a,height:b,
depth:c,widthSegments:d,heightSegments:e,depthSegments:f};var h=this;d=Math.floor(d)||1;e=Math.floor(e)||1;f=Math.floor(f)||1;var k=function(a,b,c){return a=0+(a+1)*(b+1)*2+(a+1)*(c+1)*2+(c+1)*(b+1)*2}(d,e,f),m=function(a,b,c){a=0+a*b*2+a*c*2+c*b*2;return 6*a}(d,e,f),x=new (65535<m?Uint32Array:Uint16Array)(m),p=new Float32Array(3*k),n=new Float32Array(3*k),r=new Float32Array(2*k),w=0,l=0,F=0,t=0,v=0;g("z","y","x",-1,-1,c,b,a,f,e,0);g("z","y","x",1,-1,c,b,-a,f,e,1);g("x","z","y",1,1,a,c,b,d,f,2);g("x",
"z","y",1,-1,a,c,-b,d,f,3);g("x","y","z",1,-1,a,b,c,d,e,4);g("x","y","z",-1,-1,a,b,-c,d,e,5);this.setIndex(new y(x,1));this.addAttribute("position",new y(p,3));this.addAttribute("normal",new y(n,3));this.addAttribute("uv",new y(r,2))}function ib(a,b,c,d){D.call(this);this.type="PlaneBufferGeometry";this.parameters={width:a,height:b,widthSegments:c,heightSegments:d};var e=a/2,f=b/2;c=Math.floor(c)||1;d=Math.floor(d)||1;var g=c+1,h=d+1,k=a/c,m=b/d;b=new Float32Array(g*h*3);a=new Float32Array(g*h*3);
for(var x=new Float32Array(g*h*2),p=0,n=0,r=0;r<h;r++)for(var w=r*m-f,l=0;l<g;l++)b[p]=l*k-e,b[p+1]=-w,a[p+2]=1,x[n]=l/c,x[n+1]=1-r/d,p+=3,n+=2;p=0;e=new (65535<b.length/3?Uint32Array:Uint16Array)(c*d*6);for(r=0;r<d;r++)for(l=0;l<c;l++)f=l+g*(r+1),h=l+1+g*(r+1),k=l+1+g*r,e[p]=l+g*r,e[p+1]=f,e[p+2]=k,e[p+3]=f,e[p+4]=h,e[p+5]=k,p+=6;this.setIndex(new y(e,1));this.addAttribute("position",new y(b,3));this.addAttribute("normal",new y(a,3));this.addAttribute("uv",new y(x,2))}function sa(){G.call(this);
this.type="Camera";this.matrixWorldInverse=new H;this.projectionMatrix=new H}function Ha(a,b,c,d){sa.call(this);this.type="PerspectiveCamera";this.fov=void 0!==a?a:50;this.zoom=1;this.near=void 0!==c?c:.1;this.far=void 0!==d?d:2E3;this.focus=10;this.aspect=void 0!==b?b:1;this.view=null;this.filmGauge=35;this.filmOffset=0;this.updateProjectionMatrix()}function Hb(a,b,c,d,e,f){sa.call(this);this.type="OrthographicCamera";this.zoom=1;this.view=null;this.left=a;this.right=b;this.top=c;this.bottom=d;this.near=
void 0!==e?e:.1;this.far=void 0!==f?f:2E3;this.updateProjectionMatrix()}function rf(a,b,c){var d,e,f;return{setMode:function(a){d=a},setIndex:function(c){c.array instanceof Uint32Array&&b.get("OES_element_index_uint")?(e=a.UNSIGNED_INT,f=4):c.array instanceof Uint16Array?(e=a.UNSIGNED_SHORT,f=2):(e=a.UNSIGNED_BYTE,f=1)},render:function(b,h){a.drawElements(d,h,e,b*f);c.calls++;c.vertices+=h;d===a.TRIANGLES&&(c.faces+=h/3)},renderInstances:function(g,h,k){var m=b.get("ANGLE_instanced_arrays");null===
m?console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays."):(m.drawElementsInstancedANGLE(d,k,e,h*f,g.maxInstancedCount),c.calls++,c.vertices+=k*g.maxInstancedCount,d===a.TRIANGLES&&(c.faces+=g.maxInstancedCount*k/3))}}}function sf(a,b,c){var d;return{setMode:function(a){d=a},render:function(b,f){a.drawArrays(d,b,f);c.calls++;c.vertices+=f;d===a.TRIANGLES&&(c.faces+=f/3)},renderInstances:function(e){var f=b.get("ANGLE_instanced_arrays");
if(null===f)console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");else{var g=e.attributes.position,g=g.isInterleavedBufferAttribute?g.data.count:g.count;f.drawArraysInstancedANGLE(d,0,g,e.maxInstancedCount);c.calls++;c.vertices+=g*e.maxInstancedCount;d===a.TRIANGLES&&(c.faces+=e.maxInstancedCount*g/3)}}}}function tf(){var a={};return{get:function(b){if(void 0!==a[b.id])return a[b.id];var c;switch(b.type){case "DirectionalLight":c=
{direction:new q,color:new N,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new C};break;case "SpotLight":c={position:new q,direction:new q,color:new N,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new C};break;case "PointLight":c={position:new q,color:new N,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new C};break;case "HemisphereLight":c={direction:new q,skyColor:new N,groundColor:new N};break;case "RectAreaLight":c=
{color:new N,position:new q,halfWidth:new q,halfHeight:new q}}return a[b.id]=c}}}function uf(a){a=a.split("\n");for(var b=0;b<a.length;b++)a[b]=b+1+": "+a[b];return a.join("\n")}function Ae(a,b,c){var d=a.createShader(b);a.shaderSource(d,c);a.compileShader(d);!1===a.getShaderParameter(d,a.COMPILE_STATUS)&&console.error("THREE.WebGLShader: Shader couldn't compile.");""!==a.getShaderInfoLog(d)&&console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",b===a.VERTEX_SHADER?"vertex":"fragment",a.getShaderInfoLog(d),
uf(c));return d}function Be(a){switch(a){case 3E3:return["Linear","( value )"];case 3001:return["sRGB","( value )"];case 3002:return["RGBE","( value )"];case 3004:return["RGBM","( value, 7.0 )"];case 3005:return["RGBM","( value, 16.0 )"];case 3006:return["RGBD","( value, 256.0 )"];case 3007:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:throw Error("unsupported encoding: "+a);}}function Ld(a,b){var c=Be(b);return"vec4 "+a+"( vec4 value ) { return "+c[0]+"ToLinear"+c[1]+"; }"}function vf(a,
b){var c=Be(b);return"vec4 "+a+"( vec4 value ) { return LinearTo"+c[0]+c[1]+"; }"}function wf(a,b){var c;switch(b){case 1:c="Linear";break;case 2:c="Reinhard";break;case 3:c="Uncharted2";break;case 4:c="OptimizedCineon";break;default:throw Error("unsupported toneMapping: "+b);}return"vec3 "+a+"( vec3 color ) { return "+c+"ToneMapping( color ); }"}function xf(a,b,c){a=a||{};return[a.derivatives||b.envMapCubeUV||b.bumpMap||b.normalMap||b.flatShading?"#extension GL_OES_standard_derivatives : enable":
"",(a.fragDepth||b.logarithmicDepthBuffer)&&c.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",a.drawBuffers&&c.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(a.shaderTextureLOD||b.envMap)&&c.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""].filter(xc).join("\n")}function yf(a){var b=[],c;for(c in a){var d=a[c];!1!==d&&b.push("#define "+c+" "+d)}return b.join("\n")}function xc(a){return""!==a}function Ce(a,b){return a.replace(/NUM_DIR_LIGHTS/g,
b.numDirLights).replace(/NUM_SPOT_LIGHTS/g,b.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,b.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,b.numPointLights).replace(/NUM_HEMI_LIGHTS/g,b.numHemiLights)}function Md(a){return a.replace(/#include +<([\w\d.]+)>/g,function(a,c){var d=Z[c];if(void 0===d)throw Error("Can not resolve #include <"+c+">");return Md(d)})}function De(a){return a.replace(/for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,function(a,c,d,e){a="";for(c=parseInt(c);c<
parseInt(d);c++)a+=e.replace(/\[ i \]/g,"[ "+c+" ]");return a})}function zf(a,b,c,d){var e=a.context,f=c.extensions,g=c.defines,h=c.__webglShader.vertexShader,k=c.__webglShader.fragmentShader,m="SHADOWMAP_TYPE_BASIC";1===d.shadowMapType?m="SHADOWMAP_TYPE_PCF":2===d.shadowMapType&&(m="SHADOWMAP_TYPE_PCF_SOFT");var x="ENVMAP_TYPE_CUBE",p="ENVMAP_MODE_REFLECTION",n="ENVMAP_BLENDING_MULTIPLY";if(d.envMap){switch(c.envMap.mapping){case 301:case 302:x="ENVMAP_TYPE_CUBE";break;case 306:case 307:x="ENVMAP_TYPE_CUBE_UV";
break;case 303:case 304:x="ENVMAP_TYPE_EQUIREC";break;case 305:x="ENVMAP_TYPE_SPHERE"}switch(c.envMap.mapping){case 302:case 304:p="ENVMAP_MODE_REFRACTION"}switch(c.combine){case 0:n="ENVMAP_BLENDING_MULTIPLY";break;case 1:n="ENVMAP_BLENDING_MIX";break;case 2:n="ENVMAP_BLENDING_ADD"}}var r=0<a.gammaFactor?a.gammaFactor:1,f=xf(f,d,a.extensions),l=yf(g),u=e.createProgram();c.isRawShaderMaterial?(g=[l,"\n"].filter(xc).join("\n"),m=[f,l,"\n"].filter(xc).join("\n")):(g=["precision "+d.precision+" float;",
"precision "+d.precision+" int;","#define SHADER_NAME "+c.__webglShader.name,l,d.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+r,"#define MAX_BONES "+d.maxBones,d.map?"#define USE_MAP":"",d.envMap?"#define USE_ENVMAP":"",d.envMap?"#define "+p:"",d.lightMap?"#define USE_LIGHTMAP":"",d.aoMap?"#define USE_AOMAP":"",d.emissiveMap?"#define USE_EMISSIVEMAP":"",d.bumpMap?"#define USE_BUMPMAP":"",d.normalMap?"#define USE_NORMALMAP":"",d.displacementMap&&d.supportsVertexTextures?
"#define USE_DISPLACEMENTMAP":"",d.specularMap?"#define USE_SPECULARMAP":"",d.roughnessMap?"#define USE_ROUGHNESSMAP":"",d.metalnessMap?"#define USE_METALNESSMAP":"",d.alphaMap?"#define USE_ALPHAMAP":"",d.vertexColors?"#define USE_COLOR":"",d.flatShading?"#define FLAT_SHADED":"",d.skinning?"#define USE_SKINNING":"",d.useVertexTexture?"#define BONE_TEXTURE":"",d.morphTargets?"#define USE_MORPHTARGETS":"",d.morphNormals&&!1===d.flatShading?"#define USE_MORPHNORMALS":"",d.doubleSided?"#define DOUBLE_SIDED":
"",d.flipSided?"#define FLIP_SIDED":"","#define NUM_CLIPPING_PLANES "+d.numClippingPlanes,d.shadowMapEnabled?"#define USE_SHADOWMAP":"",d.shadowMapEnabled?"#define "+m:"",d.sizeAttenuation?"#define USE_SIZEATTENUATION":"",d.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",d.logarithmicDepthBuffer&&a.extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;",
"uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;",
"\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(xc).join("\n"),m=[f,"precision "+d.precision+" float;","precision "+d.precision+" int;","#define SHADER_NAME "+c.__webglShader.name,l,d.alphaTest?"#define ALPHATEST "+d.alphaTest:"","#define GAMMA_FACTOR "+r,d.useFog&&d.fog?"#define USE_FOG":"",d.useFog&&d.fogExp?"#define FOG_EXP2":
"",d.map?"#define USE_MAP":"",d.envMap?"#define USE_ENVMAP":"",d.envMap?"#define "+x:"",d.envMap?"#define "+p:"",d.envMap?"#define "+n:"",d.lightMap?"#define USE_LIGHTMAP":"",d.aoMap?"#define USE_AOMAP":"",d.emissiveMap?"#define USE_EMISSIVEMAP":"",d.bumpMap?"#define USE_BUMPMAP":"",d.normalMap?"#define USE_NORMALMAP":"",d.specularMap?"#define USE_SPECULARMAP":"",d.roughnessMap?"#define USE_ROUGHNESSMAP":"",d.metalnessMap?"#define USE_METALNESSMAP":"",d.alphaMap?"#define USE_ALPHAMAP":"",d.vertexColors?
"#define USE_COLOR":"",d.gradientMap?"#define USE_GRADIENTMAP":"",d.flatShading?"#define FLAT_SHADED":"",d.doubleSided?"#define DOUBLE_SIDED":"",d.flipSided?"#define FLIP_SIDED":"","#define NUM_CLIPPING_PLANES "+d.numClippingPlanes,"#define UNION_CLIPPING_PLANES "+(d.numClippingPlanes-d.numClipIntersection),d.shadowMapEnabled?"#define USE_SHADOWMAP":"",d.shadowMapEnabled?"#define "+m:"",d.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",d.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":
"",d.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",d.logarithmicDepthBuffer&&a.extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"",d.envMap&&a.extensions.get("EXT_shader_texture_lod")?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",0!==d.toneMapping?"#define TONE_MAPPING":"",0!==d.toneMapping?Z.tonemapping_pars_fragment:"",0!==d.toneMapping?wf("toneMapping",d.toneMapping):"",d.outputEncoding||d.mapEncoding||d.envMapEncoding||d.emissiveMapEncoding?
Z.encodings_pars_fragment:"",d.mapEncoding?Ld("mapTexelToLinear",d.mapEncoding):"",d.envMapEncoding?Ld("envMapTexelToLinear",d.envMapEncoding):"",d.emissiveMapEncoding?Ld("emissiveMapTexelToLinear",d.emissiveMapEncoding):"",d.outputEncoding?vf("linearToOutputTexel",d.outputEncoding):"",d.depthPacking?"#define DEPTH_PACKING "+c.depthPacking:"","\n"].filter(xc).join("\n"));h=Md(h,d);h=Ce(h,d);k=Md(k,d);k=Ce(k,d);c.isShaderMaterial||(h=De(h),k=De(k));k=m+k;h=Ae(e,e.VERTEX_SHADER,g+h);k=Ae(e,e.FRAGMENT_SHADER,
k);e.attachShader(u,h);e.attachShader(u,k);void 0!==c.index0AttributeName?e.bindAttribLocation(u,0,c.index0AttributeName):!0===d.morphTargets&&e.bindAttribLocation(u,0,"position");e.linkProgram(u);d=e.getProgramInfoLog(u);x=e.getShaderInfoLog(h);p=e.getShaderInfoLog(k);r=n=!0;if(!1===e.getProgramParameter(u,e.LINK_STATUS))n=!1,console.error("THREE.WebGLProgram: shader error: ",e.getError(),"gl.VALIDATE_STATUS",e.getProgramParameter(u,e.VALIDATE_STATUS),"gl.getProgramInfoLog",d,x,p);else if(""!==d)console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",
d);else if(""===x||""===p)r=!1;r&&(this.diagnostics={runnable:n,material:c,programLog:d,vertexShader:{log:x,prefix:g},fragmentShader:{log:p,prefix:m}});e.deleteShader(h);e.deleteShader(k);var q;this.getUniforms=function(){void 0===q&&(q=new $a(e,u,a));return q};var t;this.getAttributes=function(){if(void 0===t){for(var a={},b=e.getProgramParameter(u,e.ACTIVE_ATTRIBUTES),c=0;c<b;c++){var d=e.getActiveAttrib(u,c).name;a[d]=e.getAttribLocation(u,d)}t=a}return t};this.destroy=function(){e.deleteProgram(u);
this.program=void 0};Object.defineProperties(this,{uniforms:{get:function(){console.warn("THREE.WebGLProgram: .uniforms is now .getUniforms().");return this.getUniforms()}},attributes:{get:function(){console.warn("THREE.WebGLProgram: .attributes is now .getAttributes().");return this.getAttributes()}}});this.id=Af++;this.code=b;this.usedTimes=1;this.program=u;this.vertexShader=h;this.fragmentShader=k;return this}function Bf(a,b){function c(a,b){var c;a?a.isTexture?c=a.encoding:a.isWebGLRenderTarget&&
(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),c=a.texture.encoding):c=3E3;3E3===c&&b&&(c=3007);return c}var d=[],e={MeshDepthMaterial:"depth",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points"},
f="precision supportsVertexTextures map mapEncoding envMap envMapMode envMapEncoding lightMap aoMap emissiveMap emissiveMapEncoding bumpMap normalMap displacementMap specularMap roughnessMap metalnessMap gradientMap alphaMap combine vertexColors fog useFog fogExp flatShading sizeAttenuation logarithmicDepthBuffer skinning maxBones useVertexTexture morphTargets morphNormals maxMorphTargets maxMorphNormals premultipliedAlpha numDirLights numPointLights numSpotLights numHemiLights numRectAreaLights shadowMapEnabled shadowMapType toneMapping physicallyCorrectLights alphaTest doubleSided flipSided numClippingPlanes numClipIntersection depthPacking".split(" ");
this.getParameters=function(d,f,k,m,x,p){var n=e[d.type],r;b.floatVertexTextures&&p&&p.skeleton&&p.skeleton.useVertexTexture?r=1024:(r=Math.floor((b.maxVertexUniforms-20)/4),void 0!==p&&p&&p.isSkinnedMesh&&(r=Math.min(p.skeleton.bones.length,r),r<p.skeleton.bones.length&&console.warn("WebGLRenderer: too many bones - "+p.skeleton.bones.length+", this GPU supports just "+r+" (try OpenGL instead of ANGLE)")));var l=a.getPrecision();null!==d.precision&&(l=b.getMaxPrecision(d.precision),l!==d.precision&&
console.warn("THREE.WebGLProgram.getParameters:",d.precision,"not supported, using",l,"instead."));var u=a.getCurrentRenderTarget();return{shaderID:n,precision:l,supportsVertexTextures:b.vertexTextures,outputEncoding:c(u?u.texture:null,a.gammaOutput),map:!!d.map,mapEncoding:c(d.map,a.gammaInput),envMap:!!d.envMap,envMapMode:d.envMap&&d.envMap.mapping,envMapEncoding:c(d.envMap,a.gammaInput),envMapCubeUV:!!d.envMap&&(306===d.envMap.mapping||307===d.envMap.mapping),lightMap:!!d.lightMap,aoMap:!!d.aoMap,
emissiveMap:!!d.emissiveMap,emissiveMapEncoding:c(d.emissiveMap,a.gammaInput),bumpMap:!!d.bumpMap,normalMap:!!d.normalMap,displacementMap:!!d.displacementMap,roughnessMap:!!d.roughnessMap,metalnessMap:!!d.metalnessMap,specularMap:!!d.specularMap,alphaMap:!!d.alphaMap,gradientMap:!!d.gradientMap,combine:d.combine,vertexColors:d.vertexColors,fog:!!k,useFog:d.fog,fogExp:k&&k.isFogExp2,flatShading:1===d.shading,sizeAttenuation:d.sizeAttenuation,logarithmicDepthBuffer:b.logarithmicDepthBuffer,skinning:d.skinning,
maxBones:r,useVertexTexture:b.floatVertexTextures&&p&&p.skeleton&&p.skeleton.useVertexTexture,morphTargets:d.morphTargets,morphNormals:d.morphNormals,maxMorphTargets:a.maxMorphTargets,maxMorphNormals:a.maxMorphNormals,numDirLights:f.directional.length,numPointLights:f.point.length,numSpotLights:f.spot.length,numRectAreaLights:f.rectArea.length,numHemiLights:f.hemi.length,numClippingPlanes:m,numClipIntersection:x,shadowMapEnabled:a.shadowMap.enabled&&p.receiveShadow&&0<f.shadows.length,shadowMapType:a.shadowMap.type,
toneMapping:a.toneMapping,physicallyCorrectLights:a.physicallyCorrectLights,premultipliedAlpha:d.premultipliedAlpha,alphaTest:d.alphaTest,doubleSided:2===d.side,flipSided:1===d.side,depthPacking:void 0!==d.depthPacking?d.depthPacking:!1}};this.getProgramCode=function(a,b){var c=[];b.shaderID?c.push(b.shaderID):(c.push(a.fragmentShader),c.push(a.vertexShader));if(void 0!==a.defines)for(var d in a.defines)c.push(d),c.push(a.defines[d]);for(d=0;d<f.length;d++)c.push(b[f[d]]);return c.join()};this.acquireProgram=
function(b,c,e){for(var f,x=0,p=d.length;x<p;x++){var n=d[x];if(n.code===e){f=n;++f.usedTimes;break}}void 0===f&&(f=new zf(a,e,b,c),d.push(f));return f};this.releaseProgram=function(a){if(0===--a.usedTimes){var b=d.indexOf(a);d[b]=d[d.length-1];d.pop();a.destroy()}};this.programs=d}function Cf(a,b,c){function d(a){var h=a.target;a=f[h.id];null!==a.index&&e(a.index);var k=a.attributes,m;for(m in k)e(k[m]);h.removeEventListener("dispose",d);delete f[h.id];m=b.get(h);m.wireframe&&e(m.wireframe);b["delete"](h);
h=b.get(a);h.wireframe&&e(h.wireframe);b["delete"](a);c.memory.geometries--}function e(c){var d;d=c.isInterleavedBufferAttribute?b.get(c.data).__webglBuffer:b.get(c).__webglBuffer;void 0!==d&&(a.deleteBuffer(d),c.isInterleavedBufferAttribute?b["delete"](c.data):b["delete"](c))}var f={};return{get:function(a){var b=a.geometry;if(void 0!==f[b.id])return f[b.id];b.addEventListener("dispose",d);var e;b.isBufferGeometry?e=b:b.isGeometry&&(void 0===b._bufferGeometry&&(b._bufferGeometry=(new D).setFromObject(a)),
e=b._bufferGeometry);f[b.id]=e;c.memory.geometries++;return e}}}function Df(a,b,c){function d(c,d){var e=c.isInterleavedBufferAttribute?c.data:c,k=b.get(e);if(void 0===k.__webglBuffer){k.__webglBuffer=a.createBuffer();a.bindBuffer(d,k.__webglBuffer);a.bufferData(d,e.array,e.dynamic?a.DYNAMIC_DRAW:a.STATIC_DRAW);var m=a.FLOAT,x=e.array;x instanceof Float32Array?m=a.FLOAT:x instanceof Float64Array?console.warn("Unsupported data buffer format: Float64Array"):x instanceof Uint16Array?m=a.UNSIGNED_SHORT:
x instanceof Int16Array?m=a.SHORT:x instanceof Uint32Array?m=a.UNSIGNED_INT:x instanceof Int32Array?m=a.INT:x instanceof Int8Array?m=a.BYTE:x instanceof Uint8Array&&(m=a.UNSIGNED_BYTE);k.bytesPerElement=x.BYTES_PER_ELEMENT;k.type=m;k.version=e.version;e.onUploadCallback()}else k.version!==e.version&&(a.bindBuffer(d,k.__webglBuffer),!1===e.dynamic?a.bufferData(d,e.array,a.STATIC_DRAW):-1===e.updateRange.count?a.bufferSubData(d,0,e.array):0===e.updateRange.count?console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually."):
(a.bufferSubData(d,e.updateRange.offset*e.array.BYTES_PER_ELEMENT,e.array.subarray(e.updateRange.offset,e.updateRange.offset+e.updateRange.count)),e.updateRange.count=0),k.version=e.version)}var e=new Cf(a,b,c);return{getAttributeBuffer:function(a){return a.isInterleavedBufferAttribute?b.get(a.data).__webglBuffer:b.get(a).__webglBuffer},getAttributeProperties:function(a){return a.isInterleavedBufferAttribute?b.get(a.data):b.get(a)},getWireframeAttribute:function(c){var e=b.get(c);if(void 0!==e.wireframe)return e.wireframe;
var h=[],k=c.index,m=c.attributes;c=m.position;if(null!==k)for(var k=k.array,m=0,x=k.length;m<x;m+=3){var p=k[m+0],n=k[m+1],r=k[m+2];h.push(p,n,n,r,r,p)}else for(k=m.position.array,m=0,x=k.length/3-1;m<x;m+=3)p=m+0,n=m+1,r=m+2,h.push(p,n,n,r,r,p);h=new y(new (65535<c.count?Uint32Array:Uint16Array)(h),1);d(h,a.ELEMENT_ARRAY_BUFFER);return e.wireframe=h},update:function(b){var c=e.get(b);b.geometry.isGeometry&&c.updateFromObject(b);b=c.index;var h=c.attributes;null!==b&&d(b,a.ELEMENT_ARRAY_BUFFER);
for(var k in h)d(h[k],a.ARRAY_BUFFER);b=c.morphAttributes;for(k in b)for(var h=b[k],m=0,x=h.length;m<x;m++)d(h[m],a.ARRAY_BUFFER);return c}}}function Ef(a,b,c,d,e,f,g){function h(a,b){if(a.width>b||a.height>b){var c=b/Math.max(a.width,a.height),d=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");d.width=Math.floor(a.width*c);d.height=Math.floor(a.height*c);d.getContext("2d").drawImage(a,0,0,a.width,a.height,0,0,d.width,d.height);console.warn("THREE.WebGLRenderer: image is too big ("+
a.width+"x"+a.height+"). Resized to "+d.width+"x"+d.height,a);return d}return a}function k(a){return Q.isPowerOfTwo(a.width)&&Q.isPowerOfTwo(a.height)}function m(b){return 1003===b||1004===b||1005===b?a.NEAREST:a.LINEAR}function x(b){b=b.target;b.removeEventListener("dispose",x);a:{var c=d.get(b);if(b.image&&c.__image__webglTextureCube)a.deleteTexture(c.__image__webglTextureCube);else{if(void 0===c.__webglInit)break a;a.deleteTexture(c.__webglTexture)}d["delete"](b)}q.textures--}function p(b){b=b.target;
b.removeEventListener("dispose",p);var c=d.get(b),e=d.get(b.texture);if(b){void 0!==e.__webglTexture&&a.deleteTexture(e.__webglTexture);b.depthTexture&&b.depthTexture.dispose();if(b.isWebGLRenderTargetCube)for(e=0;6>e;e++)a.deleteFramebuffer(c.__webglFramebuffer[e]),c.__webglDepthbuffer&&a.deleteRenderbuffer(c.__webglDepthbuffer[e]);else a.deleteFramebuffer(c.__webglFramebuffer),c.__webglDepthbuffer&&a.deleteRenderbuffer(c.__webglDepthbuffer);d["delete"](b.texture);d["delete"](b)}q.textures--}function n(b,
g){var m=d.get(b);if(0<b.version&&m.__version!==b.version){var n=b.image;if(void 0===n)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined",b);else if(!1===n.complete)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete",b);else{void 0===m.__webglInit&&(m.__webglInit=!0,b.addEventListener("dispose",x),m.__webglTexture=a.createTexture(),q.textures++);c.activeTexture(a.TEXTURE0+g);c.bindTexture(a.TEXTURE_2D,m.__webglTexture);a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,
b.flipY);a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,b.premultiplyAlpha);a.pixelStorei(a.UNPACK_ALIGNMENT,b.unpackAlignment);var p=h(b.image,e.maxTextureSize);if((1001!==b.wrapS||1001!==b.wrapT||1003!==b.minFilter&&1006!==b.minFilter)&&!1===k(p))if(n=p,n instanceof HTMLImageElement||n instanceof HTMLCanvasElement){var l=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");l.width=Q.nearestPowerOfTwo(n.width);l.height=Q.nearestPowerOfTwo(n.height);l.getContext("2d").drawImage(n,0,0,
l.width,l.height);console.warn("THREE.WebGLRenderer: image is not power of two ("+n.width+"x"+n.height+"). Resized to "+l.width+"x"+l.height,n);p=l}else p=n;var n=k(p),l=f(b.format),w=f(b.type);r(a.TEXTURE_2D,b,n);var u=b.mipmaps;if(b.isDepthTexture){u=a.DEPTH_COMPONENT;if(1015===b.type){if(!t)throw Error("Float Depth Texture only supported in WebGL2.0");u=a.DEPTH_COMPONENT32F}else t&&(u=a.DEPTH_COMPONENT16);1026===b.format&&u===a.DEPTH_COMPONENT&&1012!==b.type&&1014!==b.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),
b.type=1012,w=f(b.type));1027===b.format&&(u=a.DEPTH_STENCIL,1020!==b.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),b.type=1020,w=f(b.type)));c.texImage2D(a.TEXTURE_2D,0,u,p.width,p.height,0,l,w,null)}else if(b.isDataTexture)if(0<u.length&&n){for(var J=0,ca=u.length;J<ca;J++)p=u[J],c.texImage2D(a.TEXTURE_2D,J,l,p.width,p.height,0,l,w,p.data);b.generateMipmaps=!1}else c.texImage2D(a.TEXTURE_2D,0,l,p.width,p.height,0,l,w,p.data);else if(b.isCompressedTexture)for(J=
0,ca=u.length;J<ca;J++)p=u[J],1023!==b.format&&1022!==b.format?-1<c.getCompressedTextureFormats().indexOf(l)?c.compressedTexImage2D(a.TEXTURE_2D,J,l,p.width,p.height,0,p.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):c.texImage2D(a.TEXTURE_2D,J,l,p.width,p.height,0,l,w,p.data);else if(0<u.length&&n){J=0;for(ca=u.length;J<ca;J++)p=u[J],c.texImage2D(a.TEXTURE_2D,J,l,l,w,p);b.generateMipmaps=!1}else c.texImage2D(a.TEXTURE_2D,0,l,l,
w,p);b.generateMipmaps&&n&&a.generateMipmap(a.TEXTURE_2D);m.__version=b.version;if(b.onUpdate)b.onUpdate(b);return}}c.activeTexture(a.TEXTURE0+g);c.bindTexture(a.TEXTURE_2D,m.__webglTexture)}function r(c,g,h){h?(a.texParameteri(c,a.TEXTURE_WRAP_S,f(g.wrapS)),a.texParameteri(c,a.TEXTURE_WRAP_T,f(g.wrapT)),a.texParameteri(c,a.TEXTURE_MAG_FILTER,f(g.magFilter)),a.texParameteri(c,a.TEXTURE_MIN_FILTER,f(g.minFilter))):(a.texParameteri(c,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(c,a.TEXTURE_WRAP_T,
a.CLAMP_TO_EDGE),1001===g.wrapS&&1001===g.wrapT||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping.",g),a.texParameteri(c,a.TEXTURE_MAG_FILTER,m(g.magFilter)),a.texParameteri(c,a.TEXTURE_MIN_FILTER,m(g.minFilter)),1003!==g.minFilter&&1006!==g.minFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.",g));!(h=b.get("EXT_texture_filter_anisotropic"))||
1015===g.type&&null===b.get("OES_texture_float_linear")||1016===g.type&&null===b.get("OES_texture_half_float_linear")||!(1<g.anisotropy||d.get(g).__currentAnisotropy)||(a.texParameterf(c,h.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(g.anisotropy,e.getMaxAnisotropy())),d.get(g).__currentAnisotropy=g.anisotropy)}function l(b,e,g,h){var k=f(e.texture.format),m=f(e.texture.type);c.texImage2D(h,0,k,e.width,e.height,0,k,m,null);a.bindFramebuffer(a.FRAMEBUFFER,b);a.framebufferTexture2D(a.FRAMEBUFFER,g,h,d.get(e.texture).__webglTexture,
0);a.bindFramebuffer(a.FRAMEBUFFER,null)}function u(b,c){a.bindRenderbuffer(a.RENDERBUFFER,b);c.depthBuffer&&!c.stencilBuffer?(a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_COMPONENT16,c.width,c.height),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,b)):c.depthBuffer&&c.stencilBuffer?(a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_STENCIL,c.width,c.height),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,b)):a.renderbufferStorage(a.RENDERBUFFER,
a.RGBA4,c.width,c.height);a.bindRenderbuffer(a.RENDERBUFFER,null)}var q=g.memory,t="undefined"!==typeof WebGL2RenderingContext&&a instanceof WebGL2RenderingContext;this.setTexture2D=n;this.setTextureCube=function(b,g){var m=d.get(b);if(6===b.image.length)if(0<b.version&&m.__version!==b.version){m.__image__webglTextureCube||(b.addEventListener("dispose",x),m.__image__webglTextureCube=a.createTexture(),q.textures++);c.activeTexture(a.TEXTURE0+g);c.bindTexture(a.TEXTURE_CUBE_MAP,m.__image__webglTextureCube);
a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,b.flipY);for(var n=b&&b.isCompressedTexture,p=b.image[0]&&b.image[0].isDataTexture,l=[],w=0;6>w;w++)l[w]=n||p?p?b.image[w].image:b.image[w]:h(b.image[w],e.maxCubemapSize);var u=k(l[0]),t=f(b.format),ca=f(b.type);r(a.TEXTURE_CUBE_MAP,b,u);for(w=0;6>w;w++)if(n)for(var y,C=l[w].mipmaps,D=0,O=C.length;D<O;D++)y=C[D],1023!==b.format&&1022!==b.format?-1<c.getCompressedTextureFormats().indexOf(t)?c.compressedTexImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+w,D,t,y.width,y.height,
0,y.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):c.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+w,D,t,y.width,y.height,0,t,ca,y.data);else p?c.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+w,0,t,l[w].width,l[w].height,0,t,ca,l[w].data):c.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+w,0,t,t,ca,l[w]);b.generateMipmaps&&u&&a.generateMipmap(a.TEXTURE_CUBE_MAP);m.__version=b.version;if(b.onUpdate)b.onUpdate(b)}else c.activeTexture(a.TEXTURE0+
g),c.bindTexture(a.TEXTURE_CUBE_MAP,m.__image__webglTextureCube)};this.setTextureCubeDynamic=function(b,e){c.activeTexture(a.TEXTURE0+e);c.bindTexture(a.TEXTURE_CUBE_MAP,d.get(b).__webglTexture)};this.setupRenderTarget=function(b){var e=d.get(b),f=d.get(b.texture);b.addEventListener("dispose",p);f.__webglTexture=a.createTexture();q.textures++;var g=!0===b.isWebGLRenderTargetCube,h=k(b);if(g){e.__webglFramebuffer=[];for(var m=0;6>m;m++)e.__webglFramebuffer[m]=a.createFramebuffer()}else e.__webglFramebuffer=
a.createFramebuffer();if(g){c.bindTexture(a.TEXTURE_CUBE_MAP,f.__webglTexture);r(a.TEXTURE_CUBE_MAP,b.texture,h);for(m=0;6>m;m++)l(e.__webglFramebuffer[m],b,a.COLOR_ATTACHMENT0,a.TEXTURE_CUBE_MAP_POSITIVE_X+m);b.texture.generateMipmaps&&h&&a.generateMipmap(a.TEXTURE_CUBE_MAP);c.bindTexture(a.TEXTURE_CUBE_MAP,null)}else c.bindTexture(a.TEXTURE_2D,f.__webglTexture),r(a.TEXTURE_2D,b.texture,h),l(e.__webglFramebuffer,b,a.COLOR_ATTACHMENT0,a.TEXTURE_2D),b.texture.generateMipmaps&&h&&a.generateMipmap(a.TEXTURE_2D),
c.bindTexture(a.TEXTURE_2D,null);if(b.depthBuffer){e=d.get(b);f=!0===b.isWebGLRenderTargetCube;if(b.depthTexture){if(f)throw Error("target.depthTexture not supported in Cube render targets");if(b&&b.isWebGLRenderTargetCube)throw Error("Depth Texture with cube render targets is not supported!");a.bindFramebuffer(a.FRAMEBUFFER,e.__webglFramebuffer);if(!b.depthTexture||!b.depthTexture.isDepthTexture)throw Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");d.get(b.depthTexture).__webglTexture&&
b.depthTexture.image.width===b.width&&b.depthTexture.image.height===b.height||(b.depthTexture.image.width=b.width,b.depthTexture.image.height=b.height,b.depthTexture.needsUpdate=!0);n(b.depthTexture,0);e=d.get(b.depthTexture).__webglTexture;if(1026===b.depthTexture.format)a.framebufferTexture2D(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.TEXTURE_2D,e,0);else if(1027===b.depthTexture.format)a.framebufferTexture2D(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.TEXTURE_2D,e,0);else throw Error("Unknown depthTexture format");
}else if(f)for(e.__webglDepthbuffer=[],f=0;6>f;f++)a.bindFramebuffer(a.FRAMEBUFFER,e.__webglFramebuffer[f]),e.__webglDepthbuffer[f]=a.createRenderbuffer(),u(e.__webglDepthbuffer[f],b);else a.bindFramebuffer(a.FRAMEBUFFER,e.__webglFramebuffer),e.__webglDepthbuffer=a.createRenderbuffer(),u(e.__webglDepthbuffer,b);a.bindFramebuffer(a.FRAMEBUFFER,null)}};this.updateRenderTargetMipmap=function(b){var e=b.texture;e.generateMipmaps&&k(b)&&1003!==e.minFilter&&1006!==e.minFilter&&(b=b&&b.isWebGLRenderTargetCube?
a.TEXTURE_CUBE_MAP:a.TEXTURE_2D,e=d.get(e).__webglTexture,c.bindTexture(b,e),a.generateMipmap(b),c.bindTexture(b,null))}}function Ff(){var a={};return{get:function(b){b=b.uuid;var c=a[b];void 0===c&&(c={},a[b]=c);return c},"delete":function(b){delete a[b.uuid]},clear:function(){a={}}}}function Gf(a,b,c){function d(b,c,d){var e=new Uint8Array(4),f=a.createTexture();a.bindTexture(b,f);a.texParameteri(b,a.TEXTURE_MIN_FILTER,a.NEAREST);a.texParameteri(b,a.TEXTURE_MAG_FILTER,a.NEAREST);for(b=0;b<d;b++)a.texImage2D(c+
b,0,a.RGBA,1,1,0,a.RGBA,a.UNSIGNED_BYTE,e);return f}function e(b){!0!==v[b]&&(a.enable(b),v[b]=!0)}function f(b){!1!==v[b]&&(a.disable(b),v[b]=!1)}function g(b,d,g,h,k,m,n,p){0!==b?e(a.BLEND):f(a.BLEND);if(b!==z||p!==ca)2===b?p?(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.ONE,a.ONE,a.ONE,a.ONE)):(a.blendEquation(a.FUNC_ADD),a.blendFunc(a.SRC_ALPHA,a.ONE)):3===b?p?(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.ZERO,a.ZERO,a.ONE_MINUS_SRC_COLOR,a.ONE_MINUS_SRC_ALPHA)):
(a.blendEquation(a.FUNC_ADD),a.blendFunc(a.ZERO,a.ONE_MINUS_SRC_COLOR)):4===b?p?(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.ZERO,a.SRC_COLOR,a.ZERO,a.SRC_ALPHA)):(a.blendEquation(a.FUNC_ADD),a.blendFunc(a.ZERO,a.SRC_COLOR)):p?(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.ONE,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA)):(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA)),
z=b,ca=p;if(5===b){k=k||d;m=m||g;n=n||h;if(d!==A||k!==K)a.blendEquationSeparate(c(d),c(k)),A=d,K=k;if(g!==I||h!==E||m!==y||n!==J)a.blendFuncSeparate(c(g),c(h),c(m),c(n)),I=g,E=h,y=m,J=n}else J=y=K=E=I=A=null}function h(a){n.setFunc(a)}function k(b){C!==b&&(b?a.frontFace(a.CW):a.frontFace(a.CCW),C=b)}function m(b){0!==b?(e(a.CULL_FACE),b!==D&&(1===b?a.cullFace(a.BACK):2===b?a.cullFace(a.FRONT):a.cullFace(a.FRONT_AND_BACK))):f(a.CULL_FACE);D=b}function x(b){void 0===b&&(b=a.TEXTURE0+T-1);V!==b&&(a.activeTexture(b),
V=b)}var p=new function(){var b=!1,c=new ga,d=null,e=new ga;return{setMask:function(c){d===c||b||(a.colorMask(c,c,c,c),d=c)},setLocked:function(a){b=a},setClear:function(b,d,f,g,h){!0===h&&(b*=g,d*=g,f*=g);c.set(b,d,f,g);!1===e.equals(c)&&(a.clearColor(b,d,f,g),e.copy(c))},reset:function(){b=!1;d=null;e.set(0,0,0,1)}}},n=new function(){var b=!1,c=null,d=null,g=null;return{setTest:function(b){b?e(a.DEPTH_TEST):f(a.DEPTH_TEST)},setMask:function(d){c===d||b||(a.depthMask(d),c=d)},setFunc:function(b){if(d!==
b){if(b)switch(b){case 0:a.depthFunc(a.NEVER);break;case 1:a.depthFunc(a.ALWAYS);break;case 2:a.depthFunc(a.LESS);break;case 3:a.depthFunc(a.LEQUAL);break;case 4:a.depthFunc(a.EQUAL);break;case 5:a.depthFunc(a.GEQUAL);break;case 6:a.depthFunc(a.GREATER);break;case 7:a.depthFunc(a.NOTEQUAL);break;default:a.depthFunc(a.LEQUAL)}else a.depthFunc(a.LEQUAL);d=b}},setLocked:function(a){b=a},setClear:function(b){g!==b&&(a.clearDepth(b),g=b)},reset:function(){b=!1;g=d=c=null}}},r=new function(){var b=!1,c=
null,d=null,g=null,h=null,k=null,m=null,n=null,p=null;return{setTest:function(b){b?e(a.STENCIL_TEST):f(a.STENCIL_TEST)},setMask:function(d){c===d||b||(a.stencilMask(d),c=d)},setFunc:function(b,c,e){if(d!==b||g!==c||h!==e)a.stencilFunc(b,c,e),d=b,g=c,h=e},setOp:function(b,c,d){if(k!==b||m!==c||n!==d)a.stencilOp(b,c,d),k=b,m=c,n=d},setLocked:function(a){b=a},setClear:function(b){p!==b&&(a.clearStencil(b),p=b)},reset:function(){b=!1;p=n=m=k=h=g=d=c=null}}},l=a.getParameter(a.MAX_VERTEX_ATTRIBS),u=new Uint8Array(l),
q=new Uint8Array(l),t=new Uint8Array(l),v={},M=null,z=null,A=null,I=null,E=null,K=null,y=null,J=null,ca=!1,C=null,D=null,G=null,O=null,P=null,R=null,T=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS),l=parseFloat(/^WebGL\ ([0-9])/.exec(a.getParameter(a.VERSION))[1]),H=1<=parseFloat(l),V=null,N={},L=new ga,S=new ga,Q={};Q[a.TEXTURE_2D]=d(a.TEXTURE_2D,a.TEXTURE_2D,1);Q[a.TEXTURE_CUBE_MAP]=d(a.TEXTURE_CUBE_MAP,a.TEXTURE_CUBE_MAP_POSITIVE_X,6);return{buffers:{color:p,depth:n,stencil:r},init:function(){p.setClear(0,
0,0,1);n.setClear(1);r.setClear(0);e(a.DEPTH_TEST);h(3);k(!1);m(1);e(a.CULL_FACE);e(a.BLEND);g(1)},initAttributes:function(){for(var a=0,b=u.length;a<b;a++)u[a]=0},enableAttribute:function(c){u[c]=1;0===q[c]&&(a.enableVertexAttribArray(c),q[c]=1);0!==t[c]&&(b.get("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(c,0),t[c]=0)},enableAttributeAndDivisor:function(b,c,d){u[b]=1;0===q[b]&&(a.enableVertexAttribArray(b),q[b]=1);t[b]!==c&&(d.vertexAttribDivisorANGLE(b,c),t[b]=c)},disableUnusedAttributes:function(){for(var b=
0,c=q.length;b!==c;++b)q[b]!==u[b]&&(a.disableVertexAttribArray(b),q[b]=0)},enable:e,disable:f,getCompressedTextureFormats:function(){if(null===M&&(M=[],b.get("WEBGL_compressed_texture_pvrtc")||b.get("WEBGL_compressed_texture_s3tc")||b.get("WEBGL_compressed_texture_etc1")))for(var c=a.getParameter(a.COMPRESSED_TEXTURE_FORMATS),d=0;d<c.length;d++)M.push(c[d]);return M},setBlending:g,setColorWrite:function(a){p.setMask(a)},setDepthTest:function(a){n.setTest(a)},setDepthWrite:function(a){n.setMask(a)},
setDepthFunc:h,setStencilTest:function(a){r.setTest(a)},setStencilWrite:function(a){r.setMask(a)},setStencilFunc:function(a,b,c){r.setFunc(a,b,c)},setStencilOp:function(a,b,c){r.setOp(a,b,c)},setFlipSided:k,setCullFace:m,setLineWidth:function(b){b!==G&&(H&&a.lineWidth(b),G=b)},setPolygonOffset:function(b,c,d){if(b){if(e(a.POLYGON_OFFSET_FILL),O!==c||P!==d)a.polygonOffset(c,d),O=c,P=d}else f(a.POLYGON_OFFSET_FILL)},getScissorTest:function(){return R},setScissorTest:function(b){(R=b)?e(a.SCISSOR_TEST):
f(a.SCISSOR_TEST)},activeTexture:x,bindTexture:function(b,c){null===V&&x();var d=N[V];void 0===d&&(d={type:void 0,texture:void 0},N[V]=d);if(d.type!==b||d.texture!==c)a.bindTexture(b,c||Q[b]),d.type=b,d.texture=c},compressedTexImage2D:function(){try{a.compressedTexImage2D.apply(a,arguments)}catch(b){console.error(b)}},texImage2D:function(){try{a.texImage2D.apply(a,arguments)}catch(b){console.error(b)}},scissor:function(b){!1===L.equals(b)&&(a.scissor(b.x,b.y,b.z,b.w),L.copy(b))},viewport:function(b){!1===
S.equals(b)&&(a.viewport(b.x,b.y,b.z,b.w),S.copy(b))},reset:function(){for(var b=0;b<q.length;b++)1===q[b]&&(a.disableVertexAttribArray(b),q[b]=0);v={};V=M=null;N={};D=C=z=null;p.reset();n.reset();r.reset()}}}function Hf(a,b,c){function d(b){if("highp"===b){if(0<a.getShaderPrecisionFormat(a.VERTEX_SHADER,a.HIGH_FLOAT).precision&&0<a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.HIGH_FLOAT).precision)return"highp";b="mediump"}return"mediump"===b&&0<a.getShaderPrecisionFormat(a.VERTEX_SHADER,a.MEDIUM_FLOAT).precision&&
0<a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.MEDIUM_FLOAT).precision?"mediump":"lowp"}var e,f=void 0!==c.precision?c.precision:"highp",g=d(f);g!==f&&(console.warn("THREE.WebGLRenderer:",f,"not supported, using",g,"instead."),f=g);c=!0===c.logarithmicDepthBuffer&&!!b.get("EXT_frag_depth");var g=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS),h=a.getParameter(a.MAX_VERTEX_TEXTURE_IMAGE_UNITS),k=a.getParameter(a.MAX_TEXTURE_SIZE),m=a.getParameter(a.MAX_CUBE_MAP_TEXTURE_SIZE),x=a.getParameter(a.MAX_VERTEX_ATTRIBS),
p=a.getParameter(a.MAX_VERTEX_UNIFORM_VECTORS),n=a.getParameter(a.MAX_VARYING_VECTORS),r=a.getParameter(a.MAX_FRAGMENT_UNIFORM_VECTORS),l=0<h,u=!!b.get("OES_texture_float");return{getMaxAnisotropy:function(){if(void 0!==e)return e;var c=b.get("EXT_texture_filter_anisotropic");return e=null!==c?a.getParameter(c.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:d,precision:f,logarithmicDepthBuffer:c,maxTextures:g,maxVertexTextures:h,maxTextureSize:k,maxCubemapSize:m,maxAttributes:x,maxVertexUniforms:p,
maxVaryings:n,maxFragmentUniforms:r,vertexTextures:l,floatFragmentTextures:u,floatVertexTextures:l&&u}}function If(a){var b={};return{get:function(c){if(void 0!==b[c])return b[c];var d;switch(c){case "WEBGL_depth_texture":d=a.getExtension("WEBGL_depth_texture")||a.getExtension("MOZ_WEBGL_depth_texture")||a.getExtension("WEBKIT_WEBGL_depth_texture");break;case "EXT_texture_filter_anisotropic":d=a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||
a.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case "WEBGL_compressed_texture_s3tc":d=a.getExtension("WEBGL_compressed_texture_s3tc")||a.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||a.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case "WEBGL_compressed_texture_pvrtc":d=a.getExtension("WEBGL_compressed_texture_pvrtc")||a.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;case "WEBGL_compressed_texture_etc1":d=a.getExtension("WEBGL_compressed_texture_etc1");
break;default:d=a.getExtension(c)}null===d&&console.warn("THREE.WebGLRenderer: "+c+" extension not supported.");return b[c]=d}}}function Jf(){function a(){m.value!==d&&(m.value=d,m.needsUpdate=0<e);c.numPlanes=e;c.numIntersection=0}function b(a,b,d,e){var f=null!==a?a.length:0,g=null;if(0!==f){g=m.value;if(!0!==e||null===g){e=d+4*f;b=b.matrixWorldInverse;k.getNormalMatrix(b);if(null===g||g.length<e)g=new Float32Array(e);for(e=0;e!==f;++e,d+=4)h.copy(a[e]).applyMatrix4(b,k),h.normal.toArray(g,d),g[d+
3]=h.constant}m.value=g;m.needsUpdate=!0}c.numPlanes=f;return g}var c=this,d=null,e=0,f=!1,g=!1,h=new ma,k=new za,m={value:null,needsUpdate:!1};this.uniform=m;this.numIntersection=this.numPlanes=0;this.init=function(a,c,g){var h=0!==a.length||c||0!==e||f;f=c;d=b(a,g,0);e=a.length;return h};this.beginShadows=function(){g=!0;b(null)};this.endShadows=function(){g=!1;a()};this.setState=function(c,h,k,r,l,u){if(!f||null===c||0===c.length||g&&!k)g?b(null):a();else{k=g?0:e;var q=4*k,t=l.clippingState||null;
m.value=t;t=b(c,r,q,u);for(c=0;c!==q;++c)t[c]=d[c];l.clippingState=t;this.numIntersection=h?this.numPlanes:0;this.numPlanes+=k}}}function Nd(a){function b(){Y.init();Y.scissor(X.copy(fa).multiplyScalar(Sa));Y.viewport(Z.copy(ia).multiplyScalar(Sa));Y.buffers.color.setClear(Ga.r,Ga.g,Ga.b,fb,K)}function c(){W=Q=null;U="";L=-1;Y.reset()}function d(a){a.preventDefault();c();b();ha.clear()}function e(a){a=a.target;a.removeEventListener("dispose",e);f(a);ha["delete"](a)}function f(a){var b=ha.get(a).program;
a.program=void 0;void 0!==b&&za.releaseProgram(b)}function g(a,b){return Math.abs(b[0])-Math.abs(a[0])}function h(a,b){return a.object.renderOrder!==b.object.renderOrder?a.object.renderOrder-b.object.renderOrder:a.material.program&&b.material.program&&a.material.program!==b.material.program?a.material.program.id-b.material.program.id:a.material.id!==b.material.id?a.material.id-b.material.id:a.z!==b.z?a.z-b.z:a.id-b.id}function k(a,b){return a.object.renderOrder!==b.object.renderOrder?a.object.renderOrder-
b.object.renderOrder:a.z!==b.z?b.z-a.z:a.id-b.id}function m(a,b,c,d,e){var f;c.transparent?(d=G,f=++Na):(d=ca,f=++C);f=d[f];void 0!==f?(f.id=a.id,f.object=a,f.geometry=b,f.material=c,f.z=ba.z,f.group=e):(f={id:a.id,object:a,geometry:b,material:c,z:ba.z,group:e},d.push(f))}function x(a){if(!na.intersectsSphere(a))return!1;var b=da.numPlanes;if(0===b)return!0;var c=T.clippingPlanes,d=a.center;a=-a.radius;var e=0;do if(c[e].distanceToPoint(d)<a)return!1;while(++e!==b);return!0}function p(a,b){if(!1!==
a.visible){if(0!==(a.layers.mask&b.layers.mask))if(a.isLight)J.push(a);else if(a.isSprite){var c;(c=!1===a.frustumCulled)||(oa.center.set(0,0,0),oa.radius=.7071067811865476,oa.applyMatrix4(a.matrixWorld),c=!0===x(oa));c&&P.push(a)}else if(a.isLensFlare)R.push(a);else if(a.isImmediateRenderObject)!0===T.sortObjects&&(ba.setFromMatrixPosition(a.matrixWorld),ba.applyProjection(sa)),m(a,null,a.material,ba.z,null);else if(a.isMesh||a.isLine||a.isPoints)if(a.isSkinnedMesh&&a.skeleton.update(),(c=!1===a.frustumCulled)||
(c=a.geometry,null===c.boundingSphere&&c.computeBoundingSphere(),oa.copy(c.boundingSphere).applyMatrix4(a.matrixWorld),c=!0===x(oa)),c){var d=a.material;if(!0===d.visible)if(!0===T.sortObjects&&(ba.setFromMatrixPosition(a.matrixWorld),ba.applyProjection(sa)),c=ta.update(a),d.isMultiMaterial)for(var e=c.groups,f=d.materials,d=0,g=e.length;d<g;d++){var h=e[d],k=f[h.materialIndex];!0===k.visible&&m(a,c,k,ba.z,h)}else m(a,c,d,ba.z,null)}c=a.children;d=0;for(g=c.length;d<g;d++)p(c[d],b)}}function n(a,
b,c,d){for(var e=0,f=a.length;e<f;e++){var g=a[e],h=g.object,k=g.geometry,m=void 0===d?g.material:d,g=g.group;h.modelViewMatrix.multiplyMatrices(c.matrixWorldInverse,h.matrixWorld);h.normalMatrix.getNormalMatrix(h.modelViewMatrix);h.onBeforeRender(T,b,c,k,m,g);if(h.isImmediateRenderObject){r(m);var n=l(c,b.fog,m,h);U="";h.render(function(a){T.renderBufferImmediate(a,n,m)})}else T.renderBufferDirect(c,b.fog,k,m,h,g);h.onAfterRender(T,b,c,k,m,g)}}function r(a){2===a.side?Y.disable(B.CULL_FACE):Y.enable(B.CULL_FACE);
Y.setFlipSided(1===a.side);!0===a.transparent?Y.setBlending(a.blending,a.blendEquation,a.blendSrc,a.blendDst,a.blendEquationAlpha,a.blendSrcAlpha,a.blendDstAlpha,a.premultipliedAlpha):Y.setBlending(0);Y.setDepthFunc(a.depthFunc);Y.setDepthTest(a.depthTest);Y.setDepthWrite(a.depthWrite);Y.setColorWrite(a.colorWrite);Y.setPolygonOffset(a.polygonOffset,a.polygonOffsetFactor,a.polygonOffsetUnits)}function l(a,b,c,d){ea=0;var g=ha.get(c);pa&&(ua||a!==W)&&da.setState(c.clippingPlanes,c.clipIntersection,
c.clipShadows,a,g,a===W&&c.id===L);!1===c.needsUpdate&&(void 0===g.program?c.needsUpdate=!0:c.fog&&g.fog!==b?c.needsUpdate=!0:c.lights&&g.lightsHash!==aa.hash?c.needsUpdate=!0:void 0===g.numClippingPlanes||g.numClippingPlanes===da.numPlanes&&g.numIntersection===da.numIntersection||(c.needsUpdate=!0));if(c.needsUpdate){a:{var h=ha.get(c),k=za.getParameters(c,aa,b,da.numPlanes,da.numIntersection,d),m=za.getProgramCode(c,k),n=h.program,p=!0;if(void 0===n)c.addEventListener("dispose",e);else if(n.code!==
m)f(c);else if(void 0!==k.shaderID)break a;else p=!1;p&&(k.shaderID?(n=Gb[k.shaderID],h.__webglShader={name:c.type,uniforms:Ja.clone(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader}):h.__webglShader={name:c.type,uniforms:c.uniforms,vertexShader:c.vertexShader,fragmentShader:c.fragmentShader},c.__webglShader=h.__webglShader,n=za.acquireProgram(c,k,m),h.program=n,c.program=n);k=n.getAttributes();if(c.morphTargets)for(m=c.numSupportedMorphTargets=0;m<T.maxMorphTargets;m++)0<=
k["morphTarget"+m]&&c.numSupportedMorphTargets++;if(c.morphNormals)for(m=c.numSupportedMorphNormals=0;m<T.maxMorphNormals;m++)0<=k["morphNormal"+m]&&c.numSupportedMorphNormals++;k=h.__webglShader.uniforms;if(!c.isShaderMaterial&&!c.isRawShaderMaterial||!0===c.clipping)h.numClippingPlanes=da.numPlanes,h.numIntersection=da.numIntersection,k.clippingPlanes=da.uniform;h.fog=b;h.lightsHash=aa.hash;c.lights&&(k.ambientLightColor.value=aa.ambient,k.directionalLights.value=aa.directional,k.spotLights.value=
aa.spot,k.rectAreaLights.value=aa.rectArea,k.pointLights.value=aa.point,k.hemisphereLights.value=aa.hemi,k.directionalShadowMap.value=aa.directionalShadowMap,k.directionalShadowMatrix.value=aa.directionalShadowMatrix,k.spotShadowMap.value=aa.spotShadowMap,k.spotShadowMatrix.value=aa.spotShadowMatrix,k.pointShadowMap.value=aa.pointShadowMap,k.pointShadowMatrix.value=aa.pointShadowMatrix);m=h.program.getUniforms();k=$a.seqWithValue(m.seq,k);h.uniformsList=k}c.needsUpdate=!1}var x=!1,p=n=!1,h=g.program,
k=h.getUniforms(),m=g.__webglShader.uniforms;h.id!==Q&&(B.useProgram(h.program),Q=h.id,p=n=x=!0);c.id!==L&&(L=c.id,n=!0);if(x||a!==W){k.set(B,a,"projectionMatrix");ma.logarithmicDepthBuffer&&k.setValue(B,"logDepthBufFC",2/(Math.log(a.far+1)/Math.LN2));a!==W&&(W=a,p=n=!0);if(c.isShaderMaterial||c.isMeshPhongMaterial||c.isMeshStandardMaterial||c.envMap)x=k.map.cameraPosition,void 0!==x&&x.setValue(B,ba.setFromMatrixPosition(a.matrixWorld));(c.isMeshPhongMaterial||c.isMeshLambertMaterial||c.isMeshBasicMaterial||
c.isMeshStandardMaterial||c.isShaderMaterial||c.skinning)&&k.setValue(B,"viewMatrix",a.matrixWorldInverse);k.set(B,T,"toneMappingExposure");k.set(B,T,"toneMappingWhitePoint")}c.skinning&&(k.setOptional(B,d,"bindMatrix"),k.setOptional(B,d,"bindMatrixInverse"),a=d.skeleton)&&(ma.floatVertexTextures&&a.useVertexTexture?(k.set(B,a,"boneTexture"),k.set(B,a,"boneTextureWidth"),k.set(B,a,"boneTextureHeight")):k.setOptional(B,a,"boneMatrices"));if(n){c.lights&&(a=p,m.ambientLightColor.needsUpdate=a,m.directionalLights.needsUpdate=
a,m.pointLights.needsUpdate=a,m.spotLights.needsUpdate=a,m.rectAreaLights.needsUpdate=a,m.hemisphereLights.needsUpdate=a);b&&c.fog&&(m.fogColor.value=b.color,b.isFog?(m.fogNear.value=b.near,m.fogFar.value=b.far):b.isFogExp2&&(m.fogDensity.value=b.density));if(c.isMeshBasicMaterial||c.isMeshLambertMaterial||c.isMeshPhongMaterial||c.isMeshStandardMaterial||c.isMeshNormalMaterial||c.isMeshDepthMaterial){m.opacity.value=c.opacity;m.diffuse.value=c.color;c.emissive&&m.emissive.value.copy(c.emissive).multiplyScalar(c.emissiveIntensity);
m.map.value=c.map;m.specularMap.value=c.specularMap;m.alphaMap.value=c.alphaMap;c.lightMap&&(m.lightMap.value=c.lightMap,m.lightMapIntensity.value=c.lightMapIntensity);c.aoMap&&(m.aoMap.value=c.aoMap,m.aoMapIntensity.value=c.aoMapIntensity);var r;c.map?r=c.map:c.specularMap?r=c.specularMap:c.displacementMap?r=c.displacementMap:c.normalMap?r=c.normalMap:c.bumpMap?r=c.bumpMap:c.roughnessMap?r=c.roughnessMap:c.metalnessMap?r=c.metalnessMap:c.alphaMap?r=c.alphaMap:c.emissiveMap&&(r=c.emissiveMap);void 0!==
r&&(r.isWebGLRenderTarget&&(r=r.texture),b=r.offset,r=r.repeat,m.offsetRepeat.value.set(b.x,b.y,r.x,r.y));m.envMap.value=c.envMap;m.flipEnvMap.value=c.envMap&&c.envMap.isCubeTexture?-1:1;m.reflectivity.value=c.reflectivity;m.refractionRatio.value=c.refractionRatio}c.isLineBasicMaterial?(m.diffuse.value=c.color,m.opacity.value=c.opacity):c.isLineDashedMaterial?(m.diffuse.value=c.color,m.opacity.value=c.opacity,m.dashSize.value=c.dashSize,m.totalSize.value=c.dashSize+c.gapSize,m.scale.value=c.scale):
c.isPointsMaterial?(m.diffuse.value=c.color,m.opacity.value=c.opacity,m.size.value=c.size*Sa,m.scale.value=.5*yc,m.map.value=c.map,null!==c.map&&(r=c.map.offset,c=c.map.repeat,m.offsetRepeat.value.set(r.x,r.y,c.x,c.y))):c.isMeshLambertMaterial?c.emissiveMap&&(m.emissiveMap.value=c.emissiveMap):c.isMeshToonMaterial?(u(m,c),c.gradientMap&&(m.gradientMap.value=c.gradientMap)):c.isMeshPhongMaterial?u(m,c):c.isMeshPhysicalMaterial?(m.clearCoat.value=c.clearCoat,m.clearCoatRoughness.value=c.clearCoatRoughness,
F(m,c)):c.isMeshStandardMaterial?F(m,c):c.isMeshDepthMaterial?c.displacementMap&&(m.displacementMap.value=c.displacementMap,m.displacementScale.value=c.displacementScale,m.displacementBias.value=c.displacementBias):c.isMeshNormalMaterial&&(c.bumpMap&&(m.bumpMap.value=c.bumpMap,m.bumpScale.value=c.bumpScale),c.normalMap&&(m.normalMap.value=c.normalMap,m.normalScale.value.copy(c.normalScale)),c.displacementMap&&(m.displacementMap.value=c.displacementMap,m.displacementScale.value=c.displacementScale,
m.displacementBias.value=c.displacementBias));void 0!==m.ltcMat&&(m.ltcMat.value=THREE.UniformsLib.LTC_MAT_TEXTURE);void 0!==m.ltcMag&&(m.ltcMag.value=THREE.UniformsLib.LTC_MAG_TEXTURE);$a.upload(B,g.uniformsList,m,T)}k.set(B,d,"modelViewMatrix");k.set(B,d,"normalMatrix");k.setValue(B,"modelMatrix",d.matrixWorld);return h}function u(a,b){a.specular.value=b.specular;a.shininess.value=Math.max(b.shininess,1E-4);b.emissiveMap&&(a.emissiveMap.value=b.emissiveMap);b.bumpMap&&(a.bumpMap.value=b.bumpMap,
a.bumpScale.value=b.bumpScale);b.normalMap&&(a.normalMap.value=b.normalMap,a.normalScale.value.copy(b.normalScale));b.displacementMap&&(a.displacementMap.value=b.displacementMap,a.displacementScale.value=b.displacementScale,a.displacementBias.value=b.displacementBias)}function F(a,b){a.roughness.value=b.roughness;a.metalness.value=b.metalness;b.roughnessMap&&(a.roughnessMap.value=b.roughnessMap);b.metalnessMap&&(a.metalnessMap.value=b.metalnessMap);b.emissiveMap&&(a.emissiveMap.value=b.emissiveMap);
b.bumpMap&&(a.bumpMap.value=b.bumpMap,a.bumpScale.value=b.bumpScale);b.normalMap&&(a.normalMap.value=b.normalMap,a.normalScale.value.copy(b.normalScale));b.displacementMap&&(a.displacementMap.value=b.displacementMap,a.displacementScale.value=b.displacementScale,a.displacementBias.value=b.displacementBias);b.envMap&&(a.envMapIntensity.value=b.envMapIntensity)}function t(a){var b;if(1E3===a)return B.REPEAT;if(1001===a)return B.CLAMP_TO_EDGE;if(1002===a)return B.MIRRORED_REPEAT;if(1003===a)return B.NEAREST;
if(1004===a)return B.NEAREST_MIPMAP_NEAREST;if(1005===a)return B.NEAREST_MIPMAP_LINEAR;if(1006===a)return B.LINEAR;if(1007===a)return B.LINEAR_MIPMAP_NEAREST;if(1008===a)return B.LINEAR_MIPMAP_LINEAR;if(1009===a)return B.UNSIGNED_BYTE;if(1017===a)return B.UNSIGNED_SHORT_4_4_4_4;if(1018===a)return B.UNSIGNED_SHORT_5_5_5_1;if(1019===a)return B.UNSIGNED_SHORT_5_6_5;if(1010===a)return B.BYTE;if(1011===a)return B.SHORT;if(1012===a)return B.UNSIGNED_SHORT;if(1013===a)return B.INT;if(1014===a)return B.UNSIGNED_INT;
if(1015===a)return B.FLOAT;if(1016===a&&(b=ja.get("OES_texture_half_float"),null!==b))return b.HALF_FLOAT_OES;if(1021===a)return B.ALPHA;if(1022===a)return B.RGB;if(1023===a)return B.RGBA;if(1024===a)return B.LUMINANCE;if(1025===a)return B.LUMINANCE_ALPHA;if(1026===a)return B.DEPTH_COMPONENT;if(1027===a)return B.DEPTH_STENCIL;if(100===a)return B.FUNC_ADD;if(101===a)return B.FUNC_SUBTRACT;if(102===a)return B.FUNC_REVERSE_SUBTRACT;if(200===a)return B.ZERO;if(201===a)return B.ONE;if(202===a)return B.SRC_COLOR;
if(203===a)return B.ONE_MINUS_SRC_COLOR;if(204===a)return B.SRC_ALPHA;if(205===a)return B.ONE_MINUS_SRC_ALPHA;if(206===a)return B.DST_ALPHA;if(207===a)return B.ONE_MINUS_DST_ALPHA;if(208===a)return B.DST_COLOR;if(209===a)return B.ONE_MINUS_DST_COLOR;if(210===a)return B.SRC_ALPHA_SATURATE;if(2001===a||2002===a||2003===a||2004===a)if(b=ja.get("WEBGL_compressed_texture_s3tc"),null!==b){if(2001===a)return b.COMPRESSED_RGB_S3TC_DXT1_EXT;if(2002===a)return b.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(2003===a)return b.COMPRESSED_RGBA_S3TC_DXT3_EXT;
if(2004===a)return b.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(2100===a||2101===a||2102===a||2103===a)if(b=ja.get("WEBGL_compressed_texture_pvrtc"),null!==b){if(2100===a)return b.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(2101===a)return b.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(2102===a)return b.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(2103===a)return b.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(2151===a&&(b=ja.get("WEBGL_compressed_texture_etc1"),null!==b))return b.COMPRESSED_RGB_ETC1_WEBGL;if(103===a||104===a)if(b=ja.get("EXT_blend_minmax"),
null!==b){if(103===a)return b.MIN_EXT;if(104===a)return b.MAX_EXT}return 1020===a&&(b=ja.get("WEBGL_depth_texture"),null!==b)?b.UNSIGNED_INT_24_8_WEBGL:0}console.log("THREE.WebGLRenderer","83");a=a||{};var v=void 0!==a.canvas?a.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),M=void 0!==a.context?a.context:null,z=void 0!==a.alpha?a.alpha:!1,A=void 0!==a.depth?a.depth:!0,I=void 0!==a.stencil?a.stencil:!0,E=void 0!==a.antialias?a.antialias:!1,K=void 0!==a.premultipliedAlpha?
a.premultipliedAlpha:!0,y=void 0!==a.preserveDrawingBuffer?a.preserveDrawingBuffer:!1,J=[],ca=[],C=-1,G=[],Na=-1,O=new Float32Array(8),P=[],R=[];this.domElement=v;this.context=null;this.sortObjects=this.autoClearStencil=this.autoClearDepth=this.autoClearColor=this.autoClear=!0;this.clippingPlanes=[];this.localClippingEnabled=!1;this.gammaFactor=2;this.physicallyCorrectLights=this.gammaOutput=this.gammaInput=!1;this.toneMappingWhitePoint=this.toneMappingExposure=this.toneMapping=1;this.maxMorphTargets=
8;this.maxMorphNormals=4;var T=this,Q=null,V=null,S=null,L=-1,U="",W=null,X=new ga,Ta=null,Z=new ga,ea=0,Ga=new N(0),fb=0,fd=v.width,yc=v.height,Sa=1,fa=new ga(0,0,fd,yc),ka=!1,ia=new ga(0,0,fd,yc),na=new qc,da=new Jf,pa=!1,ua=!1,oa=new Fa,sa=new H,ba=new q,wa=new H,xa=new H,aa={hash:"",ambient:[0,0,0],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],shadows:[]},qa={calls:0,
vertices:0,faces:0,points:0};this.info={render:qa,memory:{geometries:0,textures:0},programs:null};var B;try{z={alpha:z,depth:A,stencil:I,antialias:E,premultipliedAlpha:K,preserveDrawingBuffer:y};B=M||v.getContext("webgl",z)||v.getContext("experimental-webgl",z);if(null===B){if(null!==v.getContext("webgl"))throw"Error creating WebGL context with your selected attributes.";throw"Error creating WebGL context.";}void 0===B.getShaderPrecisionFormat&&(B.getShaderPrecisionFormat=function(){return{rangeMin:1,
rangeMax:1,precision:1}});v.addEventListener("webglcontextlost",d,!1)}catch(Kf){console.error("THREE.WebGLRenderer: "+Kf)}var ja=new If(B);ja.get("WEBGL_depth_texture");ja.get("OES_texture_float");ja.get("OES_texture_float_linear");ja.get("OES_texture_half_float");ja.get("OES_texture_half_float_linear");ja.get("OES_standard_derivatives");ja.get("ANGLE_instanced_arrays");ja.get("OES_element_index_uint")&&(D.MaxIndex=4294967296);var ma=new Hf(B,ja,a),Y=new Gf(B,ja,t),ha=new Ff,va=new Ef(B,ja,Y,ha,ma,
t,this.info),ta=new Df(B,ha,this.info),za=new Bf(this,ma),Aa=new tf;this.info.programs=za.programs;var La=new sf(B,ja,qa),Ma=new rf(B,ja,qa),Oa=new Hb(-1,1,1,-1,0,1),Ca=new Ha,Ea=new Ba(new ib(2,2),new Ka({depthTest:!1,depthWrite:!1,fog:!1}));a=Gb.cube;var ya=new Ba(new hb(5,5,5),new Ia({uniforms:a.uniforms,vertexShader:a.vertexShader,fragmentShader:a.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1}));b();this.context=B;this.capabilities=ma;this.extensions=ja;this.properties=ha;this.state=
Y;var Pa=new ye(this,aa,ta,ma);this.shadowMap=Pa;var Qa=new of(this,P),Ra=new nf(this,R);this.getContext=function(){return B};this.getContextAttributes=function(){return B.getContextAttributes()};this.forceContextLoss=function(){ja.get("WEBGL_lose_context").loseContext()};this.getMaxAnisotropy=function(){return ma.getMaxAnisotropy()};this.getPrecision=function(){return ma.precision};this.getPixelRatio=function(){return Sa};this.setPixelRatio=function(a){void 0!==a&&(Sa=a,this.setSize(ia.z,ia.w,!1))};
this.getSize=function(){return{width:fd,height:yc}};this.setSize=function(a,b,c){fd=a;yc=b;v.width=a*Sa;v.height=b*Sa;!1!==c&&(v.style.width=a+"px",v.style.height=b+"px");this.setViewport(0,0,a,b)};this.setViewport=function(a,b,c,d){Y.viewport(ia.set(a,b,c,d))};this.setScissor=function(a,b,c,d){Y.scissor(fa.set(a,b,c,d))};this.setScissorTest=function(a){Y.setScissorTest(ka=a)};this.getClearColor=function(){return Ga};this.setClearColor=function(a,b){Ga.set(a);fb=void 0!==b?b:1;Y.buffers.color.setClear(Ga.r,
Ga.g,Ga.b,fb,K)};this.getClearAlpha=function(){return fb};this.setClearAlpha=function(a){fb=a;Y.buffers.color.setClear(Ga.r,Ga.g,Ga.b,fb,K)};this.clear=function(a,b,c){var d=0;if(void 0===a||a)d|=B.COLOR_BUFFER_BIT;if(void 0===b||b)d|=B.DEPTH_BUFFER_BIT;if(void 0===c||c)d|=B.STENCIL_BUFFER_BIT;B.clear(d)};this.clearColor=function(){this.clear(!0,!1,!1)};this.clearDepth=function(){this.clear(!1,!0,!1)};this.clearStencil=function(){this.clear(!1,!1,!0)};this.clearTarget=function(a,b,c,d){this.setRenderTarget(a);
this.clear(b,c,d)};this.resetGLState=c;this.dispose=function(){G=[];Na=-1;ca=[];C=-1;v.removeEventListener("webglcontextlost",d,!1)};this.renderBufferImmediate=function(a,b,c){Y.initAttributes();var d=ha.get(a);a.hasPositions&&!d.position&&(d.position=B.createBuffer());a.hasNormals&&!d.normal&&(d.normal=B.createBuffer());a.hasUvs&&!d.uv&&(d.uv=B.createBuffer());a.hasColors&&!d.color&&(d.color=B.createBuffer());b=b.getAttributes();a.hasPositions&&(B.bindBuffer(B.ARRAY_BUFFER,d.position),B.bufferData(B.ARRAY_BUFFER,
a.positionArray,B.DYNAMIC_DRAW),Y.enableAttribute(b.position),B.vertexAttribPointer(b.position,3,B.FLOAT,!1,0,0));if(a.hasNormals){B.bindBuffer(B.ARRAY_BUFFER,d.normal);if(!c.isMeshPhongMaterial&&!c.isMeshStandardMaterial&&!c.isMeshNormalMaterial&&1===c.shading)for(var e=0,f=3*a.count;e<f;e+=9){var g=a.normalArray,h=(g[e+0]+g[e+3]+g[e+6])/3,k=(g[e+1]+g[e+4]+g[e+7])/3,m=(g[e+2]+g[e+5]+g[e+8])/3;g[e+0]=h;g[e+1]=k;g[e+2]=m;g[e+3]=h;g[e+4]=k;g[e+5]=m;g[e+6]=h;g[e+7]=k;g[e+8]=m}B.bufferData(B.ARRAY_BUFFER,
a.normalArray,B.DYNAMIC_DRAW);Y.enableAttribute(b.normal);B.vertexAttribPointer(b.normal,3,B.FLOAT,!1,0,0)}a.hasUvs&&c.map&&(B.bindBuffer(B.ARRAY_BUFFER,d.uv),B.bufferData(B.ARRAY_BUFFER,a.uvArray,B.DYNAMIC_DRAW),Y.enableAttribute(b.uv),B.vertexAttribPointer(b.uv,2,B.FLOAT,!1,0,0));a.hasColors&&0!==c.vertexColors&&(B.bindBuffer(B.ARRAY_BUFFER,d.color),B.bufferData(B.ARRAY_BUFFER,a.colorArray,B.DYNAMIC_DRAW),Y.enableAttribute(b.color),B.vertexAttribPointer(b.color,3,B.FLOAT,!1,0,0));Y.disableUnusedAttributes();
B.drawArrays(B.TRIANGLES,0,a.count);a.count=0};this.renderBufferDirect=function(a,b,c,d,e,f){r(d);var h=l(a,b,d,e),k=!1;a=c.id+"_"+h.id+"_"+d.wireframe;a!==U&&(U=a,k=!0);b=e.morphTargetInfluences;if(void 0!==b){var m=[];a=0;for(var n=b.length;a<n;a++)k=b[a],m.push([k,a]);m.sort(g);8<m.length&&(m.length=8);var p=c.morphAttributes;a=0;for(n=m.length;a<n;a++)k=m[a],O[a]=k[0],0!==k[0]?(b=k[1],!0===d.morphTargets&&p.position&&c.addAttribute("morphTarget"+a,p.position[b]),!0===d.morphNormals&&p.normal&&
c.addAttribute("morphNormal"+a,p.normal[b])):(!0===d.morphTargets&&c.removeAttribute("morphTarget"+a),!0===d.morphNormals&&c.removeAttribute("morphNormal"+a));a=m.length;for(b=O.length;a<b;a++)O[a]=0;h.getUniforms().setValue(B,"morphTargetInfluences",O);k=!0}b=c.index;n=c.attributes.position;m=1;!0===d.wireframe&&(b=ta.getWireframeAttribute(c),m=2);null!==b?(a=Ma,a.setIndex(b)):a=La;if(k){a:{var k=void 0,x;if(c&&c.isInstancedBufferGeometry&&(x=ja.get("ANGLE_instanced_arrays"),null===x)){console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");
break a}void 0===k&&(k=0);Y.initAttributes();var p=c.attributes,h=h.getAttributes(),u=d.defaultAttributeValues,q;for(q in h){var v=h[q];if(0<=v){var t=p[q];if(void 0!==t){var z=t.normalized,F=t.itemSize,I=ta.getAttributeProperties(t),E=I.__webglBuffer,M=I.type,I=I.bytesPerElement;if(t.isInterleavedBufferAttribute){var A=t.data,K=A.stride,t=t.offset;A&&A.isInstancedInterleavedBuffer?(Y.enableAttributeAndDivisor(v,A.meshPerAttribute,x),void 0===c.maxInstancedCount&&(c.maxInstancedCount=A.meshPerAttribute*
A.count)):Y.enableAttribute(v);B.bindBuffer(B.ARRAY_BUFFER,E);B.vertexAttribPointer(v,F,M,z,K*I,(k*K+t)*I)}else t.isInstancedBufferAttribute?(Y.enableAttributeAndDivisor(v,t.meshPerAttribute,x),void 0===c.maxInstancedCount&&(c.maxInstancedCount=t.meshPerAttribute*t.count)):Y.enableAttribute(v),B.bindBuffer(B.ARRAY_BUFFER,E),B.vertexAttribPointer(v,F,M,z,0,k*F*I)}else if(void 0!==u&&(z=u[q],void 0!==z))switch(z.length){case 2:B.vertexAttrib2fv(v,z);break;case 3:B.vertexAttrib3fv(v,z);break;case 4:B.vertexAttrib4fv(v,
z);break;default:B.vertexAttrib1fv(v,z)}}}Y.disableUnusedAttributes()}null!==b&&B.bindBuffer(B.ELEMENT_ARRAY_BUFFER,ta.getAttributeBuffer(b))}x=0;null!==b?x=b.count:void 0!==n&&(x=n.count);b=c.drawRange.start*m;n=null!==f?f.start*m:0;q=Math.max(b,n);f=Math.max(0,Math.min(x,b+c.drawRange.count*m,n+(null!==f?f.count*m:Infinity))-1-q+1);if(0!==f){if(e.isMesh)if(!0===d.wireframe)Y.setLineWidth(d.wireframeLinewidth*(null===V?Sa:1)),a.setMode(B.LINES);else switch(e.drawMode){case 0:a.setMode(B.TRIANGLES);
break;case 1:a.setMode(B.TRIANGLE_STRIP);break;case 2:a.setMode(B.TRIANGLE_FAN)}else e.isLine?(d=d.linewidth,void 0===d&&(d=1),Y.setLineWidth(d*(null===V?Sa:1)),e.isLineSegments?a.setMode(B.LINES):a.setMode(B.LINE_STRIP)):e.isPoints&&a.setMode(B.POINTS);c&&c.isInstancedBufferGeometry?0<c.maxInstancedCount&&a.renderInstances(c,q,f):a.render(q,f)}};this.render=function(a,b,c,d){if(void 0!==b&&!0!==b.isCamera)console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");else{U=
"";L=-1;W=null;!0===a.autoUpdate&&a.updateMatrixWorld();null===b.parent&&b.updateMatrixWorld();b.matrixWorldInverse.getInverse(b.matrixWorld);sa.multiplyMatrices(b.projectionMatrix,b.matrixWorldInverse);na.setFromMatrix(sa);J.length=0;Na=C=-1;P.length=0;R.length=0;ua=this.localClippingEnabled;pa=da.init(this.clippingPlanes,ua,b);p(a,b);ca.length=C+1;G.length=Na+1;!0===T.sortObjects&&(ca.sort(h),G.sort(k));pa&&da.beginShadows();for(var e=J,f=0,g=0,m=e.length;g<m;g++){var x=e[g];x.castShadow&&(aa.shadows[f++]=
x)}aa.shadows.length=f;Pa.render(a,b);for(var e=J,r=x=0,l=0,w,u,v,q,t=b.matrixWorldInverse,z=0,F=0,I=0,E=0,M=0,f=0,g=e.length;f<g;f++)if(m=e[f],w=m.color,u=m.intensity,v=m.distance,q=m.shadow&&m.shadow.map?m.shadow.map.texture:null,m.isAmbientLight)x+=w.r*u,r+=w.g*u,l+=w.b*u;else if(m.isDirectionalLight){var A=Aa.get(m);A.color.copy(m.color).multiplyScalar(m.intensity);A.direction.setFromMatrixPosition(m.matrixWorld);ba.setFromMatrixPosition(m.target.matrixWorld);A.direction.sub(ba);A.direction.transformDirection(t);
if(A.shadow=m.castShadow)A.shadowBias=m.shadow.bias,A.shadowRadius=m.shadow.radius,A.shadowMapSize=m.shadow.mapSize;aa.directionalShadowMap[z]=q;aa.directionalShadowMatrix[z]=m.shadow.matrix;aa.directional[z++]=A}else if(m.isSpotLight){A=Aa.get(m);A.position.setFromMatrixPosition(m.matrixWorld);A.position.applyMatrix4(t);A.color.copy(w).multiplyScalar(u);A.distance=v;A.direction.setFromMatrixPosition(m.matrixWorld);ba.setFromMatrixPosition(m.target.matrixWorld);A.direction.sub(ba);A.direction.transformDirection(t);
A.coneCos=Math.cos(m.angle);A.penumbraCos=Math.cos(m.angle*(1-m.penumbra));A.decay=0===m.distance?0:m.decay;if(A.shadow=m.castShadow)A.shadowBias=m.shadow.bias,A.shadowRadius=m.shadow.radius,A.shadowMapSize=m.shadow.mapSize;aa.spotShadowMap[I]=q;aa.spotShadowMatrix[I]=m.shadow.matrix;aa.spot[I++]=A}else if(m.isRectAreaLight)A=Aa.get(m),A.color.copy(w).multiplyScalar(u/(m.width*m.height)),A.position.setFromMatrixPosition(m.matrixWorld),A.position.applyMatrix4(t),xa.identity(),wa.copy(m.matrixWorld),
wa.premultiply(t),xa.extractRotation(wa),A.halfWidth.set(.5*m.width,0,0),A.halfHeight.set(0,.5*m.height,0),A.halfWidth.applyMatrix4(xa),A.halfHeight.applyMatrix4(xa),aa.rectArea[E++]=A;else if(m.isPointLight){A=Aa.get(m);A.position.setFromMatrixPosition(m.matrixWorld);A.position.applyMatrix4(t);A.color.copy(m.color).multiplyScalar(m.intensity);A.distance=m.distance;A.decay=0===m.distance?0:m.decay;if(A.shadow=m.castShadow)A.shadowBias=m.shadow.bias,A.shadowRadius=m.shadow.radius,A.shadowMapSize=m.shadow.mapSize;
aa.pointShadowMap[F]=q;void 0===aa.pointShadowMatrix[F]&&(aa.pointShadowMatrix[F]=new H);ba.setFromMatrixPosition(m.matrixWorld).negate();aa.pointShadowMatrix[F].identity().setPosition(ba);aa.point[F++]=A}else m.isHemisphereLight&&(A=Aa.get(m),A.direction.setFromMatrixPosition(m.matrixWorld),A.direction.transformDirection(t),A.direction.normalize(),A.skyColor.copy(m.color).multiplyScalar(u),A.groundColor.copy(m.groundColor).multiplyScalar(u),aa.hemi[M++]=A);aa.ambient[0]=x;aa.ambient[1]=r;aa.ambient[2]=
l;aa.directional.length=z;aa.spot.length=I;aa.rectArea.length=E;aa.point.length=F;aa.hemi.length=M;aa.hash=z+","+F+","+I+","+E+","+M+","+aa.shadows.length;pa&&da.endShadows();qa.calls=0;qa.vertices=0;qa.faces=0;qa.points=0;void 0===c&&(c=null);this.setRenderTarget(c);e=a.background;null===e?Y.buffers.color.setClear(Ga.r,Ga.g,Ga.b,fb,K):e&&e.isColor&&(Y.buffers.color.setClear(e.r,e.g,e.b,1,K),d=!0);(this.autoClear||d)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil);e&&e.isCubeTexture?
(Ca.projectionMatrix.copy(b.projectionMatrix),Ca.matrixWorld.extractRotation(b.matrixWorld),Ca.matrixWorldInverse.getInverse(Ca.matrixWorld),ya.material.uniforms.tCube.value=e,ya.modelViewMatrix.multiplyMatrices(Ca.matrixWorldInverse,ya.matrixWorld),ta.update(ya),T.renderBufferDirect(Ca,null,ya.geometry,ya.material,ya,null)):e&&e.isTexture&&(Ea.material.map=e,ta.update(Ea),T.renderBufferDirect(Oa,null,Ea.geometry,Ea.material,Ea,null));a.overrideMaterial?(d=a.overrideMaterial,n(ca,a,b,d),n(G,a,b,d)):
(Y.setBlending(0),n(ca,a,b),n(G,a,b));Qa.render(a,b);Ra.render(a,b,Z);c&&va.updateRenderTargetMipmap(c);Y.setDepthTest(!0);Y.setDepthWrite(!0);Y.setColorWrite(!0)}};this.setFaceCulling=function(a,b){Y.setCullFace(a);Y.setFlipSided(0===b)};this.allocTextureUnit=function(){var a=ea;a>=ma.maxTextures&&console.warn("WebGLRenderer: trying to use "+a+" texture units while this GPU supports only "+ma.maxTextures);ea+=1;return a};this.setTexture2D=function(){var a=!1;return function(b,c){b&&b.isWebGLRenderTarget&&
(a||(console.warn("THREE.WebGLRenderer.setTexture2D: don't use render targets as textures. Use their .texture property instead."),a=!0),b=b.texture);va.setTexture2D(b,c)}}();this.setTexture=function(){var a=!1;return function(b,c){a||(console.warn("THREE.WebGLRenderer: .setTexture is deprecated, use setTexture2D instead."),a=!0);va.setTexture2D(b,c)}}();this.setTextureCube=function(){var a=!1;return function(b,c){b&&b.isWebGLRenderTargetCube&&(a||(console.warn("THREE.WebGLRenderer.setTextureCube: don't use cube render targets as textures. Use their .texture property instead."),
a=!0),b=b.texture);b&&b.isCubeTexture||Array.isArray(b.image)&&6===b.image.length?va.setTextureCube(b,c):va.setTextureCubeDynamic(b,c)}}();this.getCurrentRenderTarget=function(){return V};this.setRenderTarget=function(a){(V=a)&&void 0===ha.get(a).__webglFramebuffer&&va.setupRenderTarget(a);var b=a&&a.isWebGLRenderTargetCube,c;a?(c=ha.get(a),c=b?c.__webglFramebuffer[a.activeCubeFace]:c.__webglFramebuffer,X.copy(a.scissor),Ta=a.scissorTest,Z.copy(a.viewport)):(c=null,X.copy(fa).multiplyScalar(Sa),Ta=
ka,Z.copy(ia).multiplyScalar(Sa));S!==c&&(B.bindFramebuffer(B.FRAMEBUFFER,c),S=c);Y.scissor(X);Y.setScissorTest(Ta);Y.viewport(Z);b&&(b=ha.get(a.texture),B.framebufferTexture2D(B.FRAMEBUFFER,B.COLOR_ATTACHMENT0,B.TEXTURE_CUBE_MAP_POSITIVE_X+a.activeCubeFace,b.__webglTexture,a.activeMipMapLevel))};this.readRenderTargetPixels=function(a,b,c,d,e,f){if(!1===(a&&a.isWebGLRenderTarget))console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");else{var g=ha.get(a).__webglFramebuffer;
if(g){var h=!1;g!==S&&(B.bindFramebuffer(B.FRAMEBUFFER,g),h=!0);try{var k=a.texture,m=k.format,n=k.type;1023!==m&&t(m)!==B.getParameter(B.IMPLEMENTATION_COLOR_READ_FORMAT)?console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format."):1009===n||t(n)===B.getParameter(B.IMPLEMENTATION_COLOR_READ_TYPE)||1015===n&&(ja.get("OES_texture_float")||ja.get("WEBGL_color_buffer_float"))||1016===n&&ja.get("EXT_color_buffer_half_float")?B.checkFramebufferStatus(B.FRAMEBUFFER)===
B.FRAMEBUFFER_COMPLETE?0<=b&&b<=a.width-d&&0<=c&&c<=a.height-e&&B.readPixels(b,c,d,e,t(m),t(n),f):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete."):console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.")}finally{h&&B.bindFramebuffer(B.FRAMEBUFFER,S)}}}}}function Ib(a,b){this.name="";this.color=new N(a);this.density=void 0!==b?b:2.5E-4}function Jb(a,
b,c){this.name="";this.color=new N(a);this.near=void 0!==b?b:1;this.far=void 0!==c?c:1E3}function jb(){G.call(this);this.type="Scene";this.overrideMaterial=this.fog=this.background=null;this.autoUpdate=!0}function Od(a,b,c,d,e){G.call(this);this.lensFlares=[];this.positionScreen=new q;this.customUpdateCallback=void 0;void 0!==a&&this.add(a,b,c,d,e)}function kb(a){W.call(this);this.type="SpriteMaterial";this.color=new N(16777215);this.map=null;this.rotation=0;this.lights=this.fog=!1;this.setValues(a)}
function zc(a){G.call(this);this.type="Sprite";this.material=void 0!==a?a:new kb}function Ac(){G.call(this);this.type="LOD";Object.defineProperties(this,{levels:{enumerable:!0,value:[]}})}function hd(a,b,c){this.useVertexTexture=void 0!==c?c:!0;this.identityMatrix=new H;a=a||[];this.bones=a.slice(0);this.useVertexTexture?(a=Math.sqrt(4*this.bones.length),a=Q.nextPowerOfTwo(Math.ceil(a)),this.boneTextureHeight=this.boneTextureWidth=a=Math.max(a,4),this.boneMatrices=new Float32Array(this.boneTextureWidth*
this.boneTextureHeight*4),this.boneTexture=new db(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,1023,1015)):this.boneMatrices=new Float32Array(16*this.bones.length);if(void 0===b)this.calculateInverses();else if(this.bones.length===b.length)this.boneInverses=b.slice(0);else for(console.warn("THREE.Skeleton bonInverses is the wrong length."),this.boneInverses=[],b=0,a=this.bones.length;b<a;b++)this.boneInverses.push(new H)}function id(){G.call(this);this.type="Bone"}function jd(a,
b,c){Ba.call(this,a,b);this.type="SkinnedMesh";this.bindMode="attached";this.bindMatrix=new H;this.bindMatrixInverse=new H;a=[];if(this.geometry&&void 0!==this.geometry.bones){for(var d,e=0,f=this.geometry.bones.length;e<f;++e)d=this.geometry.bones[e],b=new id,a.push(b),b.name=d.name,b.position.fromArray(d.pos),b.quaternion.fromArray(d.rotq),void 0!==d.scl&&b.scale.fromArray(d.scl);e=0;for(f=this.geometry.bones.length;e<f;++e)d=this.geometry.bones[e],-1!==d.parent&&null!==d.parent&&void 0!==a[d.parent]?
a[d.parent].add(a[e]):this.add(a[e])}this.normalizeSkinWeights();this.updateMatrixWorld(!0);this.bind(new hd(a,void 0,c),this.matrixWorld)}function ia(a){W.call(this);this.type="LineBasicMaterial";this.color=new N(16777215);this.linewidth=1;this.linejoin=this.linecap="round";this.lights=!1;this.setValues(a)}function Va(a,b,c){if(1===c)return console.warn("THREE.Line: parameter THREE.LinePieces no longer supported. Created THREE.LineSegments instead."),new fa(a,b);G.call(this);this.type="Line";this.geometry=
void 0!==a?a:new D;this.material=void 0!==b?b:new ia({color:16777215*Math.random()})}function fa(a,b){Va.call(this,a,b);this.type="LineSegments"}function Oa(a){W.call(this);this.type="PointsMaterial";this.color=new N(16777215);this.map=null;this.size=1;this.sizeAttenuation=!0;this.lights=!1;this.setValues(a)}function Kb(a,b){G.call(this);this.type="Points";this.geometry=void 0!==a?a:new D;this.material=void 0!==b?b:new Oa({color:16777215*Math.random()})}function Bc(){G.call(this);this.type="Group"}
function kd(a,b,c,d,e,f,g,h,k){function m(){requestAnimationFrame(m);a.readyState>=a.HAVE_CURRENT_DATA&&(x.needsUpdate=!0)}ea.call(this,a,b,c,d,e,f,g,h,k);this.generateMipmaps=!1;var x=this;m()}function Lb(a,b,c,d,e,f,g,h,k,m,x,p){ea.call(this,null,f,g,h,k,m,d,e,x,p);this.image={width:b,height:c};this.mipmaps=a;this.generateMipmaps=this.flipY=!1}function ld(a,b,c,d,e,f,g,h,k){ea.call(this,a,b,c,d,e,f,g,h,k);this.needsUpdate=!0}function Cc(a,b,c,d,e,f,g,h,k,m){m=void 0!==m?m:1026;if(1026!==m&&1027!==
m)throw Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===c&&1026===m&&(c=1012);void 0===c&&1027===m&&(c=1020);ea.call(this,null,d,e,f,g,h,m,c,k);this.image={width:a,height:b};this.magFilter=void 0!==g?g:1003;this.minFilter=void 0!==h?h:1003;this.generateMipmaps=this.flipY=!1}function Mb(a){function b(a,b){return a-b}D.call(this);var c=[0,0],d={},e=["a","b","c"];if(a&&a.isGeometry){var f=a.vertices,g=a.faces,h=0,k=new Uint32Array(6*g.length);a=0;for(var m=
g.length;a<m;a++)for(var x=g[a],p=0;3>p;p++){c[0]=x[e[p]];c[1]=x[e[(p+1)%3]];c.sort(b);var n=c.toString();void 0===d[n]&&(k[2*h]=c[0],k[2*h+1]=c[1],d[n]=!0,h++)}c=new Float32Array(6*h);a=0;for(m=h;a<m;a++)for(p=0;2>p;p++)d=f[k[2*a+p]],h=6*a+3*p,c[h+0]=d.x,c[h+1]=d.y,c[h+2]=d.z;this.addAttribute("position",new y(c,3))}else if(a&&a.isBufferGeometry){if(null!==a.index){m=a.index.array;f=a.attributes.position;e=a.groups;h=0;0===e.length&&a.addGroup(0,m.length);k=new Uint32Array(2*m.length);g=0;for(x=
e.length;g<x;++g){a=e[g];p=a.start;n=a.count;a=p;for(var r=p+n;a<r;a+=3)for(p=0;3>p;p++)c[0]=m[a+p],c[1]=m[a+(p+1)%3],c.sort(b),n=c.toString(),void 0===d[n]&&(k[2*h]=c[0],k[2*h+1]=c[1],d[n]=!0,h++)}c=new Float32Array(6*h);a=0;for(m=h;a<m;a++)for(p=0;2>p;p++)h=6*a+3*p,d=k[2*a+p],c[h+0]=f.getX(d),c[h+1]=f.getY(d),c[h+2]=f.getZ(d)}else for(f=a.attributes.position.array,h=f.length/3,k=h/3,c=new Float32Array(6*h),a=0,m=k;a<m;a++)for(p=0;3>p;p++)h=18*a+6*p,k=9*a+3*p,c[h+0]=f[k],c[h+1]=f[k+1],c[h+2]=f[k+
2],d=9*a+(p+1)%3*3,c[h+3]=f[d],c[h+4]=f[d+1],c[h+5]=f[d+2];this.addAttribute("position",new y(c,3))}}function Nb(a,b,c){D.call(this);this.type="ParametricBufferGeometry";this.parameters={func:a,slices:b,stacks:c};var d=[],e=[],f,g,h,k,m,x=b+1;for(f=0;f<=c;f++)for(m=f/c,g=0;g<=b;g++)k=g/b,h=a(k,m),d.push(h.x,h.y,h.z),e.push(k,m);a=[];var p;for(f=0;f<c;f++)for(g=0;g<b;g++)h=f*x+g,k=f*x+g+1,m=(f+1)*x+g+1,p=(f+1)*x+g,a.push(h,k,p),a.push(k,m,p);this.setIndex(new (65535<a.length?Ua:Ra)(a,1));this.addAttribute("position",
new X(d,3));this.addAttribute("uv",new X(e,2));this.computeVertexNormals()}function Dc(a,b,c){S.call(this);this.type="ParametricGeometry";this.parameters={func:a,slices:b,stacks:c};this.fromBufferGeometry(new Nb(a,b,c));this.mergeVertices()}function xa(a,b,c,d){function e(a){h.push(a.x,a.y,a.z)}function f(b,c){var d=3*b;c.x=a[d+0];c.y=a[d+1];c.z=a[d+2]}function g(a,b,c,d){0>d&&1===a.x&&(k[b]=a.x-1);0===c.x&&0===c.z&&(k[b]=d/2/Math.PI+.5)}D.call(this);this.type="PolyhedronBufferGeometry";this.parameters=
{vertices:a,indices:b,radius:c,detail:d};c=c||1;var h=[],k=[];(function(a){for(var c=new q,d=new q,g=new q,h=0;h<b.length;h+=3){f(b[h+0],c);f(b[h+1],d);f(b[h+2],g);var k=c,l=d,F=g,t=Math.pow(2,a),v=[],M,z;for(M=0;M<=t;M++){v[M]=[];var A=k.clone().lerp(F,M/t),I=l.clone().lerp(F,M/t),E=t-M;for(z=0;z<=E;z++)v[M][z]=0===z&&M===t?A:A.clone().lerp(I,z/E)}for(M=0;M<t;M++)for(z=0;z<2*(t-M)-1;z++)k=Math.floor(z/2),0===z%2?(e(v[M][k+1]),e(v[M+1][k]),e(v[M][k])):(e(v[M][k+1]),e(v[M+1][k+1]),e(v[M+1][k]))}})(d||
0);(function(a){for(var b=new q,c=0;c<h.length;c+=3)b.x=h[c+0],b.y=h[c+1],b.z=h[c+2],b.normalize().multiplyScalar(a),h[c+0]=b.x,h[c+1]=b.y,h[c+2]=b.z})(c);(function(){for(var a=new q,b=0;b<h.length;b+=3)a.x=h[b+0],a.y=h[b+1],a.z=h[b+2],k.push(Math.atan2(a.z,-a.x)/2/Math.PI+.5,1-(Math.atan2(-a.y,Math.sqrt(a.x*a.x+a.z*a.z))/Math.PI+.5));for(var a=new q,b=new q,c=new q,d=new q,e=new C,f=new C,l=new C,F=0,t=0;F<h.length;F+=9,t+=6){a.set(h[F+0],h[F+1],h[F+2]);b.set(h[F+3],h[F+4],h[F+5]);c.set(h[F+6],h[F+
7],h[F+8]);e.set(k[t+0],k[t+1]);f.set(k[t+2],k[t+3]);l.set(k[t+4],k[t+5]);d.copy(a).add(b).add(c).divideScalar(3);var v=Math.atan2(d.z,-d.x);g(e,t+0,a,v);g(f,t+2,b,v);g(l,t+4,c,v)}for(a=0;a<k.length;a+=6)b=k[a+0],c=k[a+2],d=k[a+4],e=Math.min(b,c,d),.9<Math.max(b,c,d)&&.1>e&&(.2>b&&(k[a+0]+=1),.2>c&&(k[a+2]+=1),.2>d&&(k[a+4]+=1))})();this.addAttribute("position",new X(h,3));this.addAttribute("normal",new X(h.slice(),3));this.addAttribute("uv",new X(k,2));this.normalizeNormals();this.boundingSphere=
new Fa(new q,c)}function Ob(a,b){xa.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],a,b);this.type="TetrahedronBufferGeometry";this.parameters={radius:a,detail:b}}function Ec(a,b){S.call(this);this.type="TetrahedronGeometry";this.parameters={radius:a,detail:b};this.fromBufferGeometry(new Ob(a,b));this.mergeVertices()}function lb(a,b){xa.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],a,b);this.type="OctahedronBufferGeometry";
this.parameters={radius:a,detail:b}}function Fc(a,b){S.call(this);this.type="OctahedronGeometry";this.parameters={radius:a,detail:b};this.fromBufferGeometry(new lb(a,b));this.mergeVertices()}function Pb(a,b){var c=(1+Math.sqrt(5))/2;xa.call(this,[-1,c,0,1,c,0,-1,-c,0,1,-c,0,0,-1,c,0,1,c,0,-1,-c,0,1,-c,c,0,-1,c,0,1,-c,0,-1,-c,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],a,b);this.type="IcosahedronBufferGeometry";
this.parameters={radius:a,detail:b}}function Gc(a,b){S.call(this);this.type="IcosahedronGeometry";this.parameters={radius:a,detail:b};this.fromBufferGeometry(new Pb(a,b));this.mergeVertices()}function Qb(a,b){var c=(1+Math.sqrt(5))/2,d=1/c;xa.call(this,[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-d,-c,0,-d,c,0,d,-c,0,d,c,-d,-c,0,-d,c,0,d,-c,0,d,c,0,-c,0,-d,c,0,-d,-c,0,d,c,0,d],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,
0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],a,b);this.type="DodecahedronBufferGeometry";this.parameters={radius:a,detail:b}}function Hc(a,b){S.call(this);this.type="DodecahedronGeometry";this.parameters={radius:a,detail:b};this.fromBufferGeometry(new Qb(a,b));this.mergeVertices()}function Ic(a,b,c,d){S.call(this);this.type="PolyhedronGeometry";this.parameters={vertices:a,indices:b,
radius:c,detail:d};this.fromBufferGeometry(new xa(a,b,c,d));this.mergeVertices()}function Rb(a,b,c,d,e){function f(e){var f=a.getPointAt(e/b),m=g.normals[e];e=g.binormals[e];for(p=0;p<=d;p++){var x=p/d*Math.PI*2,l=Math.sin(x),x=-Math.cos(x);k.x=x*m.x+l*e.x;k.y=x*m.y+l*e.y;k.z=x*m.z+l*e.z;k.normalize();r.push(k.x,k.y,k.z);h.x=f.x+c*k.x;h.y=f.y+c*k.y;h.z=f.z+c*k.z;n.push(h.x,h.y,h.z)}}D.call(this);this.type="TubeBufferGeometry";this.parameters={path:a,tubularSegments:b,radius:c,radialSegments:d,closed:e};
b=b||64;c=c||1;d=d||8;e=e||!1;var g=a.computeFrenetFrames(b,e);this.tangents=g.tangents;this.normals=g.normals;this.binormals=g.binormals;var h=new q,k=new q,m=new C,x,p,n=[],r=[],l=[],u=[];for(x=0;x<b;x++)f(x);f(!1===e?b:0);for(x=0;x<=b;x++)for(p=0;p<=d;p++)m.x=x/b,m.y=p/d,l.push(m.x,m.y);(function(){for(p=1;p<=b;p++)for(x=1;x<=d;x++){var a=(d+1)*p+(x-1),c=(d+1)*p+x,e=(d+1)*(p-1)+x;u.push((d+1)*(p-1)+(x-1),a,e);u.push(a,c,e)}})();this.setIndex(new (65535<u.length?Ua:Ra)(u,1));this.addAttribute("position",
new X(n,3));this.addAttribute("normal",new X(r,3));this.addAttribute("uv",new X(l,2))}function Jc(a,b,c,d,e,f){S.call(this);this.type="TubeGeometry";this.parameters={path:a,tubularSegments:b,radius:c,radialSegments:d,closed:e};void 0!==f&&console.warn("THREE.TubeGeometry: taper has been removed.");a=new Rb(a,b,c,d,e);this.tangents=a.tangents;this.normals=a.normals;this.binormals=a.binormals;this.fromBufferGeometry(a);this.mergeVertices()}function Sb(a,b,c,d,e,f){function g(a,b,c,d,e){var f=Math.sin(a);
b=c/b*a;c=Math.cos(b);e.x=d*(2+c)*.5*Math.cos(a);e.y=d*(2+c)*f*.5;e.z=d*Math.sin(b)*.5}D.call(this);this.type="TorusKnotBufferGeometry";this.parameters={radius:a,tube:b,tubularSegments:c,radialSegments:d,p:e,q:f};a=a||100;b=b||40;c=Math.floor(c)||64;d=Math.floor(d)||8;e=e||2;f=f||3;var h=(d+1)*(c+1),k=d*c*6,k=new y(new (65535<k?Uint32Array:Uint16Array)(k),1),m=new y(new Float32Array(3*h),3),x=new y(new Float32Array(3*h),3),h=new y(new Float32Array(2*h),2),p,n,r=0,l=0,u=new q,F=new q,t=new C,v=new q,
M=new q,z=new q,A=new q,I=new q;for(p=0;p<=c;++p)for(n=p/c*e*Math.PI*2,g(n,e,f,a,v),g(n+.01,e,f,a,M),A.subVectors(M,v),I.addVectors(M,v),z.crossVectors(A,I),I.crossVectors(z,A),z.normalize(),I.normalize(),n=0;n<=d;++n){var E=n/d*Math.PI*2,K=-b*Math.cos(E),E=b*Math.sin(E);u.x=v.x+(K*I.x+E*z.x);u.y=v.y+(K*I.y+E*z.y);u.z=v.z+(K*I.z+E*z.z);m.setXYZ(r,u.x,u.y,u.z);F.subVectors(u,v).normalize();x.setXYZ(r,F.x,F.y,F.z);t.x=p/c;t.y=n/d;h.setXY(r,t.x,t.y);r++}for(n=1;n<=c;n++)for(p=1;p<=d;p++)a=(d+1)*n+(p-
1),b=(d+1)*n+p,e=(d+1)*(n-1)+p,k.setX(l,(d+1)*(n-1)+(p-1)),l++,k.setX(l,a),l++,k.setX(l,e),l++,k.setX(l,a),l++,k.setX(l,b),l++,k.setX(l,e),l++;this.setIndex(k);this.addAttribute("position",m);this.addAttribute("normal",x);this.addAttribute("uv",h)}function Kc(a,b,c,d,e,f,g){S.call(this);this.type="TorusKnotGeometry";this.parameters={radius:a,tube:b,tubularSegments:c,radialSegments:d,p:e,q:f};void 0!==g&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead.");
this.fromBufferGeometry(new Sb(a,b,c,d,e,f));this.mergeVertices()}function Tb(a,b,c,d,e){D.call(this);this.type="TorusBufferGeometry";this.parameters={radius:a,tube:b,radialSegments:c,tubularSegments:d,arc:e};a=a||100;b=b||40;c=Math.floor(c)||8;d=Math.floor(d)||6;e=e||2*Math.PI;var f=(c+1)*(d+1),g=c*d*6,g=new (65535<g?Uint32Array:Uint16Array)(g),h=new Float32Array(3*f),k=new Float32Array(3*f),f=new Float32Array(2*f),m=0,x=0,p=0,n=new q,l=new q,w=new q,u,F;for(u=0;u<=c;u++)for(F=0;F<=d;F++){var t=
F/d*e,v=u/c*Math.PI*2;l.x=(a+b*Math.cos(v))*Math.cos(t);l.y=(a+b*Math.cos(v))*Math.sin(t);l.z=b*Math.sin(v);h[m]=l.x;h[m+1]=l.y;h[m+2]=l.z;n.x=a*Math.cos(t);n.y=a*Math.sin(t);w.subVectors(l,n).normalize();k[m]=w.x;k[m+1]=w.y;k[m+2]=w.z;f[x]=F/d;f[x+1]=u/c;m+=3;x+=2}for(u=1;u<=c;u++)for(F=1;F<=d;F++)a=(d+1)*(u-1)+F-1,b=(d+1)*(u-1)+F,e=(d+1)*u+F,g[p]=(d+1)*u+F-1,g[p+1]=a,g[p+2]=e,g[p+3]=a,g[p+4]=b,g[p+5]=e,p+=6;this.setIndex(new y(g,1));this.addAttribute("position",new y(h,3));this.addAttribute("normal",
new y(k,3));this.addAttribute("uv",new y(f,2))}function Lc(a,b,c,d,e){S.call(this);this.type="TorusGeometry";this.parameters={radius:a,tube:b,radialSegments:c,tubularSegments:d,arc:e};this.fromBufferGeometry(new Tb(a,b,c,d,e))}function La(a,b){"undefined"!==typeof a&&(S.call(this),this.type="ExtrudeGeometry",a=Array.isArray(a)?a:[a],this.addShapeList(a,b),this.computeFaceNormals())}function Mc(a,b){b=b||{};var c=b.font;if(!1===(c&&c.isFont))return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),
new S;c=c.generateShapes(a,b.size,b.curveSegments);b.amount=void 0!==b.height?b.height:50;void 0===b.bevelThickness&&(b.bevelThickness=10);void 0===b.bevelSize&&(b.bevelSize=8);void 0===b.bevelEnabled&&(b.bevelEnabled=!1);La.call(this,c,b);this.type="TextGeometry"}function mb(a,b,c,d,e,f,g){D.call(this);this.type="SphereBufferGeometry";this.parameters={radius:a,widthSegments:b,heightSegments:c,phiStart:d,phiLength:e,thetaStart:f,thetaLength:g};a=a||50;b=Math.max(3,Math.floor(b)||8);c=Math.max(2,Math.floor(c)||
6);d=void 0!==d?d:0;e=void 0!==e?e:2*Math.PI;f=void 0!==f?f:0;g=void 0!==g?g:Math.PI;for(var h=f+g,k=(b+1)*(c+1),m=new y(new Float32Array(3*k),3),x=new y(new Float32Array(3*k),3),k=new y(new Float32Array(2*k),2),p=0,n=[],l=new q,w=0;w<=c;w++){for(var u=[],F=w/c,t=0;t<=b;t++){var v=t/b,M=-a*Math.cos(d+v*e)*Math.sin(f+F*g),z=a*Math.cos(f+F*g),A=a*Math.sin(d+v*e)*Math.sin(f+F*g);l.set(M,z,A).normalize();m.setXYZ(p,M,z,A);x.setXYZ(p,l.x,l.y,l.z);k.setXY(p,v,1-F);u.push(p);p++}n.push(u)}d=[];for(w=0;w<
c;w++)for(t=0;t<b;t++)e=n[w][t+1],g=n[w][t],p=n[w+1][t],l=n[w+1][t+1],(0!==w||0<f)&&d.push(e,g,l),(w!==c-1||h<Math.PI)&&d.push(g,p,l);this.setIndex(new (65535<m.count?Ua:Ra)(d,1));this.addAttribute("position",m);this.addAttribute("normal",x);this.addAttribute("uv",k);this.boundingSphere=new Fa(new q,a)}function Nc(a,b,c,d,e,f,g){S.call(this);this.type="SphereGeometry";this.parameters={radius:a,widthSegments:b,heightSegments:c,phiStart:d,phiLength:e,thetaStart:f,thetaLength:g};this.fromBufferGeometry(new mb(a,
b,c,d,e,f,g))}function Ub(a,b,c,d,e,f){D.call(this);this.type="RingBufferGeometry";this.parameters={innerRadius:a,outerRadius:b,thetaSegments:c,phiSegments:d,thetaStart:e,thetaLength:f};a=a||20;b=b||50;e=void 0!==e?e:0;f=void 0!==f?f:2*Math.PI;c=void 0!==c?Math.max(3,c):8;d=void 0!==d?Math.max(1,d):1;var g=(c+1)*(d+1),h=c*d*6,h=new y(new (65535<h?Uint32Array:Uint16Array)(h),1),k=new y(new Float32Array(3*g),3),m=new y(new Float32Array(3*g),3),g=new y(new Float32Array(2*g),2),x=0,p=0,n,l=a,w=(b-a)/
d,u=new q,F=new C,t;for(a=0;a<=d;a++){for(t=0;t<=c;t++)n=e+t/c*f,u.x=l*Math.cos(n),u.y=l*Math.sin(n),k.setXYZ(x,u.x,u.y,u.z),m.setXYZ(x,0,0,1),F.x=(u.x/b+1)/2,F.y=(u.y/b+1)/2,g.setXY(x,F.x,F.y),x++;l+=w}for(a=0;a<d;a++)for(b=a*(c+1),t=0;t<c;t++)e=n=t+b,f=n+c+1,x=n+c+2,n+=1,h.setX(p,e),p++,h.setX(p,f),p++,h.setX(p,x),p++,h.setX(p,e),p++,h.setX(p,x),p++,h.setX(p,n),p++;this.setIndex(h);this.addAttribute("position",k);this.addAttribute("normal",m);this.addAttribute("uv",g)}function Oc(a,b,c,d,e,f){S.call(this);
this.type="RingGeometry";this.parameters={innerRadius:a,outerRadius:b,thetaSegments:c,phiSegments:d,thetaStart:e,thetaLength:f};this.fromBufferGeometry(new Ub(a,b,c,d,e,f))}function Pc(a,b,c,d){S.call(this);this.type="PlaneGeometry";this.parameters={width:a,height:b,widthSegments:c,heightSegments:d};this.fromBufferGeometry(new ib(a,b,c,d))}function Vb(a,b,c,d){D.call(this);this.type="LatheBufferGeometry";this.parameters={points:a,segments:b,phiStart:c,phiLength:d};b=Math.floor(b)||12;c=c||0;d=d||
2*Math.PI;d=Q.clamp(d,0,2*Math.PI);for(var e=(b+1)*a.length,f=b*a.length*6,g=new y(new (65535<f?Uint32Array:Uint16Array)(f),1),h=new y(new Float32Array(3*e),3),k=new y(new Float32Array(2*e),2),m=0,x=0,p=1/b,n=new q,l=new C,e=0;e<=b;e++)for(var f=c+e*p*d,w=Math.sin(f),u=Math.cos(f),f=0;f<=a.length-1;f++)n.x=a[f].x*w,n.y=a[f].y,n.z=a[f].x*u,h.setXYZ(m,n.x,n.y,n.z),l.x=e/b,l.y=f/(a.length-1),k.setXY(m,l.x,l.y),m++;for(e=0;e<b;e++)for(f=0;f<a.length-1;f++)c=f+e*a.length,m=c+a.length,p=c+a.length+1,n=
c+1,g.setX(x,c),x++,g.setX(x,m),x++,g.setX(x,n),x++,g.setX(x,m),x++,g.setX(x,p),x++,g.setX(x,n),x++;this.setIndex(g);this.addAttribute("position",h);this.addAttribute("uv",k);this.computeVertexNormals();if(d===2*Math.PI)for(d=this.attributes.normal.array,g=new q,h=new q,k=new q,c=b*a.length*3,f=e=0;e<a.length;e++,f+=3)g.x=d[f+0],g.y=d[f+1],g.z=d[f+2],h.x=d[c+f+0],h.y=d[c+f+1],h.z=d[c+f+2],k.addVectors(g,h).normalize(),d[f+0]=d[c+f+0]=k.x,d[f+1]=d[c+f+1]=k.y,d[f+2]=d[c+f+2]=k.z}function Qc(a,b,c,d){S.call(this);
this.type="LatheGeometry";this.parameters={points:a,segments:b,phiStart:c,phiLength:d};this.fromBufferGeometry(new Vb(a,b,c,d));this.mergeVertices()}function Wb(a,b){function c(a){var c,h,m=d.length/3;a=a.extractPoints(b);var l=a.shape,u=a.holes;if(!1===pa.isClockWise(l))for(l=l.reverse(),a=0,c=u.length;a<c;a++)h=u[a],!0===pa.isClockWise(h)&&(u[a]=h.reverse());var q=pa.triangulateShape(l,u);a=0;for(c=u.length;a<c;a++)h=u[a],l=l.concat(h);a=0;for(c=l.length;a<c;a++)h=l[a],d.push(h.x,h.y,0),e.push(0,
0,1),f.push(h.x,h.y);a=0;for(c=q.length;a<c;a++)l=q[a],g.push(l[0]+m,l[1]+m,l[2]+m),k+=3}D.call(this);this.type="ShapeBufferGeometry";this.parameters={shapes:a,curveSegments:b};b=b||12;var d=[],e=[],f=[],g=[],h=0,k=0;if(!1===Array.isArray(a))c(a);else for(var m=0;m<a.length;m++)c(a[m]),this.addGroup(h,k,m),h+=k,k=0;this.setIndex(new (65535<g.length?Ua:Ra)(g,1));this.addAttribute("position",new X(d,3));this.addAttribute("normal",new X(e,3));this.addAttribute("uv",new X(f,2))}function Xb(a,b){S.call(this);
this.type="ShapeGeometry";"object"===typeof b&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),b=b.curveSegments);this.parameters={shapes:a,curveSegments:b};this.fromBufferGeometry(new Wb(a,b));this.mergeVertices()}function Yb(a,b){function c(a,b){return a-b}D.call(this);var d=Math.cos(Q.DEG2RAD*(void 0!==b?b:1)),e=[0,0],f={},g=["a","b","c"],h;a.isBufferGeometry?(h=new S,h.fromBufferGeometry(a)):h=a.clone();h.mergeVertices();h.computeFaceNormals();var k=h.vertices;h=h.faces;
for(var m=0,l=h.length;m<l;m++)for(var p=h[m],n=0;3>n;n++){e[0]=p[g[n]];e[1]=p[g[(n+1)%3]];e.sort(c);var r=e.toString();void 0===f[r]?f[r]={vert1:e[0],vert2:e[1],face1:m,face2:void 0}:f[r].face2=m}e=[];for(r in f)if(g=f[r],void 0===g.face2||h[g.face1].normal.dot(h[g.face2].normal)<=d)m=k[g.vert1],e.push(m.x),e.push(m.y),e.push(m.z),m=k[g.vert2],e.push(m.x),e.push(m.y),e.push(m.z);this.addAttribute("position",new X(e,3))}function Wa(a,b,c,d,e,f,g,h){function k(c){var e,f,k,n=new C,p=new q,l=0,x=!0===
c?a:b,M=!0===c?1:-1;f=t;for(e=1;e<=d;e++)w.setXYZ(t,0,z*M,0),u.setXYZ(t,0,M,0),n.x=.5,n.y=.5,F.setXY(t,n.x,n.y),t++;k=t;for(e=0;e<=d;e++){var y=e/d*h+g,D=Math.cos(y),y=Math.sin(y);p.x=x*y;p.y=z*M;p.z=x*D;w.setXYZ(t,p.x,p.y,p.z);u.setXYZ(t,0,M,0);n.x=.5*D+.5;n.y=.5*y*M+.5;F.setXY(t,n.x,n.y);t++}for(e=0;e<d;e++)n=f+e,p=k+e,!0===c?(r.setX(v,p),v++,r.setX(v,p+1)):(r.setX(v,p+1),v++,r.setX(v,p)),v++,r.setX(v,n),v++,l+=3;m.addGroup(A,l,!0===c?1:2);A+=l}D.call(this);this.type="CylinderBufferGeometry";this.parameters=
{radiusTop:a,radiusBottom:b,height:c,radialSegments:d,heightSegments:e,openEnded:f,thetaStart:g,thetaLength:h};var m=this;a=void 0!==a?a:20;b=void 0!==b?b:20;c=void 0!==c?c:100;d=Math.floor(d)||8;e=Math.floor(e)||1;f=void 0!==f?f:!1;g=void 0!==g?g:0;h=void 0!==h?h:2*Math.PI;var l=0;!1===f&&(0<a&&l++,0<b&&l++);var p=function(){var a=(d+1)*(e+1);!1===f&&(a+=(d+1)*l+d*l);return a}(),n=function(){var a=d*e*6;!1===f&&(a+=d*l*3);return a}(),r=new y(new (65535<n?Uint32Array:Uint16Array)(n),1),w=new y(new Float32Array(3*
p),3),u=new y(new Float32Array(3*p),3),F=new y(new Float32Array(2*p),2),t=0,v=0,M=[],z=c/2,A=0;(function(){var f,k,n=new q,p=new q,l=0,x=(b-a)/c;for(k=0;k<=e;k++){var y=[],C=k/e,D=C*(b-a)+a;for(f=0;f<=d;f++){var G=f/d,P=G*h+g,R=Math.sin(P),P=Math.cos(P);p.x=D*R;p.y=-C*c+z;p.z=D*P;w.setXYZ(t,p.x,p.y,p.z);n.set(R,x,P).normalize();u.setXYZ(t,n.x,n.y,n.z);F.setXY(t,G,1-C);y.push(t);t++}M.push(y)}for(f=0;f<d;f++)for(k=0;k<e;k++)n=M[k+1][f],p=M[k+1][f+1],x=M[k][f+1],r.setX(v,M[k][f]),v++,r.setX(v,n),v++,
r.setX(v,x),v++,r.setX(v,n),v++,r.setX(v,p),v++,r.setX(v,x),v++,l+=6;m.addGroup(A,l,0);A+=l})();!1===f&&(0<a&&k(!0),0<b&&k(!1));this.setIndex(r);this.addAttribute("position",w);this.addAttribute("normal",u);this.addAttribute("uv",F)}function nb(a,b,c,d,e,f,g,h){S.call(this);this.type="CylinderGeometry";this.parameters={radiusTop:a,radiusBottom:b,height:c,radialSegments:d,heightSegments:e,openEnded:f,thetaStart:g,thetaLength:h};this.fromBufferGeometry(new Wa(a,b,c,d,e,f,g,h));this.mergeVertices()}
function Rc(a,b,c,d,e,f,g){nb.call(this,0,a,b,c,d,e,f,g);this.type="ConeGeometry";this.parameters={radius:a,height:b,radialSegments:c,heightSegments:d,openEnded:e,thetaStart:f,thetaLength:g}}function Sc(a,b,c,d,e,f,g){Wa.call(this,0,a,b,c,d,e,f,g);this.type="ConeBufferGeometry";this.parameters={radius:a,height:b,radialSegments:c,heightSegments:d,openEnded:e,thetaStart:f,thetaLength:g}}function Zb(a,b,c,d){D.call(this);this.type="CircleBufferGeometry";this.parameters={radius:a,segments:b,thetaStart:c,
thetaLength:d};a=a||50;b=void 0!==b?Math.max(3,b):8;c=void 0!==c?c:0;d=void 0!==d?d:2*Math.PI;var e=b+2,f=new Float32Array(3*e),g=new Float32Array(3*e),e=new Float32Array(2*e);g[2]=1;e[0]=.5;e[1]=.5;for(var h=0,k=3,m=2;h<=b;h++,k+=3,m+=2){var l=c+h/b*d;f[k]=a*Math.cos(l);f[k+1]=a*Math.sin(l);g[k+2]=1;e[m]=(f[k]/a+1)/2;e[m+1]=(f[k+1]/a+1)/2}c=[];for(k=1;k<=b;k++)c.push(k,k+1,0);this.setIndex(new y(new Uint16Array(c),1));this.addAttribute("position",new y(f,3));this.addAttribute("normal",new y(g,3));
this.addAttribute("uv",new y(e,2));this.boundingSphere=new Fa(new q,a)}function Tc(a,b,c,d){S.call(this);this.type="CircleGeometry";this.parameters={radius:a,segments:b,thetaStart:c,thetaLength:d};this.fromBufferGeometry(new Zb(a,b,c,d))}function $b(a,b,c,d,e,f){S.call(this);this.type="BoxGeometry";this.parameters={width:a,height:b,depth:c,widthSegments:d,heightSegments:e,depthSegments:f};this.fromBufferGeometry(new hb(a,b,c,d,e,f));this.mergeVertices()}function ac(){Ia.call(this,{uniforms:Ja.merge([U.lights,
{opacity:{value:1}}]),vertexShader:Z.shadow_vert,fragmentShader:Z.shadow_frag});this.transparent=this.lights=!0;Object.defineProperties(this,{opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(a){this.uniforms.opacity.value=a}}})}function bc(a){Ia.call(this,a);this.type="RawShaderMaterial"}function Uc(a){this.uuid=Q.generateUUID();this.type="MultiMaterial";this.materials=Array.isArray(a)?a:[];this.visible=!0}function Pa(a){W.call(this);this.defines={STANDARD:""};
this.type="MeshStandardMaterial";this.color=new N(16777215);this.metalness=this.roughness=.5;this.lightMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new N(0);this.emissiveIntensity=1;this.bumpMap=this.emissiveMap=null;this.bumpScale=1;this.normalMap=null;this.normalScale=new C(1,1);this.displacementMap=null;this.displacementScale=1;this.displacementBias=0;this.envMap=this.alphaMap=this.metalnessMap=this.roughnessMap=null;this.envMapIntensity=1;this.refractionRatio=
.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.morphNormals=this.morphTargets=this.skinning=!1;this.setValues(a)}function ob(a){Pa.call(this);this.defines={PHYSICAL:""};this.type="MeshPhysicalMaterial";this.reflectivity=.5;this.clearCoatRoughness=this.clearCoat=0;this.setValues(a)}function Ca(a){W.call(this);this.type="MeshPhongMaterial";this.color=new N(16777215);this.specular=new N(1118481);this.shininess=30;this.lightMap=this.map=null;
this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new N(0);this.emissiveIntensity=1;this.bumpMap=this.emissiveMap=null;this.bumpScale=1;this.normalMap=null;this.normalScale=new C(1,1);this.displacementMap=null;this.displacementScale=1;this.displacementBias=0;this.envMap=this.alphaMap=this.specularMap=null;this.combine=0;this.reflectivity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.morphNormals=
this.morphTargets=this.skinning=!1;this.setValues(a)}function pb(a){Ca.call(this);this.defines={TOON:""};this.type="MeshToonMaterial";this.gradientMap=null;this.setValues(a)}function qb(a){W.call(this,a);this.type="MeshNormalMaterial";this.bumpMap=null;this.bumpScale=1;this.normalMap=null;this.normalScale=new C(1,1);this.displacementMap=null;this.displacementScale=1;this.displacementBias=0;this.wireframe=!1;this.wireframeLinewidth=1;this.morphNormals=this.morphTargets=this.skinning=this.lights=this.fog=
!1;this.setValues(a)}function rb(a){W.call(this);this.type="MeshLambertMaterial";this.color=new N(16777215);this.lightMap=this.map=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new N(0);this.emissiveIntensity=1;this.envMap=this.alphaMap=this.specularMap=this.emissiveMap=null;this.combine=0;this.reflectivity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinejoin=this.wireframeLinecap="round";this.morphNormals=this.morphTargets=
this.skinning=!1;this.setValues(a)}function sb(a){W.call(this);this.type="LineDashedMaterial";this.color=new N(16777215);this.scale=this.linewidth=1;this.dashSize=3;this.gapSize=1;this.lights=!1;this.setValues(a)}function Pd(a,b,c){var d=this,e=!1,f=0,g=0;this.onStart=void 0;this.onLoad=a;this.onProgress=b;this.onError=c;this.itemStart=function(a){g++;if(!1===e&&void 0!==d.onStart)d.onStart(a,f,g);e=!0};this.itemEnd=function(a){f++;if(void 0!==d.onProgress)d.onProgress(a,f,g);if(f===g&&(e=!1,void 0!==
d.onLoad))d.onLoad()};this.itemError=function(a){if(void 0!==d.onError)d.onError(a)}}function Ma(a){this.manager=void 0!==a?a:va}function Ee(a){this.manager=void 0!==a?a:va;this._parser=null}function Qd(a){this.manager=void 0!==a?a:va;this._parser=null}function Vc(a){this.manager=void 0!==a?a:va}function Rd(a){this.manager=void 0!==a?a:va}function md(a){this.manager=void 0!==a?a:va}function na(a,b){G.call(this);this.type="Light";this.color=new N(a);this.intensity=void 0!==b?b:1;this.receiveShadow=
void 0}function nd(a,b,c){na.call(this,a,c);this.type="HemisphereLight";this.castShadow=void 0;this.position.copy(G.DefaultUp);this.updateMatrix();this.groundColor=new N(b)}function tb(a){this.camera=a;this.bias=0;this.radius=1;this.mapSize=new C(512,512);this.map=null;this.matrix=new H}function od(){tb.call(this,new Ha(50,1,.5,500))}function pd(a,b,c,d,e,f){na.call(this,a,b);this.type="SpotLight";this.position.copy(G.DefaultUp);this.updateMatrix();this.target=new G;Object.defineProperty(this,"power",
{get:function(){return this.intensity*Math.PI},set:function(a){this.intensity=a/Math.PI}});this.distance=void 0!==c?c:0;this.angle=void 0!==d?d:Math.PI/3;this.penumbra=void 0!==e?e:0;this.decay=void 0!==f?f:1;this.shadow=new od}function qd(a,b,c,d){na.call(this,a,b);this.type="PointLight";Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(a){this.intensity=a/(4*Math.PI)}});this.distance=void 0!==c?c:0;this.decay=void 0!==d?d:1;this.shadow=new tb(new Ha(90,
1,.5,500))}function rd(a){tb.call(this,new Hb(-5,5,5,-5,.5,500))}function sd(a,b){na.call(this,a,b);this.type="DirectionalLight";this.position.copy(G.DefaultUp);this.updateMatrix();this.target=new G;this.shadow=new rd}function td(a,b){na.call(this,a,b);this.type="AmbientLight";this.castShadow=void 0}function qa(a,b,c,d){this.parameterPositions=a;this._cachedIndex=0;this.resultBuffer=void 0!==d?d:new b.constructor(c);this.sampleValues=b;this.valueSize=c}function ud(a,b,c,d){qa.call(this,a,b,c,d);this._offsetNext=
this._weightNext=this._offsetPrev=this._weightPrev=-0}function Wc(a,b,c,d){qa.call(this,a,b,c,d)}function vd(a,b,c,d){qa.call(this,a,b,c,d)}function ub(a,b,c,d){if(void 0===a)throw Error("track name is undefined");if(void 0===b||0===b.length)throw Error("no keyframes in track named "+a);this.name=a;this.times=ba.convertArray(b,this.TimeBufferType);this.values=ba.convertArray(c,this.ValueBufferType);this.setInterpolation(d||this.DefaultInterpolation);this.validate();this.optimize()}function cc(a,b,
c,d){ub.call(this,a,b,c,d)}function wd(a,b,c,d){qa.call(this,a,b,c,d)}function Xc(a,b,c,d){ub.call(this,a,b,c,d)}function dc(a,b,c,d){ub.call(this,a,b,c,d)}function xd(a,b,c,d){ub.call(this,a,b,c,d)}function yd(a,b,c){ub.call(this,a,b,c)}function zd(a,b,c,d){ub.call(this,a,b,c,d)}function vb(a,b,c,d){ub.apply(this,arguments)}function ta(a,b,c){this.name=a;this.tracks=c;this.duration=void 0!==b?b:-1;this.uuid=Q.generateUUID();0>this.duration&&this.resetDuration();this.optimize()}function Ad(a){this.manager=
void 0!==a?a:va;this.textures={}}function Sd(a){this.manager=void 0!==a?a:va}function wb(){this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){}}function Td(a){"boolean"===typeof a&&(console.warn("THREE.JSONLoader: showStatus parameter has been removed from constructor."),a=void 0);this.manager=void 0!==a?a:va;this.withCredentials=!1}function Fe(a){this.manager=void 0!==a?a:va;this.texturePath=""}function wa(){}function Qa(a,b){this.v1=a;this.v2=b}function Yc(){this.curves=
[];this.autoClose=!1}function Xa(a,b,c,d,e,f,g,h){this.aX=a;this.aY=b;this.xRadius=c;this.yRadius=d;this.aStartAngle=e;this.aEndAngle=f;this.aClockwise=g;this.aRotation=h||0}function xb(a){this.points=void 0===a?[]:a}function yb(a,b,c,d){this.v0=a;this.v1=b;this.v2=c;this.v3=d}function zb(a,b,c){this.v0=a;this.v1=b;this.v2=c}function Ab(){Zc.apply(this,arguments);this.holes=[]}function Zc(a){Yc.call(this);this.currentPoint=new C;a&&this.fromPoints(a)}function Ud(){this.subPaths=[];this.currentPath=
null}function Vd(a){this.data=a}function Ge(a){this.manager=void 0!==a?a:va}function Wd(a){this.manager=void 0!==a?a:va}function Xd(a,b,c,d){na.call(this,a,b);this.type="RectAreaLight";this.position.set(0,1,0);this.updateMatrix();this.width=void 0!==c?c:10;this.height=void 0!==d?d:10}function He(){this.type="StereoCamera";this.aspect=1;this.eyeSep=.064;this.cameraL=new Ha;this.cameraL.layers.enable(1);this.cameraL.matrixAutoUpdate=!1;this.cameraR=new Ha;this.cameraR.layers.enable(2);this.cameraR.matrixAutoUpdate=
!1}function Bd(a,b,c){G.call(this);this.type="CubeCamera";var d=new Ha(90,1,a,b);d.up.set(0,-1,0);d.lookAt(new q(1,0,0));this.add(d);var e=new Ha(90,1,a,b);e.up.set(0,-1,0);e.lookAt(new q(-1,0,0));this.add(e);var f=new Ha(90,1,a,b);f.up.set(0,0,1);f.lookAt(new q(0,1,0));this.add(f);var g=new Ha(90,1,a,b);g.up.set(0,0,-1);g.lookAt(new q(0,-1,0));this.add(g);var h=new Ha(90,1,a,b);h.up.set(0,-1,0);h.lookAt(new q(0,0,1));this.add(h);var k=new Ha(90,1,a,b);k.up.set(0,-1,0);k.lookAt(new q(0,0,-1));this.add(k);
this.renderTarget=new Eb(c,c,{format:1022,magFilter:1006,minFilter:1006});this.updateCubeMap=function(a,b){null===this.parent&&this.updateMatrixWorld();var c=this.renderTarget,n=c.texture.generateMipmaps;c.texture.generateMipmaps=!1;c.activeCubeFace=0;a.render(b,d,c);c.activeCubeFace=1;a.render(b,e,c);c.activeCubeFace=2;a.render(b,f,c);c.activeCubeFace=3;a.render(b,g,c);c.activeCubeFace=4;a.render(b,h,c);c.texture.generateMipmaps=n;c.activeCubeFace=5;a.render(b,k,c);a.setRenderTarget(null)}}function Yd(){G.call(this);
this.type="AudioListener";this.context=Zd.getContext();this.gain=this.context.createGain();this.gain.connect(this.context.destination);this.filter=null}function ec(a){G.call(this);this.type="Audio";this.context=a.context;this.gain=this.context.createGain();this.gain.connect(a.getInput());this.autoplay=!1;this.buffer=null;this.loop=!1;this.startTime=0;this.playbackRate=1;this.isPlaying=!1;this.hasPlaybackControl=!0;this.sourceType="empty";this.filters=[]}function $d(a){ec.call(this,a);this.panner=
this.context.createPanner();this.panner.connect(this.gain)}function ae(a,b){this.analyser=a.context.createAnalyser();this.analyser.fftSize=void 0!==b?b:2048;this.data=new Uint8Array(this.analyser.frequencyBinCount);a.getOutput().connect(this.analyser)}function Cd(a,b,c){this.binding=a;this.valueSize=c;a=Float64Array;switch(b){case "quaternion":b=this._slerp;break;case "string":case "bool":a=Array;b=this._select;break;default:b=this._lerp}this.buffer=new a(4*c);this._mixBufferRegion=b;this.referenceCount=
this.useCount=this.cumulativeWeight=0}function ka(a,b,c){this.path=b;this.parsedPath=c||ka.parseTrackName(b);this.node=ka.findNode(a,this.parsedPath.nodeName)||a;this.rootNode=a}function be(a){this.uuid=Q.generateUUID();this._objects=Array.prototype.slice.call(arguments);this.nCachedObjects_=0;var b={};this._indicesByUUID=b;for(var c=0,d=arguments.length;c!==d;++c)b[arguments[c].uuid]=c;this._paths=[];this._parsedPaths=[];this._bindings=[];this._bindingsIndicesByPath={};var e=this;this.stats={objects:{get total(){return e._objects.length},
get inUse(){return this.total-e.nCachedObjects_}},get bindingsPerObject(){return e._bindings.length}}}function ce(a,b,c){this._mixer=a;this._clip=b;this._localRoot=c||null;a=b.tracks;b=a.length;c=Array(b);for(var d={endingStart:2400,endingEnd:2400},e=0;e!==b;++e){var f=a[e].createInterpolant(null);c[e]=f;f.settings=d}this._interpolantSettings=d;this._interpolants=c;this._propertyBindings=Array(b);this._weightInterpolant=this._timeScaleInterpolant=this._byClipCacheIndex=this._cacheIndex=null;this.loop=
2201;this._loopCount=-1;this._startTime=null;this.time=0;this._effectiveWeight=this.weight=this._effectiveTimeScale=this.timeScale=1;this.repetitions=Infinity;this.paused=!1;this.enabled=!0;this.clampWhenFinished=!1;this.zeroSlopeAtEnd=this.zeroSlopeAtStart=!0}function de(a){this._root=a;this._initMemoryManager();this.time=this._accuIndex=0;this.timeScale=1}function Dd(a,b){"string"===typeof a&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),a=b);this.value=a}function Bb(){D.call(this);
this.type="InstancedBufferGeometry";this.maxInstancedCount=void 0}function ee(a,b,c,d){this.uuid=Q.generateUUID();this.data=a;this.itemSize=b;this.offset=c;this.normalized=!0===d}function fc(a,b){this.uuid=Q.generateUUID();this.array=a;this.stride=b;this.count=void 0!==a?a.length/b:0;this.dynamic=!1;this.updateRange={offset:0,count:-1};this.onUploadCallback=function(){};this.version=0}function gc(a,b,c){fc.call(this,a,b);this.meshPerAttribute=c||1}function hc(a,b,c){y.call(this,a,b);this.meshPerAttribute=
c||1}function fe(a,b,c,d){this.ray=new bb(a,b);this.near=c||0;this.far=d||Infinity;this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}};Object.defineProperties(this.params,{PointCloud:{get:function(){console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points.");return this.Points}}})}function Ie(a,b){return a.distance-b.distance}function ge(a,b,c,d){if(!1!==a.visible&&(a.raycast(b,c),!0===d)){a=a.children;d=0;for(var e=a.length;d<e;d++)ge(a[d],b,c,!0)}}function he(a){this.autoStart=
void 0!==a?a:!0;this.elapsedTime=this.oldTime=this.startTime=0;this.running=!1}function ie(a,b,c){this.radius=void 0!==a?a:1;this.phi=void 0!==b?b:0;this.theta=void 0!==c?c:0;return this}function je(a,b,c){this.radius=void 0!==a?a:1;this.theta=void 0!==b?b:0;this.y=void 0!==c?c:0;return this}function ua(a,b){Ba.call(this,a,b);this.animationsMap={};this.animationsList=[];var c=this.geometry.morphTargets.length;this.createAnimation("__default",0,c-1,c/1);this.setAnimationWeight("__default",1)}function $c(a){G.call(this);
this.material=a;this.render=function(a){}}function ad(a,b,c,d){this.object=a;this.size=void 0!==b?b:1;a=void 0!==c?c:16711680;d=void 0!==d?d:1;b=0;(c=this.object.geometry)&&c.isGeometry?b=3*c.faces.length:c&&c.isBufferGeometry&&(b=c.attributes.normal.count);c=new D;b=new X(6*b,3);c.addAttribute("position",b);fa.call(this,c,new ia({color:a,linewidth:d}));this.matrixAutoUpdate=!1;this.update()}function ic(a){G.call(this);this.light=a;this.light.updateMatrixWorld();this.matrix=a.matrixWorld;this.matrixAutoUpdate=
!1;a=new D;for(var b=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],c=0,d=1;32>c;c++,d++){var e=c/32*Math.PI*2,f=d/32*Math.PI*2;b.push(Math.cos(e),Math.sin(e),1,Math.cos(f),Math.sin(f),1)}a.addAttribute("position",new X(b,3));b=new ia({fog:!1});this.cone=new fa(a,b);this.add(this.cone);this.update()}function jc(a){this.bones=this.getBoneList(a);for(var b=new D,c=[],d=[],e=new N(0,0,1),f=new N(0,1,0),g=0;g<this.bones.length;g++){var h=this.bones[g];h.parent&&h.parent.isBone&&(c.push(0,
0,0),c.push(0,0,0),d.push(e.r,e.g,e.b),d.push(f.r,f.g,f.b))}b.addAttribute("position",new X(c,3));b.addAttribute("color",new X(d,3));c=new ia({vertexColors:2,depthTest:!1,depthWrite:!1,transparent:!0});fa.call(this,b,c);this.root=a;this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1;this.update()}function kc(a,b){this.light=a;this.light.updateMatrixWorld();var c=new mb(b,4,2),d=new Ka({wireframe:!0,fog:!1});d.color.copy(this.light.color).multiplyScalar(this.light.intensity);Ba.call(this,c,d);this.matrix=
this.light.matrixWorld;this.matrixAutoUpdate=!1}function lc(a){G.call(this);this.light=a;this.light.updateMatrixWorld();var b=new Ka({color:a.color,fog:!1});a=new Ka({color:a.color,fog:!1,wireframe:!0});var c=new D;c.addAttribute("position",new y(new Float32Array(18),3));this.add(new Ba(c,b));this.add(new Ba(c,a));this.update()}function mc(a,b){G.call(this);this.light=a;this.light.updateMatrixWorld();this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1;var c=new lb(b);c.rotateY(.5*Math.PI);var d=new Ka({vertexColors:2,
wireframe:!0}),e=c.getAttribute("position"),e=new Float32Array(3*e.count);c.addAttribute("color",new y(e,3));this.add(new Ba(c,d));this.update()}function bd(a,b,c,d){a=a||10;b=b||10;c=new N(void 0!==c?c:4473924);d=new N(void 0!==d?d:8947848);for(var e=b/2,f=2*a/b,g=[],h=[],k=0,m=0,l=-a;k<=b;k++,l+=f){g.push(-a,0,l,a,0,l);g.push(l,0,-a,l,0,a);var p=k===e?c:d;p.toArray(h,m);m+=3;p.toArray(h,m);m+=3;p.toArray(h,m);m+=3;p.toArray(h,m);m+=3}a=new D;a.addAttribute("position",new X(g,3));a.addAttribute("color",
new X(h,3));g=new ia({vertexColors:2});fa.call(this,a,g)}function Ed(a,b,c,d,e,f){a=a||10;b=b||16;c=c||8;d=d||64;e=new N(void 0!==e?e:4473924);f=new N(void 0!==f?f:8947848);var g=[],h=[],k,m,l,p,n;for(l=0;l<=b;l++)m=l/b*2*Math.PI,k=Math.sin(m)*a,m=Math.cos(m)*a,g.push(0,0,0),g.push(k,0,m),n=l&1?e:f,h.push(n.r,n.g,n.b),h.push(n.r,n.g,n.b);for(l=0;l<=c;l++)for(n=l&1?e:f,p=a-a/c*l,b=0;b<d;b++)m=b/d*2*Math.PI,k=Math.sin(m)*p,m=Math.cos(m)*p,g.push(k,0,m),h.push(n.r,n.g,n.b),m=(b+1)/d*2*Math.PI,k=Math.sin(m)*
p,m=Math.cos(m)*p,g.push(k,0,m),h.push(n.r,n.g,n.b);a=new D;a.addAttribute("position",new X(g,3));a.addAttribute("color",new X(h,3));g=new ia({vertexColors:2});fa.call(this,a,g)}function cd(a,b,c,d){this.object=a;this.size=void 0!==b?b:1;a=void 0!==c?c:16776960;d=void 0!==d?d:1;b=0;(c=this.object.geometry)&&c.isGeometry?b=c.faces.length:console.warn("THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.");c=new D;b=new X(6*b,3);c.addAttribute("position",
b);fa.call(this,c,new ia({color:a,linewidth:d}));this.matrixAutoUpdate=!1;this.update()}function nc(a,b){G.call(this);this.light=a;this.light.updateMatrixWorld();this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1;void 0===b&&(b=1);var c=new D;c.addAttribute("position",new X([-b,b,0,b,b,0,b,-b,0,-b,-b,0,-b,b,0],3));var d=new ia({fog:!1});this.add(new Va(c,d));c=new D;c.addAttribute("position",new X([0,0,0,0,0,1],3));this.add(new Va(c,d));this.update()}function dd(a){function b(a,b,d){c(a,d);c(b,d)}
function c(a,b){f.push(0,0,0);g.push(b.r,b.g,b.b);void 0===h[a]&&(h[a]=[]);h[a].push(f.length/3-1)}var d=new D,e=new ia({color:16777215,vertexColors:1}),f=[],g=[],h={},k=new N(16755200),m=new N(16711680),l=new N(43775),p=new N(16777215),n=new N(3355443);b("n1","n2",k);b("n2","n4",k);b("n4","n3",k);b("n3","n1",k);b("f1","f2",k);b("f2","f4",k);b("f4","f3",k);b("f3","f1",k);b("n1","f1",k);b("n2","f2",k);b("n3","f3",k);b("n4","f4",k);b("p","n1",m);b("p","n2",m);b("p","n3",m);b("p","n4",m);b("u1","u2",
l);b("u2","u3",l);b("u3","u1",l);b("c","t",p);b("p","c",n);b("cn1","cn2",n);b("cn3","cn4",n);b("cf1","cf2",n);b("cf3","cf4",n);d.addAttribute("position",new X(f,3));d.addAttribute("color",new X(g,3));fa.call(this,d,e);this.camera=a;this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix();this.matrix=a.matrixWorld;this.matrixAutoUpdate=!1;this.pointMap=h;this.update()}function oc(a,b){void 0===b&&(b=16776960);var c=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),
d=new Float32Array(24),e=new D;e.setIndex(new y(c,1));e.addAttribute("position",new y(d,3));fa.call(this,e,new ia({color:b}));void 0!==a&&this.update(a)}function Cb(a,b,c,d,e,f){G.call(this);void 0===d&&(d=16776960);void 0===c&&(c=1);void 0===e&&(e=.2*c);void 0===f&&(f=.2*e);this.position.copy(b);this.line=new Va(Je,new ia({color:d}));this.line.matrixAutoUpdate=!1;this.add(this.line);this.cone=new Ba(Ke,new Ka({color:d}));this.cone.matrixAutoUpdate=!1;this.add(this.cone);this.setDirection(a);this.setLength(c,
e,f)}function Fd(a){a=a||1;var b=[0,0,0,a,0,0,0,0,0,0,a,0,0,0,0,0,0,a];a=new D;a.addAttribute("position",new X(b,3));a.addAttribute("color",new X([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));b=new ia({vertexColors:2});fa.call(this,a,b)}function Gd(a,b,c,d,e,f){Xa.call(this,a,b,c,c,d,e,f)}function Le(a){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead.");ke.call(this,a);this.type="catmullrom";this.closed=!0}void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,
-52));void 0===Math.sign&&(Math.sign=function(a){return 0>a?-1:0<a?1:+a});void 0===Function.prototype.name&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}});void 0===Object.assign&&function(){Object.assign=function(a){if(void 0===a||null===a)throw new TypeError("Cannot convert undefined or null to object");for(var b=Object(a),c=1;c<arguments.length;c++){var d=arguments[c];if(void 0!==d&&null!==d)for(var e in d)Object.prototype.hasOwnProperty.call(d,
e)&&(b[e]=d[e])}return b}}();Object.assign(oa.prototype,{addEventListener:function(a,b){void 0===this._listeners&&(this._listeners={});var c=this._listeners;void 0===c[a]&&(c[a]=[]);-1===c[a].indexOf(b)&&c[a].push(b)},hasEventListener:function(a,b){if(void 0===this._listeners)return!1;var c=this._listeners;return void 0!==c[a]&&-1!==c[a].indexOf(b)},removeEventListener:function(a,b){if(void 0!==this._listeners){var c=this._listeners[a];if(void 0!==c){var d=c.indexOf(b);-1!==d&&c.splice(d,1)}}},dispatchEvent:function(a){if(void 0!==
this._listeners){var b=this._listeners[a.type];if(void 0!==b){a.target=this;var c=[],d,e=b.length;for(d=0;d<e;d++)c[d]=b[d];for(d=0;d<e;d++)c[d].call(this,a)}}}});var Me={NoBlending:0,NormalBlending:1,AdditiveBlending:2,SubtractiveBlending:3,MultiplyBlending:4,CustomBlending:5},Ne={UVMapping:300,CubeReflectionMapping:301,CubeRefractionMapping:302,EquirectangularReflectionMapping:303,EquirectangularRefractionMapping:304,SphericalReflectionMapping:305,CubeUVReflectionMapping:306,CubeUVRefractionMapping:307},
le={RepeatWrapping:1E3,ClampToEdgeWrapping:1001,MirroredRepeatWrapping:1002},me={NearestFilter:1003,NearestMipMapNearestFilter:1004,NearestMipMapLinearFilter:1005,LinearFilter:1006,LinearMipMapNearestFilter:1007,LinearMipMapLinearFilter:1008},Q={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),b=Array(36),c=0,d;return function(){for(var e=0;36>e;e++)8===e||13===e||18===e||23===e?b[e]="-":14===e?b[e]="4":
(2>=c&&(c=33554432+16777216*Math.random()|0),d=c&15,c>>=4,b[e]=a[19===e?d&3|8:d]);return b.join("")}}(),clamp:function(a,b,c){return Math.max(b,Math.min(c,a))},euclideanModulo:function(a,b){return(a%b+b)%b},mapLinear:function(a,b,c,d,e){return d+(a-b)*(e-d)/(c-b)},lerp:function(a,b,c){return(1-c)*a+c*b},smoothstep:function(a,b,c){if(a<=b)return 0;if(a>=c)return 1;a=(a-b)/(c-b);return a*a*(3-2*a)},smootherstep:function(a,b,c){if(a<=b)return 0;if(a>=c)return 1;a=(a-b)/(c-b);return a*a*a*(a*(6*a-15)+
10)},randInt:function(a,b){return a+Math.floor(Math.random()*(b-a+1))},randFloat:function(a,b){return a+Math.random()*(b-a)},randFloatSpread:function(a){return a*(.5-Math.random())},degToRad:function(a){return a*Q.DEG2RAD},radToDeg:function(a){return a*Q.RAD2DEG},isPowerOfTwo:function(a){return 0===(a&a-1)&&0!==a},nearestPowerOfTwo:function(a){return Math.pow(2,Math.round(Math.log(a)/Math.LN2))},nextPowerOfTwo:function(a){a--;a|=a>>1;a|=a>>2;a|=a>>4;a|=a>>8;a|=a>>16;a++;return a}};C.prototype={constructor:C,
isVector2:!0,get width(){return this.x},set width(a){this.x=a},get height(){return this.y},set height(a){this.y=a},set:function(a,b){this.x=a;this.y=b;return this},setScalar:function(a){this.y=this.x=a;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;default:throw Error("index is out of range: "+a);}return this},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;
default:throw Error("index is out of range: "+a);}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(a){this.x=a.x;this.y=a.y;return this},add:function(a,b){if(void 0!==b)return console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,b);this.x+=a.x;this.y+=a.y;return this},addScalar:function(a){this.x+=a;this.y+=a;return this},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;return this},addScaledVector:function(a,
b){this.x+=a.x*b;this.y+=a.y*b;return this},sub:function(a,b){if(void 0!==b)return console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,b);this.x-=a.x;this.y-=a.y;return this},subScalar:function(a){this.x-=a;this.y-=a;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;return this},multiply:function(a){this.x*=a.x;this.y*=a.y;return this},multiplyScalar:function(a){isFinite(a)?(this.x*=a,this.y*=a):this.y=this.x=0;
return this},divide:function(a){this.x/=a.x;this.y/=a.y;return this},divideScalar:function(a){return this.multiplyScalar(1/a)},min:function(a){this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,a.y);return this},max:function(a){this.x=Math.max(this.x,a.x);this.y=Math.max(this.y,a.y);return this},clamp:function(a,b){this.x=Math.max(a.x,Math.min(b.x,this.x));this.y=Math.max(a.y,Math.min(b.y,this.y));return this},clampScalar:function(){var a,b;return function(c,d){void 0===a&&(a=new C,b=new C);a.set(c,
c);b.set(d,d);return this.clamp(a,b)}}(),clampLength:function(a,b){var c=this.length();return this.multiplyScalar(Math.max(a,Math.min(b,c))/c)},floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);
return this},negate:function(){this.x=-this.x;this.y=-this.y;return this},dot:function(a){return this.x*a.x+this.y*a.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length())},angle:function(){var a=Math.atan2(this.y,this.x);0>a&&(a+=2*Math.PI);return a},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},
distanceToSquared:function(a){var b=this.x-a.x;a=this.y-a.y;return b*b+a*a},distanceToManhattan:function(a){return Math.abs(this.x-a.x)+Math.abs(this.y-a.y)},setLength:function(a){return this.multiplyScalar(a/this.length())},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;return this},lerpVectors:function(a,b,c){return this.subVectors(b,a).multiplyScalar(c).add(a)},equals:function(a){return a.x===this.x&&a.y===this.y},fromArray:function(a,b){void 0===b&&(b=0);this.x=a[b];this.y=a[b+
1];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.x;a[b+1]=this.y;return a},fromAttribute:function(a,b,c){void 0!==c&&console.warn("THREE.Vector2: offset has been removed from .fromAttribute().");this.x=a.getX(b);this.y=a.getY(b);return this},rotateAround:function(a,b){var c=Math.cos(b),d=Math.sin(b),e=this.x-a.x,f=this.y-a.y;this.x=e*c-f*d+a.x;this.y=e*d+f*c+a.y;return this}};var Oe=0;ea.DEFAULT_IMAGE=void 0;ea.DEFAULT_MAPPING=300;ea.prototype={constructor:ea,isTexture:!0,
set needsUpdate(a){!0===a&&this.version++},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.image=a.image;this.mipmaps=a.mipmaps.slice(0);this.mapping=a.mapping;this.wrapS=a.wrapS;this.wrapT=a.wrapT;this.magFilter=a.magFilter;this.minFilter=a.minFilter;this.anisotropy=a.anisotropy;this.format=a.format;this.type=a.type;this.offset.copy(a.offset);this.repeat.copy(a.repeat);this.generateMipmaps=a.generateMipmaps;this.premultiplyAlpha=a.premultiplyAlpha;this.flipY=a.flipY;
this.unpackAlignment=a.unpackAlignment;this.encoding=a.encoding;return this},toJSON:function(a){if(void 0!==a.textures[this.uuid])return a.textures[this.uuid];var b={metadata:{version:4.4,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],wrap:[this.wrapS,this.wrapT],minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY};if(void 0!==this.image){var c=
this.image;void 0===c.uuid&&(c.uuid=Q.generateUUID());if(void 0===a.images[c.uuid]){var d=a.images,e=c.uuid,f=c.uuid,g;void 0!==c.toDataURL?g=c:(g=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),g.width=c.width,g.height=c.height,g.getContext("2d").drawImage(c,0,0,c.width,c.height));g=2048<g.width||2048<g.height?g.toDataURL("image/jpeg",.6):g.toDataURL("image/png");d[e]={uuid:f,url:g}}b.image=c.uuid}return a.textures[this.uuid]=b},dispose:function(){this.dispatchEvent({type:"dispose"})},
transformUv:function(a){if(300===this.mapping){a.multiply(this.repeat);a.add(this.offset);if(0>a.x||1<a.x)switch(this.wrapS){case 1E3:a.x-=Math.floor(a.x);break;case 1001:a.x=0>a.x?0:1;break;case 1002:a.x=1===Math.abs(Math.floor(a.x)%2)?Math.ceil(a.x)-a.x:a.x-Math.floor(a.x)}if(0>a.y||1<a.y)switch(this.wrapT){case 1E3:a.y-=Math.floor(a.y);break;case 1001:a.y=0>a.y?0:1;break;case 1002:a.y=1===Math.abs(Math.floor(a.y)%2)?Math.ceil(a.y)-a.y:a.y-Math.floor(a.y)}this.flipY&&(a.y=1-a.y)}}};Object.assign(ea.prototype,
oa.prototype);ga.prototype={constructor:ga,isVector4:!0,set:function(a,b,c,d){this.x=a;this.y=b;this.z=c;this.w=d;return this},setScalar:function(a){this.w=this.z=this.y=this.x=a;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setZ:function(a){this.z=a;return this},setW:function(a){this.w=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;case 3:this.w=b;break;default:throw Error("index is out of range: "+
a);}return this},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw Error("index is out of range: "+a);}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=void 0!==a.w?a.w:1;return this},add:function(a,b){if(void 0!==b)return console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,
b);this.x+=a.x;this.y+=a.y;this.z+=a.z;this.w+=a.w;return this},addScalar:function(a){this.x+=a;this.y+=a;this.z+=a;this.w+=a;return this},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;this.w=a.w+b.w;return this},addScaledVector:function(a,b){this.x+=a.x*b;this.y+=a.y*b;this.z+=a.z*b;this.w+=a.w*b;return this},sub:function(a,b){if(void 0!==b)return console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,b);this.x-=
a.x;this.y-=a.y;this.z-=a.z;this.w-=a.w;return this},subScalar:function(a){this.x-=a;this.y-=a;this.z-=a;this.w-=a;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;this.w=a.w-b.w;return this},multiplyScalar:function(a){isFinite(a)?(this.x*=a,this.y*=a,this.z*=a,this.w*=a):this.w=this.z=this.y=this.x=0;return this},applyMatrix4:function(a){var b=this.x,c=this.y,d=this.z,e=this.w;a=a.elements;this.x=a[0]*b+a[4]*c+a[8]*d+a[12]*e;this.y=a[1]*b+a[5]*c+a[9]*d+a[13]*e;this.z=
a[2]*b+a[6]*c+a[10]*d+a[14]*e;this.w=a[3]*b+a[7]*c+a[11]*d+a[15]*e;return this},divideScalar:function(a){return this.multiplyScalar(1/a)},setAxisAngleFromQuaternion:function(a){this.w=2*Math.acos(a.w);var b=Math.sqrt(1-a.w*a.w);1E-4>b?(this.x=1,this.z=this.y=0):(this.x=a.x/b,this.y=a.y/b,this.z=a.z/b);return this},setAxisAngleFromRotationMatrix:function(a){var b,c,d;a=a.elements;var e=a[0];d=a[4];var f=a[8],g=a[1],h=a[5],k=a[9];c=a[2];b=a[6];var m=a[10];if(.01>Math.abs(d-g)&&.01>Math.abs(f-c)&&.01>
Math.abs(k-b)){if(.1>Math.abs(d+g)&&.1>Math.abs(f+c)&&.1>Math.abs(k+b)&&.1>Math.abs(e+h+m-3))return this.set(1,0,0,0),this;a=Math.PI;e=(e+1)/2;h=(h+1)/2;m=(m+1)/2;d=(d+g)/4;f=(f+c)/4;k=(k+b)/4;e>h&&e>m?.01>e?(b=0,d=c=.707106781):(b=Math.sqrt(e),c=d/b,d=f/b):h>m?.01>h?(b=.707106781,c=0,d=.707106781):(c=Math.sqrt(h),b=d/c,d=k/c):.01>m?(c=b=.707106781,d=0):(d=Math.sqrt(m),b=f/d,c=k/d);this.set(b,c,d,a);return this}a=Math.sqrt((b-k)*(b-k)+(f-c)*(f-c)+(g-d)*(g-d));.001>Math.abs(a)&&(a=1);this.x=(b-k)/
a;this.y=(f-c)/a;this.z=(g-d)/a;this.w=Math.acos((e+h+m-1)/2);return this},min:function(a){this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,a.y);this.z=Math.min(this.z,a.z);this.w=Math.min(this.w,a.w);return this},max:function(a){this.x=Math.max(this.x,a.x);this.y=Math.max(this.y,a.y);this.z=Math.max(this.z,a.z);this.w=Math.max(this.w,a.w);return this},clamp:function(a,b){this.x=Math.max(a.x,Math.min(b.x,this.x));this.y=Math.max(a.y,Math.min(b.y,this.y));this.z=Math.max(a.z,Math.min(b.z,this.z));
this.w=Math.max(a.w,Math.min(b.w,this.w));return this},clampScalar:function(){var a,b;return function(c,d){void 0===a&&(a=new ga,b=new ga);a.set(c,c,c,c);b.set(d,d,d,d);return this.clamp(a,b)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);this.w=Math.floor(this.w);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);this.w=Math.ceil(this.w);return this},round:function(){this.x=Math.round(this.x);
this.y=Math.round(this.y);this.z=Math.round(this.z);this.w=Math.round(this.w);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z);this.w=0>this.w?Math.ceil(this.w):Math.floor(this.w);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;this.w=-this.w;return this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w},lengthSq:function(){return this.x*
this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){return this.multiplyScalar(a/this.length())},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;this.z+=(a.z-this.z)*b;this.w+=(a.w-this.w)*b;return this},lerpVectors:function(a,
b,c){return this.subVectors(b,a).multiplyScalar(c).add(a)},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z&&a.w===this.w},fromArray:function(a,b){void 0===b&&(b=0);this.x=a[b];this.y=a[b+1];this.z=a[b+2];this.w=a[b+3];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.x;a[b+1]=this.y;a[b+2]=this.z;a[b+3]=this.w;return a},fromAttribute:function(a,b,c){void 0!==c&&console.warn("THREE.Vector4: offset has been removed from .fromAttribute().");this.x=a.getX(b);
this.y=a.getY(b);this.z=a.getZ(b);this.w=a.getW(b);return this}};Object.assign(Db.prototype,oa.prototype,{isWebGLRenderTarget:!0,setSize:function(a,b){if(this.width!==a||this.height!==b)this.width=a,this.height=b,this.dispose();this.viewport.set(0,0,a,b);this.scissor.set(0,0,a,b)},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.width=a.width;this.height=a.height;this.viewport.copy(a.viewport);this.texture=a.texture.clone();this.depthBuffer=a.depthBuffer;this.stencilBuffer=
a.stencilBuffer;this.depthTexture=a.depthTexture;return this},dispose:function(){this.dispatchEvent({type:"dispose"})}});Eb.prototype=Object.create(Db.prototype);Eb.prototype.constructor=Eb;Eb.prototype.isWebGLRenderTargetCube=!0;da.prototype={constructor:da,get x(){return this._x},set x(a){this._x=a;this.onChangeCallback()},get y(){return this._y},set y(a){this._y=a;this.onChangeCallback()},get z(){return this._z},set z(a){this._z=a;this.onChangeCallback()},get w(){return this._w},set w(a){this._w=
a;this.onChangeCallback()},set:function(a,b,c,d){this._x=a;this._y=b;this._z=c;this._w=d;this.onChangeCallback();return this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(a){this._x=a.x;this._y=a.y;this._z=a.z;this._w=a.w;this.onChangeCallback();return this},setFromEuler:function(a,b){if(!1===(a&&a.isEuler))throw Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var c=Math.cos(a._x/2),d=Math.cos(a._y/
2),e=Math.cos(a._z/2),f=Math.sin(a._x/2),g=Math.sin(a._y/2),h=Math.sin(a._z/2),k=a.order;"XYZ"===k?(this._x=f*d*e+c*g*h,this._y=c*g*e-f*d*h,this._z=c*d*h+f*g*e,this._w=c*d*e-f*g*h):"YXZ"===k?(this._x=f*d*e+c*g*h,this._y=c*g*e-f*d*h,this._z=c*d*h-f*g*e,this._w=c*d*e+f*g*h):"ZXY"===k?(this._x=f*d*e-c*g*h,this._y=c*g*e+f*d*h,this._z=c*d*h+f*g*e,this._w=c*d*e-f*g*h):"ZYX"===k?(this._x=f*d*e-c*g*h,this._y=c*g*e+f*d*h,this._z=c*d*h-f*g*e,this._w=c*d*e+f*g*h):"YZX"===k?(this._x=f*d*e+c*g*h,this._y=c*g*e+
f*d*h,this._z=c*d*h-f*g*e,this._w=c*d*e-f*g*h):"XZY"===k&&(this._x=f*d*e-c*g*h,this._y=c*g*e-f*d*h,this._z=c*d*h+f*g*e,this._w=c*d*e+f*g*h);if(!1!==b)this.onChangeCallback();return this},setFromAxisAngle:function(a,b){var c=b/2,d=Math.sin(c);this._x=a.x*d;this._y=a.y*d;this._z=a.z*d;this._w=Math.cos(c);this.onChangeCallback();return this},setFromRotationMatrix:function(a){var b=a.elements,c=b[0];a=b[4];var d=b[8],e=b[1],f=b[5],g=b[9],h=b[2],k=b[6],b=b[10],m=c+f+b;0<m?(c=.5/Math.sqrt(m+1),this._w=
.25/c,this._x=(k-g)*c,this._y=(d-h)*c,this._z=(e-a)*c):c>f&&c>b?(c=2*Math.sqrt(1+c-f-b),this._w=(k-g)/c,this._x=.25*c,this._y=(a+e)/c,this._z=(d+h)/c):f>b?(c=2*Math.sqrt(1+f-c-b),this._w=(d-h)/c,this._x=(a+e)/c,this._y=.25*c,this._z=(g+k)/c):(c=2*Math.sqrt(1+b-c-f),this._w=(e-a)/c,this._x=(d+h)/c,this._y=(g+k)/c,this._z=.25*c);this.onChangeCallback();return this},setFromUnitVectors:function(){var a,b;return function(c,d){void 0===a&&(a=new q);b=c.dot(d)+1;1E-6>b?(b=0,Math.abs(c.x)>Math.abs(c.z)?a.set(-c.y,
c.x,0):a.set(0,-c.z,c.y)):a.crossVectors(c,d);this._x=a.x;this._y=a.y;this._z=a.z;this._w=b;return this.normalize()}}(),inverse:function(){return this.conjugate().normalize()},conjugate:function(){this._x*=-1;this._y*=-1;this._z*=-1;this.onChangeCallback();return this},dot:function(a){return this._x*a._x+this._y*a._y+this._z*a._z+this._w*a._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+
this._z*this._z+this._w*this._w)},normalize:function(){var a=this.length();0===a?(this._z=this._y=this._x=0,this._w=1):(a=1/a,this._x*=a,this._y*=a,this._z*=a,this._w*=a);this.onChangeCallback();return this},multiply:function(a,b){return void 0!==b?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(a,b)):this.multiplyQuaternions(this,a)},premultiply:function(a){return this.multiplyQuaternions(a,this)},multiplyQuaternions:function(a,
b){var c=a._x,d=a._y,e=a._z,f=a._w,g=b._x,h=b._y,k=b._z,m=b._w;this._x=c*m+f*g+d*k-e*h;this._y=d*m+f*h+e*g-c*k;this._z=e*m+f*k+c*h-d*g;this._w=f*m-c*g-d*h-e*k;this.onChangeCallback();return this},slerp:function(a,b){if(0===b)return this;if(1===b)return this.copy(a);var c=this._x,d=this._y,e=this._z,f=this._w,g=f*a._w+c*a._x+d*a._y+e*a._z;0>g?(this._w=-a._w,this._x=-a._x,this._y=-a._y,this._z=-a._z,g=-g):this.copy(a);if(1<=g)return this._w=f,this._x=c,this._y=d,this._z=e,this;var h=Math.sqrt(1-g*g);
if(.001>Math.abs(h))return this._w=.5*(f+this._w),this._x=.5*(c+this._x),this._y=.5*(d+this._y),this._z=.5*(e+this._z),this;var k=Math.atan2(h,g),g=Math.sin((1-b)*k)/h,h=Math.sin(b*k)/h;this._w=f*g+this._w*h;this._x=c*g+this._x*h;this._y=d*g+this._y*h;this._z=e*g+this._z*h;this.onChangeCallback();return this},equals:function(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._w===this._w},fromArray:function(a,b){void 0===b&&(b=0);this._x=a[b];this._y=a[b+1];this._z=a[b+2];this._w=a[b+3];
this.onChangeCallback();return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this._x;a[b+1]=this._y;a[b+2]=this._z;a[b+3]=this._w;return a},onChange:function(a){this.onChangeCallback=a;return this},onChangeCallback:function(){}};Object.assign(da,{slerp:function(a,b,c,d){return c.copy(a).slerp(b,d)},slerpFlat:function(a,b,c,d,e,f,g){var h=c[d+0],k=c[d+1],m=c[d+2];c=c[d+3];d=e[f+0];var l=e[f+1],p=e[f+2];e=e[f+3];if(c!==e||h!==d||k!==l||m!==p){f=1-g;var n=h*d+k*l+m*p+c*e,r=0<=
n?1:-1,w=1-n*n;w>Number.EPSILON&&(w=Math.sqrt(w),n=Math.atan2(w,n*r),f=Math.sin(f*n)/w,g=Math.sin(g*n)/w);r*=g;h=h*f+d*r;k=k*f+l*r;m=m*f+p*r;c=c*f+e*r;f===1-g&&(g=1/Math.sqrt(h*h+k*k+m*m+c*c),h*=g,k*=g,m*=g,c*=g)}a[b]=h;a[b+1]=k;a[b+2]=m;a[b+3]=c}});q.prototype={constructor:q,isVector3:!0,set:function(a,b,c){this.x=a;this.y=b;this.z=c;return this},setScalar:function(a){this.z=this.y=this.x=a;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setZ:function(a){this.z=
a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;default:throw Error("index is out of range: "+a);}return this},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw Error("index is out of range: "+a);}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;return this},add:function(a,b){if(void 0!==b)return console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),
this.addVectors(a,b);this.x+=a.x;this.y+=a.y;this.z+=a.z;return this},addScalar:function(a){this.x+=a;this.y+=a;this.z+=a;return this},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;return this},addScaledVector:function(a,b){this.x+=a.x*b;this.y+=a.y*b;this.z+=a.z*b;return this},sub:function(a,b){if(void 0!==b)return console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,b);this.x-=a.x;this.y-=a.y;this.z-=a.z;
return this},subScalar:function(a){this.x-=a;this.y-=a;this.z-=a;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;return this},multiply:function(a,b){if(void 0!==b)return console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(a,b);this.x*=a.x;this.y*=a.y;this.z*=a.z;return this},multiplyScalar:function(a){isFinite(a)?(this.x*=a,this.y*=a,this.z*=a):this.z=this.y=this.x=0;return this},multiplyVectors:function(a,
b){this.x=a.x*b.x;this.y=a.y*b.y;this.z=a.z*b.z;return this},applyEuler:function(){var a;return function(b){!1===(b&&b.isEuler)&&console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order.");void 0===a&&(a=new da);return this.applyQuaternion(a.setFromEuler(b))}}(),applyAxisAngle:function(){var a;return function(b,c){void 0===a&&(a=new da);return this.applyQuaternion(a.setFromAxisAngle(b,c))}}(),applyMatrix3:function(a){var b=this.x,c=this.y,d=this.z;
a=a.elements;this.x=a[0]*b+a[3]*c+a[6]*d;this.y=a[1]*b+a[4]*c+a[7]*d;this.z=a[2]*b+a[5]*c+a[8]*d;return this},applyMatrix4:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;this.x=a[0]*b+a[4]*c+a[8]*d+a[12];this.y=a[1]*b+a[5]*c+a[9]*d+a[13];this.z=a[2]*b+a[6]*c+a[10]*d+a[14];return this},applyProjection:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;var e=1/(a[3]*b+a[7]*c+a[11]*d+a[15]);this.x=(a[0]*b+a[4]*c+a[8]*d+a[12])*e;this.y=(a[1]*b+a[5]*c+a[9]*d+a[13])*e;this.z=(a[2]*b+a[6]*
c+a[10]*d+a[14])*e;return this},applyQuaternion:function(a){var b=this.x,c=this.y,d=this.z,e=a.x,f=a.y,g=a.z;a=a.w;var h=a*b+f*d-g*c,k=a*c+g*b-e*d,m=a*d+e*c-f*b,b=-e*b-f*c-g*d;this.x=h*a+b*-e+k*-g-m*-f;this.y=k*a+b*-f+m*-e-h*-g;this.z=m*a+b*-g+h*-f-k*-e;return this},project:function(){var a;return function(b){void 0===a&&(a=new H);a.multiplyMatrices(b.projectionMatrix,a.getInverse(b.matrixWorld));return this.applyProjection(a)}}(),unproject:function(){var a;return function(b){void 0===a&&(a=new H);
a.multiplyMatrices(b.matrixWorld,a.getInverse(b.projectionMatrix));return this.applyProjection(a)}}(),transformDirection:function(a){var b=this.x,c=this.y,d=this.z;a=a.elements;this.x=a[0]*b+a[4]*c+a[8]*d;this.y=a[1]*b+a[5]*c+a[9]*d;this.z=a[2]*b+a[6]*c+a[10]*d;return this.normalize()},divide:function(a){this.x/=a.x;this.y/=a.y;this.z/=a.z;return this},divideScalar:function(a){return this.multiplyScalar(1/a)},min:function(a){this.x=Math.min(this.x,a.x);this.y=Math.min(this.y,a.y);this.z=Math.min(this.z,
a.z);return this},max:function(a){this.x=Math.max(this.x,a.x);this.y=Math.max(this.y,a.y);this.z=Math.max(this.z,a.z);return this},clamp:function(a,b){this.x=Math.max(a.x,Math.min(b.x,this.x));this.y=Math.max(a.y,Math.min(b.y,this.y));this.z=Math.max(a.z,Math.min(b.z,this.z));return this},clampScalar:function(){var a,b;return function(c,d){void 0===a&&(a=new q,b=new q);a.set(c,c,c);b.set(d,d,d);return this.clamp(a,b)}}(),clampLength:function(a,b){var c=this.length();return this.multiplyScalar(Math.max(a,
Math.min(b,c))/c)},floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);return this},roundToZero:function(){this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x);this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y);this.z=0>this.z?Math.ceil(this.z):
Math.floor(this.z);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){return this.multiplyScalar(a/
this.length())},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;this.z+=(a.z-this.z)*b;return this},lerpVectors:function(a,b,c){return this.subVectors(b,a).multiplyScalar(c).add(a)},cross:function(a,b){if(void 0!==b)return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(a,b);var c=this.x,d=this.y,e=this.z;this.x=d*a.z-e*a.y;this.y=e*a.x-c*a.z;this.z=c*a.y-d*a.x;return this},crossVectors:function(a,b){var c=
a.x,d=a.y,e=a.z,f=b.x,g=b.y,h=b.z;this.x=d*h-e*g;this.y=e*f-c*h;this.z=c*g-d*f;return this},projectOnVector:function(a){var b=a.dot(this)/a.lengthSq();return this.copy(a).multiplyScalar(b)},projectOnPlane:function(){var a;return function(b){void 0===a&&(a=new q);a.copy(this).projectOnVector(b);return this.sub(a)}}(),reflect:function(){var a;return function(b){void 0===a&&(a=new q);return this.sub(a.copy(b).multiplyScalar(2*this.dot(b)))}}(),angleTo:function(a){a=this.dot(a)/Math.sqrt(this.lengthSq()*
a.lengthSq());return Math.acos(Q.clamp(a,-1,1))},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=this.x-a.x,c=this.y-a.y;a=this.z-a.z;return b*b+c*c+a*a},distanceToManhattan:function(a){return Math.abs(this.x-a.x)+Math.abs(this.y-a.y)+Math.abs(this.z-a.z)},setFromSpherical:function(a){var b=Math.sin(a.phi)*a.radius;this.x=b*Math.sin(a.theta);this.y=Math.cos(a.phi)*a.radius;this.z=b*Math.cos(a.theta);return this},setFromCylindrical:function(a){this.x=
a.radius*Math.sin(a.theta);this.y=a.y;this.z=a.radius*Math.cos(a.theta);return this},setFromMatrixPosition:function(a){return this.setFromMatrixColumn(a,3)},setFromMatrixScale:function(a){var b=this.setFromMatrixColumn(a,0).length(),c=this.setFromMatrixColumn(a,1).length();a=this.setFromMatrixColumn(a,2).length();this.x=b;this.y=c;this.z=a;return this},setFromMatrixColumn:function(a,b){if("number"===typeof a){console.warn("THREE.Vector3: setFromMatrixColumn now expects ( matrix, index ).");var c=
a;a=b;b=c}return this.fromArray(a.elements,4*b)},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z},fromArray:function(a,b){void 0===b&&(b=0);this.x=a[b];this.y=a[b+1];this.z=a[b+2];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.x;a[b+1]=this.y;a[b+2]=this.z;return a},fromAttribute:function(a,b,c){void 0!==c&&console.warn("THREE.Vector3: offset has been removed from .fromAttribute().");this.x=a.getX(b);this.y=a.getY(b);this.z=a.getZ(b);return this}};
H.prototype={constructor:H,isMatrix4:!0,set:function(a,b,c,d,e,f,g,h,k,m,l,p,n,r,w,u){var q=this.elements;q[0]=a;q[4]=b;q[8]=c;q[12]=d;q[1]=e;q[5]=f;q[9]=g;q[13]=h;q[2]=k;q[6]=m;q[10]=l;q[14]=p;q[3]=n;q[7]=r;q[11]=w;q[15]=u;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},clone:function(){return(new H).fromArray(this.elements)},copy:function(a){this.elements.set(a.elements);return this},copyPosition:function(a){var b=this.elements;a=a.elements;b[12]=a[12];b[13]=
a[13];b[14]=a[14];return this},extractBasis:function(a,b,c){a.setFromMatrixColumn(this,0);b.setFromMatrixColumn(this,1);c.setFromMatrixColumn(this,2);return this},makeBasis:function(a,b,c){this.set(a.x,b.x,c.x,0,a.y,b.y,c.y,0,a.z,b.z,c.z,0,0,0,0,1);return this},extractRotation:function(){var a;return function(b){void 0===a&&(a=new q);var c=this.elements,d=b.elements,e=1/a.setFromMatrixColumn(b,0).length(),f=1/a.setFromMatrixColumn(b,1).length();b=1/a.setFromMatrixColumn(b,2).length();c[0]=d[0]*e;
c[1]=d[1]*e;c[2]=d[2]*e;c[4]=d[4]*f;c[5]=d[5]*f;c[6]=d[6]*f;c[8]=d[8]*b;c[9]=d[9]*b;c[10]=d[10]*b;return this}}(),makeRotationFromEuler:function(a){!1===(a&&a.isEuler)&&console.error("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var b=this.elements,c=a.x,d=a.y,e=a.z,f=Math.cos(c),c=Math.sin(c),g=Math.cos(d),d=Math.sin(d),h=Math.cos(e),e=Math.sin(e);if("XYZ"===a.order){a=f*h;var k=f*e,m=c*h,l=c*e;b[0]=g*h;b[4]=-g*e;b[8]=d;b[1]=k+m*d;b[5]=a-
l*d;b[9]=-c*g;b[2]=l-a*d;b[6]=m+k*d;b[10]=f*g}else"YXZ"===a.order?(a=g*h,k=g*e,m=d*h,l=d*e,b[0]=a+l*c,b[4]=m*c-k,b[8]=f*d,b[1]=f*e,b[5]=f*h,b[9]=-c,b[2]=k*c-m,b[6]=l+a*c,b[10]=f*g):"ZXY"===a.order?(a=g*h,k=g*e,m=d*h,l=d*e,b[0]=a-l*c,b[4]=-f*e,b[8]=m+k*c,b[1]=k+m*c,b[5]=f*h,b[9]=l-a*c,b[2]=-f*d,b[6]=c,b[10]=f*g):"ZYX"===a.order?(a=f*h,k=f*e,m=c*h,l=c*e,b[0]=g*h,b[4]=m*d-k,b[8]=a*d+l,b[1]=g*e,b[5]=l*d+a,b[9]=k*d-m,b[2]=-d,b[6]=c*g,b[10]=f*g):"YZX"===a.order?(a=f*g,k=f*d,m=c*g,l=c*d,b[0]=g*h,b[4]=l-
a*e,b[8]=m*e+k,b[1]=e,b[5]=f*h,b[9]=-c*h,b[2]=-d*h,b[6]=k*e+m,b[10]=a-l*e):"XZY"===a.order&&(a=f*g,k=f*d,m=c*g,l=c*d,b[0]=g*h,b[4]=-e,b[8]=d*h,b[1]=a*e+l,b[5]=f*h,b[9]=k*e-m,b[2]=m*e-k,b[6]=c*h,b[10]=l*e+a);b[3]=0;b[7]=0;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return this},makeRotationFromQuaternion:function(a){var b=this.elements,c=a.x,d=a.y,e=a.z,f=a.w,g=c+c,h=d+d,k=e+e;a=c*g;var m=c*h,c=c*k,l=d*h,d=d*k,e=e*k,g=f*g,h=f*h,f=f*k;b[0]=1-(l+e);b[4]=m-f;b[8]=c+h;b[1]=m+f;b[5]=1-(a+e);b[9]=d-g;b[2]=c-
h;b[6]=d+g;b[10]=1-(a+l);b[3]=0;b[7]=0;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return this},lookAt:function(){var a,b,c;return function(d,e,f){void 0===a&&(a=new q,b=new q,c=new q);var g=this.elements;c.subVectors(d,e).normalize();0===c.lengthSq()&&(c.z=1);a.crossVectors(f,c).normalize();0===a.lengthSq()&&(c.z+=1E-4,a.crossVectors(f,c).normalize());b.crossVectors(c,a);g[0]=a.x;g[4]=b.x;g[8]=c.x;g[1]=a.y;g[5]=b.y;g[9]=c.y;g[2]=a.z;g[6]=b.z;g[10]=c.z;return this}}(),multiply:function(a,b){return void 0!==
b?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(a,b)):this.multiplyMatrices(this,a)},premultiply:function(a){return this.multiplyMatrices(a,this)},multiplyMatrices:function(a,b){var c=a.elements,d=b.elements,e=this.elements,f=c[0],g=c[4],h=c[8],k=c[12],m=c[1],l=c[5],p=c[9],n=c[13],r=c[2],w=c[6],u=c[10],q=c[14],t=c[3],v=c[7],M=c[11],c=c[15],z=d[0],A=d[4],I=d[8],E=d[12],K=d[1],y=d[5],J=d[9],C=d[13],D=d[2],G=d[6],
H=d[10],O=d[14],P=d[3],R=d[7],T=d[11],d=d[15];e[0]=f*z+g*K+h*D+k*P;e[4]=f*A+g*y+h*G+k*R;e[8]=f*I+g*J+h*H+k*T;e[12]=f*E+g*C+h*O+k*d;e[1]=m*z+l*K+p*D+n*P;e[5]=m*A+l*y+p*G+n*R;e[9]=m*I+l*J+p*H+n*T;e[13]=m*E+l*C+p*O+n*d;e[2]=r*z+w*K+u*D+q*P;e[6]=r*A+w*y+u*G+q*R;e[10]=r*I+w*J+u*H+q*T;e[14]=r*E+w*C+u*O+q*d;e[3]=t*z+v*K+M*D+c*P;e[7]=t*A+v*y+M*G+c*R;e[11]=t*I+v*J+M*H+c*T;e[15]=t*E+v*C+M*O+c*d;return this},multiplyToArray:function(a,b,c){var d=this.elements;this.multiplyMatrices(a,b);c[0]=d[0];c[1]=d[1];c[2]=
d[2];c[3]=d[3];c[4]=d[4];c[5]=d[5];c[6]=d[6];c[7]=d[7];c[8]=d[8];c[9]=d[9];c[10]=d[10];c[11]=d[11];c[12]=d[12];c[13]=d[13];c[14]=d[14];c[15]=d[15];return this},multiplyScalar:function(a){var b=this.elements;b[0]*=a;b[4]*=a;b[8]*=a;b[12]*=a;b[1]*=a;b[5]*=a;b[9]*=a;b[13]*=a;b[2]*=a;b[6]*=a;b[10]*=a;b[14]*=a;b[3]*=a;b[7]*=a;b[11]*=a;b[15]*=a;return this},applyToVector3Array:function(){var a;return function(b,c,d){void 0===a&&(a=new q);void 0===c&&(c=0);void 0===d&&(d=b.length);for(var e=0;e<d;e+=3,c+=
3)a.fromArray(b,c),a.applyMatrix4(this),a.toArray(b,c);return b}}(),applyToBufferAttribute:function(){var a;return function(b){void 0===a&&(a=new q);for(var c=0,d=b.count;c<d;c++)a.x=b.getX(c),a.y=b.getY(c),a.z=b.getZ(c),a.applyMatrix4(this),b.setXYZ(c,a.x,a.y,a.z);return b}}(),determinant:function(){var a=this.elements,b=a[0],c=a[4],d=a[8],e=a[12],f=a[1],g=a[5],h=a[9],k=a[13],m=a[2],l=a[6],p=a[10],n=a[14];return a[3]*(+e*h*l-d*k*l-e*g*p+c*k*p+d*g*n-c*h*n)+a[7]*(+b*h*n-b*k*p+e*f*p-d*f*n+d*k*m-e*h*
m)+a[11]*(+b*k*l-b*g*n-e*f*l+c*f*n+e*g*m-c*k*m)+a[15]*(-d*g*m-b*h*l+b*g*p+d*f*l-c*f*p+c*h*m)},transpose:function(){var a=this.elements,b;b=a[1];a[1]=a[4];a[4]=b;b=a[2];a[2]=a[8];a[8]=b;b=a[6];a[6]=a[9];a[9]=b;b=a[3];a[3]=a[12];a[12]=b;b=a[7];a[7]=a[13];a[13]=b;b=a[11];a[11]=a[14];a[14]=b;return this},setPosition:function(a){var b=this.elements;b[12]=a.x;b[13]=a.y;b[14]=a.z;return this},getInverse:function(a,b){var c=this.elements,d=a.elements,e=d[0],f=d[1],g=d[2],h=d[3],k=d[4],m=d[5],l=d[6],p=d[7],
n=d[8],r=d[9],w=d[10],u=d[11],q=d[12],t=d[13],v=d[14],d=d[15],M=r*v*p-t*w*p+t*l*u-m*v*u-r*l*d+m*w*d,z=q*w*p-n*v*p-q*l*u+k*v*u+n*l*d-k*w*d,A=n*t*p-q*r*p+q*m*u-k*t*u-n*m*d+k*r*d,I=q*r*l-n*t*l-q*m*w+k*t*w+n*m*v-k*r*v,E=e*M+f*z+g*A+h*I;if(0===E){if(!0===b)throw Error("THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0");console.warn("THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0");return this.identity()}E=1/E;c[0]=M*E;c[1]=(t*w*h-r*v*h-t*g*u+f*v*u+r*g*d-f*w*d)*E;c[2]=
(m*v*h-t*l*h+t*g*p-f*v*p-m*g*d+f*l*d)*E;c[3]=(r*l*h-m*w*h-r*g*p+f*w*p+m*g*u-f*l*u)*E;c[4]=z*E;c[5]=(n*v*h-q*w*h+q*g*u-e*v*u-n*g*d+e*w*d)*E;c[6]=(q*l*h-k*v*h-q*g*p+e*v*p+k*g*d-e*l*d)*E;c[7]=(k*w*h-n*l*h+n*g*p-e*w*p-k*g*u+e*l*u)*E;c[8]=A*E;c[9]=(q*r*h-n*t*h-q*f*u+e*t*u+n*f*d-e*r*d)*E;c[10]=(k*t*h-q*m*h+q*f*p-e*t*p-k*f*d+e*m*d)*E;c[11]=(n*m*h-k*r*h-n*f*p+e*r*p+k*f*u-e*m*u)*E;c[12]=I*E;c[13]=(n*t*g-q*r*g+q*f*w-e*t*w-n*f*v+e*r*v)*E;c[14]=(q*m*g-k*t*g-q*f*l+e*t*l+k*f*v-e*m*v)*E;c[15]=(k*r*g-n*m*g+n*f*l-
e*r*l-k*f*w+e*m*w)*E;return this},scale:function(a){var b=this.elements,c=a.x,d=a.y;a=a.z;b[0]*=c;b[4]*=d;b[8]*=a;b[1]*=c;b[5]*=d;b[9]*=a;b[2]*=c;b[6]*=d;b[10]*=a;b[3]*=c;b[7]*=d;b[11]*=a;return this},getMaxScaleOnAxis:function(){var a=this.elements;return Math.sqrt(Math.max(a[0]*a[0]+a[1]*a[1]+a[2]*a[2],a[4]*a[4]+a[5]*a[5]+a[6]*a[6],a[8]*a[8]+a[9]*a[9]+a[10]*a[10]))},makeTranslation:function(a,b,c){this.set(1,0,0,a,0,1,0,b,0,0,1,c,0,0,0,1);return this},makeRotationX:function(a){var b=Math.cos(a);
a=Math.sin(a);this.set(1,0,0,0,0,b,-a,0,0,a,b,0,0,0,0,1);return this},makeRotationY:function(a){var b=Math.cos(a);a=Math.sin(a);this.set(b,0,a,0,0,1,0,0,-a,0,b,0,0,0,0,1);return this},makeRotationZ:function(a){var b=Math.cos(a);a=Math.sin(a);this.set(b,-a,0,0,a,b,0,0,0,0,1,0,0,0,0,1);return this},makeRotationAxis:function(a,b){var c=Math.cos(b),d=Math.sin(b),e=1-c,f=a.x,g=a.y,h=a.z,k=e*f,m=e*g;this.set(k*f+c,k*g-d*h,k*h+d*g,0,k*g+d*h,m*g+c,m*h-d*f,0,k*h-d*g,m*h+d*f,e*h*h+c,0,0,0,0,1);return this},
makeScale:function(a,b,c){this.set(a,0,0,0,0,b,0,0,0,0,c,0,0,0,0,1);return this},makeShear:function(a,b,c){this.set(1,b,c,0,a,1,c,0,a,b,1,0,0,0,0,1);return this},compose:function(a,b,c){this.makeRotationFromQuaternion(b);this.scale(c);this.setPosition(a);return this},decompose:function(){var a,b;return function(c,d,e){void 0===a&&(a=new q,b=new H);var f=this.elements,g=a.set(f[0],f[1],f[2]).length(),h=a.set(f[4],f[5],f[6]).length(),k=a.set(f[8],f[9],f[10]).length();0>this.determinant()&&(g=-g);c.x=
f[12];c.y=f[13];c.z=f[14];b.elements.set(this.elements);c=1/g;var f=1/h,m=1/k;b.elements[0]*=c;b.elements[1]*=c;b.elements[2]*=c;b.elements[4]*=f;b.elements[5]*=f;b.elements[6]*=f;b.elements[8]*=m;b.elements[9]*=m;b.elements[10]*=m;d.setFromRotationMatrix(b);e.x=g;e.y=h;e.z=k;return this}}(),makeFrustum:function(a,b,c,d,e,f){var g=this.elements;g[0]=2*e/(b-a);g[4]=0;g[8]=(b+a)/(b-a);g[12]=0;g[1]=0;g[5]=2*e/(d-c);g[9]=(d+c)/(d-c);g[13]=0;g[2]=0;g[6]=0;g[10]=-(f+e)/(f-e);g[14]=-2*f*e/(f-e);g[3]=0;g[7]=
0;g[11]=-1;g[15]=0;return this},makePerspective:function(a,b,c,d){a=c*Math.tan(Q.DEG2RAD*a*.5);var e=-a;return this.makeFrustum(e*b,a*b,e,a,c,d)},makeOrthographic:function(a,b,c,d,e,f){var g=this.elements,h=1/(b-a),k=1/(c-d),m=1/(f-e);g[0]=2*h;g[4]=0;g[8]=0;g[12]=-((b+a)*h);g[1]=0;g[5]=2*k;g[9]=0;g[13]=-((c+d)*k);g[2]=0;g[6]=0;g[10]=-2*m;g[14]=-((f+e)*m);g[3]=0;g[7]=0;g[11]=0;g[15]=1;return this},equals:function(a){var b=this.elements;a=a.elements;for(var c=0;16>c;c++)if(b[c]!==a[c])return!1;return!0},
fromArray:function(a,b){void 0===b&&(b=0);for(var c=0;16>c;c++)this.elements[c]=a[c+b];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);var c=this.elements;a[b]=c[0];a[b+1]=c[1];a[b+2]=c[2];a[b+3]=c[3];a[b+4]=c[4];a[b+5]=c[5];a[b+6]=c[6];a[b+7]=c[7];a[b+8]=c[8];a[b+9]=c[9];a[b+10]=c[10];a[b+11]=c[11];a[b+12]=c[12];a[b+13]=c[13];a[b+14]=c[14];a[b+15]=c[15];return a}};Za.prototype=Object.create(ea.prototype);Za.prototype.constructor=Za;Za.prototype.isCubeTexture=!0;Object.defineProperty(Za.prototype,
"images",{get:function(){return this.image},set:function(a){this.image=a}});var se=new ea,te=new Za,pe=[],re=[];xe.prototype.setValue=function(a,b){for(var c=this.seq,d=0,e=c.length;d!==e;++d){var f=c[d];f.setValue(a,b[f.id])}};var Id=/([\w\d_]+)(\])?(\[|\.)?/g;$a.prototype.setValue=function(a,b,c){b=this.map[b];void 0!==b&&b.setValue(a,c,this.renderer)};$a.prototype.set=function(a,b,c){var d=this.map[c];void 0!==d&&d.setValue(a,b[c],this.renderer)};$a.prototype.setOptional=function(a,b,c){b=b[c];
void 0!==b&&this.setValue(a,c,b)};$a.upload=function(a,b,c,d){for(var e=0,f=b.length;e!==f;++e){var g=b[e],h=c[g.id];!1!==h.needsUpdate&&g.setValue(a,h.value,d)}};$a.seqWithValue=function(a,b){for(var c=[],d=0,e=a.length;d!==e;++d){var f=a[d];f.id in b&&c.push(f)}return c};var Ja={merge:function(a){for(var b={},c=0;c<a.length;c++){var d=this.clone(a[c]),e;for(e in d)b[e]=d[e]}return b},clone:function(a){var b={},c;for(c in a){b[c]={};for(var d in a[c]){var e=a[c][d];e&&(e.isColor||e.isMatrix3||e.isMatrix4||
e.isVector2||e.isVector3||e.isVector4||e.isTexture)?b[c][d]=e.clone():Array.isArray(e)?b[c][d]=e.slice():b[c][d]=e}}return b}},Z={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif\n",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif\n",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif\n",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif\n",
aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"\nvec3 transformed = vec3( position );\n",beginnormal_vertex:"\nvec3 objectNormal = vec3( normal );\n",bsdfs:"float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t\tif( decayExponent > 0.0 ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\t\tfloat maxDistanceCutoffFactor = pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t\treturn distanceFalloff * maxDistanceCutoffFactor;\n#else\n\t\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n#endif\n\t\t}\n\t\treturn 1.0;\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 ltcTextureCoords( const in GeometricContext geometry, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = (LUT_SIZE - 1.0)/LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5/LUT_SIZE;\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 P = geometry.position;\n\tfloat theta = acos( dot( N, V ) );\n\tvec2 uv = vec2(\n\t\tsqrt( saturate( roughness ) ),\n\t\tsaturate( theta / ( 0.5 * PI ) ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nvoid clipQuadToHorizon( inout vec3 L[5], out int n ) {\n\tint config = 0;\n\tif ( L[0].z > 0.0 ) config += 1;\n\tif ( L[1].z > 0.0 ) config += 2;\n\tif ( L[2].z > 0.0 ) config += 4;\n\tif ( L[3].z > 0.0 ) config += 8;\n\tn = 0;\n\tif ( config == 0 ) {\n\t} else if ( config == 1 ) {\n\t\tn = 3;\n\t\tL[1] = -L[1].z * L[0] + L[0].z * L[1];\n\t\tL[2] = -L[3].z * L[0] + L[0].z * L[3];\n\t} else if ( config == 2 ) {\n\t\tn = 3;\n\t\tL[0] = -L[0].z * L[1] + L[1].z * L[0];\n\t\tL[2] = -L[2].z * L[1] + L[1].z * L[2];\n\t} else if ( config == 3 ) {\n\t\tn = 4;\n\t\tL[2] = -L[2].z * L[1] + L[1].z * L[2];\n\t\tL[3] = -L[3].z * L[0] + L[0].z * L[3];\n\t} else if ( config == 4 ) {\n\t\tn = 3;\n\t\tL[0] = -L[3].z * L[2] + L[2].z * L[3];\n\t\tL[1] = -L[1].z * L[2] + L[2].z * L[1];\n\t} else if ( config == 5 ) {\n\t\tn = 0;\n\t} else if ( config == 6 ) {\n\t\tn = 4;\n\t\tL[0] = -L[0].z * L[1] + L[1].z * L[0];\n\t\tL[3] = -L[3].z * L[2] + L[2].z * L[3];\n\t} else if ( config == 7 ) {\n\t\tn = 5;\n\t\tL[4] = -L[3].z * L[0] + L[0].z * L[3];\n\t\tL[3] = -L[3].z * L[2] + L[2].z * L[3];\n\t} else if ( config == 8 ) {\n\t\tn = 3;\n\t\tL[0] = -L[0].z * L[3] + L[3].z * L[0];\n\t\tL[1] = -L[2].z * L[3] + L[3].z * L[2];\n\t\tL[2] =  L[3];\n\t} else if ( config == 9 ) {\n\t\tn = 4;\n\t\tL[1] = -L[1].z * L[0] + L[0].z * L[1];\n\t\tL[2] = -L[2].z * L[3] + L[3].z * L[2];\n\t} else if ( config == 10 ) {\n\t\tn = 0;\n\t} else if ( config == 11 ) {\n\t\tn = 5;\n\t\tL[4] = L[3];\n\t\tL[3] = -L[2].z * L[3] + L[3].z * L[2];\n\t\tL[2] = -L[2].z * L[1] + L[1].z * L[2];\n\t} else if ( config == 12 ) {\n\t\tn = 4;\n\t\tL[1] = -L[1].z * L[2] + L[2].z * L[1];\n\t\tL[0] = -L[0].z * L[3] + L[3].z * L[0];\n\t} else if ( config == 13 ) {\n\t\tn = 5;\n\t\tL[4] = L[3];\n\t\tL[3] = L[2];\n\t\tL[2] = -L[1].z * L[2] + L[2].z * L[1];\n\t\tL[1] = -L[1].z * L[0] + L[0].z * L[1];\n\t} else if ( config == 14 ) {\n\t\tn = 5;\n\t\tL[4] = -L[0].z * L[3] + L[3].z * L[0];\n\t\tL[0] = -L[0].z * L[1] + L[1].z * L[0];\n\t} else if ( config == 15 ) {\n\t\tn = 4;\n\t}\n\tif ( n == 3 )\n\t\tL[3] = L[0];\n\tif ( n == 4 )\n\t\tL[4] = L[0];\n}\nfloat integrateLtcBrdfOverRectEdge( vec3 v1, vec3 v2 ) {\n\tfloat cosTheta = dot( v1, v2 );\n\tfloat theta = acos( cosTheta );\n\tfloat res = cross( v1, v2 ).z * ( ( theta > 0.001 ) ? theta / sin( theta ) : 1.0 );\n\treturn res;\n}\nvoid initRectPoints( const in vec3 pos, const in vec3 halfWidth, const in vec3 halfHeight, out vec3 rectPoints[4] ) {\n\trectPoints[0] = pos - halfWidth - halfHeight;\n\trectPoints[1] = pos + halfWidth - halfHeight;\n\trectPoints[2] = pos + halfWidth + halfHeight;\n\trectPoints[3] = pos - halfWidth + halfHeight;\n}\nvec3 integrateLtcBrdfOverRect( const in GeometricContext geometry, const in mat3 brdfMat, const in vec3 rectPoints[4] ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 P = geometry.position;\n\tvec3 T1, T2;\n\tT1 = normalize(V - N * dot( V, N ));\n\tT2 = - cross( N, T1 );\n\tmat3 brdfWrtSurface = brdfMat * transpose( mat3( T1, T2, N ) );\n\tvec3 clippedRect[5];\n\tclippedRect[0] = brdfWrtSurface * ( rectPoints[0] - P );\n\tclippedRect[1] = brdfWrtSurface * ( rectPoints[1] - P );\n\tclippedRect[2] = brdfWrtSurface * ( rectPoints[2] - P );\n\tclippedRect[3] = brdfWrtSurface * ( rectPoints[3] - P );\n\tint n;\n\tclipQuadToHorizon(clippedRect, n);\n\tif ( n == 0 )\n\t\treturn vec3( 0, 0, 0 );\n\tclippedRect[0] = normalize( clippedRect[0] );\n\tclippedRect[1] = normalize( clippedRect[1] );\n\tclippedRect[2] = normalize( clippedRect[2] );\n\tclippedRect[3] = normalize( clippedRect[3] );\n\tclippedRect[4] = normalize( clippedRect[4] );\n\tfloat sum = 0.0;\n\tsum += integrateLtcBrdfOverRectEdge( clippedRect[0], clippedRect[1] );\n\tsum += integrateLtcBrdfOverRectEdge( clippedRect[1], clippedRect[2] );\n\tsum += integrateLtcBrdfOverRectEdge( clippedRect[2], clippedRect[3] );\n\tif (n >= 4)\n\t\tsum += integrateLtcBrdfOverRectEdge( clippedRect[3], clippedRect[4] );\n\tif (n == 5)\n\t\tsum += integrateLtcBrdfOverRectEdge( clippedRect[4], clippedRect[0] );\n\tsum = max( 0.0, sum );\n\tvec3 Lo_i = vec3( sum, sum, sum );\n\treturn Lo_i;\n}\nvec3 Rect_Area_Light_Specular_Reflectance(\n\t\tconst in GeometricContext geometry,\n\t\tconst in vec3 lightPos, const in vec3 lightHalfWidth, const in vec3 lightHalfHeight,\n\t\tconst in float roughness,\n\t\tconst in sampler2D ltcMat, const in sampler2D ltcMag ) {\n\tvec3 rectPoints[4];\n\tinitRectPoints( lightPos, lightHalfWidth, lightHalfHeight, rectPoints );\n\tvec2 uv = ltcTextureCoords( geometry, roughness );\n\tvec4 brdfLtcApproxParams, t;\n\tbrdfLtcApproxParams = texture2D( ltcMat, uv );\n\tt = texture2D( ltcMat, uv );\n\tfloat brdfLtcScalar = texture2D( ltcMag, uv ).a;\n\tmat3 brdfLtcApproxMat = mat3(\n\t\tvec3(   1,   0, t.y ),\n\t\tvec3(   0, t.z,   0 ),\n\t\tvec3( t.w,   0, t.x )\n\t);\n\tvec3 specularReflectance = integrateLtcBrdfOverRect( geometry, brdfLtcApproxMat, rectPoints );\n\tspecularReflectance *= brdfLtcScalar;\n\treturn specularReflectance;\n}\nvec3 Rect_Area_Light_Diffuse_Reflectance(\n\t\tconst in GeometricContext geometry,\n\t\tconst in vec3 lightPos, const in vec3 lightHalfWidth, const in vec3 lightHalfHeight ) {\n\tvec3 rectPoints[4];\n\tinitRectPoints( lightPos, lightHalfWidth, lightHalfHeight, rectPoints );\n\tmat3 diffuseBrdfMat = mat3(1);\n\tvec3 diffuseReflectance = integrateLtcBrdfOverRect( geometry, diffuseBrdfMat, rectPoints );\n\treturn diffuseReflectance;\n}\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n\treturn specularColor * AB.x + AB.y;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n",
bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = dFdx( surf_pos );\n\t\tvec3 vSigmaY = dFdy( surf_pos );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif\n",
clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; ++ i ) {\n\t\tvec4 plane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t\t\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; ++ i ) {\n\t\t\tvec4 plane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\tif ( clipped ) discard;\n\t\n\t#endif\n#endif\n",
clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( PHYSICAL ) && ! defined( PHONG )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif\n",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvarying vec3 vViewPosition;\n#endif\n",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n",
color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif\n",color_pars_vertex:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",common:"#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transpose( const in mat3 v ) {\n\tmat3 tmp;\n\ttmp[0] = vec3(v[0].x, v[1].x, v[2].x);\n\ttmp[1] = vec3(v[0].y, v[1].y, v[2].y);\n\ttmp[2] = vec3(v[0].z, v[1].z, v[2].z);\n\treturn tmp;\n}\n",
cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_textureSize (1024.0)\nint getFaceFromDirection(vec3 direction) {\n\tvec3 absDirection = abs(direction);\n\tint face = -1;\n\tif( absDirection.x > absDirection.z ) {\n\t\tif(absDirection.x > absDirection.y )\n\t\t\tface = direction.x > 0.0 ? 0 : 3;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\telse {\n\t\tif(absDirection.z > absDirection.y )\n\t\t\tface = direction.z > 0.0 ? 2 : 5;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\treturn face;\n}\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\n\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\n\tfloat dxRoughness = dFdx(roughness);\n\tfloat dyRoughness = dFdy(roughness);\n\tvec3 dx = dFdx( vec * scale * dxRoughness );\n\tvec3 dy = dFdy( vec * scale * dyRoughness );\n\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\n\td = clamp(d, 1.0, cubeUV_rangeClamp);\n\tfloat mipLevel = 0.5 * log2(d);\n\treturn vec2(floor(mipLevel), fract(mipLevel));\n}\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\n\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\n\tfloat a = 16.0 * cubeUV_rcpTextureSize;\n\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\n\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\n\tfloat powScale = exp2_packed.x * exp2_packed.y;\n\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\n\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\n\tbool bRes = mipLevel == 0.0;\n\tscale =  bRes && (scale < a) ? a : scale;\n\tvec3 r;\n\tvec2 offset;\n\tint face = getFaceFromDirection(direction);\n\tfloat rcpPowScale = 1.0 / powScale;\n\tif( face == 0) {\n\t\tr = vec3(direction.x, -direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  a : offset.y;\n\t}\n\telse if( face == 1) {\n\t\tr = vec3(direction.y, direction.x, direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  a : offset.y;\n\t}\n\telse if( face == 2) {\n\t\tr = vec3(direction.z, direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  a : offset.y;\n\t}\n\telse if( face == 3) {\n\t\tr = vec3(direction.x, direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  0.0 : offset.y;\n\t}\n\telse if( face == 4) {\n\t\tr = vec3(direction.y, direction.x, -direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  0.0 : offset.y;\n\t}\n\telse {\n\t\tr = vec3(direction.z, -direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ?  0.0 : offset.y;\n\t}\n\tr = normalize(r);\n\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\n\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\n\tvec2 base = offset + vec2( texelOffset );\n\treturn base + s * ( scale - 2.0 * texelOffset );\n}\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\nvec4 textureCubeUV(vec3 reflectedDirection, float roughness ) {\n\tfloat roughnessVal = roughness* cubeUV_maxLods3;\n\tfloat r1 = floor(roughnessVal);\n\tfloat r2 = r1 + 1.0;\n\tfloat t = fract(roughnessVal);\n\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\n\tfloat s = mipInfo.y;\n\tfloat level0 = mipInfo.x;\n\tfloat level1 = level0 + 1.0;\n\tlevel1 = level1 > 5.0 ? 5.0 : level1;\n\tlevel0 += min( floor( s + 0.5 ), 5.0 );\n\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\n\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\n\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\n\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\n\tvec4 result = mix(color10, color20, t);\n\treturn vec4(result.rgb, 1.0);\n}\n#endif\n",
defaultnormal_vertex:"#ifdef FLIP_SIDED\n\tobjectNormal = -objectNormal;\n#endif\nvec3 transformedNormal = normalMatrix * objectNormal;\n",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif\n",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normal * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n#endif\n",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif\n",
emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif\n",encodings_fragment:"  gl_FragColor = linearToOutputTexel( gl_FragColor );\n",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n  return value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n  return vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n  return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n  return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n  return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n  return vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n  float maxComponent = max( max( value.r, value.g ), value.b );\n  float fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n  return vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n  return vec4( value.xyz * value.w * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n  float maxRGB = max( value.x, max( value.g, value.b ) );\n  float M      = clamp( maxRGB / maxRange, 0.0, 1.0 );\n  M            = ceil( M * 255.0 ) / 255.0;\n  return vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n    return vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n    float maxRGB = max( value.x, max( value.g, value.b ) );\n    float D      = max( maxRange / maxRGB, 1.0 );\n    D            = min( floor( D ) / 255.0, 1.0 );\n    return vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n  vec3 Xp_Y_XYZp = value.rgb * cLogLuvM;\n  Xp_Y_XYZp = max(Xp_Y_XYZp, vec3(1e-6, 1e-6, 1e-6));\n  vec4 vResult;\n  vResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n  float Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n  vResult.w = fract(Le);\n  vResult.z = (Le - (floor(vResult.w*255.0))/255.0)/255.0;\n  return vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n  float Le = value.z * 255.0 + value.w;\n  vec3 Xp_Y_XYZp;\n  Xp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\n  Xp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n  Xp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n  vec3 vRGB = Xp_Y_XYZp.rgb * cLogLuvInverseM;\n  return vec4( max(vRGB, 0.0), 1.0 );\n}\n",
envmap_fragment:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\tsampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\n\t\tsampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\tvec3 reflectView = flipNormal * normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\tenvColor = envMapTexelToLinear( envColor );\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif\n",
envmap_pars_fragment:"#if defined( USE_ENVMAP ) || defined( PHYSICAL )\n\tuniform float reflectivity;\n\tuniform float envMapIntensity;\n#endif\n#ifdef USE_ENVMAP\n\t#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )\n\t\tvarying vec3 vWorldPosition;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif\n",
envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif\n",envmap_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif\n",
fog_fragment:"#ifdef USE_FOG\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;\n\t#else\n\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n\t#endif\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * depth * depth * LOG2 ) );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif\n",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",
gradientmap_pars_fragment:"#ifdef TOON\n\tuniform sampler2D gradientMap;\n\tvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\t\tfloat dotNL = dot( normal, lightDirection );\n\t\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t\t#ifdef USE_GRADIENTMAP\n\t\t\treturn texture2D( gradientMap, coord ).rgb;\n\t\t#else\n\t\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t\t#endif\n\t}\n#endif\n",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n#endif\n",
lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvLightFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif\n",
lights_pars:"uniform vec3 ambientLightColor;\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltcMat;\tuniform sampler2D ltcMag;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif\n#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar - 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV(queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent));\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = saturate( reflectVec.y * 0.5 + 0.5 );\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif\n",
lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;\n",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\n#if NUM_RECT_AREA_LIGHTS > 0\n    void RE_Direct_RectArea_BlinnPhong( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n        vec3 matDiffColor = material.diffuseColor;\n        vec3 matSpecColor = material.specularColor;\n        vec3 lightColor   = rectAreaLight.color;\n        float roughness = BlinnExponentToGGXRoughness( material.specularShininess );\n        vec3 spec = Rect_Area_Light_Specular_Reflectance(\n                geometry,\n                rectAreaLight.position, rectAreaLight.halfWidth, rectAreaLight.halfHeight,\n                roughness,\n                ltcMat, ltcMag );\n        vec3 diff = Rect_Area_Light_Diffuse_Reflectance(\n                geometry,\n                rectAreaLight.position, rectAreaLight.halfWidth, rectAreaLight.halfHeight );\n        reflectedLight.directSpecular += lightColor * matSpecColor * spec / PI2;\n        reflectedLight.directDiffuse  += lightColor * matDiffColor * diff / PI2;\n    }\n#endif\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifdef TOON\n\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#else\n\t\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\t\tvec3 irradiance = dotNL * directLight.color;\n\t#endif\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)\n",
lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\n#ifdef STANDARD\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.clearCoat = saturate( clearCoat );\tmaterial.clearCoatRoughness = clamp( clearCoatRoughness, 0.04, 1.0 );\n#endif\n",
lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n\t#ifndef STANDARD\n\t\tfloat clearCoat;\n\t\tfloat clearCoatRoughness;\n\t#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearCoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n    void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n        vec3 matDiffColor = material.diffuseColor;\n        vec3 matSpecColor = material.specularColor;\n        vec3 lightColor   = rectAreaLight.color;\n        float roughness = material.specularRoughness;\n        vec3 spec = Rect_Area_Light_Specular_Reflectance(\n                geometry,\n                rectAreaLight.position, rectAreaLight.halfWidth, rectAreaLight.halfHeight,\n                roughness,\n                ltcMat, ltcMag );\n        vec3 diff = Rect_Area_Light_Diffuse_Reflectance(\n                geometry,\n                rectAreaLight.position, rectAreaLight.halfWidth, rectAreaLight.halfHeight );\n        reflectedLight.directSpecular += lightColor * matSpecColor * spec;\n        reflectedLight.directDiffuse  += lightColor * matDiffColor * diff;\n    }\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifndef STANDARD\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.directSpecular += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\n\treflectedLight.directDiffuse += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\t#ifndef STANDARD\n\t\treflectedLight.directSpecular += irradiance * material.clearCoat * BRDF_Specular_GGX( directLight, geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 clearCoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifndef STANDARD\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\tfloat dotNL = dotNV;\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.indirectSpecular += ( 1.0 - clearCoatDHR ) * radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\n\t#ifndef STANDARD\n\t\treflectedLight.indirectSpecular += clearCoatRadiance * material.clearCoat * BRDF_Specular_GGX_Environment( geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\n#define Material_ClearCoat_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.clearCoatRoughness )\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}\n",
lights_template:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = normalize( vViewPosition );\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#ifdef USE_LIGHTMAP\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t \tirradiance += getLightProbeIndirectIrradiance( geometry, 8 );\n\t#endif\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tvec3 radiance = getLightProbeIndirectRadiance( geometry, Material_BlinnShininessExponent( material ), 8 );\n\t#ifndef STANDARD\n\t\tvec3 clearCoatRadiance = getLightProbeIndirectRadiance( geometry, Material_ClearCoat_BlinnShininessExponent( material ), 8 );\n\t#else\n\t\tvec3 clearCoatRadiance = vec3( 0.0 );\n\t#endif\n\t\t\n\tRE_IndirectSpecular( radiance, clearCoatRadiance, geometry, material, reflectedLight );\n#endif\n",
logdepthbuf_fragment:"#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\tgl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#ifdef USE_LOGDEPTHBUF\n\tuniform float logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n#endif\n",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n\tuniform float logDepthBufFC;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\tgl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t#else\n\t\tgl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n\t#endif\n#endif\n",
map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif\n",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n",map_particle_fragment:"#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) * offsetRepeat.zw + offsetRepeat.xy );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n",map_particle_pars_fragment:"#ifdef USE_MAP\n\tuniform vec4 offsetRepeat;\n\tuniform sampler2D map;\n#endif\n",
metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.r;\n#endif\n",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n#endif\n",
morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\t#endif\n#endif\n",
normal_flip:"#ifdef DOUBLE_SIDED\n\tfloat flipNormal = ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n#else\n\tfloat flipNormal = 1.0;\n#endif\n",normal_fragment:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal ) * flipNormal;\n#endif\n#ifdef USE_NORMALMAP\n\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif\n",
normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n\t\tvec3 N = normalize( surf_norm );\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\tmapN.xy = normalScale * mapN.xy;\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif\n",
packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n  return normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n  return 1.0 - 2.0 * rgb.xyz;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n  return ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n  return linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n  return (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n  return ( near * far ) / ( ( far - near ) * invClipZ - far );\n}\n",
premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif\n",project_vertex:"#ifdef USE_SKINNING\n\tvec4 mvPosition = modelViewMatrix * skinned;\n#else\n\tvec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\n#endif\ngl_Position = projectionMatrix * mvPosition;\n",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.r;\n#endif\n",
roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n    #if NUM_RECT_AREA_LIGHTS > 0\n    #endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\treturn (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn 1.0;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\tfloat dp = ( length( lightToPosition ) - shadowBias ) / 1000.0;\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif\n",
shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n    #if NUM_RECT_AREA_LIGHTS > 0\n    #endif\n#endif\n",
shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n    #if NUM_RECT_AREA_LIGHTS > 0\n    #endif\n#endif\n",
shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tDirectionalLight directionalLight;\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tSpotLight spotLight;\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tPointLight pointLight;\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_RECT_AREA_LIGHTS > 0\n\t#endif\n\t#endif\n\treturn shadow;\n}\n",
skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureWidth;\n\t\tuniform int boneTextureHeight;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureWidth ) );\n\t\t\tfloat y = floor( j / float( boneTextureWidth ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureWidth );\n\t\t\tfloat dy = 1.0 / float( boneTextureHeight );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif\n",
skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\tskinned  = bindMatrixInverse * skinned;\n#endif\n",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n#endif\n",
specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n  gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif\n",tonemapping_pars_fragment:"#define saturate(a) clamp( a, 0.0, 1.0 )\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n  return toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n  color *= toneMappingExposure;\n  return saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n  color *= toneMappingExposure;\n  return saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n  color *= toneMappingExposure;\n  color = max( vec3( 0.0 ), color - 0.004 );\n  return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\n",
uv_pars_fragment:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n\tuniform vec4 offsetRepeat;\n#endif\n",
uv_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n#endif",
uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = uv2;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( PHYSICAL ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n\t#ifdef USE_SKINNING\n\t\tvec4 worldPosition = modelMatrix * skinned;\n\t#else\n\t\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n\t#endif\n#endif\n",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\n\tgl_FragColor.a *= opacity;\n}\n",
cube_vert:"varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}\n",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}\n",
depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n",
distanceRGBA_frag:"uniform vec3 lightPos;\nvarying vec4 vWorldPosition;\n#include <common>\n#include <packing>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tgl_FragColor = packDepthToRGBA( length( vWorldPosition.xyz - lightPos.xyz ) / 1000.0 );\n}\n",distanceRGBA_vert:"varying vec4 vWorldPosition;\n#include <common>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <skinbase_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition;\n}\n",
equirect_frag:"uniform sampler2D tEquirect;\nuniform float tFlip;\nvarying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldPosition );\n\tvec2 sampleUV;\n\tsampleUV.y = saturate( tFlip * direction.y * -0.5 + 0.5 );\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n}\n",equirect_vert:"varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}\n",
linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",
linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\treflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <normal_flip>\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",
meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n}\n",
meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <normal_flip>\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",
meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars>\n#include <color_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n}\n",
meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_flip>\n\t#include <normal_fragment>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_template>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",
meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n}\n",
meshphysical_frag:"#define PHYSICAL\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifndef STANDARD\n\tuniform float clearCoat;\n\tuniform float clearCoatRoughness;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <lights_pars>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_flip>\n\t#include <normal_fragment>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_template>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",
meshphysical_vert:"#define PHYSICAL\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n}\n",
normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED  ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\t#include <normal_flip>\n\t#include <normal_fragment>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#include <premultiplied_alpha_fragment>\n\t#include <encodings_fragment>\n}\n",
normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED  ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n#if defined( FLAT_SHADED  ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}\n",
points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",
points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#ifdef USE_SIZEATTENUATION\n\t\tgl_PointSize = size * ( scale / - mvPosition.z );\n\t#else\n\t\tgl_PointSize = size;\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n}\n",
shadow_frag:"uniform float opacity;\n#include <common>\n#include <packing>\n#include <bsdfs>\n#include <lights_pars>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( 0.0, 0.0, 0.0, opacity * ( 1.0  - getShadowMask() ) );\n}\n",shadow_vert:"#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n}\n"};N.prototype={constructor:N,
isColor:!0,r:1,g:1,b:1,set:function(a){a&&a.isColor?this.copy(a):"number"===typeof a?this.setHex(a):"string"===typeof a&&this.setStyle(a);return this},setScalar:function(a){this.b=this.g=this.r=a;return this},setHex:function(a){a=Math.floor(a);this.r=(a>>16&255)/255;this.g=(a>>8&255)/255;this.b=(a&255)/255;return this},setRGB:function(a,b,c){this.r=a;this.g=b;this.b=c;return this},setHSL:function(){function a(a,c,d){0>d&&(d+=1);1<d&&--d;return d<1/6?a+6*(c-a)*d:.5>d?c:d<2/3?a+6*(c-a)*(2/3-d):a}return function(b,
c,d){b=Q.euclideanModulo(b,1);c=Q.clamp(c,0,1);d=Q.clamp(d,0,1);0===c?this.r=this.g=this.b=d:(c=.5>=d?d*(1+c):d+c-d*c,d=2*d-c,this.r=a(d,c,b+1/3),this.g=a(d,c,b),this.b=a(d,c,b-1/3));return this}}(),setStyle:function(a){function b(b){void 0!==b&&1>parseFloat(b)&&console.warn("THREE.Color: Alpha component of "+a+" will be ignored.")}var c;if(c=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(a)){var d=c[2];switch(c[1]){case "rgb":case "rgba":if(c=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(d))return this.r=
Math.min(255,parseInt(c[1],10))/255,this.g=Math.min(255,parseInt(c[2],10))/255,this.b=Math.min(255,parseInt(c[3],10))/255,b(c[5]),this;if(c=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(d))return this.r=Math.min(100,parseInt(c[1],10))/100,this.g=Math.min(100,parseInt(c[2],10))/100,this.b=Math.min(100,parseInt(c[3],10))/100,b(c[5]),this;break;case "hsl":case "hsla":if(c=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(d)){var d=parseFloat(c[1])/
360,e=parseInt(c[2],10)/100,f=parseInt(c[3],10)/100;b(c[5]);return this.setHSL(d,e,f)}}}else if(c=/^\#([A-Fa-f0-9]+)$/.exec(a)){c=c[1];d=c.length;if(3===d)return this.r=parseInt(c.charAt(0)+c.charAt(0),16)/255,this.g=parseInt(c.charAt(1)+c.charAt(1),16)/255,this.b=parseInt(c.charAt(2)+c.charAt(2),16)/255,this;if(6===d)return this.r=parseInt(c.charAt(0)+c.charAt(1),16)/255,this.g=parseInt(c.charAt(2)+c.charAt(3),16)/255,this.b=parseInt(c.charAt(4)+c.charAt(5),16)/255,this}a&&0<a.length&&(c=Lf[a],void 0!==
c?this.setHex(c):console.warn("THREE.Color: Unknown color "+a));return this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(a){this.r=a.r;this.g=a.g;this.b=a.b;return this},copyGammaToLinear:function(a,b){void 0===b&&(b=2);this.r=Math.pow(a.r,b);this.g=Math.pow(a.g,b);this.b=Math.pow(a.b,b);return this},copyLinearToGamma:function(a,b){void 0===b&&(b=2);var c=0<b?1/b:1;this.r=Math.pow(a.r,c);this.g=Math.pow(a.g,c);this.b=Math.pow(a.b,c);return this},convertGammaToLinear:function(){var a=
this.r,b=this.g,c=this.b;this.r=a*a;this.g=b*b;this.b=c*c;return this},convertLinearToGamma:function(){this.r=Math.sqrt(this.r);this.g=Math.sqrt(this.g);this.b=Math.sqrt(this.b);return this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(a){a=a||{h:0,s:0,l:0};var b=this.r,c=this.g,d=this.b,e=Math.max(b,c,d),f=Math.min(b,c,d),g,h=(f+e)/2;if(f===e)f=g=0;else{var k=e-f,f=.5>=h?k/(e+f):
k/(2-e-f);switch(e){case b:g=(c-d)/k+(c<d?6:0);break;case c:g=(d-b)/k+2;break;case d:g=(b-c)/k+4}g/=6}a.h=g;a.s=f;a.l=h;return a},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(a,b,c){var d=this.getHSL();d.h+=a;d.s+=b;d.l+=c;this.setHSL(d.h,d.s,d.l);return this},add:function(a){this.r+=a.r;this.g+=a.g;this.b+=a.b;return this},addColors:function(a,b){this.r=a.r+b.r;this.g=a.g+b.g;this.b=a.b+b.b;return this},addScalar:function(a){this.r+=
a;this.g+=a;this.b+=a;return this},sub:function(a){this.r=Math.max(0,this.r-a.r);this.g=Math.max(0,this.g-a.g);this.b=Math.max(0,this.b-a.b);return this},multiply:function(a){this.r*=a.r;this.g*=a.g;this.b*=a.b;return this},multiplyScalar:function(a){this.r*=a;this.g*=a;this.b*=a;return this},lerp:function(a,b){this.r+=(a.r-this.r)*b;this.g+=(a.g-this.g)*b;this.b+=(a.b-this.b)*b;return this},equals:function(a){return a.r===this.r&&a.g===this.g&&a.b===this.b},fromArray:function(a,b){void 0===b&&(b=
0);this.r=a[b];this.g=a[b+1];this.b=a[b+2];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this.r;a[b+1]=this.g;a[b+2]=this.b;return a},toJSON:function(){return this.getHex()}};var Lf={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,
cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,
floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,
lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,
moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,
silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};db.prototype=Object.create(ea.prototype);db.prototype.constructor=db;db.prototype.isDataTexture=!0;var U={common:{diffuse:{value:new N(15658734)},opacity:{value:1},map:{value:null},offsetRepeat:{value:new ga(0,
0,1,1)},specularMap:{value:null},alphaMap:{value:null},envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new C(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},
roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:2.5E-4},fogNear:{value:1},fogFar:{value:2E3},fogColor:{value:new N(16777215)}},lights:{ambientLightColor:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},
direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},
width:{},height:{}}}},points:{diffuse:{value:new N(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},offsetRepeat:{value:new ga(0,0,1,1)}}},Gb={basic:{uniforms:Ja.merge([U.common,U.aomap,U.lightmap,U.fog]),vertexShader:Z.meshbasic_vert,fragmentShader:Z.meshbasic_frag},lambert:{uniforms:Ja.merge([U.common,U.aomap,U.lightmap,U.emissivemap,U.fog,U.lights,{emissive:{value:new N(0)}}]),vertexShader:Z.meshlambert_vert,fragmentShader:Z.meshlambert_frag},phong:{uniforms:Ja.merge([U.common,
U.aomap,U.lightmap,U.emissivemap,U.bumpmap,U.normalmap,U.displacementmap,U.gradientmap,U.fog,U.lights,{emissive:{value:new N(0)},specular:{value:new N(1118481)},shininess:{value:30}}]),vertexShader:Z.meshphong_vert,fragmentShader:Z.meshphong_frag},standard:{uniforms:Ja.merge([U.common,U.aomap,U.lightmap,U.emissivemap,U.bumpmap,U.normalmap,U.displacementmap,U.roughnessmap,U.metalnessmap,U.fog,U.lights,{emissive:{value:new N(0)},roughness:{value:.5},metalness:{value:0},envMapIntensity:{value:1}}]),
vertexShader:Z.meshphysical_vert,fragmentShader:Z.meshphysical_frag},points:{uniforms:Ja.merge([U.points,U.fog]),vertexShader:Z.points_vert,fragmentShader:Z.points_frag},dashed:{uniforms:Ja.merge([U.common,U.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Z.linedashed_vert,fragmentShader:Z.linedashed_frag},depth:{uniforms:Ja.merge([U.common,U.displacementmap]),vertexShader:Z.depth_vert,fragmentShader:Z.depth_frag},normal:{uniforms:Ja.merge([U.common,U.bumpmap,U.normalmap,
U.displacementmap,{opacity:{value:1}}]),vertexShader:Z.normal_vert,fragmentShader:Z.normal_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Z.cube_vert,fragmentShader:Z.cube_frag},equirect:{uniforms:{tEquirect:{value:null},tFlip:{value:-1}},vertexShader:Z.equirect_vert,fragmentShader:Z.equirect_frag},distanceRGBA:{uniforms:{lightPos:{value:new q}},vertexShader:Z.distanceRGBA_vert,fragmentShader:Z.distanceRGBA_frag}};Gb.physical={uniforms:Ja.merge([Gb.standard.uniforms,
{clearCoat:{value:0},clearCoatRoughness:{value:0}}]),vertexShader:Z.meshphysical_vert,fragmentShader:Z.meshphysical_frag};pc.prototype={constructor:pc,set:function(a,b){this.min.copy(a);this.max.copy(b);return this},setFromPoints:function(a){this.makeEmpty();for(var b=0,c=a.length;b<c;b++)this.expandByPoint(a[b]);return this},setFromCenterAndSize:function(){var a=new C;return function(b,c){var d=a.copy(c).multiplyScalar(.5);this.min.copy(b).sub(d);this.max.copy(b).add(d);return this}}(),clone:function(){return(new this.constructor).copy(this)},
copy:function(a){this.min.copy(a.min);this.max.copy(a.max);return this},makeEmpty:function(){this.min.x=this.min.y=Infinity;this.max.x=this.max.y=-Infinity;return this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(a){a=a||new C;return this.isEmpty()?a.set(0,0):a.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(a){a=a||new C;return this.isEmpty()?a.set(0,0):a.subVectors(this.max,this.min)},expandByPoint:function(a){this.min.min(a);this.max.max(a);
return this},expandByVector:function(a){this.min.sub(a);this.max.add(a);return this},expandByScalar:function(a){this.min.addScalar(-a);this.max.addScalar(a);return this},containsPoint:function(a){return a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y?!1:!0},containsBox:function(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y},getParameter:function(a,b){return(b||new C).set((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-
this.min.y))},intersectsBox:function(a){return a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y?!1:!0},clampPoint:function(a,b){return(b||new C).copy(a).clamp(this.min,this.max)},distanceToPoint:function(){var a=new C;return function(b){return a.copy(b).clamp(this.min,this.max).sub(b).length()}}(),intersect:function(a){this.min.max(a.min);this.max.min(a.max);return this},union:function(a){this.min.min(a.min);this.max.max(a.max);return this},translate:function(a){this.min.add(a);
this.max.add(a);return this},equals:function(a){return a.min.equals(this.min)&&a.max.equals(this.max)}};var pf=0;W.prototype={constructor:W,isMaterial:!0,get needsUpdate(){return this._needsUpdate},set needsUpdate(a){!0===a&&this.update();this._needsUpdate=a},setValues:function(a){if(void 0!==a)for(var b in a){var c=a[b];if(void 0===c)console.warn("THREE.Material: '"+b+"' parameter is undefined.");else{var d=this[b];void 0===d?console.warn("THREE."+this.type+": '"+b+"' is not a property of this material."):
d&&d.isColor?d.set(c):d&&d.isVector3&&c&&c.isVector3?d.copy(c):this[b]="overdraw"===b?Number(c):c}}},toJSON:function(a){function b(a){var b=[],c;for(c in a){var d=a[c];delete d.metadata;b.push(d)}return b}var c=void 0===a;c&&(a={textures:{},images:{}});var d={metadata:{version:4.4,type:"Material",generator:"Material.toJSON"}};d.uuid=this.uuid;d.type=this.type;""!==this.name&&(d.name=this.name);this.color&&this.color.isColor&&(d.color=this.color.getHex());void 0!==this.roughness&&(d.roughness=this.roughness);
void 0!==this.metalness&&(d.metalness=this.metalness);this.emissive&&this.emissive.isColor&&(d.emissive=this.emissive.getHex());this.specular&&this.specular.isColor&&(d.specular=this.specular.getHex());void 0!==this.shininess&&(d.shininess=this.shininess);void 0!==this.clearCoat&&(d.clearCoat=this.clearCoat);void 0!==this.clearCoatRoughness&&(d.clearCoatRoughness=this.clearCoatRoughness);this.map&&this.map.isTexture&&(d.map=this.map.toJSON(a).uuid);this.alphaMap&&this.alphaMap.isTexture&&(d.alphaMap=
this.alphaMap.toJSON(a).uuid);this.lightMap&&this.lightMap.isTexture&&(d.lightMap=this.lightMap.toJSON(a).uuid);this.bumpMap&&this.bumpMap.isTexture&&(d.bumpMap=this.bumpMap.toJSON(a).uuid,d.bumpScale=this.bumpScale);this.normalMap&&this.normalMap.isTexture&&(d.normalMap=this.normalMap.toJSON(a).uuid,d.normalScale=this.normalScale.toArray());this.displacementMap&&this.displacementMap.isTexture&&(d.displacementMap=this.displacementMap.toJSON(a).uuid,d.displacementScale=this.displacementScale,d.displacementBias=
this.displacementBias);this.roughnessMap&&this.roughnessMap.isTexture&&(d.roughnessMap=this.roughnessMap.toJSON(a).uuid);this.metalnessMap&&this.metalnessMap.isTexture&&(d.metalnessMap=this.metalnessMap.toJSON(a).uuid);this.emissiveMap&&this.emissiveMap.isTexture&&(d.emissiveMap=this.emissiveMap.toJSON(a).uuid);this.specularMap&&this.specularMap.isTexture&&(d.specularMap=this.specularMap.toJSON(a).uuid);this.envMap&&this.envMap.isTexture&&(d.envMap=this.envMap.toJSON(a).uuid,d.reflectivity=this.reflectivity);
this.gradientMap&&this.gradientMap.isTexture&&(d.gradientMap=this.gradientMap.toJSON(a).uuid);void 0!==this.size&&(d.size=this.size);void 0!==this.sizeAttenuation&&(d.sizeAttenuation=this.sizeAttenuation);1!==this.blending&&(d.blending=this.blending);2!==this.shading&&(d.shading=this.shading);0!==this.side&&(d.side=this.side);0!==this.vertexColors&&(d.vertexColors=this.vertexColors);1>this.opacity&&(d.opacity=this.opacity);!0===this.transparent&&(d.transparent=this.transparent);d.depthFunc=this.depthFunc;
d.depthTest=this.depthTest;d.depthWrite=this.depthWrite;0<this.alphaTest&&(d.alphaTest=this.alphaTest);!0===this.premultipliedAlpha&&(d.premultipliedAlpha=this.premultipliedAlpha);!0===this.wireframe&&(d.wireframe=this.wireframe);1<this.wireframeLinewidth&&(d.wireframeLinewidth=this.wireframeLinewidth);"round"!==this.wireframeLinecap&&(d.wireframeLinecap=this.wireframeLinecap);"round"!==this.wireframeLinejoin&&(d.wireframeLinejoin=this.wireframeLinejoin);d.skinning=this.skinning;d.morphTargets=this.morphTargets;
c&&(c=b(a.textures),a=b(a.images),0<c.length&&(d.textures=c),0<a.length&&(d.images=a));return d},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.name=a.name;this.fog=a.fog;this.lights=a.lights;this.blending=a.blending;this.side=a.side;this.shading=a.shading;this.vertexColors=a.vertexColors;this.opacity=a.opacity;this.transparent=a.transparent;this.blendSrc=a.blendSrc;this.blendDst=a.blendDst;this.blendEquation=a.blendEquation;this.blendSrcAlpha=a.blendSrcAlpha;this.blendDstAlpha=
a.blendDstAlpha;this.blendEquationAlpha=a.blendEquationAlpha;this.depthFunc=a.depthFunc;this.depthTest=a.depthTest;this.depthWrite=a.depthWrite;this.colorWrite=a.colorWrite;this.precision=a.precision;this.polygonOffset=a.polygonOffset;this.polygonOffsetFactor=a.polygonOffsetFactor;this.polygonOffsetUnits=a.polygonOffsetUnits;this.alphaTest=a.alphaTest;this.premultipliedAlpha=a.premultipliedAlpha;this.overdraw=a.overdraw;this.visible=a.visible;this.clipShadows=a.clipShadows;this.clipIntersection=a.clipIntersection;
a=a.clippingPlanes;var b=null;if(null!==a)for(var c=a.length,b=Array(c),d=0;d!==c;++d)b[d]=a[d].clone();this.clippingPlanes=b;return this},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}};Object.assign(W.prototype,oa.prototype);Ia.prototype=Object.create(W.prototype);Ia.prototype.constructor=Ia;Ia.prototype.isShaderMaterial=!0;Ia.prototype.copy=function(a){W.prototype.copy.call(this,a);this.fragmentShader=a.fragmentShader;this.vertexShader=
a.vertexShader;this.uniforms=Ja.clone(a.uniforms);this.defines=a.defines;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.lights=a.lights;this.clipping=a.clipping;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.morphNormals=a.morphNormals;this.extensions=a.extensions;return this};Ia.prototype.toJSON=function(a){a=W.prototype.toJSON.call(this,a);a.uniforms=this.uniforms;a.vertexShader=this.vertexShader;a.fragmentShader=this.fragmentShader;return a};ab.prototype=
Object.create(W.prototype);ab.prototype.constructor=ab;ab.prototype.isMeshDepthMaterial=!0;ab.prototype.copy=function(a){W.prototype.copy.call(this,a);this.depthPacking=a.depthPacking;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.map=a.map;this.alphaMap=a.alphaMap;this.displacementMap=a.displacementMap;this.displacementScale=a.displacementScale;this.displacementBias=a.displacementBias;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;return this};ya.prototype=
{constructor:ya,isBox3:!0,set:function(a,b){this.min.copy(a);this.max.copy(b);return this},setFromArray:function(a){for(var b=Infinity,c=Infinity,d=Infinity,e=-Infinity,f=-Infinity,g=-Infinity,h=0,k=a.length;h<k;h+=3){var m=a[h],l=a[h+1],p=a[h+2];m<b&&(b=m);l<c&&(c=l);p<d&&(d=p);m>e&&(e=m);l>f&&(f=l);p>g&&(g=p)}this.min.set(b,c,d);this.max.set(e,f,g)},setFromBufferAttribute:function(a){for(var b=Infinity,c=Infinity,d=Infinity,e=-Infinity,f=-Infinity,g=-Infinity,h=0,k=a.count;h<k;h++){var m=a.getX(h),
l=a.getY(h),p=a.getZ(h);m<b&&(b=m);l<c&&(c=l);p<d&&(d=p);m>e&&(e=m);l>f&&(f=l);p>g&&(g=p)}this.min.set(b,c,d);this.max.set(e,f,g)},setFromPoints:function(a){this.makeEmpty();for(var b=0,c=a.length;b<c;b++)this.expandByPoint(a[b]);return this},setFromCenterAndSize:function(){var a=new q;return function(b,c){var d=a.copy(c).multiplyScalar(.5);this.min.copy(b).sub(d);this.max.copy(b).add(d);return this}}(),setFromObject:function(){var a=new q;return function(b){var c=this;b.updateMatrixWorld(!0);this.makeEmpty();
b.traverse(function(b){var e,f;e=b.geometry;if(void 0!==e)if(e.isGeometry){var g=e.vertices;e=0;for(f=g.length;e<f;e++)a.copy(g[e]),a.applyMatrix4(b.matrixWorld),c.expandByPoint(a)}else if(e.isBufferGeometry&&(g=e.attributes.position,void 0!==g))for(e=0,f=g.count;e<f;e++)a.fromAttribute(g,e).applyMatrix4(b.matrixWorld),c.expandByPoint(a)});return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.min.copy(a.min);this.max.copy(a.max);return this},makeEmpty:function(){this.min.x=
this.min.y=this.min.z=Infinity;this.max.x=this.max.y=this.max.z=-Infinity;return this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(a){a=a||new q;return this.isEmpty()?a.set(0,0,0):a.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(a){a=a||new q;return this.isEmpty()?a.set(0,0,0):a.subVectors(this.max,this.min)},expandByPoint:function(a){this.min.min(a);this.max.max(a);return this},expandByVector:function(a){this.min.sub(a);
this.max.add(a);return this},expandByScalar:function(a){this.min.addScalar(-a);this.max.addScalar(a);return this},containsPoint:function(a){return a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y||a.z<this.min.z||a.z>this.max.z?!1:!0},containsBox:function(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y&&this.min.z<=a.min.z&&a.max.z<=this.max.z},getParameter:function(a,b){return(b||new q).set((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/
(this.max.y-this.min.y),(a.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(a){return a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y||a.max.z<this.min.z||a.min.z>this.max.z?!1:!0},intersectsSphere:function(){var a;return function(b){void 0===a&&(a=new q);this.clampPoint(b.center,a);return a.distanceToSquared(b.center)<=b.radius*b.radius}}(),intersectsPlane:function(a){var b,c;0<a.normal.x?(b=a.normal.x*this.min.x,c=a.normal.x*this.max.x):(b=a.normal.x*
this.max.x,c=a.normal.x*this.min.x);0<a.normal.y?(b+=a.normal.y*this.min.y,c+=a.normal.y*this.max.y):(b+=a.normal.y*this.max.y,c+=a.normal.y*this.min.y);0<a.normal.z?(b+=a.normal.z*this.min.z,c+=a.normal.z*this.max.z):(b+=a.normal.z*this.max.z,c+=a.normal.z*this.min.z);return b<=a.constant&&c>=a.constant},clampPoint:function(a,b){return(b||new q).copy(a).clamp(this.min,this.max)},distanceToPoint:function(){var a=new q;return function(b){return a.copy(b).clamp(this.min,this.max).sub(b).length()}}(),
getBoundingSphere:function(){var a=new q;return function(b){b=b||new Fa;this.getCenter(b.center);b.radius=.5*this.getSize(a).length();return b}}(),intersect:function(a){this.min.max(a.min);this.max.min(a.max);this.isEmpty()&&this.makeEmpty();return this},union:function(a){this.min.min(a.min);this.max.max(a.max);return this},applyMatrix4:function(){var a=[new q,new q,new q,new q,new q,new q,new q,new q];return function(b){if(this.isEmpty())return this;a[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(b);
a[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(b);a[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(b);a[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(b);a[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(b);a[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(b);a[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(b);a[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(b);this.setFromPoints(a);return this}}(),translate:function(a){this.min.add(a);this.max.add(a);
return this},equals:function(a){return a.min.equals(this.min)&&a.max.equals(this.max)}};Fa.prototype={constructor:Fa,set:function(a,b){this.center.copy(a);this.radius=b;return this},setFromPoints:function(){var a=new ya;return function(b,c){var d=this.center;void 0!==c?d.copy(c):a.setFromPoints(b).getCenter(d);for(var e=0,f=0,g=b.length;f<g;f++)e=Math.max(e,d.distanceToSquared(b[f]));this.radius=Math.sqrt(e);return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.center.copy(a.center);
this.radius=a.radius;return this},empty:function(){return 0>=this.radius},containsPoint:function(a){return a.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(a){return a.distanceTo(this.center)-this.radius},intersectsSphere:function(a){var b=this.radius+a.radius;return a.center.distanceToSquared(this.center)<=b*b},intersectsBox:function(a){return a.intersectsSphere(this)},intersectsPlane:function(a){return Math.abs(this.center.dot(a.normal)-a.constant)<=this.radius},
clampPoint:function(a,b){var c=this.center.distanceToSquared(a),d=b||new q;d.copy(a);c>this.radius*this.radius&&(d.sub(this.center).normalize(),d.multiplyScalar(this.radius).add(this.center));return d},getBoundingBox:function(a){a=a||new ya;a.set(this.center,this.center);a.expandByScalar(this.radius);return a},applyMatrix4:function(a){this.center.applyMatrix4(a);this.radius*=a.getMaxScaleOnAxis();return this},translate:function(a){this.center.add(a);return this},equals:function(a){return a.center.equals(this.center)&&
a.radius===this.radius}};za.prototype={constructor:za,isMatrix3:!0,set:function(a,b,c,d,e,f,g,h,k){var m=this.elements;m[0]=a;m[1]=d;m[2]=g;m[3]=b;m[4]=e;m[5]=h;m[6]=c;m[7]=f;m[8]=k;return this},identity:function(){this.set(1,0,0,0,1,0,0,0,1);return this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(a){a=a.elements;this.set(a[0],a[3],a[6],a[1],a[4],a[7],a[2],a[5],a[8]);return this},setFromMatrix4:function(a){a=a.elements;this.set(a[0],a[4],a[8],a[1],a[5],a[9],
a[2],a[6],a[10]);return this},applyToVector3Array:function(){var a;return function(b,c,d){void 0===a&&(a=new q);void 0===c&&(c=0);void 0===d&&(d=b.length);for(var e=0;e<d;e+=3,c+=3)a.fromArray(b,c),a.applyMatrix3(this),a.toArray(b,c);return b}}(),applyToBufferAttribute:function(){var a;return function(b){void 0===a&&(a=new q);for(var c=0,d=b.count;c<d;c++)a.x=b.getX(c),a.y=b.getY(c),a.z=b.getZ(c),a.applyMatrix3(this),b.setXYZ(c,a.x,a.y,a.z);return b}}(),multiplyScalar:function(a){var b=this.elements;
b[0]*=a;b[3]*=a;b[6]*=a;b[1]*=a;b[4]*=a;b[7]*=a;b[2]*=a;b[5]*=a;b[8]*=a;return this},determinant:function(){var a=this.elements,b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],k=a[7],a=a[8];return b*f*a-b*g*k-c*e*a+c*g*h+d*e*k-d*f*h},getInverse:function(a,b){a&&a.isMatrix4&&console.error("THREE.Matrix3.getInverse no longer takes a Matrix4 argument.");var c=a.elements,d=this.elements,e=c[0],f=c[1],g=c[2],h=c[3],k=c[4],m=c[5],l=c[6],p=c[7],c=c[8],n=c*k-m*p,r=m*l-c*h,w=p*h-k*l,q=e*n+f*r+g*w;if(0===
q){if(!0===b)throw Error("THREE.Matrix3.getInverse(): can't invert matrix, determinant is 0");console.warn("THREE.Matrix3.getInverse(): can't invert matrix, determinant is 0");return this.identity()}q=1/q;d[0]=n*q;d[1]=(g*p-c*f)*q;d[2]=(m*f-g*k)*q;d[3]=r*q;d[4]=(c*e-g*l)*q;d[5]=(g*h-m*e)*q;d[6]=w*q;d[7]=(f*l-p*e)*q;d[8]=(k*e-f*h)*q;return this},transpose:function(){var a,b=this.elements;a=b[1];b[1]=b[3];b[3]=a;a=b[2];b[2]=b[6];b[6]=a;a=b[5];b[5]=b[7];b[7]=a;return this},getNormalMatrix:function(a){return this.setFromMatrix4(a).getInverse(this).transpose()},
transposeIntoArray:function(a){var b=this.elements;a[0]=b[0];a[1]=b[3];a[2]=b[6];a[3]=b[1];a[4]=b[4];a[5]=b[7];a[6]=b[2];a[7]=b[5];a[8]=b[8];return this},fromArray:function(a,b){void 0===b&&(b=0);for(var c=0;9>c;c++)this.elements[c]=a[c+b];return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);var c=this.elements;a[b]=c[0];a[b+1]=c[1];a[b+2]=c[2];a[b+3]=c[3];a[b+4]=c[4];a[b+5]=c[5];a[b+6]=c[6];a[b+7]=c[7];a[b+8]=c[8];return a}};ma.prototype={constructor:ma,set:function(a,b){this.normal.copy(a);
this.constant=b;return this},setComponents:function(a,b,c,d){this.normal.set(a,b,c);this.constant=d;return this},setFromNormalAndCoplanarPoint:function(a,b){this.normal.copy(a);this.constant=-b.dot(this.normal);return this},setFromCoplanarPoints:function(){var a=new q,b=new q;return function(c,d,e){d=a.subVectors(e,d).cross(b.subVectors(c,d)).normalize();this.setFromNormalAndCoplanarPoint(d,c);return this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.normal.copy(a.normal);
this.constant=a.constant;return this},normalize:function(){var a=1/this.normal.length();this.normal.multiplyScalar(a);this.constant*=a;return this},negate:function(){this.constant*=-1;this.normal.negate();return this},distanceToPoint:function(a){return this.normal.dot(a)+this.constant},distanceToSphere:function(a){return this.distanceToPoint(a.center)-a.radius},projectPoint:function(a,b){return this.orthoPoint(a,b).sub(a).negate()},orthoPoint:function(a,b){var c=this.distanceToPoint(a);return(b||
new q).copy(this.normal).multiplyScalar(c)},intersectLine:function(){var a=new q;return function(b,c){var d=c||new q,e=b.delta(a),f=this.normal.dot(e);if(0===f){if(0===this.distanceToPoint(b.start))return d.copy(b.start)}else return f=-(b.start.dot(this.normal)+this.constant)/f,0>f||1<f?void 0:d.copy(e).multiplyScalar(f).add(b.start)}}(),intersectsLine:function(a){var b=this.distanceToPoint(a.start);a=this.distanceToPoint(a.end);return 0>b&&0<a||0>a&&0<b},intersectsBox:function(a){return a.intersectsPlane(this)},
intersectsSphere:function(a){return a.intersectsPlane(this)},coplanarPoint:function(a){return(a||new q).copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var a=new q,b=new za;return function(c,d){var e=this.coplanarPoint(a).applyMatrix4(c),f=d||b.getNormalMatrix(c),f=this.normal.applyMatrix3(f).normalize();this.constant=-e.dot(f);return this}}(),translate:function(a){this.constant-=a.dot(this.normal);return this},equals:function(a){return a.normal.equals(this.normal)&&a.constant===
this.constant}};qc.prototype={constructor:qc,set:function(a,b,c,d,e,f){var g=this.planes;g[0].copy(a);g[1].copy(b);g[2].copy(c);g[3].copy(d);g[4].copy(e);g[5].copy(f);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){for(var b=this.planes,c=0;6>c;c++)b[c].copy(a.planes[c]);return this},setFromMatrix:function(a){var b=this.planes,c=a.elements;a=c[0];var d=c[1],e=c[2],f=c[3],g=c[4],h=c[5],k=c[6],m=c[7],l=c[8],p=c[9],n=c[10],r=c[11],q=c[12],u=c[13],F=c[14],c=c[15];
b[0].setComponents(f-a,m-g,r-l,c-q).normalize();b[1].setComponents(f+a,m+g,r+l,c+q).normalize();b[2].setComponents(f+d,m+h,r+p,c+u).normalize();b[3].setComponents(f-d,m-h,r-p,c-u).normalize();b[4].setComponents(f-e,m-k,r-n,c-F).normalize();b[5].setComponents(f+e,m+k,r+n,c+F).normalize();return this},intersectsObject:function(){var a=new Fa;return function(b){var c=b.geometry;null===c.boundingSphere&&c.computeBoundingSphere();a.copy(c.boundingSphere).applyMatrix4(b.matrixWorld);return this.intersectsSphere(a)}}(),
intersectsSprite:function(){var a=new Fa;return function(b){a.center.set(0,0,0);a.radius=.7071067811865476;a.applyMatrix4(b.matrixWorld);return this.intersectsSphere(a)}}(),intersectsSphere:function(a){var b=this.planes,c=a.center;a=-a.radius;for(var d=0;6>d;d++)if(b[d].distanceToPoint(c)<a)return!1;return!0},intersectsBox:function(){var a=new q,b=new q;return function(c){for(var d=this.planes,e=0;6>e;e++){var f=d[e];a.x=0<f.normal.x?c.min.x:c.max.x;b.x=0<f.normal.x?c.max.x:c.min.x;a.y=0<f.normal.y?
c.min.y:c.max.y;b.y=0<f.normal.y?c.max.y:c.min.y;a.z=0<f.normal.z?c.min.z:c.max.z;b.z=0<f.normal.z?c.max.z:c.min.z;var g=f.distanceToPoint(a),f=f.distanceToPoint(b);if(0>g&&0>f)return!1}return!0}}(),containsPoint:function(a){for(var b=this.planes,c=0;6>c;c++)if(0>b[c].distanceToPoint(a))return!1;return!0}};bb.prototype={constructor:bb,set:function(a,b){this.origin.copy(a);this.direction.copy(b);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.origin.copy(a.origin);
this.direction.copy(a.direction);return this},at:function(a,b){return(b||new q).copy(this.direction).multiplyScalar(a).add(this.origin)},lookAt:function(a){this.direction.copy(a).sub(this.origin).normalize();return this},recast:function(){var a=new q;return function(b){this.origin.copy(this.at(b,a));return this}}(),closestPointToPoint:function(a,b){var c=b||new q;c.subVectors(a,this.origin);var d=c.dot(this.direction);return 0>d?c.copy(this.origin):c.copy(this.direction).multiplyScalar(d).add(this.origin)},
distanceToPoint:function(a){return Math.sqrt(this.distanceSqToPoint(a))},distanceSqToPoint:function(){var a=new q;return function(b){var c=a.subVectors(b,this.origin).dot(this.direction);if(0>c)return this.origin.distanceToSquared(b);a.copy(this.direction).multiplyScalar(c).add(this.origin);return a.distanceToSquared(b)}}(),distanceSqToSegment:function(){var a=new q,b=new q,c=new q;return function(d,e,f,g){a.copy(d).add(e).multiplyScalar(.5);b.copy(e).sub(d).normalize();c.copy(this.origin).sub(a);
var h=.5*d.distanceTo(e),k=-this.direction.dot(b),m=c.dot(this.direction),l=-c.dot(b),p=c.lengthSq(),n=Math.abs(1-k*k),r;0<n?(d=k*l-m,e=k*m-l,r=h*n,0<=d?e>=-r?e<=r?(h=1/n,d*=h,e*=h,k=d*(d+k*e+2*m)+e*(k*d+e+2*l)+p):(e=h,d=Math.max(0,-(k*e+m)),k=-d*d+e*(e+2*l)+p):(e=-h,d=Math.max(0,-(k*e+m)),k=-d*d+e*(e+2*l)+p):e<=-r?(d=Math.max(0,-(-k*h+m)),e=0<d?-h:Math.min(Math.max(-h,-l),h),k=-d*d+e*(e+2*l)+p):e<=r?(d=0,e=Math.min(Math.max(-h,-l),h),k=e*(e+2*l)+p):(d=Math.max(0,-(k*h+m)),e=0<d?h:Math.min(Math.max(-h,
-l),h),k=-d*d+e*(e+2*l)+p)):(e=0<k?-h:h,d=Math.max(0,-(k*e+m)),k=-d*d+e*(e+2*l)+p);f&&f.copy(this.direction).multiplyScalar(d).add(this.origin);g&&g.copy(b).multiplyScalar(e).add(a);return k}}(),intersectSphere:function(){var a=new q;return function(b,c){a.subVectors(b.center,this.origin);var d=a.dot(this.direction),e=a.dot(a)-d*d,f=b.radius*b.radius;if(e>f)return null;f=Math.sqrt(f-e);e=d-f;d+=f;return 0>e&&0>d?null:0>e?this.at(d,c):this.at(e,c)}}(),intersectsSphere:function(a){return this.distanceToPoint(a.center)<=
a.radius},distanceToPlane:function(a){var b=a.normal.dot(this.direction);if(0===b)return 0===a.distanceToPoint(this.origin)?0:null;a=-(this.origin.dot(a.normal)+a.constant)/b;return 0<=a?a:null},intersectPlane:function(a,b){var c=this.distanceToPlane(a);return null===c?null:this.at(c,b)},intersectsPlane:function(a){var b=a.distanceToPoint(this.origin);return 0===b||0>a.normal.dot(this.direction)*b?!0:!1},intersectBox:function(a,b){var c,d,e,f,g;d=1/this.direction.x;f=1/this.direction.y;g=1/this.direction.z;
var h=this.origin;0<=d?(c=(a.min.x-h.x)*d,d*=a.max.x-h.x):(c=(a.max.x-h.x)*d,d*=a.min.x-h.x);0<=f?(e=(a.min.y-h.y)*f,f*=a.max.y-h.y):(e=(a.max.y-h.y)*f,f*=a.min.y-h.y);if(c>f||e>d)return null;if(e>c||c!==c)c=e;if(f<d||d!==d)d=f;0<=g?(e=(a.min.z-h.z)*g,g*=a.max.z-h.z):(e=(a.max.z-h.z)*g,g*=a.min.z-h.z);if(c>g||e>d)return null;if(e>c||c!==c)c=e;if(g<d||d!==d)d=g;return 0>d?null:this.at(0<=c?c:d,b)},intersectsBox:function(){var a=new q;return function(b){return null!==this.intersectBox(b,a)}}(),intersectTriangle:function(){var a=
new q,b=new q,c=new q,d=new q;return function(e,f,g,h,k){b.subVectors(f,e);c.subVectors(g,e);d.crossVectors(b,c);f=this.direction.dot(d);if(0<f){if(h)return null;h=1}else if(0>f)h=-1,f=-f;else return null;a.subVectors(this.origin,e);e=h*this.direction.dot(c.crossVectors(a,c));if(0>e)return null;g=h*this.direction.dot(b.cross(a));if(0>g||e+g>f)return null;e=-h*a.dot(d);return 0>e?null:this.at(e/f,k)}}(),applyMatrix4:function(a){this.direction.add(this.origin).applyMatrix4(a);this.origin.applyMatrix4(a);
this.direction.sub(this.origin);this.direction.normalize();return this},equals:function(a){return a.origin.equals(this.origin)&&a.direction.equals(this.direction)}};cb.RotationOrders="XYZ YZX ZXY XZY YXZ ZYX".split(" ");cb.DefaultOrder="XYZ";cb.prototype={constructor:cb,isEuler:!0,get x(){return this._x},set x(a){this._x=a;this.onChangeCallback()},get y(){return this._y},set y(a){this._y=a;this.onChangeCallback()},get z(){return this._z},set z(a){this._z=a;this.onChangeCallback()},get order(){return this._order},
set order(a){this._order=a;this.onChangeCallback()},set:function(a,b,c,d){this._x=a;this._y=b;this._z=c;this._order=d||this._order;this.onChangeCallback();return this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(a){this._x=a._x;this._y=a._y;this._z=a._z;this._order=a._order;this.onChangeCallback();return this},setFromRotationMatrix:function(a,b,c){var d=Q.clamp,e=a.elements;a=e[0];var f=e[4],g=e[8],h=e[1],k=e[5],m=e[9],l=e[2],p=e[6],e=e[10];b=b||
this._order;"XYZ"===b?(this._y=Math.asin(d(g,-1,1)),.99999>Math.abs(g)?(this._x=Math.atan2(-m,e),this._z=Math.atan2(-f,a)):(this._x=Math.atan2(p,k),this._z=0)):"YXZ"===b?(this._x=Math.asin(-d(m,-1,1)),.99999>Math.abs(m)?(this._y=Math.atan2(g,e),this._z=Math.atan2(h,k)):(this._y=Math.atan2(-l,a),this._z=0)):"ZXY"===b?(this._x=Math.asin(d(p,-1,1)),.99999>Math.abs(p)?(this._y=Math.atan2(-l,e),this._z=Math.atan2(-f,k)):(this._y=0,this._z=Math.atan2(h,a))):"ZYX"===b?(this._y=Math.asin(-d(l,-1,1)),.99999>
Math.abs(l)?(this._x=Math.atan2(p,e),this._z=Math.atan2(h,a)):(this._x=0,this._z=Math.atan2(-f,k))):"YZX"===b?(this._z=Math.asin(d(h,-1,1)),.99999>Math.abs(h)?(this._x=Math.atan2(-m,k),this._y=Math.atan2(-l,a)):(this._x=0,this._y=Math.atan2(g,e))):"XZY"===b?(this._z=Math.asin(-d(f,-1,1)),.99999>Math.abs(f)?(this._x=Math.atan2(p,k),this._y=Math.atan2(g,a)):(this._x=Math.atan2(-m,e),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+b);this._order=b;if(!1!==c)this.onChangeCallback();
return this},setFromQuaternion:function(){var a;return function(b,c,d){void 0===a&&(a=new H);a.makeRotationFromQuaternion(b);return this.setFromRotationMatrix(a,c,d)}}(),setFromVector3:function(a,b){return this.set(a.x,a.y,a.z,b||this._order)},reorder:function(){var a=new da;return function(b){a.setFromEuler(this);return this.setFromQuaternion(a,b)}}(),equals:function(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._order===this._order},fromArray:function(a){this._x=a[0];this._y=a[1];
this._z=a[2];void 0!==a[3]&&(this._order=a[3]);this.onChangeCallback();return this},toArray:function(a,b){void 0===a&&(a=[]);void 0===b&&(b=0);a[b]=this._x;a[b+1]=this._y;a[b+2]=this._z;a[b+3]=this._order;return a},toVector3:function(a){return a?a.set(this._x,this._y,this._z):new q(this._x,this._y,this._z)},onChange:function(a){this.onChangeCallback=a;return this},onChangeCallback:function(){}};gd.prototype={constructor:gd,set:function(a){this.mask=1<<a},enable:function(a){this.mask|=1<<a},toggle:function(a){this.mask^=
1<<a},disable:function(a){this.mask&=~(1<<a)},test:function(a){return 0!==(this.mask&a.mask)}};var qf=0;G.DefaultUp=new q(0,1,0);G.DefaultMatrixAutoUpdate=!0;Object.assign(G.prototype,oa.prototype,{isObject3D:!0,applyMatrix:function(a){this.matrix.multiplyMatrices(a,this.matrix);this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(a,b){this.quaternion.setFromAxisAngle(a,b)},setRotationFromEuler:function(a){this.quaternion.setFromEuler(a,!0)},setRotationFromMatrix:function(a){this.quaternion.setFromRotationMatrix(a)},
setRotationFromQuaternion:function(a){this.quaternion.copy(a)},rotateOnAxis:function(){var a=new da;return function(b,c){a.setFromAxisAngle(b,c);this.quaternion.multiply(a);return this}}(),rotateX:function(){var a=new q(1,0,0);return function(b){return this.rotateOnAxis(a,b)}}(),rotateY:function(){var a=new q(0,1,0);return function(b){return this.rotateOnAxis(a,b)}}(),rotateZ:function(){var a=new q(0,0,1);return function(b){return this.rotateOnAxis(a,b)}}(),translateOnAxis:function(){var a=new q;
return function(b,c){a.copy(b).applyQuaternion(this.quaternion);this.position.add(a.multiplyScalar(c));return this}}(),translateX:function(){var a=new q(1,0,0);return function(b){return this.translateOnAxis(a,b)}}(),translateY:function(){var a=new q(0,1,0);return function(b){return this.translateOnAxis(a,b)}}(),translateZ:function(){var a=new q(0,0,1);return function(b){return this.translateOnAxis(a,b)}}(),localToWorld:function(a){return a.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var a=
new H;return function(b){return b.applyMatrix4(a.getInverse(this.matrixWorld))}}(),lookAt:function(){var a=new H;return function(b){a.lookAt(b,this.position,this.up);this.quaternion.setFromRotationMatrix(a)}}(),add:function(a){if(1<arguments.length){for(var b=0;b<arguments.length;b++)this.add(arguments[b]);return this}if(a===this)return console.error("THREE.Object3D.add: object can't be added as a child of itself.",a),this;a&&a.isObject3D?(null!==a.parent&&a.parent.remove(a),a.parent=this,a.dispatchEvent({type:"added"}),
this.children.push(a)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",a);return this},remove:function(a){if(1<arguments.length)for(var b=0;b<arguments.length;b++)this.remove(arguments[b]);b=this.children.indexOf(a);-1!==b&&(a.parent=null,a.dispatchEvent({type:"removed"}),this.children.splice(b,1))},getObjectById:function(a){return this.getObjectByProperty("id",a)},getObjectByName:function(a){return this.getObjectByProperty("name",a)},getObjectByProperty:function(a,b){if(this[a]===
b)return this;for(var c=0,d=this.children.length;c<d;c++){var e=this.children[c].getObjectByProperty(a,b);if(void 0!==e)return e}},getWorldPosition:function(a){a=a||new q;this.updateMatrixWorld(!0);return a.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var a=new q,b=new q;return function(c){c=c||new da;this.updateMatrixWorld(!0);this.matrixWorld.decompose(a,c,b);return c}}(),getWorldRotation:function(){var a=new da;return function(b){b=b||new cb;this.getWorldQuaternion(a);
return b.setFromQuaternion(a,this.rotation.order,!1)}}(),getWorldScale:function(){var a=new q,b=new da;return function(c){c=c||new q;this.updateMatrixWorld(!0);this.matrixWorld.decompose(a,b,c);return c}}(),getWorldDirection:function(){var a=new da;return function(b){b=b||new q;this.getWorldQuaternion(a);return b.set(0,0,1).applyQuaternion(a)}}(),raycast:function(){},traverse:function(a){a(this);for(var b=this.children,c=0,d=b.length;c<d;c++)b[c].traverse(a)},traverseVisible:function(a){if(!1!==this.visible){a(this);
for(var b=this.children,c=0,d=b.length;c<d;c++)b[c].traverseVisible(a)}},traverseAncestors:function(a){var b=this.parent;null!==b&&(a(b),b.traverseAncestors(a))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale);this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(a){!0===this.matrixAutoUpdate&&this.updateMatrix();if(!0===this.matrixWorldNeedsUpdate||!0===a)null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,
this.matrix),this.matrixWorldNeedsUpdate=!1,a=!0;for(var b=this.children,c=0,d=b.length;c<d;c++)b[c].updateMatrixWorld(a)},toJSON:function(a){function b(a){var b=[],c;for(c in a){var d=a[c];delete d.metadata;b.push(d)}return b}var c=void 0===a||""===a,d={};c&&(a={geometries:{},materials:{},textures:{},images:{}},d.metadata={version:4.4,type:"Object",generator:"Object3D.toJSON"});var e={};e.uuid=this.uuid;e.type=this.type;""!==this.name&&(e.name=this.name);"{}"!==JSON.stringify(this.userData)&&(e.userData=
this.userData);!0===this.castShadow&&(e.castShadow=!0);!0===this.receiveShadow&&(e.receiveShadow=!0);!1===this.visible&&(e.visible=!1);e.matrix=this.matrix.toArray();void 0!==this.geometry&&(void 0===a.geometries[this.geometry.uuid]&&(a.geometries[this.geometry.uuid]=this.geometry.toJSON(a)),e.geometry=this.geometry.uuid);void 0!==this.material&&(void 0===a.materials[this.material.uuid]&&(a.materials[this.material.uuid]=this.material.toJSON(a)),e.material=this.material.uuid);if(0<this.children.length){e.children=
[];for(var f=0;f<this.children.length;f++)e.children.push(this.children[f].toJSON(a).object)}if(c){var c=b(a.geometries),f=b(a.materials),g=b(a.textures);a=b(a.images);0<c.length&&(d.geometries=c);0<f.length&&(d.materials=f);0<g.length&&(d.textures=g);0<a.length&&(d.images=a)}d.object=e;return d},clone:function(a){return(new this.constructor).copy(this,a)},copy:function(a,b){void 0===b&&(b=!0);this.name=a.name;this.up.copy(a.up);this.position.copy(a.position);this.quaternion.copy(a.quaternion);this.scale.copy(a.scale);
this.matrix.copy(a.matrix);this.matrixWorld.copy(a.matrixWorld);this.matrixAutoUpdate=a.matrixAutoUpdate;this.matrixWorldNeedsUpdate=a.matrixWorldNeedsUpdate;this.layers.mask=a.layers.mask;this.visible=a.visible;this.castShadow=a.castShadow;this.receiveShadow=a.receiveShadow;this.frustumCulled=a.frustumCulled;this.renderOrder=a.renderOrder;this.userData=JSON.parse(JSON.stringify(a.userData));if(!0===b)for(var c=0;c<a.children.length;c++)this.add(a.children[c].clone());return this}});gb.prototype=
{constructor:gb,set:function(a,b){this.start.copy(a);this.end.copy(b);return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.start.copy(a.start);this.end.copy(a.end);return this},getCenter:function(a){return(a||new q).addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(a){return(a||new q).subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},
at:function(a,b){var c=b||new q;return this.delta(c).multiplyScalar(a).add(this.start)},closestPointToPointParameter:function(){var a=new q,b=new q;return function(c,d){a.subVectors(c,this.start);b.subVectors(this.end,this.start);var e=b.dot(b),e=b.dot(a)/e;d&&(e=Q.clamp(e,0,1));return e}}(),closestPointToPoint:function(a,b,c){a=this.closestPointToPointParameter(a,b);c=c||new q;return this.delta(c).multiplyScalar(a).add(this.start)},applyMatrix4:function(a){this.start.applyMatrix4(a);this.end.applyMatrix4(a);
return this},equals:function(a){return a.start.equals(this.start)&&a.end.equals(this.end)}};Aa.normal=function(){var a=new q;return function(b,c,d,e){e=e||new q;e.subVectors(d,c);a.subVectors(b,c);e.cross(a);b=e.lengthSq();return 0<b?e.multiplyScalar(1/Math.sqrt(b)):e.set(0,0,0)}}();Aa.barycoordFromPoint=function(){var a=new q,b=new q,c=new q;return function(d,e,f,g,h){a.subVectors(g,e);b.subVectors(f,e);c.subVectors(d,e);d=a.dot(a);e=a.dot(b);f=a.dot(c);var k=b.dot(b);g=b.dot(c);var m=d*k-e*e;h=
h||new q;if(0===m)return h.set(-2,-1,-1);m=1/m;k=(k*f-e*g)*m;d=(d*g-e*f)*m;return h.set(1-k-d,d,k)}}();Aa.containsPoint=function(){var a=new q;return function(b,c,d,e){b=Aa.barycoordFromPoint(b,c,d,e,a);return 0<=b.x&&0<=b.y&&1>=b.x+b.y}}();Aa.prototype={constructor:Aa,set:function(a,b,c){this.a.copy(a);this.b.copy(b);this.c.copy(c);return this},setFromPointsAndIndices:function(a,b,c,d){this.a.copy(a[b]);this.b.copy(a[c]);this.c.copy(a[d]);return this},clone:function(){return(new this.constructor).copy(this)},
copy:function(a){this.a.copy(a.a);this.b.copy(a.b);this.c.copy(a.c);return this},area:function(){var a=new q,b=new q;return function(){a.subVectors(this.c,this.b);b.subVectors(this.a,this.b);return.5*a.cross(b).length()}}(),midpoint:function(a){return(a||new q).addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(a){return Aa.normal(this.a,this.b,this.c,a)},plane:function(a){return(a||new ma).setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(a,b){return Aa.barycoordFromPoint(a,
this.a,this.b,this.c,b)},containsPoint:function(a){return Aa.containsPoint(a,this.a,this.b,this.c)},closestPointToPoint:function(){var a,b,c,d;return function(e,f){void 0===a&&(a=new ma,b=[new gb,new gb,new gb],c=new q,d=new q);var g=f||new q,h=Infinity;a.setFromCoplanarPoints(this.a,this.b,this.c);a.projectPoint(e,c);if(!0===this.containsPoint(c))g.copy(c);else{b[0].set(this.a,this.b);b[1].set(this.b,this.c);b[2].set(this.c,this.a);for(var k=0;k<b.length;k++){b[k].closestPointToPoint(c,!0,d);var m=
c.distanceToSquared(d);m<h&&(h=m,g.copy(d))}}return g}}(),equals:function(a){return a.a.equals(this.a)&&a.b.equals(this.b)&&a.c.equals(this.c)}};ha.prototype={constructor:ha,clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.a=a.a;this.b=a.b;this.c=a.c;this.normal.copy(a.normal);this.color.copy(a.color);this.materialIndex=a.materialIndex;for(var b=0,c=a.vertexNormals.length;b<c;b++)this.vertexNormals[b]=a.vertexNormals[b].clone();b=0;for(c=a.vertexColors.length;b<c;b++)this.vertexColors[b]=
a.vertexColors[b].clone();return this}};Ka.prototype=Object.create(W.prototype);Ka.prototype.constructor=Ka;Ka.prototype.isMeshBasicMaterial=!0;Ka.prototype.copy=function(a){W.prototype.copy.call(this,a);this.color.copy(a.color);this.map=a.map;this.lightMap=a.lightMap;this.lightMapIntensity=a.lightMapIntensity;this.aoMap=a.aoMap;this.aoMapIntensity=a.aoMapIntensity;this.specularMap=a.specularMap;this.alphaMap=a.alphaMap;this.envMap=a.envMap;this.combine=a.combine;this.reflectivity=a.reflectivity;
this.refractionRatio=a.refractionRatio;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.wireframeLinecap=a.wireframeLinecap;this.wireframeLinejoin=a.wireframeLinejoin;this.skinning=a.skinning;this.morphTargets=a.morphTargets;return this};y.prototype={constructor:y,isBufferAttribute:!0,set needsUpdate(a){!0===a&&this.version++},setArray:function(a){if(Array.isArray(a))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.count=void 0!==a?a.length/
this.itemSize:0;this.array=a},setDynamic:function(a){this.dynamic=a;return this},copy:function(a){this.array=new a.array.constructor(a.array);this.itemSize=a.itemSize;this.count=a.count;this.normalized=a.normalized;this.dynamic=a.dynamic;return this},copyAt:function(a,b,c){a*=this.itemSize;c*=b.itemSize;for(var d=0,e=this.itemSize;d<e;d++)this.array[a+d]=b.array[c+d];return this},copyArray:function(a){this.array.set(a);return this},copyColorsArray:function(a){for(var b=this.array,c=0,d=0,e=a.length;d<
e;d++){var f=a[d];void 0===f&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",d),f=new N);b[c++]=f.r;b[c++]=f.g;b[c++]=f.b}return this},copyIndicesArray:function(a){for(var b=this.array,c=0,d=0,e=a.length;d<e;d++){var f=a[d];b[c++]=f.a;b[c++]=f.b;b[c++]=f.c}return this},copyVector2sArray:function(a){for(var b=this.array,c=0,d=0,e=a.length;d<e;d++){var f=a[d];void 0===f&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",d),f=new C);b[c++]=f.x;
b[c++]=f.y}return this},copyVector3sArray:function(a){for(var b=this.array,c=0,d=0,e=a.length;d<e;d++){var f=a[d];void 0===f&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",d),f=new q);b[c++]=f.x;b[c++]=f.y;b[c++]=f.z}return this},copyVector4sArray:function(a){for(var b=this.array,c=0,d=0,e=a.length;d<e;d++){var f=a[d];void 0===f&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",d),f=new ga);b[c++]=f.x;b[c++]=f.y;b[c++]=f.z;b[c++]=f.w}return this},
set:function(a,b){void 0===b&&(b=0);this.array.set(a,b);return this},getX:function(a){return this.array[a*this.itemSize]},setX:function(a,b){this.array[a*this.itemSize]=b;return this},getY:function(a){return this.array[a*this.itemSize+1]},setY:function(a,b){this.array[a*this.itemSize+1]=b;return this},getZ:function(a){return this.array[a*this.itemSize+2]},setZ:function(a,b){this.array[a*this.itemSize+2]=b;return this},getW:function(a){return this.array[a*this.itemSize+3]},setW:function(a,b){this.array[a*
this.itemSize+3]=b;return this},setXY:function(a,b,c){a*=this.itemSize;this.array[a+0]=b;this.array[a+1]=c;return this},setXYZ:function(a,b,c,d){a*=this.itemSize;this.array[a+0]=b;this.array[a+1]=c;this.array[a+2]=d;return this},setXYZW:function(a,b,c,d,e){a*=this.itemSize;this.array[a+0]=b;this.array[a+1]=c;this.array[a+2]=d;this.array[a+3]=e;return this},onUpload:function(a){this.onUploadCallback=a;return this},clone:function(){return(new this.constructor).copy(this)}};rc.prototype=Object.create(y.prototype);
rc.prototype.constructor=rc;sc.prototype=Object.create(y.prototype);sc.prototype.constructor=sc;tc.prototype=Object.create(y.prototype);tc.prototype.constructor=tc;uc.prototype=Object.create(y.prototype);uc.prototype.constructor=uc;Ra.prototype=Object.create(y.prototype);Ra.prototype.constructor=Ra;vc.prototype=Object.create(y.prototype);vc.prototype.constructor=vc;Ua.prototype=Object.create(y.prototype);Ua.prototype.constructor=Ua;X.prototype=Object.create(y.prototype);X.prototype.constructor=X;
wc.prototype=Object.create(y.prototype);wc.prototype.constructor=wc;Object.assign(ze.prototype,{computeGroups:function(a){var b,c=[],d=void 0;a=a.faces;for(var e=0;e<a.length;e++){var f=a[e];f.materialIndex!==d&&(d=f.materialIndex,void 0!==b&&(b.count=3*e-b.start,c.push(b)),b={start:3*e,materialIndex:d})}void 0!==b&&(b.count=3*e-b.start,c.push(b));this.groups=c},fromGeometry:function(a){var b=a.faces,c=a.vertices,d=a.faceVertexUvs,e=d[0]&&0<d[0].length,f=d[1]&&0<d[1].length,g=a.morphTargets,h=g.length,
k;if(0<h){k=[];for(var m=0;m<h;m++)k[m]=[];this.morphTargets.position=k}var l=a.morphNormals,p=l.length,n;if(0<p){n=[];for(m=0;m<p;m++)n[m]=[];this.morphTargets.normal=n}for(var r=a.skinIndices,q=a.skinWeights,u=r.length===c.length,F=q.length===c.length,m=0;m<b.length;m++){var t=b[m];this.vertices.push(c[t.a],c[t.b],c[t.c]);var v=t.vertexNormals;3===v.length?this.normals.push(v[0],v[1],v[2]):(v=t.normal,this.normals.push(v,v,v));v=t.vertexColors;3===v.length?this.colors.push(v[0],v[1],v[2]):(v=t.color,
this.colors.push(v,v,v));!0===e&&(v=d[0][m],void 0!==v?this.uvs.push(v[0],v[1],v[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",m),this.uvs.push(new C,new C,new C)));!0===f&&(v=d[1][m],void 0!==v?this.uvs2.push(v[0],v[1],v[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",m),this.uvs2.push(new C,new C,new C)));for(v=0;v<h;v++){var M=g[v].vertices;k[v].push(M[t.a],M[t.b],M[t.c])}for(v=0;v<p;v++)M=l[v].vertexNormals[m],n[v].push(M.a,M.b,M.c);
u&&this.skinIndices.push(r[t.a],r[t.b],r[t.c]);F&&this.skinWeights.push(q[t.a],q[t.b],q[t.c])}this.computeGroups(a);this.verticesNeedUpdate=a.verticesNeedUpdate;this.normalsNeedUpdate=a.normalsNeedUpdate;this.colorsNeedUpdate=a.colorsNeedUpdate;this.uvsNeedUpdate=a.uvsNeedUpdate;this.groupsNeedUpdate=a.groupsNeedUpdate;return this}});Object.assign(S.prototype,oa.prototype,{isGeometry:!0,applyMatrix:function(a){for(var b=(new za).getNormalMatrix(a),c=0,d=this.vertices.length;c<d;c++)this.vertices[c].applyMatrix4(a);
c=0;for(d=this.faces.length;c<d;c++){a=this.faces[c];a.normal.applyMatrix3(b).normalize();for(var e=0,f=a.vertexNormals.length;e<f;e++)a.vertexNormals[e].applyMatrix3(b).normalize()}null!==this.boundingBox&&this.computeBoundingBox();null!==this.boundingSphere&&this.computeBoundingSphere();this.normalsNeedUpdate=this.verticesNeedUpdate=!0;return this},rotateX:function(){var a;return function(b){void 0===a&&(a=new H);a.makeRotationX(b);this.applyMatrix(a);return this}}(),rotateY:function(){var a;return function(b){void 0===
a&&(a=new H);a.makeRotationY(b);this.applyMatrix(a);return this}}(),rotateZ:function(){var a;return function(b){void 0===a&&(a=new H);a.makeRotationZ(b);this.applyMatrix(a);return this}}(),translate:function(){var a;return function(b,c,d){void 0===a&&(a=new H);a.makeTranslation(b,c,d);this.applyMatrix(a);return this}}(),scale:function(){var a;return function(b,c,d){void 0===a&&(a=new H);a.makeScale(b,c,d);this.applyMatrix(a);return this}}(),lookAt:function(){var a;return function(b){void 0===a&&(a=
new G);a.lookAt(b);a.updateMatrix();this.applyMatrix(a.matrix)}}(),fromBufferGeometry:function(a){function b(a,b,d,e){var f=void 0!==g?[l[a].clone(),l[b].clone(),l[d].clone()]:[],r=void 0!==h?[c.colors[a].clone(),c.colors[b].clone(),c.colors[d].clone()]:[];e=new ha(a,b,d,f,r,e);c.faces.push(e);void 0!==k&&c.faceVertexUvs[0].push([p[a].clone(),p[b].clone(),p[d].clone()]);void 0!==m&&c.faceVertexUvs[1].push([n[a].clone(),n[b].clone(),n[d].clone()])}var c=this,d=null!==a.index?a.index.array:void 0,e=
a.attributes,f=e.position.array,g=void 0!==e.normal?e.normal.array:void 0,h=void 0!==e.color?e.color.array:void 0,k=void 0!==e.uv?e.uv.array:void 0,m=void 0!==e.uv2?e.uv2.array:void 0;void 0!==m&&(this.faceVertexUvs[1]=[]);for(var l=[],p=[],n=[],r=e=0;e<f.length;e+=3,r+=2)c.vertices.push(new q(f[e],f[e+1],f[e+2])),void 0!==g&&l.push(new q(g[e],g[e+1],g[e+2])),void 0!==h&&c.colors.push(new N(h[e],h[e+1],h[e+2])),void 0!==k&&p.push(new C(k[r],k[r+1])),void 0!==m&&n.push(new C(m[r],m[r+1]));if(void 0!==
d)if(f=a.groups,0<f.length)for(e=0;e<f.length;e++)for(var w=f[e],u=w.start,F=w.count,r=u,u=u+F;r<u;r+=3)b(d[r],d[r+1],d[r+2],w.materialIndex);else for(e=0;e<d.length;e+=3)b(d[e],d[e+1],d[e+2]);else for(e=0;e<f.length/3;e+=3)b(e,e+1,e+2);this.computeFaceNormals();null!==a.boundingBox&&(this.boundingBox=a.boundingBox.clone());null!==a.boundingSphere&&(this.boundingSphere=a.boundingSphere.clone());return this},center:function(){this.computeBoundingBox();var a=this.boundingBox.getCenter().negate();this.translate(a.x,
a.y,a.z);return a},normalize:function(){this.computeBoundingSphere();var a=this.boundingSphere.center,b=this.boundingSphere.radius,b=0===b?1:1/b,c=new H;c.set(b,0,0,-b*a.x,0,b,0,-b*a.y,0,0,b,-b*a.z,0,0,0,1);this.applyMatrix(c);return this},computeFaceNormals:function(){for(var a=new q,b=new q,c=0,d=this.faces.length;c<d;c++){var e=this.faces[c],f=this.vertices[e.a],g=this.vertices[e.b];a.subVectors(this.vertices[e.c],g);b.subVectors(f,g);a.cross(b);a.normalize();e.normal.copy(a)}},computeVertexNormals:function(a){void 0===
a&&(a=!0);var b,c,d;d=Array(this.vertices.length);b=0;for(c=this.vertices.length;b<c;b++)d[b]=new q;if(a){var e,f,g,h=new q,k=new q;a=0;for(b=this.faces.length;a<b;a++)c=this.faces[a],e=this.vertices[c.a],f=this.vertices[c.b],g=this.vertices[c.c],h.subVectors(g,f),k.subVectors(e,f),h.cross(k),d[c.a].add(h),d[c.b].add(h),d[c.c].add(h)}else for(this.computeFaceNormals(),a=0,b=this.faces.length;a<b;a++)c=this.faces[a],d[c.a].add(c.normal),d[c.b].add(c.normal),d[c.c].add(c.normal);b=0;for(c=this.vertices.length;b<
c;b++)d[b].normalize();a=0;for(b=this.faces.length;a<b;a++)c=this.faces[a],e=c.vertexNormals,3===e.length?(e[0].copy(d[c.a]),e[1].copy(d[c.b]),e[2].copy(d[c.c])):(e[0]=d[c.a].clone(),e[1]=d[c.b].clone(),e[2]=d[c.c].clone());0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var a,b,c;this.computeFaceNormals();a=0;for(b=this.faces.length;a<b;a++){c=this.faces[a];var d=c.vertexNormals;3===d.length?(d[0].copy(c.normal),d[1].copy(c.normal),d[2].copy(c.normal)):(d[0]=
c.normal.clone(),d[1]=c.normal.clone(),d[2]=c.normal.clone())}0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var a,b,c,d,e;c=0;for(d=this.faces.length;c<d;c++)for(e=this.faces[c],e.__originalFaceNormal?e.__originalFaceNormal.copy(e.normal):e.__originalFaceNormal=e.normal.clone(),e.__originalVertexNormals||(e.__originalVertexNormals=[]),a=0,b=e.vertexNormals.length;a<b;a++)e.__originalVertexNormals[a]?e.__originalVertexNormals[a].copy(e.vertexNormals[a]):e.__originalVertexNormals[a]=
e.vertexNormals[a].clone();var f=new S;f.faces=this.faces;a=0;for(b=this.morphTargets.length;a<b;a++){if(!this.morphNormals[a]){this.morphNormals[a]={};this.morphNormals[a].faceNormals=[];this.morphNormals[a].vertexNormals=[];e=this.morphNormals[a].faceNormals;var g=this.morphNormals[a].vertexNormals,h,k;c=0;for(d=this.faces.length;c<d;c++)h=new q,k={a:new q,b:new q,c:new q},e.push(h),g.push(k)}g=this.morphNormals[a];f.vertices=this.morphTargets[a].vertices;f.computeFaceNormals();f.computeVertexNormals();
c=0;for(d=this.faces.length;c<d;c++)e=this.faces[c],h=g.faceNormals[c],k=g.vertexNormals[c],h.copy(e.normal),k.a.copy(e.vertexNormals[0]),k.b.copy(e.vertexNormals[1]),k.c.copy(e.vertexNormals[2])}c=0;for(d=this.faces.length;c<d;c++)e=this.faces[c],e.normal=e.__originalFaceNormal,e.vertexNormals=e.__originalVertexNormals},computeLineDistances:function(){for(var a=0,b=this.vertices,c=0,d=b.length;c<d;c++)0<c&&(a+=b[c].distanceTo(b[c-1])),this.lineDistances[c]=a},computeBoundingBox:function(){null===
this.boundingBox&&(this.boundingBox=new ya);this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Fa);this.boundingSphere.setFromPoints(this.vertices)},merge:function(a,b,c){if(!1===(a&&a.isGeometry))console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",a);else{var d,e=this.vertices.length,f=this.vertices,g=a.vertices,h=this.faces,k=a.faces,m=this.faceVertexUvs[0],l=a.faceVertexUvs[0],p=this.colors,
n=a.colors;void 0===c&&(c=0);void 0!==b&&(d=(new za).getNormalMatrix(b));a=0;for(var r=g.length;a<r;a++){var q=g[a].clone();void 0!==b&&q.applyMatrix4(b);f.push(q)}a=0;for(r=n.length;a<r;a++)p.push(n[a].clone());a=0;for(r=k.length;a<r;a++){var g=k[a],u=g.vertexNormals,n=g.vertexColors,p=new ha(g.a+e,g.b+e,g.c+e);p.normal.copy(g.normal);void 0!==d&&p.normal.applyMatrix3(d).normalize();b=0;for(f=u.length;b<f;b++)q=u[b].clone(),void 0!==d&&q.applyMatrix3(d).normalize(),p.vertexNormals.push(q);p.color.copy(g.color);
b=0;for(f=n.length;b<f;b++)q=n[b],p.vertexColors.push(q.clone());p.materialIndex=g.materialIndex+c;h.push(p)}a=0;for(r=l.length;a<r;a++)if(c=l[a],d=[],void 0!==c){b=0;for(f=c.length;b<f;b++)d.push(c[b].clone());m.push(d)}}},mergeMesh:function(a){!1===(a&&a.isMesh)?console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",a):(a.matrixAutoUpdate&&a.updateMatrix(),this.merge(a.geometry,a.matrix))},mergeVertices:function(){var a={},b=[],c=[],d,e=Math.pow(10,4),f,g;f=0;for(g=this.vertices.length;f<
g;f++)d=this.vertices[f],d=Math.round(d.x*e)+"_"+Math.round(d.y*e)+"_"+Math.round(d.z*e),void 0===a[d]?(a[d]=f,b.push(this.vertices[f]),c[f]=b.length-1):c[f]=c[a[d]];a=[];f=0;for(g=this.faces.length;f<g;f++)for(e=this.faces[f],e.a=c[e.a],e.b=c[e.b],e.c=c[e.c],e=[e.a,e.b,e.c],d=0;3>d;d++)if(e[d]===e[(d+1)%3]){a.push(f);break}for(f=a.length-1;0<=f;f--)for(e=a[f],this.faces.splice(e,1),c=0,g=this.faceVertexUvs.length;c<g;c++)this.faceVertexUvs[c].splice(e,1);f=this.vertices.length-b.length;this.vertices=
b;return f},sortFacesByMaterialIndex:function(){for(var a=this.faces,b=a.length,c=0;c<b;c++)a[c]._id=c;a.sort(function(a,b){return a.materialIndex-b.materialIndex});var d=this.faceVertexUvs[0],e=this.faceVertexUvs[1],f,g;d&&d.length===b&&(f=[]);e&&e.length===b&&(g=[]);for(c=0;c<b;c++){var h=a[c]._id;f&&f.push(d[h]);g&&g.push(e[h])}f&&(this.faceVertexUvs[0]=f);g&&(this.faceVertexUvs[1]=g)},toJSON:function(){function a(a,b,c){return c?a|1<<b:a&~(1<<b)}function b(a){var b=a.x.toString()+a.y.toString()+
a.z.toString();if(void 0!==m[b])return m[b];m[b]=k.length/3;k.push(a.x,a.y,a.z);return m[b]}function c(a){var b=a.r.toString()+a.g.toString()+a.b.toString();if(void 0!==p[b])return p[b];p[b]=l.length;l.push(a.getHex());return p[b]}function d(a){var b=a.x.toString()+a.y.toString();if(void 0!==r[b])return r[b];r[b]=n.length/2;n.push(a.x,a.y);return r[b]}var e={metadata:{version:4.4,type:"Geometry",generator:"Geometry.toJSON"}};e.uuid=this.uuid;e.type=this.type;""!==this.name&&(e.name=this.name);if(void 0!==
this.parameters){var f=this.parameters,g;for(g in f)void 0!==f[g]&&(e[g]=f[g]);return e}f=[];for(g=0;g<this.vertices.length;g++){var h=this.vertices[g];f.push(h.x,h.y,h.z)}var h=[],k=[],m={},l=[],p={},n=[],r={};for(g=0;g<this.faces.length;g++){var q=this.faces[g],u=void 0!==this.faceVertexUvs[0][g],F=0<q.normal.length(),t=0<q.vertexNormals.length,v=1!==q.color.r||1!==q.color.g||1!==q.color.b,M=0<q.vertexColors.length,z=0,z=a(z,0,0),z=a(z,1,!0),z=a(z,2,!1),z=a(z,3,u),z=a(z,4,F),z=a(z,5,t),z=a(z,6,
v),z=a(z,7,M);h.push(z);h.push(q.a,q.b,q.c);h.push(q.materialIndex);u&&(u=this.faceVertexUvs[0][g],h.push(d(u[0]),d(u[1]),d(u[2])));F&&h.push(b(q.normal));t&&(F=q.vertexNormals,h.push(b(F[0]),b(F[1]),b(F[2])));v&&h.push(c(q.color));M&&(q=q.vertexColors,h.push(c(q[0]),c(q[1]),c(q[2])))}e.data={};e.data.vertices=f;e.data.normals=k;0<l.length&&(e.data.colors=l);0<n.length&&(e.data.uvs=[n]);e.data.faces=h;return e},clone:function(){return(new S).copy(this)},copy:function(a){this.vertices=[];this.faces=
[];this.faceVertexUvs=[[]];this.colors=[];for(var b=a.vertices,c=0,d=b.length;c<d;c++)this.vertices.push(b[c].clone());b=a.colors;c=0;for(d=b.length;c<d;c++)this.colors.push(b[c].clone());b=a.faces;c=0;for(d=b.length;c<d;c++)this.faces.push(b[c].clone());c=0;for(d=a.faceVertexUvs.length;c<d;c++){b=a.faceVertexUvs[c];void 0===this.faceVertexUvs[c]&&(this.faceVertexUvs[c]=[]);for(var e=0,f=b.length;e<f;e++){for(var g=b[e],h=[],k=0,m=g.length;k<m;k++)h.push(g[k].clone());this.faceVertexUvs[c].push(h)}}return this},
dispose:function(){this.dispatchEvent({type:"dispose"})}});var Kd=0;Object.assign(D.prototype,oa.prototype,{isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(a){this.index=a},addAttribute:function(a,b,c){if(!1===(b&&b.isBufferAttribute)&&!1===(b&&b.isInterleavedBufferAttribute))console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.addAttribute(a,new y(b,c));else if("index"===a)console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),
this.setIndex(b);else return this.attributes[a]=b,this},getAttribute:function(a){return this.attributes[a]},removeAttribute:function(a){delete this.attributes[a];return this},addGroup:function(a,b,c){this.groups.push({start:a,count:b,materialIndex:void 0!==c?c:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(a,b){this.drawRange.start=a;this.drawRange.count=b},applyMatrix:function(a){var b=this.attributes.position;void 0!==b&&(a.applyToVector3Array(b.array),b.needsUpdate=!0);b=this.attributes.normal;
void 0!==b&&((new za).getNormalMatrix(a).applyToVector3Array(b.array),b.needsUpdate=!0);null!==this.boundingBox&&this.computeBoundingBox();null!==this.boundingSphere&&this.computeBoundingSphere();return this},rotateX:function(){var a;return function(b){void 0===a&&(a=new H);a.makeRotationX(b);this.applyMatrix(a);return this}}(),rotateY:function(){var a;return function(b){void 0===a&&(a=new H);a.makeRotationY(b);this.applyMatrix(a);return this}}(),rotateZ:function(){var a;return function(b){void 0===
a&&(a=new H);a.makeRotationZ(b);this.applyMatrix(a);return this}}(),translate:function(){var a;return function(b,c,d){void 0===a&&(a=new H);a.makeTranslation(b,c,d);this.applyMatrix(a);return this}}(),scale:function(){var a;return function(b,c,d){void 0===a&&(a=new H);a.makeScale(b,c,d);this.applyMatrix(a);return this}}(),lookAt:function(){var a;return function(b){void 0===a&&(a=new G);a.lookAt(b);a.updateMatrix();this.applyMatrix(a.matrix)}}(),center:function(){this.computeBoundingBox();var a=this.boundingBox.getCenter().negate();
this.translate(a.x,a.y,a.z);return a},setFromObject:function(a){var b=a.geometry;if(a.isPoints||a.isLine){a=new X(3*b.vertices.length,3);var c=new X(3*b.colors.length,3);this.addAttribute("position",a.copyVector3sArray(b.vertices));this.addAttribute("color",c.copyColorsArray(b.colors));b.lineDistances&&b.lineDistances.length===b.vertices.length&&(a=new X(b.lineDistances.length,1),this.addAttribute("lineDistance",a.copyArray(b.lineDistances)));null!==b.boundingSphere&&(this.boundingSphere=b.boundingSphere.clone());
null!==b.boundingBox&&(this.boundingBox=b.boundingBox.clone())}else a.isMesh&&b&&b.isGeometry&&this.fromGeometry(b);return this},updateFromObject:function(a){var b=a.geometry;if(a.isMesh){var c=b.__directGeometry;!0===b.elementsNeedUpdate&&(c=void 0,b.elementsNeedUpdate=!1);if(void 0===c)return this.fromGeometry(b);c.verticesNeedUpdate=b.verticesNeedUpdate;c.normalsNeedUpdate=b.normalsNeedUpdate;c.colorsNeedUpdate=b.colorsNeedUpdate;c.uvsNeedUpdate=b.uvsNeedUpdate;c.groupsNeedUpdate=b.groupsNeedUpdate;
b.verticesNeedUpdate=!1;b.normalsNeedUpdate=!1;b.colorsNeedUpdate=!1;b.uvsNeedUpdate=!1;b.groupsNeedUpdate=!1;b=c}!0===b.verticesNeedUpdate&&(c=this.attributes.position,void 0!==c&&(c.copyVector3sArray(b.vertices),c.needsUpdate=!0),b.verticesNeedUpdate=!1);!0===b.normalsNeedUpdate&&(c=this.attributes.normal,void 0!==c&&(c.copyVector3sArray(b.normals),c.needsUpdate=!0),b.normalsNeedUpdate=!1);!0===b.colorsNeedUpdate&&(c=this.attributes.color,void 0!==c&&(c.copyColorsArray(b.colors),c.needsUpdate=!0),
b.colorsNeedUpdate=!1);b.uvsNeedUpdate&&(c=this.attributes.uv,void 0!==c&&(c.copyVector2sArray(b.uvs),c.needsUpdate=!0),b.uvsNeedUpdate=!1);b.lineDistancesNeedUpdate&&(c=this.attributes.lineDistance,void 0!==c&&(c.copyArray(b.lineDistances),c.needsUpdate=!0),b.lineDistancesNeedUpdate=!1);b.groupsNeedUpdate&&(b.computeGroups(a.geometry),this.groups=b.groups,b.groupsNeedUpdate=!1);return this},fromGeometry:function(a){a.__directGeometry=(new ze).fromGeometry(a);return this.fromDirectGeometry(a.__directGeometry)},
fromDirectGeometry:function(a){var b=new Float32Array(3*a.vertices.length);this.addAttribute("position",(new y(b,3)).copyVector3sArray(a.vertices));0<a.normals.length&&(b=new Float32Array(3*a.normals.length),this.addAttribute("normal",(new y(b,3)).copyVector3sArray(a.normals)));0<a.colors.length&&(b=new Float32Array(3*a.colors.length),this.addAttribute("color",(new y(b,3)).copyColorsArray(a.colors)));0<a.uvs.length&&(b=new Float32Array(2*a.uvs.length),this.addAttribute("uv",(new y(b,2)).copyVector2sArray(a.uvs)));
0<a.uvs2.length&&(b=new Float32Array(2*a.uvs2.length),this.addAttribute("uv2",(new y(b,2)).copyVector2sArray(a.uvs2)));0<a.indices.length&&(b=new (65535<a.vertices.length?Uint32Array:Uint16Array)(3*a.indices.length),this.setIndex((new y(b,1)).copyIndicesArray(a.indices)));this.groups=a.groups;for(var c in a.morphTargets){for(var b=[],d=a.morphTargets[c],e=0,f=d.length;e<f;e++){var g=d[e],h=new X(3*g.length,3);b.push(h.copyVector3sArray(g))}this.morphAttributes[c]=b}0<a.skinIndices.length&&(c=new X(4*
a.skinIndices.length,4),this.addAttribute("skinIndex",c.copyVector4sArray(a.skinIndices)));0<a.skinWeights.length&&(c=new X(4*a.skinWeights.length,4),this.addAttribute("skinWeight",c.copyVector4sArray(a.skinWeights)));null!==a.boundingSphere&&(this.boundingSphere=a.boundingSphere.clone());null!==a.boundingBox&&(this.boundingBox=a.boundingBox.clone());return this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new ya);var a=this.attributes.position;void 0!==a?this.boundingBox.setFromBufferAttribute(a):
this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){var a=new ya,b=new q;return function(){null===this.boundingSphere&&(this.boundingSphere=new Fa);var c=this.attributes.position;if(c){var d=this.boundingSphere.center;a.setFromBufferAttribute(c);
a.getCenter(d);for(var e=0,f=0,g=c.count;f<g;f++)b.x=c.getX(f),b.y=c.getY(f),b.z=c.getZ(f),e=Math.max(e,d.distanceToSquared(b));this.boundingSphere.radius=Math.sqrt(e);isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var a=this.index,b=this.attributes,c=this.groups;if(b.position){var d=b.position.array;
if(void 0===b.normal)this.addAttribute("normal",new y(new Float32Array(d.length),3));else for(var e=b.normal.array,f=0,g=e.length;f<g;f++)e[f]=0;var e=b.normal.array,h,k,m,l=new q,p=new q,n=new q,r=new q,w=new q;if(a){a=a.array;0===c.length&&this.addGroup(0,a.length);for(var u=0,F=c.length;u<F;++u)for(f=c[u],g=f.start,h=f.count,f=g,g+=h;f<g;f+=3)h=3*a[f+0],k=3*a[f+1],m=3*a[f+2],l.fromArray(d,h),p.fromArray(d,k),n.fromArray(d,m),r.subVectors(n,p),w.subVectors(l,p),r.cross(w),e[h]+=r.x,e[h+1]+=r.y,
e[h+2]+=r.z,e[k]+=r.x,e[k+1]+=r.y,e[k+2]+=r.z,e[m]+=r.x,e[m+1]+=r.y,e[m+2]+=r.z}else for(f=0,g=d.length;f<g;f+=9)l.fromArray(d,f),p.fromArray(d,f+3),n.fromArray(d,f+6),r.subVectors(n,p),w.subVectors(l,p),r.cross(w),e[f]=r.x,e[f+1]=r.y,e[f+2]=r.z,e[f+3]=r.x,e[f+4]=r.y,e[f+5]=r.z,e[f+6]=r.x,e[f+7]=r.y,e[f+8]=r.z;this.normalizeNormals();b.normal.needsUpdate=!0}},merge:function(a,b){if(!1===(a&&a.isBufferGeometry))console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",
a);else{void 0===b&&(b=0);var c=this.attributes,d;for(d in c)if(void 0!==a.attributes[d])for(var e=c[d].array,f=a.attributes[d],g=f.array,h=0,f=f.itemSize*b;h<g.length;h++,f++)e[f]=g[h];return this}},normalizeNormals:function(){for(var a=this.attributes.normal.array,b,c,d,e=0,f=a.length;e<f;e+=3)b=a[e],c=a[e+1],d=a[e+2],b=1/Math.sqrt(b*b+c*c+d*d),a[e]*=b,a[e+1]*=b,a[e+2]*=b},toNonIndexed:function(){if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),
this;var a=new D,b=this.index.array,c=this.attributes,d;for(d in c){for(var e=c[d],f=e.array,e=e.itemSize,g=new f.constructor(b.length*e),h,k=0,m=0,l=b.length;m<l;m++){h=b[m]*e;for(var p=0;p<e;p++)g[k++]=f[h++]}a.addAttribute(d,new y(g,e))}return a},toJSON:function(){var a={metadata:{version:4.4,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};a.uuid=this.uuid;a.type=this.type;""!==this.name&&(a.name=this.name);if(void 0!==this.parameters){var b=this.parameters,c;for(c in b)void 0!==b[c]&&
(a[c]=b[c]);return a}a.data={attributes:{}};var d=this.index;null!==d&&(b=Array.prototype.slice.call(d.array),a.data.index={type:d.array.constructor.name,array:b});d=this.attributes;for(c in d){var e=d[c],b=Array.prototype.slice.call(e.array);a.data.attributes[c]={itemSize:e.itemSize,type:e.array.constructor.name,array:b,normalized:e.normalized}}c=this.groups;0<c.length&&(a.data.groups=JSON.parse(JSON.stringify(c)));c=this.boundingSphere;null!==c&&(a.data.boundingSphere={center:c.center.toArray(),
radius:c.radius});return a},clone:function(){return(new D).copy(this)},copy:function(a){var b=a.index;null!==b&&this.setIndex(b.clone());var b=a.attributes,c;for(c in b)this.addAttribute(c,b[c].clone());a=a.groups;c=0;for(b=a.length;c<b;c++){var d=a[c];this.addGroup(d.start,d.count,d.materialIndex)}return this},dispose:function(){this.dispatchEvent({type:"dispose"})}});D.MaxIndex=65535;Ba.prototype=Object.assign(Object.create(G.prototype),{constructor:Ba,isMesh:!0,setDrawMode:function(a){this.drawMode=
a},copy:function(a){G.prototype.copy.call(this,a);this.drawMode=a.drawMode;return this},updateMorphTargets:function(){var a=this.geometry.morphTargets;if(void 0!==a&&0<a.length){this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var b=0,c=a.length;b<c;b++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[a[b].name]=b}},raycast:function(){function a(a,b,c,d,e,f,g){Aa.barycoordFromPoint(a,b,c,d,u);e.multiplyScalar(u.x);f.multiplyScalar(u.y);g.multiplyScalar(u.z);e.add(f).add(g);
return e.clone()}function b(a,b,c,d,e,f,g){var h=a.material;if(null===(1===h.side?c.intersectTriangle(f,e,d,!0,g):c.intersectTriangle(d,e,f,2!==h.side,g)))return null;t.copy(g);t.applyMatrix4(a.matrixWorld);c=b.ray.origin.distanceTo(t);return c<b.near||c>b.far?null:{distance:c,point:t.clone(),object:a}}function c(c,d,e,f,m,l,p,q){g.fromArray(f,3*l);h.fromArray(f,3*p);k.fromArray(f,3*q);if(c=b(c,d,e,g,h,k,F))m&&(n.fromArray(m,2*l),r.fromArray(m,2*p),w.fromArray(m,2*q),c.uv=a(F,g,h,k,n,r,w)),c.face=
new ha(l,p,q,Aa.normal(g,h,k)),c.faceIndex=l;return c}var d=new H,e=new bb,f=new Fa,g=new q,h=new q,k=new q,m=new q,l=new q,p=new q,n=new C,r=new C,w=new C,u=new q,F=new q,t=new q;return function(q,u){var t=this.geometry,A=this.material,I=this.matrixWorld;if(void 0!==A&&(null===t.boundingSphere&&t.computeBoundingSphere(),f.copy(t.boundingSphere),f.applyMatrix4(I),!1!==q.ray.intersectsSphere(f)&&(d.getInverse(I),e.copy(q.ray).applyMatrix4(d),null===t.boundingBox||!1!==e.intersectsBox(t.boundingBox)))){var E,
K;if(t.isBufferGeometry){var y,J,A=t.index,I=t.attributes,t=I.position.array;void 0!==I.uv&&(E=I.uv.array);if(null!==A)for(var I=A.array,C=0,D=I.length;C<D;C+=3){if(A=I[C],y=I[C+1],J=I[C+2],K=c(this,q,e,t,E,A,y,J))K.faceIndex=Math.floor(C/3),u.push(K)}else for(C=0,D=t.length;C<D;C+=9)if(A=C/3,y=A+1,J=A+2,K=c(this,q,e,t,E,A,y,J))K.index=A,u.push(K)}else if(t.isGeometry){var G,H,I=A&&A.isMultiMaterial,C=!0===I?A.materials:null,D=t.vertices;y=t.faces;J=t.faceVertexUvs[0];0<J.length&&(E=J);for(var O=
0,P=y.length;O<P;O++){var R=y[O];K=!0===I?C[R.materialIndex]:A;if(void 0!==K){J=D[R.a];G=D[R.b];H=D[R.c];if(!0===K.morphTargets){K=t.morphTargets;var T=this.morphTargetInfluences;g.set(0,0,0);h.set(0,0,0);k.set(0,0,0);for(var N=0,V=K.length;N<V;N++){var S=T[N];if(0!==S){var L=K[N].vertices;g.addScaledVector(m.subVectors(L[R.a],J),S);h.addScaledVector(l.subVectors(L[R.b],G),S);k.addScaledVector(p.subVectors(L[R.c],H),S)}}g.add(J);h.add(G);k.add(H);J=g;G=h;H=k}if(K=b(this,q,e,J,G,H,F))E&&(T=E[O],n.copy(T[0]),
r.copy(T[1]),w.copy(T[2]),K.uv=a(F,J,G,H,n,r,w)),K.face=R,K.faceIndex=O,u.push(K)}}}}}}(),clone:function(){return(new this.constructor(this.geometry,this.material)).copy(this)}});hb.prototype=Object.create(D.prototype);hb.prototype.constructor=hb;ib.prototype=Object.create(D.prototype);ib.prototype.constructor=ib;sa.prototype=Object.create(G.prototype);sa.prototype.constructor=sa;sa.prototype.isCamera=!0;sa.prototype.getWorldDirection=function(){var a=new da;return function(b){b=b||new q;this.getWorldQuaternion(a);
return b.set(0,0,-1).applyQuaternion(a)}}();sa.prototype.lookAt=function(){var a=new H;return function(b){a.lookAt(this.position,b,this.up);this.quaternion.setFromRotationMatrix(a)}}();sa.prototype.clone=function(){return(new this.constructor).copy(this)};sa.prototype.copy=function(a){G.prototype.copy.call(this,a);this.matrixWorldInverse.copy(a.matrixWorldInverse);this.projectionMatrix.copy(a.projectionMatrix);return this};Ha.prototype=Object.assign(Object.create(sa.prototype),{constructor:Ha,isPerspectiveCamera:!0,
copy:function(a){sa.prototype.copy.call(this,a);this.fov=a.fov;this.zoom=a.zoom;this.near=a.near;this.far=a.far;this.focus=a.focus;this.aspect=a.aspect;this.view=null===a.view?null:Object.assign({},a.view);this.filmGauge=a.filmGauge;this.filmOffset=a.filmOffset;return this},setFocalLength:function(a){a=.5*this.getFilmHeight()/a;this.fov=2*Q.RAD2DEG*Math.atan(a);this.updateProjectionMatrix()},getFocalLength:function(){var a=Math.tan(.5*Q.DEG2RAD*this.fov);return.5*this.getFilmHeight()/a},getEffectiveFOV:function(){return 2*
Q.RAD2DEG*Math.atan(Math.tan(.5*Q.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(a,b,c,d,e,f){this.aspect=a/b;this.view={fullWidth:a,fullHeight:b,offsetX:c,offsetY:d,width:e,height:f};this.updateProjectionMatrix()},clearViewOffset:function(){this.view=null;this.updateProjectionMatrix()},updateProjectionMatrix:function(){var a=this.near,b=a*Math.tan(.5*
Q.DEG2RAD*this.fov)/this.zoom,c=2*b,d=this.aspect*c,e=-.5*d,f=this.view;if(null!==f)var g=f.fullWidth,h=f.fullHeight,e=e+f.offsetX*d/g,b=b-f.offsetY*c/h,d=f.width/g*d,c=f.height/h*c;f=this.filmOffset;0!==f&&(e+=a*f/this.getFilmWidth());this.projectionMatrix.makeFrustum(e,e+d,b-c,b,a,this.far)},toJSON:function(a){a=G.prototype.toJSON.call(this,a);a.object.fov=this.fov;a.object.zoom=this.zoom;a.object.near=this.near;a.object.far=this.far;a.object.focus=this.focus;a.object.aspect=this.aspect;null!==
this.view&&(a.object.view=Object.assign({},this.view));a.object.filmGauge=this.filmGauge;a.object.filmOffset=this.filmOffset;return a}});Hb.prototype=Object.assign(Object.create(sa.prototype),{constructor:Hb,isOrthographicCamera:!0,copy:function(a){sa.prototype.copy.call(this,a);this.left=a.left;this.right=a.right;this.top=a.top;this.bottom=a.bottom;this.near=a.near;this.far=a.far;this.zoom=a.zoom;this.view=null===a.view?null:Object.assign({},a.view);return this},setViewOffset:function(a,b,c,d,e,
f){this.view={fullWidth:a,fullHeight:b,offsetX:c,offsetY:d,width:e,height:f};this.updateProjectionMatrix()},clearViewOffset:function(){this.view=null;this.updateProjectionMatrix()},updateProjectionMatrix:function(){var a=(this.right-this.left)/(2*this.zoom),b=(this.top-this.bottom)/(2*this.zoom),c=(this.right+this.left)/2,d=(this.top+this.bottom)/2,e=c-a,c=c+a,a=d+b,b=d-b;if(null!==this.view)var c=this.zoom/(this.view.width/this.view.fullWidth),b=this.zoom/(this.view.height/this.view.fullHeight),
f=(this.right-this.left)/this.view.width,d=(this.top-this.bottom)/this.view.height,e=e+this.view.offsetX/c*f,c=e+this.view.width/c*f,a=a-this.view.offsetY/b*d,b=a-this.view.height/b*d;this.projectionMatrix.makeOrthographic(e,c,a,b,this.near,this.far)},toJSON:function(a){a=G.prototype.toJSON.call(this,a);a.object.zoom=this.zoom;a.object.left=this.left;a.object.right=this.right;a.object.top=this.top;a.object.bottom=this.bottom;a.object.near=this.near;a.object.far=this.far;null!==this.view&&(a.object.view=
Object.assign({},this.view));return a}});var Af=0;Ib.prototype.isFogExp2=!0;Ib.prototype.clone=function(){return new Ib(this.color.getHex(),this.density)};Ib.prototype.toJSON=function(a){return{type:"FogExp2",color:this.color.getHex(),density:this.density}};Jb.prototype.isFog=!0;Jb.prototype.clone=function(){return new Jb(this.color.getHex(),this.near,this.far)};Jb.prototype.toJSON=function(a){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}};jb.prototype=Object.create(G.prototype);
jb.prototype.constructor=jb;jb.prototype.copy=function(a,b){G.prototype.copy.call(this,a,b);null!==a.background&&(this.background=a.background.clone());null!==a.fog&&(this.fog=a.fog.clone());null!==a.overrideMaterial&&(this.overrideMaterial=a.overrideMaterial.clone());this.autoUpdate=a.autoUpdate;this.matrixAutoUpdate=a.matrixAutoUpdate;return this};jb.prototype.toJSON=function(a){var b=G.prototype.toJSON.call(this,a);null!==this.background&&(b.object.background=this.background.toJSON(a));null!==
this.fog&&(b.object.fog=this.fog.toJSON());return b};Od.prototype=Object.assign(Object.create(G.prototype),{constructor:Od,isLensFlare:!0,copy:function(a){G.prototype.copy.call(this,a);this.positionScreen.copy(a.positionScreen);this.customUpdateCallback=a.customUpdateCallback;for(var b=0,c=a.lensFlares.length;b<c;b++)this.lensFlares.push(a.lensFlares[b]);return this},add:function(a,b,c,d,e,f){void 0===b&&(b=-1);void 0===c&&(c=0);void 0===f&&(f=1);void 0===e&&(e=new N(16777215));void 0===d&&(d=1);
c=Math.min(c,Math.max(0,c));this.lensFlares.push({texture:a,size:b,distance:c,x:0,y:0,z:0,scale:1,rotation:0,opacity:f,color:e,blending:d})},updateLensFlares:function(){var a,b=this.lensFlares.length,c,d=2*-this.positionScreen.x,e=2*-this.positionScreen.y;for(a=0;a<b;a++)c=this.lensFlares[a],c.x=this.positionScreen.x+d*c.distance,c.y=this.positionScreen.y+e*c.distance,c.wantedRotation=c.x*Math.PI*.25,c.rotation+=.25*(c.wantedRotation-c.rotation)}});kb.prototype=Object.create(W.prototype);kb.prototype.constructor=
kb;kb.prototype.copy=function(a){W.prototype.copy.call(this,a);this.color.copy(a.color);this.map=a.map;this.rotation=a.rotation;return this};zc.prototype=Object.assign(Object.create(G.prototype),{constructor:zc,isSprite:!0,raycast:function(){var a=new q;return function(b,c){a.setFromMatrixPosition(this.matrixWorld);var d=b.ray.distanceSqToPoint(a);d>this.scale.x*this.scale.y/4||c.push({distance:Math.sqrt(d),point:this.position,face:null,object:this})}}(),clone:function(){return(new this.constructor(this.material)).copy(this)}});
Ac.prototype=Object.assign(Object.create(G.prototype),{constructor:Ac,copy:function(a){G.prototype.copy.call(this,a,!1);a=a.levels;for(var b=0,c=a.length;b<c;b++){var d=a[b];this.addLevel(d.object.clone(),d.distance)}return this},addLevel:function(a,b){void 0===b&&(b=0);b=Math.abs(b);for(var c=this.levels,d=0;d<c.length&&!(b<c[d].distance);d++);c.splice(d,0,{distance:b,object:a});this.add(a)},getObjectForDistance:function(a){for(var b=this.levels,c=1,d=b.length;c<d&&!(a<b[c].distance);c++);return b[c-
1].object},raycast:function(){var a=new q;return function(b,c){a.setFromMatrixPosition(this.matrixWorld);var d=b.ray.origin.distanceTo(a);this.getObjectForDistance(d).raycast(b,c)}}(),update:function(){var a=new q,b=new q;return function(c){var d=this.levels;if(1<d.length){a.setFromMatrixPosition(c.matrixWorld);b.setFromMatrixPosition(this.matrixWorld);c=a.distanceTo(b);d[0].object.visible=!0;for(var e=1,f=d.length;e<f;e++)if(c>=d[e].distance)d[e-1].object.visible=!1,d[e].object.visible=!0;else break;
for(;e<f;e++)d[e].object.visible=!1}}}(),toJSON:function(a){a=G.prototype.toJSON.call(this,a);a.object.levels=[];for(var b=this.levels,c=0,d=b.length;c<d;c++){var e=b[c];a.object.levels.push({object:e.object.uuid,distance:e.distance})}return a}});Object.assign(hd.prototype,{calculateInverses:function(){this.boneInverses=[];for(var a=0,b=this.bones.length;a<b;a++){var c=new H;this.bones[a]&&c.getInverse(this.bones[a].matrixWorld);this.boneInverses.push(c)}},pose:function(){for(var a,b=0,c=this.bones.length;b<
c;b++)(a=this.bones[b])&&a.matrixWorld.getInverse(this.boneInverses[b]);b=0;for(c=this.bones.length;b<c;b++)if(a=this.bones[b])a.parent&&a.parent.isBone?(a.matrix.getInverse(a.parent.matrixWorld),a.matrix.multiply(a.matrixWorld)):a.matrix.copy(a.matrixWorld),a.matrix.decompose(a.position,a.quaternion,a.scale)},update:function(){var a=new H;return function(){for(var b=0,c=this.bones.length;b<c;b++)a.multiplyMatrices(this.bones[b]?this.bones[b].matrixWorld:this.identityMatrix,this.boneInverses[b]),
a.toArray(this.boneMatrices,16*b);this.useVertexTexture&&(this.boneTexture.needsUpdate=!0)}}(),clone:function(){return new hd(this.bones,this.boneInverses,this.useVertexTexture)}});id.prototype=Object.assign(Object.create(G.prototype),{constructor:id,isBone:!0});jd.prototype=Object.assign(Object.create(Ba.prototype),{constructor:jd,isSkinnedMesh:!0,bind:function(a,b){this.skeleton=a;void 0===b&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),b=this.matrixWorld);this.bindMatrix.copy(b);
this.bindMatrixInverse.getInverse(b)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){if(this.geometry&&this.geometry.isGeometry)for(var a=0;a<this.geometry.skinWeights.length;a++){var b=this.geometry.skinWeights[a],c=1/b.lengthManhattan();Infinity!==c?b.multiplyScalar(c):b.set(1,0,0,0)}else if(this.geometry&&this.geometry.isBufferGeometry)for(var b=new ga,d=this.geometry.attributes.skinWeight,a=0;a<d.count;a++)b.x=d.getX(a),b.y=d.getY(a),b.z=d.getZ(a),b.w=d.getW(a),c=1/b.lengthManhattan(),
Infinity!==c?b.multiplyScalar(c):b.set(1,0,0,0),d.setXYZW(a,b.x,b.y,b.z,b.w)},updateMatrixWorld:function(a){Ba.prototype.updateMatrixWorld.call(this,!0);"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh unrecognized bindMode: "+this.bindMode)},clone:function(){return(new this.constructor(this.geometry,this.material,this.skeleton.useVertexTexture)).copy(this)}});
ia.prototype=Object.create(W.prototype);ia.prototype.constructor=ia;ia.prototype.isLineBasicMaterial=!0;ia.prototype.copy=function(a){W.prototype.copy.call(this,a);this.color.copy(a.color);this.linewidth=a.linewidth;this.linecap=a.linecap;this.linejoin=a.linejoin;return this};Va.prototype=Object.assign(Object.create(G.prototype),{constructor:Va,isLine:!0,raycast:function(){var a=new H,b=new bb,c=new Fa;return function(d,e){var f=d.linePrecision,f=f*f,g=this.geometry,h=this.matrixWorld;null===g.boundingSphere&&
g.computeBoundingSphere();c.copy(g.boundingSphere);c.applyMatrix4(h);if(!1!==d.ray.intersectsSphere(c)){a.getInverse(h);b.copy(d.ray).applyMatrix4(a);var k=new q,m=new q,h=new q,l=new q,p=this&&this.isLineSegments?2:1;if(g.isBufferGeometry){var n=g.index,r=g.attributes.position.array;if(null!==n)for(var n=n.array,g=0,w=n.length-1;g<w;g+=p){var u=n[g+1];k.fromArray(r,3*n[g]);m.fromArray(r,3*u);u=b.distanceSqToSegment(k,m,l,h);u>f||(l.applyMatrix4(this.matrixWorld),u=d.ray.origin.distanceTo(l),u<d.near||
u>d.far||e.push({distance:u,point:h.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this}))}else for(g=0,w=r.length/3-1;g<w;g+=p)k.fromArray(r,3*g),m.fromArray(r,3*g+3),u=b.distanceSqToSegment(k,m,l,h),u>f||(l.applyMatrix4(this.matrixWorld),u=d.ray.origin.distanceTo(l),u<d.near||u>d.far||e.push({distance:u,point:h.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this}))}else if(g.isGeometry)for(k=g.vertices,m=k.length,g=0;g<m-1;g+=p)u=b.distanceSqToSegment(k[g],
k[g+1],l,h),u>f||(l.applyMatrix4(this.matrixWorld),u=d.ray.origin.distanceTo(l),u<d.near||u>d.far||e.push({distance:u,point:h.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this}))}}}(),clone:function(){return(new this.constructor(this.geometry,this.material)).copy(this)}});fa.prototype=Object.assign(Object.create(Va.prototype),{constructor:fa,isLineSegments:!0});Oa.prototype=Object.create(W.prototype);Oa.prototype.constructor=Oa;Oa.prototype.isPointsMaterial=!0;Oa.prototype.copy=
function(a){W.prototype.copy.call(this,a);this.color.copy(a.color);this.map=a.map;this.size=a.size;this.sizeAttenuation=a.sizeAttenuation;return this};Kb.prototype=Object.assign(Object.create(G.prototype),{constructor:Kb,isPoints:!0,raycast:function(){var a=new H,b=new bb,c=new Fa;return function(d,e){function f(a,c){var f=b.distanceSqToPoint(a);if(f<l){var h=b.closestPointToPoint(a);h.applyMatrix4(k);var m=d.ray.origin.distanceTo(h);m<d.near||m>d.far||e.push({distance:m,distanceToRay:Math.sqrt(f),
point:h.clone(),index:c,face:null,object:g})}}var g=this,h=this.geometry,k=this.matrixWorld,m=d.params.Points.threshold;null===h.boundingSphere&&h.computeBoundingSphere();c.copy(h.boundingSphere);c.applyMatrix4(k);if(!1!==d.ray.intersectsSphere(c)){a.getInverse(k);b.copy(d.ray).applyMatrix4(a);var m=m/((this.scale.x+this.scale.y+this.scale.z)/3),l=m*m,m=new q;if(h.isBufferGeometry){var p=h.index,h=h.attributes.position.array;if(null!==p)for(var n=p.array,p=0,r=n.length;p<r;p++){var w=n[p];m.fromArray(h,
3*w);f(m,w)}else for(p=0,n=h.length/3;p<n;p++)m.fromArray(h,3*p),f(m,p)}else for(m=h.vertices,p=0,n=m.length;p<n;p++)f(m[p],p)}}}(),clone:function(){return(new this.constructor(this.geometry,this.material)).copy(this)}});Bc.prototype=Object.assign(Object.create(G.prototype),{constructor:Bc});kd.prototype=Object.create(ea.prototype);kd.prototype.constructor=kd;Lb.prototype=Object.create(ea.prototype);Lb.prototype.constructor=Lb;Lb.prototype.isCompressedTexture=!0;ld.prototype=Object.create(ea.prototype);
ld.prototype.constructor=ld;Cc.prototype=Object.create(ea.prototype);Cc.prototype.constructor=Cc;Cc.prototype.isDepthTexture=!0;Mb.prototype=Object.create(D.prototype);Mb.prototype.constructor=Mb;Nb.prototype=Object.create(D.prototype);Nb.prototype.constructor=Nb;Dc.prototype=Object.create(S.prototype);Dc.prototype.constructor=Dc;xa.prototype=Object.create(D.prototype);xa.prototype.constructor=xa;Ob.prototype=Object.create(xa.prototype);Ob.prototype.constructor=Ob;Ec.prototype=Object.create(S.prototype);
Ec.prototype.constructor=Ec;lb.prototype=Object.create(xa.prototype);lb.prototype.constructor=lb;Fc.prototype=Object.create(S.prototype);Fc.prototype.constructor=Fc;Pb.prototype=Object.create(xa.prototype);Pb.prototype.constructor=Pb;Gc.prototype=Object.create(S.prototype);Gc.prototype.constructor=Gc;Qb.prototype=Object.create(xa.prototype);Qb.prototype.constructor=Qb;Hc.prototype=Object.create(S.prototype);Hc.prototype.constructor=Hc;Ic.prototype=Object.create(S.prototype);Ic.prototype.constructor=
Ic;Rb.prototype=Object.create(D.prototype);Rb.prototype.constructor=Rb;Jc.prototype=Object.create(S.prototype);Jc.prototype.constructor=Jc;Sb.prototype=Object.create(D.prototype);Sb.prototype.constructor=Sb;Kc.prototype=Object.create(S.prototype);Kc.prototype.constructor=Kc;Tb.prototype=Object.create(D.prototype);Tb.prototype.constructor=Tb;Lc.prototype=Object.create(S.prototype);Lc.prototype.constructor=Lc;var pa={area:function(a){for(var b=a.length,c=0,d=b-1,e=0;e<b;d=e++)c+=a[d].x*a[e].y-a[e].x*
a[d].y;return.5*c},triangulate:function(){return function(a,b){var c=a.length;if(3>c)return null;var d=[],e=[],f=[],g,h,k;if(0<pa.area(a))for(h=0;h<c;h++)e[h]=h;else for(h=0;h<c;h++)e[h]=c-1-h;var m=2*c;for(h=c-1;2<c;){if(0>=m--){console.warn("THREE.ShapeUtils: Unable to triangulate polygon! in triangulate()");break}g=h;c<=g&&(g=0);h=g+1;c<=h&&(h=0);k=h+1;c<=k&&(k=0);var l;a:{var p,n,r,q,u,F,t,v;p=a[e[g]].x;n=a[e[g]].y;r=a[e[h]].x;q=a[e[h]].y;u=a[e[k]].x;F=a[e[k]].y;if(0>=(r-p)*(F-n)-(q-n)*(u-p))l=
!1;else{var M,z,A,I,E,K,y,C,D,G;M=u-r;z=F-q;A=p-u;I=n-F;E=r-p;K=q-n;for(l=0;l<c;l++)if(t=a[e[l]].x,v=a[e[l]].y,!(t===p&&v===n||t===r&&v===q||t===u&&v===F)&&(y=t-p,C=v-n,D=t-r,G=v-q,t-=u,v-=F,D=M*G-z*D,y=E*C-K*y,C=A*v-I*t,D>=-Number.EPSILON&&C>=-Number.EPSILON&&y>=-Number.EPSILON)){l=!1;break a}l=!0}}if(l){d.push([a[e[g]],a[e[h]],a[e[k]]]);f.push([e[g],e[h],e[k]]);g=h;for(k=h+1;k<c;g++,k++)e[g]=e[k];c--;m=2*c}}return b?f:d}}(),triangulateShape:function(a,b){function c(a){var b=a.length;2<b&&a[b-1].equals(a[0])&&
a.pop()}function d(a,b,c){return a.x!==b.x?a.x<b.x?a.x<=c.x&&c.x<=b.x:b.x<=c.x&&c.x<=a.x:a.y<b.y?a.y<=c.y&&c.y<=b.y:b.y<=c.y&&c.y<=a.y}function e(a,b,c,e,f){var g=b.x-a.x,h=b.y-a.y,k=e.x-c.x,m=e.y-c.y,l=a.x-c.x,n=a.y-c.y,p=h*k-g*m,q=h*l-g*n;if(Math.abs(p)>Number.EPSILON){if(0<p){if(0>q||q>p)return[];k=m*l-k*n;if(0>k||k>p)return[]}else{if(0<q||q<p)return[];k=m*l-k*n;if(0<k||k<p)return[]}if(0===k)return!f||0!==q&&q!==p?[a]:[];if(k===p)return!f||0!==q&&q!==p?[b]:[];if(0===q)return[c];if(q===p)return[e];
f=k/p;return[{x:a.x+f*g,y:a.y+f*h}]}if(0!==q||m*l!==k*n)return[];h=0===g&&0===h;k=0===k&&0===m;if(h&&k)return a.x!==c.x||a.y!==c.y?[]:[a];if(h)return d(c,e,a)?[a]:[];if(k)return d(a,b,c)?[c]:[];0!==g?(a.x<b.x?(g=a,k=a.x,h=b,a=b.x):(g=b,k=b.x,h=a,a=a.x),c.x<e.x?(b=c,p=c.x,m=e,c=e.x):(b=e,p=e.x,m=c,c=c.x)):(a.y<b.y?(g=a,k=a.y,h=b,a=b.y):(g=b,k=b.y,h=a,a=a.y),c.y<e.y?(b=c,p=c.y,m=e,c=e.y):(b=e,p=e.y,m=c,c=c.y));return k<=p?a<p?[]:a===p?f?[]:[b]:a<=c?[b,h]:[b,m]:k>c?[]:k===c?f?[]:[g]:a<=c?[g,h]:[g,m]}
function f(a,b,c,d){var e=b.x-a.x,f=b.y-a.y;b=c.x-a.x;c=c.y-a.y;var g=d.x-a.x;d=d.y-a.y;a=e*c-f*b;e=e*d-f*g;return Math.abs(a)>Number.EPSILON?(b=g*c-d*b,0<a?0<=e&&0<=b:0<=e||0<=b):0<e}c(a);b.forEach(c);var g,h,k,m,l,p={};k=a.concat();g=0;for(h=b.length;g<h;g++)Array.prototype.push.apply(k,b[g]);g=0;for(h=k.length;g<h;g++)l=k[g].x+":"+k[g].y,void 0!==p[l]&&console.warn("THREE.ShapeUtils: Duplicate point",l,g),p[l]=g;g=function(a,b){function c(a,b){var d=h.length-1,e=a-1;0>e&&(e=d);var g=a+1;g>d&&(g=
0);d=f(h[a],h[e],h[g],k[b]);if(!d)return!1;d=k.length-1;e=b-1;0>e&&(e=d);g=b+1;g>d&&(g=0);return(d=f(k[b],k[e],k[g],h[a]))?!0:!1}function d(a,b){var c,f;for(c=0;c<h.length;c++)if(f=c+1,f%=h.length,f=e(a,b,h[c],h[f],!0),0<f.length)return!0;return!1}function g(a,c){var d,f,h,k;for(d=0;d<m.length;d++)for(f=b[m[d]],h=0;h<f.length;h++)if(k=h+1,k%=f.length,k=e(a,c,f[h],f[k],!0),0<k.length)return!0;return!1}var h=a.concat(),k,m=[],l,n,p,q,x,y=[],C,D,G,H=0;for(l=b.length;H<l;H++)m.push(H);C=0;for(var O=2*
m.length;0<m.length;){O--;if(0>O){console.log("Infinite Loop! Holes left:"+m.length+", Probably Hole outside Shape!");break}for(n=C;n<h.length;n++){p=h[n];l=-1;for(H=0;H<m.length;H++)if(q=m[H],x=p.x+":"+p.y+":"+q,void 0===y[x]){k=b[q];for(D=0;D<k.length;D++)if(q=k[D],c(n,D)&&!d(p,q)&&!g(p,q)){l=D;m.splice(H,1);C=h.slice(0,n+1);q=h.slice(n);D=k.slice(l);G=k.slice(0,l+1);h=C.concat(D).concat(G).concat(q);C=n;break}if(0<=l)break;y[x]=!0}if(0<=l)break}}return h}(a,b);var n=pa.triangulate(g,!1);g=0;for(h=
n.length;g<h;g++)for(m=n[g],k=0;3>k;k++)l=m[k].x+":"+m[k].y,l=p[l],void 0!==l&&(m[k]=l);return n.concat()},isClockWise:function(a){return 0>pa.area(a)},b2:function(){return function(a,b,c,d){var e=1-a;return e*e*b+2*(1-a)*a*c+a*a*d}}(),b3:function(){return function(a,b,c,d,e){var f=1-a,g=1-a;return f*f*f*b+3*g*g*a*c+3*(1-a)*a*a*d+a*a*a*e}}()};La.prototype=Object.create(S.prototype);La.prototype.constructor=La;La.prototype.addShapeList=function(a,b){for(var c=a.length,d=0;d<c;d++)this.addShape(a[d],
b)};La.prototype.addShape=function(a,b){function c(a,b,c){b||console.error("THREE.ExtrudeGeometry: vec does not exist");return b.clone().multiplyScalar(c).add(a)}function d(a,b,c){var d,e,f;e=a.x-b.x;f=a.y-b.y;d=c.x-a.x;var g=c.y-a.y,h=e*e+f*f;if(Math.abs(e*g-f*d)>Number.EPSILON){var k=Math.sqrt(h),m=Math.sqrt(d*d+g*g),h=b.x-f/k;b=b.y+e/k;g=((c.x-g/m-h)*g-(c.y+d/m-b)*d)/(e*g-f*d);d=h+e*g-a.x;e=b+f*g-a.y;f=d*d+e*e;if(2>=f)return new C(d,e);f=Math.sqrt(f/2)}else a=!1,e>Number.EPSILON?d>Number.EPSILON&&
(a=!0):e<-Number.EPSILON?d<-Number.EPSILON&&(a=!0):Math.sign(f)===Math.sign(g)&&(a=!0),a?(d=-f,f=Math.sqrt(h)):(d=e,e=f,f=Math.sqrt(h/2));return new C(d/f,e/f)}function e(a,b){var c,d;for(L=a.length;0<=--L;){c=L;d=L-1;0>d&&(d=a.length-1);var e,f=r+2*l;for(e=0;e<f;e++){var g=U*e,h=U*(e+1),k=b+c+g,g=b+d+g,m=b+d+h,h=b+c+h,k=k+J,g=g+J,m=m+J,h=h+J;G.faces.push(new ha(k,g,h,null,null,1));G.faces.push(new ha(g,m,h,null,null,1));k=t.generateSideWallUV(G,k,g,m,h);G.faceVertexUvs[0].push([k[0],k[1],k[3]]);
G.faceVertexUvs[0].push([k[1],k[2],k[3]])}}}function f(a,b,c){G.vertices.push(new q(a,b,c))}function g(a,b,c){a+=J;b+=J;c+=J;G.faces.push(new ha(a,b,c,null,null,0));a=t.generateTopUV(G,a,b,c);G.faceVertexUvs[0].push(a)}var h=void 0!==b.amount?b.amount:100,k=void 0!==b.bevelThickness?b.bevelThickness:6,m=void 0!==b.bevelSize?b.bevelSize:k-2,l=void 0!==b.bevelSegments?b.bevelSegments:3,p=void 0!==b.bevelEnabled?b.bevelEnabled:!0,n=void 0!==b.curveSegments?b.curveSegments:12,r=void 0!==b.steps?b.steps:
1,w=b.extrudePath,u,F=!1,t=void 0!==b.UVGenerator?b.UVGenerator:La.WorldUVGenerator,v,y,z,A;w&&(u=w.getSpacedPoints(r),F=!0,p=!1,v=void 0!==b.frames?b.frames:w.computeFrenetFrames(r,!1),y=new q,z=new q,A=new q);p||(m=k=l=0);var I,E,D,G=this,J=this.vertices.length,w=a.extractPoints(n),n=w.shape,H=w.holes;if(w=!pa.isClockWise(n)){n=n.reverse();E=0;for(D=H.length;E<D;E++)I=H[E],pa.isClockWise(I)&&(H[E]=I.reverse());w=!1}var N=pa.triangulateShape(n,H),S=n;E=0;for(D=H.length;E<D;E++)I=H[E],n=n.concat(I);
var Q,O,P,R,T,U=n.length,V,W=N.length,w=[],L=0;P=S.length;Q=P-1;for(O=L+1;L<P;L++,Q++,O++)Q===P&&(Q=0),O===P&&(O=0),w[L]=d(S[L],S[Q],S[O]);var X=[],Z,ba=w.concat();E=0;for(D=H.length;E<D;E++){I=H[E];Z=[];L=0;P=I.length;Q=P-1;for(O=L+1;L<P;L++,Q++,O++)Q===P&&(Q=0),O===P&&(O=0),Z[L]=d(I[L],I[Q],I[O]);X.push(Z);ba=ba.concat(Z)}for(Q=0;Q<l;Q++){P=Q/l;R=k*Math.cos(P*Math.PI/2);O=m*Math.sin(P*Math.PI/2);L=0;for(P=S.length;L<P;L++)T=c(S[L],w[L],O),f(T.x,T.y,-R);E=0;for(D=H.length;E<D;E++)for(I=H[E],Z=X[E],
L=0,P=I.length;L<P;L++)T=c(I[L],Z[L],O),f(T.x,T.y,-R)}O=m;for(L=0;L<U;L++)T=p?c(n[L],ba[L],O):n[L],F?(z.copy(v.normals[0]).multiplyScalar(T.x),y.copy(v.binormals[0]).multiplyScalar(T.y),A.copy(u[0]).add(z).add(y),f(A.x,A.y,A.z)):f(T.x,T.y,0);for(P=1;P<=r;P++)for(L=0;L<U;L++)T=p?c(n[L],ba[L],O):n[L],F?(z.copy(v.normals[P]).multiplyScalar(T.x),y.copy(v.binormals[P]).multiplyScalar(T.y),A.copy(u[P]).add(z).add(y),f(A.x,A.y,A.z)):f(T.x,T.y,h/r*P);for(Q=l-1;0<=Q;Q--){P=Q/l;R=k*Math.cos(P*Math.PI/2);O=
m*Math.sin(P*Math.PI/2);L=0;for(P=S.length;L<P;L++)T=c(S[L],w[L],O),f(T.x,T.y,h+R);E=0;for(D=H.length;E<D;E++)for(I=H[E],Z=X[E],L=0,P=I.length;L<P;L++)T=c(I[L],Z[L],O),F?f(T.x,T.y+u[r-1].y,u[r-1].x+R):f(T.x,T.y,h+R)}(function(){if(p){var a=0*U;for(L=0;L<W;L++)V=N[L],g(V[2]+a,V[1]+a,V[0]+a);a=U*(r+2*l);for(L=0;L<W;L++)V=N[L],g(V[0]+a,V[1]+a,V[2]+a)}else{for(L=0;L<W;L++)V=N[L],g(V[2],V[1],V[0]);for(L=0;L<W;L++)V=N[L],g(V[0]+U*r,V[1]+U*r,V[2]+U*r)}})();(function(){var a=0;e(S,a);a+=S.length;E=0;for(D=
H.length;E<D;E++)I=H[E],e(I,a),a+=I.length})()};La.WorldUVGenerator={generateTopUV:function(a,b,c,d){a=a.vertices;b=a[b];c=a[c];d=a[d];return[new C(b.x,b.y),new C(c.x,c.y),new C(d.x,d.y)]},generateSideWallUV:function(a,b,c,d,e){a=a.vertices;b=a[b];c=a[c];d=a[d];e=a[e];return.01>Math.abs(b.y-c.y)?[new C(b.x,1-b.z),new C(c.x,1-c.z),new C(d.x,1-d.z),new C(e.x,1-e.z)]:[new C(b.y,1-b.z),new C(c.y,1-c.z),new C(d.y,1-d.z),new C(e.y,1-e.z)]}};Mc.prototype=Object.create(La.prototype);Mc.prototype.constructor=
Mc;mb.prototype=Object.create(D.prototype);mb.prototype.constructor=mb;Nc.prototype=Object.create(S.prototype);Nc.prototype.constructor=Nc;Ub.prototype=Object.create(D.prototype);Ub.prototype.constructor=Ub;Oc.prototype=Object.create(S.prototype);Oc.prototype.constructor=Oc;Pc.prototype=Object.create(S.prototype);Pc.prototype.constructor=Pc;Vb.prototype=Object.create(D.prototype);Vb.prototype.constructor=Vb;Qc.prototype=Object.create(S.prototype);Qc.prototype.constructor=Qc;Wb.prototype=Object.create(D.prototype);
Wb.prototype.constructor=Wb;Xb.prototype=Object.create(S.prototype);Xb.prototype.constructor=Xb;Yb.prototype=Object.create(D.prototype);Yb.prototype.constructor=Yb;Wa.prototype=Object.create(D.prototype);Wa.prototype.constructor=Wa;nb.prototype=Object.create(S.prototype);nb.prototype.constructor=nb;Rc.prototype=Object.create(nb.prototype);Rc.prototype.constructor=Rc;Sc.prototype=Object.create(Wa.prototype);Sc.prototype.constructor=Sc;Zb.prototype=Object.create(D.prototype);Zb.prototype.constructor=
Zb;Tc.prototype=Object.create(S.prototype);Tc.prototype.constructor=Tc;$b.prototype=Object.create(S.prototype);$b.prototype.constructor=$b;var Ea=Object.freeze({WireframeGeometry:Mb,ParametricGeometry:Dc,ParametricBufferGeometry:Nb,TetrahedronGeometry:Ec,TetrahedronBufferGeometry:Ob,OctahedronGeometry:Fc,OctahedronBufferGeometry:lb,IcosahedronGeometry:Gc,IcosahedronBufferGeometry:Pb,DodecahedronGeometry:Hc,DodecahedronBufferGeometry:Qb,PolyhedronGeometry:Ic,PolyhedronBufferGeometry:xa,TubeGeometry:Jc,
TubeBufferGeometry:Rb,TorusKnotGeometry:Kc,TorusKnotBufferGeometry:Sb,TorusGeometry:Lc,TorusBufferGeometry:Tb,TextGeometry:Mc,SphereBufferGeometry:mb,SphereGeometry:Nc,RingGeometry:Oc,RingBufferGeometry:Ub,PlaneBufferGeometry:ib,PlaneGeometry:Pc,LatheGeometry:Qc,LatheBufferGeometry:Vb,ShapeGeometry:Xb,ShapeBufferGeometry:Wb,ExtrudeGeometry:La,EdgesGeometry:Yb,ConeGeometry:Rc,ConeBufferGeometry:Sc,CylinderGeometry:nb,CylinderBufferGeometry:Wa,CircleBufferGeometry:Zb,CircleGeometry:Tc,BoxBufferGeometry:hb,
BoxGeometry:$b});ac.prototype=Object.create(Ia.prototype);ac.prototype.constructor=ac;ac.prototype.isShadowMaterial=!0;bc.prototype=Object.create(Ia.prototype);bc.prototype.constructor=bc;bc.prototype.isRawShaderMaterial=!0;Uc.prototype={constructor:Uc,isMultiMaterial:!0,toJSON:function(a){for(var b={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type,materials:[]},c=this.materials,d=0,e=c.length;d<e;d++){var f=c[d].toJSON(a);delete f.metadata;b.materials.push(f)}b.visible=
this.visible;return b},clone:function(){for(var a=new this.constructor,b=0;b<this.materials.length;b++)a.materials.push(this.materials[b].clone());a.visible=this.visible;return a}};Pa.prototype=Object.create(W.prototype);Pa.prototype.constructor=Pa;Pa.prototype.isMeshStandardMaterial=!0;Pa.prototype.copy=function(a){W.prototype.copy.call(this,a);this.defines={STANDARD:""};this.color.copy(a.color);this.roughness=a.roughness;this.metalness=a.metalness;this.map=a.map;this.lightMap=a.lightMap;this.lightMapIntensity=
a.lightMapIntensity;this.aoMap=a.aoMap;this.aoMapIntensity=a.aoMapIntensity;this.emissive.copy(a.emissive);this.emissiveMap=a.emissiveMap;this.emissiveIntensity=a.emissiveIntensity;this.bumpMap=a.bumpMap;this.bumpScale=a.bumpScale;this.normalMap=a.normalMap;this.normalScale.copy(a.normalScale);this.displacementMap=a.displacementMap;this.displacementScale=a.displacementScale;this.displacementBias=a.displacementBias;this.roughnessMap=a.roughnessMap;this.metalnessMap=a.metalnessMap;this.alphaMap=a.alphaMap;
this.envMap=a.envMap;this.envMapIntensity=a.envMapIntensity;this.refractionRatio=a.refractionRatio;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.wireframeLinecap=a.wireframeLinecap;this.wireframeLinejoin=a.wireframeLinejoin;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.morphNormals=a.morphNormals;return this};ob.prototype=Object.create(Pa.prototype);ob.prototype.constructor=ob;ob.prototype.isMeshPhysicalMaterial=!0;ob.prototype.copy=function(a){Pa.prototype.copy.call(this,
a);this.defines={PHYSICAL:""};this.reflectivity=a.reflectivity;this.clearCoat=a.clearCoat;this.clearCoatRoughness=a.clearCoatRoughness;return this};Ca.prototype=Object.create(W.prototype);Ca.prototype.constructor=Ca;Ca.prototype.isMeshPhongMaterial=!0;Ca.prototype.copy=function(a){W.prototype.copy.call(this,a);this.color.copy(a.color);this.specular.copy(a.specular);this.shininess=a.shininess;this.map=a.map;this.lightMap=a.lightMap;this.lightMapIntensity=a.lightMapIntensity;this.aoMap=a.aoMap;this.aoMapIntensity=
a.aoMapIntensity;this.emissive.copy(a.emissive);this.emissiveMap=a.emissiveMap;this.emissiveIntensity=a.emissiveIntensity;this.bumpMap=a.bumpMap;this.bumpScale=a.bumpScale;this.normalMap=a.normalMap;this.normalScale.copy(a.normalScale);this.displacementMap=a.displacementMap;this.displacementScale=a.displacementScale;this.displacementBias=a.displacementBias;this.specularMap=a.specularMap;this.alphaMap=a.alphaMap;this.envMap=a.envMap;this.combine=a.combine;this.reflectivity=a.reflectivity;this.refractionRatio=
a.refractionRatio;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.wireframeLinecap=a.wireframeLinecap;this.wireframeLinejoin=a.wireframeLinejoin;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.morphNormals=a.morphNormals;return this};pb.prototype=Object.create(Ca.prototype);pb.prototype.constructor=pb;pb.prototype.isMeshToonMaterial=!0;pb.prototype.copy=function(a){Ca.prototype.copy.call(this,a);this.gradientMap=a.gradientMap;return this};qb.prototype=Object.create(W.prototype);
qb.prototype.constructor=qb;qb.prototype.isMeshNormalMaterial=!0;qb.prototype.copy=function(a){W.prototype.copy.call(this,a);this.bumpMap=a.bumpMap;this.bumpScale=a.bumpScale;this.normalMap=a.normalMap;this.normalScale.copy(a.normalScale);this.displacementMap=a.displacementMap;this.displacementScale=a.displacementScale;this.displacementBias=a.displacementBias;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.morphNormals=
a.morphNormals;return this};rb.prototype=Object.create(W.prototype);rb.prototype.constructor=rb;rb.prototype.isMeshLambertMaterial=!0;rb.prototype.copy=function(a){W.prototype.copy.call(this,a);this.color.copy(a.color);this.map=a.map;this.lightMap=a.lightMap;this.lightMapIntensity=a.lightMapIntensity;this.aoMap=a.aoMap;this.aoMapIntensity=a.aoMapIntensity;this.emissive.copy(a.emissive);this.emissiveMap=a.emissiveMap;this.emissiveIntensity=a.emissiveIntensity;this.specularMap=a.specularMap;this.alphaMap=
a.alphaMap;this.envMap=a.envMap;this.combine=a.combine;this.reflectivity=a.reflectivity;this.refractionRatio=a.refractionRatio;this.wireframe=a.wireframe;this.wireframeLinewidth=a.wireframeLinewidth;this.wireframeLinecap=a.wireframeLinecap;this.wireframeLinejoin=a.wireframeLinejoin;this.skinning=a.skinning;this.morphTargets=a.morphTargets;this.morphNormals=a.morphNormals;return this};sb.prototype=Object.create(W.prototype);sb.prototype.constructor=sb;sb.prototype.isLineDashedMaterial=!0;sb.prototype.copy=
function(a){W.prototype.copy.call(this,a);this.color.copy(a.color);this.linewidth=a.linewidth;this.scale=a.scale;this.dashSize=a.dashSize;this.gapSize=a.gapSize;return this};var Mf=Object.freeze({ShadowMaterial:ac,SpriteMaterial:kb,RawShaderMaterial:bc,ShaderMaterial:Ia,PointsMaterial:Oa,MultiMaterial:Uc,MeshPhysicalMaterial:ob,MeshStandardMaterial:Pa,MeshPhongMaterial:Ca,MeshToonMaterial:pb,MeshNormalMaterial:qb,MeshLambertMaterial:rb,MeshDepthMaterial:ab,MeshBasicMaterial:Ka,LineDashedMaterial:sb,
LineBasicMaterial:ia,Material:W}),ne={enabled:!1,files:{},add:function(a,b){!1!==this.enabled&&(this.files[a]=b)},get:function(a){if(!1!==this.enabled)return this.files[a]},remove:function(a){delete this.files[a]},clear:function(){this.files={}}},va=new Pd;Object.assign(Ma.prototype,{load:function(a,b,c,d){void 0===a&&(a="");void 0!==this.path&&(a=this.path+a);var e=this,f=ne.get(a);if(void 0!==f)return e.manager.itemStart(a),setTimeout(function(){b&&b(f);e.manager.itemEnd(a)},0),f;var g=a.match(/^data:(.*?)(;base64)?,(.*)$/);
if(g){var h=g[1],k=!!g[2],g=g[3],g=window.decodeURIComponent(g);k&&(g=window.atob(g));try{var m,l=(this.responseType||"").toLowerCase();switch(l){case "arraybuffer":case "blob":m=new ArrayBuffer(g.length);for(var p=new Uint8Array(m),k=0;k<g.length;k++)p[k]=g.charCodeAt(k);"blob"===l&&(m=new Blob([m],{type:h}));break;case "document":m=(new DOMParser).parseFromString(g,h);break;case "json":m=JSON.parse(g);break;default:m=g}window.setTimeout(function(){b&&b(m);e.manager.itemEnd(a)},0)}catch(q){window.setTimeout(function(){d&&
d(q);e.manager.itemError(a)},0)}}else{var n=new XMLHttpRequest;n.open("GET",a,!0);n.addEventListener("load",function(c){var f=c.target.response;ne.add(a,f);200===this.status?(b&&b(f),e.manager.itemEnd(a)):0===this.status?(console.warn("THREE.FileLoader: HTTP Status 0 received."),b&&b(f),e.manager.itemEnd(a)):(d&&d(c),e.manager.itemError(a))},!1);void 0!==c&&n.addEventListener("progress",function(a){c(a)},!1);n.addEventListener("error",function(b){d&&d(b);e.manager.itemError(a)},!1);void 0!==this.responseType&&
(n.responseType=this.responseType);void 0!==this.withCredentials&&(n.withCredentials=this.withCredentials);n.overrideMimeType&&n.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain");n.send(null)}e.manager.itemStart(a);return n},setPath:function(a){this.path=a;return this},setResponseType:function(a){this.responseType=a;return this},setWithCredentials:function(a){this.withCredentials=a;return this},setMimeType:function(a){this.mimeType=a;return this}});Object.assign(Ee.prototype,{load:function(a,
b,c,d){function e(e){k.load(a[e],function(a){a=f._parser(a,!0);g[e]={width:a.width,height:a.height,format:a.format,mipmaps:a.mipmaps};m+=1;6===m&&(1===a.mipmapCount&&(h.minFilter=1006),h.format=a.format,h.needsUpdate=!0,b&&b(h))},c,d)}var f=this,g=[],h=new Lb;h.image=g;var k=new Ma(this.manager);k.setPath(this.path);k.setResponseType("arraybuffer");if(Array.isArray(a))for(var m=0,l=0,p=a.length;l<p;++l)e(l);else k.load(a,function(a){a=f._parser(a,!0);if(a.isCubemap)for(var c=a.mipmaps.length/a.mipmapCount,
d=0;d<c;d++){g[d]={mipmaps:[]};for(var e=0;e<a.mipmapCount;e++)g[d].mipmaps.push(a.mipmaps[d*a.mipmapCount+e]),g[d].format=a.format,g[d].width=a.width,g[d].height=a.height}else h.image.width=a.width,h.image.height=a.height,h.mipmaps=a.mipmaps;1===a.mipmapCount&&(h.minFilter=1006);h.format=a.format;h.needsUpdate=!0;b&&b(h)},c,d);return h},setPath:function(a){this.path=a;return this}});Object.assign(Qd.prototype,{load:function(a,b,c,d){var e=this,f=new db,g=new Ma(this.manager);g.setResponseType("arraybuffer");
g.load(a,function(a){if(a=e._parser(a))void 0!==a.image?f.image=a.image:void 0!==a.data&&(f.image.width=a.width,f.image.height=a.height,f.image.data=a.data),f.wrapS=void 0!==a.wrapS?a.wrapS:1001,f.wrapT=void 0!==a.wrapT?a.wrapT:1001,f.magFilter=void 0!==a.magFilter?a.magFilter:1006,f.minFilter=void 0!==a.minFilter?a.minFilter:1008,f.anisotropy=void 0!==a.anisotropy?a.anisotropy:1,void 0!==a.format&&(f.format=a.format),void 0!==a.type&&(f.type=a.type),void 0!==a.mipmaps&&(f.mipmaps=a.mipmaps),1===
a.mipmapCount&&(f.minFilter=1006),f.needsUpdate=!0,b&&b(f,a)},c,d);return f}});Object.assign(Vc.prototype,{load:function(a,b,c,d){var e=this,f=document.createElementNS("http://www.w3.org/1999/xhtml","img");f.onload=function(){f.onload=null;URL.revokeObjectURL(f.src);b&&b(f);e.manager.itemEnd(a)};f.onerror=d;if(0===a.indexOf("data:"))f.src=a;else if(void 0!==this.crossOrigin)f.crossOrigin=this.crossOrigin,f.src=a;else{var g=new Ma;g.setPath(this.path);g.setResponseType("blob");g.setWithCredentials(this.withCredentials);
g.load(a,function(a){f.src=URL.createObjectURL(a)},c,d)}e.manager.itemStart(a);return f},setCrossOrigin:function(a){this.crossOrigin=a;return this},setWithCredentials:function(a){this.withCredentials=a;return this},setPath:function(a){this.path=a;return this}});Object.assign(Rd.prototype,{load:function(a,b,c,d){function e(c){g.load(a[c],function(a){f.images[c]=a;h++;6===h&&(f.needsUpdate=!0,b&&b(f))},void 0,d)}var f=new Za,g=new Vc(this.manager);g.setCrossOrigin(this.crossOrigin);g.setPath(this.path);
var h=0;for(c=0;c<a.length;++c)e(c);return f},setCrossOrigin:function(a){this.crossOrigin=a;return this},setPath:function(a){this.path=a;return this}});Object.assign(md.prototype,{load:function(a,b,c,d){var e=new ea,f=new Vc(this.manager);f.setCrossOrigin(this.crossOrigin);f.setWithCredentials(this.withCredentials);f.setPath(this.path);f.load(a,function(c){var d=0<a.search(/\.(jpg|jpeg)$/)||0===a.search(/^data\:image\/jpeg/);e.format=d?1022:1023;e.image=c;e.needsUpdate=!0;void 0!==b&&b(e)},c,d);return e},
setCrossOrigin:function(a){this.crossOrigin=a;return this},setWithCredentials:function(a){this.withCredentials=a;return this},setPath:function(a){this.path=a;return this}});na.prototype=Object.assign(Object.create(G.prototype),{constructor:na,isLight:!0,copy:function(a){G.prototype.copy.call(this,a);this.color.copy(a.color);this.intensity=a.intensity;return this},toJSON:function(a){a=G.prototype.toJSON.call(this,a);a.object.color=this.color.getHex();a.object.intensity=this.intensity;void 0!==this.groundColor&&
(a.object.groundColor=this.groundColor.getHex());void 0!==this.distance&&(a.object.distance=this.distance);void 0!==this.angle&&(a.object.angle=this.angle);void 0!==this.decay&&(a.object.decay=this.decay);void 0!==this.penumbra&&(a.object.penumbra=this.penumbra);void 0!==this.shadow&&(a.object.shadow=this.shadow.toJSON());return a}});nd.prototype=Object.assign(Object.create(na.prototype),{constructor:nd,isHemisphereLight:!0,copy:function(a){na.prototype.copy.call(this,a);this.groundColor.copy(a.groundColor);
return this}});Object.assign(tb.prototype,{copy:function(a){this.camera=a.camera.clone();this.bias=a.bias;this.radius=a.radius;this.mapSize.copy(a.mapSize);return this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var a={};0!==this.bias&&(a.bias=this.bias);1!==this.radius&&(a.radius=this.radius);if(512!==this.mapSize.x||512!==this.mapSize.y)a.mapSize=this.mapSize.toArray();a.camera=this.camera.toJSON(!1).object;delete a.camera.matrix;return a}});od.prototype=Object.assign(Object.create(tb.prototype),
{constructor:od,isSpotLightShadow:!0,update:function(a){var b=2*Q.RAD2DEG*a.angle,c=this.mapSize.width/this.mapSize.height;a=a.distance||500;var d=this.camera;if(b!==d.fov||c!==d.aspect||a!==d.far)d.fov=b,d.aspect=c,d.far=a,d.updateProjectionMatrix()}});pd.prototype=Object.assign(Object.create(na.prototype),{constructor:pd,isSpotLight:!0,copy:function(a){na.prototype.copy.call(this,a);this.distance=a.distance;this.angle=a.angle;this.penumbra=a.penumbra;this.decay=a.decay;this.target=a.target.clone();
this.shadow=a.shadow.clone();return this}});qd.prototype=Object.assign(Object.create(na.prototype),{constructor:qd,isPointLight:!0,copy:function(a){na.prototype.copy.call(this,a);this.distance=a.distance;this.decay=a.decay;this.shadow=a.shadow.clone();return this}});rd.prototype=Object.assign(Object.create(tb.prototype),{constructor:rd});sd.prototype=Object.assign(Object.create(na.prototype),{constructor:sd,isDirectionalLight:!0,copy:function(a){na.prototype.copy.call(this,a);this.target=a.target.clone();
this.shadow=a.shadow.clone();return this}});td.prototype=Object.assign(Object.create(na.prototype),{constructor:td,isAmbientLight:!0});var ba={arraySlice:function(a,b,c){return ba.isTypedArray(a)?new a.constructor(a.subarray(b,c)):a.slice(b,c)},convertArray:function(a,b,c){return!a||!c&&a.constructor===b?a:"number"===typeof b.BYTES_PER_ELEMENT?new b(a):Array.prototype.slice.call(a)},isTypedArray:function(a){return ArrayBuffer.isView(a)&&!(a instanceof DataView)},getKeyframeOrder:function(a){for(var b=
a.length,c=Array(b),d=0;d!==b;++d)c[d]=d;c.sort(function(b,c){return a[b]-a[c]});return c},sortedArray:function(a,b,c){for(var d=a.length,e=new a.constructor(d),f=0,g=0;g!==d;++f)for(var h=c[f]*b,k=0;k!==b;++k)e[g++]=a[h+k];return e},flattenJSON:function(a,b,c,d){for(var e=1,f=a[0];void 0!==f&&void 0===f[d];)f=a[e++];if(void 0!==f){var g=f[d];if(void 0!==g)if(Array.isArray(g)){do g=f[d],void 0!==g&&(b.push(f.time),c.push.apply(c,g)),f=a[e++];while(void 0!==f)}else if(void 0!==g.toArray){do g=f[d],
void 0!==g&&(b.push(f.time),g.toArray(c,c.length)),f=a[e++];while(void 0!==f)}else{do g=f[d],void 0!==g&&(b.push(f.time),c.push(g)),f=a[e++];while(void 0!==f)}}}};qa.prototype={constructor:qa,evaluate:function(a){var b=this.parameterPositions,c=this._cachedIndex,d=b[c],e=b[c-1];a:{b:{c:{d:if(!(a<d)){for(var f=c+2;;){if(void 0===d){if(a<e)break d;this._cachedIndex=c=b.length;return this.afterEnd_(c-1,a,e)}if(c===f)break;e=d;d=b[++c];if(a<d)break b}d=b.length;break c}if(a>=e)break a;else{f=b[1];a<f&&
(c=2,e=f);for(f=c-2;;){if(void 0===e)return this._cachedIndex=0,this.beforeStart_(0,a,d);if(c===f)break;d=e;e=b[--c-1];if(a>=e)break b}d=c;c=0}}for(;c<d;)e=c+d>>>1,a<b[e]?d=e:c=e+1;d=b[c];e=b[c-1];if(void 0===e)return this._cachedIndex=0,this.beforeStart_(0,a,d);if(void 0===d)return this._cachedIndex=c=b.length,this.afterEnd_(c-1,e,a)}this._cachedIndex=c;this.intervalChanged_(c,e,d)}return this.interpolate_(c,e,a,d)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||
this.DefaultSettings_},copySampleValue_:function(a){var b=this.resultBuffer,c=this.sampleValues,d=this.valueSize;a*=d;for(var e=0;e!==d;++e)b[e]=c[a+e];return b},interpolate_:function(a,b,c,d){throw Error("call to abstract method");},intervalChanged_:function(a,b,c){}};Object.assign(qa.prototype,{beforeStart_:qa.prototype.copySampleValue_,afterEnd_:qa.prototype.copySampleValue_});ud.prototype=Object.assign(Object.create(qa.prototype),{constructor:ud,DefaultSettings_:{endingStart:2400,endingEnd:2400},
intervalChanged_:function(a,b,c){var d=this.parameterPositions,e=a-2,f=a+1,g=d[e],h=d[f];if(void 0===g)switch(this.getSettings_().endingStart){case 2401:e=a;g=2*b-c;break;case 2402:e=d.length-2;g=b+d[e]-d[e+1];break;default:e=a,g=c}if(void 0===h)switch(this.getSettings_().endingEnd){case 2401:f=a;h=2*c-b;break;case 2402:f=1;h=c+d[1]-d[0];break;default:f=a-1,h=b}a=.5*(c-b);d=this.valueSize;this._weightPrev=a/(b-g);this._weightNext=a/(h-c);this._offsetPrev=e*d;this._offsetNext=f*d},interpolate_:function(a,
b,c,d){var e=this.resultBuffer,f=this.sampleValues,g=this.valueSize;a*=g;var h=a-g,k=this._offsetPrev,m=this._offsetNext,l=this._weightPrev,p=this._weightNext,n=(c-b)/(d-b);c=n*n;d=c*n;b=-l*d+2*l*c-l*n;l=(1+l)*d+(-1.5-2*l)*c+(-.5+l)*n+1;n=(-1-p)*d+(1.5+p)*c+.5*n;p=p*d-p*c;for(c=0;c!==g;++c)e[c]=b*f[k+c]+l*f[h+c]+n*f[a+c]+p*f[m+c];return e}});Wc.prototype=Object.assign(Object.create(qa.prototype),{constructor:Wc,interpolate_:function(a,b,c,d){var e=this.resultBuffer,f=this.sampleValues,g=this.valueSize;
a*=g;var h=a-g;b=(c-b)/(d-b);c=1-b;for(d=0;d!==g;++d)e[d]=f[h+d]*c+f[a+d]*b;return e}});vd.prototype=Object.assign(Object.create(qa.prototype),{constructor:vd,interpolate_:function(a,b,c,d){return this.copySampleValue_(a-1)}});var Ya;Ya={TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:2301,InterpolantFactoryMethodDiscrete:function(a){return new vd(this.times,this.values,this.getValueSize(),a)},InterpolantFactoryMethodLinear:function(a){return new Wc(this.times,this.values,
this.getValueSize(),a)},InterpolantFactoryMethodSmooth:function(a){return new ud(this.times,this.values,this.getValueSize(),a)},setInterpolation:function(a){var b;switch(a){case 2300:b=this.InterpolantFactoryMethodDiscrete;break;case 2301:b=this.InterpolantFactoryMethodLinear;break;case 2302:b=this.InterpolantFactoryMethodSmooth}if(void 0===b){b="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant)if(a!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);
else throw Error(b);console.warn(b)}else this.createInterpolant=b},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}},getValueSize:function(){return this.values.length/this.times.length},shift:function(a){if(0!==a)for(var b=this.times,c=0,d=b.length;c!==d;++c)b[c]+=a;return this},scale:function(a){if(1!==a)for(var b=this.times,c=
0,d=b.length;c!==d;++c)b[c]*=a;return this},trim:function(a,b){for(var c=this.times,d=c.length,e=0,f=d-1;e!==d&&c[e]<a;)++e;for(;-1!==f&&c[f]>b;)--f;++f;if(0!==e||f!==d)e>=f&&(f=Math.max(f,1),e=f-1),d=this.getValueSize(),this.times=ba.arraySlice(c,e,f),this.values=ba.arraySlice(this.values,e*d,f*d);return this},validate:function(){var a=!0,b=this.getValueSize();0!==b-Math.floor(b)&&(console.error("invalid value size in track",this),a=!1);var c=this.times,b=this.values,d=c.length;0===d&&(console.error("track is empty",
this),a=!1);for(var e=null,f=0;f!==d;f++){var g=c[f];if("number"===typeof g&&isNaN(g)){console.error("time is not a valid number",this,f,g);a=!1;break}if(null!==e&&e>g){console.error("out of order keys",this,f,g,e);a=!1;break}e=g}if(void 0!==b&&ba.isTypedArray(b))for(f=0,c=b.length;f!==c;++f)if(d=b[f],isNaN(d)){console.error("value is not a valid number",this,f,d);a=!1;break}return a},optimize:function(){for(var a=this.times,b=this.values,c=this.getValueSize(),d=2302===this.getInterpolation(),e=1,
f=a.length-1,g=1;g<f;++g){var h=!1,k=a[g];if(k!==a[g+1]&&(1!==g||k!==k[0]))if(d)h=!0;else for(var m=g*c,l=m-c,p=m+c,k=0;k!==c;++k){var n=b[m+k];if(n!==b[l+k]||n!==b[p+k]){h=!0;break}}if(h){if(g!==e)for(a[e]=a[g],h=g*c,m=e*c,k=0;k!==c;++k)b[m+k]=b[h+k];++e}}if(0<f){a[e]=a[f];h=f*c;m=e*c;for(k=0;k!==c;++k)b[m+k]=b[h+k];++e}e!==a.length&&(this.times=ba.arraySlice(a,0,e),this.values=ba.arraySlice(b,0,e*c));return this}};cc.prototype=Object.assign(Object.create(Ya),{constructor:cc,ValueTypeName:"vector"});
wd.prototype=Object.assign(Object.create(qa.prototype),{constructor:wd,interpolate_:function(a,b,c,d){var e=this.resultBuffer,f=this.sampleValues,g=this.valueSize;a*=g;b=(c-b)/(d-b);for(c=a+g;a!==c;a+=4)da.slerpFlat(e,0,f,a-g,f,a,b);return e}});Xc.prototype=Object.assign(Object.create(Ya),{constructor:Xc,ValueTypeName:"quaternion",DefaultInterpolation:2301,InterpolantFactoryMethodLinear:function(a){return new wd(this.times,this.values,this.getValueSize(),a)},InterpolantFactoryMethodSmooth:void 0});
dc.prototype=Object.assign(Object.create(Ya),{constructor:dc,ValueTypeName:"number"});xd.prototype=Object.assign(Object.create(Ya),{constructor:xd,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0});yd.prototype=Object.assign(Object.create(Ya),{constructor:yd,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0});
zd.prototype=Object.assign(Object.create(Ya),{constructor:zd,ValueTypeName:"color"});vb.prototype=Ya;Ya.constructor=vb;Object.assign(vb,{parse:function(a){if(void 0===a.type)throw Error("track type undefined, can not parse");var b=vb._getTrackTypeForValueTypeName(a.type);if(void 0===a.times){var c=[],d=[];ba.flattenJSON(a.keys,c,d,"value");a.times=c;a.values=d}return void 0!==b.parse?b.parse(a):new b(a.name,a.times,a.values,a.interpolation)},toJSON:function(a){var b=a.constructor;if(void 0!==b.toJSON)b=
b.toJSON(a);else{var b={name:a.name,times:ba.convertArray(a.times,Array),values:ba.convertArray(a.values,Array)},c=a.getInterpolation();c!==a.DefaultInterpolation&&(b.interpolation=c)}b.type=a.ValueTypeName;return b},_getTrackTypeForValueTypeName:function(a){switch(a.toLowerCase()){case "scalar":case "double":case "float":case "number":case "integer":return dc;case "vector":case "vector2":case "vector3":case "vector4":return cc;case "color":return zd;case "quaternion":return Xc;case "bool":case "boolean":return yd;
case "string":return xd}throw Error("Unsupported typeName: "+a);}});ta.prototype={constructor:ta,resetDuration:function(){for(var a=0,b=0,c=this.tracks.length;b!==c;++b)var d=this.tracks[b],a=Math.max(a,d.times[d.times.length-1]);this.duration=a},trim:function(){for(var a=0;a<this.tracks.length;a++)this.tracks[a].trim(0,this.duration);return this},optimize:function(){for(var a=0;a<this.tracks.length;a++)this.tracks[a].optimize();return this}};Object.assign(ta,{parse:function(a){for(var b=[],c=a.tracks,
d=1/(a.fps||1),e=0,f=c.length;e!==f;++e)b.push(vb.parse(c[e]).scale(d));return new ta(a.name,a.duration,b)},toJSON:function(a){var b=[],c=a.tracks;a={name:a.name,duration:a.duration,tracks:b};for(var d=0,e=c.length;d!==e;++d)b.push(vb.toJSON(c[d]));return a},CreateFromMorphTargetSequence:function(a,b,c,d){for(var e=b.length,f=[],g=0;g<e;g++){var h=[],k=[];h.push((g+e-1)%e,g,(g+1)%e);k.push(0,1,0);var m=ba.getKeyframeOrder(h),h=ba.sortedArray(h,1,m),k=ba.sortedArray(k,1,m);d||0!==h[0]||(h.push(e),
k.push(k[0]));f.push((new dc(".morphTargetInfluences["+b[g].name+"]",h,k)).scale(1/c))}return new ta(a,-1,f)},findByName:function(a,b){var c=a;Array.isArray(a)||(c=a.geometry&&a.geometry.animations||a.animations);for(var d=0;d<c.length;d++)if(c[d].name===b)return c[d];return null},CreateClipsFromMorphTargetSequences:function(a,b,c){for(var d={},e=/^([\w-]*?)([\d]+)$/,f=0,g=a.length;f<g;f++){var h=a[f],k=h.name.match(e);if(k&&1<k.length){var m=k[1];(k=d[m])||(d[m]=k=[]);k.push(h)}}a=[];for(m in d)a.push(ta.CreateFromMorphTargetSequence(m,
d[m],b,c));return a},parseAnimation:function(a,b){if(!a)return console.error("  no animation in JSONLoader data"),null;for(var c=function(a,b,c,d,e){if(0!==c.length){var f=[],g=[];ba.flattenJSON(c,f,g,d);0!==f.length&&e.push(new a(b,f,g))}},d=[],e=a.name||"default",f=a.length||-1,g=a.fps||30,h=a.hierarchy||[],k=0;k<h.length;k++){var m=h[k].keys;if(m&&0!==m.length)if(m[0].morphTargets){for(var f={},l=0;l<m.length;l++)if(m[l].morphTargets)for(var p=0;p<m[l].morphTargets.length;p++)f[m[l].morphTargets[p]]=
-1;for(var n in f){for(var q=[],w=[],p=0;p!==m[l].morphTargets.length;++p){var u=m[l];q.push(u.time);w.push(u.morphTarget===n?1:0)}d.push(new dc(".morphTargetInfluence["+n+"]",q,w))}f=f.length*(g||1)}else l=".bones["+b[k].name+"]",c(cc,l+".position",m,"pos",d),c(Xc,l+".quaternion",m,"rot",d),c(cc,l+".scale",m,"scl",d)}return 0===d.length?null:new ta(e,f,d)}});Object.assign(Ad.prototype,{load:function(a,b,c,d){var e=this;(new Ma(e.manager)).load(a,function(a){b(e.parse(JSON.parse(a)))},c,d)},setTextures:function(a){this.textures=
a},parse:function(a){function b(a){void 0===c[a]&&console.warn("THREE.MaterialLoader: Undefined texture",a);return c[a]}var c=this.textures,d=new Mf[a.type];void 0!==a.uuid&&(d.uuid=a.uuid);void 0!==a.name&&(d.name=a.name);void 0!==a.color&&d.color.setHex(a.color);void 0!==a.roughness&&(d.roughness=a.roughness);void 0!==a.metalness&&(d.metalness=a.metalness);void 0!==a.emissive&&d.emissive.setHex(a.emissive);void 0!==a.specular&&d.specular.setHex(a.specular);void 0!==a.shininess&&(d.shininess=a.shininess);
void 0!==a.clearCoat&&(d.clearCoat=a.clearCoat);void 0!==a.clearCoatRoughness&&(d.clearCoatRoughness=a.clearCoatRoughness);void 0!==a.uniforms&&(d.uniforms=a.uniforms);void 0!==a.vertexShader&&(d.vertexShader=a.vertexShader);void 0!==a.fragmentShader&&(d.fragmentShader=a.fragmentShader);void 0!==a.vertexColors&&(d.vertexColors=a.vertexColors);void 0!==a.fog&&(d.fog=a.fog);void 0!==a.shading&&(d.shading=a.shading);void 0!==a.blending&&(d.blending=a.blending);void 0!==a.side&&(d.side=a.side);void 0!==
a.opacity&&(d.opacity=a.opacity);void 0!==a.transparent&&(d.transparent=a.transparent);void 0!==a.alphaTest&&(d.alphaTest=a.alphaTest);void 0!==a.depthTest&&(d.depthTest=a.depthTest);void 0!==a.depthWrite&&(d.depthWrite=a.depthWrite);void 0!==a.colorWrite&&(d.colorWrite=a.colorWrite);void 0!==a.wireframe&&(d.wireframe=a.wireframe);void 0!==a.wireframeLinewidth&&(d.wireframeLinewidth=a.wireframeLinewidth);void 0!==a.wireframeLinecap&&(d.wireframeLinecap=a.wireframeLinecap);void 0!==a.wireframeLinejoin&&
(d.wireframeLinejoin=a.wireframeLinejoin);void 0!==a.skinning&&(d.skinning=a.skinning);void 0!==a.morphTargets&&(d.morphTargets=a.morphTargets);void 0!==a.size&&(d.size=a.size);void 0!==a.sizeAttenuation&&(d.sizeAttenuation=a.sizeAttenuation);void 0!==a.map&&(d.map=b(a.map));void 0!==a.alphaMap&&(d.alphaMap=b(a.alphaMap),d.transparent=!0);void 0!==a.bumpMap&&(d.bumpMap=b(a.bumpMap));void 0!==a.bumpScale&&(d.bumpScale=a.bumpScale);void 0!==a.normalMap&&(d.normalMap=b(a.normalMap));if(void 0!==a.normalScale){var e=
a.normalScale;!1===Array.isArray(e)&&(e=[e,e]);d.normalScale=(new C).fromArray(e)}void 0!==a.displacementMap&&(d.displacementMap=b(a.displacementMap));void 0!==a.displacementScale&&(d.displacementScale=a.displacementScale);void 0!==a.displacementBias&&(d.displacementBias=a.displacementBias);void 0!==a.roughnessMap&&(d.roughnessMap=b(a.roughnessMap));void 0!==a.metalnessMap&&(d.metalnessMap=b(a.metalnessMap));void 0!==a.emissiveMap&&(d.emissiveMap=b(a.emissiveMap));void 0!==a.emissiveIntensity&&(d.emissiveIntensity=
a.emissiveIntensity);void 0!==a.specularMap&&(d.specularMap=b(a.specularMap));void 0!==a.envMap&&(d.envMap=b(a.envMap));void 0!==a.reflectivity&&(d.reflectivity=a.reflectivity);void 0!==a.lightMap&&(d.lightMap=b(a.lightMap));void 0!==a.lightMapIntensity&&(d.lightMapIntensity=a.lightMapIntensity);void 0!==a.aoMap&&(d.aoMap=b(a.aoMap));void 0!==a.aoMapIntensity&&(d.aoMapIntensity=a.aoMapIntensity);void 0!==a.gradientMap&&(d.gradientMap=b(a.gradientMap));if(void 0!==a.materials)for(var e=0,f=a.materials.length;e<
f;e++)d.materials.push(this.parse(a.materials[e]));return d}});Object.assign(Sd.prototype,{load:function(a,b,c,d){var e=this;(new Ma(e.manager)).load(a,function(a){b(e.parse(JSON.parse(a)))},c,d)},parse:function(a){var b=new D,c=a.data.index,d={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};void 0!==c&&(c=new d[c.type](c.array),
b.setIndex(new y(c,1)));var e=a.data.attributes,f;for(f in e){var g=e[f],c=new d[g.type](g.array);b.addAttribute(f,new y(c,g.itemSize,g.normalized))}d=a.data.groups||a.data.drawcalls||a.data.offsets;if(void 0!==d)for(f=0,c=d.length;f!==c;++f)e=d[f],b.addGroup(e.start,e.count,e.materialIndex);a=a.data.boundingSphere;void 0!==a&&(d=new q,void 0!==a.center&&d.fromArray(a.center),b.boundingSphere=new Fa(d,a.radius));return b}});wb.prototype={constructor:wb,crossOrigin:void 0,extractUrlBase:function(a){a=
a.split("/");if(1===a.length)return"./";a.pop();return a.join("/")+"/"},initMaterials:function(a,b,c){for(var d=[],e=0;e<a.length;++e)d[e]=this.createMaterial(a[e],b,c);return d},createMaterial:function(){var a,b,c;return function(d,e,f){function g(a,c,d,g,k){a=e+a;var m=wb.Handlers.get(a);null!==m?a=m.load(a):(b.setCrossOrigin(f),a=b.load(a));void 0!==c&&(a.repeat.fromArray(c),1!==c[0]&&(a.wrapS=1E3),1!==c[1]&&(a.wrapT=1E3));void 0!==d&&a.offset.fromArray(d);void 0!==g&&("repeat"===g[0]&&(a.wrapS=
1E3),"mirror"===g[0]&&(a.wrapS=1002),"repeat"===g[1]&&(a.wrapT=1E3),"mirror"===g[1]&&(a.wrapT=1002));void 0!==k&&(a.anisotropy=k);c=Q.generateUUID();h[c]=a;return c}void 0===a&&(a=new N);void 0===b&&(b=new md);void 0===c&&(c=new Ad);var h={},k={uuid:Q.generateUUID(),type:"MeshLambertMaterial"},m;for(m in d){var l=d[m];switch(m){case "DbgColor":case "DbgIndex":case "opticalDensity":case "illumination":break;case "DbgName":k.name=l;break;case "blending":k.blending=Me[l];break;case "colorAmbient":case "mapAmbient":console.warn("THREE.Loader.createMaterial:",
m,"is no longer supported.");break;case "colorDiffuse":k.color=a.fromArray(l).getHex();break;case "colorSpecular":k.specular=a.fromArray(l).getHex();break;case "colorEmissive":k.emissive=a.fromArray(l).getHex();break;case "specularCoef":k.shininess=l;break;case "shading":"basic"===l.toLowerCase()&&(k.type="MeshBasicMaterial");"phong"===l.toLowerCase()&&(k.type="MeshPhongMaterial");"standard"===l.toLowerCase()&&(k.type="MeshStandardMaterial");break;case "mapDiffuse":k.map=g(l,d.mapDiffuseRepeat,d.mapDiffuseOffset,
d.mapDiffuseWrap,d.mapDiffuseAnisotropy);break;case "mapDiffuseRepeat":case "mapDiffuseOffset":case "mapDiffuseWrap":case "mapDiffuseAnisotropy":break;case "mapEmissive":k.emissiveMap=g(l,d.mapEmissiveRepeat,d.mapEmissiveOffset,d.mapEmissiveWrap,d.mapEmissiveAnisotropy);break;case "mapEmissiveRepeat":case "mapEmissiveOffset":case "mapEmissiveWrap":case "mapEmissiveAnisotropy":break;case "mapLight":k.lightMap=g(l,d.mapLightRepeat,d.mapLightOffset,d.mapLightWrap,d.mapLightAnisotropy);break;case "mapLightRepeat":case "mapLightOffset":case "mapLightWrap":case "mapLightAnisotropy":break;
case "mapAO":k.aoMap=g(l,d.mapAORepeat,d.mapAOOffset,d.mapAOWrap,d.mapAOAnisotropy);break;case "mapAORepeat":case "mapAOOffset":case "mapAOWrap":case "mapAOAnisotropy":break;case "mapBump":k.bumpMap=g(l,d.mapBumpRepeat,d.mapBumpOffset,d.mapBumpWrap,d.mapBumpAnisotropy);break;case "mapBumpScale":k.bumpScale=l;break;case "mapBumpRepeat":case "mapBumpOffset":case "mapBumpWrap":case "mapBumpAnisotropy":break;case "mapNormal":k.normalMap=g(l,d.mapNormalRepeat,d.mapNormalOffset,d.mapNormalWrap,d.mapNormalAnisotropy);
break;case "mapNormalFactor":k.normalScale=[l,l];break;case "mapNormalRepeat":case "mapNormalOffset":case "mapNormalWrap":case "mapNormalAnisotropy":break;case "mapSpecular":k.specularMap=g(l,d.mapSpecularRepeat,d.mapSpecularOffset,d.mapSpecularWrap,d.mapSpecularAnisotropy);break;case "mapSpecularRepeat":case "mapSpecularOffset":case "mapSpecularWrap":case "mapSpecularAnisotropy":break;case "mapMetalness":k.metalnessMap=g(l,d.mapMetalnessRepeat,d.mapMetalnessOffset,d.mapMetalnessWrap,d.mapMetalnessAnisotropy);
break;case "mapMetalnessRepeat":case "mapMetalnessOffset":case "mapMetalnessWrap":case "mapMetalnessAnisotropy":break;case "mapRoughness":k.roughnessMap=g(l,d.mapRoughnessRepeat,d.mapRoughnessOffset,d.mapRoughnessWrap,d.mapRoughnessAnisotropy);break;case "mapRoughnessRepeat":case "mapRoughnessOffset":case "mapRoughnessWrap":case "mapRoughnessAnisotropy":break;case "mapAlpha":k.alphaMap=g(l,d.mapAlphaRepeat,d.mapAlphaOffset,d.mapAlphaWrap,d.mapAlphaAnisotropy);break;case "mapAlphaRepeat":case "mapAlphaOffset":case "mapAlphaWrap":case "mapAlphaAnisotropy":break;
case "flipSided":k.side=1;break;case "doubleSided":k.side=2;break;case "transparency":console.warn("THREE.Loader.createMaterial: transparency has been renamed to opacity");k.opacity=l;break;case "depthTest":case "depthWrite":case "colorWrite":case "opacity":case "reflectivity":case "transparent":case "visible":case "wireframe":k[m]=l;break;case "vertexColors":!0===l&&(k.vertexColors=2);"face"===l&&(k.vertexColors=1);break;default:console.error("THREE.Loader.createMaterial: Unsupported",m,l)}}"MeshBasicMaterial"===
k.type&&delete k.emissive;"MeshPhongMaterial"!==k.type&&delete k.specular;1>k.opacity&&(k.transparent=!0);c.setTextures(h);return c.parse(k)}}()};wb.Handlers={handlers:[],add:function(a,b){this.handlers.push(a,b)},get:function(a){for(var b=this.handlers,c=0,d=b.length;c<d;c+=2){var e=b[c+1];if(b[c].test(a))return e}return null}};Object.assign(Td.prototype,{load:function(a,b,c,d){var e=this,f=this.texturePath&&"string"===typeof this.texturePath?this.texturePath:wb.prototype.extractUrlBase(a),g=new Ma(this.manager);
g.setWithCredentials(this.withCredentials);g.load(a,function(c){c=JSON.parse(c);var d=c.metadata;if(void 0!==d&&(d=d.type,void 0!==d)){if("object"===d.toLowerCase()){console.error("THREE.JSONLoader: "+a+" should be loaded with THREE.ObjectLoader instead.");return}if("scene"===d.toLowerCase()){console.error("THREE.JSONLoader: "+a+" should be loaded with THREE.SceneLoader instead.");return}}c=e.parse(c,f);b(c.geometry,c.materials)},c,d)},setTexturePath:function(a){this.texturePath=a},parse:function(a,
b){var c=new S,d=void 0!==a.scale?1/a.scale:1;(function(b){var d,g,h,k,m,l,p,n,r,w,u,F,t,v=a.faces;l=a.vertices;var y=a.normals,z=a.colors,A=0;if(void 0!==a.uvs){for(d=0;d<a.uvs.length;d++)a.uvs[d].length&&A++;for(d=0;d<A;d++)c.faceVertexUvs[d]=[]}k=0;for(m=l.length;k<m;)d=new q,d.x=l[k++]*b,d.y=l[k++]*b,d.z=l[k++]*b,c.vertices.push(d);k=0;for(m=v.length;k<m;)if(b=v[k++],r=b&1,h=b&2,d=b&8,p=b&16,w=b&32,l=b&64,b&=128,r){r=new ha;r.a=v[k];r.b=v[k+1];r.c=v[k+3];u=new ha;u.a=v[k+1];u.b=v[k+2];u.c=v[k+
3];k+=4;h&&(h=v[k++],r.materialIndex=h,u.materialIndex=h);h=c.faces.length;if(d)for(d=0;d<A;d++)for(F=a.uvs[d],c.faceVertexUvs[d][h]=[],c.faceVertexUvs[d][h+1]=[],g=0;4>g;g++)n=v[k++],t=F[2*n],n=F[2*n+1],t=new C(t,n),2!==g&&c.faceVertexUvs[d][h].push(t),0!==g&&c.faceVertexUvs[d][h+1].push(t);p&&(p=3*v[k++],r.normal.set(y[p++],y[p++],y[p]),u.normal.copy(r.normal));if(w)for(d=0;4>d;d++)p=3*v[k++],w=new q(y[p++],y[p++],y[p]),2!==d&&r.vertexNormals.push(w),0!==d&&u.vertexNormals.push(w);l&&(l=v[k++],
l=z[l],r.color.setHex(l),u.color.setHex(l));if(b)for(d=0;4>d;d++)l=v[k++],l=z[l],2!==d&&r.vertexColors.push(new N(l)),0!==d&&u.vertexColors.push(new N(l));c.faces.push(r);c.faces.push(u)}else{r=new ha;r.a=v[k++];r.b=v[k++];r.c=v[k++];h&&(h=v[k++],r.materialIndex=h);h=c.faces.length;if(d)for(d=0;d<A;d++)for(F=a.uvs[d],c.faceVertexUvs[d][h]=[],g=0;3>g;g++)n=v[k++],t=F[2*n],n=F[2*n+1],t=new C(t,n),c.faceVertexUvs[d][h].push(t);p&&(p=3*v[k++],r.normal.set(y[p++],y[p++],y[p]));if(w)for(d=0;3>d;d++)p=3*
v[k++],w=new q(y[p++],y[p++],y[p]),r.vertexNormals.push(w);l&&(l=v[k++],r.color.setHex(z[l]));if(b)for(d=0;3>d;d++)l=v[k++],r.vertexColors.push(new N(z[l]));c.faces.push(r)}})(d);(function(){var b=void 0!==a.influencesPerVertex?a.influencesPerVertex:2;if(a.skinWeights)for(var d=0,g=a.skinWeights.length;d<g;d+=b)c.skinWeights.push(new ga(a.skinWeights[d],1<b?a.skinWeights[d+1]:0,2<b?a.skinWeights[d+2]:0,3<b?a.skinWeights[d+3]:0));if(a.skinIndices)for(d=0,g=a.skinIndices.length;d<g;d+=b)c.skinIndices.push(new ga(a.skinIndices[d],
1<b?a.skinIndices[d+1]:0,2<b?a.skinIndices[d+2]:0,3<b?a.skinIndices[d+3]:0));c.bones=a.bones;c.bones&&0<c.bones.length&&(c.skinWeights.length!==c.skinIndices.length||c.skinIndices.length!==c.vertices.length)&&console.warn("When skinning, number of vertices ("+c.vertices.length+"), skinIndices ("+c.skinIndices.length+"), and skinWeights ("+c.skinWeights.length+") should match.")})();(function(b){if(void 0!==a.morphTargets)for(var d=0,g=a.morphTargets.length;d<g;d++){c.morphTargets[d]={};c.morphTargets[d].name=
a.morphTargets[d].name;c.morphTargets[d].vertices=[];for(var h=c.morphTargets[d].vertices,k=a.morphTargets[d].vertices,m=0,l=k.length;m<l;m+=3){var p=new q;p.x=k[m]*b;p.y=k[m+1]*b;p.z=k[m+2]*b;h.push(p)}}if(void 0!==a.morphColors&&0<a.morphColors.length)for(console.warn('THREE.JSONLoader: "morphColors" no longer supported. Using them as face colors.'),b=c.faces,h=a.morphColors[0].colors,d=0,g=b.length;d<g;d++)b[d].color.fromArray(h,3*d)})(d);(function(){var b=[],d=[];void 0!==a.animation&&d.push(a.animation);
void 0!==a.animations&&(a.animations.length?d=d.concat(a.animations):d.push(a.animations));for(var g=0;g<d.length;g++){var h=ta.parseAnimation(d[g],c.bones);h&&b.push(h)}c.morphTargets&&(d=ta.CreateClipsFromMorphTargetSequences(c.morphTargets,10),b=b.concat(d));0<b.length&&(c.animations=b)})();c.computeFaceNormals();c.computeBoundingSphere();if(void 0===a.materials||0===a.materials.length)return{geometry:c};d=wb.prototype.initMaterials(a.materials,b,this.crossOrigin);return{geometry:c,materials:d}}});
Object.assign(Fe.prototype,{load:function(a,b,c,d){""===this.texturePath&&(this.texturePath=a.substring(0,a.lastIndexOf("/")+1));var e=this;(new Ma(e.manager)).load(a,function(c){var d=null;try{d=JSON.parse(c)}catch(h){console.error("THREE:ObjectLoader: Can't parse "+a+".",h.message);return}c=d.metadata;void 0===c||void 0===c.type||"geometry"===c.type.toLowerCase()?console.error("THREE.ObjectLoader: Can't load "+a+". Use THREE.JSONLoader instead."):e.parse(d,b)},c,d)},setTexturePath:function(a){this.texturePath=
a},setCrossOrigin:function(a){this.crossOrigin=a},parse:function(a,b){var c=this.parseGeometries(a.geometries),d=this.parseImages(a.images,function(){void 0!==b&&b(e)}),d=this.parseTextures(a.textures,d),d=this.parseMaterials(a.materials,d),e=this.parseObject(a.object,c,d);a.animations&&(e.animations=this.parseAnimations(a.animations));void 0!==a.images&&0!==a.images.length||void 0===b||b(e);return e},parseGeometries:function(a){var b={};if(void 0!==a)for(var c=new Td,d=new Sd,e=0,f=a.length;e<f;e++){var g,
h=a[e];switch(h.type){case "PlaneGeometry":case "PlaneBufferGeometry":g=new Ea[h.type](h.width,h.height,h.widthSegments,h.heightSegments);break;case "BoxGeometry":case "BoxBufferGeometry":case "CubeGeometry":g=new Ea[h.type](h.width,h.height,h.depth,h.widthSegments,h.heightSegments,h.depthSegments);break;case "CircleGeometry":case "CircleBufferGeometry":g=new Ea[h.type](h.radius,h.segments,h.thetaStart,h.thetaLength);break;case "CylinderGeometry":case "CylinderBufferGeometry":g=new Ea[h.type](h.radiusTop,
h.radiusBottom,h.height,h.radialSegments,h.heightSegments,h.openEnded,h.thetaStart,h.thetaLength);break;case "ConeGeometry":case "ConeBufferGeometry":g=new Ea[h.type](h.radius,h.height,h.radialSegments,h.heightSegments,h.openEnded,h.thetaStart,h.thetaLength);break;case "SphereGeometry":case "SphereBufferGeometry":g=new Ea[h.type](h.radius,h.widthSegments,h.heightSegments,h.phiStart,h.phiLength,h.thetaStart,h.thetaLength);break;case "DodecahedronGeometry":case "IcosahedronGeometry":case "OctahedronGeometry":case "TetrahedronGeometry":g=
new Ea[h.type](h.radius,h.detail);break;case "RingGeometry":case "RingBufferGeometry":g=new Ea[h.type](h.innerRadius,h.outerRadius,h.thetaSegments,h.phiSegments,h.thetaStart,h.thetaLength);break;case "TorusGeometry":case "TorusBufferGeometry":g=new Ea[h.type](h.radius,h.tube,h.radialSegments,h.tubularSegments,h.arc);break;case "TorusKnotGeometry":case "TorusKnotBufferGeometry":g=new Ea[h.type](h.radius,h.tube,h.tubularSegments,h.radialSegments,h.p,h.q);break;case "LatheGeometry":case "LatheBufferGeometry":g=
new Ea[h.type](h.points,h.segments,h.phiStart,h.phiLength);break;case "BufferGeometry":g=d.parse(h);break;case "Geometry":g=c.parse(h.data,this.texturePath).geometry;break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+h.type+'"');continue}g.uuid=h.uuid;void 0!==h.name&&(g.name=h.name);b[h.uuid]=g}return b},parseMaterials:function(a,b){var c={};if(void 0!==a){var d=new Ad;d.setTextures(b);for(var e=0,f=a.length;e<f;e++){var g=d.parse(a[e]);c[g.uuid]=g}}return c},parseAnimations:function(a){for(var b=
[],c=0;c<a.length;c++){var d=ta.parse(a[c]);b.push(d)}return b},parseImages:function(a,b){function c(a){d.manager.itemStart(a);return g.load(a,function(){d.manager.itemEnd(a)},void 0,function(){d.manager.itemError(a)})}var d=this,e={};if(void 0!==a&&0<a.length){var f=new Pd(b),g=new Vc(f);g.setCrossOrigin(this.crossOrigin);for(var f=0,h=a.length;f<h;f++){var k=a[f],m=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(k.url)?k.url:d.texturePath+k.url;e[k.uuid]=c(m)}}return e},parseTextures:function(a,b){function c(a,
b){if("number"===typeof a)return a;console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",a);return b[a]}var d={};if(void 0!==a)for(var e=0,f=a.length;e<f;e++){var g=a[e];void 0===g.image&&console.warn('THREE.ObjectLoader: No "image" specified for',g.uuid);void 0===b[g.image]&&console.warn("THREE.ObjectLoader: Undefined image",g.image);var h=new ea(b[g.image]);h.needsUpdate=!0;h.uuid=g.uuid;void 0!==g.name&&(h.name=g.name);void 0!==g.mapping&&(h.mapping=c(g.mapping,Ne));
void 0!==g.offset&&h.offset.fromArray(g.offset);void 0!==g.repeat&&h.repeat.fromArray(g.repeat);void 0!==g.wrap&&(h.wrapS=c(g.wrap[0],le),h.wrapT=c(g.wrap[1],le));void 0!==g.minFilter&&(h.minFilter=c(g.minFilter,me));void 0!==g.magFilter&&(h.magFilter=c(g.magFilter,me));void 0!==g.anisotropy&&(h.anisotropy=g.anisotropy);void 0!==g.flipY&&(h.flipY=g.flipY);d[g.uuid]=h}return d},parseObject:function(){var a=new H;return function(b,c,d){function e(a){void 0===c[a]&&console.warn("THREE.ObjectLoader: Undefined geometry",
a);return c[a]}function f(a){if(void 0!==a)return void 0===d[a]&&console.warn("THREE.ObjectLoader: Undefined material",a),d[a]}var g;switch(b.type){case "Scene":g=new jb;void 0!==b.background&&Number.isInteger(b.background)&&(g.background=new N(b.background));void 0!==b.fog&&("Fog"===b.fog.type?g.fog=new Jb(b.fog.color,b.fog.near,b.fog.far):"FogExp2"===b.fog.type&&(g.fog=new Ib(b.fog.color,b.fog.density)));break;case "PerspectiveCamera":g=new Ha(b.fov,b.aspect,b.near,b.far);void 0!==b.focus&&(g.focus=
b.focus);void 0!==b.zoom&&(g.zoom=b.zoom);void 0!==b.filmGauge&&(g.filmGauge=b.filmGauge);void 0!==b.filmOffset&&(g.filmOffset=b.filmOffset);void 0!==b.view&&(g.view=Object.assign({},b.view));break;case "OrthographicCamera":g=new Hb(b.left,b.right,b.top,b.bottom,b.near,b.far);break;case "AmbientLight":g=new td(b.color,b.intensity);break;case "DirectionalLight":g=new sd(b.color,b.intensity);break;case "PointLight":g=new qd(b.color,b.intensity,b.distance,b.decay);break;case "SpotLight":g=new pd(b.color,
b.intensity,b.distance,b.angle,b.penumbra,b.decay);break;case "HemisphereLight":g=new nd(b.color,b.groundColor,b.intensity);break;case "Mesh":g=e(b.geometry);var h=f(b.material);g=g.bones&&0<g.bones.length?new jd(g,h):new Ba(g,h);break;case "LOD":g=new Ac;break;case "Line":g=new Va(e(b.geometry),f(b.material),b.mode);break;case "LineSegments":g=new fa(e(b.geometry),f(b.material));break;case "PointCloud":case "Points":g=new Kb(e(b.geometry),f(b.material));break;case "Sprite":g=new zc(f(b.material));
break;case "Group":g=new Bc;break;case "SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh type. Instantiates Object3D instead.");default:g=new G}g.uuid=b.uuid;void 0!==b.name&&(g.name=b.name);void 0!==b.matrix?(a.fromArray(b.matrix),a.decompose(g.position,g.quaternion,g.scale)):(void 0!==b.position&&g.position.fromArray(b.position),void 0!==b.rotation&&g.rotation.fromArray(b.rotation),void 0!==b.quaternion&&g.quaternion.fromArray(b.quaternion),void 0!==b.scale&&
g.scale.fromArray(b.scale));void 0!==b.castShadow&&(g.castShadow=b.castShadow);void 0!==b.receiveShadow&&(g.receiveShadow=b.receiveShadow);b.shadow&&(void 0!==b.shadow.bias&&(g.shadow.bias=b.shadow.bias),void 0!==b.shadow.radius&&(g.shadow.radius=b.shadow.radius),void 0!==b.shadow.mapSize&&g.shadow.mapSize.fromArray(b.shadow.mapSize),void 0!==b.shadow.camera&&(g.shadow.camera=this.parseObject(b.shadow.camera)));void 0!==b.visible&&(g.visible=b.visible);void 0!==b.userData&&(g.userData=b.userData);
if(void 0!==b.children)for(var k in b.children)g.add(this.parseObject(b.children[k],c,d));if("LOD"===b.type)for(b=b.levels,h=0;h<b.length;h++){var m=b[h];k=g.getObjectByProperty("uuid",m.object);void 0!==k&&g.addLevel(k,m.distance)}return g}}()});wa.prototype={constructor:wa,getPoint:function(a){console.warn("THREE.Curve: Warning, getPoint() not implemented!");return null},getPointAt:function(a){a=this.getUtoTmapping(a);return this.getPoint(a)},getPoints:function(a){a||(a=5);for(var b=[],c=0;c<=a;c++)b.push(this.getPoint(c/
a));return b},getSpacedPoints:function(a){a||(a=5);for(var b=[],c=0;c<=a;c++)b.push(this.getPointAt(c/a));return b},getLength:function(){var a=this.getLengths();return a[a.length-1]},getLengths:function(a){a||(a=this.__arcLengthDivisions?this.__arcLengthDivisions:200);if(this.cacheArcLengths&&this.cacheArcLengths.length===a+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var b=[],c,d=this.getPoint(0),e,f=0;b.push(0);for(e=1;e<=a;e++)c=this.getPoint(e/a),f+=c.distanceTo(d),b.push(f),
d=c;return this.cacheArcLengths=b},updateArcLengths:function(){this.needsUpdate=!0;this.getLengths()},getUtoTmapping:function(a,b){var c=this.getLengths(),d,e=c.length,f;f=b?b:a*c[e-1];for(var g=0,h=e-1,k;g<=h;)if(d=Math.floor(g+(h-g)/2),k=c[d]-f,0>k)g=d+1;else if(0<k)h=d-1;else{h=d;break}d=h;if(c[d]===f)return d/(e-1);g=c[d];return(d+(f-g)/(c[d+1]-g))/(e-1)},getTangent:function(a){var b=a-1E-4;a+=1E-4;0>b&&(b=0);1<a&&(a=1);b=this.getPoint(b);return this.getPoint(a).clone().sub(b).normalize()},getTangentAt:function(a){a=
this.getUtoTmapping(a);return this.getTangent(a)},computeFrenetFrames:function(a,b){var c=new q,d=[],e=[],f=[],g=new q,h=new H,k,m;for(k=0;k<=a;k++)m=k/a,d[k]=this.getTangentAt(m),d[k].normalize();e[0]=new q;f[0]=new q;k=Number.MAX_VALUE;m=Math.abs(d[0].x);var l=Math.abs(d[0].y),p=Math.abs(d[0].z);m<=k&&(k=m,c.set(1,0,0));l<=k&&(k=l,c.set(0,1,0));p<=k&&c.set(0,0,1);g.crossVectors(d[0],c).normalize();e[0].crossVectors(d[0],g);f[0].crossVectors(d[0],e[0]);for(k=1;k<=a;k++)e[k]=e[k-1].clone(),f[k]=f[k-
1].clone(),g.crossVectors(d[k-1],d[k]),g.length()>Number.EPSILON&&(g.normalize(),c=Math.acos(Q.clamp(d[k-1].dot(d[k]),-1,1)),e[k].applyMatrix4(h.makeRotationAxis(g,c))),f[k].crossVectors(d[k],e[k]);if(!0===b)for(c=Math.acos(Q.clamp(e[0].dot(e[a]),-1,1)),c/=a,0<d[0].dot(g.crossVectors(e[0],e[a]))&&(c=-c),k=1;k<=a;k++)e[k].applyMatrix4(h.makeRotationAxis(d[k],c*k)),f[k].crossVectors(d[k],e[k]);return{tangents:d,normals:e,binormals:f}}};wa.create=function(a,b){a.prototype=Object.create(wa.prototype);
a.prototype.constructor=a;a.prototype.getPoint=b;return a};Qa.prototype=Object.create(wa.prototype);Qa.prototype.constructor=Qa;Qa.prototype.isLineCurve=!0;Qa.prototype.getPoint=function(a){if(1===a)return this.v2.clone();var b=this.v2.clone().sub(this.v1);b.multiplyScalar(a).add(this.v1);return b};Qa.prototype.getPointAt=function(a){return this.getPoint(a)};Qa.prototype.getTangent=function(a){return this.v2.clone().sub(this.v1).normalize()};Yc.prototype=Object.assign(Object.create(wa.prototype),
{constructor:Yc,add:function(a){this.curves.push(a)},closePath:function(){var a=this.curves[0].getPoint(0),b=this.curves[this.curves.length-1].getPoint(1);a.equals(b)||this.curves.push(new Qa(b,a))},getPoint:function(a){var b=a*this.getLength(),c=this.getCurveLengths();for(a=0;a<c.length;){if(c[a]>=b)return b=c[a]-b,a=this.curves[a],c=a.getLength(),a.getPointAt(0===c?0:1-b/c);a++}return null},getLength:function(){var a=this.getCurveLengths();return a[a.length-1]},updateArcLengths:function(){this.needsUpdate=
!0;this.cacheLengths=null;this.getLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var a=[],b=0,c=0,d=this.curves.length;c<d;c++)b+=this.curves[c].getLength(),a.push(b);return this.cacheLengths=a},getSpacedPoints:function(a){a||(a=40);for(var b=[],c=0;c<=a;c++)b.push(this.getPoint(c/a));this.autoClose&&b.push(b[0]);return b},getPoints:function(a){a=a||12;for(var b=[],c,d=0,e=this.curves;d<e.length;d++)for(var f=
e[d],f=f.getPoints(f&&f.isEllipseCurve?2*a:f&&f.isLineCurve?1:f&&f.isSplineCurve?a*f.points.length:a),g=0;g<f.length;g++){var h=f[g];c&&c.equals(h)||(b.push(h),c=h)}this.autoClose&&1<b.length&&!b[b.length-1].equals(b[0])&&b.push(b[0]);return b},createPointsGeometry:function(a){a=this.getPoints(a);return this.createGeometry(a)},createSpacedPointsGeometry:function(a){a=this.getSpacedPoints(a);return this.createGeometry(a)},createGeometry:function(a){for(var b=new S,c=0,d=a.length;c<d;c++){var e=a[c];
b.vertices.push(new q(e.x,e.y,e.z||0))}return b}});Xa.prototype=Object.create(wa.prototype);Xa.prototype.constructor=Xa;Xa.prototype.isEllipseCurve=!0;Xa.prototype.getPoint=function(a){for(var b=2*Math.PI,c=this.aEndAngle-this.aStartAngle,d=Math.abs(c)<Number.EPSILON;0>c;)c+=b;for(;c>b;)c-=b;c<Number.EPSILON&&(c=d?0:b);!0!==this.aClockwise||d||(c=c===b?-b:c-b);b=this.aStartAngle+a*c;a=this.aX+this.xRadius*Math.cos(b);var e=this.aY+this.yRadius*Math.sin(b);0!==this.aRotation&&(b=Math.cos(this.aRotation),
c=Math.sin(this.aRotation),d=a-this.aX,e-=this.aY,a=d*b-e*c+this.aX,e=d*c+e*b+this.aY);return new C(a,e)};var ed={tangentQuadraticBezier:function(a,b,c,d){return 2*(1-a)*(c-b)+2*a*(d-c)},tangentCubicBezier:function(a,b,c,d,e){return-3*b*(1-a)*(1-a)+3*c*(1-a)*(1-a)-6*a*c*(1-a)+6*a*d*(1-a)-3*a*a*d+3*a*a*e},tangentSpline:function(a,b,c,d,e){return 6*a*a-6*a+(3*a*a-4*a+1)+(-6*a*a+6*a)+(3*a*a-2*a)},interpolate:function(a,b,c,d,e){a=.5*(c-a);d=.5*(d-b);var f=e*e;return(2*b-2*c+a+d)*e*f+(-3*b+3*c-2*a-d)*
f+a*e+b}};xb.prototype=Object.create(wa.prototype);xb.prototype.constructor=xb;xb.prototype.isSplineCurve=!0;xb.prototype.getPoint=function(a){var b=this.points;a*=b.length-1;var c=Math.floor(a);a-=c;var d=b[0===c?c:c-1],e=b[c],f=b[c>b.length-2?b.length-1:c+1],b=b[c>b.length-3?b.length-1:c+2],c=ed.interpolate;return new C(c(d.x,e.x,f.x,b.x,a),c(d.y,e.y,f.y,b.y,a))};yb.prototype=Object.create(wa.prototype);yb.prototype.constructor=yb;yb.prototype.getPoint=function(a){var b=pa.b3;return new C(b(a,this.v0.x,
this.v1.x,this.v2.x,this.v3.x),b(a,this.v0.y,this.v1.y,this.v2.y,this.v3.y))};yb.prototype.getTangent=function(a){var b=ed.tangentCubicBezier;return(new C(b(a,this.v0.x,this.v1.x,this.v2.x,this.v3.x),b(a,this.v0.y,this.v1.y,this.v2.y,this.v3.y))).normalize()};zb.prototype=Object.create(wa.prototype);zb.prototype.constructor=zb;zb.prototype.getPoint=function(a){var b=pa.b2;return new C(b(a,this.v0.x,this.v1.x,this.v2.x),b(a,this.v0.y,this.v1.y,this.v2.y))};zb.prototype.getTangent=function(a){var b=
ed.tangentQuadraticBezier;return(new C(b(a,this.v0.x,this.v1.x,this.v2.x),b(a,this.v0.y,this.v1.y,this.v2.y))).normalize()};var oe=Object.assign(Object.create(Yc.prototype),{fromPoints:function(a){this.moveTo(a[0].x,a[0].y);for(var b=1,c=a.length;b<c;b++)this.lineTo(a[b].x,a[b].y)},moveTo:function(a,b){this.currentPoint.set(a,b)},lineTo:function(a,b){var c=new Qa(this.currentPoint.clone(),new C(a,b));this.curves.push(c);this.currentPoint.set(a,b)},quadraticCurveTo:function(a,b,c,d){a=new zb(this.currentPoint.clone(),
new C(a,b),new C(c,d));this.curves.push(a);this.currentPoint.set(c,d)},bezierCurveTo:function(a,b,c,d,e,f){a=new yb(this.currentPoint.clone(),new C(a,b),new C(c,d),new C(e,f));this.curves.push(a);this.currentPoint.set(e,f)},splineThru:function(a){var b=[this.currentPoint.clone()].concat(a),b=new xb(b);this.curves.push(b);this.currentPoint.copy(a[a.length-1])},arc:function(a,b,c,d,e,f){this.absarc(a+this.currentPoint.x,b+this.currentPoint.y,c,d,e,f)},absarc:function(a,b,c,d,e,f){this.absellipse(a,
b,c,c,d,e,f)},ellipse:function(a,b,c,d,e,f,g,h){this.absellipse(a+this.currentPoint.x,b+this.currentPoint.y,c,d,e,f,g,h)},absellipse:function(a,b,c,d,e,f,g,h){a=new Xa(a,b,c,d,e,f,g,h);0<this.curves.length&&(b=a.getPoint(0),b.equals(this.currentPoint)||this.lineTo(b.x,b.y));this.curves.push(a);a=a.getPoint(1);this.currentPoint.copy(a)}});Ab.prototype=Object.assign(Object.create(oe),{constructor:Ab,getPointsHoles:function(a){for(var b=[],c=0,d=this.holes.length;c<d;c++)b[c]=this.holes[c].getPoints(a);
return b},extractAllPoints:function(a){return{shape:this.getPoints(a),holes:this.getPointsHoles(a)}},extractPoints:function(a){return this.extractAllPoints(a)}});Zc.prototype=oe;oe.constructor=Zc;Ud.prototype={moveTo:function(a,b){this.currentPath=new Zc;this.subPaths.push(this.currentPath);this.currentPath.moveTo(a,b)},lineTo:function(a,b){this.currentPath.lineTo(a,b)},quadraticCurveTo:function(a,b,c,d){this.currentPath.quadraticCurveTo(a,b,c,d)},bezierCurveTo:function(a,b,c,d,e,f){this.currentPath.bezierCurveTo(a,
b,c,d,e,f)},splineThru:function(a){this.currentPath.splineThru(a)},toShapes:function(a,b){function c(a){for(var b=[],c=0,d=a.length;c<d;c++){var e=a[c],f=new Ab;f.curves=e.curves;b.push(f)}return b}function d(a,b){for(var c=b.length,d=!1,e=c-1,f=0;f<c;e=f++){var g=b[e],h=b[f],k=h.x-g.x,m=h.y-g.y;if(Math.abs(m)>Number.EPSILON){if(0>m&&(g=b[f],k=-k,h=b[e],m=-m),!(a.y<g.y||a.y>h.y))if(a.y===g.y){if(a.x===g.x)return!0}else{e=m*(a.x-g.x)-k*(a.y-g.y);if(0===e)return!0;0>e||(d=!d)}}else if(a.y===g.y&&(h.x<=
a.x&&a.x<=g.x||g.x<=a.x&&a.x<=h.x))return!0}return d}var e=pa.isClockWise,f=this.subPaths;if(0===f.length)return[];if(!0===b)return c(f);var g,h,k,m=[];if(1===f.length)return h=f[0],k=new Ab,k.curves=h.curves,m.push(k),m;var l=!e(f[0].getPoints()),l=a?!l:l;k=[];var p=[],n=[],q=0,w;p[q]=void 0;n[q]=[];for(var u=0,y=f.length;u<y;u++)h=f[u],w=h.getPoints(),g=e(w),(g=a?!g:g)?(!l&&p[q]&&q++,p[q]={s:new Ab,p:w},p[q].s.curves=h.curves,l&&q++,n[q]=[]):n[q].push({h:h,p:w[0]});if(!p[0])return c(f);if(1<p.length){u=
!1;h=[];e=0;for(f=p.length;e<f;e++)k[e]=[];e=0;for(f=p.length;e<f;e++)for(g=n[e],l=0;l<g.length;l++){q=g[l];w=!0;for(y=0;y<p.length;y++)d(q.p,p[y].p)&&(e!==y&&h.push({froms:e,tos:y,hole:l}),w?(w=!1,k[y].push(q)):u=!0);w&&k[e].push(q)}0<h.length&&(u||(n=k))}u=0;for(e=p.length;u<e;u++)for(k=p[u].s,m.push(k),h=n[u],f=0,g=h.length;f<g;f++)k.holes.push(h[f].h);return m}};Object.assign(Vd.prototype,{isFont:!0,generateShapes:function(a,b,c){void 0===b&&(b=100);void 0===c&&(c=4);var d=this.data;a=String(a).split("");
var e=b/d.resolution,f=0;b=[];for(var g=0;g<a.length;g++){var h;h=e;var k=f,m=d.glyphs[a[g]]||d.glyphs["?"];if(m){var l=new Ud,p=[],n=pa.b2,q=pa.b3,w,u,y,t,v,D,z,A;if(m.o)for(var C=m._cachedOutline||(m._cachedOutline=m.o.split(" ")),E=0,G=C.length;E<G;)switch(C[E++]){case "m":w=C[E++]*h+k;u=C[E++]*h;l.moveTo(w,u);break;case "l":w=C[E++]*h+k;u=C[E++]*h;l.lineTo(w,u);break;case "q":w=C[E++]*h+k;u=C[E++]*h;v=C[E++]*h+k;D=C[E++]*h;l.quadraticCurveTo(v,D,w,u);if(t=p[p.length-1]){y=t.x;t=t.y;for(var H=
1;H<=c;H++){var J=H/c;n(J,y,v,w);n(J,t,D,u)}}break;case "b":if(w=C[E++]*h+k,u=C[E++]*h,v=C[E++]*h+k,D=C[E++]*h,z=C[E++]*h+k,A=C[E++]*h,l.bezierCurveTo(v,D,z,A,w,u),t=p[p.length-1])for(y=t.x,t=t.y,H=1;H<=c;H++)J=H/c,q(J,y,v,z,w),q(J,t,D,A,u)}h={offset:m.ha*h,path:l}}else h=void 0;f+=h.offset;b.push(h.path)}c=[];d=0;for(a=b.length;d<a;d++)Array.prototype.push.apply(c,b[d].toShapes());return c}});Object.assign(Ge.prototype,{load:function(a,b,c,d){var e=this;(new Ma(this.manager)).load(a,function(a){var c;
try{c=JSON.parse(a)}catch(d){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),c=JSON.parse(a.substring(65,a.length-2))}a=e.parse(c);b&&b(a)},c,d)},parse:function(a){return new Vd(a)}});var Hd,Zd={getContext:function(){void 0===Hd&&(Hd=new (window.AudioContext||window.webkitAudioContext));return Hd},setContext:function(a){Hd=a}};Object.assign(Wd.prototype,{load:function(a,b,c,d){var e=new Ma(this.manager);e.setResponseType("arraybuffer");e.load(a,
function(a){Zd.getContext().decodeAudioData(a,function(a){b(a)})},c,d)}});Xd.prototype=Object.assign(Object.create(na.prototype),{constructor:Xd,isRectAreaLight:!0,copy:function(a){na.prototype.copy.call(this,a);this.width=a.width;this.height=a.height;return this}});Object.assign(He.prototype,{update:function(){var a,b,c,d,e,f,g,h=new H,k=new H;return function(m){if(a!==this||b!==m.focus||c!==m.fov||d!==m.aspect*this.aspect||e!==m.near||f!==m.far||g!==m.zoom){a=this;b=m.focus;c=m.fov;d=m.aspect*this.aspect;
e=m.near;f=m.far;g=m.zoom;var l=m.projectionMatrix.clone(),p=this.eyeSep/2,n=p*e/b,q=e*Math.tan(Q.DEG2RAD*c*.5)/g,w;k.elements[12]=-p;h.elements[12]=p;p=-q*d+n;w=q*d+n;l.elements[0]=2*e/(w-p);l.elements[8]=(w+p)/(w-p);this.cameraL.projectionMatrix.copy(l);p=-q*d-n;w=q*d-n;l.elements[0]=2*e/(w-p);l.elements[8]=(w+p)/(w-p);this.cameraR.projectionMatrix.copy(l)}this.cameraL.matrixWorld.copy(m.matrixWorld).multiply(k);this.cameraR.matrixWorld.copy(m.matrixWorld).multiply(h)}}()});Bd.prototype=Object.create(G.prototype);
Bd.prototype.constructor=Bd;Yd.prototype=Object.assign(Object.create(G.prototype),{constructor:Yd,getInput:function(){return this.gain},removeFilter:function(){null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null)},getFilter:function(){return this.filter},setFilter:function(a){null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination);
this.filter=a;this.gain.connect(this.filter);this.filter.connect(this.context.destination)},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(a){this.gain.gain.value=a},updateMatrixWorld:function(){var a=new q,b=new da,c=new q,d=new q;return function(e){G.prototype.updateMatrixWorld.call(this,e);e=this.context.listener;var f=this.up;this.matrixWorld.decompose(a,b,c);d.set(0,0,-1).applyQuaternion(b);e.positionX?(e.positionX.setValueAtTime(a.x,this.context.currentTime),
e.positionY.setValueAtTime(a.y,this.context.currentTime),e.positionZ.setValueAtTime(a.z,this.context.currentTime),e.forwardX.setValueAtTime(d.x,this.context.currentTime),e.forwardY.setValueAtTime(d.y,this.context.currentTime),e.forwardZ.setValueAtTime(d.z,this.context.currentTime),e.upX.setValueAtTime(f.x,this.context.currentTime),e.upY.setValueAtTime(f.y,this.context.currentTime),e.upZ.setValueAtTime(f.z,this.context.currentTime)):(e.setPosition(a.x,a.y,a.z),e.setOrientation(d.x,d.y,d.z,f.x,f.y,
f.z))}}()});ec.prototype=Object.assign(Object.create(G.prototype),{constructor:ec,getOutput:function(){return this.gain},setNodeSource:function(a){this.hasPlaybackControl=!1;this.sourceType="audioNode";this.source=a;this.connect();return this},setBuffer:function(a){this.buffer=a;this.sourceType="buffer";this.autoplay&&this.play();return this},play:function(){if(!0===this.isPlaying)console.warn("THREE.Audio: Audio is already playing.");else if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");
else{var a=this.context.createBufferSource();a.buffer=this.buffer;a.loop=this.loop;a.onended=this.onEnded.bind(this);a.playbackRate.setValueAtTime(this.playbackRate,this.startTime);a.start(0,this.startTime);this.isPlaying=!0;this.source=a;return this.connect()}},pause:function(){if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");else return this.source.stop(),this.startTime=this.context.currentTime,this.isPlaying=!1,this},stop:function(){if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");
else return this.source.stop(),this.startTime=0,this.isPlaying=!1,this},connect:function(){if(0<this.filters.length){this.source.connect(this.filters[0]);for(var a=1,b=this.filters.length;a<b;a++)this.filters[a-1].connect(this.filters[a]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(0<this.filters.length){this.source.disconnect(this.filters[0]);for(var a=1,b=this.filters.length;a<b;a++)this.filters[a-
1].disconnect(this.filters[a]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(a){a||(a=[]);!0===this.isPlaying?(this.disconnect(),this.filters=a,this.connect()):this.filters=a;return this},getFilter:function(){return this.getFilters()[0]},setFilter:function(a){return this.setFilters(a?[a]:[])},setPlaybackRate:function(a){if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");
else return this.playbackRate=a,!0===this.isPlaying&&this.source.playbackRate.setValueAtTime(this.playbackRate,this.context.currentTime),this},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(a){if(!1===this.hasPlaybackControl)console.warn("THREE.Audio: this Audio has no playback control.");else return this.loop=
a,!0===this.isPlaying&&(this.source.loop=this.loop),this},getVolume:function(){return this.gain.gain.value},setVolume:function(a){this.gain.gain.value=a;return this}});$d.prototype=Object.assign(Object.create(ec.prototype),{constructor:$d,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(a){this.panner.refDistance=a},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(a){this.panner.rolloffFactor=
a},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(a){this.panner.distanceModel=a},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(a){this.panner.maxDistance=a},updateMatrixWorld:function(){var a=new q;return function(b){G.prototype.updateMatrixWorld.call(this,b);a.setFromMatrixPosition(this.matrixWorld);this.panner.setPosition(a.x,a.y,a.z)}}()});Object.assign(ae.prototype,{getFrequencyData:function(){this.analyser.getByteFrequencyData(this.data);
return this.data},getAverageFrequency:function(){for(var a=0,b=this.getFrequencyData(),c=0;c<b.length;c++)a+=b[c];return a/b.length}});Cd.prototype={constructor:Cd,accumulate:function(a,b){var c=this.buffer,d=this.valueSize,e=a*d+d,f=this.cumulativeWeight;if(0===f){for(f=0;f!==d;++f)c[e+f]=c[f];f=b}else f+=b,this._mixBufferRegion(c,e,0,b/f,d);this.cumulativeWeight=f},apply:function(a){var b=this.valueSize,c=this.buffer;a=a*b+b;var d=this.cumulativeWeight,e=this.binding;this.cumulativeWeight=0;1>d&&
this._mixBufferRegion(c,a,3*b,1-d,b);for(var d=b,f=b+b;d!==f;++d)if(c[d]!==c[d+b]){e.setValue(c,a);break}},saveOriginalState:function(){var a=this.buffer,b=this.valueSize,c=3*b;this.binding.getValue(a,c);for(var d=b;d!==c;++d)a[d]=a[c+d%b];this.cumulativeWeight=0},restoreOriginalState:function(){this.binding.setValue(this.buffer,3*this.valueSize)},_select:function(a,b,c,d,e){if(.5<=d)for(d=0;d!==e;++d)a[b+d]=a[c+d]},_slerp:function(a,b,c,d,e){da.slerpFlat(a,b,a,b,a,c,d)},_lerp:function(a,b,c,d,e){for(var f=
1-d,g=0;g!==e;++g){var h=b+g;a[h]=a[h]*f+a[c+g]*d}}};ka.prototype={constructor:ka,getValue:function(a,b){this.bind();this.getValue(a,b)},setValue:function(a,b){this.bind();this.setValue(a,b)},bind:function(){var a=this.node,b=this.parsedPath,c=b.objectName,d=b.propertyName,e=b.propertyIndex;a||(this.node=a=ka.findNode(this.rootNode,b.nodeName)||this.rootNode);this.getValue=this._getValue_unavailable;this.setValue=this._setValue_unavailable;if(a){if(c){var f=b.objectIndex;switch(c){case "materials":if(!a.material){console.error("  can not bind to material as node does not have a material",
this);return}if(!a.material.materials){console.error("  can not bind to material.materials as node.material does not have a materials array",this);return}a=a.material.materials;break;case "bones":if(!a.skeleton){console.error("  can not bind to bones as node does not have a skeleton",this);return}a=a.skeleton.bones;for(c=0;c<a.length;c++)if(a[c].name===f){f=c;break}break;default:if(void 0===a[c]){console.error("  can not bind to objectName of node, undefined",this);return}a=a[c]}if(void 0!==f){if(void 0===
a[f]){console.error("  trying to bind to objectIndex of objectName, but is undefined:",this,a);return}a=a[f]}}f=a[d];if(void 0===f)console.error("  trying to update property for track: "+b.nodeName+"."+d+" but it wasn't found.",a);else{b=this.Versioning.None;void 0!==a.needsUpdate?(b=this.Versioning.NeedsUpdate,this.targetObject=a):void 0!==a.matrixWorldNeedsUpdate&&(b=this.Versioning.MatrixWorldNeedsUpdate,this.targetObject=a);c=this.BindingType.Direct;if(void 0!==e){if("morphTargetInfluences"===
d){if(!a.geometry){console.error("  can not bind to morphTargetInfluences becasuse node does not have a geometry",this);return}if(!a.geometry.morphTargets){console.error("  can not bind to morphTargetInfluences becasuse node does not have a geometry.morphTargets",this);return}for(c=0;c<this.node.geometry.morphTargets.length;c++)if(a.geometry.morphTargets[c].name===e){e=c;break}}c=this.BindingType.ArrayElement;this.resolvedProperty=f;this.propertyIndex=e}else void 0!==f.fromArray&&void 0!==f.toArray?
(c=this.BindingType.HasFromToArray,this.resolvedProperty=f):void 0!==f.length?(c=this.BindingType.EntireArray,this.resolvedProperty=f):this.propertyName=d;this.getValue=this.GetterByBindingType[c];this.setValue=this.SetterByBindingTypeAndVersioning[c][b]}}else console.error("  trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null;this.getValue=this._getValue_unbound;this.setValue=this._setValue_unbound}};Object.assign(ka.prototype,{_getValue_unavailable:function(){},
_setValue_unavailable:function(){},_getValue_unbound:ka.prototype.getValue,_setValue_unbound:ka.prototype.setValue,BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(a,b){a[b]=this.node[this.propertyName]},function(a,b){for(var c=this.resolvedProperty,d=0,e=c.length;d!==e;++d)a[b++]=c[d]},function(a,b){a[b]=this.resolvedProperty[this.propertyIndex]},function(a,b){this.resolvedProperty.toArray(a,
b)}],SetterByBindingTypeAndVersioning:[[function(a,b){this.node[this.propertyName]=a[b]},function(a,b){this.node[this.propertyName]=a[b];this.targetObject.needsUpdate=!0},function(a,b){this.node[this.propertyName]=a[b];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(a,b){for(var c=this.resolvedProperty,d=0,e=c.length;d!==e;++d)c[d]=a[b++]},function(a,b){for(var c=this.resolvedProperty,d=0,e=c.length;d!==e;++d)c[d]=a[b++];this.targetObject.needsUpdate=!0},function(a,b){for(var c=this.resolvedProperty,
d=0,e=c.length;d!==e;++d)c[d]=a[b++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(a,b){this.resolvedProperty[this.propertyIndex]=a[b]},function(a,b){this.resolvedProperty[this.propertyIndex]=a[b];this.targetObject.needsUpdate=!0},function(a,b){this.resolvedProperty[this.propertyIndex]=a[b];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(a,b){this.resolvedProperty.fromArray(a,b)},function(a,b){this.resolvedProperty.fromArray(a,b);this.targetObject.needsUpdate=!0},function(a,b){this.resolvedProperty.fromArray(a,
b);this.targetObject.matrixWorldNeedsUpdate=!0}]]});ka.Composite=function(a,b,c){c=c||ka.parseTrackName(b);this._targetGroup=a;this._bindings=a.subscribe_(b,c)};ka.Composite.prototype={constructor:ka.Composite,getValue:function(a,b){this.bind();var c=this._bindings[this._targetGroup.nCachedObjects_];void 0!==c&&c.getValue(a,b)},setValue:function(a,b){for(var c=this._bindings,d=this._targetGroup.nCachedObjects_,e=c.length;d!==e;++d)c[d].setValue(a,b)},bind:function(){for(var a=this._bindings,b=this._targetGroup.nCachedObjects_,
c=a.length;b!==c;++b)a[b].bind()},unbind:function(){for(var a=this._bindings,b=this._targetGroup.nCachedObjects_,c=a.length;b!==c;++b)a[b].unbind()}};ka.create=function(a,b,c){return a&&a.isAnimationObjectGroup?new ka.Composite(a,b,c):new ka(a,b,c)};ka.parseTrackName=function(a){var b=/^((?:[\w-]+[\/:])*)([\w-]+)?(?:\.([\w-]+)(?:\[(.+)\])?)?\.([\w-]+)(?:\[(.+)\])?$/.exec(a);if(!b)throw Error("cannot parse trackName at all: "+a);b={nodeName:b[2],objectName:b[3],objectIndex:b[4],propertyName:b[5],propertyIndex:b[6]};
if(null===b.propertyName||0===b.propertyName.length)throw Error("can not parse propertyName from trackName: "+a);return b};ka.findNode=function(a,b){if(!b||""===b||"root"===b||"."===b||-1===b||b===a.name||b===a.uuid)return a;if(a.skeleton){var c=function(a){for(var c=0;c<a.bones.length;c++){var d=a.bones[c];if(d.name===b)return d}return null}(a.skeleton);if(c)return c}if(a.children){var d=function(a){for(var c=0;c<a.length;c++){var g=a[c];if(g.name===b||g.uuid===b||(g=d(g.children)))return g}return null};
if(c=d(a.children))return c}return null};be.prototype={constructor:be,isAnimationObjectGroup:!0,add:function(a){for(var b=this._objects,c=b.length,d=this.nCachedObjects_,e=this._indicesByUUID,f=this._paths,g=this._parsedPaths,h=this._bindings,k=h.length,l=0,q=arguments.length;l!==q;++l){var p=arguments[l],n=p.uuid,r=e[n];if(void 0===r){r=c++;e[n]=r;b.push(p);for(var n=0,w=k;n!==w;++n)h[n].push(new ka(p,f[n],g[n]))}else if(r<d){var u=--d,w=b[u];e[w.uuid]=r;b[r]=w;e[n]=u;b[u]=p;n=0;for(w=k;n!==w;++n){var y=
h[n],t=y[r];y[r]=y[u];void 0===t&&(t=new ka(p,f[n],g[n]));y[u]=t}}else void 0!==b[r]&&console.error("Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes...")}this.nCachedObjects_=d},remove:function(a){for(var b=this._objects,c=this.nCachedObjects_,d=this._indicesByUUID,e=this._bindings,f=e.length,g=0,h=arguments.length;g!==h;++g){var k=arguments[g],l=k.uuid,q=d[l];if(void 0!==q&&q>=c){var p=c++,n=b[p];d[n.uuid]=q;b[q]=n;d[l]=p;b[p]=
k;k=0;for(l=f;k!==l;++k){var n=e[k],r=n[q];n[q]=n[p];n[p]=r}}}this.nCachedObjects_=c},uncache:function(a){for(var b=this._objects,c=b.length,d=this.nCachedObjects_,e=this._indicesByUUID,f=this._bindings,g=f.length,h=0,k=arguments.length;h!==k;++h){var l=arguments[h].uuid,q=e[l];if(void 0!==q)if(delete e[l],q<d){var l=--d,p=b[l],n=--c,r=b[n];e[p.uuid]=q;b[q]=p;e[r.uuid]=l;b[l]=r;b.pop();p=0;for(r=g;p!==r;++p){var w=f[p],u=w[n];w[q]=w[l];w[l]=u;w.pop()}}else for(n=--c,r=b[n],e[r.uuid]=q,b[q]=r,b.pop(),
p=0,r=g;p!==r;++p)w=f[p],w[q]=w[n],w.pop()}this.nCachedObjects_=d},subscribe_:function(a,b){var c=this._bindingsIndicesByPath,d=c[a],e=this._bindings;if(void 0!==d)return e[d];var f=this._paths,g=this._parsedPaths,h=this._objects,k=this.nCachedObjects_,l=Array(h.length),d=e.length;c[a]=d;f.push(a);g.push(b);e.push(l);c=k;for(d=h.length;c!==d;++c)l[c]=new ka(h[c],a,b);return l},unsubscribe_:function(a){var b=this._bindingsIndicesByPath,c=b[a];if(void 0!==c){var d=this._paths,e=this._parsedPaths,f=
this._bindings,g=f.length-1,h=f[g];b[a[g]]=c;f[c]=h;f.pop();e[c]=e[g];e.pop();d[c]=d[g];d.pop()}}};ce.prototype={constructor:ce,play:function(){this._mixer._activateAction(this);return this},stop:function(){this._mixer._deactivateAction(this);return this.reset()},reset:function(){this.paused=!1;this.enabled=!0;this.time=0;this._loopCount=-1;this._startTime=null;return this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&
this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(a){this._startTime=a;return this},setLoop:function(a,b){this.loop=a;this.repetitions=b;return this},setEffectiveWeight:function(a){this.weight=a;this._effectiveWeight=this.enabled?a:0;return this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(a){return this._scheduleFading(a,0,1)},fadeOut:function(a){return this._scheduleFading(a,1,0)},crossFadeFrom:function(a,
b,c){a.fadeOut(b);this.fadeIn(b);if(c){c=this._clip.duration;var d=a._clip.duration,e=c/d;a.warp(1,d/c,b);this.warp(e,1,b)}return this},crossFadeTo:function(a,b,c){return a.crossFadeFrom(this,b,c)},stopFading:function(){var a=this._weightInterpolant;null!==a&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(a));return this},setEffectiveTimeScale:function(a){this.timeScale=a;this._effectiveTimeScale=this.paused?0:a;return this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},
setDuration:function(a){this.timeScale=this._clip.duration/a;return this.stopWarping()},syncWith:function(a){this.time=a.time;this.timeScale=a.timeScale;return this.stopWarping()},halt:function(a){return this.warp(this._effectiveTimeScale,0,a)},warp:function(a,b,c){var d=this._mixer,e=d.time,f=this._timeScaleInterpolant,g=this.timeScale;null===f&&(this._timeScaleInterpolant=f=d._lendControlInterpolant());d=f.parameterPositions;f=f.sampleValues;d[0]=e;d[1]=e+c;f[0]=a/g;f[1]=b/g;return this},stopWarping:function(){var a=
this._timeScaleInterpolant;null!==a&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(a));return this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(a,b,c,d){var e=this._startTime;if(null!==e){b=(a-e)*c;if(0>b||0===c)return;this._startTime=null;b*=c}b*=this._updateTimeScale(a);c=this._updateTime(b);a=this._updateWeight(a);if(0<a){b=this._interpolants;for(var e=this._propertyBindings,
f=0,g=b.length;f!==g;++f)b[f].evaluate(c),e[f].accumulate(d,a)}},_updateWeight:function(a){var b=0;if(this.enabled){var b=this.weight,c=this._weightInterpolant;if(null!==c){var d=c.evaluate(a)[0],b=b*d;a>c.parameterPositions[1]&&(this.stopFading(),0===d&&(this.enabled=!1))}}return this._effectiveWeight=b},_updateTimeScale:function(a){var b=0;if(!this.paused){var b=this.timeScale,c=this._timeScaleInterpolant;if(null!==c){var d=c.evaluate(a)[0],b=b*d;a>c.parameterPositions[1]&&(this.stopWarping(),0===
b?this.paused=!0:this.timeScale=b)}}return this._effectiveTimeScale=b},_updateTime:function(a){var b=this.time+a;if(0===a)return b;var c=this._clip.duration,d=this.loop,e=this._loopCount;if(2200===d)a:{if(-1===e&&(this._loopCount=0,this._setEndings(!0,!0,!1)),b>=c)b=c;else if(0>b)b=0;else break a;this.clampWhenFinished?this.paused=!0:this.enabled=!1;this._mixer.dispatchEvent({type:"finished",action:this,direction:0>a?-1:1})}else{d=2202===d;-1===e&&(0<=a?(e=0,this._setEndings(!0,0===this.repetitions,
d)):this._setEndings(0===this.repetitions,!0,d));if(b>=c||0>b){var f=Math.floor(b/c),b=b-c*f,e=e+Math.abs(f),g=this.repetitions-e;0>g?(this.clampWhenFinished?this.paused=!0:this.enabled=!1,b=0<a?c:0,this._mixer.dispatchEvent({type:"finished",action:this,direction:0<a?1:-1})):(0===g?(a=0>a,this._setEndings(a,!a,d)):this._setEndings(!1,!1,d),this._loopCount=e,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:f}))}if(d&&1===(e&1))return this.time=b,c-b}return this.time=b},_setEndings:function(a,
b,c){var d=this._interpolantSettings;c?(d.endingStart=2401,d.endingEnd=2401):(d.endingStart=a?this.zeroSlopeAtStart?2401:2400:2402,d.endingEnd=b?this.zeroSlopeAtEnd?2401:2400:2402)},_scheduleFading:function(a,b,c){var d=this._mixer,e=d.time,f=this._weightInterpolant;null===f&&(this._weightInterpolant=f=d._lendControlInterpolant());d=f.parameterPositions;f=f.sampleValues;d[0]=e;f[0]=b;d[1]=e+a;f[1]=c;return this}};Object.assign(de.prototype,oa.prototype,{clipAction:function(a,b){var c=b||this._root,
d=c.uuid,e="string"===typeof a?ta.findByName(c,a):a,c=null!==e?e.uuid:a,f=this._actionsByClip[c],g=null;if(void 0!==f){g=f.actionByRoot[d];if(void 0!==g)return g;g=f.knownActions[0];null===e&&(e=g._clip)}if(null===e)return null;e=new ce(this,e,b);this._bindAction(e,g);this._addInactiveAction(e,c,d);return e},existingAction:function(a,b){var c=b||this._root,d=c.uuid,c="string"===typeof a?ta.findByName(c,a):a,c=this._actionsByClip[c?c.uuid:a];return void 0!==c?c.actionByRoot[d]||null:null},stopAllAction:function(){for(var a=
this._actions,b=this._nActiveActions,c=this._bindings,d=this._nActiveBindings,e=this._nActiveBindings=this._nActiveActions=0;e!==b;++e)a[e].reset();for(e=0;e!==d;++e)c[e].useCount=0;return this},update:function(a){a*=this.timeScale;for(var b=this._actions,c=this._nActiveActions,d=this.time+=a,e=Math.sign(a),f=this._accuIndex^=1,g=0;g!==c;++g){var h=b[g];h.enabled&&h._update(d,a,e,f)}a=this._bindings;b=this._nActiveBindings;for(g=0;g!==b;++g)a[g].apply(f);return this},getRoot:function(){return this._root},
uncacheClip:function(a){var b=this._actions;a=a.uuid;var c=this._actionsByClip,d=c[a];if(void 0!==d){for(var d=d.knownActions,e=0,f=d.length;e!==f;++e){var g=d[e];this._deactivateAction(g);var h=g._cacheIndex,k=b[b.length-1];g._cacheIndex=null;g._byClipCacheIndex=null;k._cacheIndex=h;b[h]=k;b.pop();this._removeInactiveBindingsForAction(g)}delete c[a]}},uncacheRoot:function(a){a=a.uuid;var b=this._actionsByClip,c;for(c in b){var d=b[c].actionByRoot[a];void 0!==d&&(this._deactivateAction(d),this._removeInactiveAction(d))}c=
this._bindingsByRootAndName[a];if(void 0!==c)for(var e in c)a=c[e],a.restoreOriginalState(),this._removeInactiveBinding(a)},uncacheAction:function(a,b){var c=this.existingAction(a,b);null!==c&&(this._deactivateAction(c),this._removeInactiveAction(c))}});Object.assign(de.prototype,{_bindAction:function(a,b){var c=a._localRoot||this._root,d=a._clip.tracks,e=d.length,f=a._propertyBindings,g=a._interpolants,h=c.uuid,k=this._bindingsByRootAndName,l=k[h];void 0===l&&(l={},k[h]=l);for(k=0;k!==e;++k){var q=
d[k],p=q.name,n=l[p];if(void 0===n){n=f[k];if(void 0!==n){null===n._cacheIndex&&(++n.referenceCount,this._addInactiveBinding(n,h,p));continue}n=new Cd(ka.create(c,p,b&&b._propertyBindings[k].binding.parsedPath),q.ValueTypeName,q.getValueSize());++n.referenceCount;this._addInactiveBinding(n,h,p)}f[k]=n;g[k].resultBuffer=n.buffer}},_activateAction:function(a){if(!this._isActiveAction(a)){if(null===a._cacheIndex){var b=(a._localRoot||this._root).uuid,c=a._clip.uuid,d=this._actionsByClip[c];this._bindAction(a,
d&&d.knownActions[0]);this._addInactiveAction(a,c,b)}b=a._propertyBindings;c=0;for(d=b.length;c!==d;++c){var e=b[c];0===e.useCount++&&(this._lendBinding(e),e.saveOriginalState())}this._lendAction(a)}},_deactivateAction:function(a){if(this._isActiveAction(a)){for(var b=a._propertyBindings,c=0,d=b.length;c!==d;++c){var e=b[c];0===--e.useCount&&(e.restoreOriginalState(),this._takeBackBinding(e))}this._takeBackAction(a)}},_initMemoryManager:function(){this._actions=[];this._nActiveActions=0;this._actionsByClip=
{};this._bindings=[];this._nActiveBindings=0;this._bindingsByRootAndName={};this._controlInterpolants=[];this._nActiveControlInterpolants=0;var a=this;this.stats={actions:{get total(){return a._actions.length},get inUse(){return a._nActiveActions}},bindings:{get total(){return a._bindings.length},get inUse(){return a._nActiveBindings}},controlInterpolants:{get total(){return a._controlInterpolants.length},get inUse(){return a._nActiveControlInterpolants}}}},_isActiveAction:function(a){a=a._cacheIndex;
return null!==a&&a<this._nActiveActions},_addInactiveAction:function(a,b,c){var d=this._actions,e=this._actionsByClip,f=e[b];void 0===f?(f={knownActions:[a],actionByRoot:{}},a._byClipCacheIndex=0,e[b]=f):(b=f.knownActions,a._byClipCacheIndex=b.length,b.push(a));a._cacheIndex=d.length;d.push(a);f.actionByRoot[c]=a},_removeInactiveAction:function(a){var b=this._actions,c=b[b.length-1],d=a._cacheIndex;c._cacheIndex=d;b[d]=c;b.pop();a._cacheIndex=null;var c=a._clip.uuid,d=this._actionsByClip,e=d[c],f=
e.knownActions,g=f[f.length-1],h=a._byClipCacheIndex;g._byClipCacheIndex=h;f[h]=g;f.pop();a._byClipCacheIndex=null;delete e.actionByRoot[(b._localRoot||this._root).uuid];0===f.length&&delete d[c];this._removeInactiveBindingsForAction(a)},_removeInactiveBindingsForAction:function(a){a=a._propertyBindings;for(var b=0,c=a.length;b!==c;++b){var d=a[b];0===--d.referenceCount&&this._removeInactiveBinding(d)}},_lendAction:function(a){var b=this._actions,c=a._cacheIndex,d=this._nActiveActions++,e=b[d];a._cacheIndex=
d;b[d]=a;e._cacheIndex=c;b[c]=e},_takeBackAction:function(a){var b=this._actions,c=a._cacheIndex,d=--this._nActiveActions,e=b[d];a._cacheIndex=d;b[d]=a;e._cacheIndex=c;b[c]=e},_addInactiveBinding:function(a,b,c){var d=this._bindingsByRootAndName,e=d[b],f=this._bindings;void 0===e&&(e={},d[b]=e);e[c]=a;a._cacheIndex=f.length;f.push(a)},_removeInactiveBinding:function(a){var b=this._bindings,c=a.binding,d=c.rootNode.uuid,c=c.path,e=this._bindingsByRootAndName,f=e[d],g=b[b.length-1];a=a._cacheIndex;
g._cacheIndex=a;b[a]=g;b.pop();delete f[c];a:{for(var h in f)break a;delete e[d]}},_lendBinding:function(a){var b=this._bindings,c=a._cacheIndex,d=this._nActiveBindings++,e=b[d];a._cacheIndex=d;b[d]=a;e._cacheIndex=c;b[c]=e},_takeBackBinding:function(a){var b=this._bindings,c=a._cacheIndex,d=--this._nActiveBindings,e=b[d];a._cacheIndex=d;b[d]=a;e._cacheIndex=c;b[c]=e},_lendControlInterpolant:function(){var a=this._controlInterpolants,b=this._nActiveControlInterpolants++,c=a[b];void 0===c&&(c=new Wc(new Float32Array(2),
new Float32Array(2),1,this._controlInterpolantsResultBuffer),c.__cacheIndex=b,a[b]=c);return c},_takeBackControlInterpolant:function(a){var b=this._controlInterpolants,c=a.__cacheIndex,d=--this._nActiveControlInterpolants,e=b[d];a.__cacheIndex=d;b[d]=a;e.__cacheIndex=c;b[c]=e},_controlInterpolantsResultBuffer:new Float32Array(1)});Dd.prototype.clone=function(){return new Dd(void 0===this.value.clone?this.value:this.value.clone())};Bb.prototype=Object.create(D.prototype);Bb.prototype.constructor=Bb;
Bb.prototype.isInstancedBufferGeometry=!0;Bb.prototype.addGroup=function(a,b,c){this.groups.push({start:a,count:b,materialIndex:c})};Bb.prototype.copy=function(a){var b=a.index;null!==b&&this.setIndex(b.clone());var b=a.attributes,c;for(c in b)this.addAttribute(c,b[c].clone());a=a.groups;c=0;for(b=a.length;c<b;c++){var d=a[c];this.addGroup(d.start,d.count,d.materialIndex)}return this};ee.prototype={constructor:ee,isInterleavedBufferAttribute:!0,get count(){return this.data.count},get array(){return this.data.array},
setX:function(a,b){this.data.array[a*this.data.stride+this.offset]=b;return this},setY:function(a,b){this.data.array[a*this.data.stride+this.offset+1]=b;return this},setZ:function(a,b){this.data.array[a*this.data.stride+this.offset+2]=b;return this},setW:function(a,b){this.data.array[a*this.data.stride+this.offset+3]=b;return this},getX:function(a){return this.data.array[a*this.data.stride+this.offset]},getY:function(a){return this.data.array[a*this.data.stride+this.offset+1]},getZ:function(a){return this.data.array[a*
this.data.stride+this.offset+2]},getW:function(a){return this.data.array[a*this.data.stride+this.offset+3]},setXY:function(a,b,c){a=a*this.data.stride+this.offset;this.data.array[a+0]=b;this.data.array[a+1]=c;return this},setXYZ:function(a,b,c,d){a=a*this.data.stride+this.offset;this.data.array[a+0]=b;this.data.array[a+1]=c;this.data.array[a+2]=d;return this},setXYZW:function(a,b,c,d,e){a=a*this.data.stride+this.offset;this.data.array[a+0]=b;this.data.array[a+1]=c;this.data.array[a+2]=d;this.data.array[a+
3]=e;return this}};fc.prototype={constructor:fc,isInterleavedBuffer:!0,set needsUpdate(a){!0===a&&this.version++},setArray:function(a){if(Array.isArray(a))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.count=void 0!==a?a.length/this.stride:0;this.array=a},setDynamic:function(a){this.dynamic=a;return this},copy:function(a){this.array=new a.array.constructor(a.array);this.count=a.count;this.stride=a.stride;this.dynamic=a.dynamic;return this},copyAt:function(a,b,c){a*=
this.stride;c*=b.stride;for(var d=0,e=this.stride;d<e;d++)this.array[a+d]=b.array[c+d];return this},set:function(a,b){void 0===b&&(b=0);this.array.set(a,b);return this},clone:function(){return(new this.constructor).copy(this)},onUpload:function(a){this.onUploadCallback=a;return this}};gc.prototype=Object.create(fc.prototype);gc.prototype.constructor=gc;gc.prototype.isInstancedInterleavedBuffer=!0;gc.prototype.copy=function(a){fc.prototype.copy.call(this,a);this.meshPerAttribute=a.meshPerAttribute;
return this};hc.prototype=Object.create(y.prototype);hc.prototype.constructor=hc;hc.prototype.isInstancedBufferAttribute=!0;hc.prototype.copy=function(a){y.prototype.copy.call(this,a);this.meshPerAttribute=a.meshPerAttribute;return this};fe.prototype={constructor:fe,linePrecision:1,set:function(a,b){this.ray.set(a,b)},setFromCamera:function(a,b){b&&b.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(b.matrixWorld),this.ray.direction.set(a.x,a.y,.5).unproject(b).sub(this.ray.origin).normalize()):
b&&b.isOrthographicCamera?(this.ray.origin.set(a.x,a.y,(b.near+b.far)/(b.near-b.far)).unproject(b),this.ray.direction.set(0,0,-1).transformDirection(b.matrixWorld)):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(a,b){var c=[];ge(a,this,c,b);c.sort(Ie);return c},intersectObjects:function(a,b){var c=[];if(!1===Array.isArray(a))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),c;for(var d=0,e=a.length;d<e;d++)ge(a[d],this,c,b);c.sort(Ie);
return c}};he.prototype={constructor:he,start:function(){this.oldTime=this.startTime=(performance||Date).now();this.elapsedTime=0;this.running=!0},stop:function(){this.getElapsedTime();this.running=!1},getElapsedTime:function(){this.getDelta();return this.elapsedTime},getDelta:function(){var a=0;this.autoStart&&!this.running&&this.start();if(this.running){var b=(performance||Date).now(),a=(b-this.oldTime)/1E3;this.oldTime=b;this.elapsedTime+=a}return a}};ie.prototype={constructor:ie,set:function(a,
b,c){this.radius=a;this.phi=b;this.theta=c;return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.radius=a.radius;this.phi=a.phi;this.theta=a.theta;return this},makeSafe:function(){this.phi=Math.max(1E-6,Math.min(Math.PI-1E-6,this.phi));return this},setFromVector3:function(a){this.radius=a.length();0===this.radius?this.phi=this.theta=0:(this.theta=Math.atan2(a.x,a.z),this.phi=Math.acos(Q.clamp(a.y/this.radius,-1,1)));return this}};je.prototype={constructor:je,
set:function(a,b,c){this.radius=a;this.theta=b;this.y=c;return this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.radius=a.radius;this.theta=a.theta;this.y=a.y;return this},setFromVector3:function(a){this.radius=Math.sqrt(a.x*a.x+a.z*a.z);this.theta=Math.atan2(a.x,a.z);this.y=a.y;return this}};ua.prototype=Object.create(Ba.prototype);ua.prototype.constructor=ua;ua.prototype.createAnimation=function(a,b,c,d){b={start:b,end:c,length:c-b+1,fps:d,duration:(c-b)/d,lastFrame:0,
currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[a]=b;this.animationsList.push(b)};ua.prototype.autoCreateAnimations=function(a){for(var b=/([a-z]+)_?(\d+)/i,c,d={},e=this.geometry,f=0,g=e.morphTargets.length;f<g;f++){var h=e.morphTargets[f].name.match(b);if(h&&1<h.length){var k=h[1];d[k]||(d[k]={start:Infinity,end:-Infinity});h=d[k];f<h.start&&(h.start=f);f>h.end&&(h.end=f);c||(c=k)}}for(k in d)h=d[k],this.createAnimation(k,h.start,h.end,
a);this.firstAnimation=c};ua.prototype.setAnimationDirectionForward=function(a){if(a=this.animationsMap[a])a.direction=1,a.directionBackwards=!1};ua.prototype.setAnimationDirectionBackward=function(a){if(a=this.animationsMap[a])a.direction=-1,a.directionBackwards=!0};ua.prototype.setAnimationFPS=function(a,b){var c=this.animationsMap[a];c&&(c.fps=b,c.duration=(c.end-c.start)/c.fps)};ua.prototype.setAnimationDuration=function(a,b){var c=this.animationsMap[a];c&&(c.duration=b,c.fps=(c.end-c.start)/
c.duration)};ua.prototype.setAnimationWeight=function(a,b){var c=this.animationsMap[a];c&&(c.weight=b)};ua.prototype.setAnimationTime=function(a,b){var c=this.animationsMap[a];c&&(c.time=b)};ua.prototype.getAnimationTime=function(a){var b=0;if(a=this.animationsMap[a])b=a.time;return b};ua.prototype.getAnimationDuration=function(a){var b=-1;if(a=this.animationsMap[a])b=a.duration;return b};ua.prototype.playAnimation=function(a){var b=this.animationsMap[a];b?(b.time=0,b.active=!0):console.warn("THREE.MorphBlendMesh: animation["+
a+"] undefined in .playAnimation()")};ua.prototype.stopAnimation=function(a){if(a=this.animationsMap[a])a.active=!1};ua.prototype.update=function(a){for(var b=0,c=this.animationsList.length;b<c;b++){var d=this.animationsList[b];if(d.active){var e=d.duration/d.length;d.time+=d.direction*a;if(d.mirroredLoop){if(d.time>d.duration||0>d.time)d.direction*=-1,d.time>d.duration&&(d.time=d.duration,d.directionBackwards=!0),0>d.time&&(d.time=0,d.directionBackwards=!1)}else d.time%=d.duration,0>d.time&&(d.time+=
d.duration);var f=d.start+Q.clamp(Math.floor(d.time/e),0,d.length-1),g=d.weight;f!==d.currentFrame&&(this.morphTargetInfluences[d.lastFrame]=0,this.morphTargetInfluences[d.currentFrame]=1*g,this.morphTargetInfluences[f]=0,d.lastFrame=d.currentFrame,d.currentFrame=f);e=d.time%e/e;d.directionBackwards&&(e=1-e);d.currentFrame!==d.lastFrame?(this.morphTargetInfluences[d.currentFrame]=e*g,this.morphTargetInfluences[d.lastFrame]=(1-e)*g):this.morphTargetInfluences[d.currentFrame]=g}}};$c.prototype=Object.create(G.prototype);
$c.prototype.constructor=$c;$c.prototype.isImmediateRenderObject=!0;ad.prototype=Object.create(fa.prototype);ad.prototype.constructor=ad;ad.prototype.update=function(){var a=new q,b=new q,c=new za;return function(){var d=["a","b","c"];this.object.updateMatrixWorld(!0);c.getNormalMatrix(this.object.matrixWorld);var e=this.object.matrixWorld,f=this.geometry.attributes.position,g=this.object.geometry;if(g&&g.isGeometry)for(var h=g.vertices,k=g.faces,l=g=0,q=k.length;l<q;l++)for(var p=k[l],n=0,r=p.vertexNormals.length;n<
r;n++){var w=p.vertexNormals[n];a.copy(h[p[d[n]]]).applyMatrix4(e);b.copy(w).applyMatrix3(c).normalize().multiplyScalar(this.size).add(a);f.setXYZ(g,a.x,a.y,a.z);g+=1;f.setXYZ(g,b.x,b.y,b.z);g+=1}else if(g&&g.isBufferGeometry)for(d=g.attributes.position,h=g.attributes.normal,n=g=0,r=d.count;n<r;n++)a.set(d.getX(n),d.getY(n),d.getZ(n)).applyMatrix4(e),b.set(h.getX(n),h.getY(n),h.getZ(n)),b.applyMatrix3(c).normalize().multiplyScalar(this.size).add(a),f.setXYZ(g,a.x,a.y,a.z),g+=1,f.setXYZ(g,b.x,b.y,
b.z),g+=1;f.needsUpdate=!0;return this}}();ic.prototype=Object.create(G.prototype);ic.prototype.constructor=ic;ic.prototype.dispose=function(){this.cone.geometry.dispose();this.cone.material.dispose()};ic.prototype.update=function(){var a=new q,b=new q;return function(){var c=this.light.distance?this.light.distance:1E3,d=c*Math.tan(this.light.angle);this.cone.scale.set(d,d,c);a.setFromMatrixPosition(this.light.matrixWorld);b.setFromMatrixPosition(this.light.target.matrixWorld);this.cone.lookAt(b.sub(a));
this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}}();jc.prototype=Object.create(fa.prototype);jc.prototype.constructor=jc;jc.prototype.getBoneList=function(a){var b=[];a&&a.isBone&&b.push(a);for(var c=0;c<a.children.length;c++)b.push.apply(b,this.getBoneList(a.children[c]));return b};jc.prototype.update=function(){var a=new q,b=new H,c=new H;return function(){var d=this.geometry,e=d.getAttribute("position");c.getInverse(this.root.matrixWorld);for(var f=0,g=0;f<
this.bones.length;f++){var h=this.bones[f];h.parent&&h.parent.isBone&&(b.multiplyMatrices(c,h.matrixWorld),a.setFromMatrixPosition(b),e.setXYZ(g,a.x,a.y,a.z),b.multiplyMatrices(c,h.parent.matrixWorld),a.setFromMatrixPosition(b),e.setXYZ(g+1,a.x,a.y,a.z),g+=2)}d.getAttribute("position").needsUpdate=!0}}();kc.prototype=Object.create(Ba.prototype);kc.prototype.constructor=kc;kc.prototype.dispose=function(){this.geometry.dispose();this.material.dispose()};kc.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)};
lc.prototype=Object.create(G.prototype);lc.prototype.constructor=lc;lc.prototype.dispose=function(){this.children[0].geometry.dispose();this.children[0].material.dispose();this.children[1].geometry.dispose();this.children[1].material.dispose()};lc.prototype.update=function(){var a=new q,b=new q;return function(){var c=this.children[0],d=this.children[1];if(this.light.target){a.setFromMatrixPosition(this.light.matrixWorld);b.setFromMatrixPosition(this.light.target.matrixWorld);var e=b.clone().sub(a);
c.lookAt(e);d.lookAt(e)}c.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);d.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);var d=.5*this.light.width,e=.5*this.light.height,c=c.geometry.getAttribute("position"),f=c.array;f[0]=d;f[1]=-e;f[2]=0;f[3]=d;f[4]=e;f[5]=0;f[6]=-d;f[7]=e;f[8]=0;f[9]=-d;f[10]=e;f[11]=0;f[12]=-d;f[13]=-e;f[14]=0;f[15]=d;f[16]=-e;f[17]=0;c.needsUpdate=!0}}();mc.prototype=Object.create(G.prototype);mc.prototype.constructor=
mc;mc.prototype.dispose=function(){this.children[0].geometry.dispose();this.children[0].material.dispose()};mc.prototype.update=function(){var a=new q,b=new N,c=new N;return function(){var d=this.children[0],e=d.geometry.getAttribute("color");b.copy(this.light.color).multiplyScalar(this.light.intensity);c.copy(this.light.groundColor).multiplyScalar(this.light.intensity);for(var f=0,g=e.count;f<g;f++){var h=f<g/2?b:c;e.setXYZ(f,h.r,h.g,h.b)}d.lookAt(a.setFromMatrixPosition(this.light.matrixWorld).negate());
e.needsUpdate=!0}}();bd.prototype=Object.create(fa.prototype);bd.prototype.constructor=bd;Ed.prototype=Object.create(fa.prototype);Ed.prototype.constructor=Ed;cd.prototype=Object.create(fa.prototype);cd.prototype.constructor=cd;cd.prototype.update=function(){var a=new q,b=new q,c=new za;return function(){this.object.updateMatrixWorld(!0);c.getNormalMatrix(this.object.matrixWorld);for(var d=this.object.matrixWorld,e=this.geometry.attributes.position,f=this.object.geometry,g=f.vertices,f=f.faces,h=
0,k=0,l=f.length;k<l;k++){var q=f[k],p=q.normal;a.copy(g[q.a]).add(g[q.b]).add(g[q.c]).divideScalar(3).applyMatrix4(d);b.copy(p).applyMatrix3(c).normalize().multiplyScalar(this.size).add(a);e.setXYZ(h,a.x,a.y,a.z);h+=1;e.setXYZ(h,b.x,b.y,b.z);h+=1}e.needsUpdate=!0;return this}}();nc.prototype=Object.create(G.prototype);nc.prototype.constructor=nc;nc.prototype.dispose=function(){var a=this.children[0],b=this.children[1];a.geometry.dispose();a.material.dispose();b.geometry.dispose();b.material.dispose()};
nc.prototype.update=function(){var a=new q,b=new q,c=new q;return function(){a.setFromMatrixPosition(this.light.matrixWorld);b.setFromMatrixPosition(this.light.target.matrixWorld);c.subVectors(b,a);var d=this.children[0],e=this.children[1];d.lookAt(c);d.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);e.lookAt(c);e.scale.z=c.length()}}();dd.prototype=Object.create(fa.prototype);dd.prototype.constructor=dd;dd.prototype.update=function(){function a(a,g,h,k){d.set(g,h,k).unproject(e);
a=c[a];if(void 0!==a)for(g=b.getAttribute("position"),h=0,k=a.length;h<k;h++)g.setXYZ(a[h],d.x,d.y,d.z)}var b,c,d=new q,e=new sa;return function(){b=this.geometry;c=this.pointMap;e.projectionMatrix.copy(this.camera.projectionMatrix);a("c",0,0,-1);a("t",0,0,1);a("n1",-1,-1,-1);a("n2",1,-1,-1);a("n3",-1,1,-1);a("n4",1,1,-1);a("f1",-1,-1,1);a("f2",1,-1,1);a("f3",-1,1,1);a("f4",1,1,1);a("u1",.7,1.1,-1);a("u2",-.7,1.1,-1);a("u3",0,2,-1);a("cf1",-1,0,1);a("cf2",1,0,1);a("cf3",0,-1,1);a("cf4",0,1,1);a("cn1",
-1,0,-1);a("cn2",1,0,-1);a("cn3",0,-1,-1);a("cn4",0,1,-1);b.getAttribute("position").needsUpdate=!0}}();oc.prototype=Object.create(fa.prototype);oc.prototype.constructor=oc;oc.prototype.update=function(){var a=new ya;return function(b){b&&b.isBox3?a.copy(b):a.setFromObject(b);if(!a.isEmpty()){b=a.min;var c=a.max,d=this.geometry.attributes.position,e=d.array;e[0]=c.x;e[1]=c.y;e[2]=c.z;e[3]=b.x;e[4]=c.y;e[5]=c.z;e[6]=b.x;e[7]=b.y;e[8]=c.z;e[9]=c.x;e[10]=b.y;e[11]=c.z;e[12]=c.x;e[13]=c.y;e[14]=b.z;e[15]=
b.x;e[16]=c.y;e[17]=b.z;e[18]=b.x;e[19]=b.y;e[20]=b.z;e[21]=c.x;e[22]=b.y;e[23]=b.z;d.needsUpdate=!0;this.geometry.computeBoundingSphere()}}}();var Je=new D;Je.addAttribute("position",new X([0,0,0,0,1,0],3));var Ke=new Wa(0,.5,1,5,1);Ke.translate(0,-.5,0);Cb.prototype=Object.create(G.prototype);Cb.prototype.constructor=Cb;Cb.prototype.setDirection=function(){var a=new q,b;return function(c){.99999<c.y?this.quaternion.set(0,0,0,1):-.99999>c.y?this.quaternion.set(1,0,0,0):(a.set(c.z,0,-c.x).normalize(),
b=Math.acos(c.y),this.quaternion.setFromAxisAngle(a,b))}}();Cb.prototype.setLength=function(a,b,c){void 0===b&&(b=.2*a);void 0===c&&(c=.2*b);this.line.scale.set(1,Math.max(0,a-b),1);this.line.updateMatrix();this.cone.scale.set(c,b,c);this.cone.position.y=a;this.cone.updateMatrix()};Cb.prototype.setColor=function(a){this.line.material.color.copy(a);this.cone.material.color.copy(a)};Fd.prototype=Object.create(fa.prototype);Fd.prototype.constructor=Fd;var ke=function(){function a(){}var b=new q,c=new a,
d=new a,e=new a;a.prototype.init=function(a,b,c,d){this.c0=a;this.c1=c;this.c2=-3*a+3*b-2*c-d;this.c3=2*a-2*b+c+d};a.prototype.initNonuniformCatmullRom=function(a,b,c,d,e,l,p){this.init(b,c,((b-a)/e-(c-a)/(e+l)+(c-b)/l)*l,((c-b)/l-(d-b)/(l+p)+(d-c)/p)*l)};a.prototype.initCatmullRom=function(a,b,c,d,e){this.init(b,c,e*(c-a),e*(d-b))};a.prototype.calc=function(a){var b=a*a;return this.c0+this.c1*a+this.c2*b+this.c3*b*a};return wa.create(function(a){this.points=a||[];this.closed=!1},function(a){var g=
this.points,h,k;k=g.length;2>k&&console.log("duh, you need at least 2 points");a*=k-(this.closed?0:1);h=Math.floor(a);a-=h;this.closed?h+=0<h?0:(Math.floor(Math.abs(h)/g.length)+1)*g.length:0===a&&h===k-1&&(h=k-2,a=1);var l,x,p;this.closed||0<h?l=g[(h-1)%k]:(b.subVectors(g[0],g[1]).add(g[0]),l=b);x=g[h%k];p=g[(h+1)%k];this.closed||h+2<k?g=g[(h+2)%k]:(b.subVectors(g[k-1],g[k-2]).add(g[k-1]),g=b);if(void 0===this.type||"centripetal"===this.type||"chordal"===this.type){var n="chordal"===this.type?.5:
.25;k=Math.pow(l.distanceToSquared(x),n);h=Math.pow(x.distanceToSquared(p),n);n=Math.pow(p.distanceToSquared(g),n);1E-4>h&&(h=1);1E-4>k&&(k=h);1E-4>n&&(n=h);c.initNonuniformCatmullRom(l.x,x.x,p.x,g.x,k,h,n);d.initNonuniformCatmullRom(l.y,x.y,p.y,g.y,k,h,n);e.initNonuniformCatmullRom(l.z,x.z,p.z,g.z,k,h,n)}else"catmullrom"===this.type&&(k=void 0!==this.tension?this.tension:.5,c.initCatmullRom(l.x,x.x,p.x,g.x,k),d.initCatmullRom(l.y,x.y,p.y,g.y,k),e.initCatmullRom(l.z,x.z,p.z,g.z,k));return new q(c.calc(a),
d.calc(a),e.calc(a))})}(),Nf=wa.create(function(a){console.warn("THREE.SplineCurve3 will be deprecated. Please use THREE.CatmullRomCurve3");this.points=void 0===a?[]:a},function(a){var b=this.points;a*=b.length-1;var c=Math.floor(a);a-=c;var d=b[0==c?c:c-1],e=b[c],f=b[c>b.length-2?b.length-1:c+1],b=b[c>b.length-3?b.length-1:c+2],c=ed.interpolate;return new q(c(d.x,e.x,f.x,b.x,a),c(d.y,e.y,f.y,b.y,a),c(d.z,e.z,f.z,b.z,a))}),Of=wa.create(function(a,b,c,d){this.v0=a;this.v1=b;this.v2=c;this.v3=d},function(a){var b=
pa.b3;return new q(b(a,this.v0.x,this.v1.x,this.v2.x,this.v3.x),b(a,this.v0.y,this.v1.y,this.v2.y,this.v3.y),b(a,this.v0.z,this.v1.z,this.v2.z,this.v3.z))}),Pf=wa.create(function(a,b,c){this.v0=a;this.v1=b;this.v2=c},function(a){var b=pa.b2;return new q(b(a,this.v0.x,this.v1.x,this.v2.x),b(a,this.v0.y,this.v1.y,this.v2.y),b(a,this.v0.z,this.v1.z,this.v2.z))}),Qf=wa.create(function(a,b){this.v1=a;this.v2=b},function(a){if(1===a)return this.v2.clone();var b=new q;b.subVectors(this.v2,this.v1);b.multiplyScalar(a);
b.add(this.v1);return b});Gd.prototype=Object.create(Xa.prototype);Gd.prototype.constructor=Gd;Le.prototype=Object.create(ke.prototype);bd.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")};Object.assign(pc.prototype,{center:function(a){console.warn("THREE.Box2: .center() has been renamed to .getCenter().");return this.getCenter(a)},empty:function(){console.warn("THREE.Box2: .empty() has been renamed to .isEmpty().");
return this.isEmpty()},isIntersectionBox:function(a){console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox().");return this.intersectsBox(a)},size:function(a){console.warn("THREE.Box2: .size() has been renamed to .getSize().");return this.getSize(a)}});Object.assign(ya.prototype,{center:function(a){console.warn("THREE.Box3: .center() has been renamed to .getCenter().");return this.getCenter(a)},empty:function(){console.warn("THREE.Box3: .empty() has been renamed to .isEmpty().");
return this.isEmpty()},isIntersectionBox:function(a){console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox().");return this.intersectsBox(a)},isIntersectionSphere:function(a){console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere().");return this.intersectsSphere(a)},size:function(a){console.warn("THREE.Box3: .size() has been renamed to .getSize().");return this.getSize(a)}});gb.prototype.center=function(a){console.warn("THREE.Line3: .center() has been renamed to .getCenter().");
return this.getCenter(a)};Q.random16=function(){console.warn("THREE.Math.random16() has been deprecated. Use Math.random() instead.");return Math.random()};Object.assign(za.prototype,{flattenToArrayOffset:function(a,b){console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead.");return this.toArray(a,b)},multiplyVector3:function(a){console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead.");return a.applyMatrix3(this)},
multiplyVector3Array:function(a){console.warn("THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.");return this.applyToVector3Array(a)},applyToBuffer:function(a,b,c){console.warn("THREE.Matrix3: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead.");return this.applyToBufferAttribute(a)}});Object.assign(H.prototype,{extractPosition:function(a){console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition().");
return this.copyPosition(a)},flattenToArrayOffset:function(a,b){console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead.");return this.toArray(a,b)},getPosition:function(){var a;return function(){void 0===a&&(a=new q);console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");return a.setFromMatrixColumn(this,3)}}(),setRotationFromQuaternion:function(a){console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion().");
return this.makeRotationFromQuaternion(a)},multiplyVector3:function(a){console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead.");return a.applyProjection(this)},multiplyVector4:function(a){console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead.");return a.applyMatrix4(this)},multiplyVector3Array:function(a){console.warn("THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.");
return this.applyToVector3Array(a)},rotateAxis:function(a){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead.");a.transformDirection(this)},crossVector:function(a){console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead.");return a.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},
rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBuffer:function(a,b,c){console.warn("THREE.Matrix4: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead.");return this.applyToBufferAttribute(a)}});ma.prototype.isIntersectionLine=function(a){console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine().");
return this.intersectsLine(a)};da.prototype.multiplyVector3=function(a){console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead.");return a.applyQuaternion(this)};Object.assign(bb.prototype,{isIntersectionBox:function(a){console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox().");return this.intersectsBox(a)},isIntersectionPlane:function(a){console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane().");
return this.intersectsPlane(a)},isIntersectionSphere:function(a){console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere().");return this.intersectsSphere(a)}});Object.assign(Ab.prototype,{extrude:function(a){console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead.");return new La(this,a)},makeGeometry:function(a){console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead.");return new Xb(this,a)}});Object.assign(q.prototype,
{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(a){console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition().");return this.setFromMatrixPosition(a)},getScaleFromMatrix:function(a){console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale().");
return this.setFromMatrixScale(a)},getColumnFromMatrix:function(a,b){console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn().");return this.setFromMatrixColumn(b,a)}});S.prototype.computeTangents=function(){console.warn("THREE.Geometry: .computeTangents() has been removed.")};Object.assign(G.prototype,{getChildByName:function(a){console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName().");return this.getObjectByName(a)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},
translate:function(a,b){console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead.");return this.translateOnAxis(b,a)}});Object.defineProperties(G.prototype,{eulerOrder:{get:function(){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order.");return this.rotation.order},set:function(a){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order.");this.rotation.order=a}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},
set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}});Object.defineProperties(Ac.prototype,{objects:{get:function(){console.warn("THREE.LOD: .objects has been renamed to .levels.");return this.levels}}});Ha.prototype.setLens=function(a,b){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup.");void 0!==b&&(this.filmGauge=b);this.setFocalLength(a)};Object.defineProperties(na.prototype,
{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(a){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov.");this.shadow.camera.fov=a}},shadowCameraLeft:{set:function(a){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left.");this.shadow.camera.left=a}},shadowCameraRight:{set:function(a){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right.");this.shadow.camera.right=a}},shadowCameraTop:{set:function(a){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top.");
this.shadow.camera.top=a}},shadowCameraBottom:{set:function(a){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom.");this.shadow.camera.bottom=a}},shadowCameraNear:{set:function(a){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near.");this.shadow.camera.near=a}},shadowCameraFar:{set:function(a){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far.");this.shadow.camera.far=a}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},
shadowBias:{set:function(a){console.warn("THREE.Light: .shadowBias is now .shadow.bias.");this.shadow.bias=a}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(a){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width.");this.shadow.mapSize.width=a}},shadowMapHeight:{set:function(a){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height.");this.shadow.mapSize.height=a}}});Object.defineProperties(y.prototype,
{length:{get:function(){console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead.");return this.array.length}}});Object.assign(D.prototype,{addIndex:function(a){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex().");this.setIndex(a)},addDrawCall:function(a,b,c){void 0!==c&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset.");console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup().");this.addGroup(a,
b)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups().");this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")}});Object.defineProperties(D.prototype,{drawcalls:{get:function(){console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups.");return this.groups}},offsets:{get:function(){console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups.");
return this.groups}}});Object.defineProperties(Dd.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead.");return this}}});Object.defineProperties(W.prototype,{wrapAround:{get:function(){console.warn("THREE."+this.type+": .wrapAround has been removed.")},set:function(){console.warn("THREE."+this.type+
": .wrapAround has been removed.")}},wrapRGB:{get:function(){console.warn("THREE."+this.type+": .wrapRGB has been removed.");return new N}}});Object.defineProperties(Ca.prototype,{metal:{get:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead.");return!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}});Object.defineProperties(Ia.prototype,{derivatives:{get:function(){console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives.");
return this.extensions.derivatives},set:function(a){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives.");this.extensions.derivatives=a}}});oa.prototype=Object.assign(Object.create({constructor:oa,apply:function(a){console.warn("THREE.EventDispatcher: .apply is deprecated, just inherit or Object.assign the prototype to mix-in.");Object.assign(a,this)}}),oa.prototype);Object.assign(Nd.prototype,{supportsFloatTextures:function(){console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' ).");
return this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' ).");return this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' ).");return this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' ).");
return this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' ).");return this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' ).");return this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures.");
return this.capabilities.vertexTextures},supportsInstancedArrays:function(){console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' ).");return this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(a){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest().");this.setScissorTest(a)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},
addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")}});Object.defineProperties(Nd.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(a){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled.");this.shadowMap.enabled=a}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(a){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type.");
this.shadowMap.type=a}},shadowMapCullFace:{get:function(){return this.shadowMap.cullFace},set:function(a){console.warn("THREE.WebGLRenderer: .shadowMapCullFace is now .shadowMap.cullFace.");this.shadowMap.cullFace=a}}});Object.defineProperties(ye.prototype,{cullFace:{get:function(){return this.renderReverseSided?2:1},set:function(a){a=1!==a;console.warn("WebGLRenderer: .shadowMap.cullFace is deprecated. Set .shadowMap.renderReverseSided to "+a+".");this.renderReverseSided=a}}});Object.defineProperties(Db.prototype,
{wrapS:{get:function(){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS.");return this.texture.wrapS},set:function(a){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS.");this.texture.wrapS=a}},wrapT:{get:function(){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT.");return this.texture.wrapT},set:function(a){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT.");this.texture.wrapT=a}},magFilter:{get:function(){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter.");
return this.texture.magFilter},set:function(a){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter.");this.texture.magFilter=a}},minFilter:{get:function(){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter.");return this.texture.minFilter},set:function(a){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter.");this.texture.minFilter=a}},anisotropy:{get:function(){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy.");
return this.texture.anisotropy},set:function(a){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy.");this.texture.anisotropy=a}},offset:{get:function(){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset.");return this.texture.offset},set:function(a){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset.");this.texture.offset=a}},repeat:{get:function(){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat.");return this.texture.repeat},
set:function(a){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat.");this.texture.repeat=a}},format:{get:function(){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format.");return this.texture.format},set:function(a){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format.");this.texture.format=a}},type:{get:function(){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type.");return this.texture.type},set:function(a){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type.");
this.texture.type=a}},generateMipmaps:{get:function(){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps.");return this.texture.generateMipmaps},set:function(a){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps.");this.texture.generateMipmaps=a}}});ec.prototype.load=function(a){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var b=this;(new Wd).load(a,function(a){b.setBuffer(a)});return this};
ae.prototype.getData=function(){console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData().");return this.getFrequencyData()};l.WebGLRenderTargetCube=Eb;l.WebGLRenderTarget=Db;l.WebGLRenderer=Nd;l.ShaderLib=Gb;l.UniformsLib=U;l.UniformsUtils=Ja;l.ShaderChunk=Z;l.FogExp2=Ib;l.Fog=Jb;l.Scene=jb;l.LensFlare=Od;l.Sprite=zc;l.LOD=Ac;l.SkinnedMesh=jd;l.Skeleton=hd;l.Bone=id;l.Mesh=Ba;l.LineSegments=fa;l.Line=Va;l.Points=Kb;l.Group=Bc;l.VideoTexture=kd;l.DataTexture=db;l.CompressedTexture=
Lb;l.CubeTexture=Za;l.CanvasTexture=ld;l.DepthTexture=Cc;l.Texture=ea;l.CompressedTextureLoader=Ee;l.BinaryTextureLoader=Qd;l.DataTextureLoader=Qd;l.CubeTextureLoader=Rd;l.TextureLoader=md;l.ObjectLoader=Fe;l.MaterialLoader=Ad;l.BufferGeometryLoader=Sd;l.DefaultLoadingManager=va;l.LoadingManager=Pd;l.JSONLoader=Td;l.ImageLoader=Vc;l.FontLoader=Ge;l.FileLoader=Ma;l.Loader=wb;l.Cache=ne;l.AudioLoader=Wd;l.SpotLightShadow=od;l.SpotLight=pd;l.PointLight=qd;l.RectAreaLight=Xd;l.HemisphereLight=nd;l.DirectionalLightShadow=
rd;l.DirectionalLight=sd;l.AmbientLight=td;l.LightShadow=tb;l.Light=na;l.StereoCamera=He;l.PerspectiveCamera=Ha;l.OrthographicCamera=Hb;l.CubeCamera=Bd;l.Camera=sa;l.AudioListener=Yd;l.PositionalAudio=$d;l.AudioContext=Zd;l.AudioAnalyser=ae;l.Audio=ec;l.VectorKeyframeTrack=cc;l.StringKeyframeTrack=xd;l.QuaternionKeyframeTrack=Xc;l.NumberKeyframeTrack=dc;l.ColorKeyframeTrack=zd;l.BooleanKeyframeTrack=yd;l.PropertyMixer=Cd;l.PropertyBinding=ka;l.KeyframeTrack=vb;l.AnimationUtils=ba;l.AnimationObjectGroup=
be;l.AnimationMixer=de;l.AnimationClip=ta;l.Uniform=Dd;l.InstancedBufferGeometry=Bb;l.BufferGeometry=D;l.GeometryIdCount=function(){return Kd++};l.Geometry=S;l.InterleavedBufferAttribute=ee;l.InstancedInterleavedBuffer=gc;l.InterleavedBuffer=fc;l.InstancedBufferAttribute=hc;l.Face3=ha;l.Object3D=G;l.Raycaster=fe;l.Layers=gd;l.EventDispatcher=oa;l.Clock=he;l.QuaternionLinearInterpolant=wd;l.LinearInterpolant=Wc;l.DiscreteInterpolant=vd;l.CubicInterpolant=ud;l.Interpolant=qa;l.Triangle=Aa;l.Spline=
function(a){function b(a,b,c,d,e,f,g){a=.5*(c-a);d=.5*(d-b);return(2*(b-c)+a+d)*g+(-3*(b-c)-2*a-d)*f+a*e+b}this.points=a;var c=[],d={x:0,y:0,z:0},e,f,g,h,k,l,x,p,n;this.initFromArray=function(a){this.points=[];for(var b=0;b<a.length;b++)this.points[b]={x:a[b][0],y:a[b][1],z:a[b][2]}};this.getPoint=function(a){e=(this.points.length-1)*a;f=Math.floor(e);g=e-f;c[0]=0===f?f:f-1;c[1]=f;c[2]=f>this.points.length-2?this.points.length-1:f+1;c[3]=f>this.points.length-3?this.points.length-1:f+2;l=this.points[c[0]];
x=this.points[c[1]];p=this.points[c[2]];n=this.points[c[3]];h=g*g;k=g*h;d.x=b(l.x,x.x,p.x,n.x,g,h,k);d.y=b(l.y,x.y,p.y,n.y,g,h,k);d.z=b(l.z,x.z,p.z,n.z,g,h,k);return d};this.getControlPointsArray=function(){var a,b,c=this.points.length,d=[];for(a=0;a<c;a++)b=this.points[a],d[a]=[b.x,b.y,b.z];return d};this.getLength=function(a){var b,c,d,e=0,f=new q,g=new q,h=[],k=0;h[0]=0;a||(a=100);c=this.points.length*a;f.copy(this.points[0]);for(a=1;a<c;a++)b=a/c,d=this.getPoint(b),g.copy(d),k+=g.distanceTo(f),
f.copy(d),b*=this.points.length-1,b=Math.floor(b),b!==e&&(h[b]=k,e=b);h[h.length]=k;return{chunks:h,total:k}};this.reparametrizeByArcLength=function(a){var b,c,d,e,f,g,h=[],k=new q,l=this.getLength();h.push(k.copy(this.points[0]).clone());for(b=1;b<this.points.length;b++){c=l.chunks[b]-l.chunks[b-1];g=Math.ceil(a*c/l.total);e=(b-1)/(this.points.length-1);f=b/(this.points.length-1);for(c=1;c<g-1;c++)d=e+1/g*c*(f-e),d=this.getPoint(d),h.push(k.copy(d).clone());h.push(k.copy(this.points[b]).clone())}this.points=
h}};l.Math=Q;l.Spherical=ie;l.Cylindrical=je;l.Plane=ma;l.Frustum=qc;l.Sphere=Fa;l.Ray=bb;l.Matrix4=H;l.Matrix3=za;l.Box3=ya;l.Box2=pc;l.Line3=gb;l.Euler=cb;l.Vector4=ga;l.Vector3=q;l.Vector2=C;l.Quaternion=da;l.Color=N;l.MorphBlendMesh=ua;l.ImmediateRenderObject=$c;l.VertexNormalsHelper=ad;l.SpotLightHelper=ic;l.SkeletonHelper=jc;l.PointLightHelper=kc;l.RectAreaLightHelper=lc;l.HemisphereLightHelper=mc;l.GridHelper=bd;l.PolarGridHelper=Ed;l.FaceNormalsHelper=cd;l.DirectionalLightHelper=nc;l.CameraHelper=
dd;l.BoxHelper=oc;l.ArrowHelper=Cb;l.AxisHelper=Fd;l.CatmullRomCurve3=ke;l.SplineCurve3=Nf;l.CubicBezierCurve3=Of;l.QuadraticBezierCurve3=Pf;l.LineCurve3=Qf;l.ArcCurve=Gd;l.EllipseCurve=Xa;l.SplineCurve=xb;l.CubicBezierCurve=yb;l.QuadraticBezierCurve=zb;l.LineCurve=Qa;l.Shape=Ab;l.ShapePath=Ud;l.Path=Zc;l.Font=Vd;l.CurvePath=Yc;l.Curve=wa;l.ShapeUtils=pa;l.SceneUtils={createMultiMaterialObject:function(a,b){for(var c=new Bc,d=0,e=b.length;d<e;d++)c.add(new Ba(a,b[d]));return c},detach:function(a,
b,c){a.applyMatrix(b.matrixWorld);b.remove(a);c.add(a)},attach:function(a,b,c){var d=new H;d.getInverse(c.matrixWorld);a.applyMatrix(d);b.remove(a);c.add(a)}};l.CurveUtils=ed;l.WireframeGeometry=Mb;l.ParametricGeometry=Dc;l.ParametricBufferGeometry=Nb;l.TetrahedronGeometry=Ec;l.TetrahedronBufferGeometry=Ob;l.OctahedronGeometry=Fc;l.OctahedronBufferGeometry=lb;l.IcosahedronGeometry=Gc;l.IcosahedronBufferGeometry=Pb;l.DodecahedronGeometry=Hc;l.DodecahedronBufferGeometry=Qb;l.PolyhedronGeometry=Ic;l.PolyhedronBufferGeometry=
xa;l.TubeGeometry=Jc;l.TubeBufferGeometry=Rb;l.TorusKnotGeometry=Kc;l.TorusKnotBufferGeometry=Sb;l.TorusGeometry=Lc;l.TorusBufferGeometry=Tb;l.TextGeometry=Mc;l.SphereBufferGeometry=mb;l.SphereGeometry=Nc;l.RingGeometry=Oc;l.RingBufferGeometry=Ub;l.PlaneBufferGeometry=ib;l.PlaneGeometry=Pc;l.LatheGeometry=Qc;l.LatheBufferGeometry=Vb;l.ShapeGeometry=Xb;l.ShapeBufferGeometry=Wb;l.ExtrudeGeometry=La;l.EdgesGeometry=Yb;l.ConeGeometry=Rc;l.ConeBufferGeometry=Sc;l.CylinderGeometry=nb;l.CylinderBufferGeometry=
Wa;l.CircleBufferGeometry=Zb;l.CircleGeometry=Tc;l.BoxBufferGeometry=hb;l.BoxGeometry=$b;l.ShadowMaterial=ac;l.SpriteMaterial=kb;l.RawShaderMaterial=bc;l.ShaderMaterial=Ia;l.PointsMaterial=Oa;l.MultiMaterial=Uc;l.MeshPhysicalMaterial=ob;l.MeshStandardMaterial=Pa;l.MeshPhongMaterial=Ca;l.MeshToonMaterial=pb;l.MeshNormalMaterial=qb;l.MeshLambertMaterial=rb;l.MeshDepthMaterial=ab;l.MeshBasicMaterial=Ka;l.LineDashedMaterial=sb;l.LineBasicMaterial=ia;l.Material=W;l.Float64BufferAttribute=wc;l.Float32BufferAttribute=
X;l.Uint32BufferAttribute=Ua;l.Int32BufferAttribute=vc;l.Uint16BufferAttribute=Ra;l.Int16BufferAttribute=uc;l.Uint8ClampedBufferAttribute=tc;l.Uint8BufferAttribute=sc;l.Int8BufferAttribute=rc;l.BufferAttribute=y;l.REVISION="83";l.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2};l.CullFaceNone=0;l.CullFaceBack=1;l.CullFaceFront=2;l.CullFaceFrontBack=3;l.FrontFaceDirectionCW=0;l.FrontFaceDirectionCCW=1;l.BasicShadowMap=0;l.PCFShadowMap=1;l.PCFSoftShadowMap=2;l.FrontSide=0;l.BackSide=1;l.DoubleSide=2;l.FlatShading=1;
l.SmoothShading=2;l.NoColors=0;l.FaceColors=1;l.VertexColors=2;l.NoBlending=0;l.NormalBlending=1;l.AdditiveBlending=2;l.SubtractiveBlending=3;l.MultiplyBlending=4;l.CustomBlending=5;l.BlendingMode=Me;l.AddEquation=100;l.SubtractEquation=101;l.ReverseSubtractEquation=102;l.MinEquation=103;l.MaxEquation=104;l.ZeroFactor=200;l.OneFactor=201;l.SrcColorFactor=202;l.OneMinusSrcColorFactor=203;l.SrcAlphaFactor=204;l.OneMinusSrcAlphaFactor=205;l.DstAlphaFactor=206;l.OneMinusDstAlphaFactor=207;l.DstColorFactor=
208;l.OneMinusDstColorFactor=209;l.SrcAlphaSaturateFactor=210;l.NeverDepth=0;l.AlwaysDepth=1;l.LessDepth=2;l.LessEqualDepth=3;l.EqualDepth=4;l.GreaterEqualDepth=5;l.GreaterDepth=6;l.NotEqualDepth=7;l.MultiplyOperation=0;l.MixOperation=1;l.AddOperation=2;l.NoToneMapping=0;l.LinearToneMapping=1;l.ReinhardToneMapping=2;l.Uncharted2ToneMapping=3;l.CineonToneMapping=4;l.UVMapping=300;l.CubeReflectionMapping=301;l.CubeRefractionMapping=302;l.EquirectangularReflectionMapping=303;l.EquirectangularRefractionMapping=
304;l.SphericalReflectionMapping=305;l.CubeUVReflectionMapping=306;l.CubeUVRefractionMapping=307;l.TextureMapping=Ne;l.RepeatWrapping=1E3;l.ClampToEdgeWrapping=1001;l.MirroredRepeatWrapping=1002;l.TextureWrapping=le;l.NearestFilter=1003;l.NearestMipMapNearestFilter=1004;l.NearestMipMapLinearFilter=1005;l.LinearFilter=1006;l.LinearMipMapNearestFilter=1007;l.LinearMipMapLinearFilter=1008;l.TextureFilter=me;l.UnsignedByteType=1009;l.ByteType=1010;l.ShortType=1011;l.UnsignedShortType=1012;l.IntType=1013;
l.UnsignedIntType=1014;l.FloatType=1015;l.HalfFloatType=1016;l.UnsignedShort4444Type=1017;l.UnsignedShort5551Type=1018;l.UnsignedShort565Type=1019;l.UnsignedInt248Type=1020;l.AlphaFormat=1021;l.RGBFormat=1022;l.RGBAFormat=1023;l.LuminanceFormat=1024;l.LuminanceAlphaFormat=1025;l.RGBEFormat=1023;l.DepthFormat=1026;l.DepthStencilFormat=1027;l.RGB_S3TC_DXT1_Format=2001;l.RGBA_S3TC_DXT1_Format=2002;l.RGBA_S3TC_DXT3_Format=2003;l.RGBA_S3TC_DXT5_Format=2004;l.RGB_PVRTC_4BPPV1_Format=2100;l.RGB_PVRTC_2BPPV1_Format=
2101;l.RGBA_PVRTC_4BPPV1_Format=2102;l.RGBA_PVRTC_2BPPV1_Format=2103;l.RGB_ETC1_Format=2151;l.LoopOnce=2200;l.LoopRepeat=2201;l.LoopPingPong=2202;l.InterpolateDiscrete=2300;l.InterpolateLinear=2301;l.InterpolateSmooth=2302;l.ZeroCurvatureEnding=2400;l.ZeroSlopeEnding=2401;l.WrapAroundEnding=2402;l.TrianglesDrawMode=0;l.TriangleStripDrawMode=1;l.TriangleFanDrawMode=2;l.LinearEncoding=3E3;l.sRGBEncoding=3001;l.GammaEncoding=3007;l.RGBEEncoding=3002;l.LogLuvEncoding=3003;l.RGBM7Encoding=3004;l.RGBM16Encoding=
3005;l.RGBDEncoding=3006;l.BasicDepthPacking=3200;l.RGBADepthPacking=3201;l.CubeGeometry=$b;l.Face4=function(a,b,c,d,e,f,g){console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead.");return new ha(a,b,c,e,f,g)};l.LineStrip=0;l.LinePieces=1;l.MeshFaceMaterial=function(a){console.warn("THREE.MeshFaceMaterial has been renamed to THREE.MultiMaterial.");return new Uc(a)};l.PointCloud=function(a,b){console.warn("THREE.PointCloud has been renamed to THREE.Points.");return new Kb(a,
b)};l.Particle=function(a){console.warn("THREE.Particle has been renamed to THREE.Sprite.");return new zc(a)};l.ParticleSystem=function(a,b){console.warn("THREE.ParticleSystem has been renamed to THREE.Points.");return new Kb(a,b)};l.PointCloudMaterial=function(a){console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial.");return new Oa(a)};l.ParticleBasicMaterial=function(a){console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial.");return new Oa(a)};
l.ParticleSystemMaterial=function(a){console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial.");return new Oa(a)};l.Vertex=function(a,b,c){console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead.");return new q(a,b,c)};l.DynamicBufferAttribute=function(a,b){console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setDynamic( true ) instead.");return(new y(a,b)).setDynamic(!0)};l.Int8Attribute=function(a,b){console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead.");
return new rc(a,b)};l.Uint8Attribute=function(a,b){console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead.");return new sc(a,b)};l.Uint8ClampedAttribute=function(a,b){console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead.");return new tc(a,b)};l.Int16Attribute=function(a,b){console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead.");return new uc(a,b)};l.Uint16Attribute=
function(a,b){console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead.");return new Ra(a,b)};l.Int32Attribute=function(a,b){console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead.");return new vc(a,b)};l.Uint32Attribute=function(a,b){console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead.");return new Ua(a,b)};l.Float32Attribute=function(a,b){console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead.");
return new X(a,b)};l.Float64Attribute=function(a,b){console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead.");return new wc(a,b)};l.ClosedSplineCurve3=Le;l.BoundingBoxHelper=function(a,b){console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead.");return new oc(a,b)};l.EdgesHelper=function(a,b){console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead.");return new fa(new Yb(a.geometry),new ia({color:void 0!==
b?b:16777215}))};l.WireframeHelper=function(a,b){console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead.");return new fa(new Mb(a.geometry),new ia({color:void 0!==b?b:16777215}))};l.XHRLoader=function(a){console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader.");return new Ma(a)};l.GeometryUtils={merge:function(a,b,c){console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.");
var d;b.isMesh&&(b.matrixAutoUpdate&&b.updateMatrix(),d=b.matrix,b=b.geometry);a.merge(b,d,c)},center:function(a){console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead.");return a.center()}};l.ImageUtils={crossOrigin:void 0,loadTexture:function(a,b,c,d){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var e=new md;e.setCrossOrigin(this.crossOrigin);a=e.load(a,c,void 0,d);b&&(a.mapping=b);return a},
loadTextureCube:function(a,b,c,d){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var e=new Rd;e.setCrossOrigin(this.crossOrigin);a=e.load(a,c,void 0,d);b&&(a.mapping=b);return a},loadCompressedTexture:function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},loadCompressedTextureCube:function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")}};
l.Projector=function(){console.error("THREE.Projector has been moved to /examples/js/renderers/Projector.js.");this.projectVector=function(a,b){console.warn("THREE.Projector: .projectVector() is now vector.project().");a.project(b)};this.unprojectVector=function(a,b){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject().");a.unproject(b)};this.pickingRay=function(){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")}};l.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js");
this.domElement=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");this.clear=function(){};this.render=function(){};this.setClearColor=function(){};this.setSize=function(){}};Object.defineProperty(l,"__esModule",{value:!0})});

/**
 * @author alteredq / http://alteredqualia.com/
 */

THREE.EffectComposer = function ( renderer, renderTarget ) {

	this.renderer = renderer;

	if ( renderTarget === undefined ) {

		var parameters = {
			minFilter: THREE.LinearFilter,
			magFilter: THREE.LinearFilter,
			format: THREE.RGBAFormat,
			stencilBuffer: false
		};
		var size = renderer.getSize();
		renderTarget = new THREE.WebGLRenderTarget( size.width, size.height, parameters );

	}

	this.renderTarget1 = renderTarget;
	this.renderTarget2 = renderTarget.clone();

	this.writeBuffer = this.renderTarget1;
	this.readBuffer = this.renderTarget2;

	this.passes = [];

	if ( THREE.CopyShader === undefined )
		console.error( "THREE.EffectComposer relies on THREE.CopyShader" );

	this.copyPass = new THREE.ShaderPass( THREE.CopyShader );

};

Object.assign( THREE.EffectComposer.prototype, {

	swapBuffers: function() {

		var tmp = this.readBuffer;
		this.readBuffer = this.writeBuffer;
		this.writeBuffer = tmp;

	},

	addPass: function ( pass ) {

		this.passes.push( pass );

		var size = this.renderer.getSize();
		pass.setSize( size.width, size.height );

	},

	insertPass: function ( pass, index ) {

		this.passes.splice( index, 0, pass );

	},

	render: function ( delta ) {

		var maskActive = false;

		var pass, i, il = this.passes.length;

		for ( i = 0; i < il; i ++ ) {

			pass = this.passes[ i ];

			if ( pass.enabled === false ) continue;

			pass.render( this.renderer, this.writeBuffer, this.readBuffer, delta, maskActive );

			if ( pass.needsSwap ) {

				if ( maskActive ) {

					var context = this.renderer.context;

					context.stencilFunc( context.NOTEQUAL, 1, 0xffffffff );

					this.copyPass.render( this.renderer, this.writeBuffer, this.readBuffer, delta );

					context.stencilFunc( context.EQUAL, 1, 0xffffffff );

				}

				this.swapBuffers();

			}

			if ( THREE.MaskPass !== undefined ) {

				if ( pass instanceof THREE.MaskPass ) {

					maskActive = true;

				} else if ( pass instanceof THREE.ClearMaskPass ) {

					maskActive = false;

				}

			}

		}

	},

	reset: function ( renderTarget ) {

		if ( renderTarget === undefined ) {

			var size = this.renderer.getSize();

			renderTarget = this.renderTarget1.clone();
			renderTarget.setSize( size.width, size.height );

		}

		this.renderTarget1.dispose();
		this.renderTarget2.dispose();
		this.renderTarget1 = renderTarget;
		this.renderTarget2 = renderTarget.clone();

		this.writeBuffer = this.renderTarget1;
		this.readBuffer = this.renderTarget2;

	},

	setSize: function ( width, height ) {

		this.renderTarget1.setSize( width, height );
		this.renderTarget2.setSize( width, height );

		for ( var i = 0; i < this.passes.length; i ++ ) {

			this.passes[i].setSize( width, height );

		}

	}

} );


THREE.Pass = function () {

	// if set to true, the pass is processed by the composer
	this.enabled = true;

	// if set to true, the pass indicates to swap read and write buffer after rendering
	this.needsSwap = true;

	// if set to true, the pass clears its buffer before rendering
	this.clear = false;

	// if set to true, the result of the pass is rendered to screen
	this.renderToScreen = false;

};

Object.assign( THREE.Pass.prototype, {

	setSize: function( width, height ) {},

	render: function ( renderer, writeBuffer, readBuffer, delta, maskActive ) {

		console.error( "THREE.Pass: .render() must be implemented in derived pass." );

	}

} );

/**
 * @author miibond
 * Generate a texture that represents the luminosity of the current scene, adapted over time
 * to simulate the optic nerve responding to the amount of light it is receiving.
 * Based on a GDC2007 presentation by Wolfgang Engel titled "Post-Processing Pipeline"
 *
 * Full-screen tone-mapping shader based on http://www.graphics.cornell.edu/~jaf/publications/sig02_paper.pdf
 */

THREE.AdaptiveToneMappingPass = function ( adaptive, resolution ) {

	THREE.Pass.call( this );

	this.resolution = ( resolution !== undefined ) ? resolution : 256;
	this.needsInit = true;
	this.adaptive = adaptive !== undefined ? !! adaptive : true;

	this.luminanceRT = null;
	this.previousLuminanceRT = null;
	this.currentLuminanceRT = null;

	if ( THREE.CopyShader === undefined )
		console.error( "THREE.AdaptiveToneMappingPass relies on THREE.CopyShader" );

	var copyShader = THREE.CopyShader;

	this.copyUniforms = THREE.UniformsUtils.clone( copyShader.uniforms );

	this.materialCopy = new THREE.ShaderMaterial( {

		uniforms: this.copyUniforms,
		vertexShader: copyShader.vertexShader,
		fragmentShader: copyShader.fragmentShader,
		blending: THREE.NoBlending,
		depthTest: false

	} );

	if ( THREE.LuminosityShader === undefined )
		console.error( "THREE.AdaptiveToneMappingPass relies on THREE.LuminosityShader" );

	this.materialLuminance = new THREE.ShaderMaterial( {

		uniforms: THREE.UniformsUtils.clone( THREE.LuminosityShader.uniforms ),
		vertexShader: THREE.LuminosityShader.vertexShader,
		fragmentShader: THREE.LuminosityShader.fragmentShader,
		blending: THREE.NoBlending
	} );

	this.adaptLuminanceShader = {
		defines: {
			"MIP_LEVEL_1X1" : ( Math.log( this.resolution ) / Math.log( 2.0 ) ).toFixed( 1 )
		},
		uniforms: {
			"lastLum": { value: null },
			"currentLum": { value: null },
			"delta": { value: 0.016 },
			"tau": { value: 1.0 }
		},
		vertexShader: [
			"varying vec2 vUv;",

			"void main() {",

				"vUv = uv;",
				"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

			"}"
		].join( '\n' ),
		fragmentShader: [
			"varying vec2 vUv;",

			"uniform sampler2D lastLum;",
			"uniform sampler2D currentLum;",
			"uniform float delta;",
			"uniform float tau;",

			"void main() {",

				"vec4 lastLum = texture2D( lastLum, vUv, MIP_LEVEL_1X1 );",
				"vec4 currentLum = texture2D( currentLum, vUv, MIP_LEVEL_1X1 );",

				"float fLastLum = lastLum.r;",
				"float fCurrentLum = currentLum.r;",

				//The adaption seems to work better in extreme lighting differences
				//if the input luminance is squared.
				"fCurrentLum *= fCurrentLum;",

				// Adapt the luminance using Pattanaik's technique
				"float fAdaptedLum = fLastLum + (fCurrentLum - fLastLum) * (1.0 - exp(-delta * tau));",
				// "fAdaptedLum = sqrt(fAdaptedLum);",
				"gl_FragColor = vec4( vec3( fAdaptedLum ), 1.0 );",
			"}"
		].join( '\n' )
	};

	this.materialAdaptiveLum = new THREE.ShaderMaterial( {

		uniforms: THREE.UniformsUtils.clone( this.adaptLuminanceShader.uniforms ),
		vertexShader: this.adaptLuminanceShader.vertexShader,
		fragmentShader: this.adaptLuminanceShader.fragmentShader,
		defines: this.adaptLuminanceShader.defines,
		blending: THREE.NoBlending
	} );

	if ( THREE.ToneMapShader === undefined )
		console.error( "THREE.AdaptiveToneMappingPass relies on THREE.ToneMapShader" );

	this.materialToneMap = new THREE.ShaderMaterial( {

		uniforms: THREE.UniformsUtils.clone( THREE.ToneMapShader.uniforms ),
		vertexShader: THREE.ToneMapShader.vertexShader,
		fragmentShader: THREE.ToneMapShader.fragmentShader,
		blending: THREE.NoBlending
	} );

	this.camera = new THREE.OrthographicCamera( - 1, 1, 1, - 1, 0, 1 );
	this.scene  = new THREE.Scene();

	this.quad = new THREE.Mesh( new THREE.PlaneBufferGeometry( 2, 2 ), null );
	this.scene.add( this.quad );

};

THREE.AdaptiveToneMappingPass.prototype = Object.assign( Object.create( THREE.Pass.prototype ), {

	constructor: THREE.AdaptiveToneMappingPass,

	render: function ( renderer, writeBuffer, readBuffer, delta, maskActive ) {

		if ( this.needsInit ) {

			this.reset( renderer );

			this.luminanceRT.texture.type = readBuffer.texture.type;
			this.previousLuminanceRT.texture.type = readBuffer.texture.type;
			this.currentLuminanceRT.texture.type = readBuffer.texture.type;
			this.needsInit = false;

		}

		if ( this.adaptive ) {

			//Render the luminance of the current scene into a render target with mipmapping enabled
			this.quad.material = this.materialLuminance;
			this.materialLuminance.uniforms.tDiffuse.value = readBuffer.texture;
			renderer.render( this.scene, this.camera, this.currentLuminanceRT );

			//Use the new luminance values, the previous luminance and the frame delta to
			//adapt the luminance over time.
			this.quad.material = this.materialAdaptiveLum;
			this.materialAdaptiveLum.uniforms.delta.value = delta;
			this.materialAdaptiveLum.uniforms.lastLum.value = this.previousLuminanceRT.texture;
			this.materialAdaptiveLum.uniforms.currentLum.value = this.currentLuminanceRT.texture;
			renderer.render( this.scene, this.camera, this.luminanceRT );

			//Copy the new adapted luminance value so that it can be used by the next frame.
			this.quad.material = this.materialCopy;
			this.copyUniforms.tDiffuse.value = this.luminanceRT.texture;
			renderer.render( this.scene, this.camera, this.previousLuminanceRT );

		}

		this.quad.material = this.materialToneMap;
		this.materialToneMap.uniforms.tDiffuse.value = readBuffer.texture;
		renderer.render( this.scene, this.camera, writeBuffer, this.clear );

	},

	reset: function( renderer ) {

		// render targets
		if ( this.luminanceRT ) {

			this.luminanceRT.dispose();

		}
		if ( this.currentLuminanceRT ) {

			this.currentLuminanceRT.dispose();

		}
		if ( this.previousLuminanceRT ) {

			this.previousLuminanceRT.dispose();

		}

		var pars = { minFilter: THREE.LinearFilter, magFilter: THREE.LinearFilter, format: THREE.RGBAFormat }; // was RGB format. changed to RGBA format. see discussion in #8415 / #8450

		this.luminanceRT = new THREE.WebGLRenderTarget( this.resolution, this.resolution, pars );
		this.luminanceRT.texture.generateMipmaps = false;

		this.previousLuminanceRT = new THREE.WebGLRenderTarget( this.resolution, this.resolution, pars );
		this.previousLuminanceRT.texture.generateMipmaps = false;

		// We only need mipmapping for the current luminosity because we want a down-sampled version to sample in our adaptive shader
		pars.minFilter = THREE.LinearMipMapLinearFilter;
		this.currentLuminanceRT = new THREE.WebGLRenderTarget( this.resolution, this.resolution, pars );

		if ( this.adaptive ) {

			this.materialToneMap.defines[ "ADAPTED_LUMINANCE" ] = "";
			this.materialToneMap.uniforms.luminanceMap.value = this.luminanceRT.texture;

		}
		//Put something in the adaptive luminance texture so that the scene can render initially
		this.quad.material = new THREE.MeshBasicMaterial( { color: 0x777777 } );
		this.materialLuminance.needsUpdate = true;
		this.materialAdaptiveLum.needsUpdate = true;
		this.materialToneMap.needsUpdate = true;
		// renderer.render( this.scene, this.camera, this.luminanceRT );
		// renderer.render( this.scene, this.camera, this.previousLuminanceRT );
		// renderer.render( this.scene, this.camera, this.currentLuminanceRT );

	},

	setAdaptive: function( adaptive ) {

		if ( adaptive ) {

			this.adaptive = true;
			this.materialToneMap.defines[ "ADAPTED_LUMINANCE" ] = "";
			this.materialToneMap.uniforms.luminanceMap.value = this.luminanceRT.texture;

		} else {

			this.adaptive = false;
			delete this.materialToneMap.defines[ "ADAPTED_LUMINANCE" ];
			this.materialToneMap.uniforms.luminanceMap.value = null;

		}
		this.materialToneMap.needsUpdate = true;

	},

	setAdaptionRate: function( rate ) {

		if ( rate ) {

			this.materialAdaptiveLum.uniforms.tau.value = Math.abs( rate );

		}

	},

	setMaxLuminance: function( maxLum ) {

		if ( maxLum ) {

			this.materialToneMap.uniforms.maxLuminance.value = maxLum;

		}

	},

	setAverageLuminance: function( avgLum ) {

		if ( avgLum ) {

			this.materialToneMap.uniforms.averageLuminance.value = avgLum;

		}

	},

	setMiddleGrey: function( middleGrey ) {

		if ( middleGrey ) {

			this.materialToneMap.uniforms.middleGrey.value = middleGrey;

		}

	},

	dispose: function() {

		if ( this.luminanceRT ) {

			this.luminanceRT.dispose();

		}
		if ( this.previousLuminanceRT ) {

			this.previousLuminanceRT.dispose();

		}
		if ( this.currentLuminanceRT ) {

			this.currentLuminanceRT.dispose();

		}
		if ( this.materialLuminance ) {

			this.materialLuminance.dispose();

		}
		if ( this.materialAdaptiveLum ) {

			this.materialAdaptiveLum.dispose();

		}
		if ( this.materialCopy ) {

			this.materialCopy.dispose();

		}
		if ( this.materialToneMap ) {

			this.materialToneMap.dispose();

		}

	}

} );

/**
 * @author alteredq / http://alteredqualia.com/
 */

THREE.BloomPass = function ( strength, kernelSize, sigma, resolution ) {

	THREE.Pass.call( this );

	strength = ( strength !== undefined ) ? strength : 1;
	kernelSize = ( kernelSize !== undefined ) ? kernelSize : 25;
	sigma = ( sigma !== undefined ) ? sigma : 4.0;
	resolution = ( resolution !== undefined ) ? resolution : 256;

	// render targets

	var pars = { minFilter: THREE.LinearFilter, magFilter: THREE.LinearFilter, format: THREE.RGBAFormat };

	this.renderTargetX = new THREE.WebGLRenderTarget( resolution, resolution, pars );
	this.renderTargetY = new THREE.WebGLRenderTarget( resolution, resolution, pars );

	// copy material

	if ( THREE.CopyShader === undefined )
		console.error( "THREE.BloomPass relies on THREE.CopyShader" );

	var copyShader = THREE.CopyShader;

	this.copyUniforms = THREE.UniformsUtils.clone( copyShader.uniforms );

	this.copyUniforms[ "opacity" ].value = strength;

	this.materialCopy = new THREE.ShaderMaterial( {

		uniforms: this.copyUniforms,
		vertexShader: copyShader.vertexShader,
		fragmentShader: copyShader.fragmentShader,
		blending: THREE.AdditiveBlending,
		transparent: true

	} );

	// convolution material

	if ( THREE.ConvolutionShader === undefined )
		console.error( "THREE.BloomPass relies on THREE.ConvolutionShader" );

	var convolutionShader = THREE.ConvolutionShader;

	this.convolutionUniforms = THREE.UniformsUtils.clone( convolutionShader.uniforms );

	this.convolutionUniforms[ "uImageIncrement" ].value = THREE.BloomPass.blurX;
	this.convolutionUniforms[ "cKernel" ].value = THREE.ConvolutionShader.buildKernel( sigma );

	this.materialConvolution = new THREE.ShaderMaterial( {

		uniforms: this.convolutionUniforms,
		vertexShader:  convolutionShader.vertexShader,
		fragmentShader: convolutionShader.fragmentShader,
		defines: {
			"KERNEL_SIZE_FLOAT": kernelSize.toFixed( 1 ),
			"KERNEL_SIZE_INT": kernelSize.toFixed( 0 )
		}

	} );

	this.needsSwap = false;

	this.camera = new THREE.OrthographicCamera( - 1, 1, 1, - 1, 0, 1 );
	this.scene  = new THREE.Scene();

	this.quad = new THREE.Mesh( new THREE.PlaneBufferGeometry( 2, 2 ), null );
	this.scene.add( this.quad );

};

THREE.BloomPass.prototype = Object.assign( Object.create( THREE.Pass.prototype ), {

	constructor: THREE.BloomPass,

	render: function ( renderer, writeBuffer, readBuffer, delta, maskActive ) {

		if ( maskActive ) renderer.context.disable( renderer.context.STENCIL_TEST );

		// Render quad with blured scene into texture (convolution pass 1)

		this.quad.material = this.materialConvolution;

		this.convolutionUniforms[ "tDiffuse" ].value = readBuffer.texture;
		this.convolutionUniforms[ "uImageIncrement" ].value = THREE.BloomPass.blurX;

		renderer.render( this.scene, this.camera, this.renderTargetX, true );


		// Render quad with blured scene into texture (convolution pass 2)

		this.convolutionUniforms[ "tDiffuse" ].value = this.renderTargetX.texture;
		this.convolutionUniforms[ "uImageIncrement" ].value = THREE.BloomPass.blurY;

		renderer.render( this.scene, this.camera, this.renderTargetY, true );

		// Render original scene with superimposed blur to texture

		this.quad.material = this.materialCopy;

		this.copyUniforms[ "tDiffuse" ].value = this.renderTargetY.texture;

		if ( maskActive ) renderer.context.enable( renderer.context.STENCIL_TEST );

		renderer.render( this.scene, this.camera, readBuffer, this.clear );

	}

} );

THREE.BloomPass.blurX = new THREE.Vector2( 0.001953125, 0.0 );
THREE.BloomPass.blurY = new THREE.Vector2( 0.0, 0.001953125 );

/**
 * Depth-of-field post-process with bokeh shader
 */


THREE.BokehPass = function ( scene, camera, params ) {

	THREE.Pass.call( this );

	this.scene = scene;
	this.camera = camera;

	var focus = ( params.focus !== undefined ) ? params.focus : 1.0;
	var aspect = ( params.aspect !== undefined ) ? params.aspect : camera.aspect;
	var aperture = ( params.aperture !== undefined ) ? params.aperture : 0.025;
	var maxblur = ( params.maxblur !== undefined ) ? params.maxblur : 1.0;

	// render targets

	var width = params.width || window.innerWidth || 1;
	var height = params.height || window.innerHeight || 1;

	this.renderTargetColor = new THREE.WebGLRenderTarget( width, height, {
		minFilter: THREE.LinearFilter,
		magFilter: THREE.LinearFilter,
		format: THREE.RGBFormat
	} );

	this.renderTargetDepth = this.renderTargetColor.clone();

	// depth material

	this.materialDepth = new THREE.MeshDepthMaterial();

	// bokeh material

	if ( THREE.BokehShader === undefined ) {

		console.error( "THREE.BokehPass relies on THREE.BokehShader" );

	}

	var bokehShader = THREE.BokehShader;
	var bokehUniforms = THREE.UniformsUtils.clone( bokehShader.uniforms );

	bokehUniforms[ "tDepth" ].value = this.renderTargetDepth.texture;

	bokehUniforms[ "focus" ].value = focus;
	bokehUniforms[ "aspect" ].value = aspect;
	bokehUniforms[ "aperture" ].value = aperture;
	bokehUniforms[ "maxblur" ].value = maxblur;

	this.materialBokeh = new THREE.ShaderMaterial( {
		uniforms: bokehUniforms,
		vertexShader: bokehShader.vertexShader,
		fragmentShader: bokehShader.fragmentShader
	} );

	this.uniforms = bokehUniforms;
	this.needsSwap = false;

	this.camera2 = new THREE.OrthographicCamera( - 1, 1, 1, - 1, 0, 1 );
	this.scene2  = new THREE.Scene();

	this.quad2 = new THREE.Mesh( new THREE.PlaneBufferGeometry( 2, 2 ), null );
	this.scene2.add( this.quad2 );

};

THREE.BokehPass.prototype = Object.assign( Object.create( THREE.Pass.prototype ), {

	constructor: THREE.BokehPass,

	render: function ( renderer, writeBuffer, readBuffer, delta, maskActive ) {

		this.quad2.material = this.materialBokeh;

		// Render depth into texture

		this.scene.overrideMaterial = this.materialDepth;

		renderer.render( this.scene, this.camera, this.renderTargetDepth, true );

		// Render bokeh composite

		this.uniforms[ "tColor" ].value = readBuffer.texture;

		if ( this.renderToScreen ) {

			renderer.render( this.scene2, this.camera2 );

		} else {

			renderer.render( this.scene2, this.camera2, writeBuffer, this.clear );

		}

		this.scene.overrideMaterial = null;

	}

} );

/**
 * @author mrdoob / http://mrdoob.com/
 */

THREE.ClearPass = function ( clearColor, clearAlpha ) {

	THREE.Pass.call( this );

	this.needsSwap = false;

	this.clearColor = ( clearColor !== undefined ) ? clearColor : 0x000000;
	this.clearAlpha = ( clearAlpha !== undefined ) ? clearAlpha : 0;

};

THREE.ClearPass.prototype = Object.assign( Object.create( THREE.Pass.prototype ), {

	constructor: THREE.ClearPass,

	render: function ( renderer, writeBuffer, readBuffer, delta, maskActive ) {

		var oldClearColor, oldClearAlpha;

		if ( this.clearColor ) {

			oldClearColor = renderer.getClearColor().getHex();
			oldClearAlpha = renderer.getClearAlpha();

			renderer.setClearColor( this.clearColor, this.clearAlpha );

		}

		renderer.setRenderTarget( this.renderToScreen ? null : readBuffer );
		renderer.clear();

		if ( this.clearColor ) {

			renderer.setClearColor( oldClearColor, oldClearAlpha );

		}

	}

} );

/**
 * @author bhouston / http://clara.io/
 */

THREE.CubeTexturePass = function ( camera, envMap, opacity ) {

	THREE.Pass.call( this );

	this.camera = camera;

	this.needsSwap = false;

	this.cubeShader = THREE.ShaderLib[ 'cube' ];
	this.cubeMesh = new THREE.Mesh(
		new THREE.BoxBufferGeometry( 10, 10, 10 ),
		new THREE.ShaderMaterial( {
			uniforms: this.cubeShader.uniforms,
			vertexShader: this.cubeShader.vertexShader,
			fragmentShader: this.cubeShader.fragmentShader,
			depthTest: false,
			depthWrite: false,
			side: THREE.BackSide
		} )
	);

	this.envMap = envMap;
	this.opacity = ( opacity !== undefined ) ? opacity : 1.0;

	this.cubeScene = new THREE.Scene();
	this.cubeCamera = new THREE.PerspectiveCamera();
	this.cubeScene.add( this.cubeMesh );

};

THREE.CubeTexturePass.prototype = Object.assign( Object.create( THREE.Pass.prototype ), {

	constructor: THREE.CubeTexturePass,

	render: function ( renderer, writeBuffer, readBuffer, delta, maskActive ) {

		var oldAutoClear = renderer.autoClear;
		renderer.autoClear = false;

		this.cubeCamera.projectionMatrix.copy( this.camera.projectionMatrix );
		this.cubeCamera.quaternion.setFromRotationMatrix( this.camera.matrixWorld );

		this.cubeMesh.material.uniforms[ "tCube" ].value = this.envMap;
		this.cubeMesh.material.uniforms[ "opacity" ].value = this.opacity;
		this.cubeMesh.material.transparent = ( this.opacity < 1.0 );

		renderer.render( this.cubeScene, this.cubeCamera, this.renderToScreen ? null : readBuffer, this.clear );

		renderer.autoClear = oldAutoClear;

	}

} );

/**
 * @author alteredq / http://alteredqualia.com/
 */

THREE.DotScreenPass = function ( center, angle, scale ) {

	THREE.Pass.call( this );

	if ( THREE.DotScreenShader === undefined )
		console.error( "THREE.DotScreenPass relies on THREE.DotScreenShader" );

	var shader = THREE.DotScreenShader;

	this.uniforms = THREE.UniformsUtils.clone( shader.uniforms );

	if ( center !== undefined ) this.uniforms[ "center" ].value.copy( center );
	if ( angle !== undefined ) this.uniforms[ "angle" ].value = angle;
	if ( scale !== undefined ) this.uniforms[ "scale" ].value = scale;

	this.material = new THREE.ShaderMaterial( {

		uniforms: this.uniforms,
		vertexShader: shader.vertexShader,
		fragmentShader: shader.fragmentShader

	} );

	this.camera = new THREE.OrthographicCamera( - 1, 1, 1, - 1, 0, 1 );
	this.scene  = new THREE.Scene();

	this.quad = new THREE.Mesh( new THREE.PlaneBufferGeometry( 2, 2 ), null );
	this.scene.add( this.quad );

};

THREE.DotScreenPass.prototype = Object.assign( Object.create( THREE.Pass.prototype ), {

	constructor: THREE.DotScreenPass,

	render: function ( renderer, writeBuffer, readBuffer, delta, maskActive ) {

		this.uniforms[ "tDiffuse" ].value = readBuffer.texture;
		this.uniforms[ "tSize" ].value.set( readBuffer.width, readBuffer.height );

		this.quad.material = this.material;

		if ( this.renderToScreen ) {

			renderer.render( this.scene, this.camera );

		} else {

			renderer.render( this.scene, this.camera, writeBuffer, this.clear );

		}

	}

} );

/**
 * @author alteredq / http://alteredqualia.com/
 */

THREE.FilmPass = function ( noiseIntensity, scanlinesIntensity, scanlinesCount, grayscale ) {

	THREE.Pass.call( this );

	if ( THREE.FilmShader === undefined )
		console.error( "THREE.FilmPass relies on THREE.FilmShader" );

	var shader = THREE.FilmShader;

	this.uniforms = THREE.UniformsUtils.clone( shader.uniforms );

	this.material = new THREE.ShaderMaterial( {

		uniforms: this.uniforms,
		vertexShader: shader.vertexShader,
		fragmentShader: shader.fragmentShader

	} );

	if ( grayscale !== undefined )	this.uniforms.grayscale.value = grayscale;
	if ( noiseIntensity !== undefined ) this.uniforms.nIntensity.value = noiseIntensity;
	if ( scanlinesIntensity !== undefined ) this.uniforms.sIntensity.value = scanlinesIntensity;
	if ( scanlinesCount !== undefined ) this.uniforms.sCount.value = scanlinesCount;

	this.camera = new THREE.OrthographicCamera( - 1, 1, 1, - 1, 0, 1 );
	this.scene  = new THREE.Scene();

	this.quad = new THREE.Mesh( new THREE.PlaneBufferGeometry( 2, 2 ), null );
	this.scene.add( this.quad );

};

THREE.FilmPass.prototype = Object.assign( Object.create( THREE.Pass.prototype ), {

	constructor: THREE.FilmPass,

	render: function ( renderer, writeBuffer, readBuffer, delta, maskActive ) {

		this.uniforms[ "tDiffuse" ].value = readBuffer.texture;
		this.uniforms[ "time" ].value += delta;

		this.quad.material = this.material;

		if ( this.renderToScreen ) {

			renderer.render( this.scene, this.camera );

		} else {

			renderer.render( this.scene, this.camera, writeBuffer, this.clear );

		}

	}

} );

/**
 * @author alteredq / http://alteredqualia.com/
 */

THREE.GlitchPass = function ( dt_size ) {

	THREE.Pass.call( this );

	if ( THREE.DigitalGlitch === undefined ) console.error( "THREE.GlitchPass relies on THREE.DigitalGlitch" );

	var shader = THREE.DigitalGlitch;
	this.uniforms = THREE.UniformsUtils.clone( shader.uniforms );

	if ( dt_size == undefined ) dt_size = 64;


	this.uniforms[ "tDisp" ].value = this.generateHeightmap( dt_size );


	this.material = new THREE.ShaderMaterial( {
		uniforms: this.uniforms,
		vertexShader: shader.vertexShader,
		fragmentShader: shader.fragmentShader
	} );

	this.camera = new THREE.OrthographicCamera( - 1, 1, 1, - 1, 0, 1 );
	this.scene  = new THREE.Scene();

	this.quad = new THREE.Mesh( new THREE.PlaneBufferGeometry( 2, 2 ), null );
	this.scene.add( this.quad );

	this.goWild = false;
	this.curF = 0;
	this.generateTrigger();

};

THREE.GlitchPass.prototype = Object.assign( Object.create( THREE.Pass.prototype ), {

	constructor: THREE.GlitchPass,

	render: function ( renderer, writeBuffer, readBuffer, delta, maskActive ) {

		this.uniforms[ "tDiffuse" ].value = readBuffer.texture;
		this.uniforms[ 'seed' ].value = Math.random();//default seeding
		this.uniforms[ 'byp' ].value = 0;

		if ( this.curF % this.randX == 0 || this.goWild == true ) {

			this.uniforms[ 'amount' ].value = Math.random() / 30;
			this.uniforms[ 'angle' ].value = THREE.Math.randFloat( - Math.PI, Math.PI );
			this.uniforms[ 'seed_x' ].value = THREE.Math.randFloat( - 1, 1 );
			this.uniforms[ 'seed_y' ].value = THREE.Math.randFloat( - 1, 1 );
			this.uniforms[ 'distortion_x' ].value = THREE.Math.randFloat( 0, 1 );
			this.uniforms[ 'distortion_y' ].value = THREE.Math.randFloat( 0, 1 );
			this.curF = 0;
			this.generateTrigger();

		} else if ( this.curF % this.randX < this.randX / 5 ) {

			this.uniforms[ 'amount' ].value = Math.random() / 90;
			this.uniforms[ 'angle' ].value = THREE.Math.randFloat( - Math.PI, Math.PI );
			this.uniforms[ 'distortion_x' ].value = THREE.Math.randFloat( 0, 1 );
			this.uniforms[ 'distortion_y' ].value = THREE.Math.randFloat( 0, 1 );
			this.uniforms[ 'seed_x' ].value = THREE.Math.randFloat( - 0.3, 0.3 );
			this.uniforms[ 'seed_y' ].value = THREE.Math.randFloat( - 0.3, 0.3 );

		} else if ( this.goWild == false ) {

			this.uniforms[ 'byp' ].value = 1;

		}

		this.curF ++;
		this.quad.material = this.material;

		if ( this.renderToScreen ) {

			renderer.render( this.scene, this.camera );

		} else {

			renderer.render( this.scene, this.camera, writeBuffer, this.clear );

		}

	},

	generateTrigger: function() {

		this.randX = THREE.Math.randInt( 120, 240 );

	},

	generateHeightmap: function( dt_size ) {

		var data_arr = new Float32Array( dt_size * dt_size * 3 );
		var length = dt_size * dt_size;

		for ( var i = 0; i < length; i ++ ) {

			var val = THREE.Math.randFloat( 0, 1 );
			data_arr[ i * 3 + 0 ] = val;
			data_arr[ i * 3 + 1 ] = val;
			data_arr[ i * 3 + 2 ] = val;

		}

		var texture = new THREE.DataTexture( data_arr, dt_size, dt_size, THREE.RGBFormat, THREE.FloatType );
		texture.needsUpdate = true;
		return texture;

	}

} );

/**
*
* Manual Multi-Sample Anti-Aliasing Render Pass
*
* @author bhouston / http://clara.io/
*
* This manual approach to MSAA re-renders the scene ones for each sample with camera jitter and accumulates the results.
*
* References: https://en.wikipedia.org/wiki/Multisample_anti-aliasing
*
*/

THREE.ManualMSAARenderPass = function ( scene, camera, clearColor, clearAlpha ) {

	THREE.Pass.call( this );

	this.scene = scene;
	this.camera = camera;

	this.sampleLevel = 4; // specified as n, where the number of samples is 2^n, so sampleLevel = 4, is 2^4 samples, 16.
	this.unbiased = true;

	// as we need to clear the buffer in this pass, clearColor must be set to something, defaults to black.
	this.clearColor = ( clearColor !== undefined ) ? clearColor : 0x000000;
	this.clearAlpha = ( clearAlpha !== undefined ) ? clearAlpha : 0;

	if ( THREE.CopyShader === undefined ) console.error( "THREE.ManualMSAARenderPass relies on THREE.CopyShader" );

	var copyShader = THREE.CopyShader;
	this.copyUniforms = THREE.UniformsUtils.clone( copyShader.uniforms );

	this.copyMaterial = new THREE.ShaderMaterial(	{
		uniforms: this.copyUniforms,
		vertexShader: copyShader.vertexShader,
		fragmentShader: copyShader.fragmentShader,
		premultipliedAlpha: true,
		transparent: true,
		blending: THREE.AdditiveBlending,
		depthTest: false,
		depthWrite: false
	} );

	this.camera2 = new THREE.OrthographicCamera( - 1, 1, 1, - 1, 0, 1 );
	this.scene2	= new THREE.Scene();
	this.quad2 = new THREE.Mesh( new THREE.PlaneGeometry( 2, 2 ), this.copyMaterial );
	this.scene2.add( this.quad2 );

};

THREE.ManualMSAARenderPass.prototype = Object.assign( Object.create( THREE.Pass.prototype ), {

	constructor: THREE.ManualMSAARenderPass,

	dispose: function() {

		if ( this.sampleRenderTarget ) {

			this.sampleRenderTarget.dispose();
			this.sampleRenderTarget = null;

		}

	},

	setSize: function ( width, height ) {

		if ( this.sampleRenderTarget )	this.sampleRenderTarget.setSize( width, height );

	},

	render: function ( renderer, writeBuffer, readBuffer, delta, maskActive ) {

		if ( ! this.sampleRenderTarget ) {

			this.sampleRenderTarget = new THREE.WebGLRenderTarget( readBuffer.width, readBuffer.height,
				{ minFilter: THREE.LinearFilter, magFilter: THREE.LinearFilter, format: THREE.RGBAFormat } );

		}

		var jitterOffsets = THREE.ManualMSAARenderPass.JitterVectors[ Math.max( 0, Math.min( this.sampleLevel, 5 ) ) ];

		var autoClear = renderer.autoClear;
		renderer.autoClear = false;

		var oldClearColor = renderer.getClearColor().getHex();
		var oldClearAlpha = renderer.getClearAlpha();

		var baseSampleWeight = 1.0 / jitterOffsets.length;
		var roundingRange = 1 / 32;
		this.copyUniforms[ "tDiffuse" ].value = this.sampleRenderTarget.texture;

		var width = readBuffer.width, height = readBuffer.height;

		// render the scene multiple times, each slightly jitter offset from the last and accumulate the results.
		for ( var i = 0; i < jitterOffsets.length; i ++ ) {

			var jitterOffset = jitterOffsets[i];
			if ( this.camera.setViewOffset ) {
				this.camera.setViewOffset( width, height,
					jitterOffset[ 0 ] * 0.0625, jitterOffset[ 1 ] * 0.0625,   // 0.0625 = 1 / 16
					width, height );
			}

			var sampleWeight = baseSampleWeight;
			if( this.unbiased ) {
				// the theory is that equal weights for each sample lead to an accumulation of rounding errors.
				// The following equation varies the sampleWeight per sample so that it is uniformly distributed
				// across a range of values whose rounding errors cancel each other out.
				var uniformCenteredDistribution = ( -0.5 + ( i + 0.5 ) / jitterOffsets.length );
				sampleWeight += roundingRange * uniformCenteredDistribution;
			}

			this.copyUniforms[ "opacity" ].value = sampleWeight;
			renderer.setClearColor( this.clearColor, this.clearAlpha );
			renderer.render( this.scene, this.camera, this.sampleRenderTarget, true );
			if (i === 0) {
				renderer.setClearColor( 0x000000, 0.0 );
			}
			renderer.render( this.scene2, this.camera2, this.renderToScreen ? null : writeBuffer, (i === 0) );

		}

		if ( this.camera.clearViewOffset ) this.camera.clearViewOffset();

		renderer.autoClear = autoClear;
		renderer.setClearColor( oldClearColor, oldClearAlpha );

	}

} );


// These jitter vectors are specified in integers because it is easier.
// I am assuming a [-8,8) integer grid, but it needs to be mapped onto [-0.5,0.5)
// before being used, thus these integers need to be scaled by 1/16.
//
// Sample patterns reference: https://msdn.microsoft.com/en-us/library/windows/desktop/ff476218%28v=vs.85%29.aspx?f=255&MSPPError=-2147217396
THREE.ManualMSAARenderPass.JitterVectors = [
	[
		[ 0, 0 ]
	],
	[
		[ 4, 4 ], [ - 4, - 4 ]
	],
	[
		[ - 2, - 6 ], [ 6, - 2 ], [ - 6, 2 ], [ 2, 6 ]
	],
	[
		[ 1, - 3 ], [ - 1, 3 ], [ 5, 1 ], [ - 3, - 5 ],
		[ - 5, 5 ], [ - 7, - 1 ], [ 3, 7 ], [ 7, - 7 ]
	],
	[
		[ 1, 1 ], [ - 1, - 3 ], [ - 3, 2 ], [ 4, - 1 ],
		[ - 5, - 2 ], [ 2, 5 ], [ 5, 3 ], [ 3, - 5 ],
		[ - 2, 6 ], [ 0, - 7 ], [ - 4, - 6 ], [ - 6, 4 ],
		[ - 8, 0 ], [ 7, - 4 ], [ 6, 7 ], [ - 7, - 8 ]
	],
	[
		[ - 4, - 7 ], [ - 7, - 5 ], [ - 3, - 5 ], [ - 5, - 4 ],
		[ - 1, - 4 ], [ - 2, - 2 ], [ - 6, - 1 ], [ - 4, 0 ],
		[ - 7, 1 ], [ - 1, 2 ], [ - 6, 3 ], [ - 3, 3 ],
		[ - 7, 6 ], [ - 3, 6 ], [ - 5, 7 ], [ - 1, 7 ],
		[ 5, - 7 ], [ 1, - 6 ], [ 6, - 5 ], [ 4, - 4 ],
		[ 2, - 3 ], [ 7, - 2 ], [ 1, - 1 ], [ 4, - 1 ],
		[ 2, 1 ], [ 6, 2 ], [ 0, 4 ], [ 4, 4 ],
		[ 2, 5 ], [ 7, 5 ], [ 5, 6 ], [ 3, 7 ]
	]
];

/**
 * @author alteredq / http://alteredqualia.com/
 */

THREE.MaskPass = function ( scene, camera ) {

	THREE.Pass.call( this );

	this.scene = scene;
	this.camera = camera;

	this.clear = true;
	this.needsSwap = false;

	this.inverse = false;

};

THREE.MaskPass.prototype = Object.assign( Object.create( THREE.Pass.prototype ), {

	constructor: THREE.MaskPass,

	render: function ( renderer, writeBuffer, readBuffer, delta, maskActive ) {

		var context = renderer.context;
		var state = renderer.state;

		// don't update color or depth

		state.buffers.color.setMask( false );
		state.buffers.depth.setMask( false );

		// lock buffers

		state.buffers.color.setLocked( true );
		state.buffers.depth.setLocked( true );

		// set up stencil

		var writeValue, clearValue;

		if ( this.inverse ) {

			writeValue = 0;
			clearValue = 1;

		} else {

			writeValue = 1;
			clearValue = 0;

		}

		state.buffers.stencil.setTest( true );
		state.buffers.stencil.setOp( context.REPLACE, context.REPLACE, context.REPLACE );
		state.buffers.stencil.setFunc( context.ALWAYS, writeValue, 0xffffffff );
		state.buffers.stencil.setClear( clearValue );

		// draw into the stencil buffer

		renderer.render( this.scene, this.camera, readBuffer, this.clear );
		renderer.render( this.scene, this.camera, writeBuffer, this.clear );

		// unlock color and depth buffer for subsequent rendering

		state.buffers.color.setLocked( false );
		state.buffers.depth.setLocked( false );

		// only render where stencil is set to 1

		state.buffers.stencil.setFunc( context.EQUAL, 1, 0xffffffff );  // draw if == 1
		state.buffers.stencil.setOp( context.KEEP, context.KEEP, context.KEEP );

	}

} );


THREE.ClearMaskPass = function () {

	THREE.Pass.call( this );

	this.needsSwap = false;

};

THREE.ClearMaskPass.prototype = Object.create( THREE.Pass.prototype );

Object.assign( THREE.ClearMaskPass.prototype, {

	render: function ( renderer, writeBuffer, readBuffer, delta, maskActive ) {

		renderer.state.buffers.stencil.setTest( false );

	}

} );

/**
 * @author spidersharma / http://eduperiment.com/
 */

THREE.OutlinePass = function ( resolution, scene, camera, selectedObjects ) {

	this.renderScene = scene;
	this.renderCamera = camera;
	this.selectedObjects = selectedObjects !== undefined ? selectedObjects : [];
	this.visibleEdgeColor = new THREE.Color( 1, 1, 1 );
	this.hiddenEdgeColor = new THREE.Color( 0.1, 0.04, 0.02 );
	this.edgeGlow = 0.0;
	this.usePatternTexture = false;
	this.edgeThickness = 1.0;
	this.edgeStrength = 3.0;
	this.downSampleRatio = 2;
	this.pulsePeriod = 0;

	THREE.Pass.call( this );

	this.resolution = ( resolution !== undefined ) ? new THREE.Vector2( resolution.x, resolution.y ) : new THREE.Vector2( 256, 256 );

	var pars = { minFilter: THREE.LinearFilter, magFilter: THREE.LinearFilter, format: THREE.RGBAFormat };

	var resx = Math.round( this.resolution.x / this.downSampleRatio );
	var resy = Math.round( this.resolution.y / this.downSampleRatio );

	this.maskBufferMaterial = new THREE.MeshBasicMaterial( { color: 0xffffff } );
	this.maskBufferMaterial.side = THREE.DoubleSide;
	this.renderTargetMaskBuffer = new THREE.WebGLRenderTarget( this.resolution.x, this.resolution.y, pars );
	this.renderTargetMaskBuffer.texture.generateMipmaps = false;

	this.depthMaterial = new THREE.MeshDepthMaterial();
	this.depthMaterial.side = THREE.DoubleSide;
	this.depthMaterial.depthPacking = THREE.RGBADepthPacking;
	this.depthMaterial.blending = THREE.NoBlending;

	this.prepareMaskMaterial = this.getPrepareMaskMaterial();
	this.prepareMaskMaterial.side = THREE.DoubleSide;

	this.renderTargetDepthBuffer = new THREE.WebGLRenderTarget( this.resolution.x, this.resolution.y, pars );
	this.renderTargetDepthBuffer.texture.generateMipmaps = false;

	this.renderTargetMaskDownSampleBuffer = new THREE.WebGLRenderTarget( resx, resy, pars );
	this.renderTargetMaskDownSampleBuffer.texture.generateMipmaps = false;

	this.renderTargetBlurBuffer1 = new THREE.WebGLRenderTarget( resx, resy, pars );
	this.renderTargetBlurBuffer1.texture.generateMipmaps = false;
	this.renderTargetBlurBuffer2 = new THREE.WebGLRenderTarget( Math.round( resx / 2 ), Math.round( resy / 2 ), pars );
	this.renderTargetBlurBuffer2.texture.generateMipmaps = false;

	this.edgeDetectionMaterial = this.getEdgeDetectionMaterial();
	this.renderTargetEdgeBuffer1 = new THREE.WebGLRenderTarget( resx, resy, pars );
	this.renderTargetEdgeBuffer1.texture.generateMipmaps = false;
	this.renderTargetEdgeBuffer2 = new THREE.WebGLRenderTarget( Math.round( resx / 2 ), Math.round( resy / 2 ), pars );
	this.renderTargetEdgeBuffer2.texture.generateMipmaps = false;

	var MAX_EDGE_THICKNESS = 4;
	var MAX_EDGE_GLOW = 4;

	this.separableBlurMaterial1 = this.getSeperableBlurMaterial( MAX_EDGE_THICKNESS );
	this.separableBlurMaterial1.uniforms[ "texSize" ].value = new THREE.Vector2( resx, resy );
	this.separableBlurMaterial1.uniforms[ "kernelRadius" ].value = 1;
	this.separableBlurMaterial2 = this.getSeperableBlurMaterial( MAX_EDGE_GLOW );
	this.separableBlurMaterial2.uniforms[ "texSize" ].value = new THREE.Vector2( Math.round( resx / 2 ), Math.round( resy / 2 ) );
	this.separableBlurMaterial2.uniforms[ "kernelRadius" ].value = MAX_EDGE_GLOW;

	// Overlay material
	this.overlayMaterial = this.getOverlayMaterial();

	// copy material
	if ( THREE.CopyShader === undefined )
		console.error( "THREE.OutlinePass relies on THREE.CopyShader" );

	var copyShader = THREE.CopyShader;

	this.copyUniforms = THREE.UniformsUtils.clone( copyShader.uniforms );
	this.copyUniforms[ "opacity" ].value = 1.0;

	this.materialCopy = new THREE.ShaderMaterial( {
		uniforms: this.copyUniforms,
		vertexShader: copyShader.vertexShader,
		fragmentShader: copyShader.fragmentShader,
		blending: THREE.NoBlending,
		depthTest: false,
		depthWrite: false,
		transparent: true
	} );

	this.enabled = true;
	this.needsSwap = false;

	this.oldClearColor = new THREE.Color();
	this.oldClearAlpha = 1;

	this.camera = new THREE.OrthographicCamera( - 1, 1, 1, - 1, 0, 1 );
	this.scene = new THREE.Scene();

	this.quad = new THREE.Mesh( new THREE.PlaneBufferGeometry( 2, 2 ), null );
	this.scene.add( this.quad );

	this.tempPulseColor1 = new THREE.Color();
	this.tempPulseColor2 = new THREE.Color();
	this.textureMatrix = new THREE.Matrix4();

};

THREE.OutlinePass.prototype = Object.assign( Object.create( THREE.Pass.prototype ), {

	constructor: THREE.OutlinePass,

	dispose: function () {

		this.renderTargetMaskBuffer.dispose();
		this.renderTargetDepthBuffer.dispose();
		this.renderTargetMaskDownSampleBuffer.dispose();
		this.renderTargetBlurBuffer1.dispose();
		this.renderTargetBlurBuffer2.dispose();
		this.renderTargetEdgeBuffer1.dispose();
		this.renderTargetEdgeBuffer2.dispose();

	},

	setSize: function ( width, height ) {

		this.renderTargetMaskBuffer.setSize( width, height );

		var resx = Math.round( width / this.downSampleRatio );
		var resy = Math.round( height / this.downSampleRatio );
		this.renderTargetMaskDownSampleBuffer.setSize( resx, resy );
		this.renderTargetBlurBuffer1.setSize( resx, resy );
		this.renderTargetEdgeBuffer1.setSize( resx, resy );
		this.separableBlurMaterial1.uniforms[ "texSize" ].value = new THREE.Vector2( resx, resy );

		resx = Math.round( resx / 2 );
		resy = Math.round( resy / 2 );

		this.renderTargetBlurBuffer2.setSize( resx, resy );
		this.renderTargetEdgeBuffer2.setSize( resx, resy );

		this.separableBlurMaterial2.uniforms[ "texSize" ].value = new THREE.Vector2( resx, resy );

	},

	changeVisibilityOfSelectedObjects: function ( bVisible ) {

		function gatherSelectedMeshesCallBack( object ) {

			if ( object instanceof THREE.Mesh ) object.visible = bVisible;

		}

		for ( var i = 0; i < this.selectedObjects.length; i ++ ) {

			var selectedObject = this.selectedObjects[ i ];
			selectedObject.traverse( gatherSelectedMeshesCallBack );

		}

	},

	changeVisibilityOfNonSelectedObjects: function ( bVisible ) {

		var selectedMeshes = [];

		function gatherSelectedMeshesCallBack( object ) {

			if ( object instanceof THREE.Mesh ) selectedMeshes.push( object );

		}

		for ( var i = 0; i < this.selectedObjects.length; i ++ ) {

			var selectedObject = this.selectedObjects[ i ];
			selectedObject.traverse( gatherSelectedMeshesCallBack );

		}

		function VisibilityChangeCallBack( object ) {

			if ( object instanceof THREE.Mesh ) {

				var bFound = false;

				for ( var i = 0; i < selectedMeshes.length; i ++ ) {

					var selectedObjectId = selectedMeshes[ i ].id;

					if ( selectedObjectId === object.id ) {

						bFound = true;
						break;

					}

				}

				if ( ! bFound ) {

					var visibility = object.visible;

					if ( ! bVisible || object.bVisible ) object.visible = bVisible;

					object.bVisible = visibility;

				}

			}

		}

		this.renderScene.traverse( VisibilityChangeCallBack );

	},

	updateTextureMatrix: function () {

		this.textureMatrix.set( 0.5, 0.0, 0.0, 0.5,
														0.0, 0.5, 0.0, 0.5,
														0.0, 0.0, 0.5, 0.5,
														0.0, 0.0, 0.0, 1.0 );
		this.textureMatrix.multiply( this.renderCamera.projectionMatrix );
		this.textureMatrix.multiply( this.renderCamera.matrixWorldInverse );

	},

	render: function ( renderer, writeBuffer, readBuffer, delta, maskActive ) {

		if ( this.selectedObjects.length === 0 ) return;

		this.oldClearColor.copy( renderer.getClearColor() );
		this.oldClearAlpha = renderer.getClearAlpha();
		var oldAutoClear = renderer.autoClear;

		renderer.autoClear = false;

		if ( maskActive ) renderer.context.disable( renderer.context.STENCIL_TEST );

		renderer.setClearColor( 0xffffff, 1 );

		// Make selected objects invisible
		this.changeVisibilityOfSelectedObjects( false );

		// 1. Draw Non Selected objects in the depth buffer
		this.renderScene.overrideMaterial = this.depthMaterial;
		renderer.render( this.renderScene, this.renderCamera, this.renderTargetDepthBuffer, true );

		// Make selected objects visible
		this.changeVisibilityOfSelectedObjects( true );

		// Update Texture Matrix for Depth compare
		this.updateTextureMatrix();

		// Make non selected objects invisible, and draw only the selected objects, by comparing the depth buffer of non selected objects
		this.changeVisibilityOfNonSelectedObjects( false );
		this.renderScene.overrideMaterial = this.prepareMaskMaterial;
		this.prepareMaskMaterial.uniforms[ "cameraNearFar" ].value = new THREE.Vector2( this.renderCamera.near, this.renderCamera.far );
		this.prepareMaskMaterial.uniforms[ "depthTexture" ].value = this.renderTargetDepthBuffer.texture;
		this.prepareMaskMaterial.uniforms[ "textureMatrix" ].value = this.textureMatrix;
		renderer.render( this.renderScene, this.renderCamera, this.renderTargetMaskBuffer, true );
		this.renderScene.overrideMaterial = null;
		this.changeVisibilityOfNonSelectedObjects( true );

		// 2. Downsample to Half resolution
		this.quad.material = this.materialCopy;
		this.copyUniforms[ "tDiffuse" ].value = this.renderTargetMaskBuffer.texture;
		renderer.render( this.scene, this.camera, this.renderTargetMaskDownSampleBuffer, true );

		this.tempPulseColor1.copy( this.visibleEdgeColor );
		this.tempPulseColor2.copy( this.hiddenEdgeColor );

		if ( this.pulsePeriod > 0 ) {

			var scalar = ( 1 + 0.25 ) / 2 + Math.cos( performance.now() * 0.01 / this.pulsePeriod ) * ( 1.0 - 0.25 ) / 2;
			this.tempPulseColor1.multiplyScalar( scalar );
			this.tempPulseColor2.multiplyScalar( scalar );

		}

		// 3. Apply Edge Detection Pass
		this.quad.material = this.edgeDetectionMaterial;
		this.edgeDetectionMaterial.uniforms[ "maskTexture" ].value = this.renderTargetMaskDownSampleBuffer.texture;
		this.edgeDetectionMaterial.uniforms[ "texSize" ].value = new THREE.Vector2( this.renderTargetMaskDownSampleBuffer.width, this.renderTargetMaskDownSampleBuffer.height );
		this.edgeDetectionMaterial.uniforms[ "visibleEdgeColor" ].value = this.tempPulseColor1;
		this.edgeDetectionMaterial.uniforms[ "hiddenEdgeColor" ].value = this.tempPulseColor2;
		renderer.render( this.scene, this.camera, this.renderTargetEdgeBuffer1, true );

		// 4. Apply Blur on Half res
		this.quad.material = this.separableBlurMaterial1;
		this.separableBlurMaterial1.uniforms[ "colorTexture" ].value = this.renderTargetEdgeBuffer1.texture;
		this.separableBlurMaterial1.uniforms[ "direction" ].value = THREE.OutlinePass.BlurDirectionX;
		this.separableBlurMaterial1.uniforms[ "kernelRadius" ].value = this.edgeThickness;
		renderer.render( this.scene, this.camera, this.renderTargetBlurBuffer1, true );
		this.separableBlurMaterial1.uniforms[ "colorTexture" ].value = this.renderTargetBlurBuffer1.texture;
		this.separableBlurMaterial1.uniforms[ "direction" ].value = THREE.OutlinePass.BlurDirectionY;
		renderer.render( this.scene, this.camera, this.renderTargetEdgeBuffer1, true );

		// Apply Blur on quarter res
		this.quad.material = this.separableBlurMaterial2;
		this.separableBlurMaterial2.uniforms[ "colorTexture" ].value = this.renderTargetEdgeBuffer1.texture;
		this.separableBlurMaterial2.uniforms[ "direction" ].value = THREE.OutlinePass.BlurDirectionX;
		renderer.render( this.scene, this.camera, this.renderTargetBlurBuffer2, true );
		this.separableBlurMaterial2.uniforms[ "colorTexture" ].value = this.renderTargetBlurBuffer2.texture;
		this.separableBlurMaterial2.uniforms[ "direction" ].value = THREE.OutlinePass.BlurDirectionY;
		renderer.render( this.scene, this.camera, this.renderTargetEdgeBuffer2, true );

		// Blend it additively over the input texture
		this.quad.material = this.overlayMaterial;
		this.overlayMaterial.uniforms[ "maskTexture" ].value = this.renderTargetMaskBuffer.texture;
		this.overlayMaterial.uniforms[ "edgeTexture1" ].value = this.renderTargetEdgeBuffer1.texture;
		this.overlayMaterial.uniforms[ "edgeTexture2" ].value = this.renderTargetEdgeBuffer2.texture;
		this.overlayMaterial.uniforms[ "patternTexture" ].value = this.patternTexture;
		this.overlayMaterial.uniforms[ "edgeStrength" ].value = this.edgeStrength;
		this.overlayMaterial.uniforms[ "edgeGlow" ].value = this.edgeGlow;
		this.overlayMaterial.uniforms[ "usePatternTexture" ].value = this.usePatternTexture;


		if ( maskActive ) renderer.context.enable( renderer.context.STENCIL_TEST );

		renderer.render( this.scene, this.camera, readBuffer, false );

		renderer.setClearColor( this.oldClearColor, this.oldClearAlpha );
		renderer.autoClear = oldAutoClear;

	},

	getPrepareMaskMaterial: function () {

		return new THREE.ShaderMaterial( {

			uniforms: {
				"depthTexture": { value: null },
				"cameraNearFar": { value: new THREE.Vector2( 0.5, 0.5 ) },
				"textureMatrix": { value: new THREE.Matrix4() }
			},

			vertexShader:
				"varying vec2 vUv;\
				varying vec4 projTexCoord;\
				varying vec4 vPosition;\
				uniform mat4 textureMatrix;\
				void main() {\
					vUv = uv;\
					vPosition = modelViewMatrix * vec4( position, 1.0 );\
					vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\
					projTexCoord = textureMatrix * worldPosition;\
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\
				}",

			fragmentShader:
				"#include <packing>\
				varying vec2 vUv;\
				varying vec4 vPosition;\
				varying vec4 projTexCoord;\
				uniform sampler2D depthTexture;\
				uniform vec2 cameraNearFar;\
				\
				void main() {\
					float depth = unpackRGBAToDepth(texture2DProj( depthTexture, projTexCoord ));\
					float viewZ = -perspectiveDepthToViewZ( depth, cameraNearFar.x, cameraNearFar.y );\
					float depthTest = (-vPosition.z > viewZ) ? 1.0 : 0.0;\
					gl_FragColor = vec4(0.0, depthTest, 1.0, 1.0);\
				}"
		} );

	},

	getEdgeDetectionMaterial: function () {

		return new THREE.ShaderMaterial( {

			uniforms: {
				"maskTexture": { value: null },
				"texSize": { value: new THREE.Vector2( 0.5, 0.5 ) },
				"visibleEdgeColor": { value: new THREE.Vector3( 1.0, 1.0, 1.0 ) },
				"hiddenEdgeColor": { value: new THREE.Vector3( 1.0, 1.0, 1.0 ) },
			},

			vertexShader:
				"varying vec2 vUv;\n\
				void main() {\n\
					vUv = uv;\n\
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\
				}",

			fragmentShader:
				"varying vec2 vUv;\
				uniform sampler2D maskTexture;\
				uniform vec2 texSize;\
				uniform vec3 visibleEdgeColor;\
				uniform vec3 hiddenEdgeColor;\
				\
				void main() {\n\
					vec2 invSize = 1.0 / texSize;\
					vec4 uvOffset = vec4(1.0, 0.0, 0.0, 1.0) * vec4(invSize, invSize);\
					vec4 c1 = texture2D( maskTexture, vUv + uvOffset.xy);\
					vec4 c2 = texture2D( maskTexture, vUv - uvOffset.xy);\
					vec4 c3 = texture2D( maskTexture, vUv + uvOffset.yw);\
					vec4 c4 = texture2D( maskTexture, vUv - uvOffset.yw);\
					float diff1 = (c1.r - c2.r)*0.5;\
					float diff2 = (c3.r - c4.r)*0.5;\
					float d = length( vec2(diff1, diff2) );\
					float a1 = min(c1.g, c2.g);\
					float a2 = min(c3.g, c4.g);\
					float visibilityFactor = min(a1, a2);\
					vec3 edgeColor = 1.0 - visibilityFactor > 0.001 ? visibleEdgeColor : hiddenEdgeColor;\
					gl_FragColor = vec4(edgeColor, 1.0) * vec4(d);\
				}"
		} );

	},

	getSeperableBlurMaterial: function ( maxRadius ) {

		return new THREE.ShaderMaterial( {

			defines: {
				"MAX_RADIUS": maxRadius,
			},

			uniforms: {
				"colorTexture": { value: null },
				"texSize": { value: new THREE.Vector2( 0.5, 0.5 ) },
				"direction": { value: new THREE.Vector2( 0.5, 0.5 ) },
				"kernelRadius": { value: 1.0 }
			},

			vertexShader:
				"varying vec2 vUv;\n\
				void main() {\n\
					vUv = uv;\n\
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\
				}",

			fragmentShader:
				"#include <common>\
				varying vec2 vUv;\
				uniform sampler2D colorTexture;\
				uniform vec2 texSize;\
				uniform vec2 direction;\
				uniform float kernelRadius;\
				\
				float gaussianPdf(in float x, in float sigma) {\
					return 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\
				}\
				void main() {\
					vec2 invSize = 1.0 / texSize;\
					float weightSum = gaussianPdf(0.0, kernelRadius);\
					vec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;\
					vec2 delta = direction * invSize * kernelRadius/float(MAX_RADIUS);\
					vec2 uvOffset = delta;\
					for( int i = 1; i <= MAX_RADIUS; i ++ ) {\
						float w = gaussianPdf(uvOffset.x, kernelRadius);\
						vec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;\
						vec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;\
						diffuseSum += ((sample1 + sample2) * w);\
						weightSum += (2.0 * w);\
						uvOffset += delta;\
					}\
					gl_FragColor = vec4(diffuseSum/weightSum, 1.0);\
				}"
		} );

	},

	getOverlayMaterial: function () {

		return new THREE.ShaderMaterial( {

			uniforms: {
				"maskTexture": { value: null },
				"edgeTexture1": { value: null },
				"edgeTexture2": { value: null },
				"patternTexture": { value: null },
				"edgeStrength": { value: 1.0 },
				"edgeGlow": { value: 1.0 },
				"usePatternTexture": { value: 0.0 }
			},

			vertexShader:
				"varying vec2 vUv;\n\
				void main() {\n\
					vUv = uv;\n\
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\
				}",

			fragmentShader:
				"varying vec2 vUv;\
				uniform sampler2D maskTexture;\
				uniform sampler2D edgeTexture1;\
				uniform sampler2D edgeTexture2;\
				uniform sampler2D patternTexture;\
				uniform float edgeStrength;\
				uniform float edgeGlow;\
				uniform bool usePatternTexture;\
				\
				void main() {\
					vec4 edgeValue1 = texture2D(edgeTexture1, vUv);\
					vec4 edgeValue2 = texture2D(edgeTexture2, vUv);\
					vec4 maskColor = texture2D(maskTexture, vUv);\
					vec4 patternColor = texture2D(patternTexture, 6.0 * vUv);\
					float visibilityFactor = 1.0 - maskColor.g > 0.0 ? 1.0 : 0.5;\
					vec4 edgeValue = edgeValue1 + edgeValue2 * edgeGlow;\
					vec4 finalColor = edgeStrength * maskColor.r * edgeValue;\
					if(usePatternTexture)\
						finalColor += + visibilityFactor * (1.0 - maskColor.r) * (1.0 - patternColor.r);\
					gl_FragColor = finalColor;\
				}",
			blending: THREE.AdditiveBlending,
			depthTest: false,
			depthWrite: false,
			transparent: true
		} );

	}

} );

THREE.OutlinePass.BlurDirectionX = new THREE.Vector2( 1.0, 0.0 );
THREE.OutlinePass.BlurDirectionY = new THREE.Vector2( 0.0, 1.0 );

/**
 * @author alteredq / http://alteredqualia.com/
 */

THREE.RenderPass = function ( scene, camera, overrideMaterial, clearColor, clearAlpha ) {

	THREE.Pass.call( this );

	this.scene = scene;
	this.camera = camera;

	this.overrideMaterial = overrideMaterial;

	this.clearColor = clearColor;
	this.clearAlpha = ( clearAlpha !== undefined ) ? clearAlpha : 0;

	this.clear = true;
	this.clearDepth = false;
	this.needsSwap = false;

};

THREE.RenderPass.prototype = Object.assign( Object.create( THREE.Pass.prototype ), {

	constructor: THREE.RenderPass,

	render: function ( renderer, writeBuffer, readBuffer, delta, maskActive ) {

		var oldAutoClear = renderer.autoClear;
		renderer.autoClear = false;

		this.scene.overrideMaterial = this.overrideMaterial;

		var oldClearColor, oldClearAlpha;

		if ( this.clearColor ) {

			oldClearColor = renderer.getClearColor().getHex();
			oldClearAlpha = renderer.getClearAlpha();

			renderer.setClearColor( this.clearColor, this.clearAlpha );

		}

		if ( this.clearDepth ) {

			renderer.clearDepth();

		}

		renderer.render( this.scene, this.camera, this.renderToScreen ? null : readBuffer, this.clear );

		if ( this.clearColor ) {

			renderer.setClearColor( oldClearColor, oldClearAlpha );

		}

		this.scene.overrideMaterial = null;
		renderer.autoClear = oldAutoClear;
	}

} );

/**
 * @author mpk / http://polko.me/
 */

THREE.SMAAPass = function ( width, height ) {

	THREE.Pass.call( this );

	// render targets

	this.edgesRT = new THREE.WebGLRenderTarget( width, height, {
		depthBuffer: false,
		stencilBuffer: false,
		generateMipmaps: false,
		minFilter: THREE.LinearFilter,
		format: THREE.RGBFormat
	} );

	this.weightsRT = new THREE.WebGLRenderTarget( width, height, {
		depthBuffer: false,
		stencilBuffer: false,
		generateMipmaps: false,
		minFilter: THREE.LinearFilter,
		format: THREE.RGBAFormat
	} );

	// textures

	var areaTextureImage = new Image();
	areaTextureImage.src = this.getAreaTexture();

	this.areaTexture = new THREE.Texture();
	this.areaTexture.image = areaTextureImage;
	this.areaTexture.format = THREE.RGBFormat;
	this.areaTexture.minFilter = THREE.LinearFilter;
	this.areaTexture.generateMipmaps = false;
	this.areaTexture.needsUpdate = true;
	this.areaTexture.flipY = false;

	var searchTextureImage = new Image();
	searchTextureImage.src = this.getSearchTexture();

	this.searchTexture = new THREE.Texture();
	this.searchTexture.image = searchTextureImage;
	this.searchTexture.magFilter = THREE.NearestFilter;
	this.searchTexture.minFilter = THREE.NearestFilter;
	this.searchTexture.generateMipmaps = false;
	this.searchTexture.needsUpdate = true;
	this.searchTexture.flipY = false;

	// materials - pass 1

	if ( THREE.SMAAShader === undefined ) {
		console.error( "THREE.SMAAPass relies on THREE.SMAAShader" );
	}

	this.uniformsEdges = THREE.UniformsUtils.clone( THREE.SMAAShader[0].uniforms );

	this.uniformsEdges[ "resolution" ].value.set( 1 / width, 1 / height );

	this.materialEdges = new THREE.ShaderMaterial( {
		defines: THREE.SMAAShader[0].defines,
		uniforms: this.uniformsEdges,
		vertexShader: THREE.SMAAShader[0].vertexShader,
		fragmentShader: THREE.SMAAShader[0].fragmentShader
	} );

	// materials - pass 2

	this.uniformsWeights = THREE.UniformsUtils.clone( THREE.SMAAShader[1].uniforms );

	this.uniformsWeights[ "resolution" ].value.set( 1 / width, 1 / height );
	this.uniformsWeights[ "tDiffuse" ].value = this.edgesRT.texture;
	this.uniformsWeights[ "tArea" ].value = this.areaTexture;
	this.uniformsWeights[ "tSearch" ].value = this.searchTexture;

	this.materialWeights = new THREE.ShaderMaterial( {
		defines: THREE.SMAAShader[1].defines,
		uniforms: this.uniformsWeights,
		vertexShader: THREE.SMAAShader[1].vertexShader,
		fragmentShader: THREE.SMAAShader[1].fragmentShader
	} );

	// materials - pass 3

	this.uniformsBlend = THREE.UniformsUtils.clone( THREE.SMAAShader[2].uniforms );

	this.uniformsBlend[ "resolution" ].value.set( 1 / width, 1 / height );
	this.uniformsBlend[ "tDiffuse" ].value = this.weightsRT.texture;

	this.materialBlend = new THREE.ShaderMaterial( {
		uniforms: this.uniformsBlend,
		vertexShader: THREE.SMAAShader[2].vertexShader,
		fragmentShader: THREE.SMAAShader[2].fragmentShader
	} );

	this.needsSwap = false;

	this.camera = new THREE.OrthographicCamera( -1, 1, 1, -1, 0, 1 );
	this.scene  = new THREE.Scene();

	this.quad = new THREE.Mesh( new THREE.PlaneBufferGeometry( 2, 2 ), null );
	this.scene.add( this.quad );

};

THREE.SMAAPass.prototype = Object.assign( Object.create( THREE.Pass.prototype ), {

	constructor: THREE.SMAAPass,

	render: function ( renderer, writeBuffer, readBuffer, delta, maskActive ) {

		// pass 1

		this.uniformsEdges[ "tDiffuse" ].value = readBuffer.texture;

		this.quad.material = this.materialEdges;

		renderer.render( this.scene, this.camera, this.edgesRT, this.clear );

		// pass 2

		this.quad.material = this.materialWeights;

		renderer.render( this.scene, this.camera, this.weightsRT, this.clear );

		// pass 3

		this.uniformsBlend[ "tColor" ].value = readBuffer.texture;

		this.quad.material = this.materialBlend;

		if ( this.renderToScreen ) {

			renderer.render( this.scene, this.camera );

		} else {

			renderer.render( this.scene, this.camera, writeBuffer, this.clear );

		}

	},

	setSize: function ( width, height ) {

		this.edgesRT.setSize( width, height );
		this.weightsRT.setSize( width, height );

		this.materialEdges.uniforms[ 'resolution' ].value.set( 1 / width, 1 / height );
		this.materialWeights.uniforms[ 'resolution' ].value.set( 1 / width, 1 / height );
		this.materialBlend.uniforms[ 'resolution' ].value.set( 1 / width, 1 / height );

	},

	getAreaTexture: function () {
		return 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAAIwCAIAAACOVPcQAACBeklEQVR42u39W4xlWXrnh/3WWvuciIzMrKxrV8/0rWbY0+SQFKcb4owIkSIFCjY9AC1BT/LYBozRi+EX+cV+8IMsYAaCwRcBwjzMiw2jAWtgwC8WR5Q8mDFHZLNHTarZGrLJJllt1W2qKrsumZWZcTvn7L3W54e1vrXX3vuciLPPORFR1XE2EomorB0nVuz//r71re/y/1eMvb4Cb3N11xV/PP/2v4UBAwJG/7H8urx6/25/Gf8O5hypMQ0EEEQwAqLfoN/Z+97f/SW+/NvcgQk4sGBJK6H7N4PFVL+K+e0N11yNfkKvwUdwdlUAXPHHL38oa15f/i/46Ih6SuMSPmLAYAwyRKn7dfMGH97jaMFBYCJUgotIC2YAdu+LyW9vvubxAP8kAL8H/koAuOKP3+q6+xGnd5kdYCeECnGIJViwGJMAkQKfDvB3WZxjLKGh8VSCCzhwEWBpMc5/kBbjawT4HnwJfhr+pPBIu7uu+OOTo9vsmtQcniMBGkKFd4jDWMSCRUpLjJYNJkM+IRzQ+PQvIeAMTrBS2LEiaiR9b/5PuT6Ap/AcfAFO4Y3dA3DFH7/VS+M8k4baEAQfMI4QfbVDDGIRg7GKaIY52qAjTAgTvGBAPGIIghOCYAUrGFNgzA7Q3QhgCwfwAnwe5vDejgG44o/fbm1C5ZlYQvQDARPAIQGxCWBM+wWl37ZQESb4gImexGMDouhGLx1Cst0Saa4b4AqO4Hk4gxo+3DHAV/nx27p3JziPM2pVgoiia5MdEzCGULprIN7gEEeQ5IQxEBBBQnxhsDb5auGmAAYcHMA9eAAz8PBol8/xij9+C4Djlim4gJjWcwZBhCBgMIIYxGAVIkH3ZtcBuLdtRFMWsPGoY9rN+HoBji9VBYdwD2ZQg4cnO7OSq/z4rU5KKdwVbFAjNojCQzTlCLPFSxtamwh2jMUcEgg2Wm/6XgErIBhBckQtGN3CzbVacERgCnfgLswhnvqf7QyAq/z4rRZm1YglYE3affGITaZsdIe2FmMIpnOCap25I6jt2kCwCW0D1uAD9sZctNGXcQIHCkINDQgc78aCr+zjtw3BU/ijdpw3zhCwcaONwBvdeS2YZKkJNJsMPf2JKEvC28RXxxI0ASJyzQCjCEQrO4Q7sFArEzjZhaFc4cdv+/JFdKULM4px0DfUBI2hIsy06BqLhGTQEVdbfAIZXYMPesq6VoCHICzUyjwInO4Y411//LYLs6TDa9wvg2CC2rElgAnpTBziThxaL22MYhzfkghz6GAs2VHbbdM91VZu1MEEpupMMwKyVTb5ij9+u4VJG/5EgEMMmFF01cFai3isRbKbzb+YaU/MQbAm2XSMoUPAmvZzbuKYRIFApbtlrfFuUGd6vq2hXNnH78ZLh/iFhsQG3T4D1ib7k5CC6vY0DCbtrohgLEIClXiGtl10zc0CnEGIhhatLBva7NP58Tvw0qE8yWhARLQ8h4+AhQSP+I4F5xoU+VilGRJs6wnS7ruti/4KvAY/CfdgqjsMy4pf8fodQO8/gnuX3f/3xi3om1/h7THr+co3x93PP9+FBUfbNUjcjEmhcrkT+8K7ml7V10Jo05mpIEFy1NmCJWx9SIKKt+EjAL4Ez8EBVOB6havuT/rByPvHXK+9zUcfcbb254+9fydJknYnRr1oGfdaiAgpxu1Rx/Rek8KISftx3L+DfsLWAANn8Hvw0/AFeAGO9DFV3c6D+CcWbL8Dj9e7f+T1k8AZv/d7+PXWM/Z+VvdCrIvuAKO09RpEEQJM0Ci6+B4xhTWr4cZNOvhktabw0ta0rSJmqz3Yw5/AKXwenod7cAhTmBSPKf6JBdvH8IP17h95pXqw50/+BFnj88fev4NchyaK47OPhhtI8RFSvAfDSNh0Ck0p2gLxGkib5NJj/JWCr90EWQJvwBzO4AHcgztwAFN1evHPUVGwfXON+0debT1YeGON9Yy9/63X+OguiwmhIhQhD7l4sMqlG3D86Suc3qWZ4rWjI1X7u0Ytw6x3rIMeIOPDprfe2XzNgyj6PahhBjO4C3e6puDgXrdg+/5l948vF3bqwZetZ+z9Rx9zdIY5pInPK4Nk0t+l52xdK2B45Qd87nM8fsD5EfUhIcJcERw4RdqqH7Yde5V7m1vhNmtedkz6EDzUMF/2jJYWbC+4fzzA/Y+/8PPH3j9dcBAPIRP8JLXd5BpAu03aziOL3VVHZzz3CXWDPWd+SH2AnxIqQoTZpo9Ckc6HIrFbAbzNmlcg8Ag8NFDDAhbJvTBZXbC94P7t68EXfv6o+21gUtPETU7bbkLxvNKRFG2+KXzvtObonPP4rBvsgmaKj404DlshFole1Glfh02fE7bYR7dZ82oTewIBGn1Md6CG6YUF26X376oevOLzx95vhUmgblI6LBZwTCDY7vMq0op5WVXgsObOXJ+1x3qaBl9j1FeLxbhU9w1F+Wiba6s1X/TBz1LnUfuYDi4r2C69f1f14BWfP+p+W2GFKuC9phcELMYRRLur9DEZTUdEH+iEqWdaM7X4WOoPGI+ZYD2+wcQ+y+ioHUZ9dTDbArzxmi/bJI9BND0Ynd6lBdve/butBw8+f/T9D3ABa3AG8W3VPX4hBin+bj8dMMmSpp5pg7fJ6xrBFE2WQQEWnV8Qg3FbAWzYfM1rREEnmvkN2o1+acG2d/9u68GDzx91v3mAjb1zkpqT21OipPKO0b9TO5W0nTdOmAQm0TObts3aBKgwARtoPDiCT0gHgwnbArzxmtcLc08HgF1asN0C4Ms/fvD5I+7PhfqyXE/b7RbbrGyRQRT9ARZcwAUmgdoz0ehJ9Fn7QAhUjhDAQSw0bV3T3WbNa59jzmiP6GsWbGXDX2ytjy8+f9T97fiBPq9YeLdBmyuizZHaqXITnXiMUEEVcJ7K4j3BFPurtB4bixW8wTpweL8DC95szWMOqucFYGsWbGU7p3TxxxefP+r+oTVktxY0v5hbq3KiOKYnY8ddJVSBxuMMVffNbxwIOERShst73HZ78DZrHpmJmH3K6sGz0fe3UUj0eyRrSCGTTc+rjVNoGzNSv05srAxUBh8IhqChiQgVNIIBH3AVPnrsnXQZbLTm8ammv8eVXn/vWpaTem5IXRlt+U/LA21zhSb9cye6jcOfCnOwhIAYXAMVTUNV0QhVha9xjgA27ODJbLbmitt3tRN80lqG6N/khgot4ZVlOyO4WNg3OIMzhIZQpUEHieg2im6F91hB3I2tubql6BYNN9Hj5S7G0G2tahslBWKDnOiIvuAEDzakDQKDNFQT6gbn8E2y4BBubM230YIpBnDbMa+y3dx0n1S0BtuG62lCCXwcY0F72T1VRR3t2ONcsmDjbmzNt9RFs2LO2hQNyb022JisaI8rAWuw4HI3FuAIhZdOGIcdjLJvvObqlpqvWTJnnQbyi/1M9O8UxWhBs//H42I0q1Yb/XPGONzcmm+ri172mHKvZBpHkJaNJz6v9jxqiklDj3U4CA2ugpAaYMWqNXsdXbmJNd9egCnJEsphXNM+MnK3m0FCJ5S1kmJpa3DgPVbnQnPGWIDspW9ozbcO4K/9LkfaQO2KHuqlfFXSbdNzcEcwoqNEFE9zcIXu9/6n/ym/BC/C3aJLzEKPuYVlbFnfhZ8kcWxV3dbv4bKl28566wD+8C53aw49lTABp9PWbsB+knfc/Li3eVizf5vv/xmvnPKg5ihwKEwlrcHqucuVcVOxEv8aH37E3ZqpZypUulrHEtIWKUr+txHg+ojZDGlwnqmkGlzcVi1dLiNSJiHjfbRNOPwKpx9TVdTn3K05DBx4psIk4Ei8aCkJahRgffk4YnEXe07T4H2RR1u27E6wfQsBDofUgjFUFnwC2AiVtA+05J2zpiDK2Oa0c5fmAecN1iJzmpqFZxqYBCYhFTCsUNEmUnIcZ6aEA5rQVhEywG6w7HSW02XfOoBlQmjwulOFQAg66SvJblrTEX1YtJ3uG15T/BH1OfOQeuR8g/c0gdpT5fx2SKbs9EfHTKdM8A1GaJRHLVIwhcGyydZsbifAFVKl5EMKNU2Hryo+06BeTgqnxzYjThVySDikbtJPieco75lYfKAJOMEZBTjoITuWHXXZVhcUDIS2hpiXHV9Ku4u44bN5OYLDOkJo8w+xJSMbhBRHEdEs9JZUCkQrPMAvaHyLkxgkEHxiNkx/x2YB0mGsQ8EUWj/stW5YLhtS5SMu+/YBbNPDCkGTUybN8krRLBGPlZkVOA0j+a1+rkyQKWGaPHPLZOkJhioQYnVZ2hS3zVxMtgC46KuRwbJNd9nV2PHgb36F194ecf/Yeu2vAFe5nm/bRBFrnY4BauE8ERmZRFUn0k8hbftiVYSKMEme2dJCJSCGYAlNqh87bXOPdUkGy24P6d1ll21MBqqx48Fvv8ZHH8HZFY7j/uAq1xMJUFqCSUlJPmNbIiNsmwuMs/q9CMtsZsFO6SprzCS1Z7QL8xCQClEelpjTduDMsmWD8S1PT152BtvmIGvUeDA/yRn83u/x0/4qxoPHjx+PXY9pqX9bgMvh/Nz9kpP4pOe1/fYf3axUiMdHLlPpZCNjgtNFAhcHEDxTumNONhHrBduW+vOyY++70WWnPXj98eA4kOt/mj/5E05l9+O4o8ePx67HFqyC+qSSnyselqjZGaVK2TadbFLPWAQ4NBhHqDCCV7OTpo34AlSSylPtIdd2AJZlyzYQrDJ5lcWGNceD80CunPLGGzsfD+7wRb95NevJI5docQ3tgCyr5bGnyaPRlmwNsFELViOOx9loebGNq2moDOKpHLVP5al2cymWHbkfzGXL7kfRl44H9wZy33tvt+PB/Xnf93e+nh5ZlU18wCiRUa9m7kib9LYuOk+hudQNbxwm0AQqbfloimaB2lM5fChex+ylMwuTbfmXQtmWlenZljbdXTLuOxjI/fDDHY4Hjx8/Hrse0zXfPFxbUN1kKqSCCSk50m0Ajtx3ub9XHBKHXESb8iO6E+qGytF4nO0OG3SXzbJlhxBnKtKyl0NwybjvYCD30aMdjgePHz8eu56SVTBbgxJMliQ3Oauwg0QHxXE2Ez/EIReLdQj42Gzb4CLS0YJD9xUx7bsi0vJi5mUbW1QzL0h0PFk17rtiIPfJk52MB48fPx67npJJwyrBa2RCCQRTbGZSPCxTPOiND4G2pYyOQ4h4jINIJh5wFU1NFZt+IsZ59LSnDqBjZ2awbOku+yInunLcd8VA7rNnOxkPHj9+PGY9B0MWJJNozOJmlglvDMXDEozdhQWbgs/U6oBanGzLrdSNNnZFjOkmbi5bNt1lX7JLLhn3vXAg9/h4y/Hg8ePHI9dzQMEkWCgdRfYykYKnkP7D4rIujsujaKPBsB54vE2TS00ccvFY/Tth7JXeq1hz+qgVy04sAJawTsvOknHfCwdyT062HA8eP348Zj0vdoXF4pilKa2BROed+9fyw9rWRXeTFXESMOanvDZfJuJaSXouQdMdDJZtekZcLLvEeK04d8m474UDuaenW44Hjx8/Xns9YYqZpszGWB3AN/4VHw+k7WSFtJ3Qicuqb/NlVmgXWsxh570xg2UwxUw3WfO6B5nOuO8aA7lnZxuPB48fPx6znm1i4bsfcbaptF3zNT78eFPtwi1OaCNOqp1x3zUGcs/PN++AGD1+fMXrSVm2baTtPhPahbPhA71wIHd2bXzRa69nG+3CraTtPivahV/55tXWg8fyRY/9AdsY8VbSdp8V7cKrrgdfM//z6ILQFtJ2nxHtwmuoB4/kf74+gLeRtvvMaBdeSz34+vifx0YG20jbfTa0C6+tHrwe//NmOG0L8EbSdp8R7cLrrQe/996O+ai3ujQOskpTNULa7jOjXXj99eCd8lHvoFiwsbTdZ0a78PrrwTvlo966pLuRtB2fFe3Cm6oHP9kNH/W2FryxtN1nTLvwRurBO+Kj3pWXHidtx2dFu/Bm68Fb81HvykuPlrb7LGkX3mw9eGs+6h1Y8MbSdjegXcguQLjmevDpTQLMxtJ2N6NdyBZu9AbrwVvwUW+LbteULUpCdqm0HTelXbhNPe8G68Gb8lFvVfYfSNuxvrTdTWoXbozAzdaDZzfkorOj1oxVxlIMlpSIlpLrt8D4hrQL17z+c3h6hU/wv4Q/utps4+bm+6P/hIcf0JwQ5oQGPBL0eKPTYEXTW+eL/2DKn73J9BTXYANG57hz1cEMviVf/4tf5b/6C5pTQkMIWoAq7hTpOJjtAM4pxKu5vg5vXeUrtI09/Mo/5H+4z+Mp5xULh7cEm2QbRP2tFIKR7WM3fPf/jZ3SWCqLM2l4NxID5zB72HQXv3jj/8mLR5xXNA5v8EbFQEz7PpRfl1+MB/hlAN65qgDn3wTgH13hK7T59bmP+NIx1SHHU84nLOITt3iVz8mNO+lPrjGAnBFqmioNn1mTyk1ta47R6d4MrX7tjrnjYUpdUbv2rVr6YpVfsGG58AG8Ah9eyUN8CX4WfgV+G8LVWPDGb+Zd4cU584CtqSbMKxauxTg+dyn/LkVgA+IR8KHtejeFKRtTmLLpxN6mYVLjYxwXf5x2VofiZcp/lwKk4wGOpYDnoIZPdg/AAbwMfx0+ge9dgZvYjuqKe4HnGnykYo5TvJbG0Vj12JagRhwKa44H95ShkZa5RyLGGdfYvG7aw1TsF6iapPAS29mNS3NmsTQZCmgTzFwgL3upCTgtBTRwvGMAKrgLn4evwin8+afJRcff+8izUGUM63GOOuAs3tJkw7J4kyoNreqrpO6cYLQeFUd7TTpr5YOTLc9RUUogUOVJQ1GYJaFLAW0oTmKyYS46ZooP4S4EON3xQ5zC8/CX4CnM4c1PE8ApexpoYuzqlP3d4S3OJP8ZDK7cKWNaTlqmgDiiHwl1YsE41w1zT4iRTm3DBqxvOUsbMKKDa/EHxagtnta072ejc3DOIh5ojvh8l3tk1JF/AV6FU6jh3U8HwEazLgdCLYSQ+MYiAI2ltomkzttUb0gGHdSUUgsIYjTzLG3mObX4FBRaYtpDVNZrih9TgTeYOBxsEnN1gOCTM8Bsw/ieMc75w9kuAT6A+/AiHGvN/+Gn4KRkiuzpNNDYhDGFndWRpE6SVfm8U5bxnSgVV2jrg6JCKmneqey8VMFgq2+AM/i4L4RUbfSi27lNXZ7R7W9RTcq/q9fk4Xw3AMQd4I5ifAZz8FcVtm9SAom/dyN4lczJQW/kC42ZrHgcCoIf1oVMKkVItmMBi9cOeNHGLqOZk+QqQmrbc5YmYgxELUUN35z2iohstgfLIFmcMV7s4CFmI74L9+EFmGsi+tGnAOD4Yk9gIpo01Y4cA43BWGygMdr4YZekG3OBIUXXNukvJS8tqa06e+lSDCtnqqMFu6hWHXCF+WaYt64m9QBmNxi7Ioy7D+fa1yHw+FMAcPt7SysFLtoG4PXAk7JOA3aAxBRqUiAdU9Yp5lK3HLSRFtOim0sa8euEt08xvKjYjzeJ2GU7YawexrnKI9tmobInjFXCewpwriY9+RR4aaezFhMhGCppKwom0ChrgFlKzyPKkGlTW1YQrE9HJqu8hKGgMc6hVi5QRq0PZxNfrYNgE64utmRv6KKHRpxf6VDUaOvNP5jCEx5q185My/7RKz69UQu2im5k4/eownpxZxNLwiZ1AZTO2ZjWjkU9uaB2HFn6Q3u0JcsSx/qV9hTEApRzeBLDJQXxYmTnq7bdLa3+uqFrxLJ5w1TehnNHx5ECvCh2g2c3hHH5YsfdaSKddztfjQ6imKFGSyFwlLzxEGPp6r5IevVjk1AMx3wMqi1NxDVjLBiPs9tbsCkIY5we5/ML22zrCScFxnNtzsr9Wcc3CnD+pYO+4VXXiDE0oc/vQQ/fDK3oPESJMYXNmJa/DuloJZkcTpcYE8lIH8Dz8DJMiynNC86Mb2lNaaqP/+L7f2fcE/yP7/Lde8xfgSOdMxvOixZf/9p3+M4hT1+F+zApxg9XfUvYjc8qX2lfOOpK2gNRtB4flpFu9FTKCp2XJRgXnX6olp1zyYjTKJSkGmLE2NjUr1bxFM4AeAAHBUFIeSLqXR+NvH/M9fOnfHzOD2vCSyQJKzfgsCh+yi/Mmc35F2fUrw7miW33W9hBD1vpuUojFphIyvg7aTeoymDkIkeW3XLHmguMzbIAJejN6B5MDrhipE2y6SoFRO/AK/AcHHZHNIfiWrEe/C6cr3f/yOvrQKB+zMM55/GQdLDsR+ifr5Fiuu+/y+M78LzOE5dsNuXC3PYvYWd8NXvphLSkJIasrlD2/HOqQ+RjcRdjKTGWYhhVUm4yxlyiGPuMsZR7sMCHUBeTuNWA7if+ifXgc/hovftHXs/DV+Fvwe+f8shzMiMcweFgBly3//vwJfg5AN4450fn1Hd1Rm1aBLu22Dy3y3H2+OqMemkbGZ4jozcDjJf6596xOLpC0eMTHbKnxLxH27uZ/bMTGs2jOaMOY4m87CfQwF0dw53oa1k80JRuz/XgS+8fX3N9Af4qPIMfzKgCp4H5TDGe9GGeFPzSsZz80SlPTxXjgwJmC45njzgt2vbQ4b4OAdUK4/vWhO8d8v6EE8fMUsfakXbPpFJeLs2ubM/qdm/la3WP91uWhxXHjoWhyRUq2iJ/+5mA73zwIIo+LoZ/SgvIRjAd1IMvvn98PfgOvAJfhhm8scAKVWDuaRaK8aQ9f7vuPDH6Bj47ZXau7rqYJ66mTDwEDU6lLbCjCK0qTXyl5mnDoeNRxanj3FJbaksTk0faXxHxLrssgPkWB9LnA/MFleXcJozzjwsUvUG0X/QCve51qkMDXp9mtcyOy3rwBfdvVJK7D6/ACSzg3RoruIq5UDeESfEmVclDxnniU82vxMLtceD0hGZWzBNPMM/jSPne2OVatiTKUpY5vY7gc0LdUAWeWM5tH+O2I66AOWw9xT2BuyRVLGdoDHUsVRXOo/c+ZdRXvFfnxWyIV4upFLCl9eAL7h8Zv0QH8Ry8pA2cHzQpGesctVA37ZtklBTgHjyvdSeKY/RZw/kJMk0Y25cSNRWSigQtlULPTw+kzuJPeYEkXjQRpoGZobYsLF79pyd1dMRHInbgFTZqNLhDqiIsTNpoex2WLcy0/X6rHcdMMQvFSd5dWA++4P7xv89deACnmr36uGlL69bRCL6BSZsS6c0TU2TKK5gtWCzgAOOwQcurqk9j8whvziZSMLcq5hbuwBEsYjopUBkqw1yYBGpLA97SRElEmx5MCInBY5vgLk94iKqSWmhIGmkJ4Bi9m4L645J68LyY4wsFYBfUg5feP/6gWWm58IEmKQM89hq7KsZNaKtP5TxxrUZZVkNmMJtjbKrGxLNEbHPJxhqy7lAmbC32ZqeF6lTaknRWcYaFpfLUBh/rwaQycCCJmW15Kstv6jRHyJFry2C1ahkkIW0LO75s61+owxK1y3XqweX9m5YLM2DPFeOjn/iiqCKJ+yKXF8t5Yl/kNsqaSCryxPq5xWTFIaP8KSW0RYxqupaUf0RcTNSSdJZGcKYdYA6kdtrtmyBckfKXwqk0pHpUHlwWaffjNRBYFPUDWa8e3Lt/o0R0CdisKDM89cX0pvRHEfM8ca4t0s2Xx4kgo91MPQJ/0c9MQYq0co8MBh7bz1fio0UUHLR4aAIOvOmoYO6kwlEVODSSTliWtOtH6sPkrtctF9ZtJ9GIerBskvhdVS5cFNv9s1BU0AbdUgdK4FG+dRnjFmDTzniRMdZO1QhzMK355vigbdkpz9P6qjUGE5J2qAcXmwJ20cZUiAD0z+pGMx6xkzJkmEf40Hr4qZfVg2XzF9YOyoV5BjzVkUJngKf8lgNYwKECEHrCNDrWZzMlflS3yBhr/InyoUgBc/lKT4pxVrrC6g1YwcceK3BmNxZcAtz3j5EIpqguh9H6wc011YN75cKDLpFDxuwkrPQmUwW4KTbj9mZTwBwLq4aQMUZbHm1rylJ46dzR0dua2n3RYCWZsiHROeywyJGR7mXKlpryyCiouY56sFkBWEnkEB/raeh/Sw4162KeuAxMQpEkzy5alMY5wamMsWKKrtW2WpEWNnReZWONKWjrdsKZarpFjqCslq773PLmEhM448Pc3+FKr1+94vv/rfw4tEcu+lKTBe4kZSdijBrykwv9vbCMPcLQTygBjzVckSLPRVGslqdunwJ4oegtFOYb4SwxNgWLCmD7T9kVjTv5YDgpo0XBmN34Z/rEHp0sgyz7lngsrm4lvMm2Mr1zNOJYJ5cuxuQxwMGJq/TP5emlb8fsQBZviK4t8hFL+zbhtlpwaRSxQRWfeETjuauPsdGxsBVdO7nmP4xvzSoT29pRl7kGqz+k26B3Oy0YNV+SXbbQas1ctC/GarskRdFpKczVAF1ZXnLcpaMuzVe6lZ2g/1ndcvOVgRG3sdUAY1bKD6achijMPdMxV4muKVorSpiDHituH7rSTs7n/4y5DhRXo4FVBN4vO/zbAcxhENzGbHCzU/98Mcx5e7a31kWjw9FCe/zNeYyQjZsWb1uc7U33pN4Mji6hCLhivqfa9Ss6xLg031AgfesA/l99m9fgvnaF9JoE6bYKmkGNK3aPbHB96w3+DnxFm4hs0drLsk7U8kf/N/CvwQNtllna0rjq61sH8L80HAuvwH1tvBy2ChqWSCaYTaGN19sTvlfzFD6n+iKTbvtayfrfe9ueWh6GJFoxLdr7V72a5ZpvHcCPDzma0wTO4EgbLyedxstO81n57LYBOBzyfsOhUKsW1J1BB5vr/tz8RyqOFylQP9Tvst2JALsC5lsH8PyQ40DV4ANzYa4dedNiKNR1s+x2wwbR7q4/4cTxqEk4LWDebfisuo36JXLiWFjOtLrlNWh3K1rRS4xvHcDNlFnNmWBBAl5SWaL3oPOfnvbr5pdjVnEaeBJSYjuLEkyLLsWhKccadmOphZkOPgVdalj2QpSmfOsADhMWE2ZBu4+EEJI4wKTAuCoC4xwQbWXBltpxbjkXJtKxxabo9e7tyhlgb6gNlSbUpMh+l/FaqzVwewGu8BW1Zx7pTpQDJUjb8tsUTW6+GDXbMn3mLbXlXJiGdggxFAoUrtPS3wE4Nk02UZG2OOzlk7fRs7i95QCLo3E0jtrjnM7SR3uS1p4qtS2nJ5OwtQVHgOvArLBFijZUV9QtSl8dAY5d0E0hM0w3HS2DpIeB6m/A1+HfhJcGUq4sOxH+x3f5+VO+Ds9rYNI7zPXOYWPrtf8bYMx6fuOAX5jzNR0PdsuON+X1f7EERxMJJoU6GkTEWBvVolVlb5lh3tKCg6Wx1IbaMDdJ+9sUCc5KC46hKGCk3IVOS4TCqdBNfUs7Kd4iXf2RjnT/LLysJy3XDcHLh/vde3x8DoGvwgsa67vBk91G5Pe/HbOe7xwym0NXbtiuuDkGO2IJDh9oQvJ4cY4vdoqLDuoH9Zl2F/ofsekn8lkuhIlhQcffUtSjytFyp++p6NiE7Rqx/lodgKVoceEp/CP4FfjrquZaTtj2AvH5K/ywpn7M34K/SsoYDAdIN448I1/0/wveW289T1/lX5xBzc8N5IaHr0XMOQdHsIkDuJFifj20pBm5jzwUv9e2FhwRsvhAbalCIuIw3bhJihY3p6nTFFIZgiSYjfTf3aXuOjmeGn4bPoGvwl+CFzTRczBIuHBEeImHc37/lGfwZR0cXzVDOvaKfNHvwe+suZ771K/y/XcBlsoN996JpBhoE2toYxOznNEOS5TJc6Id5GEXLjrWo+LEWGNpPDU4WAwsIRROu+1vM+0oW37z/MBN9kqHnSArwPfgFJ7Cq/Ai3Ie7g7ncmI09v8sjzw9mzOAEXoIHxURueaAce5V80f/DOuuZwHM8vsMb5wBzOFWM7wymTXPAEvm4vcFpZ2ut0VZRjkiP2MlmLd6DIpbGSiHOjdnUHN90hRYmhTnmvhzp1iKDNj+b7t5hi79lWGwQ+HN9RsfFMy0FXbEwhfuczKgCbyxYwBmcFhhvo/7a44v+i3XWcwDP86PzpGQYdWh7csP5dBvZ1jNzdxC8pBGuxqSW5vw40nBpj5JhMwvOzN0RWqERHMr4Lv1kWX84xLR830G3j6yqZ1a8UstTlW+qJPOZ+sZ7xZPKTJLhiNOAFd6tk+jrTH31ncLOxid8+nzRb128HhUcru/y0Wn6iT254YPC6FtVSIMoW2sk727AhvTtrWKZTvgsmckfXYZWeNRXx/3YQ2OUxLDrbHtN11IwrgXT6c8dATDwLniYwxzO4RzuQqTKSC5gAofMZ1QBK3zQ4JWobFbcvJm87FK+6JXrKahLn54m3p+McXzzYtP8VF/QpJuh1OwieElEoI1pRxPS09FBrkq2tWCU59+HdhNtTIqKm8EBrw2RTOEDpG3IKo2Y7mFdLm3ZeVjYwVw11o/oznceMve4CgMfNym/utA/d/ILMR7gpXzRy9eDsgLcgbs8O2Va1L0zzIdwGGemTBuwROHeoMShkUc7P+ISY3KH5ZZeWqO8mFTxQYeXTNuzvvK5FGPdQfuu00DwYFY9dyhctEt+OJDdnucfpmyhzUJzfsJjr29l8S0bXBfwRS9ZT26tmMIdZucch5ZboMz3Nio3nIOsYHCGoDT4kUA9MiXEp9Xsui1S8th/kbWIrMBxDGLodWUQIWcvnXy+9M23xPiSMOiRPqM+YMXkUN3gXFrZJwXGzUaMpJfyRS9ZT0lPe8TpScuRlbMHeUmlaKDoNuy62iWNTWNFYjoxFzuJs8oR+RhRx7O4SVNSXpa0ZJQ0K1LAHDQ+D9IepkMXpcsq5EVCvClBUIzDhDoyKwDw1Lc59GbTeORivugw1IcuaEOaGWdNm+Ps5fQ7/tm0DjMegq3yM3vb5j12qUId5UZD2oxDSEWOZMSqFl/W+5oynWDa/aI04tJRQ2eTXusg86SQVu/nwSYwpW6wLjlqIzwLuxGIvoAvul0PS+ZNz0/akp/pniO/8JDnGyaCkzbhl6YcqmK/69prxPqtpx2+Km9al9sjL+rwMgHw4jE/C8/HQ3m1vBuL1fldbzd8mOueVJ92syqdEY4KJjSCde3mcRw2TA6szxedn+zwhZMps0XrqEsiUjnC1hw0TELC2Ek7uAAdzcheXv1BYLagspxpzSAoZZUsIzIq35MnFQ9DOrlNB30jq3L4pkhccKUAA8/ocvN1Rzx9QyOtERs4CVsJRK/DF71kPYrxYsGsm6RMh4cps5g1DOmM54Ly1ii0Hd3Y/BMk8VWFgBVmhqrkJCPBHAolwZaWzLR9Vb7bcWdX9NyUYE+uB2BKfuaeBUcjDljbYVY4DdtsVWvzRZdWnyUzDpjNl1Du3aloAjVJTNDpcIOVVhrHFF66lLfJL1zJr9PQ2nFJSBaKoDe+sAvLufZVHVzYh7W0h/c6AAZ+7Tvj6q9j68G/cTCS/3n1vLKHZwNi+P+pS0WkZNMBMUl+LDLuiE4omZy71r3UFMwNJV+VJ/GC5ixVUkBStsT4gGKh0Gm4Oy3qvq7Lbmq24nPdDuDR9deR11XzP4vFu3TYzfnIyiSVmgizUYGqkIXNdKTY9pgb9D2Ix5t0+NHkVzCdU03suWkkVZAoCONCn0T35gAeW38de43mf97sMOpSvj4aa1KYUm58USI7Wxxes03bAZdRzk6UtbzMaCQ6IxO0dy7X+XsjoD16hpsBeGz9dfzHj+R/Hp8nCxZRqkEDTaCKCSywjiaoMJ1TITE9eg7Jqnq8HL6gDwiZb0u0V0Rr/rmvqjxKuaLCX7ZWXTvAY+uvm3z8CP7nzVpngqrJpZKwWnCUjIviYVlirlGOzPLI3SMVyp/elvBUjjDkNhrtufFFErQ8pmdSlbK16toBHlt/HV8uHMX/vEGALkV3RJREiSlopxwdMXOZPLZ+ix+kAHpMKIk8UtE1ygtquttwxNhphrIZ1IBzjGF3IIGxGcBj6q8bHJBG8T9vdsoWrTFEuebEZuVxhhClH6P5Zo89OG9fwHNjtNQTpD0TG9PJLEYqvEY6Rlxy+ZZGfL0Aj62/bnQCXp//eeM4KzfQVJbgMQbUjlMFIm6TpcfWlZje7NBSV6IsEVmumWIbjiloUzQX9OzYdo8L1wjw2PrrpimONfmfNyzKklrgnEkSzT5QWYQW40YShyzqsRmMXbvVxKtGuYyMKaU1ugenLDm5Ily4iT14fP11Mx+xJv+zZ3MvnfdFqxU3a1W/FTB4m3Qfsyc1XUcdVhDeUDZXSFHHLQj/Y5jtC7ZqM0CXGwB4bP11i3LhOvzPGygYtiUBiwQV/4wFO0majijGsafHyRLu0yG6q35cL1rOpVxr2s5cM2jJYMCdc10Aj6q/blRpWJ//+dmm5psMl0KA2+AFRx9jMe2WbC4jQxnikd4DU8TwUjRVacgdlhmr3bpddzuJ9zXqr2xnxJfzP29RexdtjDVZqzkqa6PyvcojGrfkXiJ8SEtml/nYskicv0ivlxbqjemwUjMw5evdg8fUX9nOiC/lf94Q2i7MURk9nW1MSj5j8eAyV6y5CN2S6qbnw3vdA1Iwq+XOSCl663udN3IzLnrt+us25cI1+Z83SXQUldqQq0b5XOT17bGpLd6ssN1VMPf8c+jG8L3NeCnMdF+Ra3fRa9dft39/LuZ/3vwHoHrqGmQFafmiQw6eyzMxS05K4bL9uA+SKUQzCnSDkqOGokXyJvbgJ/BHI+qvY69//4rl20NsmK2ou2dTsyIALv/91/8n3P2Aao71WFGi8KKv1fRC5+J67Q/507/E/SOshqN5TsmYIjVt+kcjAx98iz/4SaojbIV1rexE7/C29HcYD/DX4a0rBOF5VTu7omsb11L/AWcVlcVZHSsqGuXLLp9ha8I//w3Mv+T4Ew7nTBsmgapoCrNFObIcN4pf/Ob/mrvHTGqqgAupL8qWjWPS9m/31jAe4DjA+4+uCoQoT/zOzlrNd3qd4SdphFxsUvYwGWbTWtISc3wNOWH+kHBMfc6kpmpwPgHWwqaSUG2ZWWheYOGQGaHB+eQ/kn6b3pOgLV+ODSn94wDvr8Bvb70/LLuiPPEr8OGVWfDmr45PZyccEmsVXZGe1pRNX9SU5+AVQkNTIVPCHF/jGmyDC9j4R9LfWcQvfiETmgMMUCMN1uNCakkweZsowdYobiMSlnKA93u7NzTXlSfe+SVbfnPQXmg9LpYAQxpwEtONyEyaueWM4FPjjyjG3uOaFmBTWDNgBXGEiQpsaWhnAqIijB07Dlsy3fUGeP989xbWkyf+FF2SNEtT1E0f4DYYVlxFlbaSMPIRMk/3iMU5pME2SIWJvjckciebkQuIRRyhUvkHg/iUljG5kzVog5hV7vIlCuBrmlhvgPfNHQM8lCf+FEGsYbMIBC0qC9a0uuy2wLXVbLBaP5kjHokCRxapkQyzI4QEcwgYHRZBp+XEFTqXFuNVzMtjXLJgX4gAid24Hjwc4N3dtVSe+NNiwTrzH4WVUOlDobUqr1FuAgYllc8pmzoVrELRHSIW8ViPxNy4xwjBpyR55I6J220qQTZYR4guvUICJiSpr9gFFle4RcF/OMB7BRiX8sSfhpNSO3lvEZCQfLUVTKT78Ek1LRLhWN+yLyTnp8qWUZ46b6vxdRGXfHVqx3eI75YaLa4iNNiK4NOW7wPW6lhbSOF9/M9qw8e/aoB3d156qTzxp8pXx5BKAsYSTOIIiPkp68GmTq7sZtvyzBQaRLNxIZ+paozHWoLFeExIhRBrWitHCAHrCF7/thhD8JhYz84wg93QRV88wLuLY8zF8sQ36qF1J455bOlgnELfshKVxYOXKVuKx0jaj22sczTQqPqtV/XDgpswmGTWWMSDw3ssyUunLLrVPGjYRsH5ggHeHSWiV8kT33ycFSfMgkoOK8apCye0J6VW6GOYvffgU9RWsukEi2kUV2nl4dOYUzRik9p7bcA4ggdJ53LxKcEe17B1R8eqAd7dOepV8sTXf5lhejoL85hUdhDdknPtKHFhljOT+bdq0hxbm35p2nc8+Ja1Iw+tJykgp0EWuAAZYwMVwac5KzYMslhvgHdHRrxKnvhTYcfKsxTxtTETkjHO7rr3zjoV25lAQHrqpV7bTiy2aXMmUhTBnKS91jhtR3GEoF0oLnWhWNnYgtcc4N0FxlcgT7yz3TgNIKkscx9jtV1ZKpWW+Ub1tc1eOv5ucdgpx+FJy9pgbLE7xDyXb/f+hLHVGeitHOi6A7ybo3sF8sS7w7cgdk0nJaOn3hLj3uyD0Zp5pazFIUXUpuTTU18d1EPkDoX8SkmWTnVIozEdbTcZjoqxhNHf1JrSS/AcvHjZ/SMHhL/7i5z+POsTUh/8BvNfYMTA8n+yU/MlTZxSJDRStqvEuLQKWwDctMTQogUDyQRoTQG5Kc6oQRE1yV1jCA7ri7jdZyK0sYTRjCR0Hnnd+y7nHxNgTULqw+8wj0mQKxpYvhjm9uSUxg+TTy7s2GtLUGcywhXSKZN275GsqlclX90J6bRI1aouxmgL7Q0Nen5ziM80SqMIo8cSOo+8XplT/5DHNWsSUr/6lLN/QQ3rDyzLruEW5enpf7KqZoShEduuSFOV7DLX7Ye+GmXb6/hnNNqKsVXuMDFpb9Y9eH3C6NGEzuOuI3gpMH/I6e+zDiH1fXi15t3vA1czsLws0TGEtmPEJdiiFPwlwKbgLHAFk4P6ZyPdymYYHGE0dutsChQBl2JcBFlrEkY/N5bQeXQ18gjunuMfMfsBlxJSx3niO485fwO4fGD5T/+3fPQqkneWVdwnw/3bMPkW9Wbqg+iC765Zk+xcT98ibKZc2EdgHcLoF8cSOo/Oc8fS+OyEULF4g4sJqXVcmfMfsc7A8v1/yfGXmL9I6Fn5pRwZhsPv0TxFNlAfZCvG+Oohi82UC5f/2IsJo0cTOm9YrDoKhFPEUr/LBYTUNht9zelHXDqwfPCIw4owp3mOcIQcLttWXFe3VZ/j5H3cIc0G6oPbCR+6Y2xF2EC5cGUm6wKC5tGEzhsWqw5hNidUiKX5gFWE1GXh4/Qplw4sVzOmx9QxU78g3EF6wnZlEN4FzJ1QPSLEZz1KfXC7vd8ssGdIbNUYpVx4UapyFUHzJoTOo1McSkeNn1M5MDQfs4qQuhhX5vQZFw8suwWTcyYTgioISk2YdmkhehG4PkE7w51inyAGGaU+uCXADabGzJR1fn3lwkty0asIo8cROm9Vy1g0yDxxtPvHDAmpu+PKnM8Ix1wwsGw91YJqhteaWgjYBmmQiebmSpwKKzE19hx7jkzSWOm66oPbzZ8Yj6kxVSpYjVAuvLzYMCRo3oTQecOOjjgi3NQ4l9K5/hOGhNTdcWVOTrlgYNkEXINbpCkBRyqhp+LdRB3g0OU6rMfW2HPCFFMV9nSp+uB2woepdbLBuJQyaw/ZFysXrlXwHxI0b0LovEkiOpXGA1Ijagf+KUNC6rKNa9bQnLFqYNkEnMc1uJrg2u64ELPBHpkgWbmwKpJoDhMwNbbGzAp7Yg31wS2T5rGtzit59PrKhesWG550CZpHEzpv2NGRaxlNjbMqpmEIzygJqQfjypycs2pg2cS2RY9r8HUqkqdEgKTWtWTKoRvOBPDYBltja2SO0RGjy9UHtxwRjA11ujbKF+ti5cIR9eCnxUg6owidtyoU5tK4NLji5Q3HCtiyF2IqLGYsHViOXTXOYxucDqG0HyttqYAKqYo3KTY1ekyDXRAm2AWh9JmsVh/ccg9WJ2E8YjG201sPq5ULxxX8n3XLXuMInbft2mk80rRGjCGctJ8/GFdmEQ9Ug4FlE1ll1Y7jtiraqm5Fe04VV8lvSVBL8hiPrfFVd8+7QH3Qbu2ipTVi8cvSGivc9cj8yvH11YMHdNSERtuOslM97feYFOPKzGcsI4zW0YGAbTAOaxCnxdfiYUmVWslxiIblCeAYr9VYR1gM7GmoPrilunSxxeT3DN/2eBQ9H11+nk1adn6VK71+5+Jfct4/el10/7KBZfNryUunWSCPxPECk1rdOv1WVSrQmpC+Tl46YD3ikQYcpunSQgzVB2VHFhxHVGKDgMEY5GLlQnP7FMDzw7IacAWnO6sBr12u+XanW2AO0wQ8pknnFhsL7KYIqhkEPmEXFkwaN5KQphbkUmG72wgw7WSm9RiL9QT925hkjiVIIhphFS9HKI6/8QAjlpXqg9W2C0apyaVDwKQwrwLY3j6ADR13ZyUNByQXHQu6RY09Hu6zMqXRaNZGS/KEJs0cJEe9VH1QdvBSJv9h09eiRmy0V2uJcqHcShcdvbSNg5fxkenkVprXM9rDVnX24/y9MVtncvbKY706anNl3ASll9a43UiacVquXGhvq4s2FP62NGKfQLIQYu9q1WmdMfmUrDGt8eDS0cXozH/fjmUH6Jruvm50hBDSaEU/2Ru2LEN/dl006TSc/g7tfJERxGMsgDUEr104pfWH9lQaN+M4KWQjwZbVc2rZVNHsyHal23wZtIs2JJqtIc/WLXXRFCpJkfE9jvWlfFbsNQ9pP5ZBS0zKh4R0aMFj1IjTcTnvi0Zz2rt7NdvQb2mgbju1plsH8MmbnEk7KbK0b+wC2iy3aX3szW8xeZvDwET6hWZYwqTXSSG+wMETKum0Dq/q+x62gt2ua2ppAo309TRk9TPazfV3qL9H8z7uhGqGqxNVg/FKx0HBl9OVUORn8Q8Jx9gFttGQUDr3tzcXX9xGgN0EpzN9mdZ3GATtPhL+CjxFDmkeEU6x56kqZRusLzALXVqkCN7zMEcqwjmywDQ6OhyUe0Xao1Qpyncrg6wKp9XfWDsaZplElvQ/b3sdweeghorwBDlHzgk1JmMc/wiERICVy2VJFdMjFuLQSp3S0W3+sngt2njwNgLssFGVQdJ0tu0KH4ky1LW4yrbkuaA6Iy9oz/qEMMXMMDWyIHhsAyFZc2peV9hc7kiKvfULxCl9iddfRK1f8kk9qvbdOoBtOg7ZkOZ5MsGrSHsokgLXUp9y88smniwWyuFSIRVmjplga3yD8Uij5QS1ZiM4U3Qw5QlSm2bXjFe6jzzBFtpg+/YBbLAWG7OPynNjlCw65fukGNdkJRf7yM1fOxVzbxOJVocFoYIaGwH22mIQkrvu1E2nGuebxIgW9U9TSiukPGU+Lt++c3DJPKhyhEEbXCQLUpae2exiKy6tMPe9mDRBFCEMTWrtwxN8qvuGnt6MoihKWS5NSyBhbH8StXoAz8PLOrRgLtOT/+4vcu+7vDLnqNvztOq7fmd8sMmY9Xzn1zj8Dq8+XVdu2Nv0IIySgEdQo3xVHps3Q5i3fLFsV4aiqzAiBhbgMDEd1uh8qZZ+lwhjkgokkOIv4xNJmyncdfUUzgB4oFMBtiu71Xumpz/P+cfUP+SlwFExwWW62r7b+LSPxqxn/gvMZ5z9C16t15UbNlq+jbGJtco7p8wbYlL4alSyfWdeuu0j7JA3JFNuVAwtst7F7FhWBbPFNKIUORndWtLraFLmMu7KFVDDOzqkeaiN33YAW/r76wR4XDN/yN1z7hejPau06EddkS/6XThfcz1fI/4K736fO48vlxt2PXJYFaeUkFS8U15XE3428xdtn2kc8GQlf1vkIaNRRnOMvLTWrZbElEHeLWi1o0dlKPAh1MVgbbVquPJ5+Cr8LU5/H/+I2QlHIU2ClXM9G8v7Rr7oc/hozfUUgsPnb3D+I+7WF8kNO92GY0SNvuxiE+2Bt8prVJTkzE64sfOstxuwfxUUoyk8VjcTlsqe2qITSFoSj6Epd4KsT6BZOWmtgE3hBfir8IzZDwgV4ZTZvD8VvPHERo8v+vL1DASHTz/i9OlKueHDjK5Rnx/JB1Vb1ioXdBra16dmt7dgik10yA/FwJSVY6XjA3oy4SqM2frqDPPSRMex9qs3XQtoWxMj7/Er8GWYsXgjaVz4OYumP2+9kbxvny/6kvWsEBw+fcb5bInc8APdhpOSs01tEqIkoiZjbAqKMruLbJYddHuHFRIyJcbdEdbl2sVLaySygunutBg96Y2/JjKRCdyHV+AEFtTvIpbKIXOamknYSiB6KV/0JetZITgcjjk5ZdaskBtWO86UF0ap6ozGXJk2WNiRUlCPFir66lzdm/SLSuK7EUdPz8f1z29Skq6F1fXg8+5UVR6bszncP4Tn4KUkkdJ8UFCY1zR1i8RmL/qQL3rlei4THG7OODlnKko4oI01kd3CaM08Ia18kC3GNoVaO9iDh+hWxSyTXFABXoau7Q6q9OxYg/OVEMw6jdbtSrJ9cBcewGmaZmg+bvkUnUUaGr+ZfnMH45Ivevl61hMcXsxYLFTu1hTm2zViCp7u0o5l+2PSUh9bDj6FgYypufBDhqK2+oXkiuHFHR3zfj+9PtA8oR0xnqX8qn+sx3bFODSbbF0X8EUvWQ8jBIcjo5bRmLOljDNtcqNtOe756h3l0VhKa9hDd2l1eqmsnh0MNMT/Cqnx6BInumhLT8luljzQ53RiJeA/0dxe5NK0o2fA1+GLXr6eNQWHNUOJssQaTRlGpLHKL9fD+IrQzTOMZS9fNQD4AnRNVxvTdjC+fJdcDDWQcyB00B0t9BDwTxXgaAfzDZ/DBXzRnfWMFRwuNqocOmX6OKNkY63h5n/fFcB28McVHqnXZVI27K0i4rDLNE9lDKV/rT+udVbD8dFFu2GGZ8mOt0kAXcoX3ZkIWVtw+MNf5NjR2FbivROHmhV1/pj2egv/fMGIOWTIWrV3Av8N9imV9IWml36H6cUjqEWNv9aNc+veb2sH46PRaHSuMBxvtW+twxctq0z+QsHhux8Q7rCY4Ct8lqsx7c6Sy0dl5T89rIeEuZKoVctIk1hNpfavER6yyH1Vvm3MbsUHy4ab4hWr/OZPcsRBphnaV65/ZcdYPNNwsjN/djlf9NqCw9U5ExCPcdhKxUgLSmfROpLp4WSUr8ojdwbncbvCf+a/YzRaEc6QOvXcGO256TXc5Lab9POvB+AWY7PigWYjzhifbovuunzRawsO24ZqQQAqguBtmpmPB7ysXJfyDDaV/aPGillgz1MdQg4u5MYaEtBNNHFjkRlSpd65lp4hd2AVPTfbV7FGpyIOfmNc/XVsPfg7vzaS/3nkvLL593ANLvMuRMGpQIhiF7kUEW9QDpAUbTWYBcbp4WpacHHY1aacqQyjGZS9HI3yCBT9kUZJhVOD+zUDvEH9ddR11fzPcTDQ5TlgB0KwqdXSavk9BC0pKp0WmcuowSw07VXmXC5guzSa4p0UvRw2lbDiYUx0ExJJRzWzi6Gm8cnEkfXXsdcG/M/jAJa0+bmCgdmQ9CYlNlSYZOKixmRsgiFxkrmW4l3KdFKv1DM8tk6WxPYJZhUUzcd8Kdtgrw/gkfXXDT7+avmfVak32qhtkg6NVdUS5wgkru1YzIkSduTW1FDwVWV3JQVJVuieTc0y4iDpFwc7/BvSalvKdQM8sv662cevz/+8sQVnjVAT0W2wLllw1JiMhJRxgDjCjLQsOzSFSgZqx7lAW1JW0e03yAD3asC+GD3NbQhbe+mN5GXH1F83KDOM4n/e5JIuH4NpdQARrFPBVptUNcjj4cVMcFSRTE2NpR1LEYbYMmfWpXgP9KejaPsLUhuvLCsVXznAG9dfx9SR1ud/3hZdCLHb1GMdPqRJgqDmm76mHbvOXDtiO2QPUcKo/TWkQ0i2JFXpBoo7vij1i1Lp3ADAo+qvG3V0rM//vFnnTE4hxd5Ka/Cor5YEdsLVJyKtDgVoHgtW11pWSjolPNMnrlrVj9Fv2Qn60twMwKPqr+N/wvr8z5tZcDsDrv06tkqyzESM85Ycv6XBWA2birlNCXrI6VbD2lx2L0vQO0QVTVVLH4SE67fgsfVXv8n7sz7/85Z7cMtbE6f088wSaR4kCkCm10s6pKbJhfqiUNGLq+0gLWC6eUAZFPnLjwqtKd8EwGvWX59t7iPW4X/eAN1svgRVSY990YZg06BD1ohLMtyFTI4pKTJsS9xREq9EOaPWiO2gpms7397x6nQJkbh+Fz2q/rqRROX6/M8bJrqlVW4l6JEptKeUFuMYUbtCQ7CIttpGc6MY93x1r1vgAnRXvY5cvwWPqb9uWQm+lP95QxdNMeWhOq1x0Db55C7GcUv2ZUuN6n8iKzsvOxibC//Yfs9Na8r2Rlz02vXXDT57FP/zJi66/EJSmsJKa8QxnoqW3VLQ+jZVUtJwJ8PNX1NQCwfNgdhhHD9on7PdRdrdGPF28rJr1F+3LBdeyv+8yYfLoMYet1vX4upNAjVvwOUWnlNXJXlkzk5Il6kqeoiL0C07qno+/CYBXq/+utlnsz7/Mzvy0tmI4zm4ag23PRN3t/CWryoUVJGm+5+K8RJ0V8Hc88/XHUX/HfiAq7t+BH+x6v8t438enWmdJwFA6ZINriLGKv/95f8lT9/FnyA1NMVEvQyaXuu+gz36f/DD73E4pwqpLcvm/o0Vle78n//+L/NPvoefp1pTJye6e4A/D082FERa5/opeH9zpvh13cNm19/4v/LDe5xMWTi8I0Ta0qKlK27AS/v3/r+/x/2GO9K2c7kVMonDpq7//jc5PKCxeNPpFVzaRr01wF8C4Pu76hXuX18H4LduTr79guuFD3n5BHfI+ZRFhY8w29TYhbbLi/bvBdqKE4fUgg1pBKnV3FEaCWOWyA+m3WpORZr/j+9TKJtW8yBTF2/ZEODI9/QavHkVdGFp/Pjn4Q+u5hXapsP5sOH+OXXA1LiKuqJxiMNbhTkbdJTCy4llEt6NnqRT4dhg1V3nbdrm6dYMecA1yTOL4PWTE9L5VzPFlLBCvlG58AhehnN4uHsAYinyJ+AZ/NkVvELbfOBUuOO5syBIEtiqHU1k9XeISX5bsimrkUUhnGDxourN8SgUsCZVtKyGbyGzHXdjOhsAvOAswSRyIBddRdEZWP6GZhNK/yjwew9ehBo+3jEADu7Ay2n8mDc+TS7awUHg0OMzR0LABhqLD4hJEh/BEGyBdGlSJoXYXtr+3HS4ijzVpgi0paWXtdruGTknXBz+11qT1Q2inxaTzQCO46P3lfLpyS4fou2PH/PupwZgCxNhGlj4IvUuWEsTkqMWm6i4xCSMc9N1RDQoCVcuGItJ/MRWefais+3synowi/dESgJjkilnWnBTGvRWmaw8oR15257t7CHmCf8HOn7cwI8+NQBXMBEmAa8PMRemrNCEhLGEhDQKcGZWS319BX9PFBEwGTbRBhLbDcaV3drFcDqk5kCTd2JF1Wp0HraqBx8U0wwBTnbpCadwBA/gTH/CDrcCs93LV8E0YlmmcyQRQnjBa8JESmGUfIjK/7fkaDJpmD2QptFNVJU1bbtIAjjWQizepOKptRjbzR9Kag6xZmMLLjHOtcLT3Tx9o/0EcTT1XN3E45u24AiwEypDJXihKjQxjLprEwcmRKclaDNZCVqr/V8mYWyFADbusiY5hvgFoU2vio49RgJLn5OsReRFN6tabeetiiy0V7KFHT3HyZLx491u95sn4K1QQSPKM9hNT0wMVvAWbzDSVdrKw4zRjZMyJIHkfq1VAVCDl/bUhNKlGq0zGr05+YAceXVPCttVk0oqjVwMPt+BBefx4yPtGVkUsqY3CHDPiCM5ngupUwCdbkpd8kbPrCWHhkmtIKLEetF2499eS1jZlIPGYnlcPXeM2KD9vLS0bW3ktYNqUllpKLn5ZrsxlIzxvDu5eHxzGLctkZLEY4PgSOg2IUVVcUONzUDBEpRaMoXNmUc0tFZrTZquiLyKxrSm3DvIW9Fil+AkhXu5PhEPx9mUNwqypDvZWdKlhIJQY7vn2OsnmBeOWnYZ0m1iwbbw1U60by5om47iHRV6fOgzjMf/DAZrlP40Z7syxpLK0lJ0gqaAK1c2KQKu7tabTXkLFz0sCftuwX++MyNeNn68k5Buq23YQhUh0SNTJa1ioQ0p4nUG2y0XilF1JqODqdImloPS4Bp111DEWT0jJjVv95uX9BBV7eB3bUWcu0acSVM23YZdd8R8UbQUxJ9wdu3oMuhdt929ME+mh6JXJ8di2RxbTi6TbrDquqV4aUKR2iwT6aZbyOwEXN3DUsWr8Hn4EhwNyHuXHh7/pdaUjtR7vnDh/d8c9xD/s5f501eQ1+CuDiCvGhk1AN/4Tf74RfxPwD3toLarR0zNtsnPzmS64KIRk861dMWCU8ArasG9T9H0ZBpsDGnjtAOM2+/LuIb2iIUGXNgl5ZmKD/Tw8TlaAuihaFP5yrw18v4x1898zIdP+DDAX1bM3GAMvPgRP/cJn3zCW013nrhHkrITyvYuwOUkcHuKlRSW5C6rzIdY4ppnF7J8aAJbQepgbJYBjCY9usGXDKQxq7RZfh9eg5d1UHMVATRaD/4BHK93/1iAgYZ/+jqPn8Dn4UExmWrpa3+ZOK6MvM3bjwfzxNWA2dhs8+51XHSPJiaAhGSpWevEs5xHLXcEGFXYiCONySH3fPWq93JIsBiSWvWyc3CAN+EcXoT7rCSANloPPoa31rt/5PUA/gp8Q/jDD3hyrjzlR8VkanfOvB1XPubt17vzxAfdSVbD1pzAnfgyF3ycadOTOTXhpEUoLC1HZyNGW3dtmjeXgr2r56JNmRwdNNWaQVBddd6rh4MhviEB9EFRD/7RGvePvCbwAL4Mx/D6M541hHO4D3e7g6PafdcZVw689z7NGTwo5om7A8sPhccT6qKcl9NJl9aM/9kX+e59Hh1yPqGuCCZxuITcsmNaJ5F7d0q6J3H48TO1/+M57085q2icdu2U+W36Ldllz9Agiv4YGljoEN908EzvDOrBF98/vtJwCC/BF2AG75xxEmjmMIcjxbjoaxqOK3/4hPOZzhMPBpYPG44CM0dTVm1LjLtUWWVz1Bcf8tEx0zs8O2A2YVHRxKYOiy/aOVoAaMu0i7ubu43njjmd4ibMHU1sIDHaQNKrZND/FZYdk54oCXetjq7E7IVl9eAL7t+oHnwXXtLx44czzoRFHBztYVwtH1d+NOMkupZ5MTM+gUmq90X+Bh9zjRlmaQ+m7YMqUL/veemcecAtOJ0yq1JnVlN27di2E0+Klp1tAJ4KRw1eMI7aJjsO3R8kPSI3fUFXnIOfdQe86sIIVtWDL7h//Ok6vj8vwDk08NEcI8zz7OhBy+WwalzZeZ4+0XniRfst9pAJqQHDGLzVQ2pheZnnv1OWhwO43/AgcvAEXEVVpa4db9sGvNK8wjaENHkfFQ4Ci5i7dqnQlPoLQrHXZDvO3BIXZbJOBrOaEbML6sFL798I4FhKihjHMsPjBUZYCMFr6nvaArxqXPn4lCa+cHfSa2cP27g3Z3ziYTRrcbQNGLQmGF3F3cBdzzzX7AILx0IB9rbwn9kx2G1FW3Inic+ZLIsVvKR8Zwfj0l1fkqo8LWY1M3IX14OX3r9RKTIO+d9XzAI8qRPGPn/4NC2n6o4rN8XJ82TOIvuVA8zLKUHRFgBCetlDZlqR1gLKjS39xoE7Bt8UvA6BxuEDjU3tFsEijgA+615tmZkXKqiEENrh41iLDDZNq4pKTWR3LZfnos81LOuNa15cD956vLMsJd1rqYp51gDUQqMYm2XsxnUhD2jg1DM7SeuJxxgrmpfISSXVIJIS5qJJSvJPEQ49DQTVIbYWJ9QWa/E2+c/oPK1drmC7WSfJRNKBO5Yjvcp7Gc3dmmI/Xh1kDTEuiSnWqQf37h+fTMhGnDf6dsS8SQfQWlqqwXXGlc/PEZ/SC5mtzIV0nAshlQdM/LvUtYutrEZ/Y+EAFtq1k28zQhOwLr1AIeANzhF8t9qzTdZf2qRKO6MWE9ohBYwibbOmrFtNmg3mcS+tB28xv2uKd/agYCvOP+GkSc+0lr7RXzyufL7QbkUpjLjEWFLqOIkAGu2B0tNlO9Eau2W1qcOUvVRgKzypKIQZ5KI3q0MLzqTNRYqiZOqmtqloIRlmkBHVpHmRYV6/HixbO6UC47KOFJnoMrVyr7wYz+SlW6GUaghYbY1I6kkxA2W1fSJokUdSh2LQ1GAimRGm0MT+uu57H5l7QgOWxERpO9moLRPgTtquWCfFlGlIjQaRly9odmzMOWY+IBO5tB4sW/0+VWGUh32qYk79EidWKrjWuiLpiVNGFWFRJVktyeXWmbgBBzVl8anPuXyNJlBJOlKLTgAbi/EYHVHxWiDaVR06GnHQNpJcWcK2jJtiCfG2sEHLzuI66sGrMK47nPIInPnu799935aOK2cvmvubrE38ZzZjrELCmXM2hM7UcpXD2oC3+ECVp7xtIuxptJ0jUr3sBmBS47TVxlvJ1Sqb/E0uLdvLj0lLr29ypdd/eMX3f6lrxGlKwKQxEGvw0qHbkbwrF3uHKwVENbIV2wZ13kNEF6zD+x24aLNMfDTCbDPnEikZFyTNttxWBXDaBuM8KtI2rmaMdUY7cXcUPstqTGvBGSrFWIpNMfbdea990bvAOC1YX0qbc6smDS1mPxSJoW4fwEXvjMmhlijDRq6qale6aJEuFGoppYDoBELQzLBuh/mZNx7jkinv0EtnUp50lO9hbNK57lZaMAWuWR5Yo9/kYwcYI0t4gWM47Umnl3YmpeBPqSyNp3K7s2DSAS/39KRuEN2bS4xvowV3dFRMx/VFcp2Yp8w2nTO9hCXtHG1kF1L4KlrJr2wKfyq77R7MKpFKzWlY9UkhYxyHWW6nBWPaudvEAl3CGcNpSXPZ6R9BbBtIl6cHL3gIBi+42CYXqCx1gfGWe7Ap0h3luyXdt1MKy4YUT9xSF01G16YEdWsouW9mgDHd3veyA97H+Ya47ZmEbqMY72oPztCGvK0onL44AvgC49saZKkWRz4veWljE1FHjbRJaWv6ZKKtl875h4CziFCZhG5rx7tefsl0aRT1bMHZjm8dwL/6u7wCRysaQblQoG5yAQN5zpatMNY/+yf8z+GLcH/Qn0iX2W2oEfXP4GvwQHuIL9AYGnaO3zqAX6946nkgqZNnUhx43DIdQtMFeOPrgy/y3Yd85HlJWwjLFkU3kFwq28xPnuPhMWeS+tDLV9Otllq7pQCf3uXJDN9wFDiUTgefHaiYbdfi3b3u8+iY6TnzhgehI1LTe8lcd7s1wJSzKbahCRxKKztTLXstGAiu3a6rPuQs5pk9TWAan5f0BZmGf7Ylxzzk/A7PAs4QPPPAHeFQ2hbFHszlgZuKZsJcUmbDC40sEU403cEjczstOEypa+YxevL4QBC8oRYqWdK6b7sK25tfE+oDZgtOQ2Jg8T41HGcBE6fTWHn4JtHcu9S7uYgU5KSCkl/mcnq+5/YBXOEr6lCUCwOTOM1taOI8mSxx1NsCXBEmLKbMAg5MkwbLmpBaFOPrNSlO2HnLiEqW3tHEwd8AeiQLmn+2gxjC3k6AxREqvKcJbTEzlpLiw4rNZK6oJdidbMMGX9FULKr0AkW+2qDEPBNNm5QAt2Ik2nftNWHetubosHLo2nG4vQA7GkcVCgVCgaDixHqo9UUn1A6OshapaNR/LPRYFV8siT1cCtJE0k/3WtaNSuUZYKPnsVIW0xXWnMUxq5+En4Kvw/MqQmVXnAXj9Z+9zM98zM/Agy7F/qqj2Nh67b8HjFnPP3iBn/tkpdzwEJX/whIcQUXOaikeliCRGUk7tiwF0rItwMEhjkZ309hikFoRAmLTpEXWuHS6y+am/KB/fM50aLEhGnSMwkpxzOov4H0AvgovwJ1iGzDLtJn/9BU+fAINfwUe6FHSLhu83viV/+/HrOePX+STT2B9uWGbrMHHLldRBlhS/CJQmcRxJFqZica01XixAZsYiH1uolZxLrR/SgxVIJjkpQP4PE9sE59LKLr7kltSBogS5tyszzH8Fvw8/AS8rNOg0xUS9fIaHwb+6et8Q/gyvKRjf5OusOzGx8evA/BP4IP11uN/grca5O0lcsPLJ5YjwI4QkJBOHa0WdMZYGxPbh2W2nR9v3WxEWqgp/G3+6VZbRLSAAZ3BhdhAaUL33VUSw9yjEsvbaQ9u4A/gGXwZXoEHOuU1GSj2chf+Mo+f8IcfcAxfIKVmyunRbYQVnoevwgfw3TXXcw++xNuP4fhyueEUNttEduRVaDttddoP0eSxLe2LENk6itYxlrxBNBYrNNKSQmeaLcm9c8UsaB5WyO6675yyQIAWSDpBVoA/gxmcwEvwoDv0m58UE7gHn+fJOa8/Ywan8EKRfjsopF83eCglX/Sfr7OeaRoQfvt1CGvIDccH5BCvw1sWIzRGC/66t0VTcLZQZtm6PlAasbOJ9iwWtUo7biktTSIPxnR24jxP1ZKaqq+2RcXM9OrBAm/AAs7hDJ5bNmGb+KIfwCs8a3jnjBrOFeMjHSCdbKr+2uOLfnOd9eiA8Hvvwwq54VbP2OqwkB48Ytc4YEOiH2vTXqodabfWEOzso4qxdbqD5L6tbtNPECqbhnA708DZH4QOJUXqScmUlks7Ot6FBuZw3n2mEbaUX7kDzxHOOQk8nKWMzAzu6ZZ8sOFw4RK+6PcuXo9tB4SbMz58ApfKDXf3szjNIIbGpD5TKTRxGkEMLjLl+K3wlWXBsCUxIDU+jbOiysESqAy1MGUJpXgwbTWzNOVEziIXZrJ+VIztl1PUBxTSo0dwn2bOmfDRPD3TRTGlfbCJvO9KvuhL1hMHhB9wPuPRLGHcdOWG2xc0U+5bQtAJT0nRTewXL1pgk2+rZAdeWmz3jxAqfNQQdzTlbF8uJ5ecEIWvTkevAHpwz7w78QujlD/Lr491bD8/1vhM2yrUQRrWXNQY4fGilfctMWYjL72UL/qS9eiA8EmN88nbNdour+PBbbAjOjIa4iBhfFg6rxeKdEGcL6p3EWR1Qq2Qkhs2DrnkRnmN9tG2EAqmgPw6hoL7Oza7B+3SCrR9tRftko+Lsf2F/mkTndN2LmzuMcKTuj/mX2+4Va3ki16+nnJY+S7MefpkidxwnV+4wkXH8TKnX0tsYzYp29DOOoSW1nf7nTh2akYiWmcJOuTidSaqESrTYpwjJJNVGQr+rLI7WsqerHW6Kp/oM2pKuV7T1QY9gjqlZp41/WfKpl56FV/0kvXQFRyeQ83xaTu5E8p5dNP3dUF34ihyI3GSpeCsywSh22ZJdWto9winhqifb7VRvgktxp13vyjrS0EjvrRfZ62uyqddSWaWYlwTPAtJZ2oZ3j/Sgi/mi+6vpzesfAcWNA0n8xVyw90GVFGuZjTXEQy+6GfLGLMLL523f5E0OmxVjDoOuRiH91RKU+vtoCtH7TgmvBLvtFXWLW15H9GTdVw8ow4IlRLeHECN9ym1e9K0I+Cbnhgv4Yu+aD2HaQJ80XDqOzSGAV4+4yCqBxrsJAX6ZTIoX36QnvzhhzzMfFW2dZVLOJfo0zbce5OvwXMFaZ81mOnlTVXpDZsQNuoYWveketKb5+6JOOsgX+NTm7H49fUTlx+WLuWL7qxnOFh4BxpmJx0p2gDzA/BUARuS6phR+pUsY7MMboAHx5xNsSVfVZcYSwqCKrqon7zM+8ecCkeS4nm3rINuaWvVNnMRI1IRpxTqx8PZUZ0Br/UEduo3B3hNvmgZfs9gQPj8vIOxd2kndir3awvJ6BLvoUuOfFWNYB0LR1OQJoUySKb9IlOBx74q1+ADC2G6rOdmFdJcD8BkfualA+BdjOOzP9uUhGUEX/TwhZsUduwRr8wNuXKurCixLBgpQI0mDbJr9dIqUuV+92ngkJZ7xduCk2yZKbfWrH1VBiTg9VdzsgRjW3CVXCvAwDd+c1z9dWw9+B+8MJL/eY15ZQ/HqvTwVdsZn5WQsgRRnMaWaecu3jFvMBEmgg+FJFZsnSl0zjB9OqPYaBD7qmoVyImFvzi41usesV0julaAR9dfR15Xzv9sEruRDyk1nb+QaLU67T885GTls6YgcY+UiMa25M/pwGrbCfzkvR3e0jjtuaFtnwuagHTSb5y7boBH119HXhvwP487jJLsLJ4XnUkHX5sLbS61dpiAXRoZSCrFJ+EjpeU3puVfitngYNo6PJrAigKktmwjyQdZpfq30mmtulaAx9Zfx15Xzv+cyeuiBFUs9zq8Kq+XB9a4PVvph3GV4E3y8HENJrN55H1X2p8VyqSKwVusJDKzXOZzplWdzBUFK9e+B4+uv468xvI/b5xtSAkBHQaPvtqWzllVvEOxPbuiE6+j2pvjcKsbvI7txnRErgfH7LdXqjq0IokKzga14GzQ23SSbCQvO6r+Or7SMIr/efOkkqSdMnj9mBx2DRsiY29Uj6+qK9ZrssCKaptR6HKURdwUYeUWA2kPzVKQO8ku2nU3Anhs/XWkBx3F/7wJtCTTTIKftthue1ty9xvNYLY/zo5KSbIuKbXpbEdSyeRyYdAIwKY2neyoc3+k1XUaufYga3T9daMUx/r8z1s10ITknIO0kuoMt+TB8jK0lpayqqjsJ2qtXAYwBU932zinimgmd6mTRDnQfr88q36NAI+tv24E8Pr8zxtasBqx0+xHH9HhlrwsxxNUfKOHQaZBITNf0uccj8GXiVmXAuPEAKSdN/4GLHhs/XWj92dN/uetNuBMnVR+XWDc25JLjo5Mg5IZIq226tmCsip2zZliL213YrTlL2hcFjpCduyim3M7/eB16q/blQsv5X/esDRbtJeabLIosWy3ycavwLhtxdWzbMmHiBTiVjJo6lCLjXZsi7p9PEPnsq6X6wd4bP11i0rD5fzPm/0A6brrIsllenZs0lCJlU4abakR59enZKrKe3BZihbTxlyZ2zl1+g0wvgmA166/bhwDrcn/7Ddz0eWZuJvfSESug6NzZsox3Z04FIxz0mUjMwVOOVTq1CQ0AhdbBGVdjG/CgsfUX7esJl3K/7ytWHRv683praW/8iDOCqWLLhpljDY1ZpzK75QiaZoOTpLKl60auHS/97oBXrv+umU9+FL+5+NtLFgjqVLCdbmj7pY5zPCPLOHNCwXGOcLquOhi8CmCWvbcuO73XmMUPab+ug3A6/A/78Bwe0bcS2+tgHn4J5pyS2WbOck0F51Vq3LcjhLvZ67p1ABbaL2H67bg78BfjKi/jr3+T/ABV3ilLmNXTI2SpvxWBtt6/Z//D0z/FXaGbSBgylzlsEGp+5//xrd4/ae4d8DUUjlslfIYS3t06HZpvfQtvv0N7AHWqtjP2pW08QD/FLy//da38vo8PNlKHf5y37Dxdfe/oj4kVIgFq3koLReSR76W/bx//n9k8jonZxzWTANVwEniDsg87sOSd/z7//PvMp3jQiptGVWFX2caezzAXwfgtzYUvbr0iozs32c3Uge7varH+CNE6cvEYmzbPZ9hMaYDdjK4V2iecf6EcEbdUDVUARda2KzO/JtCuDbNQB/iTeL0EG1JSO1jbXS+nLxtPMDPw1fh5+EPrgSEKE/8Gry5A73ui87AmxwdatyMEBCPNOCSKUeRZ2P6Myb5MRvgCHmA9ywsMifU+AYXcB6Xa5GibUC5TSyerxyh0j6QgLVpdyhfArRTTLqQjwe4HOD9s92D4Ap54odXAPBWLAwB02igG5Kkc+piN4lvODIFGAZgT+EO4Si1s7fjSR7vcQETUkRm9O+MXyo9OYhfe4xt9STQ2pcZRLayCV90b4D3jR0DYAfyxJ+eywg2IL7NTMXna7S/RpQ63JhWEM8U41ZyQGjwsVS0QBrEKLu8xwZsbi4wLcCT+OGidPIOCe1PiSc9Qt+go+vYqB7cG+B9d8cAD+WJPz0Am2gxXgU9IneOqDpAAXOsOltVuMzpdakJXrdPCzXiNVUpCeOos5cxnpQT39G+XVLhs1osQVvJKPZyNq8HDwd4d7pNDuWJPxVX7MSzqUDU6gfadKiNlUFTzLeFHHDlzO4kpa7aiKhBPGKwOqxsBAmYkOIpipyXcQSPlRTf+Tii0U3EJGaZsDER2qoB3h2hu0qe+NNwUooYU8y5mILbJe6OuX+2FTKy7bieTDAemaQyQ0CPthljSWO+xmFDIYiESjM5xKd6Ik5lvLq5GrQ3aCMLvmCA9wowLuWJb9xF59hVVP6O0CrBi3ZjZSNOvRy+I6klNVRJYRBaEzdN+imiUXQ8iVF8fsp+W4JXw7WISW7fDh7lptWkCwZ4d7QTXyBPfJMYK7SijjFppGnlIVJBJBYj7eUwtiP1IBXGI1XCsjNpbjENVpSAJ2hq2LTywEly3hUYazt31J8w2+aiLx3g3fohXixPfOMYm6zCGs9LVo9MoW3MCJE7R5u/WsOIjrqBoHUO0bJE9vxBpbhsd3+Nb4/vtPCZ4oZYCitNeYuC/8UDvDvy0qvkiW/cgqNqRyzqSZa/s0mqNGjtKOoTm14zZpUauiQgVfqtQiZjq7Q27JNaSK5ExRcrGCXO1FJYh6jR6CFqK7bZdQZ4t8g0rSlPfP1RdBtqaa9diqtzJkQ9duSryi2brQXbxDwbRUpFMBHjRj8+Nt7GDKgvph9okW7LX47gu0SpGnnFQ1S1lYldOsC7hYteR574ZuKs7Ei1lBsfdz7IZoxzzCVmmVqaSySzQbBVAWDek+N4jh9E/4VqZrJjPwiv9BC1XcvOWgO8275CVyBPvAtTVlDJfZkaZGU7NpqBogAj/xEHkeAuJihWYCxGN6e8+9JtSegFXF1TrhhLGP1fak3pebgPz192/8gB4d/6WT7+GdYnpH7hH/DJzzFiYPn/vjW0SgNpTNuPIZoAEZv8tlGw4+RLxy+ZjnKa5NdFoC7UaW0aduoYse6+bXg1DLg6UfRYwmhGEjqPvF75U558SANrElK/+MdpXvmqBpaXOa/MTZaa1DOcSiLaw9j0NNNst3c+63c7EKTpkvKHzu6bPbP0RkuHAVcbRY8ijP46MIbQeeT1mhA+5PV/inyDdQipf8LTvMXbwvoDy7IruDNVZKTfV4CTSRUYdybUCnGU7KUTDxLgCknqUm5aAW6/1p6eMsOYsphLzsHrE0Y/P5bQedx1F/4yPHnMB3/IOoTU9+BL8PhtjuFKBpZXnYNJxTuv+2XqolKR2UQgHhS5novuxVySJhBNRF3SoKK1XZbbXjVwWNyOjlqWJjrWJIy+P5bQedyldNScP+HZ61xKSK3jyrz+NiHG1hcOLL/+P+PDF2gOkekKGiNWKgJ+8Z/x8Iv4DdQHzcpZyF4v19I27w9/yPGDFQvmEpKtqv/TLiWMfn4sofMm9eAH8Ao0zzh7h4sJqYtxZd5/D7hkYPneDzl5idlzNHcIB0jVlQ+8ULzw/nc5/ojzl2juE0apD7LRnJxe04dMz2iOCFNtGFpTuXA5AhcTRo8mdN4kz30nVjEC4YTZQy4gpC7GlTlrePKhGsKKgeXpCYeO0MAd/GH7yKQUlXPLOasOH3FnSphjHuDvEu4gB8g66oNbtr6eMbFIA4fIBJkgayoXriw2XEDQPJrQeROAlY6aeYOcMf+IVYTU3XFlZufMHinGywaW3YLpObVBAsbjF4QJMsVUSayjk4voPsHJOQfPWDhCgDnmDl6XIRerD24HsGtw86RMHOLvVSHrKBdeVE26gKB5NKHzaIwLOmrqBWJYZDLhASG16c0Tn+CdRhWDgWXnqRZUTnPIHuMJTfLVpkoYy5CzylHVTGZMTwkGAo2HBlkQplrJX6U+uF1wZz2uwS1SQ12IqWaPuO4baZaEFBdukksJmkcTOm+YJSvoqPFzxFA/YUhIvWxcmSdPWTWwbAKVp6rxTtPFUZfKIwpzm4IoMfaYQLWgmlG5FME2gdBgm+J7J+rtS/XBbaVLsR7bpPQnpMFlo2doWaVceHk9+MkyguZNCJ1He+kuHTWyQAzNM5YSUg/GlTk9ZunAsg1qELVOhUSAK0LABIJHLKbqaEbHZLL1VA3VgqoiOKXYiS+HRyaEKgsfIqX64HYWbLRXy/qWoylIV9gudL1OWBNgBgTNmxA6b4txDT4gi3Ri7xFSLxtXpmmYnzAcWDZgY8d503LFogz5sbonDgkKcxGsWsE1OI+rcQtlgBBCSOKD1mtqYpIU8cTvBmAT0yZe+zUzeY92fYjTtGipXLhuR0ePoHk0ofNWBX+lo8Z7pAZDk8mEw5L7dVyZZoE/pTewbI6SNbiAL5xeygW4xPRuLCGbhcO4RIeTMFYHEJkYyEO9HmJfXMDEj/LaH781wHHZEtqSQ/69UnGpzH7LKIAZEDSPJnTesJTUa+rwTepI9dLJEawYV+ZkRn9g+QirD8vF8Mq0jFQ29js6kCS3E1+jZIhgPNanHdHFqFvPJLHqFwQqbIA4jhDxcNsOCCQLDomaL/dr5lyJaJU6FxPFjO3JOh3kVMcROo8u+C+jo05GjMF3P3/FuDLn5x2M04xXULPwaS6hBYki+MrMdZJSgPHlcB7nCR5bJ9Kr5ACUn9jk5kivdd8tk95SOGrtqu9lr2IhK65ZtEl7ZKrp7DrqwZfRUSN1el7+7NJxZbywOC8neNKTch5vsTEMNsoCCqHBCqIPRjIPkm0BjvFODGtto99rCl+d3wmHkW0FPdpZtC7MMcVtGFQjJLX5bdQ2+x9ypdc313uj8xlsrfuLgWXz1cRhZvJYX0iNVBRcVcmCXZs6aEf3RQF2WI/TcCbKmGU3IOoDJGDdDub0+hYckt6PlGu2BcxmhbTdj/klhccLGJMcqRjMJP1jW2ETqLSWJ/29MAoORluJ+6LPffBZbi5gqi5h6catQpmOT7/OFf5UorRpLzCqcMltBLhwd1are3kztrSzXO0LUbXRQcdLh/RdSZ+swRm819REDrtqzC4es6Gw4JCKlSnjYVpo0xeq33PrADbFLL3RuCmObVmPN+24kfa+AojDuM4umKe2QwCf6EN906HwjujaitDs5o0s1y+k3lgbT2W2i7FJdnwbLXhJUBq/9liTctSmFC/0OqUinb0QddTWamtjbHRFuWJJ6NpqZ8vO3fZJ37Db+2GkaPYLGHs7XTTdiFQJ68SkVJFVmY6McR5UycflNCsccHFaV9FNbR4NttLxw4pQ7wJd066Z0ohVbzihaxHVExd/ay04oxUKWt+AsdiQ9OUyZ2krzN19IZIwafSTFgIBnMV73ADj7V/K8u1MaY2sJp2HWm0f41tqwajEvdHWOJs510MaAqN4aoSiPCXtN2KSi46dUxHdaMquar82O1x5jqhDGvqmoE9LfxcY3zqA7/x3HA67r9ZG4O6Cuxu12/+TP+eLP+I+HErqDDCDVmBDO4larujNe7x8om2rMug0MX0rL1+IWwdwfR+p1TNTyNmVJ85ljWzbWuGv8/C7HD/izjkHNZNYlhZcUOKVzKFUxsxxN/kax+8zPWPSFKw80rJr9Tizyj3o1gEsdwgWGoxPezDdZ1TSENE1dLdNvuKL+I84nxKesZgxXVA1VA1OcL49dFlpFV5yJMhzyCmNQ+a4BqusPJ2bB+xo8V9u3x48VVIEPS/mc3DvAbXyoYr6VgDfh5do5hhHOCXMqBZUPhWYbWZECwVJljLgMUWOCB4MUuMaxGNUQDVI50TQ+S3kFgIcu2qKkNSHVoM0SHsgoZxP2d5HH8B9woOk4x5bPkKtAHucZsdykjxuIpbUrSILgrT8G7G5oCW+K0990o7E3T6AdW4TilH5kDjds+H64kS0mz24grtwlzDHBJqI8YJQExotPvoC4JBq0lEjjQkyBZ8oH2LnRsQ4Hu1QsgDTJbO8fQDnllitkxuVskoiKbRF9VwzMDvxHAdwB7mD9yCplhHFEyUWHx3WtwCbSMMTCUCcEmSGlg4gTXkHpZXWQ7kpznK3EmCHiXInqndkQjunG5kxTKEeGye7jWz9cyMR2mGiFQ15ENRBTbCp+Gh86vAyASdgmJq2MC6hoADQ3GosP0QHbnMHjyBQvQqfhy/BUbeHd5WY/G/9LK/8Ka8Jd7UFeNWEZvzPb458Dn8DGLOe3/wGL/4xP+HXlRt+M1PE2iLhR8t+lfgxsuh7AfO2AOf+owWhSZRYQbd622hbpKWKuU+XuvNzP0OseRDa+mObgDHJUSc/pKx31QdKffQ5OIJpt8GWjlgTwMc/w5MPCR/yl1XC2a2Yut54SvOtMev55Of45BOat9aWG27p2ZVORRvnEk1hqWMVUmqa7S2YtvlIpspuF1pt0syuZS2NV14mUidCSfzQzg+KqvIYCMljIx2YK2AO34fX4GWdu5xcIAb8MzTw+j/lyWM+Dw/gjs4GD6ehNgA48kX/AI7XXM/XAN4WHr+9ntywqoCakCqmKP0rmQrJJEErG2Upg1JObr01lKQy4jskWalKYfJ/EDLMpjNSHFEUAde2fltaDgmrNaWQ9+AAb8I5vKjz3L1n1LriB/BXkG/wwR9y/oRX4LlioHA4LzP2inzRx/DWmutRweFjeP3tNeSGlaE1Fde0OS11yOpmbIp2u/jF1n2RRZviJM0yBT3IZl2HWImKjQOxIyeU325b/qWyU9Moj1o07tS0G7qJDoGHg5m8yeCxMoEH8GU45tnrNM84D2l297DQ9t1YP7jki/7RmutRweEA77/HWXOh3HCxkRgldDQkAjNTMl2Iloc1qN5JfJeeTlyTRzxURTdn1Ixv2uKjs12AbdEWlBtmVdk2k7FFwj07PCZ9XAwW3dG+8xKzNFr4EnwBZpy9Qzhh3jDXebBpYcpuo4fQ44u+fD1dweEnHzI7v0xuuOALRUV8rXpFyfSTQYkhd7IHm07jpyhlkCmI0ALYqPTpUxXS+z4jgDj1Pflvmz5ecuItpIBxyTHpSTGWd9g1ApfD/bvwUhL4nT1EzqgX7cxfCcNmb3mPL/qi9SwTHJ49oj5ZLjccbTG3pRmlYi6JCG0mQrAt1+i2UXTZ2dv9IlQpN5naMYtviaXlTrFpoMsl3bOAFEa8sqPj2WCMrx3Yjx99qFwO59Aw/wgx+HlqNz8oZvA3exRDvuhL1jMQHPaOJ0+XyA3fp1OfM3qObEVdhxjvynxNMXQV4+GJyvOEFqeQBaIbbO7i63rpxCltdZShPFxkjM2FPVkn3TG+Rp9pO3l2RzFegGfxGDHIAh8SteR0C4HopXzRF61nheDw6TFN05Ebvq8M3VKKpGjjO6r7nhudTEGMtYM92HTDaR1FDMXJ1eThsbKfywyoWwrzRSXkc51flG3vIid62h29bIcFbTGhfV+faaB+ohj7dPN0C2e2lC96+XouFByen9AsunLDJZ9z7NExiUc0OuoYW6UZkIyx2YUR2z6/TiRjyKMx5GbbjLHvHuf7YmtKghf34LJfx63Yg8vrvN2zC7lY0x0tvKezo4HmGYDU+Gab6dFL+KI761lDcNifcjLrrr9LWZJctG1FfU1uwhoQE22ObjdfkSzY63CbU5hzs21WeTddH2BaL11Gi7lVdlxP1nkxqhnKhVY6knS3EPgVGg1JpN5cP/hivujOelhXcPj8HC/LyI6MkteVjlolBdMmF3a3DbsuAYhL44dxzthWSN065xxUd55Lmf0wRbOYOqH09/o9WbO2VtFdaMb4qBgtFJoT1SqoN8wPXMoXLb3p1PUEhxfnnLzGzBI0Ku7FxrKsNJj/8bn/H8fPIVOd3rfrklUB/DOeO+nkghgSPzrlPxluCMtOnDL4Yml6dK1r3vsgMxgtPOrMFUZbEUbTdIzii5beq72G4PD0DKnwjmBULUVFmy8t+k7fZ3pKc0Q4UC6jpVRqS9Umv8bxw35flZVOU1X7qkjnhZlsMbk24qQ6Hz7QcuL6sDC0iHHki96Uh2UdvmgZnjIvExy2TeJdMDZNSbdZyAHe/Yd1xsQhHiKzjh7GxQ4yqMPaywPkjMamvqrYpmO7Knad+ZQC5msCuAPWUoxrxVhrGv7a+KLXFhyONdTMrZ7ke23qiO40ZJUyzgYyX5XyL0mV7NiUzEs9mjtbMN0dERqwyAJpigad0B3/zRV7s4PIfXSu6YV/MK7+OrYe/JvfGMn/PHJe2fyUdtnFrKRNpXV0Y2559aWPt/G4BlvjTMtXlVIWCnNyA3YQBDmYIodFz41PvXPSa6rq9lWZawZ4dP115HXV/M/tnFkkrBOdzg6aP4pID+MZnTJ1SuuB6iZlyiox4HT2y3YBtkUKWooacBQUDTpjwaDt5poBHl1/HXltwP887lKKXxNUEyPqpGTyA699UqY/lt9yGdlUKra0fFWS+36iylVWrAyd7Uw0CZM0z7xKTOduznLIjG2Hx8cDPLb+OvK6Bv7n1DYci4CxUuRxrjBc0bb4vD3rN5Zz36ntLb83eVJIB8LiIzCmn6SMPjlX+yNlTjvIGjs+QzHPf60Aj62/jrzG8j9vYMFtm1VoRWCJdmw7z9N0t+c8cxZpPeK4aTRicS25QhrVtUp7U578chk4q04Wx4YoQSjFryUlpcQ1AbxZ/XVMknIU//OGl7Q6z9Zpxi0+3yFhSkjUDpnCIUhLWVX23KQ+L9vKvFKI0ZWFQgkDLvBoylrHNVmaw10zwCPrr5tlodfnf94EWnQ0lFRWy8pW9LbkLsyUVDc2NSTHGDtnD1uMtchjbCeb1mpxFP0YbcClhzdLu6lfO8Bj6q+bdT2sz/+8SZCV7VIxtt0DUn9L7r4cLYWDSXnseEpOGFuty0qbOVlS7NNzs5FOGJUqQpl2Q64/yBpZf90sxbE+//PGdZ02HSipCbmD6NItmQ4Lk5XUrGpDMkhbMm2ZVheNYV+VbUWTcv99+2NyX1VoafSuC+AN6q9bFIMv5X/eagNWXZxEa9JjlMwNWb00akGUkSoepp1/yRuuqHGbUn3UdBSTxBU6SEVklzWRUkPndVvw2PrrpjvxOvzPmwHc0hpmq82npi7GRro8dXp0KXnUQmhZbRL7NEVp1uuZmO45vuzKsHrktS3GLWXODVjw+vXXLYx4Hf7njRPd0i3aoAGX6W29GnaV5YdyDj9TFkakje7GHYzDoObfddHtOSpoi2SmzJHrB3hM/XUDDEbxP2/oosszcRlehWXUvzHv4TpBVktHqwenFo8uLVmy4DKLa5d3RtLrmrM3aMFr1183E4sewf+85VWeg1c5ag276NZrM9IJVNcmLEvDNaV62aq+14IAOGFsBt973Ra8Xv11YzXwNfmft7Jg2oS+XOyoC8/cwzi66Dhmgk38kUmP1CUiYWOX1bpD2zWXt2FCp7uq8703APAa9dfNdscR/M/bZLIyouVxqJfeWvG9Je+JVckHQ9+CI9NWxz+blX/KYYvO5n2tAP/vrlZ7+8/h9y+9qeB/Hnt967e5mevX10rALDWK//FaAT5MXdBXdP0C/BAes792c40H+AiAp1e1oH8HgH94g/Lttx1gp63op1eyoM/Bvw5/G/7xFbqJPcCXnmBiwDPb/YKO4FX4OjyCb289db2/Noqicw4i7N6TVtoz8tNwDH+8x/i6Ae7lmaQVENzJFb3Di/BFeAwz+Is9SjeQySpPqbLFlNmyz47z5a/AF+AYFvDmHqibSXTEzoT4Gc3OALaqAP4KPFUJ6n+1x+rGAM6Zd78bgJ0a8QN4GU614vxwD9e1Amy6CcskNrczLx1JIp6HE5UZD/DBHrFr2oNlgG4Odv226BodoryjGJ9q2T/AR3vQrsOCS0ctXZi3ruLlhpFDJYl4HmYtjQCP9rhdn4suySLKDt6wLcC52h8xPlcjju1fn+yhuw4LZsAGUuo2b4Fx2UwQu77uqRHXGtg92aN3tQCbFexc0uk93vhTXbct6y7MulLycoUljx8ngDMBg1tvJjAazpEmOtxlzclvj1vQf1Tx7QlPDpGpqgtdSKz/d9/hdy1vTfFHSmC9dGDZbLiezz7Ac801HirGZsWjydfZyPvHXL/Y8Mjzg8BxTZiuwKz4Eb8sBE9zznszmjvFwHKPIWUnwhqfVRcd4Ck0K6ate48m1oOfrX3/yOtvAsJ8zsPAM89sjnddmuLuDPjX9Bu/L7x7xpMzFk6nWtyQfPg278Gn4Aekz2ZgOmU9eJ37R14vwE/BL8G3aibCiWMWWDQ0ZtkPMnlcGeAu/Ag+8ZyecU5BPuy2ILD+sQqyZhAKmn7XZd+jIMTN9eBL7x95xVLSX4On8EcNlXDqmBlqS13jG4LpmGbkF/0CnOi3H8ETOIXzmnmtb0a16Tzxj1sUvQCBiXZGDtmB3KAefPH94xcUa/6vwRn80GOFyjEXFpba4A1e8KQfFF+259tx5XS4egYn8fQsLGrqGrHbztr+uByTahWuL1NUGbDpsnrwBfePPwHHIf9X4RnM4Z2ABWdxUBlqQ2PwhuDxoS0vvqB1JzS0P4h2nA/QgTrsJFn+Y3AOjs9JFC07CGWX1oNX3T/yHOzgDjwPn1PM3g9Jk9lZrMEpxnlPmBbjyo2+KFXRU52TJM/2ALcY57RUzjObbjqxVw++4P6RAOf58pcVsw9Daje3htriYrpDOonre3CudSe6bfkTEgHBHuDiyu5MCsc7BHhYDx7ePxLjqigXZsw+ijMHFhuwBmtoTPtOxOrTvYJDnC75dnUbhfwu/ZW9AgYd+peL68HD+0emKquiXHhWjJg/UrkJYzuiaL3E9aI/ytrCvAd4GcYZMCkSQxfUg3v3j8c4e90j5ZTPdvmJJGHnOCI2nHS8081X013pHuBlV1gB2MX1YNmWLHqqGN/TWmG0y6clJWthxNUl48q38Bi8vtMKyzzpFdSDhxZ5WBA5ZLt8Jv3895DduBlgbPYAj8C4B8hO68FDkoh5lydC4FiWvBOVqjYdqjiLv92t8yPDjrDaiHdUD15qkSURSGmXJwOMSxWAXYwr3zaAufJ66l+94vv3AO+vPcD7aw/w/toDvL/2AO+vPcD7aw/wHuD9tQd4f+0B3l97gPfXHuD9tQd4f+0B3l97gG8LwP8G/AL8O/A5OCq0Ys2KIdv/qOIXG/4mvFAMF16gZD+2Xvu/B8as5+8bfllWyg0zaNO5bfXj6vfhhwD86/Aq3NfRS9t9WPnhfnvCIw/CT8GLcFTMnpntdF/z9V+PWc/vWoIH+FL3Znv57PitcdGP4R/C34avw5fgRVUInCwbsn1yyA8C8zm/BH8NXoXnVE6wVPjdeCI38kX/3+Ct9dbz1pTmHFRu+Hm4O9Ch3clr99negxfwj+ER/DR8EV6B5+DuQOnTgUw5rnkY+FbNU3gNXh0o/JYTuWOvyBf9FvzX663HH/HejO8LwAl8Hl5YLTd8q7sqA3wbjuExfAFegQdwfyDoSkWY8swzEf6o4Qyewefg+cHNbqMQruSL/u/WWc+E5g7vnnEXgDmcDeSGb/F4cBcCgT+GGRzDU3hZYburAt9TEtHgbM6JoxJ+6NMzzTcf6c2bycv2+KK/f+l6LBzw5IwfqZJhA3M472pWT/ajKxnjv4AFnMEpnBTPND6s2J7qHbPAqcMK74T2mZ4VGB9uJA465It+/eL1WKhYOD7xHOkr1ajK7d0C4+ke4Hy9qXZwpgLr+Znm/uNFw8xQOSy8H9IzjUrd9+BIfenYaylf9FsXr8fBAadnPIEDna8IBcwlxnuA0/Wv6GAWPd7dDIKjMdSWueAsBj4M7TOd06qBbwDwKr7oleuxMOEcTuEZTHWvDYUO7aHqAe0Bbq+HEFRzOz7WVoTDQkVds7A4sIIxfCQdCefFRoIOF/NFL1mPab/nvOakSL/Q1aFtNpUb/nFOVX6gzyg/1nISyDfUhsokIzaBR9Kxm80s5mK+6P56il1jXic7nhQxsxSm3OwBHl4fFdLqi64nDQZvqE2at7cWAp/IVvrN6/BFL1mPhYrGMBfOi4PyjuSGf6wBBh7p/FZTghCNWGgMzlBbrNJoPJX2mW5mwZfyRffXo7OFi5pZcS4qZUrlViptrXtw+GQoyhDPS+ANjcGBNRiLCQDPZPMHuiZfdFpPSTcQwwKYdRNqpkjm7AFeeT0pJzALgo7g8YYGrMHS0iocy+YTm2vyRUvvpXCIpQ5pe666TJrcygnScUf/p0NDs/iAI/nqDHC8TmQT8x3NF91l76oDdQGwu61Z6E0ABv7uO1dbf/37Zlv+Zw/Pbh8f1s4Avur6657/+YYBvur6657/+YYBvur6657/+YYBvur6657/+aYBvuL6657/+VMA8FXWX/f8zzcN8BXXX/f8zzcNMFdbf93zP38KLPiK6697/uebtuArrr/u+Z9vGmCusP6653/+1FjwVdZf9/zPN7oHX339dc//fNMu+irrr3v+50+Bi+Zq6697/uebA/jz8Pudf9ht/fWv517J/XUzAP8C/BAeX9WCDrUpZ3/dEMBxgPcfbtTVvsYV5Yn32u03B3Ac4P3b8I+vxNBKeeL9dRMAlwO83959qGO78sT769oB7g3w/vGVYFzKE++v6wV4OMD7F7tckFkmT7y/rhHgpQO8b+4Y46XyxPvrugBeNcB7BRiX8sT767oAvmCA9woAHsoT76+rBJjLBnh3txOvkifeX1dswZcO8G6N7sXyxPvr6i340gHe3TnqVfLE++uKAb50gHcXLnrX8sR7gNdPRqwzwLu7Y/FO5Yn3AK9jXCMGeHdgxDuVJ75VAI8ljP7PAb3/RfjcZfePHBB+79dpfpH1CanN30d+mT1h9GqAxxJGM5LQeeQ1+Tb+EQJrElLb38VHQ94TRq900aMIo8cSOo+8Dp8QfsB8zpqE1NO3OI9Zrj1h9EV78PqE0WMJnUdeU6E+Jjyk/hbrEFIfeWbvId8H9oTRFwdZaxJGvziW0Hn0gqYB/wyZ0PwRlxJST+BOw9m77Amj14ii1yGM/txYQudN0qDzGe4EqfA/5GJCagsHcPaEPWH0esekSwmjRxM6b5JEcZ4ww50ilvAOFxBSx4yLW+A/YU8YvfY5+ALC6NGEzhtmyZoFZoarwBLeZxUhtY4rc3bKnjB6TKJjFUHzJoTOozF2YBpsjcyxDgzhQ1YRUse8+J4wenwmaylB82hC5w0zoRXUNXaRBmSMQUqiWSWkLsaVqc/ZE0aPTFUuJWgeTei8SfLZQeMxNaZSIzbII4aE1Nmr13P2hNHjc9E9guYNCZ032YlNwESMLcZiLQHkE4aE1BFg0yAR4z1h9AiAGRA0jyZ03tyIxWMajMPWBIsxYJCnlITU5ShiHYdZ94TR4wCmSxg9jtB5KyPGYzymAYexWEMwAPIsAdYdV6aObmNPGD0aYLoEzaMJnTc0Ygs+YDw0GAtqxBjkuP38bMRWCHn73xNGjz75P73WenCEJnhwyVe3AEe8TtKdJcYhBl97wuhNAObK66lvD/9J9NS75v17wuitAN5fe4D31x7g/bUHeH/tAd5fe4D3AO+vPcD7aw/w/toDvL/2AO+vPcD7aw/w/toDvAd4f/24ABzZ8o+KLsSLS+Pv/TqTb3P4hKlQrTGh+fbIBT0Axqznnb+L/V2mb3HkN5Mb/nEHeK7d4IcDld6lmDW/iH9E+AH1MdOw/Jlu2T1xNmY98sv4wHnD7D3uNHu54WUuOsBTbQuvBsPT/UfzNxGYzwkP8c+Yz3C+r/i6DcyRL/rZ+utRwWH5PmfvcvYEt9jLDS/bg0/B64DWKrQM8AL8FPwS9beQCe6EMKNZYJol37jBMy35otdaz0Bw2H/C2Smc7+WGB0HWDELBmOByA3r5QONo4V+DpzR/hFS4U8wMW1PXNB4TOqYz9urxRV++ntWCw/U59Ty9ebdWbrgfRS9AYKKN63ZokZVygr8GZ/gfIhZXIXPsAlNjPOLBby5c1eOLvmQ9lwkOy5x6QV1j5TYqpS05JtUgUHUp5toHGsVfn4NX4RnMCe+AxTpwmApTYxqMxwfCeJGjpXzRF61nbcHhUBPqWze9svwcHJ+S6NPscKrEjug78Dx8Lj3T8D4YxGIdxmJcwhi34fzZUr7olevZCw5vkOhoClq5zBPZAnygD/Tl9EzDh6kl3VhsHYcDEb+hCtJSvuiV69kLDm+WycrOTArHmB5/VYyP6jOVjwgGawk2zQOaTcc1L+aLXrKeveDwZqlKrw8U9Y1p66uK8dEzdYwBeUQAY7DbyYNezBfdWQ97weEtAKYQg2xJIkuveAT3dYeLGH+ShrWNwZgN0b2YL7qznr3g8JYAo5bQBziPjx7BPZ0d9RCQp4UZbnFdzBddor4XHN4KYMrB2qHFRIzzcLAHQZ5the5ovui94PCWAPefaYnxIdzRwdHCbuR4B+tbiy96Lzi8E4D7z7S0mEPd+eqO3cT53Z0Y8SV80XvB4Z0ADJi/f7X113f+7p7/+UYBvur6657/+YYBvur6657/+aYBvuL6657/+aYBvuL6657/+aYBvuL6657/+aYBvuL6657/+VMA8FXWX/f8z58OgK+y/rrnf75RgLna+uue//lTA/CV1V/3/M837aKvvv6653++UQvmauuve/7nTwfAV1N/3fM/fzr24Cuuv+75nz8FFnxl9dc9//MOr/8/glixwRuUfM4AAAAASUVORK5CYII=';
	},

	getSearchTexture: function () {
		return 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAAAhCAAAAABIXyLAAAAAOElEQVRIx2NgGAWjYBSMglEwEICREYRgFBZBqDCSLA2MGPUIVQETE9iNUAqLR5gIeoQKRgwXjwAAGn4AtaFeYLEAAAAASUVORK5CYII=';
	}

} );

/**
*
* Supersample Anti-Aliasing Render Pass
*
* @author bhouston / http://clara.io/
*
* This manual approach to SSAA re-renders the scene ones for each sample with camera jitter and accumulates the results.
*
* References: https://en.wikipedia.org/wiki/Supersampling
*
*/

THREE.SSAARenderPass = function ( scene, camera, clearColor, clearAlpha ) {

	THREE.Pass.call( this );

	this.scene = scene;
	this.camera = camera;

	this.sampleLevel = 4; // specified as n, where the number of samples is 2^n, so sampleLevel = 4, is 2^4 samples, 16.
	this.unbiased = true;

	// as we need to clear the buffer in this pass, clearColor must be set to something, defaults to black.
	this.clearColor = ( clearColor !== undefined ) ? clearColor : 0x000000;
	this.clearAlpha = ( clearAlpha !== undefined ) ? clearAlpha : 0;

	if ( THREE.CopyShader === undefined ) console.error( "THREE.SSAARenderPass relies on THREE.CopyShader" );

	var copyShader = THREE.CopyShader;
	this.copyUniforms = THREE.UniformsUtils.clone( copyShader.uniforms );

	this.copyMaterial = new THREE.ShaderMaterial(	{
		uniforms: this.copyUniforms,
		vertexShader: copyShader.vertexShader,
		fragmentShader: copyShader.fragmentShader,
		premultipliedAlpha: true,
		transparent: true,
		blending: THREE.AdditiveBlending,
		depthTest: false,
		depthWrite: false
	} );

	this.camera2 = new THREE.OrthographicCamera( - 1, 1, 1, - 1, 0, 1 );
	this.scene2	= new THREE.Scene();
	this.quad2 = new THREE.Mesh( new THREE.PlaneGeometry( 2, 2 ), this.copyMaterial );
	this.scene2.add( this.quad2 );

};

THREE.SSAARenderPass.prototype = Object.assign( Object.create( THREE.Pass.prototype ), {

	constructor: THREE.SSAARenderPass,

	dispose: function() {

		if ( this.sampleRenderTarget ) {

			this.sampleRenderTarget.dispose();
			this.sampleRenderTarget = null;

		}

	},

	setSize: function ( width, height ) {

		if ( this.sampleRenderTarget )	this.sampleRenderTarget.setSize( width, height );

	},

	render: function ( renderer, writeBuffer, readBuffer, delta, maskActive ) {

		if ( ! this.sampleRenderTarget ) {

			this.sampleRenderTarget = new THREE.WebGLRenderTarget( readBuffer.width, readBuffer.height,
				{ minFilter: THREE.LinearFilter, magFilter: THREE.LinearFilter, format: THREE.RGBAFormat } );

		}

		var jitterOffsets = THREE.SSAARenderPass.JitterVectors[ Math.max( 0, Math.min( this.sampleLevel, 5 ) ) ];

		var autoClear = renderer.autoClear;
		renderer.autoClear = false;

		var oldClearColor = renderer.getClearColor().getHex();
		var oldClearAlpha = renderer.getClearAlpha();

		var baseSampleWeight = 1.0 / jitterOffsets.length;
		var roundingRange = 1 / 32;
		this.copyUniforms[ "tDiffuse" ].value = this.sampleRenderTarget.texture;

		var width = readBuffer.width, height = readBuffer.height;

		// render the scene multiple times, each slightly jitter offset from the last and accumulate the results.
		for ( var i = 0; i < jitterOffsets.length; i ++ ) {

			var jitterOffset = jitterOffsets[i];
			if ( this.camera.setViewOffset ) {
				this.camera.setViewOffset( width, height,
					jitterOffset[ 0 ] * 0.0625, jitterOffset[ 1 ] * 0.0625,   // 0.0625 = 1 / 16
					width, height );
			}

			var sampleWeight = baseSampleWeight;
			if( this.unbiased ) {
				// the theory is that equal weights for each sample lead to an accumulation of rounding errors.
				// The following equation varies the sampleWeight per sample so that it is uniformly distributed
				// across a range of values whose rounding errors cancel each other out.
				var uniformCenteredDistribution = ( -0.5 + ( i + 0.5 ) / jitterOffsets.length );
				sampleWeight += roundingRange * uniformCenteredDistribution;
			}

			this.copyUniforms[ "opacity" ].value = sampleWeight;
			renderer.setClearColor( this.clearColor, this.clearAlpha );
			renderer.render( this.scene, this.camera, this.sampleRenderTarget, true );
			if (i === 0) {
				renderer.setClearColor( 0x000000, 0.0 );
			}
			renderer.render( this.scene2, this.camera2, this.renderToScreen ? null : writeBuffer, (i === 0) );

		}

		if ( this.camera.clearViewOffset ) this.camera.clearViewOffset();

		renderer.autoClear = autoClear;
		renderer.setClearColor( oldClearColor, oldClearAlpha );

	}

} );


// These jitter vectors are specified in integers because it is easier.
// I am assuming a [-8,8) integer grid, but it needs to be mapped onto [-0.5,0.5)
// before being used, thus these integers need to be scaled by 1/16.
//
// Sample patterns reference: https://msdn.microsoft.com/en-us/library/windows/desktop/ff476218%28v=vs.85%29.aspx?f=255&MSPPError=-2147217396
THREE.SSAARenderPass.JitterVectors = [
	[
		[ 0, 0 ]
	],
	[
		[ 4, 4 ], [ - 4, - 4 ]
	],
	[
		[ - 2, - 6 ], [ 6, - 2 ], [ - 6, 2 ], [ 2, 6 ]
	],
	[
		[ 1, - 3 ], [ - 1, 3 ], [ 5, 1 ], [ - 3, - 5 ],
		[ - 5, 5 ], [ - 7, - 1 ], [ 3, 7 ], [ 7, - 7 ]
	],
	[
		[ 1, 1 ], [ - 1, - 3 ], [ - 3, 2 ], [ 4, - 1 ],
		[ - 5, - 2 ], [ 2, 5 ], [ 5, 3 ], [ 3, - 5 ],
		[ - 2, 6 ], [ 0, - 7 ], [ - 4, - 6 ], [ - 6, 4 ],
		[ - 8, 0 ], [ 7, - 4 ], [ 6, 7 ], [ - 7, - 8 ]
	],
	[
		[ - 4, - 7 ], [ - 7, - 5 ], [ - 3, - 5 ], [ - 5, - 4 ],
		[ - 1, - 4 ], [ - 2, - 2 ], [ - 6, - 1 ], [ - 4, 0 ],
		[ - 7, 1 ], [ - 1, 2 ], [ - 6, 3 ], [ - 3, 3 ],
		[ - 7, 6 ], [ - 3, 6 ], [ - 5, 7 ], [ - 1, 7 ],
		[ 5, - 7 ], [ 1, - 6 ], [ 6, - 5 ], [ 4, - 4 ],
		[ 2, - 3 ], [ 7, - 2 ], [ 1, - 1 ], [ 4, - 1 ],
		[ 2, 1 ], [ 6, 2 ], [ 0, 4 ], [ 4, 4 ],
		[ 2, 5 ], [ 7, 5 ], [ 5, 6 ], [ 3, 7 ]
	]
];

/**
 * @author alteredq / http://alteredqualia.com/
 */

THREE.SavePass = function ( renderTarget ) {

	THREE.Pass.call( this );

	if ( THREE.CopyShader === undefined )
		console.error( "THREE.SavePass relies on THREE.CopyShader" );

	var shader = THREE.CopyShader;

	this.textureID = "tDiffuse";

	this.uniforms = THREE.UniformsUtils.clone( shader.uniforms );

	this.material = new THREE.ShaderMaterial( {

		uniforms: this.uniforms,
		vertexShader: shader.vertexShader,
		fragmentShader: shader.fragmentShader

	} );

	this.renderTarget = renderTarget;

	if ( this.renderTarget === undefined ) {

		this.renderTargetParameters = { minFilter: THREE.LinearFilter, magFilter: THREE.LinearFilter, format: THREE.RGBFormat, stencilBuffer: false };
		this.renderTarget = new THREE.WebGLRenderTarget( window.innerWidth, window.innerHeight, this.renderTargetParameters );

	}

	this.needsSwap = false;

	this.camera = new THREE.OrthographicCamera( - 1, 1, 1, - 1, 0, 1 );
	this.scene  = new THREE.Scene();

	this.quad = new THREE.Mesh( new THREE.PlaneBufferGeometry( 2, 2 ), null );
	this.scene.add( this.quad );

};

THREE.SavePass.prototype = Object.assign( Object.create( THREE.Pass.prototype ), {

	constructor: THREE.SavePass,

	render: function ( renderer, writeBuffer, readBuffer, delta, maskActive ) {

		if ( this.uniforms[ this.textureID ] ) {

			this.uniforms[ this.textureID ].value = readBuffer.texture;

		}

		this.quad.material = this.material;

		renderer.render( this.scene, this.camera, this.renderTarget, this.clear );

	}

} );

/**
 * @author alteredq / http://alteredqualia.com/
 */

THREE.ShaderPass = function ( shader, textureID ) {

	THREE.Pass.call( this );

	this.textureID = ( textureID !== undefined ) ? textureID : "tDiffuse";

	if ( shader instanceof THREE.ShaderMaterial ) {

		this.uniforms = shader.uniforms;

		this.material = shader;

	} else if ( shader ) {

		this.uniforms = THREE.UniformsUtils.clone( shader.uniforms );

		this.material = new THREE.ShaderMaterial( {

			defines: shader.defines || {},
			uniforms: this.uniforms,
			vertexShader: shader.vertexShader,
			fragmentShader: shader.fragmentShader

		} );

	}

	this.camera = new THREE.OrthographicCamera( - 1, 1, 1, - 1, 0, 1 );
	this.scene = new THREE.Scene();

	this.quad = new THREE.Mesh( new THREE.PlaneBufferGeometry( 2, 2 ), null );
	this.scene.add( this.quad );

};

THREE.ShaderPass.prototype = Object.assign( Object.create( THREE.Pass.prototype ), {

	constructor: THREE.ShaderPass,

	render: function( renderer, writeBuffer, readBuffer, delta, maskActive ) {

		if ( this.uniforms[ this.textureID ] ) {

			this.uniforms[ this.textureID ].value = readBuffer.texture;

		}

		this.quad.material = this.material;

		if ( this.renderToScreen ) {

			renderer.render( this.scene, this.camera );

		} else {

			renderer.render( this.scene, this.camera, writeBuffer, this.clear );

		}

	}

} );

/**
 *
 * Temporal Anti-Aliasing Render Pass
 *
 * @author bhouston / http://clara.io/
 *
 * When there is no motion in the scene, the TAA render pass accumulates jittered camera samples across frames to create a high quality anti-aliased result.
 *
 * References:
 *
 * TODO: Add support for motion vector pas so that accumulation of samples across frames can occur on dynamics scenes.
 *
 */

THREE.TAARenderPass = function ( scene, camera, params ) {

	if ( THREE.SSAARenderPass === undefined ) {

		console.error( "THREE.TAARenderPass relies on THREE.SSAARenderPass" );

	}

	THREE.SSAARenderPass.call( this, scene, camera, params );

	this.sampleLevel = 0;
	this.accumulate = false;

};

THREE.TAARenderPass.JitterVectors = THREE.SSAARenderPass.JitterVectors;

THREE.TAARenderPass.prototype = Object.assign( Object.create( THREE.SSAARenderPass.prototype ), {

	constructor: THREE.TAARenderPass,

	render: function ( renderer, writeBuffer, readBuffer, delta ) {

		if( ! this.accumulate ) {

				THREE.SSAARenderPass.prototype.render.call( this, renderer, writeBuffer, readBuffer, delta );

				this.accumulateIndex = -1;
				return;

		}

		var jitterOffsets = THREE.TAARenderPass.JitterVectors[ 5 ];

		if ( ! this.sampleRenderTarget ) {

			this.sampleRenderTarget = new THREE.WebGLRenderTarget( readBuffer.width, readBuffer.height, this.params );

		}

		if ( ! this.holdRenderTarget ) {

			this.holdRenderTarget = new THREE.WebGLRenderTarget( readBuffer.width, readBuffer.height, this.params );

		}

		if( this.accumulate && this.accumulateIndex === -1 ) {

				THREE.SSAARenderPass.prototype.render.call( this, renderer, this.holdRenderTarget, readBuffer, delta );

				this.accumulateIndex = 0;

		}

		var autoClear = renderer.autoClear;
		renderer.autoClear = false;

		var sampleWeight = 1.0 / ( jitterOffsets.length );

		if( this.accumulateIndex >= 0 && this.accumulateIndex < jitterOffsets.length ) {

			this.copyUniforms[ "opacity" ].value = sampleWeight;
			this.copyUniforms[ "tDiffuse" ].value = writeBuffer.texture;

			// render the scene multiple times, each slightly jitter offset from the last and accumulate the results.
			var numSamplesPerFrame = Math.pow( 2, this.sampleLevel );
			for ( var i = 0; i < numSamplesPerFrame; i ++ ) {

				var j = this.accumulateIndex;
				var jitterOffset = jitterOffsets[j];
				if ( this.camera.setViewOffset ) {
					this.camera.setViewOffset( readBuffer.width, readBuffer.height,
						jitterOffset[ 0 ] * 0.0625, jitterOffset[ 1 ] * 0.0625,   // 0.0625 = 1 / 16
						readBuffer.width, readBuffer.height );
				}

				renderer.render( this.scene, this.camera, writeBuffer, true );
				renderer.render( this.scene2, this.camera2, this.sampleRenderTarget, ( this.accumulateIndex === 0 ) );

				this.accumulateIndex ++;
				if( this.accumulateIndex >= jitterOffsets.length ) break;
			}

			if ( this.camera.clearViewOffset ) this.camera.clearViewOffset();

		}

		var accumulationWeight = this.accumulateIndex * sampleWeight;

		if( accumulationWeight > 0 ) {
			this.copyUniforms[ "opacity" ].value = 1.0;
			this.copyUniforms[ "tDiffuse" ].value = this.sampleRenderTarget.texture;
			renderer.render( this.scene2, this.camera2, writeBuffer, true );
		}
		if( accumulationWeight < 1.0 ) {
			this.copyUniforms[ "opacity" ].value = 1.0 - accumulationWeight;
			this.copyUniforms[ "tDiffuse" ].value = this.holdRenderTarget.texture;
			renderer.render( this.scene2, this.camera2, writeBuffer, ( accumulationWeight === 0 ) );
		}

		renderer.autoClear = autoClear;

	}

});

/**
 * @author alteredq / http://alteredqualia.com/
 */

THREE.TexturePass = function ( map, opacity ) {

	THREE.Pass.call( this );

	if ( THREE.CopyShader === undefined )
		console.error( "THREE.TexturePass relies on THREE.CopyShader" );

	var shader = THREE.CopyShader;

	this.map = map;
	this.opacity = ( opacity !== undefined ) ? opacity : 1.0;

	this.uniforms = THREE.UniformsUtils.clone( shader.uniforms );

	this.material = new THREE.ShaderMaterial( {

		uniforms: this.uniforms,
		vertexShader: shader.vertexShader,
		fragmentShader: shader.fragmentShader,
		depthTest: false,
		depthWrite: false

	} );

	this.needsSwap = false;

	this.camera = new THREE.OrthographicCamera( - 1, 1, 1, - 1, 0, 1 );
	this.scene  = new THREE.Scene();

	this.quad = new THREE.Mesh( new THREE.PlaneBufferGeometry( 2, 2 ), null );
	this.scene.add( this.quad );

};

THREE.TexturePass.prototype = Object.assign( Object.create( THREE.Pass.prototype ), {

	constructor: THREE.TexturePass,

	render: function ( renderer, writeBuffer, readBuffer, delta, maskActive ) {

		var oldAutoClear = renderer.autoClear;
		renderer.autoClear = false;

		this.quad.material = this.material;

		this.uniforms[ "opacity" ].value = this.opacity;
		this.uniforms[ "tDiffuse" ].value = this.map;
		this.material.transparent = ( this.opacity < 1.0 );

		renderer.render( this.scene, this.camera, this.renderToScreen ? null : readBuffer, this.clear );

		renderer.autoClear = oldAutoClear;
	}

} );

/**
 * @author spidersharma / http://eduperiment.com/
 Inspired from Unreal Engine::
 https://docs.unrealengine.com/latest/INT/Engine/Rendering/PostProcessEffects/Bloom/
 */

THREE.UnrealBloomPass = function ( resolution, strength, radius, threshold ) {

	THREE.Pass.call( this );

	this.strength = ( strength !== undefined ) ? strength : 1;
	this.radius = radius;
	this.threshold = threshold;
	this.resolution = ( resolution !== undefined ) ? new THREE.Vector2(resolution.x, resolution.y) : new THREE.Vector2(256, 256);

	// render targets
	var pars = { minFilter: THREE.LinearFilter, magFilter: THREE.LinearFilter, format: THREE.RGBAFormat };
	this.renderTargetsHorizontal = [];
	this.renderTargetsVertical = [];
	this.nMips = 5;
	var resx = Math.round(this.resolution.x/2);
	var resy = Math.round(this.resolution.y/2);

	this.renderTargetBright = new THREE.WebGLRenderTarget( resx, resy, pars );
	this.renderTargetBright.texture.generateMipmaps = false;

	for( var i=0; i<this.nMips; i++) {

		var renderTarget = new THREE.WebGLRenderTarget( resx, resy, pars );

		renderTarget.texture.generateMipmaps = false;

		this.renderTargetsHorizontal.push(renderTarget);

		var renderTarget = new THREE.WebGLRenderTarget( resx, resy, pars );

		renderTarget.texture.generateMipmaps = false;

		this.renderTargetsVertical.push(renderTarget);

		resx = Math.round(resx/2);

		resy = Math.round(resy/2);
	}

	// luminosity high pass material

	if ( THREE.LuminosityHighPassShader === undefined )
		console.error( "THREE.UnrealBloomPass relies on THREE.LuminosityHighPassShader" );

	var highPassShader = THREE.LuminosityHighPassShader;
	this.highPassUniforms = THREE.UniformsUtils.clone( highPassShader.uniforms );

	this.highPassUniforms[ "luminosityThreshold" ].value = threshold;
	this.highPassUniforms[ "smoothWidth" ].value = 0.01;

	this.materialHighPassFilter = new THREE.ShaderMaterial( {
		uniforms: this.highPassUniforms,
		vertexShader:  highPassShader.vertexShader,
		fragmentShader: highPassShader.fragmentShader,
		defines: {}
	} );

	// Gaussian Blur Materials
	this.separableBlurMaterials = [];
	var kernelSizeArray = [3, 5, 7, 9, 11];
	var resx = Math.round(this.resolution.x/2);
	var resy = Math.round(this.resolution.y/2);

	for( var i=0; i<this.nMips; i++) {

		this.separableBlurMaterials.push(this.getSeperableBlurMaterial(kernelSizeArray[i]));

		this.separableBlurMaterials[i].uniforms[ "texSize" ].value = new THREE.Vector2(resx, resy);

		resx = Math.round(resx/2);

		resy = Math.round(resy/2);
	}

	// Composite material
	this.compositeMaterial = this.getCompositeMaterial(this.nMips);
	this.compositeMaterial.uniforms["blurTexture1"].value = this.renderTargetsVertical[0].texture;
	this.compositeMaterial.uniforms["blurTexture2"].value = this.renderTargetsVertical[1].texture;
	this.compositeMaterial.uniforms["blurTexture3"].value = this.renderTargetsVertical[2].texture;
	this.compositeMaterial.uniforms["blurTexture4"].value = this.renderTargetsVertical[3].texture;
	this.compositeMaterial.uniforms["blurTexture5"].value = this.renderTargetsVertical[4].texture;
	this.compositeMaterial.uniforms["bloomStrength"].value = strength;
	this.compositeMaterial.uniforms["bloomRadius"].value = 0.1;
	this.compositeMaterial.needsUpdate = true;

	var bloomFactors = [1.0, 0.8, 0.6, 0.4, 0.2];
	this.compositeMaterial.uniforms["bloomFactors"].value = bloomFactors;
	this.bloomTintColors = [new THREE.Vector3(1,1,1), new THREE.Vector3(1,1,1), new THREE.Vector3(1,1,1)
												,new THREE.Vector3(1,1,1), new THREE.Vector3(1,1,1)];
	this.compositeMaterial.uniforms["bloomTintColors"].value = this.bloomTintColors;

	// copy material
	if ( THREE.CopyShader === undefined )
		console.error( "THREE.BloomPass relies on THREE.CopyShader" );

	var copyShader = THREE.CopyShader;

	this.copyUniforms = THREE.UniformsUtils.clone( copyShader.uniforms );
	this.copyUniforms[ "opacity" ].value = 1.0;

	this.materialCopy = new THREE.ShaderMaterial( {
		uniforms: this.copyUniforms,
		vertexShader: copyShader.vertexShader,
		fragmentShader: copyShader.fragmentShader,
		blending: THREE.AdditiveBlending,
		depthTest: false,
		depthWrite: false,
		transparent: true
	} );

	this.enabled = true;
	this.needsSwap = false;

	this.oldClearColor = new THREE.Color();
	this.oldClearAlpha = 1;

	this.camera = new THREE.OrthographicCamera( - 1, 1, 1, - 1, 0, 1 );
	this.scene  = new THREE.Scene();

	this.quad = new THREE.Mesh( new THREE.PlaneBufferGeometry( 2, 2 ), null );
	this.scene.add( this.quad );

};

THREE.UnrealBloomPass.prototype = Object.assign( Object.create( THREE.Pass.prototype ), {

	constructor: THREE.UnrealBloomPass,

	dispose: function() {
		for( var i=0; i< this.renderTargetsHorizontal.length(); i++) {
			this.renderTargetsHorizontal[i].dispose();
		}
		for( var i=0; i< this.renderTargetsVertical.length(); i++) {
			this.renderTargetsVertical[i].dispose();
		}
		this.renderTargetBright.dispose();
	},

	setSize: function ( width, height ) {

		var resx = Math.round(width/2);
		var resy = Math.round(height/2);

		this.renderTargetBright.setSize(resx, resy);

		for( var i=0; i<this.nMips; i++) {

			this.renderTargetsHorizontal[i].setSize(resx, resy);
			this.renderTargetsVertical[i].setSize(resx, resy);

			this.separableBlurMaterials[i].uniforms[ "texSize" ].value = new THREE.Vector2(resx, resy);

			resx = Math.round(resx/2);
			resy = Math.round(resy/2);
		}
	},

	render: function ( renderer, writeBuffer, readBuffer, delta, maskActive ) {

		this.oldClearColor.copy( renderer.getClearColor() );
		this.oldClearAlpha = renderer.getClearAlpha();
		var oldAutoClear = renderer.autoClear;
		renderer.autoClear = false;

		renderer.setClearColor( new THREE.Color( 0, 0, 0 ), 0 );

		if ( maskActive ) renderer.context.disable( renderer.context.STENCIL_TEST );

		// 1. Extract Bright Areas
		this.highPassUniforms[ "tDiffuse" ].value = readBuffer.texture;
		this.highPassUniforms[ "luminosityThreshold" ].value = this.threshold;
		this.quad.material = this.materialHighPassFilter;
		renderer.render( this.scene, this.camera, this.renderTargetBright, true );

		// 2. Blur All the mips progressively
		var inputRenderTarget = this.renderTargetBright;

		for(var i=0; i<this.nMips; i++) {

			this.quad.material = this.separableBlurMaterials[i];

			this.separableBlurMaterials[i].uniforms[ "colorTexture" ].value = inputRenderTarget.texture;

			this.separableBlurMaterials[i].uniforms[ "direction" ].value = THREE.UnrealBloomPass.BlurDirectionX;

			renderer.render( this.scene, this.camera, this.renderTargetsHorizontal[i], true );

			this.separableBlurMaterials[i].uniforms[ "colorTexture" ].value = this.renderTargetsHorizontal[i].texture;

			this.separableBlurMaterials[i].uniforms[ "direction" ].value = THREE.UnrealBloomPass.BlurDirectionY;

			renderer.render( this.scene, this.camera, this.renderTargetsVertical[i], true );

			inputRenderTarget = this.renderTargetsVertical[i];
		}

		// Composite All the mips
		this.quad.material = this.compositeMaterial;
		this.compositeMaterial.uniforms["bloomStrength"].value = this.strength;
		this.compositeMaterial.uniforms["bloomRadius"].value = this.radius;
		this.compositeMaterial.uniforms["bloomTintColors"].value = this.bloomTintColors;
		renderer.render( this.scene, this.camera, this.renderTargetsHorizontal[0], true );

		// Blend it additively over the input texture
		this.quad.material = this.materialCopy;
		this.copyUniforms[ "tDiffuse" ].value = this.renderTargetsHorizontal[0].texture;

		if ( maskActive ) renderer.context.enable( renderer.context.STENCIL_TEST );

		renderer.render( this.scene, this.camera, readBuffer, false );

		renderer.setClearColor( this.oldClearColor, this.oldClearAlpha );
		renderer.autoClear = oldAutoClear;
	},

	getSeperableBlurMaterial: function(kernelRadius) {

		return new THREE.ShaderMaterial( {

			defines: {
				"KERNEL_RADIUS" : kernelRadius,
				"SIGMA" : kernelRadius
			},

			uniforms: {
				"colorTexture": { value: null },
				"texSize": 				{ value: new THREE.Vector2( 0.5, 0.5 ) },
				"direction": 				{ value: new THREE.Vector2( 0.5, 0.5 ) }
			},

			vertexShader:
				"varying vec2 vUv;\n\
				void main() {\n\
					vUv = uv;\n\
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\
				}",

			fragmentShader:
				"#include <common>\
				varying vec2 vUv;\n\
				uniform sampler2D colorTexture;\n\
				uniform vec2 texSize;\
				uniform vec2 direction;\
				\
				float gaussianPdf(in float x, in float sigma) {\
					return 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\
				}\
				void main() {\n\
					vec2 invSize = 1.0 / texSize;\
					float fSigma = float(SIGMA);\
					float weightSum = gaussianPdf(0.0, fSigma);\
					vec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;\
					for( int i = 1; i < KERNEL_RADIUS; i ++ ) {\
						float x = float(i);\
						float w = gaussianPdf(x, fSigma);\
						vec2 uvOffset = direction * invSize * x;\
						vec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;\
						vec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;\
						diffuseSum += (sample1 + sample2) * w;\
						weightSum += 2.0 * w;\
					}\
					gl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n\
				}"
		} );
	},

	getCompositeMaterial: function(nMips) {

		return new THREE.ShaderMaterial( {

			defines:{
				"NUM_MIPS" : nMips
			},

			uniforms: {
				"blurTexture1": { value: null },
				"blurTexture2": { value: null },
				"blurTexture3": { value: null },
				"blurTexture4": { value: null },
				"blurTexture5": { value: null },
				"dirtTexture": { value: null },
				"bloomStrength" : { value: 1.0 },
				"bloomFactors" : { value: null },
				"bloomTintColors" : { value: null },
				"bloomRadius" : { value: 0.0 }
			},

			vertexShader:
				"varying vec2 vUv;\n\
				void main() {\n\
					vUv = uv;\n\
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\
				}",

			fragmentShader:
				"varying vec2 vUv;\
				uniform sampler2D blurTexture1;\
				uniform sampler2D blurTexture2;\
				uniform sampler2D blurTexture3;\
				uniform sampler2D blurTexture4;\
				uniform sampler2D blurTexture5;\
				uniform sampler2D dirtTexture;\
				uniform float bloomStrength;\
				uniform float bloomRadius;\
				uniform float bloomFactors[NUM_MIPS];\
				uniform vec3 bloomTintColors[NUM_MIPS];\
				\
				float lerpBloomFactor(const in float factor) { \
					float mirrorFactor = 1.2 - factor;\
					return mix(factor, mirrorFactor, bloomRadius);\
				}\
				\
				void main() {\
					gl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) + \
					 							 lerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) + \
												 lerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) + \
												 lerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) + \
												 lerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );\
				}"
		} );
	}

} );

THREE.UnrealBloomPass.BlurDirectionX = new THREE.Vector2( 1.0, 0.0 );
THREE.UnrealBloomPass.BlurDirectionY = new THREE.Vector2( 0.0, 1.0 );

/**
 * @author mrdoob / http://www.mrdoob.com
 *
 * Simple test shader
 */

THREE.BasicShader = {

	uniforms: {},

	vertexShader: [

		"void main() {",

			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join( "\n" ),

	fragmentShader: [

		"void main() {",

			"gl_FragColor = vec4( 1.0, 0.0, 0.0, 0.5 );",

		"}"

	].join( "\n" )

};

/**
 * @author alteredq / http://alteredqualia.com/
 *
 * Bleach bypass shader [http://en.wikipedia.org/wiki/Bleach_bypass]
 * - based on Nvidia example
 * http://developer.download.nvidia.com/shaderlibrary/webpages/shader_library.html#post_bleach_bypass
 */

THREE.BleachBypassShader = {

	uniforms: {

		"tDiffuse": { value: null },
		"opacity":  { value: 1.0 }

	},

	vertexShader: [

		"varying vec2 vUv;",

		"void main() {",

			"vUv = uv;",
			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join( "\n" ),

	fragmentShader: [

		"uniform float opacity;",

		"uniform sampler2D tDiffuse;",

		"varying vec2 vUv;",

		"void main() {",

			"vec4 base = texture2D( tDiffuse, vUv );",

			"vec3 lumCoeff = vec3( 0.25, 0.65, 0.1 );",
			"float lum = dot( lumCoeff, base.rgb );",
			"vec3 blend = vec3( lum );",

			"float L = min( 1.0, max( 0.0, 10.0 * ( lum - 0.45 ) ) );",

			"vec3 result1 = 2.0 * base.rgb * blend;",
			"vec3 result2 = 1.0 - 2.0 * ( 1.0 - blend ) * ( 1.0 - base.rgb );",

			"vec3 newColor = mix( result1, result2, L );",

			"float A2 = opacity * base.a;",
			"vec3 mixRGB = A2 * newColor.rgb;",
			"mixRGB += ( ( 1.0 - A2 ) * base.rgb );",

			"gl_FragColor = vec4( mixRGB, base.a );",

		"}"

	].join( "\n" )

};

/**
 * @author alteredq / http://alteredqualia.com/
 *
 * Blend two textures
 */

THREE.BlendShader = {

	uniforms: {

		"tDiffuse1": { value: null },
		"tDiffuse2": { value: null },
		"mixRatio":  { value: 0.5 },
		"opacity":   { value: 1.0 }

	},

	vertexShader: [

		"varying vec2 vUv;",

		"void main() {",

			"vUv = uv;",
			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join( "\n" ),

	fragmentShader: [

		"uniform float opacity;",
		"uniform float mixRatio;",

		"uniform sampler2D tDiffuse1;",
		"uniform sampler2D tDiffuse2;",

		"varying vec2 vUv;",

		"void main() {",

			"vec4 texel1 = texture2D( tDiffuse1, vUv );",
			"vec4 texel2 = texture2D( tDiffuse2, vUv );",
			"gl_FragColor = opacity * mix( texel1, texel2, mixRatio );",

		"}"

	].join( "\n" )

};

/**
 * @author alteredq / http://alteredqualia.com/
 *
 * Depth-of-field shader with bokeh
 * ported from GLSL shader by Martins Upitis
 * http://artmartinsh.blogspot.com/2010/02/glsl-lens-blur-filter-with-bokeh.html
 */

THREE.BokehShader = {

	uniforms: {

		"tColor":   { value: null },
		"tDepth":   { value: null },
		"focus":    { value: 1.0 },
		"aspect":   { value: 1.0 },
		"aperture": { value: 0.025 },
		"maxblur":  { value: 1.0 }

	},

	vertexShader: [

		"varying vec2 vUv;",

		"void main() {",

			"vUv = uv;",
			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join( "\n" ),

	fragmentShader: [

		"varying vec2 vUv;",

		"uniform sampler2D tColor;",
		"uniform sampler2D tDepth;",

		"uniform float maxblur;",  // max blur amount
		"uniform float aperture;", // aperture - bigger values for shallower depth of field

		"uniform float focus;",
		"uniform float aspect;",

		"void main() {",

			"vec2 aspectcorrect = vec2( 1.0, aspect );",

			"vec4 depth1 = texture2D( tDepth, vUv );",

			"float factor = depth1.x - focus;",

			"vec2 dofblur = vec2 ( clamp( factor * aperture, -maxblur, maxblur ) );",

			"vec2 dofblur9 = dofblur * 0.9;",
			"vec2 dofblur7 = dofblur * 0.7;",
			"vec2 dofblur4 = dofblur * 0.4;",

			"vec4 col = vec4( 0.0 );",

			"col += texture2D( tColor, vUv.xy );",
			"col += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur );",
			"col += texture2D( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur );",
			"col += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur );",
			"col += texture2D( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur );",
			"col += texture2D( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur );",
			"col += texture2D( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur );",
			"col += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur );",
			"col += texture2D( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur );",
			"col += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur );",
			"col += texture2D( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur );",
			"col += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur );",
			"col += texture2D( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur );",
			"col += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur );",
			"col += texture2D( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur );",
			"col += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur );",
			"col += texture2D( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur );",

			"col += texture2D( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur9 );",
			"col += texture2D( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur9 );",
			"col += texture2D( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur9 );",
			"col += texture2D( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur9 );",
			"col += texture2D( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur9 );",
			"col += texture2D( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur9 );",
			"col += texture2D( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur9 );",
			"col += texture2D( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur9 );",

			"col += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur7 );",
			"col += texture2D( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur7 );",
			"col += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur7 );",
			"col += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur7 );",
			"col += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur7 );",
			"col += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur7 );",
			"col += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur7 );",
			"col += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur7 );",

			"col += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur4 );",
			"col += texture2D( tColor, vUv.xy + ( vec2(  0.4,   0.0  ) * aspectcorrect ) * dofblur4 );",
			"col += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur4 );",
			"col += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur4 );",
			"col += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur4 );",
			"col += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur4 );",
			"col += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur4 );",
			"col += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur4 );",

			"gl_FragColor = col / 41.0;",
			"gl_FragColor.a = 1.0;",

		"}"

	].join( "\n" )

};

/**
 * @author zz85 / https://github.com/zz85 | twitter.com/blurspline
 *
 * Depth-of-field shader with bokeh
 * ported from GLSL shader by Martins Upitis
 * http://blenderartists.org/forum/showthread.php?237488-GLSL-depth-of-field-with-bokeh-v2-4-(update)
 *
 * Requires #define RINGS and SAMPLES integers
 */



THREE.BokehShader = {

	uniforms: {

		"textureWidth":  { value: 1.0 },
		"textureHeight":  { value: 1.0 },

		"focalDepth":   { value: 1.0 },
		"focalLength":   { value: 24.0 },
		"fstop": { value: 0.9 },

		"tColor":   { value: null },
		"tDepth":   { value: null },

		"maxblur":  { value: 1.0 },

		"showFocus":   { value: 0 },
		"manualdof":   { value: 0 },
		"vignetting":   { value: 0 },
		"depthblur":   { value: 0 },

		"threshold":  { value: 0.5 },
		"gain":  { value: 2.0 },
		"bias":  { value: 0.5 },
		"fringe":  { value: 0.7 },

		"znear":  { value: 0.1 },
		"zfar":  { value: 100 },

		"noise":  { value: 1 },
		"dithering":  { value: 0.0001 },
		"pentagon": { value: 0 },

		"shaderFocus":  { value: 1 },
		"focusCoords":  { value: new THREE.Vector2() }


	},

	vertexShader: [

		"varying vec2 vUv;",

		"void main() {",

			"vUv = uv;",
			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join( "\n" ),

	fragmentShader: [

		"#include <common>",

		"varying vec2 vUv;",

		"uniform sampler2D tColor;",
		"uniform sampler2D tDepth;",
		"uniform float textureWidth;",
		"uniform float textureHeight;",

		"uniform float focalDepth;  //focal distance value in meters, but you may use autofocus option below",
		"uniform float focalLength; //focal length in mm",
		"uniform float fstop; //f-stop value",
		"uniform bool showFocus; //show debug focus point and focal range (red = focal point, green = focal range)",

		"/*",
		"make sure that these two values are the same for your camera, otherwise distances will be wrong.",
		"*/",

		"uniform float znear; // camera clipping start",
		"uniform float zfar; // camera clipping end",

		"//------------------------------------------",
		"//user variables",

		"const int samples = SAMPLES; //samples on the first ring",
		"const int rings = RINGS; //ring count",

		"const int maxringsamples = rings * samples;",

		"uniform bool manualdof; // manual dof calculation",
		"float ndofstart = 1.0; // near dof blur start",
		"float ndofdist = 2.0; // near dof blur falloff distance",
		"float fdofstart = 1.0; // far dof blur start",
		"float fdofdist = 3.0; // far dof blur falloff distance",

		"float CoC = 0.03; //circle of confusion size in mm (35mm film = 0.03mm)",

		"uniform bool vignetting; // use optical lens vignetting",

		"float vignout = 1.3; // vignetting outer border",
		"float vignin = 0.0; // vignetting inner border",
		"float vignfade = 22.0; // f-stops till vignete fades",

		"uniform bool shaderFocus;",
		"// disable if you use external focalDepth value",

		"uniform vec2 focusCoords;",
		"// autofocus point on screen (0.0,0.0 - left lower corner, 1.0,1.0 - upper right)",
		"// if center of screen use vec2(0.5, 0.5);",

		"uniform float maxblur;",
		"//clamp value of max blur (0.0 = no blur, 1.0 default)",

		"uniform float threshold; // highlight threshold;",
		"uniform float gain; // highlight gain;",

		"uniform float bias; // bokeh edge bias",
		"uniform float fringe; // bokeh chromatic aberration / fringing",

		"uniform bool noise; //use noise instead of pattern for sample dithering",

		"uniform float dithering;",

		"uniform bool depthblur; // blur the depth buffer",
		"float dbsize = 1.25; // depth blur size",

		"/*",
		"next part is experimental",
		"not looking good with small sample and ring count",
		"looks okay starting from samples = 4, rings = 4",
		"*/",

		"uniform bool pentagon; //use pentagon as bokeh shape?",
		"float feather = 0.4; //pentagon shape feather",

		"//------------------------------------------",

		"float penta(vec2 coords) {",
			"//pentagonal shape",
			"float scale = float(rings) - 1.3;",
			"vec4  HS0 = vec4( 1.0,         0.0,         0.0,  1.0);",
			"vec4  HS1 = vec4( 0.309016994, 0.951056516, 0.0,  1.0);",
			"vec4  HS2 = vec4(-0.809016994, 0.587785252, 0.0,  1.0);",
			"vec4  HS3 = vec4(-0.809016994,-0.587785252, 0.0,  1.0);",
			"vec4  HS4 = vec4( 0.309016994,-0.951056516, 0.0,  1.0);",
			"vec4  HS5 = vec4( 0.0        ,0.0         , 1.0,  1.0);",

			"vec4  one = vec4( 1.0 );",

			"vec4 P = vec4((coords),vec2(scale, scale));",

			"vec4 dist = vec4(0.0);",
			"float inorout = -4.0;",

			"dist.x = dot( P, HS0 );",
			"dist.y = dot( P, HS1 );",
			"dist.z = dot( P, HS2 );",
			"dist.w = dot( P, HS3 );",

			"dist = smoothstep( -feather, feather, dist );",

			"inorout += dot( dist, one );",

			"dist.x = dot( P, HS4 );",
			"dist.y = HS5.w - abs( P.z );",

			"dist = smoothstep( -feather, feather, dist );",
			"inorout += dist.x;",

			"return clamp( inorout, 0.0, 1.0 );",
		"}",

		"float bdepth(vec2 coords) {",
			"// Depth buffer blur",
			"float d = 0.0;",
			"float kernel[9];",
			"vec2 offset[9];",

			"vec2 wh = vec2(1.0/textureWidth,1.0/textureHeight) * dbsize;",

			"offset[0] = vec2(-wh.x,-wh.y);",
			"offset[1] = vec2( 0.0, -wh.y);",
			"offset[2] = vec2( wh.x -wh.y);",

			"offset[3] = vec2(-wh.x,  0.0);",
			"offset[4] = vec2( 0.0,   0.0);",
			"offset[5] = vec2( wh.x,  0.0);",

			"offset[6] = vec2(-wh.x, wh.y);",
			"offset[7] = vec2( 0.0,  wh.y);",
			"offset[8] = vec2( wh.x, wh.y);",

			"kernel[0] = 1.0/16.0;   kernel[1] = 2.0/16.0;   kernel[2] = 1.0/16.0;",
			"kernel[3] = 2.0/16.0;   kernel[4] = 4.0/16.0;   kernel[5] = 2.0/16.0;",
			"kernel[6] = 1.0/16.0;   kernel[7] = 2.0/16.0;   kernel[8] = 1.0/16.0;",


			"for( int i=0; i<9; i++ ) {",
				"float tmp = texture2D(tDepth, coords + offset[i]).r;",
				"d += tmp * kernel[i];",
			"}",

			"return d;",
		"}",


		"vec3 color(vec2 coords,float blur) {",
			"//processing the sample",

			"vec3 col = vec3(0.0);",
			"vec2 texel = vec2(1.0/textureWidth,1.0/textureHeight);",

			"col.r = texture2D(tColor,coords + vec2(0.0,1.0)*texel*fringe*blur).r;",
			"col.g = texture2D(tColor,coords + vec2(-0.866,-0.5)*texel*fringe*blur).g;",
			"col.b = texture2D(tColor,coords + vec2(0.866,-0.5)*texel*fringe*blur).b;",

			"vec3 lumcoeff = vec3(0.299,0.587,0.114);",
			"float lum = dot(col.rgb, lumcoeff);",
			"float thresh = max((lum-threshold)*gain, 0.0);",
			"return col+mix(vec3(0.0),col,thresh*blur);",
		"}",

		"vec3 debugFocus(vec3 col, float blur, float depth) {",
			"float edge = 0.002*depth; //distance based edge smoothing",
			"float m = clamp(smoothstep(0.0,edge,blur),0.0,1.0);",
			"float e = clamp(smoothstep(1.0-edge,1.0,blur),0.0,1.0);",

			"col = mix(col,vec3(1.0,0.5,0.0),(1.0-m)*0.6);",
			"col = mix(col,vec3(0.0,0.5,1.0),((1.0-e)-(1.0-m))*0.2);",

			"return col;",
		"}",

		"float linearize(float depth) {",
			"return -zfar * znear / (depth * (zfar - znear) - zfar);",
		"}",


		"float vignette() {",
			"float dist = distance(vUv.xy, vec2(0.5,0.5));",
			"dist = smoothstep(vignout+(fstop/vignfade), vignin+(fstop/vignfade), dist);",
			"return clamp(dist,0.0,1.0);",
		"}",

		"float gather(float i, float j, int ringsamples, inout vec3 col, float w, float h, float blur) {",
			"float rings2 = float(rings);",
			"float step = PI*2.0 / float(ringsamples);",
			"float pw = cos(j*step)*i;",
			"float ph = sin(j*step)*i;",
			"float p = 1.0;",
			"if (pentagon) {",
				"p = penta(vec2(pw,ph));",
			"}",
			"col += color(vUv.xy + vec2(pw*w,ph*h), blur) * mix(1.0, i/rings2, bias) * p;",
			"return 1.0 * mix(1.0, i /rings2, bias) * p;",
		"}",

		"void main() {",
			"//scene depth calculation",

			"float depth = linearize(texture2D(tDepth,vUv.xy).x);",

			"// Blur depth?",
			"if (depthblur) {",
				"depth = linearize(bdepth(vUv.xy));",
			"}",

			"//focal plane calculation",

			"float fDepth = focalDepth;",

			"if (shaderFocus) {",

				"fDepth = linearize(texture2D(tDepth,focusCoords).x);",

			"}",

			"// dof blur factor calculation",

			"float blur = 0.0;",

			"if (manualdof) {",
				"float a = depth-fDepth; // Focal plane",
				"float b = (a-fdofstart)/fdofdist; // Far DoF",
				"float c = (-a-ndofstart)/ndofdist; // Near Dof",
				"blur = (a>0.0) ? b : c;",
			"} else {",
				"float f = focalLength; // focal length in mm",
				"float d = fDepth*1000.0; // focal plane in mm",
				"float o = depth*1000.0; // depth in mm",

				"float a = (o*f)/(o-f);",
				"float b = (d*f)/(d-f);",
				"float c = (d-f)/(d*fstop*CoC);",

				"blur = abs(a-b)*c;",
			"}",

			"blur = clamp(blur,0.0,1.0);",

			"// calculation of pattern for dithering",

			"vec2 noise = vec2(rand(vUv.xy), rand( vUv.xy + vec2( 0.4, 0.6 ) ) )*dithering*blur;",

			"// getting blur x and y step factor",

			"float w = (1.0/textureWidth)*blur*maxblur+noise.x;",
			"float h = (1.0/textureHeight)*blur*maxblur+noise.y;",

			"// calculation of final color",

			"vec3 col = vec3(0.0);",

			"if(blur < 0.05) {",
				"//some optimization thingy",
				"col = texture2D(tColor, vUv.xy).rgb;",
			"} else {",
				"col = texture2D(tColor, vUv.xy).rgb;",
				"float s = 1.0;",
				"int ringsamples;",

				"for (int i = 1; i <= rings; i++) {",
					"/*unboxstart*/",
					"ringsamples = i * samples;",

					"for (int j = 0 ; j < maxringsamples ; j++) {",
						"if (j >= ringsamples) break;",
						"s += gather(float(i), float(j), ringsamples, col, w, h, blur);",
					"}",
					"/*unboxend*/",
				"}",

				"col /= s; //divide by sample count",
			"}",

			"if (showFocus) {",
				"col = debugFocus(col, blur, depth);",
			"}",

			"if (vignetting) {",
				"col *= vignette();",
			"}",

			"gl_FragColor.rgb = col;",
			"gl_FragColor.a = 1.0;",
		"} "

	].join( "\n" )

};

/**
 * @author tapio / http://tapio.github.com/
 *
 * Brightness and contrast adjustment
 * https://github.com/evanw/glfx.js
 * brightness: -1 to 1 (-1 is solid black, 0 is no change, and 1 is solid white)
 * contrast: -1 to 1 (-1 is solid gray, 0 is no change, and 1 is maximum contrast)
 */

THREE.BrightnessContrastShader = {

	uniforms: {

		"tDiffuse":   { value: null },
		"brightness": { value: 0 },
		"contrast":   { value: 0 }

	},

	vertexShader: [

		"varying vec2 vUv;",

		"void main() {",

			"vUv = uv;",

			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join( "\n" ),

	fragmentShader: [

		"uniform sampler2D tDiffuse;",
		"uniform float brightness;",
		"uniform float contrast;",

		"varying vec2 vUv;",

		"void main() {",

			"gl_FragColor = texture2D( tDiffuse, vUv );",

			"gl_FragColor.rgb += brightness;",

			"if (contrast > 0.0) {",
				"gl_FragColor.rgb = (gl_FragColor.rgb - 0.5) / (1.0 - contrast) + 0.5;",
			"} else {",
				"gl_FragColor.rgb = (gl_FragColor.rgb - 0.5) * (1.0 + contrast) + 0.5;",
			"}",

		"}"

	].join( "\n" )

};

/**
 * @author alteredq / http://alteredqualia.com/
 *
 * Color correction
 */

THREE.ColorCorrectionShader = {

	uniforms: {

		"tDiffuse": { value: null },
		"powRGB":   { value: new THREE.Vector3( 2, 2, 2 ) },
		"mulRGB":   { value: new THREE.Vector3( 1, 1, 1 ) },
		"addRGB":   { value: new THREE.Vector3( 0, 0, 0 ) }

	},

	vertexShader: [

		"varying vec2 vUv;",

		"void main() {",

			"vUv = uv;",

			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join( "\n" ),

	fragmentShader: [

		"uniform sampler2D tDiffuse;",
		"uniform vec3 powRGB;",
		"uniform vec3 mulRGB;",
		"uniform vec3 addRGB;",

		"varying vec2 vUv;",

		"void main() {",

			"gl_FragColor = texture2D( tDiffuse, vUv );",
			"gl_FragColor.rgb = mulRGB * pow( ( gl_FragColor.rgb + addRGB ), powRGB );",

		"}"

	].join( "\n" )

};

/**
 * @author alteredq / http://alteredqualia.com/
 *
 * Colorify shader
 */

THREE.ColorifyShader = {

	uniforms: {

		"tDiffuse": { value: null },
		"color":    { value: new THREE.Color( 0xffffff ) }

	},

	vertexShader: [

		"varying vec2 vUv;",

		"void main() {",

			"vUv = uv;",
			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join( "\n" ),

	fragmentShader: [

		"uniform vec3 color;",
		"uniform sampler2D tDiffuse;",

		"varying vec2 vUv;",

		"void main() {",

			"vec4 texel = texture2D( tDiffuse, vUv );",

			"vec3 luma = vec3( 0.299, 0.587, 0.114 );",
			"float v = dot( texel.xyz, luma );",

			"gl_FragColor = vec4( v * color, texel.w );",

		"}"

	].join( "\n" )

};

/**
 * @author alteredq / http://alteredqualia.com/
 *
 * Convolution shader
 * ported from o3d sample to WebGL / GLSL
 * http://o3d.googlecode.com/svn/trunk/samples/convolution.html
 */

THREE.ConvolutionShader = {

	defines: {

		"KERNEL_SIZE_FLOAT": "25.0",
		"KERNEL_SIZE_INT": "25"

	},

	uniforms: {

		"tDiffuse":        { value: null },
		"uImageIncrement": { value: new THREE.Vector2( 0.001953125, 0.0 ) },
		"cKernel":         { value: [] }

	},

	vertexShader: [

		"uniform vec2 uImageIncrement;",

		"varying vec2 vUv;",

		"void main() {",

			"vUv = uv - ( ( KERNEL_SIZE_FLOAT - 1.0 ) / 2.0 ) * uImageIncrement;",
			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join( "\n" ),

	fragmentShader: [

		"uniform float cKernel[ KERNEL_SIZE_INT ];",

		"uniform sampler2D tDiffuse;",
		"uniform vec2 uImageIncrement;",

		"varying vec2 vUv;",

		"void main() {",

			"vec2 imageCoord = vUv;",
			"vec4 sum = vec4( 0.0, 0.0, 0.0, 0.0 );",

			"for( int i = 0; i < KERNEL_SIZE_INT; i ++ ) {",

				"sum += texture2D( tDiffuse, imageCoord ) * cKernel[ i ];",
				"imageCoord += uImageIncrement;",

			"}",

			"gl_FragColor = sum;",

		"}"


	].join( "\n" ),

	buildKernel: function ( sigma ) {

		// We lop off the sqrt(2 * pi) * sigma term, since we're going to normalize anyway.

		function gauss( x, sigma ) {

			return Math.exp( - ( x * x ) / ( 2.0 * sigma * sigma ) );

		}

		var i, values, sum, halfWidth, kMaxKernelSize = 25, kernelSize = 2 * Math.ceil( sigma * 3.0 ) + 1;

		if ( kernelSize > kMaxKernelSize ) kernelSize = kMaxKernelSize;
		halfWidth = ( kernelSize - 1 ) * 0.5;

		values = new Array( kernelSize );
		sum = 0.0;
		for ( i = 0; i < kernelSize; ++ i ) {

			values[ i ] = gauss( i - halfWidth, sigma );
			sum += values[ i ];

		}

		// normalize the kernel

		for ( i = 0; i < kernelSize; ++ i ) values[ i ] /= sum;

		return values;

	}

};

/**
 * @author alteredq / http://alteredqualia.com/
 *
 * Full-screen textured quad shader
 */

THREE.CopyShader = {

	uniforms: {

		"tDiffuse": { value: null },
		"opacity":  { value: 1.0 }

	},

	vertexShader: [

		"varying vec2 vUv;",

		"void main() {",

			"vUv = uv;",
			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join( "\n" ),

	fragmentShader: [

		"uniform float opacity;",

		"uniform sampler2D tDiffuse;",

		"varying vec2 vUv;",

		"void main() {",

			"vec4 texel = texture2D( tDiffuse, vUv );",
			"gl_FragColor = opacity * texel;",

		"}"

	].join( "\n" )

};

/**
 * @author alteredq / http://alteredqualia.com/
 *
 * Depth-of-field shader using mipmaps
 * - from Matt Handley @applmak
 * - requires power-of-2 sized render target with enabled mipmaps
 */

THREE.DOFMipMapShader = {

	uniforms: {

		"tColor":   { value: null },
		"tDepth":   { value: null },
		"focus":    { value: 1.0 },
		"maxblur":  { value: 1.0 }

	},

	vertexShader: [

		"varying vec2 vUv;",

		"void main() {",

			"vUv = uv;",
			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join( "\n" ),

	fragmentShader: [

		"uniform float focus;",
		"uniform float maxblur;",

		"uniform sampler2D tColor;",
		"uniform sampler2D tDepth;",

		"varying vec2 vUv;",

		"void main() {",

			"vec4 depth = texture2D( tDepth, vUv );",

			"float factor = depth.x - focus;",

			"vec4 col = texture2D( tColor, vUv, 2.0 * maxblur * abs( focus - depth.x ) );",

			"gl_FragColor = col;",
			"gl_FragColor.a = 1.0;",

		"}"

	].join( "\n" )

};

/**
 * @author felixturner / http://airtight.cc/
 *
 * RGB Shift Shader
 * Shifts red and blue channels from center in opposite directions
 * Ported from http://kriss.cx/tom/2009/05/rgb-shift/
 * by Tom Butterworth / http://kriss.cx/tom/
 *
 * amount: shift distance (1 is width of input)
 * angle: shift angle in radians
 */

THREE.DigitalGlitch = {

	uniforms: {

		"tDiffuse":		{ value: null },//diffuse texture
		"tDisp":		{ value: null },//displacement texture for digital glitch squares
		"byp":			{ value: 0 },//apply the glitch ?
		"amount":		{ value: 0.08 },
		"angle":		{ value: 0.02 },
		"seed":			{ value: 0.02 },
		"seed_x":		{ value: 0.02 },//-1,1
		"seed_y":		{ value: 0.02 },//-1,1
		"distortion_x":	{ value: 0.5 },
		"distortion_y":	{ value: 0.6 },
		"col_s":		{ value: 0.05 }
	},

	vertexShader: [

		"varying vec2 vUv;",
		"void main() {",
			"vUv = uv;",
			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",
		"}"
	].join( "\n" ),

	fragmentShader: [
		"uniform int byp;",//should we apply the glitch ?
		
		"uniform sampler2D tDiffuse;",
		"uniform sampler2D tDisp;",
		
		"uniform float amount;",
		"uniform float angle;",
		"uniform float seed;",
		"uniform float seed_x;",
		"uniform float seed_y;",
		"uniform float distortion_x;",
		"uniform float distortion_y;",
		"uniform float col_s;",
			
		"varying vec2 vUv;",
		
		
		"float rand(vec2 co){",
			"return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);",
		"}",
				
		"void main() {",
			"if(byp<1) {",
				"vec2 p = vUv;",
				"float xs = floor(gl_FragCoord.x / 0.5);",
				"float ys = floor(gl_FragCoord.y / 0.5);",
				//based on staffantans glitch shader for unity https://github.com/staffantan/unityglitch
				"vec4 normal = texture2D (tDisp, p*seed*seed);",
				"if(p.y<distortion_x+col_s && p.y>distortion_x-col_s*seed) {",
					"if(seed_x>0.){",
						"p.y = 1. - (p.y + distortion_y);",
					"}",
					"else {",
						"p.y = distortion_y;",
					"}",
				"}",
				"if(p.x<distortion_y+col_s && p.x>distortion_y-col_s*seed) {",
					"if(seed_y>0.){",
						"p.x=distortion_x;",
					"}",
					"else {",
						"p.x = 1. - (p.x + distortion_x);",
					"}",
				"}",
				"p.x+=normal.x*seed_x*(seed/5.);",
				"p.y+=normal.y*seed_y*(seed/5.);",
				//base from RGB shift shader
				"vec2 offset = amount * vec2( cos(angle), sin(angle));",
				"vec4 cr = texture2D(tDiffuse, p + offset);",
				"vec4 cga = texture2D(tDiffuse, p);",
				"vec4 cb = texture2D(tDiffuse, p - offset);",
				"gl_FragColor = vec4(cr.r, cga.g, cb.b, cga.a);",
				//add noise
				"vec4 snow = 200.*amount*vec4(rand(vec2(xs * seed,ys * seed*50.))*0.2);",
				"gl_FragColor = gl_FragColor+ snow;",
			"}",
			"else {",
				"gl_FragColor=texture2D (tDiffuse, vUv);",
			"}",
		"}"

	].join( "\n" )

};

/**
 * @author alteredq / http://alteredqualia.com/
 *
 * Dot screen shader
 * based on glfx.js sepia shader
 * https://github.com/evanw/glfx.js
 */

THREE.DotScreenShader = {

	uniforms: {

		"tDiffuse": { value: null },
		"tSize":    { value: new THREE.Vector2( 256, 256 ) },
		"center":   { value: new THREE.Vector2( 0.5, 0.5 ) },
		"angle":    { value: 1.57 },
		"scale":    { value: 1.0 }

	},

	vertexShader: [

		"varying vec2 vUv;",

		"void main() {",

			"vUv = uv;",
			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join( "\n" ),

	fragmentShader: [

		"uniform vec2 center;",
		"uniform float angle;",
		"uniform float scale;",
		"uniform vec2 tSize;",

		"uniform sampler2D tDiffuse;",

		"varying vec2 vUv;",

		"float pattern() {",

			"float s = sin( angle ), c = cos( angle );",

			"vec2 tex = vUv * tSize - center;",
			"vec2 point = vec2( c * tex.x - s * tex.y, s * tex.x + c * tex.y ) * scale;",

			"return ( sin( point.x ) * sin( point.y ) ) * 4.0;",

		"}",

		"void main() {",

			"vec4 color = texture2D( tDiffuse, vUv );",

			"float average = ( color.r + color.g + color.b ) / 3.0;",

			"gl_FragColor = vec4( vec3( average * 10.0 - 5.0 + pattern() ), color.a );",

		"}"

	].join( "\n" )

};

/**
 * @author zz85 / https://github.com/zz85 | https://www.lab4games.net/zz85/blog
 *
 * Edge Detection Shader using Frei-Chen filter
 * Based on http://rastergrid.com/blog/2011/01/frei-chen-edge-detector
 *
 * aspect: vec2 of (1/width, 1/height)
 */

THREE.EdgeShader = {

	uniforms: {

		"tDiffuse": { value: null },
		"aspect":    { value: new THREE.Vector2( 512, 512 ) }
	},

	vertexShader: [

		"varying vec2 vUv;",

		"void main() {",

			"vUv = uv;",
			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join( "\n" ),

	fragmentShader: [

		"uniform sampler2D tDiffuse;",
		"varying vec2 vUv;",

		"uniform vec2 aspect;",

		"vec2 texel = vec2(1.0 / aspect.x, 1.0 / aspect.y);",


		"mat3 G[9];",

		// hard coded matrix values!!!! as suggested in https://github.com/neilmendoza/ofxPostProcessing/blob/master/src/EdgePass.cpp#L45

		"const mat3 g0 = mat3( 0.3535533845424652, 0, -0.3535533845424652, 0.5, 0, -0.5, 0.3535533845424652, 0, -0.3535533845424652 );",
		"const mat3 g1 = mat3( 0.3535533845424652, 0.5, 0.3535533845424652, 0, 0, 0, -0.3535533845424652, -0.5, -0.3535533845424652 );",
		"const mat3 g2 = mat3( 0, 0.3535533845424652, -0.5, -0.3535533845424652, 0, 0.3535533845424652, 0.5, -0.3535533845424652, 0 );",
		"const mat3 g3 = mat3( 0.5, -0.3535533845424652, 0, -0.3535533845424652, 0, 0.3535533845424652, 0, 0.3535533845424652, -0.5 );",
		"const mat3 g4 = mat3( 0, -0.5, 0, 0.5, 0, 0.5, 0, -0.5, 0 );",
		"const mat3 g5 = mat3( -0.5, 0, 0.5, 0, 0, 0, 0.5, 0, -0.5 );",
		"const mat3 g6 = mat3( 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.6666666865348816, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204 );",
		"const mat3 g7 = mat3( -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, 0.6666666865348816, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408 );",
		"const mat3 g8 = mat3( 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408 );",

		"void main(void)",
		"{",

			"G[0] = g0,",
			"G[1] = g1,",
			"G[2] = g2,",
			"G[3] = g3,",
			"G[4] = g4,",
			"G[5] = g5,",
			"G[6] = g6,",
			"G[7] = g7,",
			"G[8] = g8;",

			"mat3 I;",
			"float cnv[9];",
			"vec3 sample;",

			/* fetch the 3x3 neighbourhood and use the RGB vector's length as intensity value */
			"for (float i=0.0; i<3.0; i++) {",
				"for (float j=0.0; j<3.0; j++) {",
					"sample = texture2D(tDiffuse, vUv + texel * vec2(i-1.0,j-1.0) ).rgb;",
					"I[int(i)][int(j)] = length(sample);",
				"}",
			"}",

			/* calculate the convolution values for all the masks */
			"for (int i=0; i<9; i++) {",
				"float dp3 = dot(G[i][0], I[0]) + dot(G[i][1], I[1]) + dot(G[i][2], I[2]);",
				"cnv[i] = dp3 * dp3;",
			"}",

			"float M = (cnv[0] + cnv[1]) + (cnv[2] + cnv[3]);",
			"float S = (cnv[4] + cnv[5]) + (cnv[6] + cnv[7]) + (cnv[8] + M);",

			"gl_FragColor = vec4(vec3(sqrt(M/S)), 1.0);",
		"}"

	].join( "\n" )
};

/**
 * @author zz85 / https://github.com/zz85 | https://www.lab4games.net/zz85/blog
 *
 * Edge Detection Shader using Sobel filter
 * Based on http://rastergrid.com/blog/2011/01/frei-chen-edge-detector
 *
 * aspect: vec2 of (1/width, 1/height)
 */

THREE.EdgeShader2 = {

	uniforms: {

		"tDiffuse": { value: null },
		"aspect":    { value: new THREE.Vector2( 512, 512 ) }
	},

	vertexShader: [

		"varying vec2 vUv;",

		"void main() {",

			"vUv = uv;",
			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join( "\n" ),

	fragmentShader: [

		"uniform sampler2D tDiffuse;",
		"varying vec2 vUv;",
		"uniform vec2 aspect;",


		"vec2 texel = vec2(1.0 / aspect.x, 1.0 / aspect.y);",

		"mat3 G[2];",

		"const mat3 g0 = mat3( 1.0, 2.0, 1.0, 0.0, 0.0, 0.0, -1.0, -2.0, -1.0 );",
		"const mat3 g1 = mat3( 1.0, 0.0, -1.0, 2.0, 0.0, -2.0, 1.0, 0.0, -1.0 );",


		"void main(void)",
		"{",
			"mat3 I;",
			"float cnv[2];",
			"vec3 sample;",

			"G[0] = g0;",
			"G[1] = g1;",

			/* fetch the 3x3 neighbourhood and use the RGB vector's length as intensity value */
			"for (float i=0.0; i<3.0; i++)",
			"for (float j=0.0; j<3.0; j++) {",
				"sample = texture2D( tDiffuse, vUv + texel * vec2(i-1.0,j-1.0) ).rgb;",
				"I[int(i)][int(j)] = length(sample);",
			"}",

			/* calculate the convolution values for all the masks */
			"for (int i=0; i<2; i++) {",
				"float dp3 = dot(G[i][0], I[0]) + dot(G[i][1], I[1]) + dot(G[i][2], I[2]);",
				"cnv[i] = dp3 * dp3; ",
			"}",

			"gl_FragColor = vec4(0.5 * sqrt(cnv[0]*cnv[0]+cnv[1]*cnv[1]));",
		"} "

	].join( "\n" )

};

/**
 * @author alteredq / http://alteredqualia.com/
 * @author davidedc / http://www.sketchpatch.net/
 *
 * NVIDIA FXAA by Timothy Lottes
 * http://timothylottes.blogspot.com/2011/06/fxaa3-source-released.html
 * - WebGL port by @supereggbert
 * http://www.glge.org/demos/fxaa/
 */

THREE.FXAAShader = {

	uniforms: {

		"tDiffuse":   { value: null },
		"resolution": { value: new THREE.Vector2( 1 / 1024, 1 / 512 ) }

	},

	vertexShader: [

		"void main() {",

			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join( "\n" ),

	fragmentShader: [

		"uniform sampler2D tDiffuse;",
		"uniform vec2 resolution;",

		"#define FXAA_REDUCE_MIN   (1.0/128.0)",
		"#define FXAA_REDUCE_MUL   (1.0/8.0)",
		"#define FXAA_SPAN_MAX     8.0",

		"void main() {",

			"vec3 rgbNW = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( -1.0, -1.0 ) ) * resolution ).xyz;",
			"vec3 rgbNE = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( 1.0, -1.0 ) ) * resolution ).xyz;",
			"vec3 rgbSW = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( -1.0, 1.0 ) ) * resolution ).xyz;",
			"vec3 rgbSE = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( 1.0, 1.0 ) ) * resolution ).xyz;",
			"vec4 rgbaM  = texture2D( tDiffuse,  gl_FragCoord.xy  * resolution );",
			"vec3 rgbM  = rgbaM.xyz;",
			"vec3 luma = vec3( 0.299, 0.587, 0.114 );",

			"float lumaNW = dot( rgbNW, luma );",
			"float lumaNE = dot( rgbNE, luma );",
			"float lumaSW = dot( rgbSW, luma );",
			"float lumaSE = dot( rgbSE, luma );",
			"float lumaM  = dot( rgbM,  luma );",
			"float lumaMin = min( lumaM, min( min( lumaNW, lumaNE ), min( lumaSW, lumaSE ) ) );",
			"float lumaMax = max( lumaM, max( max( lumaNW, lumaNE) , max( lumaSW, lumaSE ) ) );",

			"vec2 dir;",
			"dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));",
			"dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));",

			"float dirReduce = max( ( lumaNW + lumaNE + lumaSW + lumaSE ) * ( 0.25 * FXAA_REDUCE_MUL ), FXAA_REDUCE_MIN );",

			"float rcpDirMin = 1.0 / ( min( abs( dir.x ), abs( dir.y ) ) + dirReduce );",
			"dir = min( vec2( FXAA_SPAN_MAX,  FXAA_SPAN_MAX),",
				  "max( vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),",
						"dir * rcpDirMin)) * resolution;",
			"vec4 rgbA = (1.0/2.0) * (",
        	"texture2D(tDiffuse,  gl_FragCoord.xy  * resolution + dir * (1.0/3.0 - 0.5)) +",
			"texture2D(tDiffuse,  gl_FragCoord.xy  * resolution + dir * (2.0/3.0 - 0.5)));",
    		"vec4 rgbB = rgbA * (1.0/2.0) + (1.0/4.0) * (",
			"texture2D(tDiffuse,  gl_FragCoord.xy  * resolution + dir * (0.0/3.0 - 0.5)) +",
      		"texture2D(tDiffuse,  gl_FragCoord.xy  * resolution + dir * (3.0/3.0 - 0.5)));",
    		"float lumaB = dot(rgbB, vec4(luma, 0.0));",

			"if ( ( lumaB < lumaMin ) || ( lumaB > lumaMax ) ) {",

				"gl_FragColor = rgbA;",

			"} else {",
				"gl_FragColor = rgbB;",

			"}",

		"}"

	].join( "\n" )

};

/**
 * @author alteredq / http://alteredqualia.com/
 *
 * Film grain & scanlines shader
 *
 * - ported from HLSL to WebGL / GLSL
 * http://www.truevision3d.com/forums/showcase/staticnoise_colorblackwhite_scanline_shaders-t18698.0.html
 *
 * Screen Space Static Postprocessor
 *
 * Produces an analogue noise overlay similar to a film grain / TV static
 *
 * Original implementation and noise algorithm
 * Pat 'Hawthorne' Shearon
 *
 * Optimized scanlines + noise version with intensity scaling
 * Georg 'Leviathan' Steinrohder
 *
 * This version is provided under a Creative Commons Attribution 3.0 License
 * http://creativecommons.org/licenses/by/3.0/
 */

THREE.FilmShader = {

	uniforms: {

		"tDiffuse":   { value: null },
		"time":       { value: 0.0 },
		"nIntensity": { value: 0.5 },
		"sIntensity": { value: 0.05 },
		"sCount":     { value: 4096 },
		"grayscale":  { value: 1 }

	},

	vertexShader: [

		"varying vec2 vUv;",

		"void main() {",

			"vUv = uv;",
			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join( "\n" ),

	fragmentShader: [

		"#include <common>",
		
		// control parameter
		"uniform float time;",

		"uniform bool grayscale;",

		// noise effect intensity value (0 = no effect, 1 = full effect)
		"uniform float nIntensity;",

		// scanlines effect intensity value (0 = no effect, 1 = full effect)
		"uniform float sIntensity;",

		// scanlines effect count value (0 = no effect, 4096 = full effect)
		"uniform float sCount;",

		"uniform sampler2D tDiffuse;",

		"varying vec2 vUv;",

		"void main() {",

			// sample the source
			"vec4 cTextureScreen = texture2D( tDiffuse, vUv );",

			// make some noise
			"float dx = rand( vUv + time );",

			// add noise
			"vec3 cResult = cTextureScreen.rgb + cTextureScreen.rgb * clamp( 0.1 + dx, 0.0, 1.0 );",

			// get us a sine and cosine
			"vec2 sc = vec2( sin( vUv.y * sCount ), cos( vUv.y * sCount ) );",

			// add scanlines
			"cResult += cTextureScreen.rgb * vec3( sc.x, sc.y, sc.x ) * sIntensity;",

			// interpolate between source and result by intensity
			"cResult = cTextureScreen.rgb + clamp( nIntensity, 0.0,1.0 ) * ( cResult - cTextureScreen.rgb );",

			// convert to grayscale if desired
			"if( grayscale ) {",

				"cResult = vec3( cResult.r * 0.3 + cResult.g * 0.59 + cResult.b * 0.11 );",

			"}",

			"gl_FragColor =  vec4( cResult, cTextureScreen.a );",

		"}"

	].join( "\n" )

};

/**
 * @author alteredq / http://alteredqualia.com/
 *
 * Focus shader
 * based on PaintEffect postprocess from ro.me
 * http://code.google.com/p/3-dreams-of-black/source/browse/deploy/js/effects/PaintEffect.js
 */

THREE.FocusShader = {

	uniforms : {

		"tDiffuse":       { value: null },
		"screenWidth":    { value: 1024 },
		"screenHeight":   { value: 1024 },
		"sampleDistance": { value: 0.94 },
		"waveFactor":     { value: 0.00125 }

	},

	vertexShader: [

		"varying vec2 vUv;",

		"void main() {",

			"vUv = uv;",
			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join( "\n" ),

	fragmentShader: [

		"uniform float screenWidth;",
		"uniform float screenHeight;",
		"uniform float sampleDistance;",
		"uniform float waveFactor;",

		"uniform sampler2D tDiffuse;",

		"varying vec2 vUv;",

		"void main() {",

			"vec4 color, org, tmp, add;",
			"float sample_dist, f;",
			"vec2 vin;",
			"vec2 uv = vUv;",

			"add = color = org = texture2D( tDiffuse, uv );",

			"vin = ( uv - vec2( 0.5 ) ) * vec2( 1.4 );",
			"sample_dist = dot( vin, vin ) * 2.0;",

			"f = ( waveFactor * 100.0 + sample_dist ) * sampleDistance * 4.0;",

			"vec2 sampleSize = vec2(  1.0 / screenWidth, 1.0 / screenHeight ) * vec2( f );",

			"add += tmp = texture2D( tDiffuse, uv + vec2( 0.111964, 0.993712 ) * sampleSize );",
			"if( tmp.b < color.b ) color = tmp;",

			"add += tmp = texture2D( tDiffuse, uv + vec2( 0.846724, 0.532032 ) * sampleSize );",
			"if( tmp.b < color.b ) color = tmp;",

			"add += tmp = texture2D( tDiffuse, uv + vec2( 0.943883, -0.330279 ) * sampleSize );",
			"if( tmp.b < color.b ) color = tmp;",

			"add += tmp = texture2D( tDiffuse, uv + vec2( 0.330279, -0.943883 ) * sampleSize );",
			"if( tmp.b < color.b ) color = tmp;",

			"add += tmp = texture2D( tDiffuse, uv + vec2( -0.532032, -0.846724 ) * sampleSize );",
			"if( tmp.b < color.b ) color = tmp;",

			"add += tmp = texture2D( tDiffuse, uv + vec2( -0.993712, -0.111964 ) * sampleSize );",
			"if( tmp.b < color.b ) color = tmp;",

			"add += tmp = texture2D( tDiffuse, uv + vec2( -0.707107, 0.707107 ) * sampleSize );",
			"if( tmp.b < color.b ) color = tmp;",

			"color = color * vec4( 2.0 ) - ( add / vec4( 8.0 ) );",
			"color = color + ( add / vec4( 8.0 ) - color ) * ( vec4( 1.0 ) - vec4( sample_dist * 0.5 ) );",

			"gl_FragColor = vec4( color.rgb * color.rgb * vec3( 0.95 ) + color.rgb, 1.0 );",

		"}"


	].join( "\n" )
};

/**
 * @author alteredq / http://alteredqualia.com/
 *
 * Based on Nvidia Cg tutorial
 */

THREE.FresnelShader = {

	uniforms: {

		"mRefractionRatio": { value: 1.02 },
		"mFresnelBias": { value: 0.1 },
		"mFresnelPower": { value: 2.0 },
		"mFresnelScale": { value: 1.0 },
		"tCube": { value: null }

	},

	vertexShader: [

		"uniform float mRefractionRatio;",
		"uniform float mFresnelBias;",
		"uniform float mFresnelScale;",
		"uniform float mFresnelPower;",

		"varying vec3 vReflect;",
		"varying vec3 vRefract[3];",
		"varying float vReflectionFactor;",

		"void main() {",

			"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",
			"vec4 worldPosition = modelMatrix * vec4( position, 1.0 );",

			"vec3 worldNormal = normalize( mat3( modelMatrix[0].xyz, modelMatrix[1].xyz, modelMatrix[2].xyz ) * normal );",

			"vec3 I = worldPosition.xyz - cameraPosition;",

			"vReflect = reflect( I, worldNormal );",
			"vRefract[0] = refract( normalize( I ), worldNormal, mRefractionRatio );",
			"vRefract[1] = refract( normalize( I ), worldNormal, mRefractionRatio * 0.99 );",
			"vRefract[2] = refract( normalize( I ), worldNormal, mRefractionRatio * 0.98 );",
			"vReflectionFactor = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( I ), worldNormal ), mFresnelPower );",

			"gl_Position = projectionMatrix * mvPosition;",

		"}"

	].join( "\n" ),

	fragmentShader: [

		"uniform samplerCube tCube;",

		"varying vec3 vReflect;",
		"varying vec3 vRefract[3];",
		"varying float vReflectionFactor;",

		"void main() {",

			"vec4 reflectedColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );",
			"vec4 refractedColor = vec4( 1.0 );",

			"refractedColor.r = textureCube( tCube, vec3( -vRefract[0].x, vRefract[0].yz ) ).r;",
			"refractedColor.g = textureCube( tCube, vec3( -vRefract[1].x, vRefract[1].yz ) ).g;",
			"refractedColor.b = textureCube( tCube, vec3( -vRefract[2].x, vRefract[2].yz ) ).b;",

			"gl_FragColor = mix( refractedColor, reflectedColor, clamp( vReflectionFactor, 0.0, 1.0 ) );",

		"}"

	].join( "\n" )

};

/**
 * @author WestLangley / http://github.com/WestLangley
 *
 * Gamma Correction Shader
 * http://en.wikipedia.org/wiki/gamma_correction
 */

THREE.GammaCorrectionShader = {

	uniforms: {

		"tDiffuse": { value: null }

	},

	vertexShader: [

		"varying vec2 vUv;",

		"void main() {",

			"vUv = uv;",
			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join( "\n" ),

	fragmentShader: [

		"uniform sampler2D tDiffuse;",

		"varying vec2 vUv;",

		"void main() {",

			"vec4 tex = texture2D( tDiffuse, vec2( vUv.x, vUv.y ) );",

			"gl_FragColor = LinearToGamma( tex, float( GAMMA_FACTOR ) );",

		"}"

	].join( "\n" )

};

/**
 * @author zz85 / http://www.lab4games.net/zz85/blog
 *
 * Two pass Gaussian blur filter (horizontal and vertical blur shaders)
 * - described in http://www.gamerendering.com/2008/10/11/gaussian-blur-filter-shader/
 *   and used in http://www.cake23.de/traveling-wavefronts-lit-up.html
 *
 * - 9 samples per pass
 * - standard deviation 2.7
 * - "h" and "v" parameters should be set to "1 / width" and "1 / height"
 */

THREE.HorizontalBlurShader = {

	uniforms: {

		"tDiffuse": { value: null },
		"h":        { value: 1.0 / 512.0 }

	},

	vertexShader: [

		"varying vec2 vUv;",

		"void main() {",

			"vUv = uv;",
			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join( "\n" ),

	fragmentShader: [

		"uniform sampler2D tDiffuse;",
		"uniform float h;",

		"varying vec2 vUv;",

		"void main() {",

			"vec4 sum = vec4( 0.0 );",

			"sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;",
			"sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;",
			"sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;",
			"sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;",
			"sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;",
			"sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;",
			"sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;",
			"sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;",
			"sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;",

			"gl_FragColor = sum;",

		"}"

	].join( "\n" )

};

/**
 * @author alteredq / http://alteredqualia.com/
 *
 * Simple fake tilt-shift effect, modulating two pass Gaussian blur (see above) by vertical position
 *
 * - 9 samples per pass
 * - standard deviation 2.7
 * - "h" and "v" parameters should be set to "1 / width" and "1 / height"
 * - "r" parameter control where "focused" horizontal line lies
 */

THREE.HorizontalTiltShiftShader = {

	uniforms: {

		"tDiffuse": { value: null },
		"h":        { value: 1.0 / 512.0 },
		"r":        { value: 0.35 }

	},

	vertexShader: [

		"varying vec2 vUv;",

		"void main() {",

			"vUv = uv;",
			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join( "\n" ),

	fragmentShader: [

		"uniform sampler2D tDiffuse;",
		"uniform float h;",
		"uniform float r;",

		"varying vec2 vUv;",

		"void main() {",

			"vec4 sum = vec4( 0.0 );",

			"float hh = h * abs( r - vUv.y );",

			"sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * hh, vUv.y ) ) * 0.051;",
			"sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * hh, vUv.y ) ) * 0.0918;",
			"sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * hh, vUv.y ) ) * 0.12245;",
			"sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * hh, vUv.y ) ) * 0.1531;",
			"sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;",
			"sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * hh, vUv.y ) ) * 0.1531;",
			"sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * hh, vUv.y ) ) * 0.12245;",
			"sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * hh, vUv.y ) ) * 0.0918;",
			"sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * hh, vUv.y ) ) * 0.051;",

			"gl_FragColor = sum;",

		"}"

	].join( "\n" )

};

/**
 * @author tapio / http://tapio.github.com/
 *
 * Hue and saturation adjustment
 * https://github.com/evanw/glfx.js
 * hue: -1 to 1 (-1 is 180 degrees in the negative direction, 0 is no change, etc.
 * saturation: -1 to 1 (-1 is solid gray, 0 is no change, and 1 is maximum contrast)
 */

THREE.HueSaturationShader = {

	uniforms: {

		"tDiffuse":   { value: null },
		"hue":        { value: 0 },
		"saturation": { value: 0 }

	},

	vertexShader: [

		"varying vec2 vUv;",

		"void main() {",

			"vUv = uv;",

			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join( "\n" ),

	fragmentShader: [

		"uniform sampler2D tDiffuse;",
		"uniform float hue;",
		"uniform float saturation;",

		"varying vec2 vUv;",

		"void main() {",

			"gl_FragColor = texture2D( tDiffuse, vUv );",

			// hue
			"float angle = hue * 3.14159265;",
			"float s = sin(angle), c = cos(angle);",
			"vec3 weights = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;",
			"float len = length(gl_FragColor.rgb);",
			"gl_FragColor.rgb = vec3(",
				"dot(gl_FragColor.rgb, weights.xyz),",
				"dot(gl_FragColor.rgb, weights.zxy),",
				"dot(gl_FragColor.rgb, weights.yzx)",
			");",

			// saturation
			"float average = (gl_FragColor.r + gl_FragColor.g + gl_FragColor.b) / 3.0;",
			"if (saturation > 0.0) {",
				"gl_FragColor.rgb += (average - gl_FragColor.rgb) * (1.0 - 1.0 / (1.001 - saturation));",
			"} else {",
				"gl_FragColor.rgb += (average - gl_FragColor.rgb) * (-saturation);",
			"}",

		"}"

	].join( "\n" )

};

/**
 * @author felixturner / http://airtight.cc/
 *
 * Kaleidoscope Shader
 * Radial reflection around center point
 * Ported from: http://pixelshaders.com/editor/
 * by Toby Schachman / http://tobyschachman.com/
 *
 * sides: number of reflections
 * angle: initial angle in radians
 */

THREE.KaleidoShader = {

	uniforms: {

		"tDiffuse": { value: null },
		"sides":    { value: 6.0 },
		"angle":    { value: 0.0 }

	},

	vertexShader: [

		"varying vec2 vUv;",

		"void main() {",

			"vUv = uv;",
			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join( "\n" ),

	fragmentShader: [

		"uniform sampler2D tDiffuse;",
		"uniform float sides;",
		"uniform float angle;",
		
		"varying vec2 vUv;",

		"void main() {",

			"vec2 p = vUv - 0.5;",
			"float r = length(p);",
			"float a = atan(p.y, p.x) + angle;",
			"float tau = 2. * 3.1416 ;",
			"a = mod(a, tau/sides);",
			"a = abs(a - tau/sides/2.) ;",
			"p = r * vec2(cos(a), sin(a));",
			"vec4 color = texture2D(tDiffuse, p + 0.5);",
			"gl_FragColor = color;",

		"}"

	].join( "\n" )

};

/**
 * @author bhouston / http://clara.io/
 *
 * Luminosity
 * http://en.wikipedia.org/wiki/Luminosity
 */

THREE.LuminosityHighPassShader = {

  shaderID: "luminosityHighPass",

	uniforms: {

		"tDiffuse": { type: "t", value: null },
		"luminosityThreshold": { type: "f", value: 1.0 },
		"smoothWidth": { type: "f", value: 1.0 },
		"defaultColor": { type: "c", value: new THREE.Color( 0x000000 ) },
		"defaultOpacity":  { type: "f", value: 0.0 }

	},

	vertexShader: [

		"varying vec2 vUv;",

		"void main() {",

			"vUv = uv;",

			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join("\n"),

	fragmentShader: [

		"uniform sampler2D tDiffuse;",
		"uniform vec3 defaultColor;",
		"uniform float defaultOpacity;",
		"uniform float luminosityThreshold;",
		"uniform float smoothWidth;",

		"varying vec2 vUv;",

		"void main() {",

			"vec4 texel = texture2D( tDiffuse, vUv );",

			"vec3 luma = vec3( 0.299, 0.587, 0.114 );",

			"float v = dot( texel.xyz, luma );",

			"vec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );",

			"float alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );",

			"gl_FragColor = mix( outputColor, texel, alpha );",

		"}"

	].join("\n")

};

/**
 * @author alteredq / http://alteredqualia.com/
 *
 * Luminosity
 * http://en.wikipedia.org/wiki/Luminosity
 */

THREE.LuminosityShader = {

	uniforms: {

		"tDiffuse": { value: null }

	},

	vertexShader: [

		"varying vec2 vUv;",

		"void main() {",

			"vUv = uv;",

			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join( "\n" ),

	fragmentShader: [

		"uniform sampler2D tDiffuse;",

		"varying vec2 vUv;",

		"void main() {",

			"vec4 texel = texture2D( tDiffuse, vUv );",

			"vec3 luma = vec3( 0.299, 0.587, 0.114 );",

			"float v = dot( texel.xyz, luma );",

			"gl_FragColor = vec4( v, v, v, texel.w );",

		"}"

	].join( "\n" )

};

/**
 * @author felixturner / http://airtight.cc/
 *
 * Mirror Shader
 * Copies half the input to the other half
 *
 * side: side of input to mirror (0 = left, 1 = right, 2 = top, 3 = bottom)
 */

THREE.MirrorShader = {

	uniforms: {

		"tDiffuse": { value: null },
		"side":     { value: 1 }

	},

	vertexShader: [

		"varying vec2 vUv;",

		"void main() {",

			"vUv = uv;",
			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join( "\n" ),

	fragmentShader: [

		"uniform sampler2D tDiffuse;",
		"uniform int side;",
		
		"varying vec2 vUv;",

		"void main() {",

			"vec2 p = vUv;",
			"if (side == 0){",
				"if (p.x > 0.5) p.x = 1.0 - p.x;",
			"}else if (side == 1){",
				"if (p.x < 0.5) p.x = 1.0 - p.x;",
			"}else if (side == 2){",
				"if (p.y < 0.5) p.y = 1.0 - p.y;",
			"}else if (side == 3){",
				"if (p.y > 0.5) p.y = 1.0 - p.y;",
			"} ",
			"vec4 color = texture2D(tDiffuse, p);",
			"gl_FragColor = color;",

		"}"

	].join( "\n" )

};

/**
 * @author alteredq / http://alteredqualia.com/
 *
 * Normal map shader
 * - compute normals from heightmap
 */

THREE.NormalMapShader = {

	uniforms: {

		"heightMap":  { value: null },
		"resolution": { value: new THREE.Vector2( 512, 512 ) },
		"scale":      { value: new THREE.Vector2( 1, 1 ) },
		"height":     { value: 0.05 }

	},

	vertexShader: [

		"varying vec2 vUv;",

		"void main() {",

			"vUv = uv;",
			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join( "\n" ),

	fragmentShader: [

		"uniform float height;",
		"uniform vec2 resolution;",
		"uniform sampler2D heightMap;",

		"varying vec2 vUv;",

		"void main() {",

			"float val = texture2D( heightMap, vUv ).x;",

			"float valU = texture2D( heightMap, vUv + vec2( 1.0 / resolution.x, 0.0 ) ).x;",
			"float valV = texture2D( heightMap, vUv + vec2( 0.0, 1.0 / resolution.y ) ).x;",

			"gl_FragColor = vec4( ( 0.5 * normalize( vec3( val - valU, val - valV, height  ) ) + 0.5 ), 1.0 );",

		"}"

	].join( "\n" )

};

// Author: Aleksandr Albert
// Website: www.routter.co.tt

// Description: A deep water ocean shader set
// based on an implementation of a Tessendorf Waves
// originally presented by David Li ( www.david.li/waves )

// The general method is to apply shaders to simulation Framebuffers
// and then sample these framebuffers when rendering the ocean mesh

// The set uses 7 shaders:

// -- Simulation shaders
// [1] ocean_sim_vertex         -> Vertex shader used to set up a 2x2 simulation plane centered at (0,0)
// [2] ocean_subtransform       -> Fragment shader used to subtransform the mesh (generates the displacement map)
// [3] ocean_initial_spectrum   -> Fragment shader used to set intitial wave frequency at a texel coordinate
// [4] ocean_phase              -> Fragment shader used to set wave phase at a texel coordinate
// [5] ocean_spectrum           -> Fragment shader used to set current wave frequency at a texel coordinate
// [6] ocean_normal             -> Fragment shader used to set face normals at a texel coordinate

// -- Rendering Shader
// [7] ocean_main               -> Vertex and Fragment shader used to create the final render


THREE.ShaderLib[ 'ocean_sim_vertex' ] = {
	vertexShader: [
		'varying vec2 vUV;',

		'void main (void) {',
			'vUV = position.xy * 0.5 + 0.5;',
			'gl_Position = vec4(position, 1.0 );',
		'}'
	].join( '\n' )
};
THREE.ShaderLib[ 'ocean_subtransform' ] = {
	uniforms: {
		"u_input": { value: null },
		"u_transformSize": { value: 512.0 },
		"u_subtransformSize": { value: 250.0 }
	},
	fragmentShader: [
		//GPU FFT using a Stockham formulation

		'precision highp float;',
		'#include <common>',

		'uniform sampler2D u_input;',
		'uniform float u_transformSize;',
		'uniform float u_subtransformSize;',

		'varying vec2 vUV;',

		'vec2 multiplyComplex (vec2 a, vec2 b) {',
			'return vec2(a[0] * b[0] - a[1] * b[1], a[1] * b[0] + a[0] * b[1]);',
		'}',

		'void main (void) {',
			'#ifdef HORIZONTAL',
			'float index = vUV.x * u_transformSize - 0.5;',
			'#else',
			'float index = vUV.y * u_transformSize - 0.5;',
			'#endif',

			'float evenIndex = floor(index / u_subtransformSize) * (u_subtransformSize * 0.5) + mod(index, u_subtransformSize * 0.5);',

			//transform two complex sequences simultaneously
			'#ifdef HORIZONTAL',
			'vec4 even = texture2D(u_input, vec2(evenIndex + 0.5, gl_FragCoord.y) / u_transformSize).rgba;',
			'vec4 odd = texture2D(u_input, vec2(evenIndex + u_transformSize * 0.5 + 0.5, gl_FragCoord.y) / u_transformSize).rgba;',
			'#else',
			'vec4 even = texture2D(u_input, vec2(gl_FragCoord.x, evenIndex + 0.5) / u_transformSize).rgba;',
			'vec4 odd = texture2D(u_input, vec2(gl_FragCoord.x, evenIndex + u_transformSize * 0.5 + 0.5) / u_transformSize).rgba;',
			'#endif',

			'float twiddleArgument = -2.0 * PI * (index / u_subtransformSize);',
			'vec2 twiddle = vec2(cos(twiddleArgument), sin(twiddleArgument));',

			'vec2 outputA = even.xy + multiplyComplex(twiddle, odd.xy);',
			'vec2 outputB = even.zw + multiplyComplex(twiddle, odd.zw);',

			'gl_FragColor = vec4(outputA, outputB);',
		'}'
	].join( '\n' )
};
THREE.ShaderLib[ 'ocean_initial_spectrum' ] = {
	uniforms: {
		"u_wind": { value: new THREE.Vector2( 10.0, 10.0 ) },
		"u_resolution": { value: 512.0 },
		"u_size": { value: 250.0 }
	},
	fragmentShader: [
		'precision highp float;',
		'#include <common>',

		'const float G = 9.81;',
		'const float KM = 370.0;',
		'const float CM = 0.23;',

		'uniform vec2 u_wind;',
		'uniform float u_resolution;',
		'uniform float u_size;',

		'float omega (float k) {',
			'return sqrt(G * k * (1.0 + pow2(k / KM)));',
		'}',

		'float tanh (float x) {',
			'return (1.0 - exp(-2.0 * x)) / (1.0 + exp(-2.0 * x));',
		'}',

		'void main (void) {',
			'vec2 coordinates = gl_FragCoord.xy - 0.5;',

			'float n = (coordinates.x < u_resolution * 0.5) ? coordinates.x : coordinates.x - u_resolution;',
			'float m = (coordinates.y < u_resolution * 0.5) ? coordinates.y : coordinates.y - u_resolution;',

			'vec2 K = (2.0 * PI * vec2(n, m)) / u_size;',
			'float k = length(K);',

			'float l_wind = length(u_wind);',

			'float Omega = 0.84;',
			'float kp = G * pow2(Omega / l_wind);',

			'float c = omega(k) / k;',
			'float cp = omega(kp) / kp;',

			'float Lpm = exp(-1.25 * pow2(kp / k));',
			'float gamma = 1.7;',
			'float sigma = 0.08 * (1.0 + 4.0 * pow(Omega, -3.0));',
			'float Gamma = exp(-pow2(sqrt(k / kp) - 1.0) / 2.0 * pow2(sigma));',
			'float Jp = pow(gamma, Gamma);',
			'float Fp = Lpm * Jp * exp(-Omega / sqrt(10.0) * (sqrt(k / kp) - 1.0));',
			'float alphap = 0.006 * sqrt(Omega);',
			'float Bl = 0.5 * alphap * cp / c * Fp;',

			'float z0 = 0.000037 * pow2(l_wind) / G * pow(l_wind / cp, 0.9);',
			'float uStar = 0.41 * l_wind / log(10.0 / z0);',
			'float alpham = 0.01 * ((uStar < CM) ? (1.0 + log(uStar / CM)) : (1.0 + 3.0 * log(uStar / CM)));',
			'float Fm = exp(-0.25 * pow2(k / KM - 1.0));',
			'float Bh = 0.5 * alpham * CM / c * Fm * Lpm;',

			'float a0 = log(2.0) / 4.0;',
			'float am = 0.13 * uStar / CM;',
			'float Delta = tanh(a0 + 4.0 * pow(c / cp, 2.5) + am * pow(CM / c, 2.5));',

			'float cosPhi = dot(normalize(u_wind), normalize(K));',

			'float S = (1.0 / (2.0 * PI)) * pow(k, -4.0) * (Bl + Bh) * (1.0 + Delta * (2.0 * cosPhi * cosPhi - 1.0));',

			'float dk = 2.0 * PI / u_size;',
			'float h = sqrt(S / 2.0) * dk;',

			'if (K.x == 0.0 && K.y == 0.0) {',
				'h = 0.0;', //no DC term
			'}',
			'gl_FragColor = vec4(h, 0.0, 0.0, 0.0);',
		'}'
	].join( '\n' )
};
THREE.ShaderLib[ 'ocean_phase' ] = {
	uniforms: {
		"u_phases": { value: null },
		"u_deltaTime": { value: null },
		"u_resolution": { value: null },
		"u_size": { value: null }
	},
	fragmentShader: [
		'precision highp float;',
		'#include <common>',

		'const float G = 9.81;',
		'const float KM = 370.0;',

		'varying vec2 vUV;',

		'uniform sampler2D u_phases;',
		'uniform float u_deltaTime;',
		'uniform float u_resolution;',
		'uniform float u_size;',

		'float omega (float k) {',
			'return sqrt(G * k * (1.0 + k * k / KM * KM));',
		'}',

		'void main (void) {',
			'float deltaTime = 1.0 / 60.0;',
			'vec2 coordinates = gl_FragCoord.xy - 0.5;',
			'float n = (coordinates.x < u_resolution * 0.5) ? coordinates.x : coordinates.x - u_resolution;',
			'float m = (coordinates.y < u_resolution * 0.5) ? coordinates.y : coordinates.y - u_resolution;',
			'vec2 waveVector = (2.0 * PI * vec2(n, m)) / u_size;',

			'float phase = texture2D(u_phases, vUV).r;',
			'float deltaPhase = omega(length(waveVector)) * u_deltaTime;',
			'phase = mod(phase + deltaPhase, 2.0 * PI);',

			'gl_FragColor = vec4(phase, 0.0, 0.0, 0.0);',
		'}'
	].join( '\n' )
};
THREE.ShaderLib[ 'ocean_spectrum' ] = {
	uniforms: {
		"u_size": { value: null },
		"u_resolution": { value: null },
		"u_choppiness": { value: null },
		"u_phases": { value: null },
		"u_initialSpectrum": { value: null }
	},
	fragmentShader: [
		'precision highp float;',
		'#include <common>',

		'const float G = 9.81;',
		'const float KM = 370.0;',

		'varying vec2 vUV;',

		'uniform float u_size;',
		'uniform float u_resolution;',
		'uniform float u_choppiness;',
		'uniform sampler2D u_phases;',
		'uniform sampler2D u_initialSpectrum;',

		'vec2 multiplyComplex (vec2 a, vec2 b) {',
			'return vec2(a[0] * b[0] - a[1] * b[1], a[1] * b[0] + a[0] * b[1]);',
		'}',

		'vec2 multiplyByI (vec2 z) {',
			'return vec2(-z[1], z[0]);',
		'}',

		'float omega (float k) {',
			'return sqrt(G * k * (1.0 + k * k / KM * KM));',
		'}',

		'void main (void) {',
			'vec2 coordinates = gl_FragCoord.xy - 0.5;',
			'float n = (coordinates.x < u_resolution * 0.5) ? coordinates.x : coordinates.x - u_resolution;',
			'float m = (coordinates.y < u_resolution * 0.5) ? coordinates.y : coordinates.y - u_resolution;',
			'vec2 waveVector = (2.0 * PI * vec2(n, m)) / u_size;',

			'float phase = texture2D(u_phases, vUV).r;',
			'vec2 phaseVector = vec2(cos(phase), sin(phase));',

			'vec2 h0 = texture2D(u_initialSpectrum, vUV).rg;',
			'vec2 h0Star = texture2D(u_initialSpectrum, vec2(1.0 - vUV + 1.0 / u_resolution)).rg;',
			'h0Star.y *= -1.0;',

			'vec2 h = multiplyComplex(h0, phaseVector) + multiplyComplex(h0Star, vec2(phaseVector.x, -phaseVector.y));',

			'vec2 hX = -multiplyByI(h * (waveVector.x / length(waveVector))) * u_choppiness;',
			'vec2 hZ = -multiplyByI(h * (waveVector.y / length(waveVector))) * u_choppiness;',

			//no DC term
			'if (waveVector.x == 0.0 && waveVector.y == 0.0) {',
				'h = vec2(0.0);',
				'hX = vec2(0.0);',
				'hZ = vec2(0.0);',
			'}',

			'gl_FragColor = vec4(hX + multiplyByI(h), hZ);',
		'}'
	].join( '\n' )
};
THREE.ShaderLib[ 'ocean_normals' ] = {
	uniforms: {
		"u_displacementMap": { value: null },
		"u_resolution": { value: null },
		"u_size": { value: null }
	},
	fragmentShader: [
		'precision highp float;',

		'varying vec2 vUV;',

		'uniform sampler2D u_displacementMap;',
		'uniform float u_resolution;',
		'uniform float u_size;',

		'void main (void) {',
			'float texel = 1.0 / u_resolution;',
			'float texelSize = u_size / u_resolution;',

			'vec3 center = texture2D(u_displacementMap, vUV).rgb;',
			'vec3 right = vec3(texelSize, 0.0, 0.0) + texture2D(u_displacementMap, vUV + vec2(texel, 0.0)).rgb - center;',
			'vec3 left = vec3(-texelSize, 0.0, 0.0) + texture2D(u_displacementMap, vUV + vec2(-texel, 0.0)).rgb - center;',
			'vec3 top = vec3(0.0, 0.0, -texelSize) + texture2D(u_displacementMap, vUV + vec2(0.0, -texel)).rgb - center;',
			'vec3 bottom = vec3(0.0, 0.0, texelSize) + texture2D(u_displacementMap, vUV + vec2(0.0, texel)).rgb - center;',

			'vec3 topRight = cross(right, top);',
			'vec3 topLeft = cross(top, left);',
			'vec3 bottomLeft = cross(left, bottom);',
			'vec3 bottomRight = cross(bottom, right);',

			'gl_FragColor = vec4(normalize(topRight + topLeft + bottomLeft + bottomRight), 1.0);',
		'}'
	].join( '\n' )
};
THREE.ShaderLib[ 'ocean_main' ] = {
	uniforms: {
		"u_displacementMap": { value: null },
		"u_normalMap": { value: null },
		"u_geometrySize": { value: null },
		"u_size": { value: null },
		"u_projectionMatrix": { value: null },
		"u_viewMatrix": { value: null },
		"u_cameraPosition": { value: null },
		"u_skyColor": { value: null },
		"u_oceanColor": { value: null },
		"u_sunDirection": { value: null },
		"u_exposure": { value: null }
	},
	vertexShader: [
		'precision highp float;',

		'varying vec3 vPos;',
		'varying vec2 vUV;',

		'uniform mat4 u_projectionMatrix;',
		'uniform mat4 u_viewMatrix;',
		'uniform float u_size;',
		'uniform float u_geometrySize;',
		'uniform sampler2D u_displacementMap;',

		'void main (void) {',
			'vec3 newPos = position + texture2D(u_displacementMap, uv).rgb * (u_geometrySize / u_size);',
			'vPos = newPos;',
			'vUV = uv;',
			'gl_Position = u_projectionMatrix * u_viewMatrix * vec4(newPos, 1.0);',
		'}'
	].join( '\n' ),
	fragmentShader: [
		'precision highp float;',

		'varying vec3 vPos;',
		'varying vec2 vUV;',

		'uniform sampler2D u_displacementMap;',
		'uniform sampler2D u_normalMap;',
		'uniform vec3 u_cameraPosition;',
		'uniform vec3 u_oceanColor;',
		'uniform vec3 u_skyColor;',
		'uniform vec3 u_sunDirection;',
		'uniform float u_exposure;',

		'vec3 hdr (vec3 color, float exposure) {',
			'return 1.0 - exp(-color * exposure);',
		'}',

		'void main (void) {',
			'vec3 normal = texture2D(u_normalMap, vUV).rgb;',

			'vec3 view = normalize(u_cameraPosition - vPos);',
			'float fresnel = 0.02 + 0.98 * pow(1.0 - dot(normal, view), 5.0);',
			'vec3 sky = fresnel * u_skyColor;',

			'float diffuse = clamp(dot(normal, normalize(u_sunDirection)), 0.0, 1.0);',
			'vec3 water = (1.0 - fresnel) * u_oceanColor * u_skyColor * diffuse;',

			'vec3 color = sky + water;',

			'gl_FragColor = vec4(hdr(color, u_exposure), 1.0);',
		'}'
	].join( '\n' )
};

// Parallax Occlusion shaders from
//    http://sunandblackcat.com/tipFullView.php?topicid=28
// No tangent-space transforms logic based on
//   http://mmikkelsen3d.blogspot.sk/2012/02/parallaxpoc-mapping-and-no-tangent.html

THREE.ParallaxShader = {
	// Ordered from fastest to best quality.
	modes: {
		none:  'NO_PARALLAX',
		basic: 'USE_BASIC_PARALLAX',
		steep: 'USE_STEEP_PARALLAX',
		occlusion: 'USE_OCLUSION_PARALLAX', // a.k.a. POM
		relief: 'USE_RELIEF_PARALLAX'
	},

	uniforms: {
		"bumpMap": { value: null },
		"map": { value: null },
		"parallaxScale": { value: null },
		"parallaxMinLayers": { value: null },
		"parallaxMaxLayers": { value: null }
	},

	vertexShader: [
		"varying vec2 vUv;",
		"varying vec3 vViewPosition;",
		"varying vec3 vNormal;",

		"void main() {",

			"vUv = uv;",
			"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",
			"vViewPosition = -mvPosition.xyz;",
			"vNormal = normalize( normalMatrix * normal );",
			"gl_Position = projectionMatrix * mvPosition;",

		"}"

  ].join( "\n" ),

	fragmentShader: [
		"uniform sampler2D bumpMap;",
		"uniform sampler2D map;",

		"uniform float parallaxScale;",
		"uniform float parallaxMinLayers;",
		"uniform float parallaxMaxLayers;",

		"varying vec2 vUv;",
		"varying vec3 vViewPosition;",
		"varying vec3 vNormal;",

		"#ifdef USE_BASIC_PARALLAX",

			"vec2 parallaxMap( in vec3 V ) {",

				"float initialHeight = texture2D( bumpMap, vUv ).r;",

				// No Offset Limitting: messy, floating output at grazing angles.
				//"vec2 texCoordOffset = parallaxScale * V.xy / V.z * initialHeight;",

				// Offset Limiting
				"vec2 texCoordOffset = parallaxScale * V.xy * initialHeight;",
				"return vUv - texCoordOffset;",

			"}",

		"#else",

			"vec2 parallaxMap( in vec3 V ) {",

				// Determine number of layers from angle between V and N
				"float numLayers = mix( parallaxMaxLayers, parallaxMinLayers, abs( dot( vec3( 0.0, 0.0, 1.0 ), V ) ) );",

				"float layerHeight = 1.0 / numLayers;",
				"float currentLayerHeight = 0.0;",
				// Shift of texture coordinates for each iteration
				"vec2 dtex = parallaxScale * V.xy / V.z / numLayers;",

				"vec2 currentTextureCoords = vUv;",

				"float heightFromTexture = texture2D( bumpMap, currentTextureCoords ).r;",

				// while ( heightFromTexture > currentLayerHeight )
				// Infinite loops are not well supported. Do a "large" finite
				// loop, but not too large, as it slows down some compilers.
				"for ( int i = 0; i < 30; i += 1 ) {",
					"if ( heightFromTexture <= currentLayerHeight ) {",
						"break;",
					"}",
					"currentLayerHeight += layerHeight;",
					// Shift texture coordinates along vector V
					"currentTextureCoords -= dtex;",
					"heightFromTexture = texture2D( bumpMap, currentTextureCoords ).r;",
				"}",

				"#ifdef USE_STEEP_PARALLAX",

					"return currentTextureCoords;",

				"#elif defined( USE_RELIEF_PARALLAX )",

					"vec2 deltaTexCoord = dtex / 2.0;",
					"float deltaHeight = layerHeight / 2.0;",

					// Return to the mid point of previous layer
					"currentTextureCoords += deltaTexCoord;",
					"currentLayerHeight -= deltaHeight;",

					// Binary search to increase precision of Steep Parallax Mapping
					"const int numSearches = 5;",
					"for ( int i = 0; i < numSearches; i += 1 ) {",

						"deltaTexCoord /= 2.0;",
						"deltaHeight /= 2.0;",
						"heightFromTexture = texture2D( bumpMap, currentTextureCoords ).r;",
						// Shift along or against vector V
						"if( heightFromTexture > currentLayerHeight ) {", // Below the surface

							"currentTextureCoords -= deltaTexCoord;",
							"currentLayerHeight += deltaHeight;",

						"} else {", // above the surface

							"currentTextureCoords += deltaTexCoord;",
							"currentLayerHeight -= deltaHeight;",

						"}",

					"}",
					"return currentTextureCoords;",

				"#elif defined( USE_OCLUSION_PARALLAX )",

					"vec2 prevTCoords = currentTextureCoords + dtex;",

					// Heights for linear interpolation
					"float nextH = heightFromTexture - currentLayerHeight;",
					"float prevH = texture2D( bumpMap, prevTCoords ).r - currentLayerHeight + layerHeight;",

					// Proportions for linear interpolation
					"float weight = nextH / ( nextH - prevH );",

					// Interpolation of texture coordinates
					"return prevTCoords * weight + currentTextureCoords * ( 1.0 - weight );",

				"#else", // NO_PARALLAX

					"return vUv;",

				"#endif",

			"}",
		"#endif",

		"vec2 perturbUv( vec3 surfPosition, vec3 surfNormal, vec3 viewPosition ) {",

 			"vec2 texDx = dFdx( vUv );",
			"vec2 texDy = dFdy( vUv );",

			"vec3 vSigmaX = dFdx( surfPosition );",
			"vec3 vSigmaY = dFdy( surfPosition );",
			"vec3 vR1 = cross( vSigmaY, surfNormal );",
			"vec3 vR2 = cross( surfNormal, vSigmaX );",
			"float fDet = dot( vSigmaX, vR1 );",

			"vec2 vProjVscr = ( 1.0 / fDet ) * vec2( dot( vR1, viewPosition ), dot( vR2, viewPosition ) );",
			"vec3 vProjVtex;",
			"vProjVtex.xy = texDx * vProjVscr.x + texDy * vProjVscr.y;",
			"vProjVtex.z = dot( surfNormal, viewPosition );",

			"return parallaxMap( vProjVtex );",
		"}",

		"void main() {",

			"vec2 mapUv = perturbUv( -vViewPosition, normalize( vNormal ), normalize( vViewPosition ) );",
			"gl_FragColor = texture2D( map, mapUv );",

		"}"

  ].join( "\n" )

};

/**
 * @author felixturner / http://airtight.cc/
 *
 * RGB Shift Shader
 * Shifts red and blue channels from center in opposite directions
 * Ported from http://kriss.cx/tom/2009/05/rgb-shift/
 * by Tom Butterworth / http://kriss.cx/tom/
 *
 * amount: shift distance (1 is width of input)
 * angle: shift angle in radians
 */

THREE.RGBShiftShader = {

	uniforms: {

		"tDiffuse": { value: null },
		"amount":   { value: 0.005 },
		"angle":    { value: 0.0 }

	},

	vertexShader: [

		"varying vec2 vUv;",

		"void main() {",

			"vUv = uv;",
			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join( "\n" ),

	fragmentShader: [

		"uniform sampler2D tDiffuse;",
		"uniform float amount;",
		"uniform float angle;",

		"varying vec2 vUv;",

		"void main() {",

			"vec2 offset = amount * vec2( cos(angle), sin(angle));",
			"vec4 cr = texture2D(tDiffuse, vUv + offset);",
			"vec4 cga = texture2D(tDiffuse, vUv);",
			"vec4 cb = texture2D(tDiffuse, vUv - offset);",
			"gl_FragColor = vec4(cr.r, cga.g, cb.b, cga.a);",

		"}"

	].join( "\n" )

};

/**
 * @author mpk / http://polko.me/
 *
 * WebGL port of Subpixel Morphological Antialiasing (SMAA) v2.8
 * Preset: SMAA 1x Medium (with color edge detection)
 * https://github.com/iryoku/smaa/releases/tag/v2.8
 */

THREE.SMAAShader = [ {

	defines: {

		"SMAA_THRESHOLD": "0.1"

	},

	uniforms: {

		"tDiffuse":		{ value: null },
		"resolution":	{ value: new THREE.Vector2( 1 / 1024, 1 / 512 ) }

	},

	vertexShader: [

		"uniform vec2 resolution;",

		"varying vec2 vUv;",
		"varying vec4 vOffset[ 3 ];",

		"void SMAAEdgeDetectionVS( vec2 texcoord ) {",
			"vOffset[ 0 ] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0,  1.0 );", // WebGL port note: Changed sign in W component
			"vOffset[ 1 ] = texcoord.xyxy + resolution.xyxy * vec4(  1.0, 0.0, 0.0, -1.0 );", // WebGL port note: Changed sign in W component
			"vOffset[ 2 ] = texcoord.xyxy + resolution.xyxy * vec4( -2.0, 0.0, 0.0,  2.0 );", // WebGL port note: Changed sign in W component
		"}",

		"void main() {",

			"vUv = uv;",

			"SMAAEdgeDetectionVS( vUv );",

			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join("\n"),

	fragmentShader: [

		"uniform sampler2D tDiffuse;",

		"varying vec2 vUv;",
		"varying vec4 vOffset[ 3 ];",

		"vec4 SMAAColorEdgeDetectionPS( vec2 texcoord, vec4 offset[3], sampler2D colorTex ) {",
			"vec2 threshold = vec2( SMAA_THRESHOLD, SMAA_THRESHOLD );",

			// Calculate color deltas:
			"vec4 delta;",
			"vec3 C = texture2D( colorTex, texcoord ).rgb;",

			"vec3 Cleft = texture2D( colorTex, offset[0].xy ).rgb;",
			"vec3 t = abs( C - Cleft );",
			"delta.x = max( max( t.r, t.g ), t.b );",

			"vec3 Ctop = texture2D( colorTex, offset[0].zw ).rgb;",
			"t = abs( C - Ctop );",
			"delta.y = max( max( t.r, t.g ), t.b );",

			// We do the usual threshold:
			"vec2 edges = step( threshold, delta.xy );",

			// Then discard if there is no edge:
			"if ( dot( edges, vec2( 1.0, 1.0 ) ) == 0.0 )",
				"discard;",

			// Calculate right and bottom deltas:
			"vec3 Cright = texture2D( colorTex, offset[1].xy ).rgb;",
			"t = abs( C - Cright );",
			"delta.z = max( max( t.r, t.g ), t.b );",

			"vec3 Cbottom  = texture2D( colorTex, offset[1].zw ).rgb;",
			"t = abs( C - Cbottom );",
			"delta.w = max( max( t.r, t.g ), t.b );",

			// Calculate the maximum delta in the direct neighborhood:
			"float maxDelta = max( max( max( delta.x, delta.y ), delta.z ), delta.w );",

			// Calculate left-left and top-top deltas:
			"vec3 Cleftleft  = texture2D( colorTex, offset[2].xy ).rgb;",
			"t = abs( C - Cleftleft );",
			"delta.z = max( max( t.r, t.g ), t.b );",

			"vec3 Ctoptop = texture2D( colorTex, offset[2].zw ).rgb;",
			"t = abs( C - Ctoptop );",
			"delta.w = max( max( t.r, t.g ), t.b );",

			// Calculate the final maximum delta:
			"maxDelta = max( max( maxDelta, delta.z ), delta.w );",

			// Local contrast adaptation in action:
			"edges.xy *= step( 0.5 * maxDelta, delta.xy );",

			"return vec4( edges, 0.0, 0.0 );",
		"}",

		"void main() {",

			"gl_FragColor = SMAAColorEdgeDetectionPS( vUv, vOffset, tDiffuse );",

		"}"

	].join("\n")

}, {

	defines: {

		"SMAA_MAX_SEARCH_STEPS":		"8",
		"SMAA_AREATEX_MAX_DISTANCE":	"16",
		"SMAA_AREATEX_PIXEL_SIZE":		"( 1.0 / vec2( 160.0, 560.0 ) )",
		"SMAA_AREATEX_SUBTEX_SIZE":		"( 1.0 / 7.0 )"

	},

	uniforms: {

		"tDiffuse":		{ value: null },
		"tArea":		{ value: null },
		"tSearch":		{ value: null },
		"resolution":	{ value: new THREE.Vector2( 1 / 1024, 1 / 512 ) }

	},

	vertexShader: [

		"uniform vec2 resolution;",

		"varying vec2 vUv;",
		"varying vec4 vOffset[ 3 ];",
		"varying vec2 vPixcoord;",

		"void SMAABlendingWeightCalculationVS( vec2 texcoord ) {",
			"vPixcoord = texcoord / resolution;",

			// We will use these offsets for the searches later on (see @PSEUDO_GATHER4):
			"vOffset[ 0 ] = texcoord.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );", // WebGL port note: Changed sign in Y and W components
			"vOffset[ 1 ] = texcoord.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );", // WebGL port note: Changed sign in Y and W components

			// And these for the searches, they indicate the ends of the loops:
			"vOffset[ 2 ] = vec4( vOffset[ 0 ].xz, vOffset[ 1 ].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( SMAA_MAX_SEARCH_STEPS );",

		"}",

		"void main() {",

			"vUv = uv;",

			"SMAABlendingWeightCalculationVS( vUv );",

			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join("\n"),

	fragmentShader: [

		"#define SMAASampleLevelZeroOffset( tex, coord, offset ) texture2D( tex, coord + float( offset ) * resolution, 0.0 )",

		"uniform sampler2D tDiffuse;",
		"uniform sampler2D tArea;",
		"uniform sampler2D tSearch;",
		"uniform vec2 resolution;",

		"varying vec2 vUv;",
		"varying vec4 vOffset[3];",
		"varying vec2 vPixcoord;",

		"vec2 round( vec2 x ) {",
			"return sign( x ) * floor( abs( x ) + 0.5 );",
		"}",

		"float SMAASearchLength( sampler2D searchTex, vec2 e, float bias, float scale ) {",
			// Not required if searchTex accesses are set to point:
			// float2 SEARCH_TEX_PIXEL_SIZE = 1.0 / float2(66.0, 33.0);
			// e = float2(bias, 0.0) + 0.5 * SEARCH_TEX_PIXEL_SIZE +
			//     e * float2(scale, 1.0) * float2(64.0, 32.0) * SEARCH_TEX_PIXEL_SIZE;
			"e.r = bias + e.r * scale;",
			"return 255.0 * texture2D( searchTex, e, 0.0 ).r;",
		"}",

		"float SMAASearchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {",
			/**
			* @PSEUDO_GATHER4
			* This texcoord has been offset by (-0.25, -0.125) in the vertex shader to
			* sample between edge, thus fetching four edges in a row.
			* Sampling with different offsets in each direction allows to disambiguate
			* which edges are active from the four fetched ones.
			*/
			"vec2 e = vec2( 0.0, 1.0 );",

			"for ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) {", // WebGL port note: Changed while to for
				"e = texture2D( edgesTex, texcoord, 0.0 ).rg;",
				"texcoord -= vec2( 2.0, 0.0 ) * resolution;",
				"if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;",
			"}",

			// We correct the previous (-0.25, -0.125) offset we applied:
			"texcoord.x += 0.25 * resolution.x;",

			// The searches are bias by 1, so adjust the coords accordingly:
			"texcoord.x += resolution.x;",

			// Disambiguate the length added by the last step:
			"texcoord.x += 2.0 * resolution.x;", // Undo last step
			"texcoord.x -= resolution.x * SMAASearchLength(searchTex, e, 0.0, 0.5);",

			"return texcoord.x;",
		"}",

		"float SMAASearchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {",
			"vec2 e = vec2( 0.0, 1.0 );",

			"for ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) {", // WebGL port note: Changed while to for
				"e = texture2D( edgesTex, texcoord, 0.0 ).rg;",
				"texcoord += vec2( 2.0, 0.0 ) * resolution;",
				"if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;",
			"}",

			"texcoord.x -= 0.25 * resolution.x;",
			"texcoord.x -= resolution.x;",
			"texcoord.x -= 2.0 * resolution.x;",
			"texcoord.x += resolution.x * SMAASearchLength( searchTex, e, 0.5, 0.5 );",

			"return texcoord.x;",
		"}",

		"float SMAASearchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {",
			"vec2 e = vec2( 1.0, 0.0 );",

			"for ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) {", // WebGL port note: Changed while to for
				"e = texture2D( edgesTex, texcoord, 0.0 ).rg;",
				"texcoord += vec2( 0.0, 2.0 ) * resolution;", // WebGL port note: Changed sign
				"if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;",
			"}",

			"texcoord.y -= 0.25 * resolution.y;", // WebGL port note: Changed sign
			"texcoord.y -= resolution.y;", // WebGL port note: Changed sign
			"texcoord.y -= 2.0 * resolution.y;", // WebGL port note: Changed sign
			"texcoord.y += resolution.y * SMAASearchLength( searchTex, e.gr, 0.0, 0.5 );", // WebGL port note: Changed sign

			"return texcoord.y;",
		"}",

		"float SMAASearchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {",
			"vec2 e = vec2( 1.0, 0.0 );",

			"for ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) {", // WebGL port note: Changed while to for
				"e = texture2D( edgesTex, texcoord, 0.0 ).rg;",
				"texcoord -= vec2( 0.0, 2.0 ) * resolution;", // WebGL port note: Changed sign
				"if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;",
			"}",

			"texcoord.y += 0.25 * resolution.y;", // WebGL port note: Changed sign
			"texcoord.y += resolution.y;", // WebGL port note: Changed sign
			"texcoord.y += 2.0 * resolution.y;", // WebGL port note: Changed sign
			"texcoord.y -= resolution.y * SMAASearchLength( searchTex, e.gr, 0.5, 0.5 );", // WebGL port note: Changed sign

			"return texcoord.y;",
		"}",

		"vec2 SMAAArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {",
			// Rounding prevents precision errors of bilinear filtering:
			"vec2 texcoord = float( SMAA_AREATEX_MAX_DISTANCE ) * round( 4.0 * vec2( e1, e2 ) ) + dist;",

			// We do a scale and bias for mapping to texel space:
			"texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );",

			// Move to proper place, according to the subpixel offset:
			"texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;",

			"return texture2D( areaTex, texcoord, 0.0 ).rg;",
		"}",

		"vec4 SMAABlendingWeightCalculationPS( vec2 texcoord, vec2 pixcoord, vec4 offset[ 3 ], sampler2D edgesTex, sampler2D areaTex, sampler2D searchTex, ivec4 subsampleIndices ) {",
			"vec4 weights = vec4( 0.0, 0.0, 0.0, 0.0 );",

			"vec2 e = texture2D( edgesTex, texcoord ).rg;",

			"if ( e.g > 0.0 ) {", // Edge at north
				"vec2 d;",

				// Find the distance to the left:
				"vec2 coords;",
				"coords.x = SMAASearchXLeft( edgesTex, searchTex, offset[ 0 ].xy, offset[ 2 ].x );",
				"coords.y = offset[ 1 ].y;", // offset[1].y = texcoord.y - 0.25 * resolution.y (@CROSSING_OFFSET)
				"d.x = coords.x;",

				// Now fetch the left crossing edges, two at a time using bilinear
				// filtering. Sampling at -0.25 (see @CROSSING_OFFSET) enables to
				// discern what value each edge has:
				"float e1 = texture2D( edgesTex, coords, 0.0 ).r;",

				// Find the distance to the right:
				"coords.x = SMAASearchXRight( edgesTex, searchTex, offset[ 0 ].zw, offset[ 2 ].y );",
				"d.y = coords.x;",

				// We want the distances to be in pixel units (doing this here allow to
				// better interleave arithmetic and memory accesses):
				"d = d / resolution.x - pixcoord.x;",

				// SMAAArea below needs a sqrt, as the areas texture is compressed
				// quadratically:
				"vec2 sqrt_d = sqrt( abs( d ) );",

				// Fetch the right crossing edges:
				"coords.y -= 1.0 * resolution.y;", // WebGL port note: Added
				"float e2 = SMAASampleLevelZeroOffset( edgesTex, coords, ivec2( 1, 0 ) ).r;",

				// Ok, we know how this pattern looks like, now it is time for getting
				// the actual area:
				"weights.rg = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.y ) );",
			"}",

			"if ( e.r > 0.0 ) {", // Edge at west
				"vec2 d;",

				// Find the distance to the top:
				"vec2 coords;",

				"coords.y = SMAASearchYUp( edgesTex, searchTex, offset[ 1 ].xy, offset[ 2 ].z );",
				"coords.x = offset[ 0 ].x;", // offset[1].x = texcoord.x - 0.25 * resolution.x;
				"d.x = coords.y;",

				// Fetch the top crossing edges:
				"float e1 = texture2D( edgesTex, coords, 0.0 ).g;",

				// Find the distance to the bottom:
				"coords.y = SMAASearchYDown( edgesTex, searchTex, offset[ 1 ].zw, offset[ 2 ].w );",
				"d.y = coords.y;",

				// We want the distances to be in pixel units:
				"d = d / resolution.y - pixcoord.y;",

				// SMAAArea below needs a sqrt, as the areas texture is compressed
				// quadratically:
				"vec2 sqrt_d = sqrt( abs( d ) );",

				// Fetch the bottom crossing edges:
				"coords.y -= 1.0 * resolution.y;", // WebGL port note: Added
				"float e2 = SMAASampleLevelZeroOffset( edgesTex, coords, ivec2( 0, 1 ) ).g;",

				// Get the area for this direction:
				"weights.ba = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.x ) );",
			"}",

			"return weights;",
		"}",

		"void main() {",

			"gl_FragColor = SMAABlendingWeightCalculationPS( vUv, vPixcoord, vOffset, tDiffuse, tArea, tSearch, ivec4( 0.0 ) );",

		"}"

	].join("\n")

}, {

	uniforms: {

		"tDiffuse":		{ value: null },
		"tColor":		{ value: null },
		"resolution":	{ value: new THREE.Vector2( 1 / 1024, 1 / 512 ) }

	},

	vertexShader: [

		"uniform vec2 resolution;",

		"varying vec2 vUv;",
		"varying vec4 vOffset[ 2 ];",

		"void SMAANeighborhoodBlendingVS( vec2 texcoord ) {",
			"vOffset[ 0 ] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0, 1.0 );", // WebGL port note: Changed sign in W component
			"vOffset[ 1 ] = texcoord.xyxy + resolution.xyxy * vec4( 1.0, 0.0, 0.0, -1.0 );", // WebGL port note: Changed sign in W component
		"}",

		"void main() {",

			"vUv = uv;",

			"SMAANeighborhoodBlendingVS( vUv );",

			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join("\n"),

	fragmentShader: [

		"uniform sampler2D tDiffuse;",
		"uniform sampler2D tColor;",
		"uniform vec2 resolution;",

		"varying vec2 vUv;",
		"varying vec4 vOffset[ 2 ];",

		"vec4 SMAANeighborhoodBlendingPS( vec2 texcoord, vec4 offset[ 2 ], sampler2D colorTex, sampler2D blendTex ) {",
			// Fetch the blending weights for current pixel:
			"vec4 a;",
			"a.xz = texture2D( blendTex, texcoord ).xz;",
			"a.y = texture2D( blendTex, offset[ 1 ].zw ).g;",
			"a.w = texture2D( blendTex, offset[ 1 ].xy ).a;",

			// Is there any blending weight with a value greater than 0.0?
			"if ( dot(a, vec4( 1.0, 1.0, 1.0, 1.0 )) < 1e-5 ) {",
				"return texture2D( colorTex, texcoord, 0.0 );",
			"} else {",
				// Up to 4 lines can be crossing a pixel (one through each edge). We
				// favor blending by choosing the line with the maximum weight for each
				// direction:
				"vec2 offset;",
				"offset.x = a.a > a.b ? a.a : -a.b;", // left vs. right
				"offset.y = a.g > a.r ? -a.g : a.r;", // top vs. bottom // WebGL port note: Changed signs

				// Then we go in the direction that has the maximum weight:
				"if ( abs( offset.x ) > abs( offset.y )) {", // horizontal vs. vertical
					"offset.y = 0.0;",
				"} else {",
					"offset.x = 0.0;",
				"}",

				// Fetch the opposite color and lerp by hand:
				"vec4 C = texture2D( colorTex, texcoord, 0.0 );",
				"texcoord += sign( offset ) * resolution;",
				"vec4 Cop = texture2D( colorTex, texcoord, 0.0 );",
				"float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );",

				// WebGL port note: Added gamma correction
				"C.xyz = pow(C.xyz, vec3(2.2));",
				"Cop.xyz = pow(Cop.xyz, vec3(2.2));",
				"vec4 mixed = mix(C, Cop, s);",
				"mixed.xyz = pow(mixed.xyz, vec3(1.0 / 2.2));",

				"return mixed;",
			"}",
		"}",

		"void main() {",

			"gl_FragColor = SMAANeighborhoodBlendingPS( vUv, vOffset, tColor, tDiffuse );",

		"}"

	].join("\n")

} ];

/**
 * @author alteredq / http://alteredqualia.com/
 *
 * Screen-space ambient occlusion shader
 * - ported from
 *   SSAO GLSL shader v1.2
 *   assembled by Martins Upitis (martinsh) (http://devlog-martinsh.blogspot.com)
 *   original technique is made by ArKano22 (http://www.gamedev.net/topic/550699-ssao-no-halo-artifacts/)
 * - modifications
 * - modified to use RGBA packed depth texture (use clear color 1,1,1,1 for depth pass)
 * - refactoring and optimizations
 */

THREE.SSAOShader = {

	uniforms: {

		"tDiffuse":     { value: null },
		"tDepth":       { value: null },
		"size":         { value: new THREE.Vector2( 512, 512 ) },
		"cameraNear":   { value: 1 },
		"cameraFar":    { value: 100 },
		"onlyAO":       { value: 0 },
		"aoClamp":      { value: 0.5 },
		"lumInfluence": { value: 0.5 }

	},

	vertexShader: [

		"varying vec2 vUv;",

		"void main() {",

			"vUv = uv;",

			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join( "\n" ),

	fragmentShader: [

		"uniform float cameraNear;",
		"uniform float cameraFar;",
		"#ifdef USE_LOGDEPTHBUF",
			"uniform float logDepthBufFC;",
		"#endif",

		"uniform bool onlyAO;",      // use only ambient occlusion pass?

		"uniform vec2 size;",        // texture width, height
		"uniform float aoClamp;",    // depth clamp - reduces haloing at screen edges

		"uniform float lumInfluence;",  // how much luminance affects occlusion

		"uniform sampler2D tDiffuse;",
		"uniform sampler2D tDepth;",

		"varying vec2 vUv;",

		// "#define PI 3.14159265",
		"#define DL 2.399963229728653",  // PI * ( 3.0 - sqrt( 5.0 ) )
		"#define EULER 2.718281828459045",

		// user variables

		"const int samples = 8;",     // ao sample count
		"const float radius = 5.0;",  // ao radius

		"const bool useNoise = false;",      // use noise instead of pattern for sample dithering
		"const float noiseAmount = 0.0003;", // dithering amount

		"const float diffArea = 0.4;",   // self-shadowing reduction
		"const float gDisplace = 0.4;",  // gauss bell center


		// RGBA depth

		"#include <packing>",

		// generating noise / pattern texture for dithering

		"vec2 rand( const vec2 coord ) {",

			"vec2 noise;",

			"if ( useNoise ) {",

				"float nx = dot ( coord, vec2( 12.9898, 78.233 ) );",
				"float ny = dot ( coord, vec2( 12.9898, 78.233 ) * 2.0 );",

				"noise = clamp( fract ( 43758.5453 * sin( vec2( nx, ny ) ) ), 0.0, 1.0 );",

			"} else {",

				"float ff = fract( 1.0 - coord.s * ( size.x / 2.0 ) );",
				"float gg = fract( coord.t * ( size.y / 2.0 ) );",

				"noise = vec2( 0.25, 0.75 ) * vec2( ff ) + vec2( 0.75, 0.25 ) * gg;",

			"}",

			"return ( noise * 2.0  - 1.0 ) * noiseAmount;",

		"}",

		"float readDepth( const in vec2 coord ) {",

			"float cameraFarPlusNear = cameraFar + cameraNear;",
			"float cameraFarMinusNear = cameraFar - cameraNear;",
			"float cameraCoef = 2.0 * cameraNear;",

			"#ifdef USE_LOGDEPTHBUF",

				"float logz = unpackRGBAToDepth( texture2D( tDepth, coord ) );",
				"float w = pow(2.0, (logz / logDepthBufFC)) - 1.0;",
				"float z = (logz / w) + 1.0;",

			"#else",

				"float z = unpackRGBAToDepth( texture2D( tDepth, coord ) );",

			"#endif",

			"return cameraCoef / ( cameraFarPlusNear - z * cameraFarMinusNear );",


		"}",

		"float compareDepths( const in float depth1, const in float depth2, inout int far ) {",

			"float garea = 2.0;",                         // gauss bell width
			"float diff = ( depth1 - depth2 ) * 100.0;",  // depth difference (0-100)

			// reduce left bell width to avoid self-shadowing

			"if ( diff < gDisplace ) {",

				"garea = diffArea;",

			"} else {",

				"far = 1;",

			"}",

			"float dd = diff - gDisplace;",
			"float gauss = pow( EULER, -2.0 * dd * dd / ( garea * garea ) );",
			"return gauss;",

		"}",

		"float calcAO( float depth, float dw, float dh ) {",

			"float dd = radius - depth * radius;",
			"vec2 vv = vec2( dw, dh );",

			"vec2 coord1 = vUv + dd * vv;",
			"vec2 coord2 = vUv - dd * vv;",

			"float temp1 = 0.0;",
			"float temp2 = 0.0;",

			"int far = 0;",
			"temp1 = compareDepths( depth, readDepth( coord1 ), far );",

			// DEPTH EXTRAPOLATION

			"if ( far > 0 ) {",

				"temp2 = compareDepths( readDepth( coord2 ), depth, far );",
				"temp1 += ( 1.0 - temp1 ) * temp2;",

			"}",

			"return temp1;",

		"}",

		"void main() {",

			"vec2 noise = rand( vUv );",
			"float depth = readDepth( vUv );",

			"float tt = clamp( depth, aoClamp, 1.0 );",

			"float w = ( 1.0 / size.x )  / tt + ( noise.x * ( 1.0 - noise.x ) );",
			"float h = ( 1.0 / size.y ) / tt + ( noise.y * ( 1.0 - noise.y ) );",

			"float ao = 0.0;",

			"float dz = 1.0 / float( samples );",
			"float z = 1.0 - dz / 2.0;",
			"float l = 0.0;",

			"for ( int i = 0; i <= samples; i ++ ) {",

				"float r = sqrt( 1.0 - z );",

				"float pw = cos( l ) * r;",
				"float ph = sin( l ) * r;",
				"ao += calcAO( depth, pw * w, ph * h );",
				"z = z - dz;",
				"l = l + DL;",

			"}",

			"ao /= float( samples );",
			"ao = 1.0 - ao;",

			"vec3 color = texture2D( tDiffuse, vUv ).rgb;",

			"vec3 lumcoeff = vec3( 0.299, 0.587, 0.114 );",
			"float lum = dot( color.rgb, lumcoeff );",
			"vec3 luminance = vec3( lum );",

			"vec3 final = vec3( color * mix( vec3( ao ), vec3( 1.0 ), luminance * lumInfluence ) );",  // mix( color * ao, white, luminance )

			"if ( onlyAO ) {",

				"final = vec3( mix( vec3( ao ), vec3( 1.0 ), luminance * lumInfluence ) );",  // ambient occlusion only

			"}",

			"gl_FragColor = vec4( final, 1.0 );",

		"}"

	].join( "\n" )

};

/**
 * @author alteredq / http://alteredqualia.com/
 *
 * Sepia tone shader
 * based on glfx.js sepia shader
 * https://github.com/evanw/glfx.js
 */

THREE.SepiaShader = {

	uniforms: {

		"tDiffuse": { value: null },
		"amount":   { value: 1.0 }

	},

	vertexShader: [

		"varying vec2 vUv;",

		"void main() {",

			"vUv = uv;",
			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join( "\n" ),

	fragmentShader: [

		"uniform float amount;",

		"uniform sampler2D tDiffuse;",

		"varying vec2 vUv;",

		"void main() {",

			"vec4 color = texture2D( tDiffuse, vUv );",
			"vec3 c = color.rgb;",

			"color.r = dot( c, vec3( 1.0 - 0.607 * amount, 0.769 * amount, 0.189 * amount ) );",
			"color.g = dot( c, vec3( 0.349 * amount, 1.0 - 0.314 * amount, 0.168 * amount ) );",
			"color.b = dot( c, vec3( 0.272 * amount, 0.534 * amount, 1.0 - 0.869 * amount ) );",

			"gl_FragColor = vec4( min( vec3( 1.0 ), color.rgb ), color.a );",

		"}"

	].join( "\n" )

};

/**
 * @author flimshaw / http://charliehoey.com
 *
 * Technicolor Shader
 * Simulates the look of the two-strip technicolor process popular in early 20th century films.
 * More historical info here: http://www.widescreenmuseum.com/oldcolor/technicolor1.htm
 * Demo here: http://charliehoey.com/technicolor_shader/shader_test.html
 */

THREE.TechnicolorShader = {

	uniforms: {

		"tDiffuse": { value: null }

	},

	vertexShader: [

		"varying vec2 vUv;",

		"void main() {",

			"vUv = uv;",
			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join( "\n" ),

	fragmentShader: [

		"uniform sampler2D tDiffuse;",
		"varying vec2 vUv;",

		"void main() {",

			"vec4 tex = texture2D( tDiffuse, vec2( vUv.x, vUv.y ) );",
			"vec4 newTex = vec4(tex.r, (tex.g + tex.b) * .5, (tex.g + tex.b) * .5, 1.0);",

			"gl_FragColor = newTex;",

		"}"

	].join( "\n" )

};

/**
 * @author miibond
 *
 * Full-screen tone-mapping shader based on http://www.graphics.cornell.edu/~jaf/publications/sig02_paper.pdf
 */

THREE.ToneMapShader = {

	uniforms: {

		"tDiffuse": { value: null },
		"averageLuminance":  { value: 1.0 },
		"luminanceMap":  { value: null },
		"maxLuminance":  { value: 16.0 },
		"middleGrey":  { value: 0.6 }
	},

	vertexShader: [

		"varying vec2 vUv;",

		"void main() {",

			"vUv = uv;",
			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join( "\n" ),

	fragmentShader: [

		"uniform sampler2D tDiffuse;",

		"varying vec2 vUv;",

		"uniform float middleGrey;",
		"uniform float maxLuminance;",
		"#ifdef ADAPTED_LUMINANCE",
			"uniform sampler2D luminanceMap;",
		"#else",
			"uniform float averageLuminance;",
		"#endif",
		
		"const vec3 LUM_CONVERT = vec3(0.299, 0.587, 0.114);",

		"vec3 ToneMap( vec3 vColor ) {",
			"#ifdef ADAPTED_LUMINANCE",
				// Get the calculated average luminance 
				"float fLumAvg = texture2D(luminanceMap, vec2(0.5, 0.5)).r;",
			"#else",
				"float fLumAvg = averageLuminance;",
			"#endif",
			
			// Calculate the luminance of the current pixel
			"float fLumPixel = dot(vColor, LUM_CONVERT);",

			// Apply the modified operator (Eq. 4)
			"float fLumScaled = (fLumPixel * middleGrey) / fLumAvg;",

			"float fLumCompressed = (fLumScaled * (1.0 + (fLumScaled / (maxLuminance * maxLuminance)))) / (1.0 + fLumScaled);",
			"return fLumCompressed * vColor;",
		"}",

		"void main() {",

			"vec4 texel = texture2D( tDiffuse, vUv );",
			
			"gl_FragColor = vec4( ToneMap( texel.xyz ), texel.w );",

		"}"

	].join( "\n" )

};

/**
 * @author zz85 / http://www.lab4games.net/zz85/blog
 *
 * Triangle blur shader
 * based on glfx.js triangle blur shader
 * https://github.com/evanw/glfx.js
 *
 * A basic blur filter, which convolves the image with a
 * pyramid filter. The pyramid filter is separable and is applied as two
 * perpendicular triangle filters.
 */

THREE.TriangleBlurShader = {

	uniforms : {

		"texture": { value: null },
		"delta":   { value: new THREE.Vector2( 1, 1 ) }

	},

	vertexShader: [

		"varying vec2 vUv;",

		"void main() {",

			"vUv = uv;",
			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join( "\n" ),

	fragmentShader: [

		"#include <common>",

		"#define ITERATIONS 10.0",

		"uniform sampler2D texture;",
		"uniform vec2 delta;",

		"varying vec2 vUv;",

		"void main() {",

			"vec4 color = vec4( 0.0 );",

			"float total = 0.0;",

			// randomize the lookup values to hide the fixed number of samples

			"float offset = rand( vUv );",

			"for ( float t = -ITERATIONS; t <= ITERATIONS; t ++ ) {",

				"float percent = ( t + offset - 0.5 ) / ITERATIONS;",
				"float weight = 1.0 - abs( percent );",

				"color += texture2D( texture, vUv + delta * percent ) * weight;",
				"total += weight;",

			"}",

			"gl_FragColor = color / total;",

		"}"

	].join( "\n" )

};

/**
 * @author alteredq / http://alteredqualia.com/
 *
 * Unpack RGBA depth shader
 * - show RGBA encoded depth as monochrome color
 */

THREE.UnpackDepthRGBAShader = {

	uniforms: {

		"tDiffuse": { value: null },
		"opacity":  { value: 1.0 }

	},

	vertexShader: [

		"varying vec2 vUv;",

		"void main() {",

			"vUv = uv;",
			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join( "\n" ),

	fragmentShader: [

		"uniform float opacity;",

		"uniform sampler2D tDiffuse;",

		"varying vec2 vUv;",

		"#include <packing>",

		"void main() {",

			"float depth = 1.0 - unpackRGBAToDepth( texture2D( tDiffuse, vUv ) );",
			"gl_FragColor = opacity * vec4( vec3( depth ), 1.0 );",

		"}"

	].join( "\n" )

};

/**
 * @author zz85 / http://www.lab4games.net/zz85/blog
 *
 * Two pass Gaussian blur filter (horizontal and vertical blur shaders)
 * - described in http://www.gamerendering.com/2008/10/11/gaussian-blur-filter-shader/
 *   and used in http://www.cake23.de/traveling-wavefronts-lit-up.html
 *
 * - 9 samples per pass
 * - standard deviation 2.7
 * - "h" and "v" parameters should be set to "1 / width" and "1 / height"
 */

THREE.VerticalBlurShader = {

	uniforms: {

		"tDiffuse": { value: null },
		"v":        { value: 1.0 / 512.0 }

	},

	vertexShader: [

		"varying vec2 vUv;",

		"void main() {",

			"vUv = uv;",
			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join( "\n" ),

	fragmentShader: [

		"uniform sampler2D tDiffuse;",
		"uniform float v;",

		"varying vec2 vUv;",

		"void main() {",

			"vec4 sum = vec4( 0.0 );",

			"sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;",
			"sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;",
			"sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;",
			"sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;",
			"sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;",
			"sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;",
			"sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;",
			"sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;",
			"sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;",

			"gl_FragColor = sum;",

		"}"

	].join( "\n" )

};

/**
 * @author alteredq / http://alteredqualia.com/
 *
 * Simple fake tilt-shift effect, modulating two pass Gaussian blur (see above) by vertical position
 *
 * - 9 samples per pass
 * - standard deviation 2.7
 * - "h" and "v" parameters should be set to "1 / width" and "1 / height"
 * - "r" parameter control where "focused" horizontal line lies
 */

THREE.VerticalTiltShiftShader = {

	uniforms: {

		"tDiffuse": { value: null },
		"v":        { value: 1.0 / 512.0 },
		"r":        { value: 0.35 }

	},

	vertexShader: [

		"varying vec2 vUv;",

		"void main() {",

			"vUv = uv;",
			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join( "\n" ),

	fragmentShader: [

		"uniform sampler2D tDiffuse;",
		"uniform float v;",
		"uniform float r;",

		"varying vec2 vUv;",

		"void main() {",

			"vec4 sum = vec4( 0.0 );",

			"float vv = v * abs( r - vUv.y );",

			"sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * vv ) ) * 0.051;",
			"sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * vv ) ) * 0.0918;",
			"sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * vv ) ) * 0.12245;",
			"sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * vv ) ) * 0.1531;",
			"sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;",
			"sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * vv ) ) * 0.1531;",
			"sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * vv ) ) * 0.12245;",
			"sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * vv ) ) * 0.0918;",
			"sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * vv ) ) * 0.051;",

			"gl_FragColor = sum;",

		"}"

	].join( "\n" )

};

/**
 * @author alteredq / http://alteredqualia.com/
 *
 * Vignette shader
 * based on PaintEffect postprocess from ro.me
 * http://code.google.com/p/3-dreams-of-black/source/browse/deploy/js/effects/PaintEffect.js
 */

THREE.VignetteShader = {

	uniforms: {

		"tDiffuse": { value: null },
		"offset":   { value: 1.0 },
		"darkness": { value: 1.0 }

	},

	vertexShader: [

		"varying vec2 vUv;",

		"void main() {",

			"vUv = uv;",
			"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",

		"}"

	].join( "\n" ),

	fragmentShader: [

		"uniform float offset;",
		"uniform float darkness;",

		"uniform sampler2D tDiffuse;",

		"varying vec2 vUv;",

		"void main() {",

			// Eskil's vignette

			"vec4 texel = texture2D( tDiffuse, vUv );",
			"vec2 uv = ( vUv - vec2( 0.5 ) ) * vec2( offset );",
			"gl_FragColor = vec4( mix( texel.rgb, vec3( 1.0 - darkness ), dot( uv, uv ) ), texel.a );",

			/*
			// alternative version from glfx.js
			// this one makes more "dusty" look (as opposed to "burned")

			"vec4 color = texture2D( tDiffuse, vUv );",
			"float dist = distance( vUv, vec2( 0.5 ) );",
			"color.rgb *= smoothstep( 0.8, offset * 0.799, dist *( darkness + offset ) );",
			"gl_FragColor = color;",
			*/

		"}"

	].join( "\n" )

};

/*! Hammer.JS - v2.0.6 - 2016-02-25
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the  license */
!function(a,b,c,d){"use strict";function e(a,b,c){return setTimeout(j(a,c),b)}function f(a,b,c){return Array.isArray(a)?(g(a,c[b],c),!0):!1}function g(a,b,c){var e;if(a)if(a.forEach)a.forEach(b,c);else if(a.length!==d)for(e=0;e<a.length;)b.call(c,a[e],e,a),e++;else for(e in a)a.hasOwnProperty(e)&&b.call(c,a[e],e,a)}function h(b,c,d){var e="DEPRECATED METHOD: "+c+"\n"+d+" AT \n";return function(){var c=new Error("get-stack-trace"),d=c&&c.stack?c.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",f=a.console&&(a.console.warn||a.console.log);return f&&f.call(a.console,e,d),b.apply(this,arguments)}}function i(a,b,c){var d,e=b.prototype;d=a.prototype=Object.create(e),d.constructor=a,d._super=e,c&&ha(d,c)}function j(a,b){return function(){return a.apply(b,arguments)}}function k(a,b){return typeof a==ka?a.apply(b?b[0]||d:d,b):a}function l(a,b){return a===d?b:a}function m(a,b,c){g(q(b),function(b){a.addEventListener(b,c,!1)})}function n(a,b,c){g(q(b),function(b){a.removeEventListener(b,c,!1)})}function o(a,b){for(;a;){if(a==b)return!0;a=a.parentNode}return!1}function p(a,b){return a.indexOf(b)>-1}function q(a){return a.trim().split(/\s+/g)}function r(a,b,c){if(a.indexOf&&!c)return a.indexOf(b);for(var d=0;d<a.length;){if(c&&a[d][c]==b||!c&&a[d]===b)return d;d++}return-1}function s(a){return Array.prototype.slice.call(a,0)}function t(a,b,c){for(var d=[],e=[],f=0;f<a.length;){var g=b?a[f][b]:a[f];r(e,g)<0&&d.push(a[f]),e[f]=g,f++}return c&&(d=b?d.sort(function(a,c){return a[b]>c[b]}):d.sort()),d}function u(a,b){for(var c,e,f=b[0].toUpperCase()+b.slice(1),g=0;g<ia.length;){if(c=ia[g],e=c?c+f:b,e in a)return e;g++}return d}function v(){return qa++}function w(b){var c=b.ownerDocument||b;return c.defaultView||c.parentWindow||a}function x(a,b){var c=this;this.manager=a,this.callback=b,this.element=a.element,this.target=a.options.inputTarget,this.domHandler=function(b){k(a.options.enable,[a])&&c.handler(b)},this.init()}function y(a){var b,c=a.options.inputClass;return new(b=c?c:ta?M:ua?P:sa?R:L)(a,z)}function z(a,b,c){var d=c.pointers.length,e=c.changedPointers.length,f=b&Aa&&d-e===0,g=b&(Ca|Da)&&d-e===0;c.isFirst=!!f,c.isFinal=!!g,f&&(a.session={}),c.eventType=b,A(a,c),a.emit("hammer.input",c),a.recognize(c),a.session.prevInput=c}function A(a,b){var c=a.session,d=b.pointers,e=d.length;c.firstInput||(c.firstInput=D(b)),e>1&&!c.firstMultiple?c.firstMultiple=D(b):1===e&&(c.firstMultiple=!1);var f=c.firstInput,g=c.firstMultiple,h=g?g.center:f.center,i=b.center=E(d);b.timeStamp=na(),b.deltaTime=b.timeStamp-f.timeStamp,b.angle=I(h,i),b.distance=H(h,i),B(c,b),b.offsetDirection=G(b.deltaX,b.deltaY);var j=F(b.deltaTime,b.deltaX,b.deltaY);b.overallVelocityX=j.x,b.overallVelocityY=j.y,b.overallVelocity=ma(j.x)>ma(j.y)?j.x:j.y,b.scale=g?K(g.pointers,d):1,b.rotation=g?J(g.pointers,d):0,b.maxPointers=c.prevInput?b.pointers.length>c.prevInput.maxPointers?b.pointers.length:c.prevInput.maxPointers:b.pointers.length,C(c,b);var k=a.element;o(b.srcEvent.target,k)&&(k=b.srcEvent.target),b.target=k}function B(a,b){var c=b.center,d=a.offsetDelta||{},e=a.prevDelta||{},f=a.prevInput||{};b.eventType!==Aa&&f.eventType!==Ca||(e=a.prevDelta={x:f.deltaX||0,y:f.deltaY||0},d=a.offsetDelta={x:c.x,y:c.y}),b.deltaX=e.x+(c.x-d.x),b.deltaY=e.y+(c.y-d.y)}function C(a,b){var c,e,f,g,h=a.lastInterval||b,i=b.timeStamp-h.timeStamp;if(b.eventType!=Da&&(i>za||h.velocity===d)){var j=b.deltaX-h.deltaX,k=b.deltaY-h.deltaY,l=F(i,j,k);e=l.x,f=l.y,c=ma(l.x)>ma(l.y)?l.x:l.y,g=G(j,k),a.lastInterval=b}else c=h.velocity,e=h.velocityX,f=h.velocityY,g=h.direction;b.velocity=c,b.velocityX=e,b.velocityY=f,b.direction=g}function D(a){for(var b=[],c=0;c<a.pointers.length;)b[c]={clientX:la(a.pointers[c].clientX),clientY:la(a.pointers[c].clientY)},c++;return{timeStamp:na(),pointers:b,center:E(b),deltaX:a.deltaX,deltaY:a.deltaY}}function E(a){var b=a.length;if(1===b)return{x:la(a[0].clientX),y:la(a[0].clientY)};for(var c=0,d=0,e=0;b>e;)c+=a[e].clientX,d+=a[e].clientY,e++;return{x:la(c/b),y:la(d/b)}}function F(a,b,c){return{x:b/a||0,y:c/a||0}}function G(a,b){return a===b?Ea:ma(a)>=ma(b)?0>a?Fa:Ga:0>b?Ha:Ia}function H(a,b,c){c||(c=Ma);var d=b[c[0]]-a[c[0]],e=b[c[1]]-a[c[1]];return Math.sqrt(d*d+e*e)}function I(a,b,c){c||(c=Ma);var d=b[c[0]]-a[c[0]],e=b[c[1]]-a[c[1]];return 180*Math.atan2(e,d)/Math.PI}function J(a,b){return I(b[1],b[0],Na)+I(a[1],a[0],Na)}function K(a,b){return H(b[0],b[1],Na)/H(a[0],a[1],Na)}function L(){this.evEl=Pa,this.evWin=Qa,this.allow=!0,this.pressed=!1,x.apply(this,arguments)}function M(){this.evEl=Ta,this.evWin=Ua,x.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}function N(){this.evTarget=Wa,this.evWin=Xa,this.started=!1,x.apply(this,arguments)}function O(a,b){var c=s(a.touches),d=s(a.changedTouches);return b&(Ca|Da)&&(c=t(c.concat(d),"identifier",!0)),[c,d]}function P(){this.evTarget=Za,this.targetIds={},x.apply(this,arguments)}function Q(a,b){var c=s(a.touches),d=this.targetIds;if(b&(Aa|Ba)&&1===c.length)return d[c[0].identifier]=!0,[c,c];var e,f,g=s(a.changedTouches),h=[],i=this.target;if(f=c.filter(function(a){return o(a.target,i)}),b===Aa)for(e=0;e<f.length;)d[f[e].identifier]=!0,e++;for(e=0;e<g.length;)d[g[e].identifier]&&h.push(g[e]),b&(Ca|Da)&&delete d[g[e].identifier],e++;return h.length?[t(f.concat(h),"identifier",!0),h]:void 0}function R(){x.apply(this,arguments);var a=j(this.handler,this);this.touch=new P(this.manager,a),this.mouse=new L(this.manager,a)}function S(a,b){this.manager=a,this.set(b)}function T(a){if(p(a,db))return db;var b=p(a,eb),c=p(a,fb);return b&&c?db:b||c?b?eb:fb:p(a,cb)?cb:bb}function U(a){this.options=ha({},this.defaults,a||{}),this.id=v(),this.manager=null,this.options.enable=l(this.options.enable,!0),this.state=gb,this.simultaneous={},this.requireFail=[]}function V(a){return a&lb?"cancel":a&jb?"end":a&ib?"move":a&hb?"start":""}function W(a){return a==Ia?"down":a==Ha?"up":a==Fa?"left":a==Ga?"right":""}function X(a,b){var c=b.manager;return c?c.get(a):a}function Y(){U.apply(this,arguments)}function Z(){Y.apply(this,arguments),this.pX=null,this.pY=null}function $(){Y.apply(this,arguments)}function _(){U.apply(this,arguments),this._timer=null,this._input=null}function aa(){Y.apply(this,arguments)}function ba(){Y.apply(this,arguments)}function ca(){U.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function da(a,b){return b=b||{},b.recognizers=l(b.recognizers,da.defaults.preset),new ea(a,b)}function ea(a,b){this.options=ha({},da.defaults,b||{}),this.options.inputTarget=this.options.inputTarget||a,this.handlers={},this.session={},this.recognizers=[],this.element=a,this.input=y(this),this.touchAction=new S(this,this.options.touchAction),fa(this,!0),g(this.options.recognizers,function(a){var b=this.add(new a[0](a[1]));a[2]&&b.recognizeWith(a[2]),a[3]&&b.requireFailure(a[3])},this)}function fa(a,b){var c=a.element;c.style&&g(a.options.cssProps,function(a,d){c.style[u(c.style,d)]=b?a:""})}function ga(a,c){var d=b.createEvent("Event");d.initEvent(a,!0,!0),d.gesture=c,c.target.dispatchEvent(d)}var ha,ia=["","webkit","Moz","MS","ms","o"],ja=b.createElement("div"),ka="function",la=Math.round,ma=Math.abs,na=Date.now;ha="function"!=typeof Object.assign?function(a){if(a===d||null===a)throw new TypeError("Cannot convert undefined or null to object");for(var b=Object(a),c=1;c<arguments.length;c++){var e=arguments[c];if(e!==d&&null!==e)for(var f in e)e.hasOwnProperty(f)&&(b[f]=e[f])}return b}:Object.assign;var oa=h(function(a,b,c){for(var e=Object.keys(b),f=0;f<e.length;)(!c||c&&a[e[f]]===d)&&(a[e[f]]=b[e[f]]),f++;return a},"extend","Use `assign`."),pa=h(function(a,b){return oa(a,b,!0)},"merge","Use `assign`."),qa=1,ra=/mobile|tablet|ip(ad|hone|od)|android/i,sa="ontouchstart"in a,ta=u(a,"PointerEvent")!==d,ua=sa&&ra.test(navigator.userAgent),va="touch",wa="pen",xa="mouse",ya="kinect",za=25,Aa=1,Ba=2,Ca=4,Da=8,Ea=1,Fa=2,Ga=4,Ha=8,Ia=16,Ja=Fa|Ga,Ka=Ha|Ia,La=Ja|Ka,Ma=["x","y"],Na=["clientX","clientY"];x.prototype={handler:function(){},init:function(){this.evEl&&m(this.element,this.evEl,this.domHandler),this.evTarget&&m(this.target,this.evTarget,this.domHandler),this.evWin&&m(w(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&n(this.element,this.evEl,this.domHandler),this.evTarget&&n(this.target,this.evTarget,this.domHandler),this.evWin&&n(w(this.element),this.evWin,this.domHandler)}};var Oa={mousedown:Aa,mousemove:Ba,mouseup:Ca},Pa="mousedown",Qa="mousemove mouseup";i(L,x,{handler:function(a){var b=Oa[a.type];b&Aa&&0===a.button&&(this.pressed=!0),b&Ba&&1!==a.which&&(b=Ca),this.pressed&&this.allow&&(b&Ca&&(this.pressed=!1),this.callback(this.manager,b,{pointers:[a],changedPointers:[a],pointerType:xa,srcEvent:a}))}});var Ra={pointerdown:Aa,pointermove:Ba,pointerup:Ca,pointercancel:Da,pointerout:Da},Sa={2:va,3:wa,4:xa,5:ya},Ta="pointerdown",Ua="pointermove pointerup pointercancel";a.MSPointerEvent&&!a.PointerEvent&&(Ta="MSPointerDown",Ua="MSPointerMove MSPointerUp MSPointerCancel"),i(M,x,{handler:function(a){var b=this.store,c=!1,d=a.type.toLowerCase().replace("ms",""),e=Ra[d],f=Sa[a.pointerType]||a.pointerType,g=f==va,h=r(b,a.pointerId,"pointerId");e&Aa&&(0===a.button||g)?0>h&&(b.push(a),h=b.length-1):e&(Ca|Da)&&(c=!0),0>h||(b[h]=a,this.callback(this.manager,e,{pointers:b,changedPointers:[a],pointerType:f,srcEvent:a}),c&&b.splice(h,1))}});var Va={touchstart:Aa,touchmove:Ba,touchend:Ca,touchcancel:Da},Wa="touchstart",Xa="touchstart touchmove touchend touchcancel";i(N,x,{handler:function(a){var b=Va[a.type];if(b===Aa&&(this.started=!0),this.started){var c=O.call(this,a,b);b&(Ca|Da)&&c[0].length-c[1].length===0&&(this.started=!1),this.callback(this.manager,b,{pointers:c[0],changedPointers:c[1],pointerType:va,srcEvent:a})}}});var Ya={touchstart:Aa,touchmove:Ba,touchend:Ca,touchcancel:Da},Za="touchstart touchmove touchend touchcancel";i(P,x,{handler:function(a){var b=Ya[a.type],c=Q.call(this,a,b);c&&this.callback(this.manager,b,{pointers:c[0],changedPointers:c[1],pointerType:va,srcEvent:a})}}),i(R,x,{handler:function(a,b,c){var d=c.pointerType==va,e=c.pointerType==xa;if(d)this.mouse.allow=!1;else if(e&&!this.mouse.allow)return;b&(Ca|Da)&&(this.mouse.allow=!0),this.callback(a,b,c)},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var $a=u(ja.style,"touchAction"),_a=$a!==d,ab="compute",bb="auto",cb="manipulation",db="none",eb="pan-x",fb="pan-y";S.prototype={set:function(a){a==ab&&(a=this.compute()),_a&&this.manager.element.style&&(this.manager.element.style[$a]=a),this.actions=a.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var a=[];return g(this.manager.recognizers,function(b){k(b.options.enable,[b])&&(a=a.concat(b.getTouchAction()))}),T(a.join(" "))},preventDefaults:function(a){if(!_a){var b=a.srcEvent,c=a.offsetDirection;if(this.manager.session.prevented)return void b.preventDefault();var d=this.actions,e=p(d,db),f=p(d,fb),g=p(d,eb);if(e){var h=1===a.pointers.length,i=a.distance<2,j=a.deltaTime<250;if(h&&i&&j)return}if(!g||!f)return e||f&&c&Ja||g&&c&Ka?this.preventSrc(b):void 0}},preventSrc:function(a){this.manager.session.prevented=!0,a.preventDefault()}};var gb=1,hb=2,ib=4,jb=8,kb=jb,lb=16,mb=32;U.prototype={defaults:{},set:function(a){return ha(this.options,a),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(a){if(f(a,"recognizeWith",this))return this;var b=this.simultaneous;return a=X(a,this),b[a.id]||(b[a.id]=a,a.recognizeWith(this)),this},dropRecognizeWith:function(a){return f(a,"dropRecognizeWith",this)?this:(a=X(a,this),delete this.simultaneous[a.id],this)},requireFailure:function(a){if(f(a,"requireFailure",this))return this;var b=this.requireFail;return a=X(a,this),-1===r(b,a)&&(b.push(a),a.requireFailure(this)),this},dropRequireFailure:function(a){if(f(a,"dropRequireFailure",this))return this;a=X(a,this);var b=r(this.requireFail,a);return b>-1&&this.requireFail.splice(b,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(a){return!!this.simultaneous[a.id]},emit:function(a){function b(b){c.manager.emit(b,a)}var c=this,d=this.state;jb>d&&b(c.options.event+V(d)),b(c.options.event),a.additionalEvent&&b(a.additionalEvent),d>=jb&&b(c.options.event+V(d))},tryEmit:function(a){return this.canEmit()?this.emit(a):void(this.state=mb)},canEmit:function(){for(var a=0;a<this.requireFail.length;){if(!(this.requireFail[a].state&(mb|gb)))return!1;a++}return!0},recognize:function(a){var b=ha({},a);return k(this.options.enable,[this,b])?(this.state&(kb|lb|mb)&&(this.state=gb),this.state=this.process(b),void(this.state&(hb|ib|jb|lb)&&this.tryEmit(b))):(this.reset(),void(this.state=mb))},process:function(a){},getTouchAction:function(){},reset:function(){}},i(Y,U,{defaults:{pointers:1},attrTest:function(a){var b=this.options.pointers;return 0===b||a.pointers.length===b},process:function(a){var b=this.state,c=a.eventType,d=b&(hb|ib),e=this.attrTest(a);return d&&(c&Da||!e)?b|lb:d||e?c&Ca?b|jb:b&hb?b|ib:hb:mb}}),i(Z,Y,{defaults:{event:"pan",threshold:10,pointers:1,direction:La},getTouchAction:function(){var a=this.options.direction,b=[];return a&Ja&&b.push(fb),a&Ka&&b.push(eb),b},directionTest:function(a){var b=this.options,c=!0,d=a.distance,e=a.direction,f=a.deltaX,g=a.deltaY;return e&b.direction||(b.direction&Ja?(e=0===f?Ea:0>f?Fa:Ga,c=f!=this.pX,d=Math.abs(a.deltaX)):(e=0===g?Ea:0>g?Ha:Ia,c=g!=this.pY,d=Math.abs(a.deltaY))),a.direction=e,c&&d>b.threshold&&e&b.direction},attrTest:function(a){return Y.prototype.attrTest.call(this,a)&&(this.state&hb||!(this.state&hb)&&this.directionTest(a))},emit:function(a){this.pX=a.deltaX,this.pY=a.deltaY;var b=W(a.direction);b&&(a.additionalEvent=this.options.event+b),this._super.emit.call(this,a)}}),i($,Y,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[db]},attrTest:function(a){return this._super.attrTest.call(this,a)&&(Math.abs(a.scale-1)>this.options.threshold||this.state&hb)},emit:function(a){if(1!==a.scale){var b=a.scale<1?"in":"out";a.additionalEvent=this.options.event+b}this._super.emit.call(this,a)}}),i(_,U,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[bb]},process:function(a){var b=this.options,c=a.pointers.length===b.pointers,d=a.distance<b.threshold,f=a.deltaTime>b.time;if(this._input=a,!d||!c||a.eventType&(Ca|Da)&&!f)this.reset();else if(a.eventType&Aa)this.reset(),this._timer=e(function(){this.state=kb,this.tryEmit()},b.time,this);else if(a.eventType&Ca)return kb;return mb},reset:function(){clearTimeout(this._timer)},emit:function(a){this.state===kb&&(a&&a.eventType&Ca?this.manager.emit(this.options.event+"up",a):(this._input.timeStamp=na(),this.manager.emit(this.options.event,this._input)))}}),i(aa,Y,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[db]},attrTest:function(a){return this._super.attrTest.call(this,a)&&(Math.abs(a.rotation)>this.options.threshold||this.state&hb)}}),i(ba,Y,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Ja|Ka,pointers:1},getTouchAction:function(){return Z.prototype.getTouchAction.call(this)},attrTest:function(a){var b,c=this.options.direction;return c&(Ja|Ka)?b=a.overallVelocity:c&Ja?b=a.overallVelocityX:c&Ka&&(b=a.overallVelocityY),this._super.attrTest.call(this,a)&&c&a.offsetDirection&&a.distance>this.options.threshold&&a.maxPointers==this.options.pointers&&ma(b)>this.options.velocity&&a.eventType&Ca},emit:function(a){var b=W(a.offsetDirection);b&&this.manager.emit(this.options.event+b,a),this.manager.emit(this.options.event,a)}}),i(ca,U,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[cb]},process:function(a){var b=this.options,c=a.pointers.length===b.pointers,d=a.distance<b.threshold,f=a.deltaTime<b.time;if(this.reset(),a.eventType&Aa&&0===this.count)return this.failTimeout();if(d&&f&&c){if(a.eventType!=Ca)return this.failTimeout();var g=this.pTime?a.timeStamp-this.pTime<b.interval:!0,h=!this.pCenter||H(this.pCenter,a.center)<b.posThreshold;this.pTime=a.timeStamp,this.pCenter=a.center,h&&g?this.count+=1:this.count=1,this._input=a;var i=this.count%b.taps;if(0===i)return this.hasRequireFailures()?(this._timer=e(function(){this.state=kb,this.tryEmit()},b.interval,this),hb):kb}return mb},failTimeout:function(){return this._timer=e(function(){this.state=mb},this.options.interval,this),mb},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==kb&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),da.VERSION="2.0.6",da.defaults={domEvents:!1,touchAction:ab,enable:!0,inputTarget:null,inputClass:null,preset:[[aa,{enable:!1}],[$,{enable:!1},["rotate"]],[ba,{direction:Ja}],[Z,{direction:Ja},["swipe"]],[ca],[ca,{event:"doubletap",taps:2},["tap"]],[_]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var nb=1,ob=2;ea.prototype={set:function(a){return ha(this.options,a),a.touchAction&&this.touchAction.update(),a.inputTarget&&(this.input.destroy(),this.input.target=a.inputTarget,this.input.init()),this},stop:function(a){this.session.stopped=a?ob:nb},recognize:function(a){var b=this.session;if(!b.stopped){this.touchAction.preventDefaults(a);var c,d=this.recognizers,e=b.curRecognizer;(!e||e&&e.state&kb)&&(e=b.curRecognizer=null);for(var f=0;f<d.length;)c=d[f],b.stopped===ob||e&&c!=e&&!c.canRecognizeWith(e)?c.reset():c.recognize(a),!e&&c.state&(hb|ib|jb)&&(e=b.curRecognizer=c),f++}},get:function(a){if(a instanceof U)return a;for(var b=this.recognizers,c=0;c<b.length;c++)if(b[c].options.event==a)return b[c];return null},add:function(a){if(f(a,"add",this))return this;var b=this.get(a.options.event);return b&&this.remove(b),this.recognizers.push(a),a.manager=this,this.touchAction.update(),a},remove:function(a){if(f(a,"remove",this))return this;if(a=this.get(a)){var b=this.recognizers,c=r(b,a);-1!==c&&(b.splice(c,1),this.touchAction.update())}return this},on:function(a,b){var c=this.handlers;return g(q(a),function(a){c[a]=c[a]||[],c[a].push(b)}),this},off:function(a,b){var c=this.handlers;return g(q(a),function(a){b?c[a]&&c[a].splice(r(c[a],b),1):delete c[a]}),this},emit:function(a,b){this.options.domEvents&&ga(a,b);var c=this.handlers[a]&&this.handlers[a].slice();if(c&&c.length){b.type=a,b.preventDefault=function(){b.srcEvent.preventDefault()};for(var d=0;d<c.length;)c[d](b),d++}},destroy:function(){this.element&&fa(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},ha(da,{INPUT_START:Aa,INPUT_MOVE:Ba,INPUT_END:Ca,INPUT_CANCEL:Da,STATE_POSSIBLE:gb,STATE_BEGAN:hb,STATE_CHANGED:ib,STATE_ENDED:jb,STATE_RECOGNIZED:kb,STATE_CANCELLED:lb,STATE_FAILED:mb,DIRECTION_NONE:Ea,DIRECTION_LEFT:Fa,DIRECTION_RIGHT:Ga,DIRECTION_UP:Ha,DIRECTION_DOWN:Ia,DIRECTION_HORIZONTAL:Ja,DIRECTION_VERTICAL:Ka,DIRECTION_ALL:La,Manager:ea,Input:x,TouchAction:S,TouchInput:P,MouseInput:L,PointerEventInput:M,TouchMouseInput:R,SingleTouchInput:N,Recognizer:U,AttrRecognizer:Y,Tap:ca,Pan:Z,Swipe:ba,Pinch:$,Rotate:aa,Press:_,on:m,off:n,each:g,merge:pa,extend:oa,assign:ha,inherit:i,bindFn:j,prefixed:u});var pb="undefined"!=typeof a?a:"undefined"!=typeof self?self:{};pb.Hammer=da,"function"==typeof define&&define.amd?define(function(){return da}):"undefined"!=typeof module&&module.exports?module.exports=da:a[c]=da}(window,document,"Hammer");
//# sourceMappingURL=hammer.min.map
(function() {
  var root = this;
  var e,g=g||{VERSION:"0.3.0",Kf:[],Ld:!1,Zl:!1};function n(a){this.R="";this.xc=this.xb=this.jb=null;this.yb=!0;this.Jd=this.md=!1;this.pf=null;this.fb=a||"BaseObject"}n.prototype.constructor=n;function aa(a){if("string"!==typeof a.R||""===a.R)a.R=g.S.jg();g.S.register(a);a.jb&&("string"===typeof a.jb&&(a.jb=[a.jb]),!0===Array.isArray(a.jb)&&g.mb.register(a))}function ba(a){""!==a.R&&!0===g.S.hb(a.R)&&g.S.unregister(a)}
function ca(a,b,d){d=d||"log";console[d].apply(console,["%c[ForgeJS]%c FORGE."+a.fb+" : "+b+" %c(@"+window.performance.now().toFixed(2)+"ms)","background: #e2edff; color: #4286f4; font-weight: 700","font-weight: 400","color: #AAA"]);if("object"===typeof b&&null!==b)console[d](b)}n.prototype.log=function(a){if(!0===g.Ld||!0===g[this.fb].DEBUG||!0===this.md)ca(this,a,"log"),this.pf||(this.pf=[]),this.pf.push(a)};
n.prototype.warn=function(a){!0!==g.Zl&&!0!==g[this.fb].WARNING&&!0!==this.Jd||ca(this,a,"warn")};n.prototype.destroy=function(){!1!==this.yb&&(ba(this),this.xc&&(this.xc.F(),this.xc.destroy(),this.xc=null),this.xb=null,this.yb=!1)};Object.defineProperty(n.prototype,"className",{get:function(){return this.fb}});Object.defineProperty(n.prototype,"uid",{get:function(){return this.R}});Object.defineProperty(n.prototype,"tags",{get:function(){return this.jb}});
Object.defineProperty(n.prototype,"alive",{get:function(){return this.yb}});Object.defineProperty(n.prototype,"data",{get:function(){return this.xb},set:function(a){this.xb=a}});Object.defineProperty(n.prototype,"debug",{get:function(){return this.md},set:function(a){this.md=!!a;!0===this.md&&(console.log("Enabling debug for a FORGE."+this.fb+" instance :"),console.log(this))}});
Object.defineProperty(n.prototype,"warning",{get:function(){return this.Jd},set:function(a){this.Jd=!!a;!0===this.Jd&&(console.log("Enabling warning for a FORGE."+this.fb+" instance :"),console.log(this))}});Object.defineProperty(n.prototype,"onDestroy",{get:function(){this.xc||(this.xc=new q(this));return this.xc}});
function t(a,b,d){n.call(this,"Viewer");this.j=a;this.Da=b||{viewer:da};this.G=this.T=this.fa=this.D=this.L=this.C=this.Aa=this.V=this.Ba=this.ra=this.$=this.Ca=this.U=this.aa=this.ja=this.O=this.I=this.Z=this.H=this.P=this.J=this.M=this.B=this.c=this.sa=null;this.ia=this.da=!1;this.u=this.m=this.o=null;this.f=d||null;window.setTimeout(this.Pl.bind(this),0)}t.prototype=Object.create(n.prototype);t.prototype.constructor=t;var da={background:"#000"};e=t.prototype;
e.Pl=function(a){this.R="FORGE-instance-"+String(g.Kf.length);g.Kf.push(this.R);aa(this);this.log("FORGE.Viewer.boot();");this.sa=new ea(this);"string"===typeof this.j&&""!==this.j&&(this.j=document.getElementById(this.j));if("undefined"===typeof this.j||null===this.j||!1===g.ka.sg(this.j))throw"FORGE.Viewer.boot : Viewer parent is invalid";this.c=new v(this,null,null,this.j);this.c.id="FORGE-main-container-"+this.R;this.B=new v(this);this.B.id="FORGE-canvas-container-"+this.R;this.c.index=0;this.B.Sb(!0);
this.c.mc(this.B);this.M=new v(this);this.M.id="FORGE-dom-hotspot-container-"+this.R;this.c.index=0;this.M.Sb(!0);this.c.mc(this.M);this.J=new v(this);this.J.id="FORGE-plugin-container-"+this.R;this.c.index=0;this.J.Sb(!0);this.c.mc(this.J);this.P=new fa(this);this.P.Sb(!0);this.B.mc(this.P);this.ja=new ga(this);this.D=new ha(this);this.H=new w(this);this.L=new ia(this);this.T=new ja(this);this.$=new x(this);this.ra=new ka(this);this.G=new y(this);this.U=new la(this);this.Z=new z(this);this.C=new B(this);
this.I=new ma(this);this.O=new na(this);this.aa=new oa(this);this.Ca=new pa(this);this.Aa=new qa(this);this.V=new ra(this);this.Ba=new sa(this);this.fa=new ta(this);this.H.boot();this.L.boot();this.$.boot();this.Z.boot();this.C.boot();this.I.boot();this.log("ForgeJS "+g.VERSION);"function"===typeof a&&a.call();this.f&&"function"===typeof this.f.boot&&this.f.boot.call();this.L.start();this.ia=!0;this.o&&this.o.F();a=this.Da;"string"===typeof a?this.Ba.json(this.R+"-configuration",a,this.Ql,this):a&&
"object"===typeof a&&ua(this,a)};e.Ql=function(a){this.log("FORGE.Viewer._configLoadComplete();");a=this.V.get(C.JSON,a.key).data;ua(this,a)};
function ua(a,b){a.Da=b;if("undefined"!==typeof b.viewer){var d=b.viewer;a.c.background="string"===typeof d.background?d.background:da.background}"undefined"!==typeof b.i18n&&a.T.ma(b.i18n);"undefined"!==typeof b.history&&a.ra.ma(b.history);"undefined"!==typeof b.audio&&a.H.ma(b.audio);"undefined"!==typeof b.playlists&&a.Z.ma(b.playlists);"undefined"!==typeof b.actions&&a.O.ma(b.actions);"undefined"!==typeof b.director&&a.aa.load(b.director);"undefined"!==typeof b.hotspots&&a.I.sj(b.hotspots);"undefined"!==
typeof b.postProcessing&&a.Ca.ma(b.postProcessing);"undefined"!==typeof b.plugins&&a.C.ma(b.plugins);a.U.ma(b.controllers);"undefined"!==typeof b.tour&&a.$.load(b.tour)}
e.update=function(a){!0!==this.da&&(this.D.update(a),this.sa.update(),this.Aa.update(),this.H.update(),this.C.update(),this.fa.update(),this.I.update(),this.U.update(),this.f&&"function"===typeof this.f.update&&this.f.update.call(),this.f&&"function"===typeof this.f.Fn&&this.f.Fn.call(),this.G&&this.G.render(),this.f&&"function"===typeof this.f.En&&this.f.En.call())};e.pause=function(){this.da=!0;this.m&&this.m.F()};e.resume=function(){this.da=!1;this.u&&this.u.F()};
e.destroy=function(){this.L.stop();this.j=this.Da=null;this.C.destroy();this.C=null;this.L.destroy();this.L=null;this.Ba.destroy();this.Ba=null;this.ra.destroy();this.ra=null;this.D.destroy();this.D=null;this.Aa.destroy();this.Aa=null;this.I.destroy();this.I=null;this.aa.destroy();this.aa=null;this.G.destroy();this.G=null;this.P.destroy();this.P=null;this.B.destroy();this.B=null;this.M.destroy();this.M=null;this.Ca.destroy();this.Ca=null;this.J.destroy();this.J=null;this.O.destroy();this.O=null;this.c.destroy();
this.c=null;this.sa.destroy();this.sa=null;this.Z.destroy();this.Z=null;this.H.destroy();this.H=null;this.$.destroy();this.$=null;this.V.destroy();this.V=null;this.fa.destroy();this.fa=null;this.T.destroy();this.T=null;this.U.destroy();this.f=this.U=null;this.o&&(this.o.destroy(),this.o=null);this.m&&(this.m.destroy(),this.m=null);this.u&&(this.u.destroy(),this.u=null);g.Kf.splice(this.R,1);n.prototype.destroy.call(this)};Object.defineProperty(t.prototype,"ready",{get:function(){return this.ia}});
Object.defineProperty(t.prototype,"config",{get:function(){return this.Da}});Object.defineProperty(t.prototype,"parent",{get:function(){return this.j}});Object.defineProperty(t.prototype,"display",{get:function(){return this.sa}});Object.defineProperty(t.prototype,"fullscreen",{get:function(){return this.c.zd()},set:function(a){"boolean"===typeof a&&this.c.zd()!==a&&(this.c.fullscreen=a)}});Object.defineProperty(t.prototype,"container",{get:function(){return this.c}});
Object.defineProperty(t.prototype,"canvasContainer",{get:function(){return this.B}});Object.defineProperty(t.prototype,"canvas",{get:function(){return this.P}});Object.defineProperty(t.prototype,"domHotspotContainer",{get:function(){return this.M}});Object.defineProperty(t.prototype,"pluginContainer",{get:function(){return this.J}});Object.defineProperty(t.prototype,"raf",{get:function(){return this.L}});Object.defineProperty(t.prototype,"audio",{get:function(){return this.H}});
Object.defineProperty(t.prototype,"playlists",{get:function(){return this.Z}});Object.defineProperty(t.prototype,"hotspots",{get:function(){return this.I}});Object.defineProperty(t.prototype,"actions",{get:function(){return this.O}});Object.defineProperty(t.prototype,"dependencies",{get:function(){return this.ja}});Object.defineProperty(t.prototype,"director",{get:function(){return this.aa}});Object.defineProperty(t.prototype,"tour",{get:function(){return this.$}});
Object.defineProperty(t.prototype,"history",{get:function(){return this.ra}});Object.defineProperty(t.prototype,"load",{get:function(){return this.Ba}});Object.defineProperty(t.prototype,"cache",{get:function(){return this.V}});Object.defineProperty(t.prototype,"plugins",{get:function(){return this.C}});Object.defineProperty(t.prototype,"clock",{get:function(){return this.D}});Object.defineProperty(t.prototype,"tween",{get:function(){return this.fa}});Object.defineProperty(t.prototype,"i18n",{get:function(){return this.T}});
Object.defineProperty(t.prototype,"renderer",{get:function(){return this.G}});Object.defineProperty(t.prototype,"view",{get:function(){return this.G.view}});Object.defineProperty(t.prototype,"camera",{get:function(){return this.G.camera}});Object.defineProperty(t.prototype,"controllers",{get:function(){return this.U}});Object.defineProperty(t.prototype,"postProcessing",{get:function(){return this.Ca}});Object.defineProperty(t.prototype,"keyboard",{get:function(){return this.Aa}});
Object.defineProperty(t.prototype,"width",{get:function(){return this.c.width},set:function(a){this.c.width=a}});Object.defineProperty(t.prototype,"height",{get:function(){return this.c.height},set:function(a){this.c.height=a}});Object.defineProperty(t.prototype,"onReady",{get:function(){this.o||(this.o=new q(this));return this.o}});Object.defineProperty(t.prototype,"onPause",{get:function(){this.m||(this.m=new q(this));return this.m}});
Object.defineProperty(t.prototype,"onResume",{get:function(){this.u||(this.u=new q(this));return this.u}});
g.mb=function(a){a=a();a.prototype=Object.create(n.prototype);a.prototype.constructor=a;a.prototype.register=function(a){if("object"===typeof a&&"string"===typeof a.uid&&Array.isArray(a.tags)){var b=a.uid,h=a.tags;if(!0===g.S.hb(b))for(var k=0,l=h.length;k<l;k++)a=h[k],"string"!==typeof a?this.warn("Tags: An object has a tag that isn't a string!"):("undefined"===typeof this.zb[a]&&(this.zb[a]=[],null!==this.sd&&this.sd.F({tag:a})),-1===this.zb[a].indexOf(b)&&this.zb[a].push(b));else this.warn("Tags: The object you want to register in tags is not known by UID!"),
this.warn(a)}else this.warn("Tags: No uid or no tags on the object you try to register!"),this.warn(a)};a.prototype.lg=function(a,d){var b=[];if("string"===typeof a)b=this.zb[a];else if(Array.isArray(a)){var k=0;for(a=a.length;k<a;k++);}"string"===typeof d&&(b=g.S.me(b,d));return b};a.prototype.get=function(a,d){if("string"===typeof a)return g.S.get(this.zb[a],d);if(Array.isArray(a)){var b=0;for(a=a.length;b<a;b++);return g.S.get([],d)}};a.prototype.Yn=function(a,d){if(!0===this.hb(a)){a=this.zb[a];
for(var b=0,k=this.zb.length;b<k;b++)if(!0===g.S.W(a[b],d))return!0}return!1};a.prototype.hb=function(a){return"undefined"!==typeof this.zb[a]&&null!==this.zb[a]};Object.defineProperty(a.prototype,"list",{get:function(){return Object.keys(this.zb)}});Object.defineProperty(a.prototype,"onRegister",{get:function(){null===this.sd&&(this.sd=new q(this));return this.sd}});return new a}(function(){return function(){this.zb={};this.sd=null;n.call(this,"Tags")}});
g.S=function(a){a=a();a.prototype=Object.create(n.prototype);a.prototype.constructor=a;a.prototype.jg=function(){var a="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)});return!1===g.S.hb(a)?a:g.S.jg()};a.prototype.Rk=function(a){function b(a){var d,k;for(k in a)if("uid"===k)if(d=a[k],"string"===typeof d){if(g.S.hb(d))throw"UID configuration not valid, uid "+d+" already have an object binded to!";if(-1!==h.indexOf(d))throw"UID configuration not valid, uid "+
d+" is in double in config file!";h.push(a[k])}else throw"Found a uid in configuration that is not a string!";else"object"===typeof a[k]&&b(a[k]);return!0}var h=[];return b(a)};a.prototype.register=function(a){if("object"===typeof a&&"string"===typeof a.uid){var b=a.uid;if(!1===g.S.hb(b))return this.ba[b]=a,!0;this.warn("The uid you want to register already exists!");this.warn(a)}else this.warn("No uid on the object you try to register!"),this.warn(a);return!1};a.prototype.unregister=function(a){"object"===
typeof a&&"string"===typeof a.uid?(a=a.uid,this.ba[a]=null,delete this.ba[a]):this.warn("No uid on the object you try to unregister!")};a.prototype.lg=function(a){return"undefined"===typeof a||null===a?Object.keys(this.ba):g.S.me(Object.keys(this.ba),a)};a.prototype.me=function(a,d){return a.filter(function(a){return g.S.W(a,d)?!0:!1})};a.prototype.get=function(a,d){if("undefined"===typeof a||null===a){if("string"!==typeof d)return this.ba;a=Object.keys(this.ba)}if("string"===typeof a)return this.ba[a];
if(Array.isArray(a)){"string"===typeof d&&(a=g.S.me(a,d));d=[];for(var b,k=0,l=a.length;k<l;k++)b=a[k],!0===g.S.hb(b)&&d.push(this.ba[b]);return d}};a.prototype.W=function(a,d){a=g.S.get(a);return g.K.W(a,d)};a.prototype.hb=function(a){return"undefined"!==typeof this.ba[a]&&null!==this.ba[a]};return new a}(function(){return function(){this.ba={};n.call(this,"UID")}});
function x(a){this.i=a;this.J=this.P=this.L=this.f=null;this.M="";this.c=null;this.m="";this.o=null;this.u="";this.j=this.H=this.I=this.G=this.C=this.D=this.B=null;n.call(this,"Tour")}x.prototype=Object.create(n.prototype);e=x.prototype;e.constructor=x;e.boot=function(){this.log("FORGE.Tour.boot();");this.c=[];this.o=[];this.L=new D(this.i);this.P=new D(this.i);this.J=new D(this.i)};
e.load=function(a){this.log("FORGE.Tour.load();");"string"===typeof a?this.i.load.json("tour.config",a,this.Dl,this):"object"===typeof a&&va(this,a)};e.El=function(){return!!this.c.length};e.Ec=function(){return!!this.o.length};e.Fl=function(){var a=this.c.indexOf(this.m);this.Bd(a+1<this.c.length?this.c[a+1]:this.c[0])};e.Gl=function(){var a=this.c.indexOf(this.m);this.Bd(0<=a-1?this.c[a-1]:this.c[this.c.length-1])};
e.Dl=function(a){this.log("FORGE.Tour.loadComplete();");a=this.i.cache.get(C.JSON,a.key).data;va(this,a)};
function va(a,b){if(!0!==g.S.Rk(b))throw"Tour configuration is not valid!";a.f=b;a.R=a.f.uid;aa(a);a.M=a.f["default"];a.L.key=a.f.name;a.P.key=a.f.slug;a.J.key=a.f.description;if("undefined"!==typeof a.f.scenes&&0<a.f.scenes.length){b=a.f.scenes;for(var d,h=0,k=b.length;h<k;h++)d=new E(a.i),d.ma(b[h]),!0===d.booted&&wa(a,d)}if("undefined"!==typeof a.f.groups&&0<a.f.groups.length)for(b=a.f.groups,h=0,k=b.length;h<k;h++)d=new F(a.i,b[h]),a.o.push(d.uid);xa(a)}
function xa(a){if("undefined"===typeof a.f.scenes||a.c.length===a.f.scenes.length){a.B&&a.B.F();var b=ya().hashParameters;null!==b&&"string"===typeof b.uid?za(b.uid):""!==a.M&&null!==a.M&&g.S.hb(a.M)?za(a.M):a.Bd(0)}}function za(a){!0!==g.S.W(a,"Scene")&&!0!==g.S.W(a,"Group")||g.S.get(a).load()}e.yk=function(a){wa(this,a);xa(this)};function wa(a,b){b.onLoadStart.add(a.un,a);b.onLoadComplete.add(a.tn,a);a.c.push(b.uid)}
e.Bd=function(a){var b;"number"===typeof a?0<=a&&a<this.c.length?b=this.c[a]:this.warn("Load scene, index "+a+" is out of bounds"):"string"===typeof a&&g.S.W(a,"Scene")?b=a:"object"===typeof a&&g.K.W(a,"Scene")&&(b=a.uid);"undefined"!==typeof b&&b!==this.m&&za(b)};e.un=function(a){""!==this.m&&null!==this.m&&this.scene.Le();a=a.emitter;this.m=a.uid;!1===a.Ec()?(this.u=null,this.j&&this.j.F()):!0===a.Ec()&&!1===a.wd(this.u)&&Aa(this,a.groups[0].uid);this.D&&this.D.F({uid:a.uid})};
e.tn=function(){this.G&&this.G.F()};function Aa(a,b){!0===g.S.W(b,"Group")&&b!==a.u&&(a.u=b,a.j&&a.j.F())}e.sk=function(a){var b;"number"===typeof a?0<=a&&a<this.o.length?b=this.o[a]:this.warn("Load group, index "+a+" is out of bounds"):"string"===typeof a&&g.S.W(a,"Group")?b=a:"object"===typeof a&&g.K.W(a,"Group")&&(b=a.uid);"undefined"!==typeof b&&b!==this.u&&(Aa(this,b),za(b))};
e.destroy=function(){this.f=this.i=null;this.L.destroy();this.L=null;this.P.destroy();this.P=null;this.J.destroy();this.J=null;for(var a=0,b=this.c.length;a<b;a++)g.S.get(this.c[a]).destroy();this.c=null;a=0;for(b=this.o.length;a<b;a++)g.S.get(this.o[a]).destroy();this.o=null;this.B&&(this.B.destroy(),this.B=null);this.D&&(this.D.destroy(),this.D=null);this.C&&(this.C.destroy(),this.C=null);this.G&&(this.G.destroy(),this.G=null);this.I&&(this.I.destroy(),this.I=null);this.H&&(this.H.destroy(),this.H=
null);this.j&&(this.j.destroy(),this.j=null);n.prototype.destroy.call(this)};Object.defineProperty(x.prototype,"config",{get:function(){return this.f}});Object.defineProperty(x.prototype,"name",{get:function(){return this.L.value}});Object.defineProperty(x.prototype,"slug",{get:function(){return this.P.value}});Object.defineProperty(x.prototype,"description",{get:function(){return this.J.value}});Object.defineProperty(x.prototype,"scenes",{get:function(){return g.S.get(this.c)}});
Object.defineProperty(x.prototype,"scene",{get:function(){return null===this.m||""===this.m?null:g.S.get(this.m)},set:function(a){this.Bd(a)}});Object.defineProperty(x.prototype,"sceneUid",{get:function(){return this.m}});Object.defineProperty(x.prototype,"groups",{get:function(){return g.S.get(this.o)}});Object.defineProperty(x.prototype,"group",{get:function(){return null===this.u||""===this.u?null:g.S.get(this.u)},set:function(a){this.sk(a)}});Object.defineProperty(x.prototype,"groupUid",{get:function(){return this.u}});
Object.defineProperty(x.prototype,"onReady",{get:function(){this.B||(this.B=new q(this));return this.B}});Object.defineProperty(x.prototype,"onSceneLoadStart",{get:function(){this.D||(this.D=new q(this));return this.D}});Object.defineProperty(x.prototype,"onSceneLoadProgress",{get:function(){this.C||(this.C=new q(this));return this.C}});Object.defineProperty(x.prototype,"onSceneLoadComplete",{get:function(){this.G||(this.G=new q(this));return this.G}});
Object.defineProperty(x.prototype,"onSceneLoadError",{get:function(){this.I||(this.I=new q(this));return this.I}});Object.defineProperty(x.prototype,"onScenePreview",{get:function(){this.H||(this.H=new q(this));return this.H}});Object.defineProperty(x.prototype,"onGroupChange",{get:function(){this.j||(this.j=new q(this));return this.j}});
function F(a,b){this.i=a;this.f=b;this.o=null;this.D="#ffffff";this.B=1;this.c=this.m=this.u=null;this.j="";n.call(this,"Group");this.log("FORGE.Group._boot();");this.R=this.f.uid;this.jb=this.f.tags;aa(this);this.c=[];this.o=new D(this.i,this.f.name);this.u=new D(this.i,this.f.slug);this.m=new D(this.i,this.f.description);"string"===typeof this.f.color&&(this.D=this.f.color);"number"===typeof this.f.alpha&&(this.B=this.f.alpha);a=this.f;"undefined"!==typeof a.children&&!0===g.K.Pa(a.children,"string")?
this.c=a.children:this.warn("A group has no children in its configuration, or configuration is not valid!");"string"===typeof a["default"]&&(-1!==this.c.indexOf(a["default"])?this.j=a["default"]:this.warn("A group has a default child that is not in its children array!"))}F.prototype=Object.create(n.prototype);e=F.prototype;e.constructor=F;
e.load=function(a){this.log("FORGE.Group.load();");if(!this.c||!this.c.length)throw"Group.load() : can't load a group that have no children";var b;"undefined"===typeof a||null===a?b="string"===typeof this.j&&""!==this.j?this.j:this.c[0]:"number"===typeof a&&0<=a&&a<this.c.length?b=this.c[a]:"string"===typeof a?b=a:"object"===typeof a&&!0===this.Ve(a)&&(b=a.uid);if(-1===this.c.indexOf(b))throw'Group.load() : uid "'+b+'" is not in children of the group!';if(!0===g.S.W(b,"Scene")||!0===g.S.W(b,"Group"))g.S.get(b).load();
else throw"Impossible to load group child with uid "+b+", it seems to be neither a scene or a group!";};e.Ve=function(a){return"string"===typeof a?-1!==this.c.indexOf(a):!0===g.K.W(a,"Scene")||!0===g.K.W(a,"Group")?this.Ve(a.uid):!1};e.Wc=function(a){return"string"===typeof a&&g.S.W(a,"Scene")?-1!==this.c.indexOf(a):!0===g.K.W(a,"Scene")?this.Wc(a.uid):!1};e.wd=function(a){return"string"===typeof a&&g.S.W(a,"Group")?-1!==this.c.indexOf(a):!0===g.K.W(a,"Group")?this.wd(a.uid):!1};e.Vn=function(){return!!this.c.length};
e.og=function(a){for(var b,d=0,h=this.c.length;d<h;d++)if(b=this.c[d],g.S.W(b,a))return!0;return!1};e.We=function(){return this.og("Scene")};e.Ec=function(){return this.og("Group")};e.ud=function(a){if("string"!==typeof a)return this.c;for(var b=[],d=0,h=this.c.length;d<h;d++)g.S.W(this.c[d],a)&&b.push(this.c[d]);return b};e.oe=function(a){a=this.ud(a);return g.S.get(a)};
e.$k=function(){if(!1===this.We())this.warn("Can't do Group.nextScene() on this group that have no scenes!");else{var a=this.scenesUids,b=a.indexOf(this.i.tour.sceneUid),d;-1===b&&(g.S.W(this.j,"Scene")?d=this.j:d=a[0]);b+1<a.length?d=a[b+1]:-1!==b&&(d=a[0]);this.load(d)}};
e.al=function(){if(!1===this.We())this.warn("Can't do Group.previousScene() on this group that have no scenes!");else{var a=this.scenesUids,b=a.indexOf(this.i.tour.sceneUid),d;-1===b&&(g.S.W(this.j,"Scene")?d=this.j:d=a[0]);0<=b-1?d=a[b-1]:-1!==b&&(d=a[a.length-1]);this.load(d)}};e.destroy=function(){this.c=this.i=null;this.o.destroy();this.o=null;this.u.destroy();this.u=null;this.m.destroy();this.m=null;n.prototype.destroy.call(this)};Object.defineProperty(F.prototype,"config",{get:function(){return this.f}});
Object.defineProperty(F.prototype,"name",{get:function(){return this.o.value}});Object.defineProperty(F.prototype,"color",{get:function(){return this.D}});Object.defineProperty(F.prototype,"alpha",{get:function(){return this.B}});Object.defineProperty(F.prototype,"slug",{get:function(){return this.u.value}});Object.defineProperty(F.prototype,"description",{get:function(){return this.m.value}});Object.defineProperty(F.prototype,"childrenUids",{get:function(){return this.ud()}});
Object.defineProperty(F.prototype,"children",{get:function(){return this.oe()}});Object.defineProperty(F.prototype,"scenesUids",{get:function(){return this.ud("Scene")}});Object.defineProperty(F.prototype,"scenes",{get:function(){return this.oe("Scene")}});Object.defineProperty(F.prototype,"groupsUids",{get:function(){return this.ud("Group")}});Object.defineProperty(F.prototype,"groups",{get:function(){return this.oe("Group")}});
function E(a){this.i=a;this.c=null;this.D=0;this.B=!1;this.u=this.m=this.o=this.f=this.j=null;n.call(this,"Scene")}E.prototype=Object.create(n.prototype);e=E.prototype;e.constructor=E;e.Bl=function(a){this.B=!0;"string"===typeof a.data&&(a.data=JSON.parse(a.data));this.c.Jj(a.data);this.i.tour.yk(this);this.u&&this.u.F()};
e.ma=function(a){this.c=new G(this.i,a);this.R=this.c.uid;this.jb=this.c.tags;aa(this);!1===this.B&&"string"===typeof a.url&&""!==a.url?this.i.load.json(this.R,a.url,this.Bl,this):this.B=!0};e.load=function(){this.log("FORGE.Scene.load();");this.i.tour.scene!==this&&(this.j&&this.j.F(),this.D++,this.f&&this.f.F())};e.Le=function(){this.o&&this.o.F();this.m&&this.m.F()};e.wd=function(a){return"string"===typeof a&&!0===g.S.W(a,"Group")?g.S.get(a).Wc(this):!0===g.K.W(a,"Group")?a.Wc(this):!1};
e.Ec=function(){for(var a=this.i.tour.groups,b,d=0,h=a.length;d<h;d++)if(b=a[d],!0===b.Wc(this))return!0;return!1};e.destroy=function(){this.i=null;this.c&&(this.c.destroy(),this.c=null);this.j&&(this.j.destroy(),this.j=null);this.f&&(this.f.destroy(),this.f=null);this.o&&(this.o.destroy(),this.o=null);this.m&&(this.m.destroy(),this.m=null);n.prototype.destroy.call(this)};Object.defineProperty(E.prototype,"booted",{get:function(){return this.B}});Object.defineProperty(E.prototype,"config",{get:function(){return this.c}});
Object.defineProperty(E.prototype,"viewCount",{get:function(){return this.D}});Object.defineProperty(E.prototype,"viewed",{get:function(){return!!this.D}});Object.defineProperty(E.prototype,"name",{get:function(){return this.c.name}});Object.defineProperty(E.prototype,"slug",{get:function(){return this.c.slug}});Object.defineProperty(E.prototype,"description",{get:function(){return this.c.description}});
Object.defineProperty(E.prototype,"groupsUid",{get:function(){for(var a=this.i.tour.groups,b,d=[],h=0,k=a.length;h<k;h++)b=a[h],!0===b.Wc(this)&&d.push(b.uid);return d}});Object.defineProperty(E.prototype,"groups",{get:function(){return g.S.get(this.groupsUid)}});Object.defineProperty(E.prototype,"thumbnails",{get:function(){return this.c.thumbnails}});Object.defineProperty(E.prototype,"onLoadStart",{get:function(){this.j||(this.j=new q(this));return this.j}});
Object.defineProperty(E.prototype,"onLoadComplete",{get:function(){this.f||(this.f=new q(this));return this.f}});Object.defineProperty(E.prototype,"onUnloadStart",{get:function(){this.o||(this.o=new q(this));return this.o}});Object.defineProperty(E.prototype,"onUnloadComplete",{get:function(){this.m||(this.m=new q(this));return this.m}});Object.defineProperty(E.prototype,"onConfigLoadComplete",{get:function(){this.u||(this.u=new q(this));return this.u}});
function G(a,b){this.i=a;this.c=b;this.f=this.m=this.j=null;n.call(this,"SceneParser");this.R=this.c.uid;this.jb=this.c.tags;this.j=new D(this.i,this.c.name);this.m=new D(this.i,this.c.slug);this.f=new D(this.i,this.c.description)}G.prototype=Object.create(n.prototype);e=G.prototype;e.constructor=G;e.Jj=function(a){this.c=g.K.Cc(this.c,a)};
e.gk=function(){return"undefined"!==typeof this.c.sound&&"undefined"!==typeof this.c.sound.source&&("undefined"!==typeof this.c.sound.source.url&&""!==this.c.sound.source.url||"undefined"!==typeof this.c.sound.source.target&&""!==this.c.sound.source.target)?!0:!1};e.hk=function(a){return"undefined"!==typeof this.c.sound&&"undefined"!==typeof this.c.sound.source&&"undefined"!==typeof this.c.sound.source.target&&""!==this.c.sound.source.target&&this.c.sound.source.target===a?!0:!1};
e.nk=function(){return!0===this.gk()&&this.c.sound.type===g.lb.Ne?!0:!1};e.destroy=function(){this.i=null;this.j.destroy();this.j=null;this.m.destroy();this.m=null;this.f.destroy();this.f=null;n.prototype.destroy.call(this)};Object.defineProperty(G.prototype,"uid",{get:function(){return this.R}});Object.defineProperty(G.prototype,"name",{get:function(){return this.j.value}});Object.defineProperty(G.prototype,"slug",{get:function(){return this.m.value}});
Object.defineProperty(G.prototype,"description",{get:function(){return this.f.value}});Object.defineProperty(G.prototype,"tags",{get:function(){return this.jb}});Object.defineProperty(G.prototype,"thumbnails",{get:function(){return this.c.thumbnails}});Object.defineProperty(G.prototype,"media",{get:function(){return this.c.media}});Object.defineProperty(G.prototype,"sound",{get:function(){return this.c.sound}});Object.defineProperty(G.prototype,"fx",{get:function(){return this.c.fx}});
Object.defineProperty(G.prototype,"playlists",{get:function(){return this.c.playlists}});Object.defineProperty(G.prototype,"view",{get:function(){return this.c.view}});Object.defineProperty(G.prototype,"camera",{get:function(){return this.c.camera}});Object.defineProperty(G.prototype,"hotspots",{get:function(){return this.c.hotspots}});Object.defineProperty(G.prototype,"director",{get:function(){return this.c.director}});Object.defineProperty(G.prototype,"plugins",{get:function(){return this.c.plugins}});
Object.defineProperty(G.prototype,"audio",{get:function(){return this.c.audio}});g.Math={};g.Math.Wa="degrees";g.Math.Db="radians";g.Math.jh=Math.PI/180;g.Math.yi=180/Math.PI;g.Math.Fi=2*Math.PI;g.Math.ha=function(a){return a*g.Math.jh};g.Math.pc=function(a){return a*g.Math.yi};g.Math.Ed=function(a){return Math.round(10*a)/10};g.Math.ca=function(a,b,d){b="number"===typeof b&&!1===isNaN(b)?b:-Infinity;d="number"===typeof d&&!1===isNaN(d)?d:Infinity;return Math.min(Math.max(a,b),d)};
g.Math.eb=function(a,b,d){d-=b;return((a-b)%d+d)%d+b};g.Math.ko=function(a,b,d){return a*d+b*(1-d)};g.Math.ro=function(a,b,d){a=g.Math.ca((a-b)/(d-b),0,1);return a*a*(3-2*a)};g.Math.Hg=function(a){return{yaw:Math.atan2(-a.elements[2],a.elements[10]),pitch:Math.asin(-a.elements[6]),roll:Math.atan2(-a.elements[4],a.elements[5])}};
g.Math.le=function(a,b,d,h){var k=Math.cos(a);a=Math.sin(a);var l=Math.cos(-b);b=Math.sin(-b);var p=Math.cos(d);d=Math.sin(d);"undefined"===typeof h&&(h=!1);return h?(new THREE.Matrix4).set(k*p+a*b*d,-k*d+a*b*p,a*l,0,l*d,l*p,-b,0,-a*p+k*b*d,a*d+k*b*p,k*l,0,0,0,0,1):(new THREE.Matrix4).set(p*k-d*b*a,-d*l,p*a+d*b*k,0,d*k+p*b*a,p*l,d*a-p*b*k,0,-a*l,b,l*k,0,0,0,0,1)};g.Quaternion={};g.Quaternion.Ke=function(a){a=(new THREE.Euler).setFromQuaternion(a,"XYZ");return{yaw:a.x,pitch:-a.y,roll:a.z}};
g.Quaternion.Dc=function(a,b,d){"object"===typeof a&&(b=a.pitch,d=a.roll,a=a.yaw);return(new THREE.Quaternion).setFromEuler(new THREE.Euler(a,-b,d,"ZXY"))};g.Quaternion.Lk=function(a){a=g.Quaternion.Ke(a);return g.Math.le(a.yaw,a.pitch,a.roll)};g.Quaternion.On=function(a){return g.Quaternion.Dc(g.Math.Hg(a))};g.Quaternion.cancelRoll=function(a){a=g.Quaternion.Ke(a);return g.Quaternion.Dc(a.yaw,a.pitch,0)};g.Quaternion.Jn=function(a,b){return(new THREE.Quaternion).copy(a).inverse().multiply(b)};
g.Quaternion.vj=function(a,b){a=Math.abs(a.dot(b));return 1<=a?0:2*Math.acos(a)};g.Quaternion.multiplyScalar=function(a,b){return new THREE.Quaternion(a*b.x,a*b.y,a*b.z,a*b.w)};g.Quaternion.add=function(a,b){return new THREE.Quaternion(a.x+b.x,a.y+b.y,a.z+b.z,a.w+b.w)};g.Quaternion.log=function(a){var b=new THREE.Quaternion(0,0,0,0);if(1>Math.abs(a.w)){var d=Math.acos(a.w),h=Math.sin(d);0<h&&(b.x=d*a.x/h,b.y=d*a.y/h,b.z=d*a.z/h);return b}b.x=a.x;b.y=a.y;b.z=a.z;return b};
g.Quaternion.exp=function(a){var b=Math.sqrt(a.x*a.x+a.y*a.y+a.z*a.z),d=Math.sin(b),h=(new THREE.Quaternion).copy(a);h.w=Math.cos(b);Math.abs(d)>Number.EPSILON&&(h.x=d*a.x/b,h.y=d*a.y/b,h.z=d*a.z/b);return h};g.Quaternion.slerp=function(a,b,d){var h=new THREE.Quaternion;THREE.Quaternion.slerp(a,b,h,d);return h};g.Quaternion.uo=function(a,b,d,h,k,l){a=g.Quaternion.slerp(a,h,l);b=g.Quaternion.slerp(b,d,l);return g.Quaternion.slerp(a,b,2*l*(1-l))};
g.Quaternion.xk=function(a,b,d){return g.Quaternion.add(g.Quaternion.multiplyScalar(1-d,a),g.Quaternion.multiplyScalar(d,b)).normalize()};g.Quaternion.Ie=function(a,b,d){var h=a.dot(b);if(.95<=Math.abs(h))return g.Quaternion.xk(a,b,d);h=Math.acos(h);return g.Quaternion.multiplyScalar(1/Math.sin(h),g.Quaternion.add(g.Quaternion.multiplyScalar(Math.sin(h*(1-d)),a),g.Quaternion.multiplyScalar(Math.sin(h*d),b)))};
g.Quaternion.Jk=function(a,b,d,h,k){a=g.Quaternion.Ie(a,h,k);b=g.Quaternion.Ie(b,d,k);return g.Quaternion.Ie(a,b,2*k*(1-k))};g.Quaternion.Og=function(a,b,d){var h=(new THREE.Quaternion).copy(b).conjugate();a=(new THREE.Quaternion).copy(h).multiply(a);d=(new THREE.Quaternion).copy(h).multiply(d);h=g.Quaternion.log(a);d=g.Quaternion.log(d);d=g.Quaternion.add(h,d);d=g.Quaternion.multiplyScalar(-.25,d);d=g.Quaternion.exp(d);return(new THREE.Quaternion).copy(b).multiply(d).normalize()};
function Ba(a,b,d,h){this.R="number"===typeof a?a:0;this.j="number"===typeof b?b:0;this.f="number"===typeof d?d:0;this.c="number"===typeof h?h:0}Ba.prototype.constructor=Ba;Object.defineProperty(Ba.prototype,"x",{get:function(){return this.R},set:function(a){"number"===typeof a&&(this.R=a)}});Object.defineProperty(Ba.prototype,"y",{get:function(){return this.j},set:function(a){"number"===typeof a&&(this.j=a)}});
Object.defineProperty(Ba.prototype,"width",{get:function(){return this.f},set:function(a){"number"===typeof a&&(this.f=a)}});Object.defineProperty(Ba.prototype,"height",{get:function(){return this.c},set:function(a){"number"===typeof a&&(this.c=a)}});Object.defineProperty(Ba.prototype,"center",{get:function(){return new THREE.Vector2(this.R+.5*this.f,this.j+.5*this.c)}});Object.defineProperty(Ba.prototype,"origin",{get:function(){return new THREE.Vector2(this.R,this.j)}});
Object.defineProperty(Ba.prototype,"size",{get:function(){return new Ca(this.f,this.c)}});function Ca(a,b){this.f=a||0;this.c=b||0}Ca.prototype.constructor=Ca;Object.defineProperty(Ca.prototype,"width",{get:function(){return this.f}});Object.defineProperty(Ca.prototype,"height",{get:function(){return this.c}});Object.defineProperty(Ca.prototype,"ratio",{get:function(){return this.f/this.c}});g.ub={};g.ub.IMAGE="image";g.ub.VIDEO="video";g.Oa={};g.Oa.cd="equi";g.Oa.Kd="cube";g.Oa.mh="flat";
g.Oa.Tl="hotspot";
function Da(a,b){this.i=a;this.j=b;this.c=this.N=this.f=null;n.call(this,"Media");a=this.j;this.warn("FORGE.Media config validator not implemented");a=a.media;this.R=a.uid;b=a.source;if(!b)throw"No source specified !";if(a.type===g.ub.IMAGE){if(!b.url)throw"Multi resolution not implemented yet !";if(b.format===g.Oa.cd)b={key:this.R,url:b.url},this.N=new H(this.i,b);else if(b.format===g.Oa.Kd)b={key:this.R,url:b.url},this.N=new H(this.i,b);else if(b.format===g.Oa.mh)throw"Flat media not supported yet !";this.N.onLoadComplete.ga(this.o,
this)}else if(a.type===g.ub.VIDEO){if(Array.isArray(b.levels)){b.url=[];for(var d=0,h=b.levels.length;d<h;d++)b.url.push(b.levels[d].url)}"undefined"!==typeof b.streaming&&b.streaming.toLowerCase()===g.nb.Pe?this.N=new I(this.i,this.R):this.N=new J(this.i,this.R,null,null,!0===this.j.hk(this.R)&&!0===this.j.nk()?!0:!1);this.N.load(b.url);this.N.onLoadedMetaData.ga(this.m,this)}this.f="undefined"!==typeof a.options?a.options:null}Da.prototype=Object.create(n.prototype);Da.prototype.constructor=Da;
Da.prototype.o=function(){this.c&&this.c.F()};Da.prototype.m=function(){this.f&&(this.N.volume="number"===typeof this.f.volume?this.f.volume:1,this.N.loop="boolean"===typeof this.f.loop?this.f.loop:!0,!0===this.f.autoPlay&&this.N.play());this.c&&this.c.F()};Da.prototype.destroy=function(){this.N&&(this.N.destroy(),this.N=null);this.c&&(this.c.destroy(),this.c=null);this.j=this.i=null};Object.defineProperty(Da.prototype,"displayObject",{get:function(){return this.N}});
Object.defineProperty(Da.prototype,"onLoadComplete",{get:function(){this.c||(this.c=new q(this));return this.c}});function y(a){this.i=a;this.c=this.B=this.u=this.m=this.G=this.f=this.o=this.I=null;this.T=g.Za.Sd;this.j=this.H=this.J=this.fa=this.C=null;this.V=this.O=this.P=!1;this.$=this.Z=this.L=this.M=null;n.call(this,"RenderManager");this.D=new THREE.Clock;this.i.onReady.add(this.ai,this,1E3)}y.prototype=Object.create(n.prototype);e=y.prototype;e.constructor=y;
e.ai=function(){var a={antialias:!0,alpha:!0,premultipliedAlpha:!1,stencil:!0,canvas:this.i.canvas.dom};try{this.I=new THREE.WebGLRenderer(a)}catch(b){this.destroy();return}this.I.autoClear=!1;this.I.autoClearDepth=!0;this.I.autoClearColor=!0;this.B=new Ea(this.i);this.f=new Fa(this.i);this.H=new Ga(this.i);this.o=new Ha(this.i);this.f.onDisplayChange.add(this.aj,this);Ia(this,this.f.rendererSize);this.C=new K(this.i);this.i.canvas.onResize.add(this.Gi,this);this.i.tour.onSceneLoadStart.add(this.$h,
this)};
e.$h=function(){this.i.tour.scene.onUnloadStart.ga(this.fn,this);this.j=this.i.tour.scene.config;"undefined"!==typeof this.j.background&&(this.i.container.background=this.j.background);this.H.Aj();this.o.rj(this.H.renderScenes);var a=g.K.pb(this.i.config.view,this.j.view);switch("string"===typeof a.type?a.type.toLowerCase():g.Ia.Ob){case g.Ia.wc:this.Fd(g.Ia.wc);break;default:this.Fd(g.Ia.Ob)}a=g.K.pb(this.i.config.camera,this.j.camera);this.C.load(a);a=this.j;"undefined"!==typeof a.media&&"undefined"!==
typeof a.media.source?(this.T=a.media.source.format===g.Oa.Kd?g.Za.Qd:g.Za.Rd,this.m=new Da(this.i,a),this.m.onLoadComplete.ga(this.Im,this),g.K.W(this.m.displayObject,["VideoHTML5","VideoDash"])&&this.m.displayObject.onQualityChange.add(this.ff,this),this.Z&&this.Z.F()):Ja(this);a=this.j;if("undefined"!==typeof a.sound&&"undefined"!==typeof a.sound.source){var b,d,h,k;"undefined"!==typeof a.sound.options&&(b="number"===typeof a.sound.options.volume?g.Math.ca(a.sound.options.volume,0,1):1,d="boolean"===
typeof a.sound.options.loop?a.sound.options.loop:!1,h="number"===typeof a.sound.options.startTime?a.sound.options.startTime:0,k="boolean"===typeof a.sound.options.autoPlay?a.sound.options.autoPlay:!1);"undefined"!==typeof a.sound.source.url&&""!==a.sound.source.url&&(this.u=new L(this.i,a.sound.uid,a.sound.source.url,a.sound.type===g.lb.Ne?!0:!1),"undefined"!==typeof a.sound.options&&(this.u.volume=b,this.u.loop=d,this.u.startTime=h,!0===k&&this.u.play(this.u.startTime,this.u.loop,!0)))}};
e.fn=function(){this.V=this.P=this.O=!1;this.H&&this.H.df();this.B&&this.B.Ih();this.o&&this.o.gf();this.u&&(this.u.destroy(),this.u=null);this.m&&(!0===g.K.W(this.m.displayObject,["VideoHTML5","VideoDash"])&&void 0!==this.m.displayObject.onQualityChange&&this.m.displayObject.onQualityChange.has(this.ff,this)&&this.m.displayObject.onQualityChange.remove(this.ff,this),this.$&&this.$.F(),this.m.destroy(),this.m=null)};
e.Im=function(a){this.log("Media load is complete");Ka(this,this.T);this.c.displayObject=a.emitter.displayObject;a=null;"undefined"!==typeof this.j.media.fx&&null!==this.j.media.fx&&(a=this.i.postProcessing.pe(this.j.media.fx));this.o.pj(this.c.renderTarget.texture,a);"undefined"!==typeof this.j.fx&&this.o.qj(this.i.postProcessing.pe(this.j.fx))};e.ff=function(a){this.log("Media quality has changed");this.c.displayObject=a.emitter};
function Ia(a,b){a.log("Renderer size: "+b.width+"x"+b.height);var d=a.f.presentingVR,h=!0;!0===d&&(h=!1);!1===d&&a.f.setSize(b);a.I.setSize(b.width,b.height,h);a.fa=b;a.J=new Ca(b.width*(d?.5:1),b.height);a.c&&a.c.setSize(a.J);a.B.setSize(a.J);a.o.setSize(a.J);a.log("Render size change in "+(d?"VR":"screen")+" mode, resolution: "+a.J.width+"x"+a.J.height)}e.Gi=function(){this.log("_canvasResizeHandler");var a=this.i.canvas.dom;Ia(this,new Ca(a.width,a.height))};
e.aj=function(){Ia(this,this.f.rendererSize);this.B.mode=!0===this.f.presentingVR?La.Mc:La.kb};
function Ka(a,b){var d=null,h=null;a.c&&(null!==a.c.displayObject&&(d=a.c.displayObject),null!==a.c.renderTarget&&(h=a.c.renderTarget));Ja(a);b===g.Za.Rd?(a.c=new Ma(a.i,h),h=a.I.getSize(),Ia(a,new Ca(h.width,h.height))):b===g.Za.Qd&&(b={order:a.j.media.source.order||"RLUDFB",tile:a.j.media.source.tile},b.io=a.j.media.source.format,a.c=new Na(a.i,h,b));null!==d&&(a.c.displayObject=d);a.P=!0;a.M&&a.M.F()}function Ja(a){a.c&&(a.c.destroy(),a.c=null);a.P=!1}
e.render=function(){if(!1!==this.P&&!1!==this.O&&this.o&&!0===this.P){var a=this.f.presentingVR,b=this.f.Xj();this.C.update();for(var d=0,h=b.length;d<h;d++){var k=b[d],l=k.rectangle,k=k.camera;this.I.setViewport(l.origin.x,l.origin.y,l.size.width,l.size.height);this.c&&this.c.render((a?k:null)||null);this.o.render(k);this.I.clearDepth();!0===a&&(l=new THREE.Scene,l.add(k),this.I.render(l,k))}!0===this.f.presentingVR&&this.f.Zh()}};e.screenToWorld=function(a){return this.G.screenToWorld(a)};
e.worldToScreen=function(a,b){return this.G.worldToScreen(a,b||0)};e.Al=function(a){this.f.presentingVR!==a&&(this.f.Yh(a),this.j.media.source.format===g.Oa.cd&&(this.T=!0===a?g.Za.Qd:g.Za.Rd,Ka(this,this.T)))};
e.Fd=function(a){this.log("setView");this.O=!1;this.G&&(this.log("Destroy previous view"),this.G.destroy(),this.G=null);if(a===g.Ia.Ob)this.G=new Oa(this.i,this.C);else if(a===g.Ia.wc)this.G=new Pa(this.i,this.C);else throw"View type not supported "+a;this.c&&this.c.vc();this.O=!0;this.B.Qk(a);a===g.Ia.Ob?this.o.hg(!1):this.o.hg(!0,this.B.material,this.B.renderTarget);this.onViewReady.F()};
e.destroy=function(){this.i.canvas.onResize.remove(this.Gi,this);this.i.tour.onSceneLoadStart.remove(this.$h,this);this.i.onReady.remove(this.ai,this);this.B&&(this.B.destroy(),this.B=null);this.M&&(this.M.destroy(),this.M=null);this.L&&(this.L.destroy(),this.L=null);null!==this.U&&(this.U.destroy(),this.U=null);this.u&&(this.u.destroy(),this.u=null);this.m&&(this.m.destroy(),this.m=null);this.H&&(this.H.destroy(),this.H=null);this.G&&(this.G.destroy(),this.G=null);this.c&&(this.c.destroy(),this.c=
null);this.C&&(this.C.destroy(),this.C=null);this.f&&(this.f.onDisplayChange.remove(this.aj,this),this.f.destroy(),this.f=null);this.o&&(this.o.destroy(),this.o=null);this.I=this.j=this.D=null;n.prototype.destroy.call(this)};Object.defineProperty(y.prototype,"viewer",{get:function(){return this.i}});Object.defineProperty(y.prototype,"media",{get:function(){return this.m}});Object.defineProperty(y.prototype,"mediaSound",{get:function(){return this.u}});
Object.defineProperty(y.prototype,"webGLRenderer",{get:function(){return this.I}});Object.defineProperty(y.prototype,"renderPipeline",{get:function(){return this.o}});Object.defineProperty(y.prototype,"backgroundRenderer",{get:function(){return this.c}});Object.defineProperty(y.prototype,"pickingManager",{get:function(){return this.B}});
Object.defineProperty(y.prototype,"view",{get:function(){return this.G},set:function(a){if("string"===typeof a&&""!==a)switch(a){case g.Ia.wc:this.Fd(g.Ia.wc);break;case g.Ia.Ob:this.Fd(g.Ia.Ob);break;default:throw"View type not supported: "+a;}}});Object.defineProperty(y.prototype,"camera",{get:function(){return this.C}});Object.defineProperty(y.prototype,"canvasResolution",{get:function(){return this.fa}});Object.defineProperty(y.prototype,"displayResolution",{get:function(){return this.J}});
Object.defineProperty(y.prototype,"presentingVR",{get:function(){return this.f.presentingVR}});Object.defineProperty(y.prototype,"display",{get:function(){return this.f}});Object.defineProperty(y.prototype,"backgroundReady",{get:function(){return this.P}});Object.defineProperty(y.prototype,"onBackgroundReady",{get:function(){this.M||(this.M=new q(this,!0));return this.M}});Object.defineProperty(y.prototype,"viewReady",{get:function(){return this.O}});
Object.defineProperty(y.prototype,"onViewReady",{get:function(){this.L||(this.L=new q(this,!0));return this.L}});Object.defineProperty(y.prototype,"objects",{get:function(){return this.H}});Object.defineProperty(y.prototype,"hotspotsReady",{get:function(){return this.V}});Object.defineProperty(y.prototype,"onHotspotsReady",{get:function(){null===this.U&&(this.U=new q(this,!0));return this.U}});Object.defineProperty(y.prototype,"onMediaReady",{get:function(){this.Z||(this.Z=new q(this));return this.Z}});
Object.defineProperty(y.prototype,"onMediaRelease",{get:function(){this.$||(this.$=new q(this));return this.$}});
function Qa(a,b,d,h){this.i=a;this.j=b;this.m=d;this.o=h;this.f=this.c=null;n.call(this,"RenderScene");this.c=new Ra(g.ab.ic,this.i.renderer.webGLRenderer);a=new Sa(this.j,this.m);a.position=g.Ma.ic;this.c.addPass(a);a=this.i.postProcessing.Ee(this.o);b=0;for(d=a.length;b<d;b++)h=a[b],h.renderToScreen=!1,h.position=g.Ma.ic,this.c.addPass(h);this.f=new Ra(g.ab.xf,this.i.renderer.webGLRenderer);a=new Sa(this.j,this.m);a.position=g.Ma.ic;this.f.addPass(a)}Qa.prototype=Object.create(n.prototype);
Qa.prototype.constructor=Qa;Qa.prototype.setSize=function(a,b){this.c.setSize(a,b);this.f.setSize(a,b)};Qa.prototype.destroy=function(){this.c.readBuffer.dispose();for(this.c.writeBuffer.dispose();0<this.c.passes.length;){var a=this.c.passes.pop();a instanceof Ta&&a.hasOwnProperty("tDiffuse")&&(a.uniforms.tDiffuse.value.texture.dispose(),a.uniforms.tDiffuse.value=null)}this.c=null;this.f.passes.length=0;this.o=this.m=this.j=this.i=this.f=null;n.prototype.destroy.call(this)};
Object.defineProperty(Qa.prototype,"scene",{get:function(){return this.j}});Object.defineProperty(Qa.prototype,"camera",{get:function(){return this.m}});Object.defineProperty(Qa.prototype,"sceneComposer",{get:function(){return this.c}});Object.defineProperty(Qa.prototype,"pickingComposer",{get:function(){return this.f}});function Ha(a){this.i=a;this.D=this.f=this.c=null;this.j=!0;n.call(this,"RenderPipeline");this.D=new THREE.Clock;this.f=[];this.c=new Ra(g.ab.pi,this.i.renderer.webGLRenderer)}
Ha.prototype=Object.create(n.prototype);e=Ha.prototype;e.constructor=Ha;
function Ua(a,b){a.log("COMPOSER: "+b.name);if(b.passes.length){for(var d=[],h=0,k=b.passes.length;h<k;h++){var l;l=b.passes[h];l=l instanceof Ta?l.hasOwnProperty("map")?"Texture("+l.map.uuid.split("-")[0].slice(0,4)+")":"Texture":l instanceof Sa?"Render":l instanceof THREE.ClearMaskPass?"ClearMask":l instanceof THREE.MaskPass?"Mask":l instanceof Va?"Shader("+l.type.replace("Shader","")+")":"Pass";d.push(l)}h="";k=0;for(l=d.length;k<l;k++){for(var p=d[k],h=h+"| ",r=0;r<p.length;r++)h+="-";h+=" |";
if(k<l-1)for(p=0;5>p;p++)h+=" "}a.log(h);k="";l=0;for(p=d.length;l<p;l++)k+="| "+d[l]+" |",l<p-1&&(k+=" --- ");!1===b.passes[b.passes.length-1].renderToScreen&&(k+=" --- tex",b.readBuffer&&"undefined"!==typeof b.readBuffer.name&&(k+="("+b.readBuffer.name+")"));a.log(k);a.log(h)}}function Wa(a){for(var b=0,d=a.f.length;b<d;b++)Ua(a,a.f[b]);Ua(a,a.c)}function Xa(a,b,d){a.f.push(b);!1===d&&(b=new Ya(b),a.c.addPass(b));Za(a)}
function $a(a,b,d){d="undefined"!==typeof d?d:a.passes.length;if(Array.isArray(b))for(var h=b.length-1;0<=h;h--)a.insertPass(b[h],d);else b instanceof THREE.Pass&&a.insertPass(b,d)}
function Za(a){var b=a.c.passes,d=[];b.filter(function(a,b){a.position===g.Ma.Id&&d.push(b)});if(0<d.length&&0<d[0]){for(var h=[],k=d.length-1;0<=k;k--){var l=b.splice(d[k],1)[0];h.push(l)}k=0;for(l=h.length;k<l;k++)a.c.insertPass(h[k],0)}var p=[];b.filter(function(a,b){a.position===g.Ma.lf&&p.push(b)});if(0<p.length&&p[p.length-1]<b.length-1){h=[];k=0;for(l=p.length;k<l;k++){var r=b.splice(p[k],1)[0];h.push(r)}k=0;for(l=h.length;k<l;k++)a.c.addPass(h[k])}h=0;for(k=a.f.length;h<k;h++){var l=a.f[h],
r=!1,u,A=a.f.length;for(u=0;u<A;u++)if(u!==h&&l.readBuffer===a.f[u].readBuffer){r=!0;break}r=r&&h>u;u=0;for(A=l.passes.length;u<A;u++)l.passes[u].clear=!0===r?!1:!u}h=!1;for(k=b.length-1;0<=k;k--)l=b[k],!0===h?l.renderToScreen=!1:!0===l.enabled&&(h=l.renderToScreen=!0);Wa(a)}e.hg=function(a,b,d){for(var h=0,k=this.f.length;h<k;h++){var l=this.f[h];l.type===g.ab.xf&&(l.enabled=a,"undefined"!==typeof b&&(l.passes[0].overrideMaterial=b),"undefined"!==typeof d&&(l.renderTarget=d))}};
e.pj=function(a,b){if("undefined"!==typeof b&&b&&0<b.length){b=this.i.postProcessing.Ee(b);for(var d=0,h=b.length;d<h;d++)b[d].position=g.Ma.Id;$a(this.c,b,0)}a=new Ta(a);a.position=g.Ma.Id;this.c.insertPass(a,0);Za(this)};e.rj=function(a){for(var b=0,d=a.length;b<d;b++)Xa(this,a[b].sceneComposer,!1),Xa(this,a[b].pickingComposer,!0);Za(this)};e.qj=function(a){a=this.i.postProcessing.Ee(a);for(var b=0,d=a.length;b<d;b++)a[b].position=g.Ma.lf;$a(this.c,a);Za(this)};
e.Tn=function(a){if(this.c)for(var b=0,d=this.c.passes.length;b<d;b++){var h=this.c.passes[b];if(h.uid===a)return h}if(this.f)for(b=0,d=this.f.length;b<d;b++)for(var h=this.f[b],k=0,l=h.passes.length;k<l;k++){var p=h.passes[k];if(p.uid===a)return p}return null};
e.setSize=function(a){for(var b=0,d=this.f.length;b<d;b++){var h=this.f[b];h.setSize(a.width,a.height);for(var k=0,l=h.passes.length;k<l;k++){var p=h.passes[k];p instanceof THREE.ShaderPass&&"undefined"!==typeof p.uniforms.resolution&&(p.uniforms.resolution.value=new THREE.Vector2(1/a.width,1/a.height))}}this.c.setSize(a.width,a.height);k=0;for(l=this.c.passes.length;k<l;k++)p=this.c.passes[k],p instanceof THREE.ShaderPass&&"undefined"!==typeof p.uniforms.resolution&&(p.uniforms.resolution.value=
new THREE.Vector2(1/a.width,1/a.height))};
e.render=function(a){if(this.c){for(var b=0,d=this.c.passes.length;b<d;b++){var h=this.c.passes[b];if(h instanceof Ya){var k=h.composer,l=k.readBuffer.texture;!0===k.passes[k.passes.length-1].needsSwap&&(l=k.writeBuffer.texture);h.uniforms.tAdd.value=l}}b=this.D.getDelta();d=this.f.concat(this.c);h=0;for(k=d.length;h<k;h++)for(var l=d[h],p=0,r=l.passes.length;p<r;p++){var u=l.passes[p];u instanceof Sa&&(u.camera=a)}a=0;for(d=this.f.length;a<d;a++)this.f[a].enabled&&this.f[a].render(b);this.c.render(b)}};
e.gf=function(){if(this.c){this.c.readBuffer.dispose();this.c.writeBuffer.dispose();for(var a=0,b=this.c.passes.length;a<b;a++){var d=this.c.passes[a];d instanceof Va&&d.uniforms.hasOwnProperty("tAdd")&&(d.uniforms.tAdd.value=null)}this.c.passes=[]}this.f=[]};
e.destroy=function(){this.gf();this.D=null;for(var a=this.f.length-1;0<a;a--){for(var b=this.f[a],d=0,h=b.passes.length;d<h;d++){var k=b.passes[d];"function"===typeof k.destroy&&k.destroy()}b.passes.length=0}this.f=null;d=0;for(h=this.c.passes.length;d<h;d++)k=this.c.passes[d],"function"===typeof k.destroy&&k.destroy();this.c.passes.length=0;this.i=this.c=null};
Object.defineProperty(Ha.prototype,"enabled",{get:function(){return this.j},set:function(a){for(var b=this.f.concat(this.c),d=0,h=b.length;d<h;d++){var k=b[d],l=a;!1===l&&(this.j=!1);for(var p=k.passes.length-1;0<=p;p--){var r=k.passes[p];r instanceof THREE.ShaderPass&&!(r instanceof Ya)&&(r.enabled=l)}k.hasOwnProperty("enabled")&&(k.enabled=l);Za(this)}this.j=a}});
function Fa(a){this.i=a;this.o=this.G=!1;this.u=this.f=this.m=this.j=this.c=null;this.I=1;this.D=this.B=null;n.call(this,"RenderDisplay");ab(this)}Fa.prototype=Object.create(n.prototype);e=Fa.prototype;e.constructor=Fa;
function ab(a){var b=a.i.renderer.webGLRenderer;a.I=b.getPixelRatio();a.u=b.getSize();a.f=a.u;a.j=[0,0,.5,1];a.m=[.5,0,.5,1];"VRFrameData"in window&&(a.B=new VRFrameData);!0===g.A.Yg?(navigator.getVRDisplays().then(function(b){a.G=0<b.length;for(var d=0,k=b.length;d<k;d++)if("VRDisplay"in window&&b[d]instanceof VRDisplay){a.c=b[d];break}}),bb(a)):a.warn("missing api navigator.getVRDisplays")}
function bb(a){a.i.container.onFullscreenEnter.add(a.Uc,a);a.i.container.onFullscreenExit.add(a.Uc,a);window.addEventListener("vrdisplaypresentchange",a.Uc.bind(a),!1)}
e.Uc=function(){var a=this.o,b=this.i.renderer.webGLRenderer;this.o="undefined"!==typeof this.c&&(!0===this.c.isPresenting||!1===this.G&&document[g.A.fullscreenElement]instanceof window.HTMLElement);if(!0===this.o){var d=this.c.getEyeParameters("left");!0===this.G&&(this.H=d.renderWidth,this.C=d.renderHeight,this.log("Window size: "+window.innerWidth+"x"+window.innerHeight),this.log("Render size: "+this.H+"x"+this.C),this.j=[0,0,.5,1],this.m=[.5,0,.5,1],this.c.getLayers&&(d=this.c.getLayers(),0<d.length&&
d[0].leftBounds&&4===d[0].leftBounds.length&&(this.j=d[0].leftBounds,this.m=d[0].rightBounds)),this.log("Bounds L:["+this.j[0]+", "+this.j[1]+", "+this.j[2]+", "+this.j[3]+"], R:["+this.m[0]+", "+this.m[1]+", "+this.m[2]+", "+this.m[3]+"]"));!1===a&&(this.I=b.getPixelRatio(),this.u=b.getSize(),this.f=new Ca(2*this.H,this.C),b.setPixelRatio(1))}else!0===a&&(this.f=this.u,b.setPixelRatio(this.I));this.o!==a&&this.D&&this.D.F()};
function cb(a,b){var d=a.i.renderer.webGLRenderer.domElement;new Promise(function(a,k){"undefined"===typeof this.c?k(Error("No VR hardware found.")):this.o===b?a():!0===this.G&&(b?a(this.c.requestPresent([{source:d}])):a(this.c.exitPresent()))}.bind(a))}e.Yh=function(a){!0===a?(this.i.raf.stop(),this.i.raf.start(this.c),cb(this,!0)):(this.i.raf.stop(),this.i.raf.start(window),cb(this,!1))};
e.Vj=function(){if(!this.c)return null;var a=new THREE.Quaternion;if("function"===typeof this.c.getPose){var b=this.c.getPose();b.orientation&&(a=b.orientation,a=new THREE.Quaternion(-a[1],-a[0],-a[2],a[3]))}return a};
e.Xj=function(){var a=this.i.renderer.camera,b=[];if("undefined"!==typeof this.c&&this.c&&!0===this.o){var d=this.f.width*this.j[0],h=this.f.height*this.j[1],k=this.f.width*this.j[2],l=this.f.height*this.j[3],p=new Ba(d,h,k,l),d=this.f.width*this.m[0],h=this.f.height*this.m[1],k=this.f.width*this.m[2],l=this.f.height*this.m[3],d=new Ba(d,h,k,l);b.push(new db(p,a.left));b.push(new db(d,a.right))}else b.push(new db(new Ba(0,0,this.u.width,this.u.height),a.main));return b};
e.setSize=function(a){this.u=a;this.i.renderer.webGLRenderer.setPixelRatio(1)};e.Zh=function(){!0===this.G&&"undefined"!==typeof this.c&&!0===this.o&&!0===this.c.capabilities.hasExternalDisplay&&this.c.submitFrame()};e.destroy=function(){this.i.container.onFullscreenEnter.remove(this.Uc,this);this.i.container.onFullscreenExit.remove(this.Uc,this);window.removeEventListener("vrdisplaypresentchange",this.Uc.bind(this));this.i=this.f=this.m=this.j=this.B=this.c=null};
Object.defineProperty(Fa.prototype,"presentingVR",{get:function(){return this.o}});Object.defineProperty(Fa.prototype,"vrDisplay",{get:function(){return this.c}});Object.defineProperty(Fa.prototype,"vrFrameData",{get:function(){return this.c&&"function"===typeof this.c.getFrameData&&this.B?(this.c.getFrameData(this.B),this.B):null}});Object.defineProperty(Fa.prototype,"rendererSize",{get:function(){return this.f}});
Object.defineProperty(Fa.prototype,"onDisplayChange",{get:function(){this.D||(this.D=new q(this));return this.D}});function db(a,b){this.f=a||null;this.c=b||null}db.prototype.constructor=db;Object.defineProperty(db.prototype,"rectangle",{get:function(){return this.f}});Object.defineProperty(db.prototype,"camera",{get:function(){return this.c}});function eb(a,b,d){this.i=a;this.I=this.j=this.f=null;this.B=b||null;n.call(this,d||"BackgroundRenderer");this.ed()}eb.prototype=Object.create(n.prototype);
e=eb.prototype;e.constructor=eb;e.ed=function(){this.j=new THREE.Scene;this.B||(this.B=new THREE.WebGLRenderTarget(this.i.renderer.canvasResolution.width,this.i.renderer.canvasResolution.height,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,Go:!1}))};e.vc=function(){throw Error(this.fb+"::updateAfterViewChange not implemented");};e.setSize=function(a){null!==this.renderTarget&&this.renderTarget.setSize(a.width,a.height)};
e.render=function(a){if(null!==this.i.renderer&&this.B){if(this.f.material instanceof THREE.ShaderMaterial){var b=this.i.renderer.displayResolution;this.f.material.uniforms.hasOwnProperty("tViewportResolution")&&(this.f.material.uniforms.tViewportResolution.value=new THREE.Vector2(b.width,b.height));this.f.material.uniforms.hasOwnProperty("tViewportResolutionRatio")&&(this.f.material.uniforms.tViewportResolutionRatio.value=b.ratio);this.f.material.uniforms.hasOwnProperty("tModelViewMatrixInverse")&&
(this.f.material.uniforms.tModelViewMatrixInverse.value=this.i.renderer.camera.modelViewInverse);this.i.renderer.view.Gc(this.f.material.uniforms)}a?this.i.renderer.webGLRenderer.render(this.j,a,this.B,!0):this.i.renderer.webGLRenderer.render(this.j,this.I,this.B,!0)}};e.destroy=function(){this.I=null;this.B&&(this.B.dispose(),this.B=null);for(;0<this.j.children.length;){var a=this.j.children.pop();null!==a.geometry&&(a.geometry.dispose(),a.geometry=null);this.j.remove(a)}this.i=this.j=null;n.prototype.destroy.call(this)};
Object.defineProperty(eb.prototype,"renderTarget",{get:function(){return this.B}});Object.defineProperty(eb.prototype,"displayObject",{get:function(){return this.N},set:function(a){null===a?this.Xd():this.gj(a)}});g.Za={};g.Za.Sd="undefined";g.Za.Rd="shader";g.Za.Qd="mesh";function Na(a,b,d){this.D=this.u=this.c=this.N=null;this.J=d.order||"RLUDFB";this.m=new THREE.Vector2(0,0);this.M=d.tile;this.H=d.io||g.Oa.Kd;this.o=this.G=0;this.C=1;eb.call(this,a,b,"BackgroundMeshRenderer")}Na.prototype=Object.create(eb.prototype);
e=Na.prototype;e.constructor=Na;e.ed=function(){eb.prototype.ed.call(this);this.I=this.i.renderer.camera.main;this.i.renderer.camera.fovMin=this.i.renderer.view.fovMin;this.i.renderer.camera.fovMax=this.i.renderer.view.fovMax;this.G=1E3;this.o=32;this.vc()};
e.gj=function(a){this.N=a;if(g.K.W(a,"Image"))this.c=new THREE.Texture,this.c.image=a.element;else if(g.K.W(a,"Canvas"))this.c=new THREE.Texture,this.c.image=a.element;else if(g.K.W(a,["VideoHTML5","VideoDash"]))"safari"===g.A.Bb.toLowerCase()&&1440<a.originalHeight&&(this.C=2),this.u=document.createElement("canvas"),this.u.width=a.originalWidth/this.C,this.u.height=a.originalHeight/this.C,this.D=this.u.getContext("2d"),this.c=new THREE.Texture(this.u);else throw"Wrong type of display object "+a.type;
this.c.format=THREE.RGBAFormat;this.c.mapping=THREE.Texture.DEFAULT_MAPPING;this.c.magFilter=THREE.LinearFilter;this.c.minFilter=THREE.LinearFilter;this.c.wrapS=THREE.ClampToEdgeWrapping;this.c.wrapT=THREE.ClampToEdgeWrapping;this.c.generateMipmaps=!1;this.c.needsUpdate=!0;this.m.x=this.c.image.width/this.M;this.m.y=this.c.image.height/this.M;this.f.onBeforeRender=this.Uk.bind(this);this.H!==g.Oa.cd&&this.f.geometry.attributes.uv.set(fb(this))};
e.Uk=function(){this.f.material.uniforms.tTexture.value=this.c};
function fb(a){function b(a,b,k,ic,Ob){if(-1===a)throw"Unknown face for cube mapping.";var A,ob=a%b/b;a=1-(1+parseInt(a/b,10))/k;if(Ob)for(Ob=0,k=ic;Ob<=k;Ob++)for(b=0,A=ic;b<=A;b++)d[h.next().value]=r+l*b+ob,d[h.next().value]=u+p*Ob+a;else for(Ob=0,k=ic;Ob<=k;k--)for(b=0,A=ic;b<=A;A--)d[h.next().value]=r+l*A+ob,d[h.next().value]=u+p*k+a}var d=new Float32Array((a.o+1)*(a.o+1)*12),h=d.keys(),k=a.J.split(""),l=1/1.01*(1/a.m.x/a.o),p=1/1.01*(1/a.m.y/a.o),r=1/a.m.x*.005,u=1/a.m.y*.005;b(k.indexOf("R"),
a.m.x,a.m.y,a.o);b(k.indexOf("L"),a.m.x,a.m.y,a.o);b(k.indexOf("U"),a.m.x,a.m.y,a.o,!0);b(k.indexOf("D"),a.m.x,a.m.y,a.o,!0);b(k.indexOf("B"),a.m.x,a.m.y,a.o);b(k.indexOf("F"),a.m.x,a.m.y,a.o);return d}
e.render=function(a){if(null!==this.i.renderer){if(this.c&&this.u&&this.D&&this.N&&null!==this.N.element){var b=this.N.element;b&&b instanceof HTMLVideoElement&&b.readyState===b.HAVE_ENOUGH_DATA&&this.D&&(this.D.drawImage(b,0,0,b.videoWidth,b.videoHeight,0,0,this.u.width,this.u.height),this.c.needsUpdate=!0,this.log("texture update done"))}eb.prototype.render.call(this,a)}};e.Xd=function(){this.i.renderer.webGLRenderer.clearColor()};
e.vc=function(){var a=g.K.clone(this.i.renderer.view.sc),a=this.H===g.Oa.cd?a.equirectangular:a.mapping,b=g.ShaderLib.sb(a.vertexShader),d=g.ShaderLib.sb(a.fragmentShader),a=new THREE.RawShaderMaterial({fragmentShader:d,vertexShader:b,uniforms:a.uniforms,name:"BackgroundMeshMaterial",side:THREE.BackSide});this.c&&(a.uniforms.tTexture.value=this.c);0===this.j.children.length?(b=new THREE.BoxBufferGeometry(this.G,this.G,this.G,this.o,this.o,this.o),this.f=new THREE.Mesh(b,a),this.j.add(this.f)):(this.f=
this.j.children[0],this.f.material.dispose());this.f.material=a;a.needsUpdate=!0};e.destroy=function(){this.Xd();this.D=this.u=this.N=null;this.c&&(this.c.dispose(),this.c=null);eb.prototype.destroy.call(this)};Object.defineProperty(Na.prototype,"texture",{get:function(){return this.c}});function Ma(a,b){this.o=this.m=this.c=this.N=null;this.u=1;eb.call(this,a,b,"BackgroundShaderRenderer")}Ma.prototype=Object.create(eb.prototype);e=Ma.prototype;e.constructor=Ma;
e.ed=function(){eb.prototype.ed.call(this);this.vc();this.I=new THREE.OrthographicCamera(-1,1,1,-1,-1,1)};
e.gj=function(a){this.N=a;if(g.K.W(a,"Image")||g.K.W(a,"Canvas"))this.c=new THREE.Texture,this.c.image=a.element;else if(g.K.W(a,["VideoHTML5","VideoDash"]))"safari"===g.A.Bb.toLowerCase()&&1440<a.originalHeight&&(this.u=2),this.N.onQualityChange.has(this.fd,this)&&this.N.onQualityChange.remove(this.fd,this),this.N.onQualityChange.add(this.fd,this),this.m=document.createElement("canvas"),this.m.width=a.originalWidth/this.u,this.m.height=a.originalHeight/this.u,this.o=this.m.getContext("2d"),this.c=
new THREE.Texture(this.m);else throw"Wrong type of display object "+a.className;this.c.format=THREE.RGBFormat;this.c.mapping=THREE.Texture.DEFAULT_MAPPING;this.c.magFilter=THREE.LinearFilter;this.c.minFilter=THREE.LinearFilter;this.c.wrapS=THREE.ClampToEdgeWrapping;this.c.wrapT=THREE.ClampToEdgeWrapping;this.c.generateMipmaps=!1;this.c.needsUpdate=!0;this.f.material.uniforms.tTexture.value=this.c};
e.fd=function(a){this.log("Media quality has changed");a=a.emitter;this.m.width=a.originalWidth/this.u;this.m.height=a.originalHeight/this.u};e.Xd=function(){this.i.renderer.webGLRenderer.clearColor()};
e.render=function(a){if(null!==this.i.renderer){a=null;if(this.c&&this.m&&this.o&&this.N&&null!==this.N.element){var b=this.N.element;b instanceof HTMLVideoElement&&b.readyState===b.HAVE_ENOUGH_DATA&&this.o&&(this.o.drawImage(b,0,0,b.videoWidth,b.videoHeight,0,0,this.m.width,this.m.height),this.c.needsUpdate=!0,this.log("texture update done"))}eb.prototype.render.call(this,a)}};
e.vc=function(){var a=this.i.renderer.view.Yc,b=g.ShaderLib.sb(a.vertexShader),d=g.ShaderLib.sb(a.fragmentShader),a=new THREE.ShaderMaterial({uniforms:a.uniforms,vertexShader:b,fragmentShader:d,side:THREE.FrontSide});this.c&&(a.uniforms.tTexture.value=this.c);0===this.j.children.length?(b=new THREE.PlaneBufferGeometry(2,2),this.f=new THREE.Mesh(b,a),this.j.add(this.f)):(this.f=this.j.children[0],this.f.material=null);this.f.material=a;a.needsUpdate=!0};
e.destroy=function(){this.Xd();"undefined"!==typeof this.N.onQualityChange&&this.N.onQualityChange.has(this.fd,this)&&this.N.onQualityChange.remove(this.fd,this);this.o=this.m=this.N=null;this.c&&(this.c.dispose(),this.c=null);eb.prototype.destroy.call(this)};Object.defineProperty(Ma.prototype,"texture",{get:function(){return this.c}});function pa(a){this.i=a;this.c=this.f=null;n.call(this,"PostProcessing");this.c={}}pa.prototype=Object.create(n.prototype);e=pa.prototype;e.constructor=pa;
e.Ee=function(a){if("undefined"===typeof a||null===a||0===a.length)return[];for(var b=[],d=0,h=a.length;d<h;d++){var k=a[d],l;if(THREE.hasOwnProperty(k.type)){l=new Va(k.uid,k.type,THREE[k.type]);if("undefined"!==typeof l.uniforms)for(var p in k.params){var r=k.params[p],u=r;if("object"===typeof r&&r.hasOwnProperty("type")&&r.hasOwnProperty("args")){var A=r.args;switch(r.type){case "THREE.Color":if(3===A.length)u=new THREE.Color(A[0],A[1],A[2]);else if("string"===typeof A||"number"===typeof A)u=new THREE.Color(A);
else throw Error("Cannot create THREE.Color with "+typeof A+" (length "+A.length+")");break;case "THREE.Vector2":u=new THREE.Vector2(A[0],A[1]);break;case "THREE.Vector3":u=new THREE.Vector3(A[0],A[1],A[2])}}l.uniforms[p].value=u}b.push(l)}else this.warn("Unknown image effect ("+k.type+")")}return b};e.pe=function(a){return this.c[a]};
e.ma=function(a){a=this.f=a;this.R=a.uid;if("undefined"!==typeof a.fxSets&&0<a.fxSets.length)for(var b=0,d=a.fxSets.length;b<d;b++){var h=a.fxSets[b];this.c[h.uid]=h.set}};e.destroy=function(){this.c=this.i=null};g.ab={};g.ab.pi="main";g.ab.ic="render";g.ab.xf="picking";function Ra(a,b,d){this.m=a||g.ab.ic;this.f="";this.c=!0;THREE.EffectComposer.call(this,b,d);this.f=gb(this.m)}Ra.prototype=Object.create(THREE.EffectComposer.prototype);Ra.prototype.constructor=Ra;
Ra.prototype.destroy=function(){this.writeBuffer.dispose();this.writeBuffer=null;this.readBuffer.dispose();this.readBuffer=null};Ra.uid=0;function gb(a){return"FORGE.EffectComposer."+a+"."+Ra.uid++}Object.defineProperty(Ra.prototype,"type",{get:function(){return this.m}});Object.defineProperty(Ra.prototype,"renderTarget",{get:function(){return this.readBuffer},set:function(a){this.readBuffer&&this.readBuffer.dispose();this.readBuffer=a}});
Object.defineProperty(Ra.prototype,"enabled",{get:function(){return this.c},set:function(a){this.c=a}});Object.defineProperty(Ra.prototype,"name",{get:function(){return this.f}});g.Ma={};g.Ma.Td="";g.Ma.Id="background";g.Ma.ic="render";g.Ma.lf="global";function Ta(a,b){this.c="";THREE.TexturePass.call(this,a,b)}Ta.prototype=Object.create(THREE.TexturePass.prototype);Ta.prototype.constructor=Ta;Object.defineProperty(Ta.prototype,"position",{get:function(){return this.c},set:function(a){this.c=a}});
function Va(a,b,d,h){this.o=a;this.m=b||"shader";this.R=g.Ma.Td;this.f=0;THREE.ShaderPass.call(this,d,h||"tDiffuse")}Va.prototype=Object.create(THREE.ShaderPass.prototype);Va.prototype.constructor=Va;Va.prototype.render=function(a,b,d,h,k){this.f+=h;this.uniforms.hasOwnProperty("time")&&(this.uniforms.time.value=this.f);THREE.ShaderPass.prototype.render.call(this,a,b,d,h,k)};Object.defineProperty(Va.prototype,"uid",{get:function(){return this.o}});Object.defineProperty(Va.prototype,"type",{get:function(){return this.m}});
Object.defineProperty(Va.prototype,"position",{get:function(){return this.R},set:function(a){this.R=a}});function Ya(a){this.j=a;this.c=null;a=g.ShaderLib.sb(g.ShaderChunk.wts_vert_rectilinear);var b=g.ShaderLib.sb(g.ShaderChunk.wts_frag_addition);this.c=new THREE.RawShaderMaterial({fragmentShader:b,vertexShader:a,uniforms:{tTexture:{type:"t",value:null},tAdd:{type:"t",value:null}},side:THREE.FrontSide,name:"FORGE.AdditionPassMaterial"});Va.call(this,"","Addition",this.c,"tTexture")}
Ya.prototype=Object.create(Va.prototype);Ya.prototype.constructor=Ya;Ya.prototype.destroy=function(){this.c||(this.c.dispose(),this.c=null);this.j=null};Object.defineProperty(Ya.prototype,"composer",{get:function(){return this.j}});function Sa(a,b,d,h,k){this.c="";THREE.RenderPass.call(this,a,b,d,h,k)}Sa.prototype=Object.create(THREE.RenderPass.prototype);Sa.prototype.constructor=Sa;Object.defineProperty(Sa.prototype,"position",{get:function(){return this.c},set:function(a){this.c=a}});
g.ShaderChunk={};g.ShaderChunk.coordinates="\nvec3 toCartesian(in vec3 rtp) {\n    float r = rtp.x;\n    float theta = rtp.y;\n    float phi = rtp.z;\n    float x = r * cos(phi) * sin(theta);\n    float y = r * sin(phi);\n    float z = r * cos(phi) * cos(theta);\n    return vec3(x,y,z);\n}\nvec3 toSpherical(in vec3 pt) {\n    float r = length(pt);\n    float theta = -atan(pt.x, pt.z);\n    float phi = asin(pt.y / r);\n    return vec3(r,theta,phi);\n}\n";g.ShaderChunk.defines="precision highp float;\nprecision highp int;\n#define PI  3.141592653589793\n#define PI2 6.28318530717959\n#define RECIPROCAL_PI2 0.1591549430919\n";
g.ShaderChunk.helpers="\nfloat wrap(in float x, in float min, in float max) {\n    return x - ((max - min) * (1.0 - step(x, min) - step(x, max)));\n}\nvec2 getFragment() {\n    return (2.0 * gl_FragCoord.xy / tViewportResolution - 1.0) * vec2(tViewportResolutionRatio, 1.0);\n}\n";g.ShaderChunk.texcoords="\nvec2 toEquirectangularTexCoords(in vec2 thetaphi) {\n    thetaphi.x = wrap(thetaphi.x + PI, -PI, PI);\n    vec2 coords = 0.5 + thetaphi / vec2(PI2, PI);\n    return coords;\n}\n";
g.ShaderChunk.uniforms="uniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\n";g.ShaderChunk.vert_attributes="attribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\n";g.ShaderChunk.stw_frag_proj_gopro="\n#include <defines>\nuniform sampler2D tTexture;\nuniform vec2 tViewportResolution;\nuniform float tViewportResolutionRatio;\nuniform mat4 tModelViewMatrixInverse;\nuniform float tProjectionDistance;\nuniform float tProjectionScale;\n#include <helpers>\n#include <coordinates>\n#include <texcoords>\nvec2 projection() {\n    vec2 frag = getFragment();\n    vec2 c = tProjectionScale * frag;\n    float zs = tProjectionDistance;\n    float xy2 = dot(c,c);\n    float zs12 = (zs+1.0)*(zs+1.0);\n    float delta = 4.0*(zs*zs*xy2*xy2 - (xy2+zs12)*(xy2*zs*zs-zs12));\n    if (delta < 0.0) {return vec2(-1.);}\n    float z = (2.0*zs*xy2 - sqrt(delta)) / (2.0 * (zs12 + xy2));\n    float x = c.x * ((zs-z) / (zs+1.0));\n    float y = c.y * ((zs-z) / (zs+1.0));\n    vec3 vx = vec3(tModelViewMatrixInverse * vec4(x, y, z, 1.0));\n    return toSpherical(vx).yz;\n}\nvoid main() {\n    vec2 texCoords = toEquirectangularTexCoords(projection());\n    gl_FragColor = vec4(texture2D(tTexture, texCoords).rgb, 1.0);\n}\n";
g.ShaderChunk.stw_frag_proj_rectilinear="\n#include <defines>\nuniform sampler2D tTexture;\nuniform vec2 tViewportResolution;\nuniform float tViewportResolutionRatio;\nuniform mat4 tModelViewMatrixInverse;\nuniform float tProjectionScale;\n#include <helpers>\n#include <coordinates>\n#include <texcoords>\nvec2 projection() {\n    vec2 frag = tProjectionScale * getFragment();\n    vec4 screenPT = vec4(frag, -1.0, 1.0);\n    vec4 worldPT = tModelViewMatrixInverse * screenPT;\n    return toSpherical(worldPT.xyz).yz;\n}\nvoid main() {\n    vec2 texCoords = toEquirectangularTexCoords(projection());\n    gl_FragColor = vec4(texture2D(tTexture, texCoords).rgb, 1.0);\n}\n";
g.ShaderChunk.stw_vert_proj="\n#include <defines>\nvoid main() {\n   gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}\n";g.ShaderChunk.wts_frag="\n#include <defines>\nuniform sampler2D tTexture;\nvarying vec2 vUv;\nvoid main() {\n    gl_FragColor = texture2D( tTexture, vUv );\n}\n";g.ShaderChunk.wts_frag_addition="\n#include <defines>\nuniform sampler2D tTexture;\nuniform sampler2D tAdd;\nvarying vec2 vUv;\nvoid main() {\n    vec4 texel = texture2D( tTexture, vUv );\n    vec4 texelAdd = texture2D( tAdd, vUv );\n    gl_FragColor = vec4(vec3(texelAdd.a * texelAdd.rgb + (1.0 - texelAdd.a) * texel.rgb), 1.0);\n}\n";
g.ShaderChunk.wts_frag_color="\n#include <defines>\nuniform vec3 tColor;\nvarying vec2 vUv;\nvoid main() {\n    vec2 texCoords = vUv;\n    gl_FragColor = vec4(tColor, 1.0);\n}\n";g.ShaderChunk.wts_frag_depth_drawing="\n#include <defines>\nvarying float vDepth;\nvoid main() {\n    gl_FragColor = vec4(vDepth, vDepth, vDepth, 1.0);\n}\n";g.ShaderChunk.wts_frag_equirectangular="\n#include <defines>\nuniform sampler2D tTexture;\nvarying vec3 vWorldPosition;\nvoid main() {\n    vec3 direction = normalize( vWorldPosition );\n    vec2 sampleUV;\n    sampleUV.y = clamp( direction.y * 0.5 + 0.5, 0.0, 1.0 );\n    sampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 - 0.25;\n    sampleUV.x += (1.0 - step(0.0, sampleUV.x));\n    gl_FragColor = texture2D( tTexture, sampleUV );\n}\n";
g.ShaderChunk.wts_vert_gopro="\n#include <defines>\n#include <vert_attributes>\n#include <uniforms>\nuniform float tProjectionDistance;\nuniform float tProjectionScale;\nuniform float tViewportResolutionRatio;\nvarying vec2 vUv;\nvoid main() {\n    vec4 camPt = modelViewMatrix * vec4( position, 1.0 );\n    vec4 origin = vec4(vec3(0.0), 1.0);\n    camPt.z -= tProjectionDistance * distance(camPt, origin);\n    camPt.xyz /= max(1.0, tProjectionScale);\n    gl_Position = projectionMatrix * camPt;\n    vUv = uv;\n}\n";
g.ShaderChunk.wts_vert_gopro_equirectangular="\n#include <defines>\n#include <vert_attributes>\n#include <uniforms>\nuniform float tProjectionDistance;\nuniform float tProjectionScale;\nuniform float tViewportResolutionRatio;\nvarying vec3 vWorldPosition;\nvoid main() {\n    vec4 camPt = modelViewMatrix * vec4( position, 1.0 );\n    vec4 origin = vec4(vec3(0.0), 1.0);\n    camPt.z -= tProjectionDistance * distance(camPt, origin);\n    camPt.xyz /= max(1.0, tProjectionScale);\n    gl_Position = projectionMatrix * camPt;\n    vWorldPosition = vec3(position);\n}\n";
g.ShaderChunk.wts_vert_littleplanet="\n#include <defines>\n#include <vert_attributes>\n#include <uniforms>\nuniform float tProjectionScale;\nuniform float tViewportResolutionRatio;\nvarying vec2 vUv;\nvoid main() {\n    vec4 camPt = modelViewMatrix * vec4( position, 1.0 );\n    camPt.z -= distance(camPt, vec4(vec3(0.0), 1.0));\n    camPt.xyz /= tProjectionScale;\n    gl_Position = projectionMatrix * camPt;\n    vUv = uv;\n}\n";g.ShaderChunk.wts_vert_littleplanet_equirectangular="\n#include <defines>\n#include <vert_attributes>\n#include <uniforms>\nuniform float tProjectionScale;\nuniform float tViewportResolutionRatio;\nvarying vec3 vWorldPosition;\nvoid main() {\n    vec4 camPt = modelViewMatrix * vec4( position, 1.0 );\n    camPt.z -= distance(camPt, vec4(vec3(0.0), 1.0));\n    camPt.xyz /= tProjectionScale;\n    gl_Position = projectionMatrix * camPt;\n    vWorldPosition = vec3(position);\n}\n";
g.ShaderChunk.wts_vert_rectilinear="\n#include <defines>\n#include <vert_attributes>\n#include <uniforms>\nuniform float tViewportResolutionRatio;\nvarying vec2 vUv;\nvoid main() {\n    vec4 camPt = modelViewMatrix * vec4( position, 1.0 );\n    gl_Position = projectionMatrix * camPt;\n    vUv = uv;\n}\n";g.ShaderChunk.wts_vert_rectilinear_equirectangular="\n#include <defines>\n#include <vert_attributes>\n#include <uniforms>\nuniform float tViewportResolutionRatio;\nvarying vec3 vWorldPosition;\nvoid main() {\n    vec4 camPt = modelViewMatrix * vec4( position, 1.0 );\n    gl_Position = projectionMatrix * camPt;\n    vWorldPosition = vec3( position );\n}\n";
g.ShaderLib={screenToWorld:{rectilinear:{uniforms:{tTexture:{type:"t",value:null},tViewportResolution:{type:"v2",value:new THREE.Vector2},tViewportResolutionRatio:{type:"f",value:1},tModelViewMatrixInverse:{type:"m4",value:new THREE.Matrix4},tProjectionScale:{type:"f",value:1}},vertexShader:g.ShaderChunk.stw_vert_proj,fragmentShader:g.ShaderChunk.stw_frag_proj_rectilinear},gopro:{uniforms:{tTexture:{type:"t",value:null},tViewportResolution:{type:"v2",value:new THREE.Vector2},tViewportResolutionRatio:{type:"f",
value:1},tModelViewMatrixInverse:{type:"m4",value:new THREE.Matrix4},tProjectionDistance:{type:"f",value:0},tProjectionScale:{type:"f",value:1}},vertexShader:g.ShaderChunk.stw_vert_proj,fragmentShader:g.ShaderChunk.stw_frag_proj_gopro}},worldToScreen:{rectilinear:{mapping:{uniforms:{tTexture:{type:"t",value:null},tProjectionScale:{type:"f",value:1},tModelViewMatrixInverse:{type:"m4",value:null}},vertexShader:g.ShaderChunk.wts_vert_rectilinear,fragmentShader:g.ShaderChunk.wts_frag},equirectangular:{uniforms:{tTexture:{type:"t",
value:null},tProjectionScale:{type:"f",value:1},tViewportResolutionRatio:{type:"f",value:1},tModelViewMatrixInverse:{type:"m4",value:null}},vertexShader:g.ShaderChunk.wts_vert_rectilinear_equirectangular,fragmentShader:g.ShaderChunk.wts_frag_equirectangular}},littlePlanet:{equirectangular:{uniforms:{tTexture:{type:"t",value:null},tProjectionScale:{type:"f",value:1},tViewportResolutionRatio:{type:"f",value:1},tModelViewMatrixInverse:{type:"m4",value:null}},vertexShader:g.ShaderChunk.wts_vert_littleplanet_equirectangular,
fragmentShader:g.ShaderChunk.wts_frag_equirectangular}},gopro:{mapping:{uniforms:{tTexture:{type:"t",value:null},tProjectionScale:{type:"f",value:1},tProjectionDistance:{type:"f",value:1},tModelViewMatrixInverse:{type:"m4",value:null}},vertexShader:g.ShaderChunk.wts_vert_gopro,fragmentShader:g.ShaderChunk.wts_frag},equirectangular:{uniforms:{tTexture:{type:"t",value:null},tProjectionScale:{type:"f",value:1},tProjectionDistance:{type:"f",value:1},tViewportResolutionRatio:{type:"f",value:1},tModelViewMatrixInverse:{type:"m4",
value:null}},vertexShader:g.ShaderChunk.wts_vert_gopro_equirectangular,fragmentShader:g.ShaderChunk.wts_frag_equirectangular}}}};g.ShaderLib.sb=function(a){return a.replace(/#include +<([\w\d.]+)>/g,function(a,d){a=g.ShaderChunk[d];if("undefined"===typeof a&&(a=THREE.ShaderChunk[d],"undefined"===typeof a))throw Error("Can not resolve #include <"+d+">");return g.ShaderLib.sb(a)})};g.Ia={};g.Ia.Sd="undefined";g.Ia.Ob="rectilinear";g.Ia.wc="gopro";
function hb(a,b,d,h){this.i=a;this.c=b;this.f=1;this.m=h;n.call(this,d||"ViewBase")}hb.prototype=Object.create(n.prototype);e=hb.prototype;e.constructor=hb;e.Yc=g.ShaderLib.screenToWorld.rectilinear;e.sc=g.ShaderLib.worldToScreen.rectilinear;e.Lc=function(){};e.Gc=function(a){this.log(a);throw"Please implement "+this.fb+"::updateScreenToWorld";};e.worldToScreen=function(a,b){this.log(a);this.log(b);throw"Please implement "+this.fb+"::worldToScreen";};
e.screenToWorld=function(a){this.log(a);throw"Please implement "+this.fb+"::screenToWorld";};e.destroy=function(){this.c=this.i=null;n.prototype.destroy.call(this)};Object.defineProperty(hb.prototype,"type",{get:function(){return this.m}});Object.defineProperty(hb.prototype,"fovMin",{get:function(){return this.c.fovMin}});Object.defineProperty(hb.prototype,"fovMax",{get:function(){return this.c.fovMax}});function Pa(a,b){hb.call(this,a,b,"ViewGoPro",g.Ia.wc);this.Lc()}Pa.prototype=Object.create(hb.prototype);
e=Pa.prototype;e.constructor=Pa;e.Yc=g.ShaderLib.screenToWorld.gopro;e.sc=g.ShaderLib.worldToScreen.gopro;e.Lc=function(){hb.prototype.Lc.call(this);this.c.fovMin=10;this.c.fovMax=160};e.Gc=function(a){var b,d=g.Math.ca(this.c.fov,this.c.fovMin,this.c.fovMax);b=60>d?0:180<d?1:.5*(1+Math.sin(Math.PI/2*((d-60)/120*2-1)));a.tProjectionDistance.value=b;d=Math.PI*d/360;this.f=(b+1)*Math.sin(d)/(b+Math.cos(d));a.tProjectionScale.value=this.f};e.destroy=function(){hb.prototype.destroy.call(this)};
function Oa(a,b){hb.call(this,a,b,"ViewRectilinear",g.Ia.Ob);this.Lc()}Oa.prototype=Object.create(hb.prototype);e=Oa.prototype;e.constructor=Oa;e.Yc=g.ShaderLib.screenToWorld.rectilinear;e.sc=g.ShaderLib.worldToScreen.rectilinear;e.Lc=function(){hb.prototype.Lc.call(this);this.c.fovMin=10;this.c.fovMax=170};e.Gc=function(a){this.f=Math.tan(g.Math.ha(g.Math.ca(this.c.fov,this.c.fovMin,this.c.fovMax)/2));a.tProjectionScale.value=this.f};
e.worldToScreen=function(a,b){b=b||0;a=new THREE.Vector4(a.x,a.y,a.z,1);var d=g.Math.Hg(this.c.modelView),d=g.Math.le(d.yaw,d.pitch,d.roll,!0),d=d.transpose();a.applyMatrix4(d);if(0>a.z)return new THREE.Vector2(Infinity,Infinity);d=Math.max(Number.EPSILON,a.z);a=(new THREE.Vector2(a.x,a.y)).divideScalar(d);a.x/=(1+b)*this.f;a.y/=this.f;b=this.i.renderer.displayResolution;a.x=b.width/2*(a.x/b.ratio+1);a.y=b.height/2*(a.y/b.ratio+1);return new THREE.Vector2(Math.round(a.x),b.height-Math.round(a.y))};
e.screenToWorld=function(a){var b=this.i.renderer.displayResolution;a=new THREE.Vector2(2*(a.x/b.width-1)*b.ratio,2*(a.y/b.height-1)*b.ratio);a.multiplyScalar(this.f);a=(new THREE.Vector4(a.x,a.y,-1,0)).applyMatrix4(this.c.modelViewInverse).normalize();return new THREE.Vector3(a.x,a.y,a.z)};e.destroy=function(){hb.prototype.destroy.call(this)};function ib(a){this.c=a||[];n.call(this,"Timeline");g.K.Pa(this.c,"Keyframe")?this.c=g.K.Gd(this.c,"time"):this.c=[]}ib.prototype=Object.create(n.prototype);
e=ib.prototype;e.constructor=ib;e.Wn=function(){return!!this.c&&0<this.c.length};e.Pb=function(a){g.K.W(a,"Keyframe")&&(this.c.push(a),this.c=g.K.Gd(this.c,"time"))};e.Rn=function(a){a=this.qe(a);return{previous:this.c[a.previous],next:this.c[a.next]||null}};e.qe=function(a){for(var b=-1,d=-1,h=this.c.length-1;0<=h;h--)if(a>=this.c[h].time){b=h;break}b!==this.c.length-1&&(d=b+1);return{previous:b,next:d}};
e.Yj=function(a){a=this.Zj(a);return{previous:this.c[a.previous]||null,next:this.c[a.next]||null}};e.Zj=function(a){a=this.qe(a);var b=0,d=a.next;0<a.previous&&(b=a.previous-1);a.next<this.c.length-2&&(d=a.next+1);return{previous:b,next:d}};e.Ln=function(){for(;0<this.c.length;)this.c.pop().data=null;this.c=[]};e.destroy=function(){for(;0<this.c.length;)this.c.pop().data=null;this.c=null;n.prototype.destroy.call(this)};
Object.defineProperty(ib.prototype,"keyframes",{get:function(){return this.c},set:function(a){g.K.Pa(a,"Keyframe")&&(this.c=g.K.Gd(a,"time"))}});function jb(a,b){n.call(this,"Keyframe");this.c=a;this.xb=b}jb.prototype=Object.create(n.prototype);jb.prototype.constructor=jb;Object.defineProperty(jb.prototype,"time",{get:function(){return this.c},set:function(a){"number"===typeof a&&(this.c=a)}});Object.defineProperty(jb.prototype,"data",{get:function(){return this.xb},set:function(a){this.xb=a}});
function kb(a,b){this.i=a;this.ta=b||null;this.u=this.C=this.m=this.Ra=null;this.J=this.H=0;this.U=!1;this.f=null;this.P=0;this.Z=!1;this.B=this.G=this.I=this.D=this.fa=this.V=null;n.call(this,"Animation");this.Se()}kb.prototype=Object.create(n.prototype);e=kb.prototype;e.constructor=kb;e.Se=function(){this.f=new lb(this.i,this);this.f.onStart.add(this.nn,this);this.f.onStop.add(this.pn,this);this.f.onProgress.add(this.Tk,this);this.f.onComplete.add(this.mn,this);this.i.tween.add(this.f);this.m=new ib};
function mb(a,b){a=a.split(".");for(var d=0,h=a.length;d<h-1;d++)b=b[a[d]];return[b,a[d]]}
function nb(a,b){b=b||a.H;var d=a.m.qe(b||a.H);a.u=a.m.keyframes[d.next];a.C=a.m.keyframes[d.previous];if(!a.u||-1===d.next)return!1;if(a.Z){var h=a.m.Yj(b);if(h.previous&&null!==h.next){b=(new THREE.Quaternion).copy(a.C.data.quaternion).normalize();var d=(new THREE.Quaternion).copy(a.u.data.quaternion).normalize(),k=(new THREE.Quaternion).copy(h.previous.data.quaternion).normalize(),h=(new THREE.Quaternion).copy(h.next.data.quaternion).normalize();a.V=g.Quaternion.Og(k,b,d);a.fa=g.Quaternion.Og(b,
d,h)}}a.J=a.u.time-a.C.time;a.f.kf({tweenTime:1},a.J);a.P=0;a.f.start();return!0}e.nn=function(){!0!==this.U&&(this.D&&this.D.F(),this.U=!0)};e.pn=function(){this.U=!1;this.I&&this.I.F()};
e.Tk=function(){var a=this.P;if(this.u){this.H=a*this.J+this.C.time;var b=[],d,h,k;Array.isArray(this.Ra.prop)||(this.Ra.prop=[this.Ra.prop]);k=this.Ra.prop.length;for(h=0;h<k;h++)b.push(mb(this.Ra.prop[h],this.ta));if(!0===this.Ra.smooth&&"quaternion"===this.Ra.prop[0])d=b[0],d[0].quaternion=g.Quaternion.Jk(this.C.data.quaternion,this.V,this.fa,this.u.data.quaternion,a);else if("quaternion"===this.Ra.prop[0])d=b[0],d[0].quaternion=g.Quaternion.slerp(this.C.data.quaternion,this.u.data.quaternion,
a);else{var l=this.f.easing(a),p,r,u=0;for(h=0;h<k;h++){p=mb(this.Ra.prop[h],this.C.data);r=mb(this.Ra.prop[h],this.u.data);d=b[h];p=p[0][p[1]];r=r[0][r[1]];if(this.Ra.eb&&this.Ra.eb[h]){var A=this.Ra.eb[h][0],ob=this.Ra.eb[h][1],u=Math.abs(A-ob)/2;Math.abs(p-r)>u?(p=g.Math.eb(p+u,A,ob),r=g.Math.eb(r+u,A,ob)):u=0}d[0][d[1]]=(1-l)*p+l*r-u}}"function"===typeof this.Ra.Qj&&this.Ra.Qj.call(this,a)}this.G&&this.G.F({progress:this.H/this.J})};e.mn=function(){nb(this)||this.B&&this.B.F()};
e.play=function(){this.H=0;this.C=this.m.keyframes[0];this.u=this.m.keyframes[1];nb(this,0)};e.stop=function(){this.f.stop()};e.resume=function(){nb(this)};e.destroy=function(){this.m&&(this.m.destroy(),this.m=null);this.f&&(this.f.destroy(),this.f=null);this.D&&(this.D.destroy(),this.D=null);this.I&&(this.I.destroy(),this.I=null);this.G&&(this.G.destroy(),this.G=null);this.B&&(this.B.destroy(),this.B=null);n.prototype.destroy.call(this)};Object.defineProperty(kb.prototype,"timeline",{get:function(){return this.m}});
Object.defineProperty(kb.prototype,"instruction",{get:function(){return this.Ra},set:function(a){this.Ra=a}});Object.defineProperty(kb.prototype,"tween",{get:function(){return this.f},set:function(a){this.f=a}});Object.defineProperty(kb.prototype,"tweenTime",{get:function(){return this.P},set:function(a){this.P=a}});Object.defineProperty(kb.prototype,"smooth",{get:function(){return this.Z},set:function(a){this.Z=a}});
Object.defineProperty(kb.prototype,"onPlay",{get:function(){this.D||(this.D=new q(this));return this.D}});Object.defineProperty(kb.prototype,"onStop",{get:function(){this.I||(this.I=new q(this));return this.I}});Object.defineProperty(kb.prototype,"onProgress",{get:function(){this.G||(this.G=new q(this));return this.G}});Object.defineProperty(kb.prototype,"onComplete",{get:function(){this.B||(this.B=new q(this));return this.B}});
function pb(a,b,d){this.i=a;this.ta=b||null;this.c=null;this.D=0;this.o=this.j=null;n.call(this,d)}pb.prototype=Object.create(n.prototype);e=pb.prototype;e.constructor=pb;e.stop=function(){for(var a=0,b=this.c;a<b;a++)this.c[a].stop()};e.resume=function(){for(var a=0,b=this.c;a<b;a++)this.c[a].resume()};e.Ac=function(){this.D++;this.D===this.c.length&&this.o&&this.o.F()};
function qb(a,b,d,h,k,l){var p=null,r=null;d=g.K.Gd(d,"time");for(var u=0;u<d.length;u++){var A="string"===typeof l?d[u].data[l][h]:d[u].data[h];if("undefined"!==typeof A&&null!==A&&(d[u].time<b&&(p=d[u]),d[u].time>b)){r=d[u];break}}null===p&&(p={time:0,data:{}},"string"===typeof l?p.data[l]=a.ta[l]:p.data[h]=a.ta[h]);if(null===r)return"string"===typeof l?p.data[l][h]:p.data[h];a=g.X[k]((b-p.time)/(r.time-p.time));return(1-a)*("string"===typeof l?p.data[l][h]:p.data[h])+a*("string"===typeof l?r.data[l][h]:
r.data[h])}function rb(a){for(var b;a.c&&0<a.c.length;)b=a.c.pop(),b.onComplete.remove(a.Ac,a),b.destroy();a.c=[];a.D=0}e.destroy=function(){n.prototype.destroy.call(this)};Object.defineProperty(pb.prototype,"onComplete",{get:function(){this.o||(this.o=new q(this));return this.o}});function sb(a){this.f=this.B=this.D=null;this.u=0;this.j=null;this.m=0;n.call(this,a)}sb.prototype=Object.create(n.prototype);sb.prototype.constructor=sb;
sb.prototype.c=function(a){this.R=a.uid;this.D=a.name;this.B=a.description;this.f=a.keyframes;this.j="LINEAR";this.m=0;"object"===typeof a.easing&&null!==a.easing&&(this.j=a.easing["default"]||this.j,this.m=a.easing.offset||this.m);aa(this)};sb.prototype.destroy=function(){ba(this)};Object.defineProperty(sb.prototype,"name",{get:function(){return this.D}});Object.defineProperty(sb.prototype,"description",{get:function(){return this.B}});Object.defineProperty(sb.prototype,"keyframes",{get:function(){return this.f}});
Object.defineProperty(sb.prototype,"count",{set:function(a){"number"===typeof a&&(this.u=a)},get:function(){return this.u}});Object.defineProperty(sb.prototype,"easing",{get:function(){return this.j}});Object.defineProperty(sb.prototype,"offset",{get:function(){return this.m}});Object.defineProperty(sb.prototype,"duration",{get:function(){for(var a,b=0,d=this.f.length;b<d;b++)this.f[b].time>a&&(a=this.f[b].time);return a}});
function tb(a,b){this.i=a;this.c=null;this.$="";this.T=this.M=!0;this.o=null;this.U=this.O=!1;this.G=this.B=this.D=this.I=null;n.call(this,b||"Object3D");this.bf()}tb.prototype=Object.create(n.prototype);e=tb.prototype;e.constructor=tb;e.bf=function(){this.o={};this.c=new THREE.Mesh;this.i.renderer.objects.register(this)};e.click=function(){this.log("click "+this.c.id);!0===g.K.W(this.o.onClick,"ActionEventDispatcher")&&this.o.onClick.F();this.I&&this.I.F()};
e.cf=function(){this.log("over "+this.c.id);!0===g.K.W(this.o.onOver,"ActionEventDispatcher")&&this.o.onOver.F();this.D&&this.D.F()};e.Nd=function(){this.log("out "+this.c.id);!0===g.K.W(this.o.onOut,"ActionEventDispatcher")&&this.o.onOut.F();this.B&&this.B.F()};
e.destroy=function(){this.i.renderer.objects.unregister(this);this.c&&(this.c.c=null,this.c.geometry&&(this.c.geometry.dispose(),this.c.geometry=null),this.c=this.c.material=null);this.I&&(this.I.destroy(),this.I=null);this.D&&(this.D.destroy(),this.D=null);this.B&&(this.B.destroy(),this.B=null);this.G&&(this.G.destroy(),this.G=null);this.i=null;n.prototype.destroy.call(this)};Object.defineProperty(tb.prototype,"mesh",{get:function(){return this.c}});
Object.defineProperty(tb.prototype,"visible",{get:function(){return this.M},set:function(a){this.M=!!a;this.c&&(this.c.visible=this.M)}});Object.defineProperty(tb.prototype,"hovered",{get:function(){return this.O},set:function(a){this.O=!!a}});Object.defineProperty(tb.prototype,"interactive",{get:function(){return this.T},set:function(a){this.T=!!a}});Object.defineProperty(tb.prototype,"fx",{get:function(){return this.$}});Object.defineProperty(tb.prototype,"events",{get:function(){return this.o}});
Object.defineProperty(tb.prototype,"ready",{get:function(){return this.U}});Object.defineProperty(tb.prototype,"onClick",{get:function(){this.I||(this.I=new q(this));return this.I}});Object.defineProperty(tb.prototype,"onOver",{get:function(){this.D||(this.D=new q(this));return this.D}});Object.defineProperty(tb.prototype,"onOut",{get:function(){this.B||(this.B=new q(this));return this.B}});Object.defineProperty(tb.prototype,"onReady",{get:function(){this.G||(this.G=new q(this));return this.G}});
function Ga(a){this.i=a;this.c=this.ba=null;n.call(this,"ObjectRenderer");this.ba=[];this.c=[]}Ga.prototype=Object.create(n.prototype);e=Ga.prototype;e.constructor=Ga;function ub(a,b){var d=[];return d="undefined"===typeof b||""===b||null===b?a.ba.filter(function(a){return"undefined"===typeof a.fx||""===a.fx||null===a.fx}):a.ba.filter(function(a){return a.fx===b})}function vb(a){var b=ub(a,null);return g.K.wj(a.ba,b)}
function wb(a){return vb(a).reduce(function(a,d){0>a.indexOf(d.fx)&&a.push(d.fx);return a},[])}e.register=function(a){this.ba.push(a)};e.unregister=function(a){this.ba.splice(this.ba.indexOf(a),1)};
e.Aj=function(){var a=this.i.renderer.camera.main,b=ub(this,null);if(0<b.length){for(var d=new THREE.Scene,h=0,k=b.length;h<k;h++)d.add(b[h].mesh);k=new Qa(this.i,d,a,null);this.c.push(k)}b=wb(this);d=0;for(h=b.length;d<h;d++){for(var k=b[d],l=ub(this,k),p=new THREE.Scene,r=0,u=l.length;r<u;r++)p.add(l[r].mesh);k=new Qa(this.i,p,a,this.i.postProcessing.pe(k));this.c.push(k)}};e.Wj=function(){return this.ba.filter(function(a){return!0===a.ready&&!0===a.interactive})};
e.Tj=function(a){for(var b=0,d=this.ba.length;b<d;b++)if(this.ba[b].mesh===a)return this.ba[b];return null};e.df=function(){for(var a=this.c.length;a--;)this.c.pop().destroy()};e.destroy=function(){this.df();this.i=this.c=null;n.prototype.destroy.call(this)};Object.defineProperty(Ga.prototype,"all",{get:function(){return this.ba}});Object.defineProperty(Ga.prototype,"renderScenes",{get:function(){return this.c}});function xb(a){this.i=a;this.c=this.f=null;n.call(this,"Raycaster")}xb.prototype=Object.create(n.prototype);
e=xb.prototype;e.constructor=xb;
e.start=function(a){this.log("Raycaster start");this.f||(this.f=new THREE.Raycaster);a===La.kb?(this.log("Raycating start pointer"),!1===this.i.canvas.pointer.onClick.has(this.Vd,this)&&this.i.canvas.pointer.onClick.add(this.Vd,this),!1===this.i.canvas.pointer.onMove.has(this.Wd,this)&&this.i.canvas.pointer.onMove.add(this.Wd,this)):a===La.Mc&&(this.log("Raycating start gaze"),!1===this.i.renderer.camera.onCameraChange.has(this.Ud,this)&&this.i.renderer.camera.onCameraChange.add(this.Ud,this))};
e.stop=function(){this.log("Raycaster stop");this.i.canvas.pointer.onClick.has(this.Vd,this)&&this.i.canvas.pointer.onClick.remove(this.Vd,this);this.i.canvas.pointer.onMove.has(this.Wd,this)&&this.i.canvas.pointer.onMove.remove(this.Wd,this);!1===this.i.renderer.camera.onCameraChange.has(this.Ud,this)&&this.i.renderer.camera.onCameraChange.remove(this.Ud,this);yb(this);this.f=null};e.Vd=function(a){a.data.center=a.data.center||{x:a.data.x,y:a.data.y};zb(this,"click",a.data.center)};
e.Wd=function(a){a.data.center=a.data.center||{x:a.data.x,y:a.data.y};zb(this,"move",a.data.center)};e.Ud=function(){zb(this,"move")};
function zb(a,b,d){var h=a.i.renderer.canvasResolution;d=d||{x:h.width/2,y:h.height/2};var k=a.i.renderer.camera,l=(new THREE.Vector2(d.x/h.width,1-d.y/h.height)).multiplyScalar(2).addScalar(-1),h=a.i.renderer.objects.Wj();d=0;for(var p=h.length;d<p;d++)h[d].hovered=!1;d=null;a.f.setFromCamera(l,k.main);k=[];l=0;for(p=h.length;l<p;l++)k.push(h[l].mesh);for(h=a.f.intersectObjects(k);null===d&&0<h.length;){var k=h.shift(),l=k.object,r=k.uv,k=a.i.renderer.objects.Tj(l);if(!1===l.material.transparent)d=
k;else{p=k;l=r;r=null;if(null!==p.mesh&&null!==p.mesh.material&&"undefined"!==typeof p.mesh.material.uniforms.tTexture){var u=p.mesh.material.uniforms.tTexture.value,p=null;null!==u.image&&("img"===u.image.nodeName.toLowerCase()?(p=document.createElement("canvas"),p.width=u.image.width,p.height=u.image.height,p.getContext("2d").drawImage(u.image,0,0)):"canvas"===u.image.nodeName.toLowerCase()&&(p=u.image),null!==p&&(r=p.width,u=p.height,l=4*(Math.floor(u-l.y*u)*r+Math.floor(l.x*r)),p=p.getContext("2d").getImageData(0,
0,r,u).data,r=new Ab(0,0,0,p[l+3])))}else"undefined"!==typeof p.mesh.material.color&&(r=p.mesh.material.color);(l=r)&&10<l.alpha&&(d=k)}}d?"click"===b?a.click():"move"===b&&d!==a.c&&(yb(a),a.c=d,d.cf(),a.i.renderer.pickingManager.mode===La.Mc&&a.i.renderer.camera.gaze.start()):yb(a)}function yb(a){a.c&&(a.c.Nd(),a.c=null,a.i.renderer.pickingManager.mode===La.Mc&&a.i.renderer.camera.gaze.stop())}e.click=function(){this.c&&this.c.click()};e.Xh=function(){this.c=null};
Object.defineProperty(xb.prototype,"hoveredObject",{get:function(){return this.c}});
function Bb(a){this.i=a;this.c=this.f=this.ta=null;n.call(this,"PickingDrawPass");a=g.K.clone(this.i.renderer.view.sc.mapping);a.uniforms.tColor={type:"c",value:new THREE.Color(0)};this.f=new THREE.RawShaderMaterial({fragmentShader:g.ShaderLib.sb(g.ShaderChunk.wts_frag_color),vertexShader:g.ShaderLib.sb(a.vertexShader),uniforms:a.uniforms,side:THREE.FrontSide,name:"PickingMaterial"});this.ta=new THREE.WebGLRenderTarget(this.i.renderer.canvasResolution.width/3,this.i.renderer.canvasResolution.height/
3,{format:THREE.RGBAFormat});this.ta.name="Picking RenderTarget"}Bb.prototype=Object.create(n.prototype);e=Bb.prototype;e.constructor=Bb;function Cb(a){return new THREE.Color(a.id)}
function Db(a,b){b.data.center=b.data.center||{x:b.data.x,y:b.data.y};var d=new Uint8Array(4);a.i.renderer.webGLRenderer.readRenderTargetPixels(a.ta,b.data.center.x/b.data.target.width*a.ta.width,(1-b.data.center.y/b.data.target.height)*a.ta.height,1,1,d);b=new THREE.Color(d[0],d[1],d[2]);var h;a:{a=a.i.renderer.objects.all;for(h in a)if(a[h].mesh.id===((b.r&255)<<16|((b.g&255)<<8)+(b.b&255))){h=a[h];break a}h=null}return h}e.rd=function(a){(a=Db(this,a))&&a.click()};
e.ce=function(a){a=Db(this,a);a?a!==this.c&&(this.c&&this.c.Nd(),a.cf(),this.c=a):this.c&&(this.c.Nd(),this.c=null)};e.start=function(){this.i.canvas.pointer.enabled=!0;!1===this.i.canvas.pointer.onClick.has(this.rd,this)&&this.i.canvas.pointer.onClick.add(this.rd,this);!1===this.i.canvas.pointer.onMove.has(this.ce,this)&&this.i.canvas.pointer.onMove.add(this.ce,this)};
e.stop=function(){this.i.canvas.pointer.onClick.has(this.rd,this)&&this.i.canvas.pointer.onClick.remove(this.rd,this);this.i.canvas.pointer.onMove.has(this.ce,this)&&this.i.canvas.pointer.onMove.remove(this.ce,this)};e.click=function(){this.c&&this.i.canvas.pointer.onClick.has(this.rd,this)&&this.c.click()};e.setSize=function(a){this.ta&&this.ta.setSize(a.width,a.height)};e.Hh=function(){this.c=null};
e.destroy=function(){this.f&&(this.f.dispose(),this.f=null);this.ta&&(this.ta.dispose(),this.ta=null);this.i=null;n.prototype.destroy.call(this)};Object.defineProperty(Bb.prototype,"material",{get:function(){return this.f}});Object.defineProperty(Bb.prototype,"renderTarget",{get:function(){return this.ta}});function Ea(a){this.i=a;this.f=this.c=null;this.j=La.kb;n.call(this,"PickingManager")}Ea.prototype=Object.create(n.prototype);Ea.prototype.constructor=Ea;var La={kb:"pointer",Mc:"gaze"};e=Ea.prototype;
e.Qk=function(a){a===g.Ia.Ob?this.f||(this.c&&(this.c.stop(),this.c.destroy(),this.c=null),this.f=new xb(this.i),this.f.start(this.j)):this.c||(this.f&&(this.f.stop(),this.f.destroy(),this.f=null),this.c=new Bb(this.i),this.c.start())};e.Ih=function(){this.f&&this.f.Xh();this.c&&this.c.Hh()};e.setSize=function(a){this.c&&this.c.setSize(a)};e.click=function(){this.f&&this.f.click();this.c&&this.c.click()};e.start=function(){this.f&&this.f.start(this.j);this.c&&this.c.start()};
e.stop=function(){this.f&&this.f.stop();this.c&&this.c.stop()};e.destroy=function(){this.f&&(this.f.stop(),this.f.destroy(),this.f=null);this.c&&(this.c.stop(),this.c.destroy(),this.c=null);n.prototype.destroy.call(this)};Object.defineProperty(Ea.prototype,"renderTarget",{get:function(){return this.c?this.c.renderTarget:null}});Object.defineProperty(Ea.prototype,"material",{get:function(){return this.c?this.c.material:null}});
Object.defineProperty(Ea.prototype,"mode",{get:function(){return this.j},set:function(a){a!==La.kb&&a!==La.Mc||a===this.j||(this.stop(),this.j=a,this.start())}});function ma(a){this.i=a;this.c=[];n.call(this,"HotspotManager")}ma.prototype=Object.create(n.prototype);e=ma.prototype;e.constructor=ma;e.cl=function(){var a=this.i.tour.scene;a.onUnloadStart.ga(this.vn,this);"undefined"!==typeof a.config.hotspots&&this.ma(a.config.hotspots)};e.vn=function(){this.Xe()};
e.boot=function(){this.i.tour.onSceneLoadStart.add(this.cl,this)};e.Qn=function(a){return this.c.filter(function(b){return b.type===a})};e.ma=function(a){for(var b=0,d=a.length;b<d;b++){var h=a[b],k=null;switch(h.type||g.Nc.Jf){case g.Nc.Jf:k=new Eb(this.i,h)}k&&this.c.push(k)}};e.sj=function(a){if(null!==a.tracks){a=a.tracks;for(var b=0,d=a.length;b<d;b++)new Fb(a[b])}};e.update=function(){for(var a=0,b=this.c.length;a<b;a++)this.c[a].update()};e.Xe=function(){for(var a=this.c.length;a--;)this.c.pop().destroy()};
e.destroy=function(){this.Xe();this.c=this.i=null;n.prototype.destroy.call(this)};Object.defineProperty(ma.prototype,"all",{get:function(){return this.c}});Object.defineProperty(ma.prototype,"count",{get:function(){return this.c}});function Eb(a,b){this.H=b;this.P="";this.u=this.C=this.fa=this.j=this.f=null;this.Z=!1;this.J=this.L=null;tb.call(this,a,"Hotspot3D")}Eb.prototype=Object.create(tb.prototype);e=Eb.prototype;e.constructor=Eb;
e.bf=function(){tb.prototype.bf.call(this);this.f=new Gb;this.u=new Hb(this.i,this.f);this.j=new Ib(this.i);if("undefined"!==typeof this.H&&this.H){var a=this.H;this.R=a.uid;this.jb=a.tags;aa(this);this.m=a.type;this.P=a.name;this.M=a.visible;this.Z=a.facingCenter||!1;"undefined"!==typeof a.transform&&this.f.load(a.transform);"undefined"!==typeof a.animation&&(this.u.load(a.animation),this.u.onProgress.add(this.lj,this));this.j.onReady.add(this.Qi,this);var b;"undefined"!==typeof a.material?b=a.material:
b=Jb.Ei;!0===this.md&&(b=g.K.pb(b,Jb.Ld));this.j.load(b);"undefined"!==typeof a.sound&&(this.C=new Kb(this.i),this.C.load(a.sound,a.transform));"string"===typeof a.fx&&(this.$=a.fx);if("object"===typeof a.events){var a=a.events,d;for(d in a)b=new Lb(this.i),b.c(a[d]),this.o[d]=b}}this.L=this.bl.bind(this);this.J=this.Lm.bind(this)};
e.bl=function(a,b,d,h,k){a=this.i.renderer.webGLRenderer.getContext();this.i.renderer.view.Gc(k.uniforms);"HotspotMaterial"===k.name?this.j.type===Mb.Pd?k.uniforms.tColor.value=new THREE.Color(this.j.color):k.uniforms.tTexture.value=this.j.c:"PickingMaterial"===k.name&&k.program&&(b=this.fa,a.useProgram(k.program.program),k.program.getUniforms().map.tColor.setValue(a,b),k.uniforms.tColor.value=b)};e.Lm=function(){};
e.Qi=function(){this.f.m(this.j);this.c.material=this.j.material;this.c.geometry=new THREE.PlaneBufferGeometry(this.f.size.width,this.f.size.height,8,8);this.c.material=this.j.material;this.c.c=this.H;this.c.f=this.i.renderer.view instanceof Oa;this.lj();this.U=!0;this.G&&this.G.F();this.fa=Cb(this.c);this.c.onBeforeRender=this.L;this.c.onAfterRender=this.J;!0===this.u.autoPlay&&this.u.play()};
e.lj=function(){var a=g.Math.eb(Math.PI-g.Math.ha(this.f.position.theta),-Math.PI,Math.PI),b=g.Math.ha(this.f.position.phi),d=this.f.position.radius,d=d+50*this.i.renderer.camera.parallax,d=g.K.Qg(d,a,b);this.c.position.copy((new THREE.Vector3).setFromSpherical(d));!0===this.Z?(this.c.rotation.set(b,a+Math.PI,0,"YXZ"),this.c.rotation.x+=-g.Math.ha(this.f.rotation.x),this.c.rotation.y+=g.Math.ha(this.f.rotation.y),this.c.rotation.z+=g.Math.ha(this.f.rotation.z)):this.c.rotation.set(-g.Math.ha(this.f.rotation.x),
g.Math.ha(this.f.rotation.y),g.Math.ha(this.f.rotation.z),"YXZ")};e.update=function(){this.j&&this.j.update();this.C&&this.C.update()};e.destroy=function(){this.j.onReady.remove(this.Qi,this);this.J=this.L=null;this.f&&(this.f.destroy(),this.f=null);this.u&&(this.u.destroy(),this.u=null);this.j&&(this.j.destroy(),this.j=null);this.C&&(this.C.destroy(),this.C=null);tb.prototype.destroy.call(this)};Object.defineProperty(Eb.prototype,"type",{get:function(){return this.m}});
Object.defineProperty(Eb.prototype,"name",{get:function(){return this.P}});Object.defineProperty(Eb.prototype,"animation",{get:function(){return this.u}});function Kb(a){this.i=a;this.c=this.u=this.f=null;this.D=0;this.B=1;this.G=!1;this.I=0;this.C=!1;this.m={radius:200,theta:0,phi:0};this.o=360;n.call(this,"HotspotSound")}Kb.prototype=Object.create(n.prototype);e=Kb.prototype;e.constructor=Kb;e.dl=function(){this.log("Sound load complete");this.f&&this.f.F()};
e.load=function(a,b){if("undefined"!==typeof a.source&&"object"===typeof a.source)if(this.R=a.uid,"undefined"!==typeof a.source.url&&"string"===typeof a.source.url&&""!==a.source.url){this.j=a.source.url;if("undefined"!==typeof a.options&&"object"===typeof a.options){if("number"===typeof a.options.volume)this.B=a.options.volume;else if("object"===typeof a.options.volume){var d=a.options.volume;this.D="number"===typeof d.min?g.Math.ca(d.min,0,1):0;this.B="number"===typeof d.max?g.Math.ca(d.max,0,1):
1}this.G="boolean"===typeof a.options.loop?a.options.loop:!1;this.I="number"===typeof a.options.startTime?a.options.startTime:0;this.C="boolean"===typeof a.options.autoPlay?a.options.autoPlay:!1;this.o="number"===typeof a.options.range?g.Math.ca(a.options.range,1,360):360}"undefined"!==typeof b&&"undefined"!==typeof b.position&&(this.m.theta="number"===typeof b.position.theta?g.Math.ca(b.position.theta,-180,180):0,this.m.phi="number"===typeof b.position.phi?g.Math.ca(b.position.phi,-90,90):0);this.c=
new L(this.i,this.R,this.j||"");this.c.onCanPlayThrough.ga(this.dl,this);!0===360>this.o&&(a=g.K.Qg(1,g.Math.ha(-this.m.theta),g.Math.ha(this.m.phi)),this.u=(new THREE.Vector3).setFromSpherical(a),this.c.spatialized=360>this.o,this.c.x=this.u.x,this.c.y=this.u.y,this.c.z=this.u.z);this.c.volume=this.B;this.c.loop=this.G;this.c.startTime=this.I;!0===this.C&&this.c.play(this.I,this.G,!0)}else"undefined"!==typeof a.source.target&&!0===g.S.hb(a.source.target)&&g.S.get(a.source.target)};
e.update=function(){if(!1===this.i.audio.enabled)this.c&&this.c.stop();else if(!0===360>this.o&&!0===360>this.o&&"number"===typeof this.o){var a=this.i.renderer.camera,a=g.Quaternion.Dc(g.Math.ha(a.yaw),g.Math.ha(a.pitch),0),b=g.Quaternion.Dc(g.Math.ha(this.m.theta),g.Math.ha(this.m.phi),0),a=g.Quaternion.vj(b,a),b=g.Math.ha(this.o/2);this.c.volume=a<b?this.D+(this.B-this.D)*(1-a/b):this.D}};e.destroy=function(){this.c&&(this.c.destroy(),this.c=null);this.m=this.u=null;this.f&&this.f.destroy();n.prototype.destroy.call(this)};
Object.defineProperty(Kb.prototype,"sound",{get:function(){return this.c}});Object.defineProperty(Kb.prototype,"onReady",{get:function(){this.f||(this.f=new q(this));return this.f}});function Ib(a){this.i=a;this.o=null;this.m="";this.f=this.c=null;this.D=1;this.u=!1;this.B=16777215;this.N=null;this.G=!1;this.j=null;n.call(this,"HotspotMaterial")}Ib.prototype=Object.create(n.prototype);Ib.prototype.constructor=Ib;
var Mb={IMAGE:"image",ui:"plugin",Pd:"graphics"},Jb={Ei:{color:"#ffffff",opacity:0,transparent:!1},Ld:{color:"#00ff00",opacity:.8,transparent:!1}};e=Ib.prototype;
e.ym=function(a){a=a.emitter;this.log("Texture load complete (Image) : "+a.element.src);this.N=a;this.c=new THREE.Texture(a.element);this.c.image.crossOrigin="anonymous";this.c.wrapS=THREE.ClampToEdgeWrapping;this.c.wrapT=THREE.ClampToEdgeWrapping;this.c.minFilter=THREE.LinearFilter;this.c.magFilter=THREE.LinearFilter;this.c.needsUpdate=!0;this.log("Map new texture from image");Nb(this)};
e.Yi=function(a){a=a.data;a.uid===this.o.plugin&&(this.i.plugins.onInstanceCreate.remove(this.Yi,this),Pb(this,a))};function Pb(a,b){!0===b.instanceReady?Qb(a,b):b.onInstanceReady.ga(a.rn,a)}e.rn=function(a){a=a.emitter;if(null===a.instance||!1===a.instanceReady)throw Error("Plugin instance not available");Qb(this,a)};
function Qb(a,b){a.N=b.instance.texture;a.c=new THREE.Texture(a.N.dom);a.c.format=THREE.RGBAFormat;a.c.wrapS=THREE.ClampToEdgeWrapping;a.c.wrapT=THREE.ClampToEdgeWrapping;a.c.magFilter=THREE.LinearFilter;a.c.minFilter=THREE.LinearFilter;a.c.generateMipmaps=!1;a.c.needsUpdate=!0;a.log("Map new texture from plugin");Nb(a)}
e.Ye=function(){this.f&&(this.f.dispose(),this.f=null);var a=g.K.clone(this.i.renderer.view.sc.mapping);this.m===Mb.Pd&&(a.fragmentShader=g.ShaderChunk.wts_frag_color,a.uniforms.tColor={type:"c",value:new THREE.Color(2105376)});var b=g.ShaderLib.sb(a.vertexShader),d=g.ShaderLib.sb(a.fragmentShader);this.f=new THREE.RawShaderMaterial({fragmentShader:d,vertexShader:b,uniforms:a.uniforms,side:THREE.DoubleSide,name:"HotspotMaterial"});this.c&&(this.f.transparent=this.u,this.f.needsUpdate=!0);this.f.needsUpdate=
!0;this.j&&this.j.F()};function Nb(a){!0===a.i.renderer.viewReady&&a.Ye();a.i.renderer.onViewReady.add(a.Ye,a)}
e.load=function(a){a=this.o=a;this.D="number"===typeof a.opacity?g.Math.ca(a.opacity,0,1):1;this.u="boolean"===typeof a.transparent?a.transparent:!1;this.B="string"===typeof a.color?a.color:16777215;this.G="boolean"===typeof a.update?a.update:!1;"undefined"!==typeof a.image&&null!==a.image?(a=a.image,this.m=Mb.IMAGE,this.N=new Rb(this.i,a),this.N.onLoadComplete.ga(this.ym,this)):"undefined"!==typeof a.plugin&&null!==a.plugin?(a=a.plugin,this.m=Mb.ui,a=this.i.plugins.get(a),"undefined"===typeof a||
null===a?this.i.plugins.onInstanceCreate.add(this.Yi,this):Pb(this,a)):(this.m=Mb.Pd,Nb(this))};e.update=function(){this.f&&this.f.uniforms&&(this.f.uniforms.tTexture.value=this.c);this.c&&!0===this.G&&(this.c.needsUpdate=!0)};e.destroy=function(){this.i.renderer.onViewReady.remove(this.Ye,this);this.c&&(this.c.dispose(),this.c=null);this.f&&(this.f.dispose(),this.f=null);this.m===Mb.IMAGE&&this.N&&this.N.destroy();this.N=null;this.j&&(this.j.destroy(),this.j=null);this.i=null;n.prototype.destroy.call(this)};
Object.defineProperty(Ib.prototype,"type",{get:function(){return this.m}});Object.defineProperty(Ib.prototype,"texture",{get:function(){return this.c}});Object.defineProperty(Ib.prototype,"material",{get:function(){return this.f}});Object.defineProperty(Ib.prototype,"opacity",{get:function(){return this.D}});Object.defineProperty(Ib.prototype,"transparent",{get:function(){return this.u}});Object.defineProperty(Ib.prototype,"color",{get:function(){return this.B}});
Object.defineProperty(Ib.prototype,"displayObject",{get:function(){return this.N}});Object.defineProperty(Ib.prototype,"onReady",{get:function(){this.j||(this.j=new q(this));return this.j}});function Gb(a,b){this.f=a||{radius:200,theta:0,phi:0};this.j=b||{x:0,y:0,z:0};this.c={theta:10,phi:10,width:0,height:0};n.call(this,"HotspotTransform")}Gb.prototype=Object.create(n.prototype);Gb.prototype.constructor=Gb;
Gb.prototype.m=function(a){a=a.texture;var b=1,d=1;null!==a&&"undefined"!==typeof a.image&&(b=a.image.width,d=a.image.height);a=b/d;"number"===typeof this.c.phi&&(d=g.Math.ha(this.c.phi),d=2*this.f.radius*Math.tan(d/2),"auto"===this.c.theta&&(b=d*a));"number"===typeof this.c.theta&&(b=g.Math.ha(this.c.theta),b=2*this.f.radius*Math.tan(b/2),"auto"===this.c.phi&&(d=b/a));this.c.width=b;this.c.height=d};
Gb.prototype.load=function(a){"undefined"!==typeof a.position&&(this.f.radius="number"===typeof a.position.radius?a.position.radius:0,this.f.theta="number"===typeof a.position.theta?a.position.theta:0,this.f.phi="number"===typeof a.position.phi?a.position.phi:0);if("undefined"!==typeof a.rotation&&"auto"!==a.rotation)this.j.x="number"===typeof a.rotation.x?a.rotation.x:0,this.j.y="number"===typeof a.rotation.y?a.rotation.y:0,this.j.z="number"===typeof a.rotation.z?a.rotation.z:0;else if("undefined"===
typeof a.rotation||"auto"===a.rotation){var b=this.f,d={x:0,y:0,z:0};"undefined"!==typeof b&&(d.y="number"===typeof b.theta?-b.theta:0,d.x="number"===typeof b.phi?-b.phi:0);this.j=d}"undefined"!==typeof a.size&&(this.c.theta="number"===typeof a.size.theta?a.size.theta:"auto",this.c.phi="number"===typeof a.size.phi?a.size.phi:"auto")};Gb.prototype.destroy=function(){n.prototype.destroy.call(this)};Object.defineProperty(Gb.prototype,"position",{get:function(){return this.f}});
Object.defineProperty(Gb.prototype,"rotation",{get:function(){return this.j}});Object.defineProperty(Gb.prototype,"size",{get:function(){return this.c}});function Hb(a,b){this.f=this.B=null;this.G=this.u=this.I=!1;this.m=null;pb.call(this,a,b,"HotspotAnimation");this.j=[{prop:["rotation.x","rotation.y","rotation.z"],eb:[[-180,180],[-180,180],[-180,180]],smooth:!1},{prop:["position.radius","position.theta","position.phi"],eb:[null,[-180,180],[-180,180]],smooth:!1}]}Hb.prototype=Object.create(pb.prototype);
e=Hb.prototype;e.constructor=Hb;e.load=function(a){!0===a.enabled&&(this.I="boolean"===typeof a.loop?a.loop:!1,this.u="boolean"===typeof a.random?a.random:!1,this.G="boolean"===typeof a.autoPlay?a.autoPlay:!1,null!==a.tracks&&g.K.Pa(a.tracks,"string")&&(this.f=!0===this.u?g.K.Dd(a.tracks):a.tracks))};e.Ac=function(){if(1<this.f.length){var a=this.f.indexOf(this.B)+1;if(a<this.f.length){this.play(a);return}}!0===this.I?(!0===this.u&&(this.f=g.K.Dd(this.f)),this.play(0)):pb.prototype.Ac.call(this)};
e.Dh=function(){this.m&&this.m.F()};
e.play=function(a){this.B="number"===typeof a?this.f[a]:"string"===typeof a?a:this.f[0];a=g.S.get(this.B);rb(this);var b,d=a.offset,h=new kb(this.i,this.ta);h.tween.easing=g.X[a.easing];h.instruction=this.j[0];h.instruction.smooth=a.smooth;h.onComplete.add(this.Ac,this);h.onProgress.add(this.Dh,this);for(var k,l,p,r=0,u=a.keyframes.length;r<u;r++)b=a.keyframes[r].time+d,k=a.keyframes[r].data.rotation,"undefined"!==typeof k&&null!==k&&(l="undefined"!==typeof k.x&&null!==k.x?k.x:qb(this,b,a.keyframes,
"x",a.easing,"rotation"),p="undefined"!==typeof k.y&&null!==k.y?k.y:qb(this,b,a.keyframes,"y",a.easing,"rotation"),k="undefined"!==typeof k.z&&null!==k.z?k.z:qb(this,b,a.keyframes,"z",a.easing,"rotation"),b=new jb(b+d,{rotation:{x:l,y:p,z:k}}),h.timeline.Pb(b));if(0<h.timeline.keyframes.length&&0<h.timeline.keyframes[0].time||0<d)r={rotation:g.K.clone(this.ta.rotation)},b=new jb(0,r),h.timeline.Pb(b);this.c.push(h);h=new kb(this.i,this.ta);h.tween.easing=g.X[a.easing];h.instruction=this.j[1];h.instruction.smooth=
a.smooth;h.onComplete.add(this.Ac,this);h.onProgress.add(this.Dh,this);r=0;for(u=a.keyframes.length;r<u;r++)b=a.keyframes[r].time+d,k=a.keyframes[r].data.position,"undefined"!==typeof k&&null!==k&&(l="undefined"!==typeof k.radius&&null!==k.radius?k.radius:qb(this,b,a.keyframes,"radius",a.easing,"position"),p="undefined"!==typeof k.theta&&null!==k.theta?g.Math.eb(k.theta,-180,180):qb(this,b,a.keyframes,"theta",a.easing,"position"),k="undefined"!==typeof k.phi&&null!==k.phi?g.Math.eb(k.phi,-180,180):
qb(this,b,a.keyframes,"phi",a.easing,"position"),b=new jb(b+d,{position:{radius:l,theta:p,phi:k}}),h.timeline.Pb(b));if(0<h.timeline.keyframes.length&&0<h.timeline.keyframes[0].time||0<d)r={position:g.K.clone(this.ta.position)},b=new jb(0,r),h.timeline.Pb(b);this.c.push(h);this.c[0].play();this.c[1].play()};Object.defineProperty(Hb.prototype,"autoPlay",{get:function(){return this.G}});Object.defineProperty(Hb.prototype,"onProgress",{get:function(){this.m||(this.m=new q(this));return this.m}});
function Fb(a){sb.call(this,"HotspotAnimationTrack");this.c(a)}Fb.prototype=Object.create(sb.prototype);Fb.prototype.constructor=Fb;Fb.prototype.c=function(a){sb.prototype.c.call(this,a)};g.Nc={};g.Nc.Jf="3d";
function K(a){this.i=a;this.U=null;this.T=this.fa=this.M=this.$=this.O=this.H=this.V=this.aa=this.J=0;this.I=Math.PI/2;this.C=this.L=this.P=0;this.f=this.j=this.c=this.o=this.G=this.B=null;this.Z=0;this.m=this.u=this.D=null;n.call(this,"Camera");this.B=new THREE.Matrix4;this.G=new THREE.Matrix4;this.o=new THREE.Quaternion;this.u=new Sb(this.i,Tb.gaze);Ub(this);this.j=this.c.clone();this.j.name="CameraLeft";this.j.layers.enable(1);this.j.add(this.u.object);this.f=this.c.clone();this.f.name="CameraRight";
this.f.layers.enable(2)}K.prototype=Object.create(n.prototype);K.prototype.constructor=K;var Tb={parallax:0,yaw:{default:0},pitch:{default:0,min:-90,max:90},roll:{default:0},fov:{default:90},gaze:{delay:2E3,cursor:{innerRadius:.02,outerRadius:.04,color:16777215,opacity:.5},progress:{innerRadius:.02,outerRadius:.04,color:16711680,opacity:.5}}};
function Ub(a){"undefined"!==typeof a.i.renderer&&(a.c=new THREE.PerspectiveCamera(a.I,a.i.renderer.displayResolution.ratio,.01,1E4),a.c.name="CameraMain",a.c.matrixAutoUpdate=!1)}
function Vb(a,b){var d=Math.tan(g.Math.ha(a.upDegrees)),h=Math.tan(g.Math.ha(a.downDegrees)),k=Math.tan(g.Math.ha(a.leftDegrees)),l=Math.tan(g.Math.ha(a.rightDegrees));a=2/(k+l);var k=(k-l)*a*.5,l=2/(d+h),d=(d-h)*l*.5,h=new THREE.Matrix4,p=h.elements;p[0]=a;p[1]=0;p[2]=-k;p[3]=0;p[4]=0;p[5]=l;p[6]=d;p[7]=0;p[8]=0;p[9]=0;p[10]=b.far/(b.near-b.far);p[11]=b.far*b.near/(b.near-b.far);p[12]=0;p[13]=0;p[14]=-1;p[15]=0;h.transpose();return h}
function Wb(a){a.B=g.Math.le(a.J,a.H,a.M,!1);a.G=a.B.clone().transpose();a.o=g.Quaternion.Dc(a.J,a.H,a.M)}function Xb(a){a.B=g.Quaternion.Lk(a.o);a.G=a.B.clone().transpose();var b=g.Quaternion.Ke(a.o),d=b.pitch,h=b.roll,k=g.Math.Db;Yb(a,b.yaw,k);Zb(a,d,k);$b(a,h,k);ac(a,null,k)}function bc(a){a.m&&a.m.F(null,!0)}
function Yb(a,b,d){if("number"!==typeof b||!0===isNaN(b))return!1;d=d===g.Math.Wa||d===g.Math.Db?d:g.Math.Db;b=d===g.Math.Wa?g.Math.ha(b):b;b=g.Math.eb(b,-Math.PI,Math.PI);b=g.Math.ca(b,a.aa,a.V);d=a.J!==b;a.J=b;return d}function Zb(a,b,d){if("number"!==typeof b||!0===isNaN(b))return!1;d=d===g.Math.Wa||d===g.Math.Db?d:g.Math.Db;b=d===g.Math.Wa?g.Math.ha(b):b;b=g.Math.eb(b,-Math.PI,Math.PI);b=g.Math.ca(b,a.O,a.$);d=a.H!==b;a.H=b;return d}
function $b(a,b,d){if("number"!==typeof b||!0===isNaN(b))return!1;d=d===g.Math.Wa||d===g.Math.Db?d:g.Math.Db;b=d===g.Math.Wa?g.Math.ha(b):b;b=g.Math.eb(b,-Math.PI,Math.PI);b=g.Math.ca(b,a.fa,a.T);d=a.M!==b;a.M=b;return d}function ac(a,b,d){if("number"!==typeof b||!0===isNaN(b))return!1;d=d===g.Math.Wa||d===g.Math.Db?d:g.Math.Db;b=d===g.Math.Wa?g.Math.ha(b):b;b=g.Math.ca(b,a.P,a.L);d=a.I!==b;a.I=b;return d}
K.prototype.load=function(a){a=this.U=g.K.pb(Tb,a);this.C=a.parallax;this.Z=50*this.C;this.aa=g.Math.ha(a.yaw.min);this.V=g.Math.ha(a.yaw.max);Yb(this,a.yaw["default"],g.Math.Wa);this.O=g.Math.ha(a.pitch.min);this.$=g.Math.ha(a.pitch.max);Zb(this,a.pitch["default"],g.Math.Wa);this.fa=g.Math.ha(a.roll.min);this.T=g.Math.ha(a.roll.max);$b(this,a.roll["default"],g.Math.Wa);"undefined"!==typeof a.fov.min&&(this.P=g.Math.ha(a.fov.min));"undefined"!==typeof a.fov.max&&(this.L=g.Math.ha(a.fov.max));ac(this,
a.fov["default"],g.Math.Wa);Wb(this);bc(this);this.u.load(a.gaze)};K.prototype.uk=function(a,b,d,h,k){if("number"!==typeof k||!k)k=g.Math.Wa,Yb(this,a,k),Zb(this,b,k),$b(this,d,k),ac(this,h,k),Wb(this),bc(this);else if(null!==a||null!==b||null!==d||null!==h)a=new cc({keyframes:[{time:k,data:{yaw:a,pitch:b,roll:d,fov:h}}]}),this.animation.play(a.uid)};
K.prototype.update=function(){if(this.c){var a=(new THREE.Matrix4).copy(this.G);this.C&&a.multiply((new THREE.Matrix4).makeTranslation(0,0,-this.Z));this.c.quaternion.setFromRotationMatrix(a);this.c.matrixWorld=a;this.c.matrixWorldInverse.getInverse(a);this.c.fov=g.Math.pc(this.I);this.c.aspect=this.i.renderer.displayResolution.ratio;this.c.updateProjectionMatrix()}if(!0===this.i.renderer.display.presentingVR){this.u.update();var a=this.i.renderer.display,b=a.Vj();null!==b&&(this.o=b,Xb(this));var b=
a.vrDisplay.getEyeParameters("left"),d=a.vrDisplay.getEyeParameters("right");this.c.matrixWorld.decompose(this.j.position,this.j.quaternion,this.j.scale);this.j.matrixWorld=(new THREE.Matrix4).makeRotationFromQuaternion(this.c.quaternion);this.c.matrixWorld.decompose(this.f.position,this.f.quaternion,this.f.scale);this.f.matrixWorld=(new THREE.Matrix4).makeRotationFromQuaternion(this.c.quaternion);this.j.matrixWorld.elements[12]=this.c.matrixWorld.elements[12]+b.offset[0];this.j.matrixWorld.elements[13]=
this.c.matrixWorld.elements[13]+b.offset[1];this.j.matrixWorld.elements[14]=this.c.matrixWorld.elements[14]+b.offset[2];this.f.matrixWorld.elements[12]=this.c.matrixWorld.elements[12]+d.offset[0];this.f.matrixWorld.elements[13]=this.c.matrixWorld.elements[13]+d.offset[1];this.f.matrixWorld.elements[14]=this.c.matrixWorld.elements[14]+d.offset[2];a=a.vrFrameData;null!==a?(this.j.projectionMatrix.elements=a.leftProjectionMatrix,this.f.projectionMatrix.elements=a.rightProjectionMatrix):(this.j.projectionMatrix=
Vb({upDegrees:b.fieldOfView.upDegrees,downDegrees:b.fieldOfView.downDegrees,leftDegrees:b.fieldOfView.leftDegrees,rightDegrees:b.fieldOfView.rightDegrees},this.c),this.f.projectionMatrix=Vb({upDegrees:d.fieldOfView.upDegrees,downDegrees:d.fieldOfView.downDegrees,leftDegrees:d.fieldOfView.leftDegrees,rightDegrees:d.fieldOfView.rightDegrees},this.c));bc(this);a=0;for(b=this.f.children.length;a<b;a++)this.f.remove(this.f.children[a]);b=0;for(d=this.j.children.length;b<d;b++)a=this.j.children[b].clone(),
this.f.add(a)}};K.prototype.destroy=function(){this.c=this.o=this.G=this.B=null;this.u.destroy();this.u=null;this.m&&(this.m.destroy(),this.m=null);this.D&&(this.D.destroy(),this.D=null);this.i=null;n.prototype.destroy.call(this)};Object.defineProperty(K.prototype,"config",{get:function(){return this.U},set:function(a){this.load(a)}});Object.defineProperty(K.prototype,"yaw",{get:function(){return g.Math.pc(this.J)},set:function(a){!0===Yb(this,a,g.Math.Wa)&&(Wb(this),bc(this))}});
Object.defineProperty(K.prototype,"pitch",{get:function(){return g.Math.pc(this.H)},set:function(a){Zb(this,a,g.Math.Wa)&&(Wb(this),bc(this))}});Object.defineProperty(K.prototype,"roll",{get:function(){return g.Math.pc(this.M)},set:function(a){!0===$b(this,a,g.Math.Wa)&&(Wb(this),bc(this))}});Object.defineProperty(K.prototype,"fov",{get:function(){return g.Math.pc(this.I)},set:function(a){!0===ac(this,a,g.Math.Wa)&&bc(this)}});
Object.defineProperty(K.prototype,"fovMin",{get:function(){return g.Math.pc(this.P)},set:function(a){this.P=g.Math.ha(a)}});Object.defineProperty(K.prototype,"fovMax",{get:function(){return g.Math.pc(this.L)},set:function(a){this.L=g.Math.ha(a)}});Object.defineProperty(K.prototype,"quaternion",{get:function(){return this.o},set:function(a){this.o=a;Xb(this);bc(this)}});Object.defineProperty(K.prototype,"animation",{get:function(){this.D||(this.D=new dc(this.i,this));return this.D}});
Object.defineProperty(K.prototype,"parallax",{get:function(){return this.C},set:function(a){this.C=g.Math.ca(a,0,1);bc(this)}});Object.defineProperty(K.prototype,"modelView",{get:function(){return this.B}});Object.defineProperty(K.prototype,"modelViewInverse",{get:function(){return this.G}});Object.defineProperty(K.prototype,"main",{get:function(){this.c||Ub(this);return this.c}});Object.defineProperty(K.prototype,"perspectiveCameraRadius",{get:function(){return this.Z}});
Object.defineProperty(K.prototype,"left",{get:function(){return this.j}});Object.defineProperty(K.prototype,"right",{get:function(){return this.f}});Object.defineProperty(K.prototype,"gaze",{get:function(){return this.u}});Object.defineProperty(K.prototype,"onCameraChange",{get:function(){this.m||(this.m=new q(this));return this.m}});function dc(a,b){pb.call(this,a,b,"CameraAnimation");ec(this)}dc.prototype=Object.create(pb.prototype);dc.prototype.constructor=dc;
function ec(a){a.j=[{prop:"quaternion",smooth:!0,Qj:function(){!0===this.Ra.cancelRoll&&(this.ta.quaternion=g.Quaternion.cancelRoll(this.ta.quaternion))},cancelRoll:!0},{prop:"fov",smooth:!1}]}
dc.prototype.play=function(a){"string"===typeof a&&(a=g.S.get(a));rb(this);var b=new kb(this.i,this.ta);b.tween.easing=g.X[a.easing];b.instruction=this.j[0];b.instruction.smooth=a.smooth;b.smooth=a.smooth;b.instruction.cancelRoll=a.cancelRoll;b.onComplete.add(this.Ac,this);this.c.push(b);var d=new kb(this.i,this.ta);d.tween.easing=g.X[a.easing];d.instruction=this.j[1];d.instruction.smooth=a.smooth;d.onComplete.add(this.Ac,this);this.c.push(d);var h=a.keyframes,k=a.offset;a=a.easing;for(var k=k||0,
l,p,r,u,A=0,ob=h.length;A<ob;A++)p=h[A].data,l="undefined"!==typeof p.yaw&&null!==p.yaw?p.yaw:qb(this,h[A].time+k,h,"yaw",a),r="undefined"!==typeof p.pitch&&null!==p.pitch?p.pitch:qb(this,h[A].time+k,h,"pitch",a),u="undefined"!==typeof p.roll&&null!==p.roll?p.roll:qb(this,h[A].time+k,h,"roll",a),l=g.Math.ha(l),r=g.Math.ha(r),u=g.Math.ha(u),"undefined"!==typeof l&&null!==l&&"undefined"!==typeof r&&null!==r&&"undefined"!==typeof u&&null!==u&&(l=g.Quaternion.Dc(l,r,u),l=new jb(h[A].time+k,{quaternion:l}),
this.c[0].timeline.Pb(l)),"undefined"!==typeof p.fov&&null!==p.fov&&(p=p.fov,l=new jb(h[A].time+k,{fov:p}),this.c[1].timeline.Pb(l));if(0<h[0].time||0<k)l=new jb(0,{quaternion:g.K.clone(this.ta.quaternion)}),this.c[0].timeline.Pb(l),l=new jb(0,{fov:this.ta.fov}),this.c[1].timeline.Pb(l);b.play();d.play()};dc.prototype.destroy=function(){pb.prototype.destroy.call(this)};
function Sb(a,b){this.i=a;this.f=b;this.c=null;this.B=!1;this.u=this.m=null;this.o=0;n.call(this,"CameraGaze");this.m=this.i.clock.create(!1);this.c=new THREE.Object3D;this.c.name="CameraGaze";this.c.position.z=-2;fc(this)}Sb.prototype=Object.create(n.prototype);e=Sb.prototype;e.constructor=Sb;function gc(a,b,d,h,k,l){l=l||2*Math.PI;return new THREE.RingBufferGeometry(a||.02,b||.04,d||32,h||1,k||0,l)}
function fc(a){var b=new THREE.MeshBasicMaterial({color:a.f.cursor.color,opacity:a.f.cursor.opacity,transparent:!0}),b=new THREE.Mesh(gc(a.f.cursor.innerRadius,a.f.cursor.outerRadius),b);b.name="cursor";a.c.add(b)}
function hc(a){var b=new THREE.MeshBasicMaterial({color:a.f.progress.color,opacity:a.f.progress.opacity,transparent:!0,side:THREE.DoubleSide}),b=new THREE.Mesh(gc(a.f.progress.innerRadius,a.f.progress.outerRadius,32,1,Math.PI/2,a.o/100*g.Math.Fi),b);b.name="progress";b.rotateY(Math.PI);a.c.add(b)}function jc(a,b){for(var d=null,h=0,k=a.c.children.length;h<k;h++)a.c.children[h].name===b&&(d=a.c.children[h]);null!==d&&(a.c.remove(d),d.geometry.dispose(),d.material.dispose())}
e.yn=function(){this.stop();this.i.renderer.pickingManager.click()};e.load=function(a){this.f=a;jc(this,"progress");jc(this,"cursor");fc(this);!0===this.B&&this.o&&hc(this)};e.start=function(){this.log("startGazeAnimation");this.B=!0;this.o=0;jc(this,"progress");hc(this);this.m&&(this.m.stop(),this.u=this.m.add(2E3,this.yn,this),this.m.start())};
e.stop=function(){this.log("stopGazeAnimation");this.B=!1;this.m.stop();this.u=null;this.o=0;var a=this.c.children[1];"undefined"!==typeof a&&null!==a&&(this.c.remove(a),a.geometry.dispose(),a.material.dispose())};e.update=function(){if(!0===this.B&&this.u){var a=100*(this.u.delay-this.m.duration)/this.u.delay;this.log("timer update : "+a+"%");this.o=a;jc(this,"progress");hc(this)}};
e.destroy=function(){this.stop();this.c&&("undefined"!==typeof this.c.geometry&&null!==this.c.geometry&&this.c.geometry.dispose(),"undefined"!==typeof this.c.material&&null!==this.c.material&&this.c.material.dispose(),this.c=null);this.j=null};Object.defineProperty(Sb.prototype,"visible",{get:function(){return this.c.visible},set:function(a){this.c.visible=a}});Object.defineProperty(Sb.prototype,"object",{get:function(){return this.c}});g.tb={};g.tb.kb="pointer";g.tb.rf="keyboard";
function la(a){this.i=a;this.c=[];this.m=!0;this.f=this.j=null;n.call(this,"ControllerManager")}la.prototype=Object.create(n.prototype);la.prototype.constructor=la;var kc={enabled:!0,instances:[{uid:"controller-pointer-0",type:g.tb.kb,enabled:!0},{uid:"controller-keyboard-0",type:g.tb.rf,enabled:!0}]};e=la.prototype;e.Be=function(a){this.j&&this.j.F({controller:a})};e.Ae=function(a){this.f&&this.f.F({controller:a})};
e.update=function(){if(this.c)for(var a=0,b=this.c.length;a<b;a++)"function"===typeof this.c[a].update&&this.c[a].update()};e.ma=function(a){a="undefined"!==typeof a?a:kc;this.m="boolean"===typeof a.enabled?a.enabled:!0;if("undefined"!==typeof a.instances)for(var b,d=0,h=a.instances.length;d<h;d++){b=a.instances[d];switch(b.type){case g.tb.kb:b=new lc(this.i,b);break;case g.tb.rf:b=new mc(this.i,b);break;default:b=null}b&&this.c.push(b)}};
e.destroy=function(){for(var a=this.c.length-1;a--;)this.c[a].destroy(),this.c[a]=null;this.c=null;this.j&&(this.j.destroy(),this.j=null);this.f&&(this.f.destroy(),this.f=null);n.prototype.destroy.call(this)};Object.defineProperty(la.prototype,"all",{get:function(){return this.c}});Object.defineProperty(la.prototype,"enabled",{get:function(){return this.m},set:function(a){this.m=!!a}});
Object.defineProperty(la.prototype,"active",{get:function(){for(var a=0,b=this.c.length;a<b;a++)if(!0===this.c[a].active)return!0;return!1}});Object.defineProperty(la.prototype,"onControlStart",{get:function(){this.j||(this.j=new q(this));return this.j}});Object.defineProperty(la.prototype,"onControlEnd",{get:function(){this.f||(this.f=new q(this));return this.f}});function nc(a,b){this.i=a;this.c=null;this.D=this.B=!1;this.f=this.j=null;n.call(this,b||"ControllerBase");this.gd()}nc.prototype=Object.create(n.prototype);
e=nc.prototype;e.constructor=nc;e.gd=function(){this.i.canvas.pointer.enabled=!0;this.c=this.i.renderer.camera};e.enable=function(){!0!==this.B&&(this.B=!0)};e.cc=function(){!1!==this.B&&(this.B=!0)};e.destroy=function(){this.i=this.c=null;this.j&&(this.j.destroy(),this.j=null);this.f&&(this.f.destroy(),this.f=null);n.prototype.destroy.call(this)};Object.defineProperty(nc.prototype,"enabled",{get:function(){return this.B},set:function(a){!0===!!a?this.enable():this.cc()}});
Object.defineProperty(nc.prototype,"active",{get:function(){return this.D}});Object.defineProperty(nc.prototype,"onControlStart",{get:function(){this.j||(this.j=new q(this));return this.j}});Object.defineProperty(nc.prototype,"onControlEnd",{get:function(){this.f||(this.f=new q(this));return this.f}});function lc(a,b){this.H=b;this.I=this.m=this.G=this.o=null;nc.call(this,a,"ControllerPointer")}lc.prototype=Object.create(nc.prototype);lc.prototype.constructor=lc;
var oc={orientation:{hardness:.6,damping:.15,velocityMax:300,invert:!1},zoom:{hardness:5,invert:!1}};e=lc.prototype;e.gd=function(){nc.prototype.gd.call(this);this.I=new THREE.Vector2;this.m=new THREE.Vector2;this.o=new THREE.Vector2;this.G=new THREE.Vector2;var a=this.H;this.R=a.uid;aa(this);var b=a.options||{};this.u=g.K.pb(oc.orientation,b.orientation);this.C=g.K.pb(oc.zoom,b.zoom);this.B="boolean"===typeof a.enabled?a.enabled:!0;!0===this.B&&this.enable()};
e.ph=function(a){!1!==this.i.controllers.enabled&&(this.i.canvas.pointer.onPanMove.add(this.Te,this),this.log("_panStartHandler ("+a.data.velocityX.toFixed(2)+", "+a.data.velocityY.toFixed(2)+")"),this.D=!0,this.o=new THREE.Vector2(a.data.center.x,a.data.center.y),this.G.copy(this.o),this.m.set(0,0),this.j&&this.j.F(),this.i.controllers.Be(this))};e.Te=function(a){!1!==this.i.controllers.enabled&&this.G.set(a.data.center.x,a.data.center.y)};
e.oh=function(){this.i.canvas.pointer.onPanMove.remove(this.Te,this);this.log("_panEndHandler");this.D=!1;this.m.set(0,0);this.o.set(0,0);this.G.copy(this.o);this.f&&this.f.F();this.i.controllers.Ae(this)};e.rh=function(a){!1!==this.i.controllers.enabled&&(this.i.canvas.pointer.onPinchMove.add(this.qh,this),this.log("_pinchStartHandler "+a))};e.qh=function(a){!1!==this.i.controllers.enabled&&this.log("_pinchMoveHandler "+a.data.pinch)};
e.Ue=function(a){this.i.canvas.pointer.onPinchMove.remove(this.qh,this);this.log("_pinchEndHandler "+a)};e.sh=function(a){if(!1!==this.i.controllers.enabled){a.data.preventDefault();var b=(this.C.invert?1:-1)/this.C.hardness;a.data.deltaY&&(b*=a.data.deltaY/5);this.c.fov=this.c.fov-b;this.log("_wheelHandler (fov:"+this.c.fov+")")}};
e.enable=function(){nc.prototype.enable.call(this);this.i.canvas.pointer.onPanStart.add(this.ph,this);this.i.canvas.pointer.onPanEnd.add(this.oh,this);this.i.canvas.pointer.onPinchStart.add(this.rh,this);this.i.canvas.pointer.onPinchEnd.add(this.Ue,this);this.i.canvas.pointer.onWheel.add(this.sh,this)};
e.cc=function(){nc.prototype.cc.call(this);this.i.canvas.pointer.onPanStart.remove(this.ph,this);this.i.canvas.pointer.onPanMove.remove(this.Te,this);this.i.canvas.pointer.onPanEnd.remove(this.oh,this);this.i.canvas.pointer.onPinchStart.remove(this.rh,this);this.i.canvas.pointer.onPinchMove.remove(this.Ue,this);this.i.canvas.pointer.onPinchEnd.remove(this.Ue,this);this.i.canvas.pointer.onWheel.remove(this.sh,this)};
e.update=function(){var a=this.i.renderer.displayResolution,a=1/(this.u.hardness*Math.min(a.width,a.height));this.m.subVectors(this.G,this.o);this.m.length()>this.u.velocityMax&&this.m.setLength(this.u.velocityMax);this.m.multiplyScalar(a);var a=this.u.invert?-1:1,b=a*(this.m.x+this.I.x);.05<Math.abs(b)&&(this.c.yaw+=b);a*=this.m.y+this.I.y;.05<Math.abs(a)&&(this.c.pitch-=a);this.I.add(this.m).multiplyScalar(g.Math.ca(1-this.u.damping,0,1))};e.destroy=function(){nc.prototype.destroy.call(this)};
function mc(a,b){this.M=b;this.m=this.I=this.u=this.o=this.C=null;nc.call(this,a,"ControllerKeyboard")}mc.prototype=Object.create(nc.prototype);mc.prototype.constructor=mc;var pc={orientation:{hardness:.6,damping:.15,velocityMax:300,invert:!1},zoom:{hardness:5,invert:!1}};e=mc.prototype;
e.gd=function(){nc.prototype.gd.call(this);this.m=[];this.I=new THREE.Vector2;this.u=new THREE.Vector2;this.C=new THREE.Vector2;this.o=new THREE.Vector2;var a=this.M;this.R=a.uid;aa(this);var b=a.options||{};this.G=g.K.pb(pc.orientation,b.orientation);this.H=g.K.pb(pc.zoom,b.zoom);this.B="boolean"===typeof a.enabled?a.enabled:!0;!1!==b["default"]&&(a=new M(this.i,[81,37],this.de,this.fe,this.ee,[68,39],this,"left"),this.m.push(a),a=new M(this.i,[68,39],this.de,this.fe,this.ee,[81,37],this,"right"),
this.m.push(a),a=new M(this.i,[90,38],this.de,this.fe,this.ee,[83,40],this,"up"),this.m.push(a),a=new M(this.i,[83,40],this.de,this.fe,this.ee,[90,38],this,"down"),this.m.push(a),a=new M(this.i,107,this.mj,this.oj,this.nj,109,this,"plus"),this.m.push(a),a=new M(this.i,109,this.mj,this.oj,this.nj,107,this,"minus"),this.m.push(a));if(!0===Array.isArray(b.bindings))for(var a=0,d=b.bindings.length;a<d;a++){var h=b.bindings[a],k=h.in,l=h.out,p=h.name,h=h.events;!1===g.K.W(k,"number")&&!1===g.K.Pa(k,"number")?
this.warn("Can't add custom keyboard binding, keys in are invalid!"):"object"!==typeof h&&null===h?this.warn("Can't add custom keyboard binding, events are invalid!"):(k=new M(this.i,k,h.onDown,h.onUp,h.onHold,l,this,p),this.m.push(k))}!0===this.B&&this.enable()};e.de=function(a){if(!1!==this.i.controllers.enabled){this.D=!0;switch(a.name){case "left":case "right":this.u.setX(0);break;case "up":case "down":this.u.setY(0)}this.j&&this.j.F();this.i.controllers.Be(this)}};
e.ee=function(a){if(!1!==this.i.controllers.enabled)switch(a.name){case "left":this.o.setX(this.o.x-5);break;case "right":this.o.setX(this.o.x+5);break;case "up":this.o.setY(this.o.y-5);break;case "down":this.o.setY(this.o.y+5)}};e.fe=function(a){this.D=!1;switch(a.name){case "left":case "right":this.u.setX(0);this.o.setX(0);break;case "up":case "down":this.u.setY(0),this.o.setY(0)}this.f&&this.f.F();this.i.controllers.Ae(this)};
e.mj=function(a){!1!==this.i.controllers.enabled&&(this.D=!0,qc(this,a),this.j&&this.j.F(),this.i.controllers.Be(this))};e.nj=function(a){qc(this,a)};e.oj=function(){this.D=!1;this.f&&this.f.F();this.i.controllers.Ae(this)};function qc(a,b){var d=(a.H.invert?1:-1)/a.H.hardness;switch(b.name){case "minus":d*=10;break;case "plus":d*=-10}a.c.fov=a.c.fov-d}e.enable=function(){nc.prototype.enable.call(this);for(var a,b=0,d=this.m.length;b<d;b++)a=this.m[b],this.i.keyboard.Wf(a)};
e.cc=function(){nc.prototype.cc.call(this);for(var a,b=0,d=this.m.length;b<d;b++)a=this.m[b],this.i.keyboard.He(a)};
e.update=function(){var a=this.i.renderer.displayResolution,a=1/(this.G.hardness*Math.min(a.width,a.height));this.u.subVectors(this.o,this.C);this.u.length()>this.G.velocityMax&&this.u.setLength(this.G.velocityMax);this.u.multiplyScalar(a);a=this.G.invert?-1:1;this.c.yaw+=a*(this.u.x+this.I.x);this.c.pitch-=a*(this.u.y+this.I.y);this.I.add(this.u).multiplyScalar(g.Math.ca(1-this.G.damping,0,1))};e.destroy=function(){nc.prototype.destroy.call(this)};
function w(a){this.i=a;this.L=null;this.j=1;this.$=!1;this.U=this.H=this.Z=1;this.C=!1;this.P=!0;this.c=null;this.J=!1;this.m=!0;this.B=this.u=this.I=this.G=this.D=this.o=this.M=this.f=null;n.call(this,"SoundManager")}w.prototype=Object.create(n.prototype);e=w.prototype;e.constructor=w;
e.boot=function(){this.c=[];if(!0===g.A.Wg)try{"function"===typeof window.AudioContext?this.f=new window.AudioContext:this.f=new window.webkitAudioContext}catch(a){this.f=null,this.m=!1}!0!==g.A.Xf||this.f||(this.m=!1,this.J=!0);this.f&&(this.o="undefined"===typeof this.f.createGain?this.f.createGainNode():this.f.createGain(),this.M=this.f.createAnalyser(),this.M.connect(this.o),this.o.gain.value=this.j,this.o.connect(this.f.destination),this.f.listener.setOrientation(0,0,-1,0,1,0));this.i.tour.onSceneLoadStart.add(this.bi,
this)};e.bi=function(){if("undefined"!==typeof this.i.tour.scene.config.audio){var a=g.K.pb(this.L,this.i.tour.scene.config.audio);rc(this,a)}else rc(this,this.L);!1===this.P?this.u&&this.u.F():this.B&&this.B.F()};
function rc(a,b){b&&(a.P="undefined"!==typeof b.enabled?!!b.enabled:!0,a.H="undefined"!==typeof b.volume&&"number"===b.volume.max?g.Math.ca(b.volume.max,0,1):1,a.Z=!1===a.$?"undefined"!==typeof b.volume&&"number"===typeof b.volume["default"]?g.Math.ca(b.volume["default"],0,a.H):1:g.Math.ca(a.j,0,a.H))}e.ma=function(a){this.L=a;rc(this,a);"number"===typeof this.Z&&!1===this.$&&(this.j=g.Math.ca(this.Z,0,1));sc(this)};
e.update=function(){for(var a=0,b=this.c.length;a<b;a++)this.c[a].update();if(!0===this.m&&null!==this.i.renderer.camera.main){a=new THREE.Vector3;b=this.i.renderer.camera.main.quaternion;a.set(0,0,1);a.applyQuaternion(b);var d=a.clone();a.set(0,1,0);a.applyQuaternion(b);this.f.listener.setOrientation(d.x,d.y,d.z,a.x,a.y,a.z)}};e.add=function(a){-1===tc(this,a)&&this.c.push(a)};e.remove=function(a){a=tc(this,a);-1<a&&this.c.splice(a,1)};
function tc(a,b){if(!a.c)return-1;for(var d,h=0,k=a.c.length;h<k;h++)if(d=a.c[h],d===b)return h;return-1}e.Zf=function(){if(this.f&&"undefined"!==typeof this.f.suspend&&!0===this.m&&"running"===this.f.state){for(var a=!0,b=0,d=this.c.length;b<d;b++)if(!0===this.c[b].playing||!0===this.c[b].paused){a=!1;break}!0===a&&this.f.suspend()}};
e.Yf=function(){if(this.f&&"undefined"!==typeof this.f.resume&&!0===this.m&&"suspended"===this.f.state)for(var a=0,b=this.c.length;a<b;a++)if(!0===this.c[a].playing||!0===this.c[a].paused){this.f.resume();break}};e.qb=function(){!0!==this.C&&(this.C=!0,this.U=this.j,this.j=0,!0===this.m&&(this.U=this.o.gain.value),sc(this),this.D&&this.D.F())};e.ci=function(){!1!==this.C&&(this.C=!1,this.j=this.U,sc(this),this.G&&this.G.F())};
function sc(a){if(!0===a.m)a.o.gain.value=a.j;else if(!0===a.J)for(var b=0;b<a.c.length;b++)a.c[b].c.data.volume=g.Math.ca(a.c[b].D,0,1)*a.j;a.$=!0;a.I&&a.I.F()}
e.destroy=function(){this.i.tour.onSceneLoadStart.remove(this.bi,this);this.L=this.i=null;for(var a=this.c.length;a--;)this.c[a].destroy();this.o=this.M=this.f=this.c=null;this.D&&(this.D.destroy(),this.D=null);this.G&&(this.G.destroy(),this.G=null);this.I&&(this.I.destroy(),this.I=null);this.u&&(this.u.destroy(),this.u=null);this.B&&(this.B.destroy(),this.B=null);n.prototype.destroy.call(this)};Object.defineProperty(w.prototype,"context",{get:function(){return this.f}});
Object.defineProperty(w.prototype,"analyser",{get:function(){return this.M}});Object.defineProperty(w.prototype,"inputNode",{get:function(){return this.M}});Object.defineProperty(w.prototype,"masterGain",{get:function(){return this.o}});Object.defineProperty(w.prototype,"useWebAudio",{get:function(){return this.m},set:function(a){"boolean"===typeof a&&(this.m=a,this.J=!a)}});
Object.defineProperty(w.prototype,"useAudioTag",{get:function(){return this.J},set:function(a){"boolean"===typeof a&&(this.J=a,this.m=!a)}});Object.defineProperty(w.prototype,"enabled",{get:function(){return this.P}});Object.defineProperty(w.prototype,"muted",{get:function(){return this.C},set:function(a){"boolean"===typeof a&&(!0===a?this.qb():this.ci())}});
Object.defineProperty(w.prototype,"volume",{get:function(){return!0===this.m?this.o.gain.value:this.j},set:function(a){"number"===typeof a&&(a=g.Math.ca(a,0,1),this.j=this.H<a?this.H:a,0<this.j&&(this.C=!1),sc(this))}});Object.defineProperty(w.prototype,"onMute",{get:function(){this.D||(this.D=new q(this));return this.D}});Object.defineProperty(w.prototype,"onUnmute",{get:function(){this.G||(this.G=new q(this));return this.G}});
Object.defineProperty(w.prototype,"onVolumeChange",{get:function(){this.I||(this.I=new q(this));return this.I}});Object.defineProperty(w.prototype,"onDisable",{get:function(){this.u||(this.u=new q(this));return this.u}});Object.defineProperty(w.prototype,"onEnable",{get:function(){this.B||(this.B=new q(this));return this.B}});g.lb={};g.lb.Yl="stereo";g.lb.Xl="3d";g.lb.Ne="ambisonic";
function L(a,b,d,h){this.i=a;this.la=b;this.j=d;this.va=this.D=1;this.ia=!1;this.L=!0;this.da=!1;this.B=this.Ea=this.H=this.M=this.o=0;this.u=this.P=!1;this.Fa=0;this.C=!1;this.I=this.Ja=this.f=this.m=this.na=this.c=this.J=null;this.Ka=this.wa=this.Ga=0;this.qa=null;this.pa=h||!1;this.Na=[0,1,2,3];this.ja=this.Da=!1;this.ya=this.xa=null;this.Ba=!1;this.$=this.aa=this.V=this.sa=this.G=this.Aa=this.ra=this.fa=this.Z=this.U=this.T=this.O=this.Ca=null;n.call(this,"Sound");!0===this.pa&&!1===uc(this)&&
(this.log("FORGE.Sound: can't manage ambisonic sound without Google Chrome Omnitone library and WebAudio API."),this.pa=!1);this.R=this.la;aa(this);!0===this.i.audio.useWebAudio&&(this.f=this.i.audio.context,this.Ja=this.i.audio.inputNode,this.I="undefined"===typeof this.f.createGain?this.f.createGainNode():this.f.createGain(),this.I.gain.value=this.D*this.i.audio.volume,this.I.connect(this.Ja));if(!0===this.i.audio.useAudioTag||!0===uc(this))!0===this.i.cache.has(C.Eb,this.la)&&this.ei(this.i.cache.get(C.Eb,
this.la)),this.i.audio.onVolumeChange.add(this.fi,this);this.i.audio.onDisable.add(this.di,this);""!==this.j&&(this.i.load.sound(this.la,this.j,this.ei,this,uc(this)),this.O&&this.O.F());this.i.audio.add(this)}L.prototype=Object.create(n.prototype);e=L.prototype;e.constructor=L;
e.ei=function(a){this.J=a;this.ja=!0;this.T&&this.T.F();!0===this.i.audio.useWebAudio?(a=this.J)&&!1===this.Ba&&(this.xa=this.Hi.bind(this),this.ya=this.sm.bind(this),!0===uc(this)?(this.qa=Omnitone.createFOADecoder(this.f,a.data,{channelMap:this.Na}),this.qa.initialize().then(this.xa,this.ya)):this.f.decodeAudioData(a.data,this.xa,this.ya)):(vc(this),this.Hi(null))};e.sm=function(){this.J&&(this.J.data=null,this.Ba=!1)};function vc(a){a.Ca&&a.Ca.F();a.U&&a.U.F();a.Z&&a.Z.F()}
e.Hi=function(a){if(this.J){a&&(this.J.data=a);this.Ba=!0;vc(this);if(!0===this.i.audio.useAudioTag||!0===uc(this))this.c=this.i.cache.get(C.Eb,this.la),wc(this),this.o=0,this.c.data.duration&&(this.o=this.c.data.duration,this.M=Math.ceil(1E3*this.o));!0===this.Da&&this.play(this.B,this.P,!0)}};e.fi=function(){wc(this)};function wc(a){!a.c||!0!==a.i.audio.useAudioTag&&!0!==uc(a)||(a.c.data.volume=g.Math.ca(a.D,0,1)*a.i.audio.volume)}e.di=function(){!0===this.u?this.pause():!1===this.paused&&this.stop()};
function xc(a){a.B=0;a.Da=!1;a.u=!1;a.C=!1}function yc(a,b){null===a.m&&(a.m=a.f.createPanner(),a.m.panningModel="HRTF",a.m.distanceModel="inverse",a.m.refDistance=1,a.m.maxDistance=1E4,a.m.rolloffFactor=1,a.m.coneInnerAngle=360,a.m.coneOuterAngle=0,a.m.coneOuterGain=0,a.m.setOrientation(0,0,0),a.m.setPosition(0,0,0));a.m.setPosition(a.Ga,a.wa,a.Ka);!0===b&&(a.c.connect(a.m),a.m.connect(a.I))}function uc(a){return!0===a.pa&&!0===a.i.audio.useWebAudio&&"undefined"!==typeof Omnitone}
e.update=function(){if(!0===this.u&&!1===this.C){var a=this.i.clock.time-this.H;if(a>=this.M){if(this.B=this.M,!0===this.i.audio.useWebAudio||!0===this.i.audio.useAudioTag)this.stop(!0),this.$&&this.$.F(),!0===this.P&&(this.B=0,this.resume())}else this.B=a}this.qa&&!0===this.u&&this.qa.setRotationMatrixFromCamera(this.i.renderer.camera.modelViewInverse)};
e.play=function(a,b,d){if(!1===this.i.audio.enabled||!1===this.L)this.C=this.u=!1;else{this.P=b||this.P;if(!0===this.u)if(!0===d)this.stop();else return;if(!1===this.ja)this.Da=!0;else if(!0===this.i.audio.useWebAudio&&!1===uc(this))!0===this.Ba?(this.na||(this.na=this.J.data),this.c=this.f.createBufferSource(),this.c.buffer=this.na,!0===this.da?yc(this,!0):this.c.connect(this.I),this.o=this.c.buffer.duration,this.M=Math.ceil(1E3*this.o),!isNaN(a)&&a<this.M?this.H=this.i.clock.time-a:(a=0,this.H=
this.i.clock.time),b=g.Math.Ed(a/1E3),"undefined"===typeof this.c.start?this.c.noteGrainOn(0,b%this.o,this.o):this.c.start(0,b%this.o,this.o),this.u=!0,this.B=a,this.Fa++,this.G&&this.G.F(),this.i.audio.Yf()):(this.log("Sound is not decoded yet"),this.Da=!0);else if(!0===this.i.audio.useAudioTag||!0===uc(this))this.o?Infinity===this.o&&(this.c.data.loop=!0):(this.o=this.c.data.duration,this.M=Math.ceil(1E3*this.o)),!isNaN(a)&&this.M&&a<this.M?(this.c.data.currentTime=g.Math.Ed(a/1E3),this.H=this.i.clock.time-
a):(a=0,this.c.data.currentTime=a,this.H=this.i.clock.time),this.c.data.play(),this.u=!0,this.B=a,this.Fa++,this.G&&this.G.F()}};e.stop=function(a){this.c?(zc(this,!0),this.H=this.Ea=this.i.clock.time,this.C=this.u=this.Da=!1,this.sa&&!0===a&&this.sa.F(),this.i.audio.Zf()):!1!==this.ja&&!0===this.Ba||xc(this)};
function zc(a,b){if(!0===a.i.audio.useWebAudio&&!1===uc(a)){if("undefined"===typeof a.c.stop)a.c.noteOff(0);else try{a.c.stop(0)}catch(d){}a.c.disconnect(0);!0===b&&(a.B=0)}else if(!0===a.i.audio.useAudioTag||!0===uc(a))a.c.data.pause(),!0===b&&(a.B=0,a.c.data.currentTime=0)}e.pause=function(){!0===this.u&&this.c?(zc(this,!1),this.C=!0,this.Ea=this.i.clock.time,this.u=this.Da=!1,this.V&&this.V.F(),this.i.audio.Zf()):!1!==this.ja&&!0===this.Ba||xc(this)};
e.resume=function(){if(!1!==this.i.audio.enabled&&!1!==this.L)if(!0===this.C||!1===this.u)if(this.c){this.H=this.i.clock.time-(this.Ea-this.H);this.B=this.i.clock.time-this.H;var a=g.Math.Ed(this.B/1E3);if(!0===this.i.audio.useWebAudio&&!1===uc(this)){this.c=this.f.createBufferSource();this.c.buffer=this.na;!0===this.da?yc(this,!0):this.c.connect(this.I);var b=Math.ceil((this.M-this.B)/1E3);"undefined"===typeof this.c.start?this.c.noteGrainOn(0,a%this.o,b):this.c.start(0,a%this.o,b)}else if(!0===
this.i.audio.useAudioTag||!0===uc(this))this.c.data.currentTime=g.Math.Ed(a/1E3),this.c.data.play();this.u=!0;this.C=!1;this.aa&&this.aa.F();this.i.audio.Yf()}else this.play(this.B,this.P,!0);else if(!1===this.ja||!1===this.Ba)xc(this),this.Da=!0};
e.qb=function(){!0!==this.ia&&!1!==this.i.audio.enabled&&!1!==this.L&&(this.ia=!0,this.va=this.D,this.D=0,!0===this.i.audio.useWebAudio&&!1===uc(this)?this.I.gain.value=this.D:!0!==this.i.audio.useAudioTag&&!0!==uc(this)||!this.c||(this.c.data.volume=this.D),this.fa&&this.fa.F())};
e.gi=function(){!1!==this.ia&&!1!==this.i.audio.enabled&&!1!==this.L&&(this.ia=!1,this.D=this.va,!0===this.i.audio.useWebAudio&&!1===uc(this)?this.I.gain.value=this.va:!0!==this.i.audio.useAudioTag&&!0!==uc(this)||!this.c||(this.c.data.volume=this.va),this.ra&&this.ra.F())};
e.destroy=function(){this.stop();!0!==this.i.audio.useAudioTag&&!0!==uc(this)||this.i.audio.onVolumeChange.remove(this.fi,this);this.i.audio.onDisable.remove(this.di,this);this.i.audio.remove(this);this.ya=this.xa=this.m=this.I=this.Ja=this.f=this.na=this.c=this.J=this.i=null;this.Ca&&(this.Ca.destroy(),this.Ca=null);this.O&&(this.O.destroy(),this.O=null);this.T&&(this.T.destroy(),this.T=null);this.U&&(this.U.destroy(),this.U=null);this.Z&&(this.Z.destroy(),this.Z=null);this.fa&&(this.fa.destroy(),
this.fa=null);this.ra&&(this.ra.destroy(),this.ra=null);this.Aa&&(this.Aa.destroy(),this.Aa=null);this.G&&(this.G.destroy(),this.G=null);this.sa&&(this.sa.destroy(),this.sa=null);this.V&&(this.V.destroy(),this.V=null);this.aa&&(this.aa.destroy(),this.aa=null);this.$&&(this.$.destroy(),this.$=null);n.prototype.destroy.call(this)};Object.defineProperty(L.prototype,"enabled",{get:function(){return this.L},set:function(a){"boolean"===typeof a&&(this.L=a,!1!==this.L||!0!==this.u&&!0!==this.C||this.stop())}});
Object.defineProperty(L.prototype,"currentTime",{get:function(){return this.B},set:function(a){"number"===typeof a&&(this.pause(),this.B=a,!0===this.u&&this.resume())}});Object.defineProperty(L.prototype,"spatialized",{get:function(){return this.da},set:function(a){"boolean"===typeof a&&(this.da=a)}});Object.defineProperty(L.prototype,"ambisonic",{get:function(){return this.pa}});Object.defineProperty(L.prototype,"duration",{get:function(){return this.o}});
Object.defineProperty(L.prototype,"muted",{get:function(){return this.ia||this.i.audio.qb},set:function(a){"boolean"===typeof a&&(!0===a?this.qb():this.gi())}});Object.defineProperty(L.prototype,"volume",{get:function(){return this.D},set:function(a){"number"===typeof a&&!0!==isNaN(a)&&(a=g.Math.ca(a,0,1),a!==this.D&&!1!==this.i.audio.enabled&&!1!==this.L&&(this.D=a,0<this.D&&(this.ia=!1),!0===this.i.audio.useWebAudio&&!1===uc(this)?this.I.gain.value=a:wc(this),this.Aa&&this.Aa.F()))}});
Object.defineProperty(L.prototype,"decoded",{get:function(){return this.J?this.Ba:!1}});Object.defineProperty(L.prototype,"playCount",{get:function(){return this.Fa}});Object.defineProperty(L.prototype,"playing",{get:function(){return this.u}});Object.defineProperty(L.prototype,"ready",{get:function(){return this.ja}});Object.defineProperty(L.prototype,"paused",{get:function(){return this.C}});
Object.defineProperty(L.prototype,"loop",{get:function(){return this.P},set:function(a){"boolean"===typeof a&&(this.P=a,!0!==this.i.audio.useAudioTag&&!0!==uc(this)||!this.c||Infinity!==this.o||(this.c.data.loop=this.P))}});Object.defineProperty(L.prototype,"x",{get:function(){return this.Ga},set:function(a){"number"===typeof a&&(this.Ga=a,!0===this.i.audio.useWebAudio&&!1===uc(this)&&this.c&&null!==this.m&&!0===this.da&&yc(this))}});
Object.defineProperty(L.prototype,"y",{get:function(){return this.wa},set:function(a){"number"===typeof a&&(this.wa=a,!0===this.i.audio.useWebAudio&&!1===uc(this)&&this.c&&null!==this.m&&!0===this.da&&yc(this))}});Object.defineProperty(L.prototype,"z",{get:function(){return this.wa},set:function(a){"number"===typeof a&&(this.Ka=a,!0===this.i.audio.useWebAudio&&!1===uc(this)&&this.c&&null!==this.m&&!0===this.da&&yc(this))}});
Object.defineProperty(L.prototype,"onSoundDecode",{get:function(){this.Ca||(this.Ca=new q(this));return this.Ca}});Object.defineProperty(L.prototype,"onLoadStart",{get:function(){this.O||(this.O=new q(this));return this.O}});Object.defineProperty(L.prototype,"onLoadedData",{get:function(){this.T||(this.T=new q(this));return this.T}});Object.defineProperty(L.prototype,"onCanPlay",{get:function(){this.U||(this.U=new q(this));return this.U}});
Object.defineProperty(L.prototype,"onCanPlayThrough",{get:function(){this.Z||(this.Z=new q(this));return this.Z}});Object.defineProperty(L.prototype,"onMute",{get:function(){this.fa||(this.fa=new q(this));return this.fa}});Object.defineProperty(L.prototype,"onUnmute",{get:function(){this.ra||(this.ra=new q(this));return this.ra}});Object.defineProperty(L.prototype,"onVolumeChange",{get:function(){this.Aa||(this.Aa=new q(this));return this.Aa}});
Object.defineProperty(L.prototype,"onPlay",{get:function(){this.G||(this.G=new q(this));return this.G}});Object.defineProperty(L.prototype,"onStop",{get:function(){this.sa||(this.sa=new q(this));return this.sa}});Object.defineProperty(L.prototype,"onPause",{get:function(){this.V||(this.V=new q(this));return this.V}});Object.defineProperty(L.prototype,"onResume",{get:function(){this.aa||(this.aa=new q(this));return this.aa}});
Object.defineProperty(L.prototype,"onEnded",{get:function(){this.$||(this.$=new q(this));return this.$}});
function N(a,b){this.i=a;this.j=b;this.M=this.c=null;this.f=this.P="";this.J=this.m=1;this.H=this.L=this.C=!0;this.o=this.G=this.u=this.I=this.B=this.D=null;n.call(this,"Playlist");this.R=this.j.uid;aa(this);this.M=new D(this.i,this.j.name);this.c=[];a=this.j;this.C="undefined"!==typeof a.autoPlay?!!a.autoPlay:!0;this.H="undefined"!==typeof a.loop?!!a.loop:!0;this.m="undefined"!==typeof a.volume&&"number"===typeof a.volume.max?g.Math.ca(a.volume.max,0,1):1;this.J="undefined"!==typeof a.volume&&"number"===
typeof a.volume["default"]?g.Math.ca(a.volume["default"],0,this.m):g.Math.ca(1,0,this.m);a=this.j;"undefined"!==typeof a.tracks&&!0===g.K.Pa(a.tracks,"string")?this.c=a.tracks:this.warn("A playlist has no track in its configuration, or configuration is not valid!");"string"===typeof a["default"]&&""!==a["default"]?this.P=a["default"]:"number"===typeof a["default"]&&0<=a["default"]&&a["default"]<this.c.length?this.P=this.c[a["default"]].uid:this.warn("A playlist has a default track that is not in its tracks array!");
this.f=this.P;this.D&&this.D.F()}N.prototype=Object.create(n.prototype);e=N.prototype;e.constructor=N;e.he=function(){0<this.c.length&&this.c.indexOf(this.f)+1===this.c.length&&(!1===this.H||!0===this.track.loop)?this.f=this.c[0]:this.Cd()};e.rl=function(){this.B&&this.B.F()};e.tl=function(){this.I&&this.I.F()};e.ql=function(){this.u&&this.u.F()};e.sl=function(){this.G&&this.G.F()};e.pl=function(){this.o&&this.o.F()};e.ul=function(){return!!this.c.length};
e.play=function(a,b){this.L="undefined"!==typeof b?b:!1;var d;if("string"===typeof a&&g.S.W(a,"PlaylistTrack"))d=a;else if(g.K.W(a,"PlaylistTrack"))d=a.uid;else if("number"===typeof a&&0<=a&&a<this.c.length)d=this.c[a];else if(""!==this.f)d=this.f;else if("undefined"===typeof a||""===a)d=this.c[0];if("undefined"!==typeof d){this.stop();this.f=d;if(!0===this.L&&!1===this.C)return this.warn("FORGE.Playlist.play(); autoPlay is disabled"),this.track;this.track.play();!1===this.track.onEnded.has(this.he,
this)&&this.track.onEnded.add(this.he,this);this.log("FORGE.Playlist.play(); [uid: "+this.f+"]");return this.track}return null};e.stop=function(){null!==this.track&&(this.track.stop(),"undefined"!==typeof this.track.onEnded&&!1===this.track.onEnded.has(this.he,this)&&this.track.onEnded.remove(this.he,this))};e.pause=function(){null!==this.track&&this.track.pause()};e.resume=function(){null!==this.track&&this.track.resume()};
e.Cd=function(){var a=-1;0<this.c.length&&(a=this.c.indexOf(this.f)+1,a===this.c.length&&(a=0));this.play(a,this.L);!0===this.paused&&this.pause()};e.Ge=function(){var a=-1;0<this.c.length&&(a=this.c.indexOf(this.f)-1,-1===a&&(a=this.c.length-1));this.play(a,this.L);!0===this.paused&&this.pause()};e.destroy=function(){this.stop();this.i=null;this.M.destroy();this.M=null;0<this.c.length&&(this.c.length=0,this.c=null);this.j=null;n.prototype.destroy.call(this)};
Object.defineProperty(N.prototype,"tracks",{get:function(){return this.c}});Object.defineProperty(N.prototype,"name",{get:function(){return this.M.value}});Object.defineProperty(N.prototype,"ready",{get:function(){return null!==this.track?this.track.ready:!1}});Object.defineProperty(N.prototype,"decoded",{get:function(){return null!==this.track?this.track.decoded:!1}});Object.defineProperty(N.prototype,"playing",{get:function(){return null!==this.track?this.track.playing:!1}});
Object.defineProperty(N.prototype,"paused",{get:function(){return null!==this.track?this.track.paused:!1}});Object.defineProperty(N.prototype,"track",{get:function(){return!0===g.S.W(this.f,"PlaylistTrack")?g.S.get(this.f,"PlaylistTrack"):null}});Object.defineProperty(N.prototype,"loop",{get:function(){return this.H},set:function(a){this.H=!!a}});Object.defineProperty(N.prototype,"autoPlay",{get:function(){return this.C},set:function(a){this.C=!!a}});
Object.defineProperty(N.prototype,"volume",{get:function(){return this.J},set:function(a){"number"===typeof a&&(a=g.Math.ca(a,0,1),this.J=this.m<a?this.m:a,!0===g.S.W(this.f,"PlaylistTrack")&&(a=g.S.get(this.f,"PlaylistTrack"),null!==a&&(a.volume=this.J*this.i.playlists.volume)))}});Object.defineProperty(N.prototype,"onPlay",{get:function(){this.B||(this.B=new q(this));return this.B}});Object.defineProperty(N.prototype,"onStop",{get:function(){this.I||(this.I=new q(this));return this.I}});
Object.defineProperty(N.prototype,"onPause",{get:function(){this.u||(this.u=new q(this));return this.u}});Object.defineProperty(N.prototype,"onResume",{get:function(){this.G||(this.G=new q(this));return this.G}});Object.defineProperty(N.prototype,"onEnded",{get:function(){this.o||(this.o=new q(this));return this.o}});Object.defineProperty(N.prototype,"onReady",{get:function(){this.D||(this.D=new q(this));return this.D}});
function z(a){this.i=a;this.u=this.c=this.M=null;this.f=this.j="";this.J=this.B=1;this.m=!0;this.o=this.P=!1;this.D=this.C=this.G=this.H=this.I=this.L=null;n.call(this,"PlaylistManager")}z.prototype=Object.create(n.prototype);e=z.prototype;e.constructor=z;e.boot=function(){this.c=[];this.u=[];this.i.audio.onEnable.add(this.Ki,this);this.i.tour.onSceneLoadStart.add(this.Jh,this)};
e.Ki=function(){!0===this.m&&0<this.c.length&&!0===this.ready&&!0===this.decoded&&!1===this.o&&(!0===this.paused?this.resume():!1===this.playing&&this.play())};
e.Jh=function(){if("undefined"!==typeof this.i.tour.scene.config.playlists){var a=g.K.pb(this.M,this.i.tour.scene.config.playlists);Ac(this,a);!1===this.o&&(!1===this.m?Bc(this):Cc(this,this.f)||!0===this.playing&&Bc(this))}else Ac(this,this.M),!1===this.o&&this.f!==this.j&&(!1!==this.m&&!1!==this.ready&&!1!==this.decoded&&!0!==this.playing||Bc(this),Cc(this,this.f))};
function Ac(a,b){b&&(a.m="undefined"!==typeof b.enabled?!!b.enabled:!0,"undefined"!==typeof b["default"]&&("string"===typeof b["default"]&&""!==b["default"]?a.f=b["default"]:"number"===typeof b["default"]&&0<=b["default"]&&b["default"]<a.c.length&&(a.f=a.c[b["default"]].uid)),a.B="undefined"!==typeof b.volume&&"number"===typeof b.volume.max?g.Math.ca(b.volume.max,0,1):1,a.J="undefined"!==typeof b.volume&&"number"===typeof b.volume["default"]?g.Math.ca(b.volume["default"],0,a.B):g.Math.ca(1,0,a.B))}
e.ma=function(a){var b;this.M=a;if("undefined"!==typeof a.lists)for(var d=0,h=a.lists.length;d<h;d++)b=new N(this.i,a.lists[d]),this.add(b);if("undefined"!==typeof a.tracks)for(d=0,h=a.tracks.length;d<h;d++)b=new O(this.i,a.tracks[d]),this.Kh(b),!0===this.P&&this.warn("Preload is not supported yet.");Ac(this,a);"undefined"!==typeof a.lists&&0<a.lists.length&&(""===this.f&&this.warn("The playlist manager has a default playlist that is not in its playlists array!"),this.j=this.f);if(!(0>=this.c.length)){var k;
"string"===typeof this.f&&""!==this.f?k=this.f:k=this.c[0].uid;void 0===g.S.get(k)&&this.warn('PlaylistManager : uid "'+k+'" is not into playlists');!0===g.S.W(k,"Playlist")?this.play(k,!0):this.warn("Impossible to play the playlist with uid "+k+", it doesn't seem to be a playlist!")}};
function Cc(a,b){return null!==b&&!0===g.S.W(b,"Playlist")?(null!==a.playlist&&a.playlist.uid===b?null!==a.playlist.track&&"undefined"!==typeof a.playlist.track.uid&&""!==a.playlist.track.uid?!0===a.paused?a.resume():!1===a.playing&&a.play(b,!0):(a.stop(),a.play(b,!0)):(a.stop(),a.play(b,!0)),!0):!1}function Bc(a){!0===a.playing?a.pause():a.stop()}e.ll=function(){this.I&&this.I.F();null!==this.playlist&&N.prototype.rl.call(this.playlist)};e.nl=function(){this.H&&this.H.F();null!==this.playlist&&N.prototype.tl.call(this.playlist)};
e.kl=function(){this.G&&this.G.F();null!==this.playlist&&N.prototype.ql.call(this.playlist)};e.ml=function(){this.C&&this.C.F();null!==this.playlist&&N.prototype.sl.call(this.playlist)};e.jl=function(){this.D&&this.D.F();null!==this.playlist&&N.prototype.pl.call(this.playlist)};e.add=function(a){this.c.push(a)};e.Kh=function(a){this.u.push(a)};e.Xn=function(){return!!this.c.length};e.ol=function(){return!!this.u.length};
e.play=function(a,b){var d;if("string"===typeof a&&g.S.W(a,"Playlist"))d=a;else if(g.K.W(a,"Playlist"))d=a.uid;else if("number"===typeof a&&0<=a&&a<this.c.length)d=this.c[a].uid;else if(""!==this.j)d=this.j;else if("undefined"===typeof a||""===a)d=this.c[0].uid;"undefined"!==typeof d&&(!0===this.playing&&this.stop(),this.j=d,!0===this.m&&(this.o=!1,this.playlist.play(null,b),this.log("FORGE.PlaylistManager.play(); [uid: "+this.j+"]")))};e.stop=function(){null!==this.playlist&&this.playlist.stop()};
e.pause=function(){null!==this.playlist&&!0===this.playlist.playing&&(this.o=!0,this.playlist.pause())};e.resume=function(){if(null!==this.playlist&&!0===this.m&&!0===this.playlist.paused){var a=this.o;this.o=!1;!0===a&&this.f!==this.j?Cc(this,this.f):this.playlist.resume()}};e.Cd=function(){null!==this.playlist&&!0===this.m&&this.playlist.Cd()};e.Ge=function(){null!==this.playlist&&!0===this.m&&this.playlist.Ge()};
e.destroy=function(){this.stop();this.i.audio.onEnable.remove(this.Ki,this);this.i.tour.onSceneLoadStart.remove(this.Jh,this);this.M=this.i=null;for(var a=this.c.length;a--;)this.c[a].destroy();this.c=null;for(a=this.u.length;a--;)this.u[a].destroy();this.u=null;n.prototype.destroy.call(this)};Object.defineProperty(z.prototype,"playlists",{get:function(){return this.c}});Object.defineProperty(z.prototype,"tracks",{get:function(){return this.u}});
Object.defineProperty(z.prototype,"playlist",{get:function(){return!0===g.S.W(this.j,"Playlist")?g.S.get(this.j,"Playlist"):null}});Object.defineProperty(z.prototype,"loop",{get:function(){return null!==this.playlist?this.playlist.loop:!0}});Object.defineProperty(z.prototype,"autoPlay",{get:function(){return null!==this.playlist?this.playlist.autoPlay:!0}});Object.defineProperty(z.prototype,"preload",{get:function(){return this.P},set:function(a){this.P=!!a}});
Object.defineProperty(z.prototype,"enabled",{get:function(){return this.m}});Object.defineProperty(z.prototype,"ready",{get:function(){return null!==this.playlist?this.playlist.ready:!1}});Object.defineProperty(z.prototype,"decoded",{get:function(){return null!==this.playlist?this.playlist.decoded:!1}});Object.defineProperty(z.prototype,"playing",{get:function(){return null!==this.playlist?this.playlist.playing:!1}});
Object.defineProperty(z.prototype,"paused",{get:function(){return null!==this.playlist?this.playlist.paused:!1}});Object.defineProperty(z.prototype,"volume",{get:function(){return this.J},set:function(a){if("number"===typeof a&&(a=g.Math.ca(a,0,1),this.J=this.B<a?this.B:a,!0===g.S.W(this.j,"Playlist")&&(a=g.S.get(this.j,"Playlist"),null!==a))){var b=a.track;null!==b&&(b.volume=a.volume*this.J)}}});Object.defineProperty(z.prototype,"onReady",{get:function(){this.L||(this.L=new q(this));return this.L}});
Object.defineProperty(z.prototype,"onPlay",{get:function(){this.I||(this.I=new q(this));return this.I}});Object.defineProperty(z.prototype,"onStop",{get:function(){this.H||(this.H=new q(this));return this.H}});Object.defineProperty(z.prototype,"onPause",{get:function(){this.G||(this.G=new q(this));return this.G}});Object.defineProperty(z.prototype,"onResume",{get:function(){this.C||(this.C=new q(this));return this.C}});
Object.defineProperty(z.prototype,"onEnded",{get:function(){this.D||(this.D=new q(this));return this.D}});function O(a,b){this.i=a;this.u=b;this.o=this.m=null;this.j="";this.f=!1;this.c=null;n.call(this,"PlaylistTrack");this.R=this.u.uid;aa(this);a=this.u;ba(this);this.R=a.uid;aa(this);this.m=new D(this.i,a.name);this.o=new D(this.i,a.author);this.j=a.url;this.f=a.loop||!1}O.prototype=Object.create(n.prototype);e=O.prototype;e.constructor=O;e.Nh=function(){z.prototype.ll.call(this.i.playlists)};
e.Ui=function(){z.prototype.nl.call(this.i.playlists)};e.Mh=function(){z.prototype.kl.call(this.i.playlists)};e.Ti=function(){z.prototype.ml.call(this.i.playlists)};e.Lh=function(){z.prototype.jl.call(this.i.playlists)};
e.play=function(){this.c||(this.c=new L(this.i,this.R+"-sound",this.j),this.c.volume=this.i.playlists.volume*this.i.playlists.playlist.volume,!0===this.f&&(this.c.loop=this.f),this.c.onPlay.add(this.Nh,this),this.c.onStop.add(this.Ui,this),this.c.onPause.add(this.Mh,this),this.c.onResume.add(this.Ti,this),this.c.onEnded.add(this.Lh,this));this.c.play()};e.stop=function(){this.c&&this.c.stop(!0)};e.pause=function(){this.c&&this.c.pause()};e.resume=function(){this.c&&this.c.resume()};
e.destroy=function(){this.u=this.i=null;this.m.destroy();this.m=null;this.o.destroy();this.o=null;this.c&&(this.c.onPlay.remove(this.Nh,this),this.c.onStop.remove(this.Ui,this),this.c.onPause.remove(this.Mh,this),this.c.onResume.remove(this.Ti,this),this.c.onEnded.remove(this.Lh,this),this.c.destroy(),this.c=null);n.prototype.destroy.call(this)};Object.defineProperty(O.prototype,"name",{get:function(){return this.m.value}});Object.defineProperty(O.prototype,"author",{get:function(){return this.o.value}});
Object.defineProperty(O.prototype,"currentTime",{get:function(){return this.c?this.c.currentTime:0},set:function(a){this.c&&(this.c.currentTime=a)}});Object.defineProperty(O.prototype,"volume",{get:function(){return this.c?this.c.volume:!1},set:function(a){if(!this.c)return!1;this.c.volume=a}});Object.defineProperty(O.prototype,"ready",{get:function(){return this.c?this.c.ready:!1}});Object.defineProperty(O.prototype,"decoded",{get:function(){return this.c?this.c.decoded:!1}});
Object.defineProperty(O.prototype,"playing",{get:function(){return this.c?this.c.playing:!1}});Object.defineProperty(O.prototype,"paused",{get:function(){return this.c?this.c.paused:!1}});Object.defineProperty(O.prototype,"loop",{get:function(){return this.f},set:function(a){this.f=!!a}});Object.defineProperty(O.prototype,"onPlay",{get:function(){if(this.c)return this.c.onPlay}});Object.defineProperty(O.prototype,"onStop",{get:function(){if(this.c)return this.c.onStop}});
Object.defineProperty(O.prototype,"onPause",{get:function(){if(this.c)return this.c.onPause}});Object.defineProperty(O.prototype,"onResume",{get:function(){if(this.c)return this.c.onResume}});Object.defineProperty(O.prototype,"onEnded",{get:function(){if(this.c)return this.c.onEnded}});function oa(a){this.i=a;this.j=this.c=null;this.O=this.$=this.T=!1;this.L=-1;this.M=this.o=null;n.call(this,"Director");this.Se()}oa.prototype=Object.create(n.prototype);e=oa.prototype;e.constructor=oa;
e.Se=function(){this.o=this.i.clock.create(!1);this.i.tour.onSceneLoadComplete.add(this.fj,this);this.i.onReady.add(this.th,this)};e.load=function(a){if(null!==a.tracks&&Array.isArray(a.tracks))for(var b=0,d=a.tracks.length;b<d;b++)new cc(a.tracks[b])};e.th=function(){this.i.controllers.onControlStart.add(this.od,this);this.i.controllers.onControlEnd.add(this.nd,this)};
e.fj=function(){var a=this.i.tour.scene;this.stop();Dc(this);this.c=null;this.j=[];"undefined"!==typeof a.config.director&&(a=a.config.director.animation,"undefined"!==typeof a&&null!==a&&!1!==a.enabled&&(this.T="boolean"===typeof a.loop?a.loop:!1,this.$="boolean"===typeof a.random?a.random:!1,this.O="boolean"===typeof a.stoppable?a.stoppable:!1,this.L="number"===typeof a.idleTime?a.idleTime:0,null!==a.tracks&&g.K.Pa(a.tracks,"string")&&(this.j=!0===this.$?g.K.Dd(a.tracks):a.tracks),this.i.renderer.camera.animation.onComplete.add(this.Vi,
this),"undefined"!==typeof this.i.tour.scene.config.media&&this.i.tour.scene.config.media.type===g.ub.VIDEO&&(this.i.renderer.media.displayObject.onPause.add(this.ge,this),this.i.renderer.media.displayObject.onWaiting.add(this.lc,this),this.i.renderer.media.displayObject.onStalled.add(this.lc,this),this.i.renderer.media.displayObject.onEnded.add(this.Li,this),this.i.renderer.media.displayObject.onCurrentTimeChange.add(this.jj,this),document.addEventListener(g.A.Sg,null)),"number"===typeof a.delay&&
(this.M=this.o.add(a.delay,this.Qf,this),this.o.start())))};e.ge=function(){this.stop();this.i.renderer.media.displayObject.onPause.remove(this.ge,this);this.i.renderer.media.displayObject.onPlay.add(this.Sf,this);this.i.controllers.onControlStart.remove(this.od,this);this.i.controllers.onControlEnd.remove(this.nd,this)};
e.Sf=function(){null!==this.c&&this.play(this.c);this.i.renderer.media.displayObject.onPause.add(this.ge,this);this.i.renderer.media.displayObject.onPlay.remove(this.Sf,this);this.i.controllers.onControlStart.add(this.od,this);this.i.controllers.onControlEnd.add(this.nd,this)};
e.lc=function(){this.stop();this.i.renderer.media.displayObject.onWaiting.remove(this.lc,this);this.i.renderer.media.displayObject.onStalled.remove(this.lc,this);this.i.renderer.media.displayObject.onPlaying.add(this.Tf,this);this.i.controllers.onControlStart.remove(this.od,this);this.i.controllers.onControlEnd.remove(this.nd,this)};
e.Tf=function(){null!==this.c&&this.play(this.c);this.i.renderer.media.displayObject.onPlaying.remove(this.Tf,this);this.i.renderer.media.displayObject.onWaiting.add(this.lc,this);this.i.renderer.media.displayObject.onStalled.add(this.lc,this);this.i.controllers.onControlStart.add(this.od,this);this.i.controllers.onControlEnd.add(this.nd,this)};e.Li=function(){!0===this.i.renderer.media.displayObject.loop&&this.fj()};e.od=function(){null!==this.c&&!0===this.O&&this.stop();this.o.stop(!0)};
e.nd=function(){this.M&&this.o.remove(this.M);null!==this.c&&!0===this.O&&(null===this.c&&"number"===typeof this.i.tour.scene.config.director.animation.delay?(this.M=this.o.add(this.i.tour.scene.config.director.animation.delay,this.Qf,this),this.o.start()):"number"===typeof this.L&&-1<this.L&&(this.M=this.o.add(this.L,this.Qf,this),this.o.start()))};
e.Vi=function(){if(1<this.j.length){var a=this.j.indexOf(this.c)+1;if(a<this.j.length){this.play(a);return}}!0===this.T&&(!0===this.$&&(this.j=g.K.Dd(this.j)),this.play(0))};e.Qf=function(){this.play(this.c);this.o.stop(!0)};
e.jj=function(a){this.stop();this.c=null;"number"===typeof a?a*=1E3:"number"===typeof a.data?a=1E3*a.data:a=this.i.renderer.media.displayObject.currentTimeMS;var b=0,d,h;h=g.S.get(this.j[0]);if(h.duration>a)this.c=h.uid;else for(var k=1,l=this.j.length-1;k<l;k++){d=h;h=g.S.get(this.j[k]);if(d.duration+b<a&&h.duration+d.duration+b>a){this.c=h.uid;break}b+=d.duration}null===this.c?(a=h.keyframes[h.keyframes.length-1].data,this.i.renderer.camera.uk(a.yaw,a.pitch,a.roll,a.fov)):this.i.renderer.camera.animation.play(this.c)};
e.play=function(a){this.stop();this.c=null;this.c="number"===typeof a?this.j[a]:"string"===typeof a?a:this.j[0];this.i.renderer.camera.animation.play(this.c)};e.stop=function(){this.i.renderer.camera.animation.stop()};
function Dc(a){a.i.renderer.camera.animation.onComplete.remove(a.Vi,a);"undefined"!==typeof a.i.tour.scene.config.media&&a.i.tour.scene.config.media.type===g.ub.VIDEO&&(a.i.renderer.media.displayObject.onPlay.remove(a.Sf,a),a.i.renderer.media.displayObject.onPause.remove(a.ge,a),a.i.renderer.media.displayObject.onWaiting.remove(a.lc,a),a.i.renderer.media.displayObject.onStalled.remove(a.lc,a),a.i.renderer.media.displayObject.onPlaying.remove(a.Tf,a),a.i.renderer.media.displayObject.onEnded.remove(a.Li,
a),a.i.renderer.media.displayObject.onCurrentTimeChange.remove(a.jj,a))}e.destroy=function(){Dc(this);this.i.onReady.remove(this.th,this);this.c=this.j=this.i=null;n.prototype.destroy.call(this)};function cc(a){this.G=this.o=!1;sb.call(this,"DirectorTrack");this.c(a)}cc.prototype=Object.create(sb.prototype);cc.prototype.constructor=cc;cc.prototype.c=function(a){this.o=a.smooth;this.G=a.cancelRoll;sb.prototype.c.call(this,a)};Object.defineProperty(cc.prototype,"smooth",{get:function(){return this.o}});
Object.defineProperty(cc.prototype,"cancelRoll",{get:function(){return this.G}});function Lb(a){this.i=a;this.f=[];n.call(this,"ActionEventDispatcher")}Lb.prototype=Object.create(n.prototype);Lb.prototype.constructor=Lb;Lb.prototype.c=function(a){if(!0===g.K.Pa(a,"string")||g.K.W(a,"string"))this.f=this.f.concat(a)};Lb.prototype.F=function(){for(var a=0,b=this.f.length;a<b;a++){var d=this.i.actions.get(this.f[a]);"undefined"!==typeof d&&null!==d&&d.Qb()}};
Lb.prototype.destroy=function(){this.i=null;n.prototype.destroy.call(this)};function Ec(a,b){this.i=a;this.j=b;this.ta="";this.c=this.f=null;n.call(this,"Action");a=this.j;this.R=a.uid;this.ta=a.target;this.f="undefined"!==typeof a.method?a.method:null;this.c="undefined"!==typeof a.property?a.property:null;aa(this)}Ec.prototype=Object.create(n.prototype);Ec.prototype.constructor=Ec;var Fc={Gf:"set",eh:"add",Ci:"substract",ri:"multiply",kh:"divide",Di:"toggle"};
function Gc(a,b){var d=null;if("undefined"===typeof b)d=window;else{var h=b,k=b;"object"===typeof b&&("string"===typeof b.identifier&&(h=b.identifier),"string"===typeof b.accessor&&(k=b.accessor));b=g.S.get(h);"undefined"!==typeof b&&null!==b&&(g.K.W(b,"Plugin")?d=b.instance:d=b);k=k.split(".");b=0;"viewer"===k[0].toLowerCase()&&(d=a.i,b=1);for(h=k.length;b<h;b++)"object"===typeof d[k[b]]&&(d=d[k[b]])}null===d&&a.warn("The target of the action "+a.R+" is invalid.");return d}
Ec.prototype.Qb=function(){var a=Gc(this,this.ta);if(null!==a){if(this.c){var b=this.c;if("undefined"!==typeof a[b.name])switch("undefined"===typeof b.operation&&(b.operation=Fc.Gf),b.operation){case Fc.Gf:a[b.name]=b.value;break;case Fc.eh:a[b.name]+=b.value;break;case Fc.Ci:a[b.name]-=b.value;break;case Fc.ri:a[b.name]*=b.value;break;case Fc.kh:a[b.name]/=b.value;break;case Fc.Di:a[b.name]=!a[b.name]}}if(this.f&&(b=this.f,"function"===typeof a[b.name])){var d="undefined"!==typeof b.args?b.args:
null;Array.isArray(d)||(d=[d]);a[b.name].apply(a,d)}}};Ec.prototype.destroy=function(){this.i=null;n.prototype.destroy.call(this)};Object.defineProperty(Ec.prototype,"target",{get:function(){return Gc(this,this.ta)}});Object.defineProperty(Ec.prototype,"count",{get:function(){return 0}});function na(a){this.i=a;this.c=[];n.call(this,"ActionManager")}na.prototype=Object.create(n.prototype);na.prototype.constructor=na;na.prototype.get=function(a){return g.S.get(a,"Action")};
na.prototype.ma=function(a){var b;if(!0===Array.isArray(a))for(var d=0,h=a.length;d<h;d++)b=new Ec(this.i,a[d]),this.c.push(b);else b=new Ec(this.i,a),this.c.push(b)};na.prototype.destroy=function(){if(g.K.Pa(this.c,"Action"))for(;0<this.c.length;)this.c.pop().destroy()};
function P(a,b,d,h){this.i=a;this.G=b;this.I=d;this.B=this.M=null;this.$=h;this.c=this.j=this.J=this.L=null;this.U=!1;this.C=this.H=this.D=this.f=this.m=null;this.P=this.Z=!0;this.u=this.o=null;n.call(this,"Plugin");this.R=this.I.uid;this.jb=this.I.tags;aa(this);this.C={}}P.prototype=Object.create(n.prototype);e=P.prototype;e.constructor=P;
function Hc(a){a.B=g.K.pb(a.G.defaultConfig,a.I,a.M);a.L=a.B.options;a.xb=a.B.data;a.J=a.B.actions;for(var b in a.j)a.j[b].destroy(),a.j[b]=null;b=a.B.events;a.j={};var d,h;for(h in b)d=new Lb(a.i),d.c(b[h]),a.j[h]=d}e.mk=function(){!0===this.G.loaded?Ic(this):this.G.onLoadComplete.ga(this.wm,this)};e.wm=function(){Ic(this)};
function Ic(a){a.log("Plugin._instantiatePlugin(); "+a.R);var b=a.I;"string"===typeof b.parent&&(a.m=b.parent);a.Z="boolean"===typeof b.keep?b.keep:!0;a.P="boolean"===typeof b.reset?b.reset:!0;a.H||!0!==g.K.Pa(b.scenes,"string")||(a.H=b.scenes);Hc(a);a.c=a.G.Uj(a);a.c.boot.call(a.c);a.o&&a.o.F()}e.lo=function(){this.U=!0;this.u&&this.u.F()};e.update=function(){this.c&&"function"===typeof this.c.update&&this.c.update.call(this.c)};
e.Ek=function(){Hc(this);this.c&&("function"===typeof this.c.reset?this.c.reset.call(this.c):this.warn("There is no reset function on plugin "+this.G.uid))};
e.destroy=function(){if(!1!==this.yb){this.c&&(this.c.viewer=null,this.c.plugin=null,this.c.destroy(),this.c=null);this.D&&(this.D.destroy(),this.D=null);this.f&&(this.f.destroy(),this.f=null);this.o&&(this.o.destroy(),this.o=null);this.u&&(this.u.destroy(),this.u=null);for(var a=this.j.length;a--;)this.j[a].destroy();this.C=this.i=this.j=null;n.prototype.destroy.call(this)}};Object.defineProperty(P.prototype,"fullUrl",{get:function(){return this.G.fullUrl}});
Object.defineProperty(P.prototype,"options",{get:function(){return this.L}});Object.defineProperty(P.prototype,"actions",{get:function(){return this.J}});Object.defineProperty(P.prototype,"events",{get:function(){return this.j}});Object.defineProperty(P.prototype,"scenes",{get:function(){return this.H}});Object.defineProperty(P.prototype,"persistentData",{get:function(){return this.C},set:function(a){this.C=a}});Object.defineProperty(P.prototype,"instance",{get:function(){return this.c}});
Object.defineProperty(P.prototype,"instanceReady",{get:function(){return this.U}});Object.defineProperty(P.prototype,"container",{get:function(){if(!this.f){if("string"===typeof this.m&&""!==this.m){this.m=document.getElementById(this.m);if("undefined"===typeof this.m||!this.m||!1===g.ka.sg(this.m))throw"FORGE.Plugin.boot : Plugin parent is invalid";this.f=new v(this.i,null,null,this.m)}else this.f=new v(this.i),this.i.pluginContainer.mc(this.f),this.f.Sb(!0);this.f.id=this.R;this.f.index=this.$}return this.f}});
Object.defineProperty(P.prototype,"create",{get:function(){this.D||(this.D=new Q(this.i,this));return this.D}});Object.defineProperty(P.prototype,"keep",{get:function(){return this.Z}});Object.defineProperty(P.prototype,"reset",{get:function(){return this.P}});Object.defineProperty(P.prototype,"contextualConfig",{get:function(){return this.M},set:function(a){this.M=a}});Object.defineProperty(P.prototype,"instanceConfig",{get:function(){return this.I}});Object.defineProperty(P.prototype,"config",{get:function(){return this.B}});
Object.defineProperty(P.prototype,"onInstanceCreate",{get:function(){this.o||(this.o=new q(this,!0));return this.o}});Object.defineProperty(P.prototype,"onInstanceReady",{get:function(){this.u||(this.u=new q(this,!0));return this.u}});function Jc(a){n.call(this,"PluginEngine");this.i=a;this.D=null;this.o=this.P=this.j=this.L="";this.M=null;this.u="";this.B=null;this.H="";this.m=this.G=this.C=this.I=this.f=null;this.U=0;this.J=!1;this.c=null}Jc.prototype=Object.create(n.prototype);
Jc.prototype.constructor=Jc;var Kc=["boot","destroy"],Lc=["viewer","plugin"];e=Jc.prototype;
e.load=function(a){if("undefined"!==typeof a){a=this.D=a;if("undefined"===typeof a.uid)throw"Can't load a plugin engine, missing id in config";this.R=a.uid;aa(this);this.L="string"===typeof a.prefix?a.prefix:this.i.plugins.prefix;if("undefined"===typeof a.url)throw"Can't load a plugin engine, missing url in config";this.j=a.url;this.o=this.L+this.j;this.P="string"===typeof a.manifest?a.manifest:"manifest.json";this.i.load.json(this.R,this.o+this.P,this.Hm,this);return!0}return!1};
e.Uj=function(a){for(var b=new this.f,d=0,h=Lc.length;d<h;d++)if("undefined"!==typeof b[Lc[d]])throw"FORGE.PluginEngine instance validation failed, "+Lc[d]+" is reserved";if(this.m)for(d=0,h=this.m.length;d<h;d++)if("function"!==typeof b[this.m[d]])throw"FORGE.PluginEngine instance validation failed, action "+this.m[d]+" is undefined on plugin "+this.H;b.i=this.i;b.kc=a;return b};
e.Hm=function(a){a=this.M=this.i.cache.get(C.JSON,a.key).data;if(this.R!==a.uid)throw"Plugin Engine UID doesn't match with manifest UID";var b=a.viewer,d="0.0.0",h="9.9.9";"undefined"!==typeof b&&("undefined"!==typeof b.min&&(d=b.min),"undefined"!==typeof b.max&&(h=b.max));for(var b=g.VERSION.split("."),d=d.split("."),h=h.split("."),k=0,l=0,p=0,r=Math.max(b.length,d.length,h.length)-1;0<=r;r--)"undefined"!==typeof b[r]&&(k=parseInt(b[r],10)),"undefined"!==typeof d[r]&&(l=parseInt(d[r],10)),"undefined"!==
typeof h[r]&&(p=parseInt(h[r],10));if(!1===(k<l||k>p?!1:!0))this.warn("Version compatibility check for plugin "+a.uid+" failed!"),this.warn(a.viewer);else{var u;a:{b=a.device;if("undefined"!==typeof b)for(u in b)if("undefined"===typeof g.A[u])this.warn("Unable to check plugin device compatibility for: "+u);else if(g.A[u]!==b[u]){u=!1;break a}u=!0}if(!1===u)this.warn("Device compatibility check for plugin "+a.uid+" failed!"),this.warn(a.device);else{"undefined"!==typeof a.options&&(this.C=a.options);
"undefined"!==typeof a.data&&(this.xb=a.data);"undefined"!==typeof a.actions&&(this.m=a.actions);"undefined"!==typeof a.events&&(this.G=a.events);this.u=a.name;this.B=a.sources;this.H=a.constructor;u=null;if("undefined"!==typeof a.i18n&&(u=a.i18n,"undefined"!==typeof u.locales))for(b=0,d=u.locales.length;b<d;b++)if(a=u.locales[b],"undefined"!==typeof a.files)for(k=0,l=a.files.length;k<l;k++)h=a.files[k],h.key=this.R+"-"+h.key,h.url=this.o+h.url;this.I=u;a=this.B;u=0;for(b=a.length;u<b;u++)d="http://"===
String(a[u]).substring(0,7)||"https://"===String(a[u]).substring(0,8)?a[u]:this.o+a[u],"css"===ya(d).extension?this.i.load.Bj(d,this.Pi,this):this.i.load.Lg(d,this.Pi,this)}}this.log("FORGE.Plugin._manifestLoadComplete();")};
e.Pi=function(){this.U++;if(this.U===this.B.length){var a;a:{a=this.H;if("string"===typeof a&&""!==a){a=a.split(".");for(var b=window,d=0,h=a.length;d<h;d++){if(d===a.length-1&&"function"===typeof b[a[d]]){a=b[a[d]];break a}if("object"===typeof b[a[d]])b=b[a[d]];else break}}a=null}this.f=a;!0===Mc(this)&&((a=this.I)&&this.i.i18n.ma(a),this.J=!0,this.c&&this.c.F())}};
function Mc(a){if(!a.f||"function"!==typeof a.f)throw"Plugin engine "+a.R+" can't find it's constructor";for(var b=0,d=Kc.length;b<d;b++)if("function"!==typeof a.f.prototype[Kc[b]])throw"FORGE.PluginEngine engine validation failed, missing required method "+Kc[b]+" on plugin engine "+a.u;Object.defineProperty(a.f.prototype,"viewer",{get:function(){return this.i}});Object.defineProperty(a.f.prototype,"plugin",{get:function(){return this.kc}});return!0}
e.destroy=function(){this.I=this.f=this.B=this.u=this.M=this.D=this.i=null;this.c&&(this.c.destroy(),this.c=null);n.prototype.destroy.call(this)};Object.defineProperty(Jc.prototype,"name",{get:function(){return this.u}});Object.defineProperty(Jc.prototype,"loaded",{get:function(){return this.J}});Object.defineProperty(Jc.prototype,"url",{get:function(){return this.j}});Object.defineProperty(Jc.prototype,"fullUrl",{get:function(){return this.o}});Object.defineProperty(Jc.prototype,"options",{get:function(){return this.C}});
Object.defineProperty(Jc.prototype,"actions",{get:function(){return this.m}});Object.defineProperty(Jc.prototype,"events",{get:function(){return this.G}});Object.defineProperty(Jc.prototype,"defaultConfig",{get:function(){return{data:this.xb,options:this.C,actions:this.m,events:this.G}}});Object.defineProperty(Jc.prototype,"onLoadComplete",{get:function(){this.c||(this.c=new q(this));return this.c}});
function B(a){n.call(this,"PluginManager");this.i=a;this.m=!0;this.u="";this.f=this.c=this.j=null}B.prototype=Object.create(n.prototype);e=B.prototype;e.constructor=B;
e.vl=function(a){a=a.data.uid;for(var b,d=this.c.size;d--;)b=this.c.get(d),(!1===b.keep||null!==b.scenes&&-1===b.scenes.indexOf(a))&&this.remove(b.uid);!0===this.m&&"undefined"!==typeof this.o&&(a=this.o,Nc(this,a.engines),Oc(this,a.instances),Pc(this,a.configurations));!0===this.m&&"undefined"!==typeof this.i.tour.scene.config.plugins&&(a=this.i.tour.scene.config.plugins,Nc(this,a.engines),Oc(this,a.instances),Pc(this,a.configurations));for(b=this.c.size;b--;)a=this.c.get(b),!0===a.reset&&a.Ek()};
function Nc(a,b){if("undefined"!==typeof b)for(var d=0,h=b.length;d<h;d++){var k=b[d];if("string"===typeof k.uid&&!1===g.S.hb(k.uid)){var l=new Jc(a.i);a.j.add(l);l.load(k)}}}
function Oc(a,b){if("undefined"!==typeof b)for(var d=0,h=b.length;d<h;d++){var k=!1!==b[d].enabled?!0:!1,l=a.ne(b[d].uid),p=a.i.tour.sceneUid,r=g.K.Pa(b[d].scenes,"string")?b[d].scenes:[],p=0===r.length||""===p&&0===r.length||-1!==r.indexOf(p);if(!0===k&&!l&&!0===p){k=a;l=b[d];if("undefined"===typeof l.engine)throw"Can't create plugin instance, engineUid is undefined";a:{for(var p=k,r=l.engine,u,A=0,ob=p.j.size;A<ob;A++)if(u=p.j.get(A),u.uid===r){p=u;break a}p=null}if(!p)throw"Plugin Engine "+l.engine+
" doesn't exist";l=new P(k.i,p,l,"number"===typeof l.index?l.index:k.c.size);l.onInstanceCreate.ga(k.Qm,k);k.c.add(l);l.mk()}}}function Pc(a,b){if("undefined"!==typeof b)for(var d=0,h=b.length;d<h;d++){var k=!1!==b[d].enabled?!0:!1,l=a.ne(b[d].instance),p=null;!0===k&&(p=b[d]);l&&(l.contextualConfig=p)}}e.Qm=function(a){a=a.emitter;this.f&&this.f.F(a)};e.boot=function(){this.j=new Qc;this.c=new Qc;this.i.tour.onSceneLoadStart.add(this.vl,this)};
e.ma=function(a){this.o=a;this.m="boolean"===typeof a.enabled?a.enabled:!0;this.u="string"===typeof a.prefix?a.prefix:"./plugins/"};e.ne=function(a){for(var b,d=0,h=this.c.size;d<h;d++)if(b=this.c.get(d),b.uid===a)return b;return null};e.Sj=function(a){a=this.c.get(a);return"undefined"!==typeof a?a:null};e.get=function(a){var b=null;"string"===typeof a?b=this.ne(a):"number"===typeof a&&(b=this.Sj(a));return b};e.remove=function(a){a=this.get(a);a.destroy();this.c.remove(a)};
e.update=function(){for(var a,b=0,d=this.c.size;b<d;b++)a=this.c.get(b),a.update()};e.render=function(){};e.destroy=function(){this.i=null;this.f&&(this.f.destroy(),this.f=null);for(var a=0,b=this.j.size;a<b;a++)this.j.get(a).destroy();this.j=null;a=0;for(b=this.c.size;a<b;a++)this.c.get(a).destroy();this.c=null;n.prototype.destroy.call(this)};Object.defineProperty(B.prototype,"all",{get:function(){return this.c}});Object.defineProperty(B.prototype,"enabled",{get:function(){return this.m}});
Object.defineProperty(B.prototype,"prefix",{get:function(){return this.u}});Object.defineProperty(B.prototype,"onInstanceCreate",{get:function(){this.f||(this.f=new q(this,!0));return this.f}});function Q(a,b){this.i=a;this.kc=b;this.ba=[];n.call(this,"PluginObjectFactory")}Q.prototype=Object.create(n.prototype);e=Q.prototype;e.constructor=Q;e.Ab=function(a){a:{for(var b=this.ba.length,d;b--;)if(d=this.ba[b],d===a.emitter){a=b;break a}a=-1}this.ba.splice(a,1)};
e.vo=function(a){a=new D(this.i,a);a.onDestroy.ga(this.Ab,this);this.ba.push(a);return a};e.wo=function(a){a=new S(this.i,a);a.onDestroy.ga(this.Ab,this);this.ba.push(a);return a};e.sound=function(a,b){a=new L(this.i,a,b);a.onDestroy.ga(this.Ab,this);this.ba.push(a);return a};e.Kn=function(a){a=new v(this.i,a);a.onDestroy.ga(this.Ab,this);this.ba.push(a);return a};e.xl=function(a){a=new T(this.i,a);a.onDestroy.ga(this.Ab,this);this.ba.push(a);return a};
e.image=function(a,b){var d=a;"string"===typeof a&&(d={key:null,url:a});d.key=this.kc.uid+"-"+d.key;!1!==b&&(d.url=this.kc.fullUrl+d.url);a=new H(this.i,d);a.onDestroy.ga(this.Ab,this);this.ba.push(a);return a};e.so=function(a,b){a.key=this.kc.uid+"-"+a.key;!1!==b&&(a.url=this.kc.fullUrl+a.url,a.frames=this.kc.fullUrl+a.frames);a=new Rc(this.i,a);a.onDestroy.ga(this.Ab,this);this.ba.push(a);return a};e.wl=function(a){a=new Sc(this.i,a);a.onDestroy.ga(this.Ab,this);this.ba.push(a);return a};
e.zl=function(a,b,d,h,k){var l;"undefined"!==typeof d&&d.toLowerCase()===g.nb.Pe?l=new I(this.i,a,b,h):l=new J(this.i,a,b,h,k);l.onDestroy.ga(this.Ab,this);this.ba.push(l);return l};e.canvas=function(){var a=new fa(this.i);a.onDestroy.ga(this.Ab,this);this.ba.push(a);return a};e.yl=function(a){a=new lb(this.i,a);a.onDestroy.ga(this.Ab,this);this.i.tween.add(a);this.ba.push(a);return a};e.Fj=function(){this.log("destroyAllObjects();");for(var a=this.ba.length;a--;)this.ba[a].destroy()};
e.destroy=function(){this.Fj();this.ba=this.kc=this.i=null;n.prototype.destroy.call(this)};
g.A=function(a){a=a();a.prototype=Object.create(null);a.prototype.constructor=a;a.prototype.om=function(){if(/Playstation Vita/.test(this.ea))this.rb="Playstation Vita",this.Tg=!0;else if(/Xbox/.test(this.ea))this.rb="Xbox",this.dh=!0;else if(/Kindle/.test(this.ea)||/\bKF[A-Z][A-Z]+/.test(this.ea)||/Silk.*Mobile Safari/.test(this.ea))this.rb="Kindle",this.vg=!0;else if(/Windows Phone/i.test(this.ea)||/IEMobile/i.test(this.ea))this.rb="Windows Phone",this.Me=!0,/Windows Phone (\d+)/.test(this.ea)&&
(this.oc=parseInt(RegExp.$1,10));else if(/Android/.test(this.ea))this.rb="Android",this.tj=!0,/Android ([\.\_\d]+)/.test(this.ea)&&(this.oc=parseInt(RegExp.$1,10));else if(/CrOS/.test(this.ea))this.rb="Chrome OS",this.ag=!0;else if(/iP[ao]d|iPhone/i.test(this.ea))this.rb="iOS",this.Xc=!0,/OS (\d+)/.test(navigator.appVersion)&&(this.oc=parseInt(RegExp.$1,10));else if(/(Linux|X11)/.test(this.ea))this.rb="Linux",this.wg=!0;else if(/Mac OS X/.test(this.ea))this.rb="Mac OS X",this.zg=!0,/Mac OS X (10[\.\_\d]+)/.test(this.ea)&&
(this.oc=parseInt(RegExp.$1,10));else if(/Windows/.test(this.ea)||/WPDesktop/i.test(this.ea))/WPDesktop/i.test(this.ea)?(this.rb="Windows Phone",this.Me=!0):(this.rb="Windows",this.bh=!0),/(Windows 10.0|Windows NT 10.0)/.test(this.ea)?this.oc=10:/(Windows 8.1|Windows NT 6.3)/.test(this.ea)||/(Windows 8|Windows NT 6.2)/.test(this.ea)?this.oc=8:/(Windows 7|Windows NT 6.1)/.test(this.ea)&&(this.oc=7)};a.prototype.fm=function(){this.yd="undefined"!==typeof document.documentMode;this.ke=!1===this.yd&&
!0===!!window.StyleMedia;this.ig="undefined"!==typeof window.InstallTrigger;this.opera=!0===!!window.opr||0<=this.ea.indexOf(" OPR/")||0<=this.ea.indexOf("Opera");this.Ig=0<Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor");this.chrome=!1===this.yd&&!1===this.ke&&!1===this.opera&&(!0===!!window.chrome||0<=this.ea.indexOf("CriOS"));if(this.ke)this.Bb="Edge",/Edge\/(\d+)/.test(this.ea)&&(this.ob=this.Hj=parseInt(RegExp.$1,10));else if(this.chrome)this.Bb="Chrome",/CriOS\/(\d+)/.test(this.ea)?
this.ob=this.bg=parseInt(RegExp.$1,10):/Chrome\/(\d+)/.test(this.ea)&&(this.ob=this.bg=parseInt(RegExp.$1,10));else if(this.ig)this.Bb="Firefox",/Firefox\D+(\d+)/.test(this.ea)&&(this.ob=this.Lj=parseInt(RegExp.$1,10));else if(this.vg)/Silk/.test(this.ea)&&(this.Bb="Silk",this.Ng=!0);else if(this.yd)this.Bb="Internet Explorer",/MSIE (\d+\.\d+);/.test(this.ea)?this.ob=this.rg=parseInt(RegExp.$1,10):/Trident\/(\d+\.\d+)(.*)rv:(\d+\.\d+)/.test(this.ea)&&(this.ob=this.rg=parseInt(RegExp.$3,10));else if(this.opera)this.Bb=
"Opera",/OPR\/(\d+)/.test(this.ea)?this.ob=this.Ce=parseInt(RegExp.$1,10):0<=this.ea.indexOf("Opera/")?/Version\/(\d+)/.test(this.ea)&&(this.ob=this.Ce=parseInt(RegExp.$1,10)):/Opera (\d+)/.test(this.ea)&&(this.ob=this.Ce=parseInt(RegExp.$1,10));else if(this.Ig)this.Bb="Safari",/version\/(\d+(\.\d+)?)/i.test(this.ea)&&(this.ob=this.Gk=parseInt(RegExp.$1,10));else{var a=this.ea.match(/Android.*AppleWebKit\/([\d.]+)/);a&&537>a[1]&&(this.Bb="Android Stock",this.pk=!0,this.ob=this.uj=parseFloat(this.ea.slice(this.ea.indexOf("Android")+
8)))}navigator.o&&(this.Sk=!0);this.Dk="CSS1Compat"===document.compatMode?!1:!0};a.prototype.hm=function(){this.Fc=window.devicePixelRatio||1;this.kk=!0===this.Xc&&-1!==this.ea.toLowerCase().indexOf("iphone");this.lk=!0===this.Xc&&-1!==this.ea.toLowerCase().indexOf("ipod");this.qg=!0===this.Xc&&-1!==this.ea.toLowerCase().indexOf("ipad");this.Fk=2<=this.Fc&&!0===this.Xc;this.bh&&!this.Me||this.zg||this.wg&&!this.Ng||this.ag?this.Vc=!0:/Mobi/i.test(this.ea)&&!1===this.qg?this.ze=!0:this.Pg=!0;if(/TV/i.test(this.ea)||
!0===this.Tg||!0===this.dh||this.Vc&&/Windows NT/i.test(this.ea)&&/Touch/i.test(this.ea))this.zk=!0,this.Vc=this.Pg=this.ze=!1};a.prototype.qm=function(){var a=document.createElement("video");try{"function"===typeof a.canPlayType&&(a.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,"")&&(this.Eg=!0),a.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,"")&&(this.Cg=this.mg=!0),a.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,"")&&(this.ah=!0),a.canPlayType('video/webm; codecs="vp9"').replace(/^no$/,
"")&&(this.Ug=!0),a.canPlayType('application/x-mpegURL; codecs="avc1.42E01E"').replace(/^no$/,"")&&(this.pg=!0))}catch(d){}};a.prototype.dm=function(){this.Xf="undefined"!==typeof window.Audio;this.Wg="undefined"!==typeof window.AudioContext||"undefined"!==typeof window.webkitAudioContext;var a=document.createElement("audio");try{if("function"===typeof a.canPlayType){a.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.Dg=!0);a.canPlayType("audio/mpeg;").replace(/^no$/,"")&&(this.Ag=
!0);if(a.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,"")||a.canPlayType("audio/opus;").replace(/^no$/,""))this.De=!0;a.canPlayType('audio/wav; codecs="1"').replace(/^no$/,"")&&(this.Vg=!0);a.canPlayType("audio/aac;").replace(/^no$/,"")&&(this.Vf=!0);if(a.canPlayType("audio/x-m4a;")||a.canPlayType("audio/m4a;")||a.canPlayType("audio/aac;").replace(/^no$/,""))this.yg=!0;if(a.canPlayType("audio/x-mp4;")||a.canPlayType("audio/mp4;")||a.canPlayType("audio/aac;").replace(/^no$/,""))this.Bg=!0;
a.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")&&(this.Zg=this.$g=!0)}}catch(d){}};a.prototype.im=function(){this.Rg="undefined"!==typeof navigator.Rg||"undefined"!==typeof navigator.D||"undefined"!==typeof navigator.R||"undefined"!==typeof navigator.j;this.$f="function"===typeof navigator.getBattery};a.prototype.km=function(){this.canvas="undefined"!==typeof window.CanvasRenderingContext2D;if(!0===this.canvas){this.yj="function"===typeof document.createElement("canvas").getContext("2d").fillText;
var a=document.createElement("canvas").getContext("2d");a.rect(0,0,10,10);a.rect(2,2,6,6);this.zj=!1===a.isPointInPath(5,5,"evenodd")}try{this.localStorage="object"===typeof window.localStorage&&"function"===typeof window.localStorage.getItem}catch(h){this.localStorage=!1}this.wk="function"===typeof window.MediaSource;this.Ij="function"===typeof window.HTMLMediaElement&&"function"===typeof window.R&&"function"===typeof window.f&&"function"===typeof navigator.m;this.applicationCache="object"===typeof window.applicationCache;
this.addEventListener="function"===typeof window.addEventListener;this.raf="function"===typeof window.requestAnimationFrame||"function"===typeof window.webkitRequestAnimationFrame||"function"===typeof window.mozRequestAnimationFrame;try{var d=document.createElement("canvas");d.f=!1;this.Xg="function"===typeof d.getContext&&"undefined"!==typeof window.WebGLRenderingContext&&!(!d.getContext("webgl")&&!d.getContext("experimental-webgl"))}catch(h){this.Xg=!1}this.Yg="function"===typeof navigator.getVRDisplays?
!0:!1;this.JSON="object"===typeof window.JSON&&"function"===typeof window.JSON.parse&&"function"===typeof window.JSON.stringify;this.geolocation="object"===typeof navigator.geolocation;this.history="object"===typeof window.history&&"function"===typeof window.history.pushState;this.Kk="function"===typeof document.createElementNS&&"function"===typeof document.createElementNS("http://www.w3.org/2000/svg","svg").c;this.contextMenu="undefined"!==typeof document.documentElement.contextMenu&&"function"===
typeof window.HTMLMenuItemElement};a.prototype.jm=function(){this.rk=/^https/i.test(window.location.protocol);try{this.tg=window.self!==window.top}catch(b){this.tg=!0}};a.prototype.nm=function(){this.Mk="undefined"!==typeof window.ontouchstart||"undefined"!==typeof window.c&&document instanceof window.c||"number"===typeof navigator.c&&0<navigator.c||"number"===typeof navigator.msMaxTouchPoints&&0<navigator.msMaxTouchPoints;if("undefined"!==typeof window.j||"undefined"!==typeof window.m)this.Nk=!(!MouseEvent.f||
!MouseEvent.c);this.Rj="function"===typeof navigator.f||"function"===typeof navigator.B};a.prototype.lm=function(){for(var a="requestFullscreen requestFullScreen webkitRequestFullscreen webkitRequestFullScreen mozRequestFullScreen mozRequestFullscreen msRequestFullscreen msRequestFullScreen".split(" "),d="cancelFullscreen cancelFullScreen exitFullscreen exitFullScreen webkitCancelFullscreen webkitCancelFullScreen webkitExitFullscreen webkitExitFullScreen mozCancelFullscreen mozCancelFullScreen mozExitFullscreen mozExitFullScreen msCancelFullscreen msCancelFullScreen msExitFullscreen msExitFullScreen".split(" "),
h=document.createElement("div"),k=0,l=a.length;k<l;k++)if(h[a[k]]){this.requestFullscreen=a[k];break}a=0;for(h=d.length;a<h;a++)if(document[d[a]]){this.exitFullscreen=d[a];break}"function"===typeof window.Element&&Element.ALLOW_KEYBOARD_INPUT&&(this.Pj=!0);d=["fullscreenElement","mozFullScreenElement","webkitFullscreenElement","msFullscreenElement"];a=0;for(h=d.length;a<h;a++)if("undefined"!==typeof document[d[a]]){this.fullscreenElement=d[a];break}d=["fullscreenEnabled","mozFullScreenEnabled","webkitFullscreenEnabled",
"msFullscreenEnabled"];a=0;for(h=d.length;a<h;a++)if("undefined"!==typeof document[d[a]]){this.fullscreenEnabled=d[a];break}};a.prototype.em=function(){for(var a=["visibilitychange","mozvisibilitychange","webkitvisibilitychange","msvisibilitychange"],d=["hidden","mozHidden","webkitHidden","msHidden"],h=0,k=d.length;h<k;h++)if("undefined"!==typeof document[d[h]]){this.visibilityState=d[h];this.Sg=a[h];break}a=["orientation","mozOrientation","msOrientation"];d=0;for(h=a.length;d<h;d++)if("string"===
typeof screen[a[d]]){this.orientation=a[d];break}this.Hk="object"===typeof screen.orientation&&"string"===typeof screen.orientation.type&&"function"===typeof screen.orientation.lock;a=["lockOrientation","mozLockOrientation","msLockOrientation"];d=["unlockOrientation","mozUnlockOrientation","msUnlockOrientation"];h=0;for(k=a.length;h<k;h++)if("function"===typeof screen[a[h]]){this.tk=a[h];this.Ok=d[h];break}this.file="undefined"!==typeof window.File&&"undefined"!==typeof window.FileReader&&"undefined"!==
typeof window.FileList&&"undefined"!==typeof window.Blob;this.Kj="undefined"!==typeof window.requestFileSystem||"undefined"!==typeof window.webkitRequestFileSystem;this.Ck="undefined"!==typeof document.f||"undefined"!==typeof document.c||"undefined"!==typeof document.R};a.prototype.gm=function(){var a=document.createElement("a").style;a.cssText="pointer-events:auto";this.td="auto"===a.pointerEvents;a.cssText="background-color:rgba(150,255,150,.5)";this.Ej=-1<(""+a.backgroundColor).indexOf("rgba");
this.Dj="undefined"!==typeof a.animationName||"undefined"!==typeof a.webkitAnimationName||"undefined"!==typeof a.m||"undefined"!==typeof a.o;var a=document.createElement("p"),d,h={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"};document.body.insertBefore(a,null);for(var k in h)"undefined"!==typeof a.style[k]&&(a.style[k]="translate3d(1px,1px,1px)",d=window.getComputedStyle(a).getPropertyValue(h[k]));document.body.removeChild(a);
this.Cj="undefined"!==typeof d&&0<d.length&&"none"!==d};a.prototype.um=function(a){null!==a.rotationRate&&"undefined"!==typeof a.rotationRate.alpha&&"undefined"!==typeof a.rotationRate.beta&&"undefined"!==typeof a.rotationRate.gamma&&(this.eg=!0);"undefined"!==typeof a.acceleration&&"undefined"!==typeof a.acceleration.x&&"undefined"!==typeof a.acceleration.y&&"undefined"!==typeof a.acceleration.z&&(this.dg=!0);this.Zi();"function"!==typeof this.Tc&&this.Mf()};a.prototype.vm=function(a){"undefined"!==
typeof a.alpha&&"undefined"!==typeof a.beta&&"undefined"!==typeof a.gamma&&(this.gg=!0);this.$i();"function"!==typeof this.Sc&&this.Mf()};a.prototype.Zi=function(){window.removeEventListener("devicemotion",this.Sc,!1);this.Sc=null};a.prototype.$i=function(){window.removeEventListener("deviceorientation",this.Tc,!1);this.Tc=null};a.prototype.mm=function(){this.cg="undefined"!==typeof window.DeviceMotionEvent;this.fg="undefined"!==typeof window.DeviceOrientationEvent;window.addEventListener("deviceorientation",
this.Tc,!1);window.addEventListener("devicemotion",this.Sc,!1)};a.prototype.pm=function(){var a=document.createElement("div");a.style.width="1in";a.style.height="1in";document.body.appendChild(a);this.Gj=a.offsetWidth;document.body.removeChild(a);this.ze?(this.Kg=Math.floor(Math.min(window.screen.width,window.screen.height)*this.Fc),this.Jg=Math.floor(Math.max(window.screen.width,window.screen.height)*this.Fc)):(this.Kg=Math.floor(Math.max(window.screen.width,window.screen.height)*this.Fc),this.Jg=
Math.floor(Math.min(window.screen.width,window.screen.height)*this.Fc))};a.prototype.cm=function(){this.ea=navigator.userAgent;this.language=navigator.languages&&navigator.languages[0]||navigator.language||navigator.u||"";this.om();this.fm();this.hm();this.dm();this.qm();this.im();this.km();this.jm();this.em();this.lm();this.nm();this.gm();this.Sc=this.um.bind(this);this.Tc=this.vm.bind(this);this.mm();this.pm();!1===this.cg&&!1===this.fg&&this.Mf()};a.prototype.Mf=function(){"function"===typeof this.Sc&&
this.Zi();"function"===typeof this.Tc&&this.$i();!0===this.eg&&!0===this.dg&&!0===this.gg&&(this.dk=!0);this.ready=!0;Object.freeze(g.A)};a.prototype.Hn=function(a){return"mp3"===a&&!0===this.Ag||"ogg"===a&&(!0===this.Dg||!0===this.De)||"m4a"===a&&!0===this.yg||"mp4"===a&&!0===this.Bg||"opus"===a&&!0===this.De||"wav"===a&&!0===this.Vg||"aac"===a&&!0===this.Vf||"webm"===a&&!0===this.$g||"weba"===a&&!0===this.Zg?!0:!1};a.prototype.In=function(a){if("webm"!==a||!0!==this.ah&&!0!==this.Ug)if("mp4"!==
a||!0!==this.Cg&&!0!==this.mg){if(("ogg"===a||"ogv"===a)&&!0===this.Eg||"mpeg"===a&&!0===this.pg)return!0}else return!0;else return!0;return!1};a.prototype.fo=function(){return navigator.getBattery().then(function(a){return this.$f&&!a.charging&&.2>=a.level}.bind(this),function(){return!1})};return new a}(function(){return function(){this.ready=!1;this.rb=this.language=this.ea="";this.oc=0;this.ig=this.Me=this.bh=this.zg=this.wg=this.Xc=this.ag=this.tj=this.vg=this.dh=this.Tg=!1;this.Lj=0;this.chrome=
!1;this.bg=0;this.yd=!1;this.rg=0;this.opera=!1;this.Ce=0;this.ke=!1;this.Hj=0;this.Ig=!1;this.Gk=0;this.Ng=!1;this.Bb="";this.ob=0;this.pk=this.Sk=!1;this.uj=0;this.Dk=!1;this.fullscreenElement=this.exitFullscreen=this.requestFullscreen=this.fullscreenEnabled="";this.qg=this.lk=this.Fk=this.kk=this.Pj=!1;this.Fc=1;this.tg=this.rk=this.Kk=this.history=this.JSON=this.Ij=this.wk=this.contextMenu=this.Ck=this.geolocation=this.applicationCache=this.localStorage=this.Kj=this.file=this.Yg=this.Xg=this.raf=
this.addEventListener=this.yj=this.zj=this.canvas=this.pg=this.Ug=this.ah=this.Cg=this.mg=this.Eg=this.Zg=this.$g=this.Vf=this.Bg=this.yg=this.Vg=this.De=this.Ag=this.Dg=this.Wg=this.Xf=this.Nk=this.Rj=this.Mk=this.zk=this.ze=this.Pg=this.Vc=this.$f=this.Rg=!1;this.Sg=this.visibilityState="";this.gg=this.eg=this.dg=this.fg=this.cg=this.dk=this.Dj=this.td=this.Ej=this.Cj=!1;this.Tc=this.Sc=null;this.Jg=this.Kg=this.Gj=0;this.Hk=!1;this.Ok=this.tk=this.orientation="";this.cm()}});
function ia(a){this.i=a;this.m=!1;this.c=null;this.j=!1;this.f=null}e=ia.prototype;e.constructor=ia;e.boot=function(){for(var a=["ms","moz","webkit","o"],b=0;b<a.length&&!window.requestAnimationFrame;b++)window.requestAnimationFrame=window[a[b]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[a[b]+"CancelAnimationFrame"];this.f=window};
e.start=function(a){this.f="undefined"!==typeof a&&(a===window||a instanceof VRDisplay)?a:window;this.j=!0;"undefined"===typeof this.f.requestAnimationFrame||"timeout"===this.i.config.update?(this.m=!0,this.c=function(){!0===this.j&&(this.i.update(0),this.R=window.setTimeout(this.c.bind(this),1E3/30))},this.R=window.setTimeout(this.c.bind(this),0)):(this.m=!1,this.c=function(a){!0===this.j&&(this.i.update(Math.floor(a)),this.R=window.requestAnimationFrame(this.c.bind(this)))},this.R=this.f.requestAnimationFrame(this.c.bind(this)))};
e.stop=function(){this.m?clearTimeout(this.R):(this.f.cancelAnimationFrame(this.R),this.R=null);this.j=!1};e.destroy=function(){this.stop();this.f=this.c=this.i=null};Object.defineProperty(ia.prototype,"running",{get:function(){return this.j}});function ka(a){this.i=a;this.c=!0;n.call(this,"History")}ka.prototype=Object.create(n.prototype);e=ka.prototype;e.constructor=ka;
e.Ch=function(){this.log("_addState");var a=this.i.tour.scene,b={viewer:{uid:this.i.uid},scene:{uid:a.uid},locale:this.i.i18n.locale},d=window.history.state;null===d?window.history.replaceState(b,a.name,Tc(a)):d.scene.uid!==b.scene.uid&&window.history.pushState(b,a.name,Tc(a))};
e.Bh=function(){this.log("_updateState");var a=window.history.state,b;a?(b="undefined"!==typeof a.scene&&"string"===typeof a.scene.uid,b=!0===("undefined"!==typeof a.viewer&&"string"===typeof a.viewer.uid)&&!0===b):b=!1;b&&(b=g.S.get(a.scene.uid),a.locale=this.i.i18n.locale,window.history.replaceState(a,b.name,Tc(b)))};function Tc(a){return"#"+a.slug+"&uid="+a.uid}e.Si=function(a){if(null!==a.state){var b=g.S.get(a.state.viewer.uid);b.history.log("_onPopStateHandler");b.tour.scene=a.state.scene.uid}};
e.ma=function(a){this.c="boolean"===typeof a.enabled?a.enabled:!0;!0===this.c&&(this.i.tour.onSceneLoadStart.add(this.Ch,this),this.i.i18n.onLocaleChangeComplete.add(this.Bh,this),window.addEventListener("popstate",this.Si,!1))};e.destroy=function(){this.i.tour.onSceneLoadStart.remove(this.Ch,this);this.i.i18n.onLocaleChangeComplete.remove(this.Bh,this);window.removeEventListener("popstate",this.Si,!1);this.i=null;n.prototype.destroy.call(this)};Object.defineProperty(ka.prototype,"enabled",{get:function(){return this.c}});
function q(a,b){this.o=a;this.j=b||!1;this.c=this.m=null;this.f=!0;n.call(this,"EventDispatcher")}q.prototype=Object.create(n.prototype);e=q.prototype;e.constructor=q;
function Uc(a,b,d,h,k){if("function"!==typeof b)a.warn("You're trying to add an undefined listener");else if(!0===a.has(b,h))a.warn("You're trying to add a duplicate listener for this context");else{b=new Vc(a,b,d,h,k);a.c||(a.c=[]);if(a.c.length){d=a.c.length;do d--;while(a.c[d]&&b.Uf<=a.c[d].Uf);a.c.splice(d+1,0,b)}else a.c.push(b);!0===a.j&&!0===a.f&&null!==a.m&&b.Qb(a.m)}}
function Wc(a,b,d){if(!a.c)return-1;"undefined"===typeof d&&(d=null);for(var h,k=0,l=a.c.length;k<l;k++)if(h=a.c[k],h.listener===b&&h.context===d)return k;return-1}e.add=function(a,b,d){Uc(this,a,!1,b,d)};e.ga=function(a,b,d){Uc(this,a,!0,b,d)};e.remove=function(a,b){a=Wc(this,a,b);-1!==a&&(this.c[a].destroy(),this.c.splice(a,1))};e.has=function(a,b){return-1!==Wc(this,a,b)};
e.F=function(a,b){!0===this.j&&(this.m=void 0===a?null:a);if(!1!==this.f&&this.c)for(var d=this.c.length;d--;)this.c[d].Qb(a,b)};e.destroy=function(){if(!1!==this.yb){if(this.c){for(var a=this.c.length;a--;)this.c[a].destroy();this.c=null}this.m=this.o=null;n.prototype.destroy.call(this)}};Object.defineProperty(q.prototype,"emitter",{get:function(){return this.o}});Object.defineProperty(q.prototype,"memorize",{get:function(){return this.j},set:function(a){this.j=!!a}});
Object.defineProperty(q.prototype,"active",{get:function(){return this.f},set:function(a){this.f=!!a}});function Xc(a,b){this.f=a;this.c=b||null}Xc.prototype.constructor=Xc;Object.defineProperty(Xc.prototype,"emitter",{get:function(){return this.f}});Object.defineProperty(Xc.prototype,"data",{get:function(){return this.c}});function Vc(a,b,d,h,k){this.j=a;this.c=b;this.f=h||null;this.o=d||!1;this.Uf=k||0;this.m=0;this.R=!1}e=Vc.prototype;e.constructor=Vc;
e.Ni=function(a){this.c.call(this.f,new Xc(this.j.emitter,a));this.m++;!0===this.o&&this.Fh();this.R=!1};e.Qb=function(a,b){this.c&&(!0===b&&!1===this.R?(this.R=!0,window.setTimeout(this.Ni.bind(this,a),0)):!0!==b&&this.Ni(a))};e.Fh=function(){return this.j.remove(this.c,this.f)};e.destroy=function(){this.f=this.c=this.j=null};Object.defineProperty(Vc.prototype,"listener",{get:function(){return this.c}});Object.defineProperty(Vc.prototype,"context",{get:function(){return this.f}});
Object.defineProperty(Vc.prototype,"priority",{get:function(){return this.Uf}});Object.defineProperty(Vc.prototype,"callCount",{get:function(){return this.m}});function ja(a){this.i=a;this.c=null;this.f=-1;this.o="";this.u=!0;this.j=this.m=null;n.call(this,"LocaleManager");this.log("FORGE.LocaleManager._boot();");this.c=new Qc}ja.prototype=Object.create(n.prototype);e=ja.prototype;e.constructor=ja;
e.ma=function(a){this.u="boolean"===typeof a.enabled?a.enabled:!0;"undefined"!==typeof a.auto&&!0===a.auto&&""!==g.A.language?this.o=g.A.language:"string"===typeof a["default"]&&(this.o=a["default"]);if(!1===this.u)this.warn("FORGE.LocaleManager: locale management is deactivated");else if("undefined"!==typeof a.locales){for(var b=!1,d=0,h=a.locales.length;d<h;d++){var k;k=a.locales[d];var l,p=Yc(this,k.uid);-1===p?(l=new Zc(this.i),l.f.add(this.Gm,this),p=this.c.add(l)-1):l=this.c.get(p);l.ma(k);
p===this.f||this.o.toLowerCase()===k.uid.toLowerCase()?(l.xg(),-1===this.f&&$c(this,p),k=!0):k=!1;!0===k&&(b=!0)}!1===b&&(-1===Yc(this,this.o)&&(this.o=a.locales[0].uid),$c(this,Yc(this,a.locales[0].uid)))}};function Yc(a,b){for(var d,h=0,k=a.c.size;h<k;h++)if(d=a.c.get(h),d.uid.toLowerCase()===b.toLowerCase())return h;return-1}
function $c(a,b){if(0>b||b>=a.c.size)throw"The locale you are trying to set doesn't exist";a.f===b?a.warn("FORGE.LocaleManager: You're trying to set a locale that is already the actual locale"):(a.f=b,a.m&&a.m.F(),a.c.get(a.f).xg())}e.Gm=function(){this.log("FORGE.LocaleManager._localeAllFilesLoaded();");this.j&&this.j.F()};
e.nc=function(a,b){if(-1===this.f)return this.warn("FORGE.LocaleManager: You trying to get a value with no locale selected!"),a;var d=this.c.get(this.f).nc(a,b),h=Yc(this,this.o);this.f!==h&&-1!==h&&d===a&&(d=this.c.get(h).nc(a,b));return d};e.Mb=function(a,b){if(-1===this.f)return!1;var d=this.c.get(this.f).Mb(a,b),h=Yc(this,this.o);this.f!==h&&-1!==h&&!1===d&&(d=this.c.get(h).Mb(a,b));return d};
e.destroy=function(){this.i=null;if(this.c){for(var a=0,b=this.c.size;a<b;a++)this.c.get(a).destroy();this.c=null}this.m&&(this.m.destroy(),this.m=null);this.j&&(this.j.destroy(),this.j=null);n.prototype.destroy.call(this)};Object.defineProperty(ja.prototype,"locale",{get:function(){return-1!==this.f?this.c.get(this.f).uid:""},set:function(a){var b;"number"===typeof a&&a<this.c.size?b=a:"string"===typeof a&&(b=Yc(this,a));$c(this,b)}});
Object.defineProperty(ja.prototype,"localeIndex",{get:function(){return this.f},set:function(a){"number"===typeof a&&a<this.c.size&&$c(this,a)}});Object.defineProperty(ja.prototype,"localeObject",{get:function(){return-1!==this.f?this.c.get(this.f):null}});Object.defineProperty(ja.prototype,"locales",{get:function(){for(var a=[],b=0,d=this.c.size;b<d;b++)a.push(this.c.get(b).uid);return a}});Object.defineProperty(ja.prototype,"onLocaleChangeRequest",{get:function(){this.m||(this.m=new q(this));return this.m}});
Object.defineProperty(ja.prototype,"onLocaleChangeComplete",{get:function(){this.j||(this.j=new q(this));return this.j}});function D(a,b,d,h){this.i=a;this.c=b;this.m=d;this.j=h;this.f=null;n.call(this,"LocaleString")}D.prototype=Object.create(n.prototype);D.prototype.constructor=D;D.prototype.destroy=function(){this.i=null;n.prototype.destroy.call(this)};Object.defineProperty(D.prototype,"key",{get:function(){return this.c},set:function(a){this.c=a}});
Object.defineProperty(D.prototype,"jsonKey",{get:function(){return this.m},set:function(a){this.m=a}});Object.defineProperty(D.prototype,"value",{get:function(){if(""===this.i.i18n.locale)return"undefined"!==typeof this.j?this.j:this.c;this.f=this.i.i18n.nc(this.c,this.m);this.f===this.c&&"undefined"!==typeof this.j&&(this.f=this.j);return this.f}});Object.defineProperty(D.prototype,"loaded",{get:function(){var a=this.i.i18n.nc(this.c,this.m);return"undefined"!==typeof a&&a!==this.c}});
function Zc(a){this.i=a;this.m="";this.f=this.j=this.c=null;n.call(this,"Locale");this.c=new Qc;this.j=new q(this);this.f=new q(this)}Zc.prototype=Object.create(n.prototype);e=Zc.prototype;e.constructor=Zc;
e.ma=function(a){"string"===typeof a.uid&&(this.R=a.uid);""===this.m&&"string"===typeof a.name&&(this.m=a.name);if("undefined"!==typeof a.files)for(var b,d=0,h=a.files.length;d<h;d++)b=a.files[d],null===ad(this,b.key)&&(b.Rb=!1,b.loaded=!1,this.c.add(b));this.log("Locale.addConfig(); number of files : "+this.c.size)};
e.xg=function(){if(!0===bd(this))return this.f.F(),!0;for(var a,b=0,d=this.c.size;b<d;b++)a=this.c.get(b),!1===a.Rb&&!1===a.loaded&&!1===a.Rb&&!1===a.loaded&&(a.Rb=!0,this.i.load.json(a.key,a.url,this.Em,this))};function ad(a,b){for(var d,h=0,k=a.c.size;h<k;h++)if(d=a.c.get(h),d.key===b)return d;return null}e.Em=function(a){a=ad(this,a.key);a.Rb=!1;a.loaded=!0;this.log("loadFileComplete(); "+a.key);this.j.F();!0===bd(this)&&this.f.F()};
function bd(a){for(var b,d=0,h=a.c.size;d<h;d++)if(b=a.c.get(d),!1===b.loaded)return!1;return!0}e.nc=function(a,b){for(var d,h=0,k=this.c.size;h<k;h++)if(d=this.c.get(h),!0===this.i.cache.has(C.JSON,d.key)&&("undefined"===typeof b||b===d.key)&&(d=this.i.cache.get(C.JSON,d.key),"undefined"!==typeof d.data[a]))return d.data[a];"undefined"!==typeof b&&(this.warn("FORGE.Locale: value not found into the specified JSON file, try to find it in all files."),this.nc(a));return a};
e.Mb=function(a,b){for(var d,h=0,k=this.c.size;h<k;h++)if(d=this.c.get(h),!0===this.i.cache.has(C.JSON,d.key)&&("undefined"===typeof b||b===d.key)&&(d=this.i.cache.get(C.JSON,d.key),"undefined"!==typeof d.data[a]))return!0;"undefined"!==typeof b&&(this.warn("FORGE.Locale: key not found into the specified JSON file, try to find it in all files."),this.Mb(a));return!1};
e.Gh=function(a,b){for(var d,h=0,k=this.c.size;h<k;h++)if(d=this.c.get(h),!0===this.i.cache.has(C.JSON,d.key)&&("undefined"===typeof b||b===d.key)){d=this.i.cache.get(C.JSON,d.key);for(var l in d.data)if(d.data[l]===a)return l}"undefined"!==typeof b&&(this.warn("FORGE.Locale: value not found into the specified JSON file, try to find it in all files."),this.Gh(a))};e.destroy=function(){this.c=this.i=null;this.j.destroy();this.j=null;this.f.destroy();this.f=null;n.prototype.destroy.call(this)};
Object.defineProperty(Zc.prototype,"name",{get:function(){return this.m}});function qa(a){this.i=a;this.j=!0;this.o=this.m=this.f=this.c=null;n.call(this,"Keyboard");this.c=[];this.f=[];this.m=this.Bm.bind(this);this.o=this.Cm.bind(this);window.addEventListener("keydown",this.m,!1);window.addEventListener("keyup",this.o,!1)}qa.prototype=Object.create(n.prototype);e=qa.prototype;e.constructor=qa;
e.Bm=function(a){if(!1!==this.j){var b=a.keyCode;this.log("keyDown "+b);-1===this.f.indexOf(b)?(this.f.push(b),b=!0):b=!1;!0===b&&cd(this,a)}};
e.Cm=function(a){if(!1!==this.j){var b=a.keyCode;this.log("keyUp "+b);b=this.f.indexOf(b);-1!==b?(this.f.splice(b,1),b=!0):b=!1;if(!0===b)a:if(b=a.keyCode,!0!==this.ug(b))for(var b=this.kg(b),d,h=0,k=b.length;h<k;h++){d=b[h];for(var l=0,p=this.f.length;l<p;l++)if(d.se(this.f[l]))break a;d.Pk(a);l=0;for(p=this.f.length;l<p;l++)if(d.ng(this.f[l])){var r=new KeyboardEvent("keydown",{Eo:this.f[l],ctrlKey:a.ctrlKey,shiftKey:a.shiftKey,altKey:a.altKey});cd(this,r)}}}};
function dd(a,b){if(!a.c||!a.c.length)return-1;if("object"===typeof b&&"KeyBinding"===b.type)return a.c.indexOf(b);if("number"===typeof b)for(var d=0,h=a.c.length;d<h;d++)if(!0===a.c[d].se(b))return d;return-1}function cd(a,b){var d=b.keyCode;if(!0!==a.ug(d)){a=a.kg(d);for(var h=0,k=a.length;h<k;h++)d=a[h],!1===d.pressed&&d.Eh(b)}}e.update=function(){for(var a,b=0,d=this.c.length;b<d;b++)if(a=this.c[b],!0===a.pressed){if(!0===a.hasToWaitToHold&&!1===a.downComplete)break;a.jk()}};
e.eo=function(a){return-1!==this.f.indexOf(a)};e.ug=function(a){for(var b,d=0,h=this.c.length;d<h;d++)if(b=this.c[d],!0===b.pressed&&!0===b.ng(a))return!0;return!1};e.Wf=function(a){if("object"!==typeof a&&"KeyBinding"!==a.type)return!1;if(-1===dd(this,a))return this.c.push(a),!0;this.warn("Trying to add a duplicate key binding on keyboard!");return!1};e.He=function(a){a=dd(this,a);return-1!==a?(this.c[a].destroy(),this.c.splice(a,1),!0):!1};e.Un=function(a){return-1!==dd(this,a)};
e.kg=function(a){for(var b=[],d=0,h=this.c.length;d<h;d++)!0===this.c[d].se(a)&&b.push(this.c[d]);return b};e.destroy=function(){this.i=null;window.removeEventListener("keydown",this.m,!1);window.removeEventListener("keyup",this.o,!1);for(var a=this.c.length;a--;)this.He(this.c[a]);this.o=this.m=this.c=null;n.prototype.destroy.call(this)};Object.defineProperty(qa.prototype,"enabled",{get:function(){return this.j},set:function(a){this.j=!!a}});
function M(a,b,d,h,k,l,p,r){this.i=a;this.G=b||[];this.o=d||null;this.D=h||null;this.u=k||null;this.B=l||null;this.f=p||this;this.J=r||"";this.Of=this.I=this.M=!1;this.H=this.C=this.pd=0;this.m=this.j=this.c=null;n.call(this,"KeyBinding");if(!0===g.K.W(this.o,"string")||g.K.Pa(this.o,"string"))this.c=new Lb(this.i),this.c.c(this.o);if(!0===g.K.W(this.u,"string")||g.K.Pa(this.u,"string"))this.j=new Lb(this.i),this.j.c(this.u);if(!0===g.K.W(this.D,"string")||g.K.Pa(this.D,"string"))this.m=new Lb(this.i),
this.m.c(this.D)}M.prototype=Object.create(n.prototype);e=M.prototype;e.constructor=M;e.se=function(a){return"number"===typeof this.G&&this.G===a?!0:"function"===typeof this.G.indexOf?-1!==this.G.indexOf(a):!1};e.ng=function(a){if(null!==this.B){if("number"===typeof this.B&&this.B===a)return!0;if("function"===typeof this.B.indexOf)return-1!==this.B.indexOf(a)}return!1};e.Eh=function(a){this.log("down");this.pd++;this.I=!0;"function"===typeof this.o?this.o.call(this.f,this,a):this.c&&this.c.F()};
e.zo=function(){this.M=!0;var a=this.pd;return function(){this.log("downCompleteCallback "+a+" "+this.pd);a===this.pd&&(this.Of=!0)}.bind(this)};e.Pk=function(a){this.log("up");this.H++;this.Of=this.I=!1;"function"===typeof this.D?this.D.call(this.f,this,a):this.m&&this.m.F()};e.jk=function(){this.log("hold");this.C++;"function"===typeof this.u?this.u.call(this.f,this):this.j&&this.j.F()};
e.destroy=function(){this.f=this.B=this.u=this.D=this.o=this.G=null;this.c&&(this.c.destroy(),this.c=null);this.j&&(this.j.destroy(),this.j=null);this.m&&(this.m.destroy(),this.m=null);n.prototype.destroy.call(this)};Object.defineProperty(M.prototype,"name",{get:function(){return this.J}});Object.defineProperty(M.prototype,"pressed",{get:function(){return this.I}});Object.defineProperty(M.prototype,"downCount",{get:function(){return this.pd}});Object.defineProperty(M.prototype,"upCount",{get:function(){return this.H}});
Object.defineProperty(M.prototype,"holdCount",{get:function(){return this.C}});Object.defineProperty(M.prototype,"hasToWaitToHold",{get:function(){return this.M}});Object.defineProperty(M.prototype,"downComplete",{get:function(){return this.Of}});function ed(a){this.f=this.N=a;this.L=!1;this.c=null;this.j="";this.G=this.J=null;this.M=this.C=this.I=!1;this.m=null;this.U=200;this.H=this.P=1;this.Z=g.X.LINEAR;this.D=this.u=this.B=this.o=null;n.call(this,"Drag");this.H=this.N.alpha}ed.prototype=Object.create(n.prototype);
e=ed.prototype;e.constructor=ed;function fd(a,b){a.f&&(a.f&&(a.f.pointer.onPanStart.remove(a.zh,a),a.f.pointer.onPanMove.remove(a.yh,a),a.f.pointer.onPanEnd.remove(a.xh,a)),a.f=null);a.f=b;a.f.pointer.enabled=!0;a.f.pointer.onPanStart.add(a.zh,a);a.f.pointer.onPanMove.add(a.yh,a);a.f.pointer.onPanEnd.add(a.xh,a)}
e.zh=function(a){this.log("_panStartHandler");var b=a.data;a=a.data.srcEvent;"undefined"!==typeof a.touches&&"object"===typeof a.touches[0]&&(a=a.touches[0]);if(b=!0!==this.M&&b.target===this.f.dom){if(this.c)var b=this.N.globalOffset,d=this.c.globalOffset,h=b.left+this.N.pixelWidth>d.left+this.c.innerWidth,k=b.top<d.top,l=b.top+this.N.pixelHeight>d.top+this.c.innerHeight,b=!0===b.left<d.left||!0===h||!0===k||!0===l?!1:!0;else b=!0;b=!1!==b}b&&(this.I=!0,this.J={x:this.N.x,y:this.N.y},this.N.top=
null,this.N.right=null,this.N.bottom=null,this.N.left=null,this.G={x:a.pageX,y:a.pageY},this.P=this.N.alpha,this.N.alpha=this.H,this.o&&this.o.F())};e.xh=function(){this.log("_panEndHandler");!0===this.I&&(this.I=!1,this.u&&this.u.F(),!0===this.C&&this.m?(this.M=!0,this.m.kf({x:this.J.x,y:this.J.y},this.U,this.Z).start()):this.N.alpha=this.P,this.G=this.J=null)};
e.yh=function(a){this.log("_panMoveHandler");if(!0===this.I){a=a.data.srcEvent;"undefined"!==typeof a.touches&&"object"===typeof a.touches[0]&&(a=a.touches[0]);var b={x:a.pageX,y:a.pageY};a=b.x-this.G.x;var d=b.y-this.G.y;this.G=b;if(this.c){var b=this.N.globalOffset,h=this.N.parent.globalOffset,k=this.c.globalOffset;if(""===this.j||"x"===this.j)b.left+a<k.left?(this.log("out left"),this.N.x=Math.abs(h.left-k.left)):b.left+a+this.N.pixelWidth>k.left+this.c.innerWidth?(this.log("out right"),this.N.x=
Math.abs(h.left-k.left)+this.c.innerWidth-this.N.pixelWidth):this.N.x+=a;if(""===this.j||"y"===this.j)b.top+d<k.top?(this.log("out top"),this.N.y=Math.abs(h.top-k.top)):b.top+d+this.N.pixelHeight>k.top+this.c.innerHeight?(this.log("out bottom"),this.N.y=Math.abs(h.top-k.top)+this.c.innerHeight-this.N.pixelHeight):this.N.y+=d}else{if(""===this.j||"x"===this.j)this.N.x+=a;if(""===this.j||"y"===this.j)this.N.y+=d}this.B&&this.B.F()}};
e.bj=function(){this.log("_revertCompleteHandler");this.M=!1;this.N.alpha=this.P;this.D&&this.D.F()};e.enable=function(){this.L=!0;fd(this,this.f)};e.Ah=function(){this.L=!1};e.destroy=function(){this.revert=!1;this.o&&(this.o.destroy(),this.o=null);this.B&&(this.B.destroy(),this.B=null);this.u&&(this.u.destroy(),this.u=null);this.D&&(this.D.destroy(),this.D=null);this.G=this.c=this.N=this.f=null;n.prototype.destroy.call(this)};
Object.defineProperty(ed.prototype,"enabled",{get:function(){return this.L},set:function(a){!0===!!a?this.enable():this.Ah()}});Object.defineProperty(ed.prototype,"dragging",{get:function(){return this.I}});Object.defineProperty(ed.prototype,"handle",{get:function(){return this.f},set:function(a){fd(this,a)}});Object.defineProperty(ed.prototype,"constrain",{get:function(){return this.c},set:function(a){this.c=a}});
Object.defineProperty(ed.prototype,"progress",{get:function(){if(this.c){var a=this.N.globalOffset,b=this.c.globalOffset;return{x:(a.left-b.left)/(this.c.innerWidth-this.N.pixelWidth),y:(a.top-b.top)/(this.c.innerHeight-this.N.pixelHeight)}}}});Object.defineProperty(ed.prototype,"axis",{get:function(){return this.j},set:function(a){"x"===a||"y"===a?this.j=a:this.j=""}});Object.defineProperty(ed.prototype,"alpha",{get:function(){return this.H},set:function(a){"number"===typeof a&&(this.H=a)}});
Object.defineProperty(ed.prototype,"reverting",{get:function(){return this.M}});Object.defineProperty(ed.prototype,"revert",{get:function(){return this.C},set:function(a){this.C=!!a;!0!==this.C||this.m?!1===this.C&&this.m&&(this.N.viewer.tween.remove(this.m),this.m.onComplete.remove(this.bj,this),this.m.destroy(),this.m=null):(this.m=new lb(this.N.viewer,this.N),this.m.onComplete.add(this.bj,this),this.N.viewer.tween.add(this.m))}});
Object.defineProperty(ed.prototype,"revertDuration",{get:function(){return this.U},set:function(a){"number"===typeof a&&(this.U=a)}});Object.defineProperty(ed.prototype,"revertEasing",{get:function(){return this.Z},set:function(a){"function"===typeof a&&(this.Z=a)}});Object.defineProperty(ed.prototype,"onStart",{get:function(){this.o||(this.o=new q(this.N));return this.o}});Object.defineProperty(ed.prototype,"onDrag",{get:function(){this.B||(this.B=new q(this.N));return this.B}});
Object.defineProperty(ed.prototype,"onStop",{get:function(){this.u||(this.u=new q(this.N));return this.u}});Object.defineProperty(ed.prototype,"onRevert",{get:function(){this.D||(this.D=new q(this.N));return this.D}});
function U(a){this.N=a;this.c=!1;this.da=gd.DEFAULT;this.gb=null;this.Od=[];this.T=this.f=this.j=this.m=this.B=this.u=this.$=this.P=this.U=this.Z=this.C=this.H=this.M=this.D=this.G=this.I=this.J=this.L=this.o=this.O=this.fa=this.V=this.Da=this.Ca=this.ra=this.sa=this.Ba=this.Aa=this.aa=null;n.call(this,"Pointer");this.gb=new Hammer.Manager(this.N.dom);this.gb.set({enable:!1})}U.prototype=Object.create(n.prototype);e=U.prototype;e.constructor=U;
function hd(a,b,d,h){for(var k,l=0,p=a.Od.length;l<p;l++)if(k=a.Od[l],k.event===b&&k.Gn===d&&k.type===h)return l;return-1}function id(a,b,d,h){if(-1===hd(a,b,d,h))if(a.Od.push({event:b,Gn:d,type:h}),h===V.bb)a.N.dom.addEventListener(b,Hammer.bindFn(d,a));else if(h===V.oa)a.gb.on(b,Hammer.bindFn(d,a))}function jd(a,b,d){return function(){var h=hd(this,a,b,d);-1!==h&&(this.Od.splice(h,1),d===V.bb?this.N.dom.removeEventListener(a,b):d===V.oa&&this.gb.off(a))}}e.kj=function(a){this.O&&!0===this.c&&this.O.F(a)};
e.Ji=function(a){this.o&&!0===this.c&&this.o.F(a)};e.Vh=function(a){this.L&&!0===this.c&&this.L.F(a)};e.Uh=function(a){this.J&&!0===this.c&&this.J.F(a)};e.Qh=function(a){this.I&&!0===this.c&&this.I.F(a)};e.Ph=function(a){this.G&&!0===this.c&&this.G.F(a)};e.Oh=function(a){this.D&&!0===this.c&&this.D.F(a)};e.Th=function(a){this.M&&!0===this.c&&this.M.F(a)};e.Sh=function(a){this.H&&!0===this.c&&this.H.F(a)};e.Rh=function(a){this.C&&!0===this.c&&this.C.F(a)};e.ej=function(a){this.Z&&!0===this.c&&this.Z.F(a)};
e.dj=function(a){this.U&&!0===this.c&&this.U.F(a)};e.cj=function(a){this.P&&!0===this.c&&this.P.F(a)};e.ij=function(a){this.$&&!0===this.c&&this.$.F(a)};e.Mi=function(a){this.u&&!0===this.c&&this.u.F(a)};e.Oi=function(a){this.B&&!0===this.c&&this.B.F(a)};e.Xi=function(a){this.m&&!0===this.c&&this.m.F(a)};e.Wi=function(a){this.j&&!0===this.c&&this.j.F(a)};e.Ri=function(a){this.f&&!0===this.c&&this.f.F(a)};e.Wh=function(a){this.T&&!0===this.c&&this.T.F(a)};
e.enable=function(){!0===g.A.td&&(this.N.dom.style.pointerEvents="auto");this.gb.set({enable:!0});this.aa||(this.aa=new Hammer.Tap,this.gb.add(this.aa));this.Aa||(this.Aa=(new Hammer.Tap({event:W.Md,Ho:2})).recognizeWith(this.aa),this.gb.add(this.Aa));this.Ba||(this.Ba=(new Hammer.Press).recognizeWith(this.aa),this.gb.add(this.Ba));this.sa||(this.sa=new Hammer.Pan,this.gb.add(this.sa));this.ra||(this.ra=new Hammer.Pinch,this.gb.add(this.ra));this.Ca||(this.Ca=(new Hammer.Rotate).recognizeWith(this.ra),
this.gb.add(this.Ca));this.Da||(this.Da=(new Hammer.Swipe).recognizeWith(this.sa),this.gb.add(this.Da));this.c=!0;this.V&&this.V.F()};e.ef=function(){!0===g.A.td&&(this.N.dom.style.pointerEvents="none");this.c=!1;this.gb.set({enable:!1});this.fa&&this.fa.F()};
e.destroy=function(){this.ef();this.Da=this.Ca=this.ra=this.sa=this.Ba=this.Aa=this.aa=null;this.V&&(this.V.destroy(),this.V=null);this.fa&&(this.fa.destroy(),this.fa=null);this.O&&(this.O.destroy(),this.O=null);this.o&&(this.o.destroy(),this.o=null);this.L&&(this.L.destroy(),this.L=null);this.J&&(this.J.destroy(),this.J=null);this.I&&(this.I.destroy(),this.I=null);this.G&&(this.G.destroy(),this.G=null);this.D&&(this.D.destroy(),this.D=null);this.M&&(this.M.destroy(),this.M=null);this.H&&(this.H.destroy(),
this.H=null);this.C&&(this.C.destroy(),this.C=null);this.Z&&(this.Z.destroy(),this.Z=null);this.U&&(this.U.destroy(),this.U=null);this.P&&(this.P.destroy(),this.P=null);this.$&&(this.$.destroy(),this.$=null);this.u&&(this.u.destroy(),this.u=null);this.B&&(this.B.destroy(),this.B=null);this.m&&(this.m.destroy(),this.m=null);this.j&&(this.j.destroy(),this.j=null);this.f&&(this.f.destroy(),this.f=null);this.T&&(this.T.destroy(),this.T=null);this.N=null;n.prototype.destroy.call(this)};
Object.defineProperty(U.prototype,"enabled",{get:function(){return this.c},set:function(a){!0===!!a?this.enable():this.ef()}});Object.defineProperty(U.prototype,"cursor",{get:function(){return this.da},set:function(a){this.N.dom.style.cursor=a;if(a!==this.N.dom.style.cursor||""===this.N.dom.style.cursor)this.N.dom.style.cursor="-webkit-"+a;this.da=a}});Object.defineProperty(U.prototype,"onEnable",{get:function(){this.V||(this.V=new q(this));return this.V}});
Object.defineProperty(U.prototype,"onDisable",{get:function(){this.fa||(this.fa=new q(this));return this.fa}});Object.defineProperty(U.prototype,"onTap",{get:function(){this.O||(this.O=new q(this.N),this.O.onDestroy.ga(jd(W.If,this.kj,V.oa),this),id(this,W.If,this.kj,V.oa));return this.O}});Object.defineProperty(U.prototype,"onClick",{get:function(){return this.onTap}});
Object.defineProperty(U.prototype,"onDoubleTap",{get:function(){this.o||(this.o=new q(this.N),this.o.onDestroy.ga(jd(W.Md,this.Ji,V.oa),this),id(this,W.Md,this.Ji,V.oa));return this.o}});Object.defineProperty(U.prototype,"onDoubleClick",{get:function(){return this.onDoubleTap}});Object.defineProperty(U.prototype,"onPressStart",{get:function(){this.L||(this.L=new q(this.N),this.L.onDestroy.ga(jd(W.Cf,this.Vh,V.oa),this),id(this,W.Cf,this.Vh,V.oa));return this.L}});
Object.defineProperty(U.prototype,"onDown",{get:function(){return this.onPressStart}});Object.defineProperty(U.prototype,"onPressEnd",{get:function(){this.J||(this.J=new q(this.N),this.J.onDestroy.ga(jd(W.Bf,this.Uh,V.oa),this),id(this,W.Bf,this.Uh,V.oa));return this.J}});Object.defineProperty(U.prototype,"onUp",{get:function(){return this.onPressEnd}});
Object.defineProperty(U.prototype,"onPanStart",{get:function(){this.I||(this.I=new q(this.N),this.I.onDestroy.ga(jd(W.wf,this.Qh,V.oa),this),id(this,W.wf,this.Qh,V.oa));return this.I}});Object.defineProperty(U.prototype,"onPanMove",{get:function(){this.G||(this.G=new q(this.N),this.G.onDestroy.ga(jd(W.vf,this.Ph,V.oa),this),id(this,W.vf,this.Ph,V.oa));return this.G}});
Object.defineProperty(U.prototype,"onPanEnd",{get:function(){this.D||(this.D=new q(this.N),this.D.onDestroy.ga(jd(W.uf,this.Oh,V.oa),this),id(this,W.uf,this.Oh,V.oa));return this.D}});Object.defineProperty(U.prototype,"onPinchStart",{get:function(){this.M||(this.M=new q(this.N),this.M.onDestroy.ga(jd(W.Af,this.Th,V.oa),this),id(this,W.Af,this.Th,V.oa));return this.M}});
Object.defineProperty(U.prototype,"onPinchMove",{get:function(){this.H||(this.H=new q(this.N),this.H.onDestroy.ga(jd(W.zf,this.Sh,V.oa),this),id(this,W.zf,this.Sh,V.oa));return this.H}});Object.defineProperty(U.prototype,"onPinchEnd",{get:function(){this.C||(this.C=new q(this.N),this.C.onDestroy.ga(jd(W.yf,this.Rh,V.oa),this),id(this,W.yf,this.Rh,V.oa));return this.C}});
Object.defineProperty(U.prototype,"onRotateStart",{get:function(){this.Z||(this.Z=new q(this.N),this.Z.onDestroy.ga(jd(W.Ff,this.ej,V.oa),this),id(this,W.Ff,this.ej,V.oa));return this.Z}});Object.defineProperty(U.prototype,"onRotateMove",{get:function(){this.U||(this.U=new q(this.N),this.U.onDestroy.ga(jd(W.Ef,this.dj,V.oa),this),id(this,W.Ef,this.dj,V.oa));return this.U}});
Object.defineProperty(U.prototype,"onRotateEnd",{get:function(){this.P||(this.P=new q(this.N),this.P.onDestroy.ga(jd(W.Df,this.cj,V.oa),this),id(this,W.Df,this.cj,V.oa));return this.P}});Object.defineProperty(U.prototype,"onSwipe",{get:function(){this.$||(this.$=new q(this.N),this.$.onDestroy.ga(jd(W.Hf,this.ij,V.oa),this),id(this,W.Hf,this.ij,V.oa));return this.$}});
Object.defineProperty(U.prototype,"onEnter",{get:function(){this.u||(this.u=new q(this.N),this.u.onDestroy.ga(jd(W.Re,this.Mi,V.bb),this),id(this,W.Re,this.Mi,V.bb));return this.u}});Object.defineProperty(U.prototype,"onLeave",{get:function(){this.B||(this.B=new q(this.N),this.B.onDestroy.ga(jd(W.sf,this.Oi,V.bb),this),id(this,W.sf,this.Oi,V.bb));return this.B}});
Object.defineProperty(U.prototype,"onOver",{get:function(){this.m||(this.m=new q(this.N),this.m.onDestroy.ga(jd(W.yc,this.Xi,V.bb),this),id(this,W.yc,this.Xi,V.bb));return this.m}});Object.defineProperty(U.prototype,"onOut",{get:function(){this.j||(this.j=new q(this.N),this.j.onDestroy.ga(jd(W.Nb,this.Wi,V.bb),this),id(this,W.Nb,this.Wi,V.bb));return this.j}});
Object.defineProperty(U.prototype,"onMove",{get:function(){this.f||(this.f=new q(this.N),this.f.onDestroy.ga(jd(W.tf,this.Ri,V.bb),this),id(this,W.tf,this.Ri,V.bb));return this.f}});Object.defineProperty(U.prototype,"onWheel",{get:function(){this.T||(this.T=new q(this.N),this.T.onDestroy.ga(jd(W.Lf,this.Wh,V.bb),this),id(this,W.Lf,this.Wh,V.bb));return this.T}});
var V={bb:0,oa:1},W={If:"tap",Md:"doubletap",Cf:"press",Bf:"pressup",wf:"panstart",vf:"panmove",uf:"panend",Af:"pinchstart",zf:"pinchmove",yf:"pinchend",Ff:"rotatestart",Ef:"rotatemove",Df:"rotateend",Hf:"swipe",Re:"mouseenter",sf:"mouseleave",yc:"mouseover",Nb:"mouseout",tf:"mousemove",Lf:"wheel"},gd={DEFAULT:"default",kb:"pointer",Rl:"grab",Sl:"grabbing"};
function ea(a){this.i=a;this.ba=[];this.f=[];this.j=this.c=null;n.call(this,"DisplayList");this.c=this.xm.bind(this);document.addEventListener("fullscreenchange",this.c,!1);document.addEventListener("mozfullscreenchange",this.c,!1);document.addEventListener("webkitfullscreenchange",this.c,!1);document.addEventListener("MSFullscreenChange",this.c,!1)}ea.prototype=Object.create(n.prototype);e=ea.prototype;e.constructor=ea;
e.xm=function(){this.log("_fullScreenChangeHandler");if(null!==document[g.A.fullscreenElement])for(var a,b=this.ba.length;b--;){if(a=this.ba[b],a.dom===document[g.A.fullscreenElement]){a=this.j=a;a.log("_notifyFullscreenEnter");b=a;b.log("_fullscreenSaveData");b.Z={x:b.G,y:b.I,width:b.u,unitWidth:b.D,height:b.o,unitHeight:b.B,top:b.hc,right:b.Da,bottom:b.Yb,left:b.Aa};b.G=0;b.I=0;b.u=screen.width;b.D="px";b.c.style.width=b.u+"px";b.o=screen.height;b.B="px";b.c.style.height=b.o+"px";b.hc=null;b.Da=
null;b.Yb=null;b.Aa=null;b.c.style.top="0";b.c.style.left="0";b.za({property:"both"});a.ec&&a.ec.F();break}}else a=this.j,a.log("_notifyFullscreenChange"),a.log("_fullscreenRestoreData"),a.G=a.Z.x,a.c.style.left=a.G+"px",a.I=a.Z.y,a.c.style.top=a.I+"px",a.u=a.Z.width,a.D=a.Z.unitWidth,a.c.style.width=a.pixelWidth+"px",a.o=a.Z.height,a.B=a.Z.unitHeight,a.c.style.height=a.pixelHeight+"px",a.hc=a.Z.top,a.Da=a.Z.right,a.Yb=a.Z.bottom,a.Aa=a.Z.left,a.za({property:"both"}),a.Z=null,a.fc&&a.fc.F(),this.j=
null};e.register=function(a,b){this.ba.push(a);!0===b&&this.f.push(a)};e.unregister=function(a){this.ba.splice(this.ba.indexOf(a),1);a=this.f.indexOf(a);-1!==a&&this.f.splice(a,1)};e.update=function(){for(var a=0,b=this.f.length;a<b;a++)this.f[a].update()};
e.destroy=function(){for(var a=this.ba.length;a--;)this.ba[a].destroy();this.ba=[];this.f=[];document.removeEventListener("fullscreenchange",this.c,!1);document.removeEventListener("mozfullscreenchange",this.c,!1);document.removeEventListener("webkitfullscreenchange",this.c,!1);document.removeEventListener("MSFullscreenChange",this.c,!1);this.j=this.c=null};var kd="DisplayObject DisplayObjectContainer Image TextField Button Video Canvas Sprite Iframe".split(" ");
function T(a,b,d){this.i=a;this.c=b||null;this.m=null;this.ve=0;this.Qe="";this.I=this.G=0;this.$b=!1;this.u=0;this.D="px";this.ra=1;this.o=0;this.B="px";this.sa=1;this.Rc=this.Pc=!1;this.Aa=this.Yb=this.Da=this.hc=null;this.ue=1;this.xe=0;this.Oc=this.Qc=null;this.jd="";this.ld="solid";this.P=0;this.kd="rgb(0, 0, 0)";this.Fe=0;this.U=!1;this.Hd="";this.xb=null;this.we=!1;this.$=!0;this.Ca=null;this.fa=!1;this.fc=this.ec=this.ad=this.xd=this.ac=this.bc=this.M=this.dc=this.gc=this.Ba=this.Z=null;n.call(this,
d||"DisplayObject");this.La()}T.prototype=Object.create(n.prototype);e=T.prototype;e.constructor=T;
e.La=function(){!0!==this.we&&("undefined"!==typeof this.c&&this.c?(this.u=g.ka.ck(this.c),this.D=g.ka.ak(this.c),this.o=g.ka.bk(this.c),this.B=g.ka.$j(this.c)):this.c=document.createElement("div"),this.c.style.width=this.u+""+this.D,this.c.style.height=this.o+""+this.B,this.c.style.display="block",this.c.style.position="relative",this.c.style.margin="0px",this.c.style.padding="0px",this.c.style.top=this.I+"px",this.c.style.left=this.G+"px",this.c.style.overflow="hidden",this.c.style.boxSizing="border-box",
!0===g.A.td&&(this.c.style.pointerEvents="none"),this.c.style.R="none",this.c.style.webkitUserSelect="none",this.c.style.c="none",this.c.style.f="none",this.c.style.j="none",this.c.style.borderStyle=this.ld,this.c.style.borderWidth=this.P+"px",this.c.style.borderColor=this.kd,this.c.style.background=this.jd,this.Ca=[],"DisplayObject"===this.fb&&(this.i.display.register(this),ld(this),md(this)))};function ld(a){!0!==a.we&&(a.log("_notifyReady"),a.we=!0,a.Ba&&a.Ba.F())}
e.ae=function(){this.log("_notifyAddedToDom");this.ac&&this.ac.F()};e.zc=function(){this.log("_notifyShow");!1!==this.Ad()&&this.xd&&!0===this.visible&&this.xd.F()};e.be=function(){this.log("_notifyHide");this.ad&&!1===this.visible&&this.ad.F()};e.Rf=function(){this.dc&&this.dc.F()};e.za=function(a){nd(this);this.gc&&this.gc.F(a)};
function nd(a){a.m&&a.u&&a.o&&(a.log("_updateAnchors"),!0===a.Pc?a.horizontalCenter=!0:(a.left=a.Aa,a.right=a.Da),!0===a.Rc?a.verticalCenter=!0:(a.top=a.hc,a.bottom=a.Yb))}
function od(a,b){var d=-1!==b.toLowerCase().indexOf("height")||"both"===b;!0===(-1!==b.toLowerCase().indexOf("width")||"both"===b)&&"%"===a.D&&(a.c.style.width=a.pixelWidth+"px",a.c.width=a.pixelWidth,a.za({property:"width"}));!0===d&&"%"===a.B&&(a.c.style.height=a.pixelHeight+"px",a.c.height=a.pixelHeight,a.za({property:"height"}))}function pd(a,b,d){a.Ca.push({prop:b,value:d})}
function md(a){a.log("_applyPending");a.$=!1;if(a.Ca&&0!==a.Ca.length){a.fa=!0;for(var b=0,d=a.Ca.length;b<d;b++)a[a.Ca[b].prop]=a.Ca[b].value;a.fa=!1;a.Ca=[]}}e.wh=function(){this.c.style.display="block";this.zc()};e.ik=function(){this.c.style.display="none";this.be()};e.xo=function(){this.visible=!this.visible};
e.Sb=function(a){!0===a&&(this.U=!0,!0===this.$&&pd(this,"maximized",!0));this.m&&(this.$b=!1,a=this.pixelWidth,this.u=this.m.innerWidth,this.D="px",this.c.style.width=this.m.innerWidth+"px",this.c.width=this.m.innerWidth,a!==this.pixelWidth&&this.za({property:"width"}),a=this.pixelHeight,this.o=this.m.innerHeight,this.B="px",this.c.style.height=this.m.innerHeight+"px",this.c.height=this.m.innerHeight,a!==this.pixelHeight&&this.za({property:"height"}))};e.Ad=function(){return g.ka.has(this.c)};
e.vh=function(a,b){null!==a&&"undefined"!==typeof a&&(this.width=a);null!==b&&"undefined"!==typeof b&&(this.height=b)};e.Nj=function(){if(!0===document[g.A.fullscreenEnabled]&&!1===this.zd())this.c[g.A.requestFullscreen]()};e.Oj=function(){if(!0===document[g.A.fullscreenEnabled]&&!0===this.zd())document[g.A.exitFullscreen]()};e.zd=function(){return document[g.A.fullscreenElement]===this.c};
e.destroy=function(){!1!==this.yb&&(this.i.display.unregister(this),this.m&&(this.m.removeChild(this,!1),this.m=null),this.Qc&&(this.Qc.destroy(),this.Qc=null),this.Oc&&(this.Oc.destroy(),this.Oc=null),this.gc&&(this.gc.destroy(),this.gc=null),this.dc&&(this.dc.destroy(),this.dc=null),this.Ba&&(this.Ba.destroy(),this.Ba=null),this.bc&&(this.bc.destroy(),this.bc=null),this.ac&&(this.ac.destroy(),this.ac=null),this.ec&&(this.ec.destroy(),this.ec=null),this.fc&&(this.fc.destroy(),this.fc=null),this.i=
this.xb=this.c=null,n.prototype.destroy.call(this))};Object.defineProperty(T.prototype,"viewer",{get:function(){return this.i}});Object.defineProperty(T.prototype,"dom",{get:function(){return this.c}});Object.defineProperty(T.prototype,"id",{get:function(){return this.Qe},set:function(a){this.Qe=a;this.c.id=this.Qe}});Object.defineProperty(T.prototype,"ready",{get:function(){return this.we}});
Object.defineProperty(T.prototype,"parent",{get:function(){return this.m},set:function(a){"object"===typeof a&&!1!==Array.isArray(a.children)&&a!==this.m&&(this.m=a,this.c.style.position="absolute",!0===this.U&&this.Sb(this.U),od(this,"both"),nd(this),this.bc&&this.bc.F(),!0===this.m.Ad()&&(this.ae(),this.zc()))}});Object.defineProperty(T.prototype,"visible",{get:function(){return"block"===this.c.style.display},set:function(a){"boolean"===typeof a&&(!0===a?this.wh():this.ik())}});
Object.defineProperty(T.prototype,"x",{get:function(){return this.G},set:function(a){if("number"===typeof a){var b=this.G;this.G=a;this.c.style.left=this.G+"px";this.M&&b!==this.G&&this.M.F({property:"x"})}}});Object.defineProperty(T.prototype,"y",{get:function(){return this.I},set:function(a){if("number"===typeof a){var b=this.I;this.I=a;this.c.style.top=this.I+"px";this.M&&b!==this.I&&this.M.F({property:"y"})}}});
Object.defineProperty(T.prototype,"keepRatio",{get:function(){return this.$b},set:function(a){"boolean"===typeof a&&a!==this.$b&&(this.$b=a)}});
Object.defineProperty(T.prototype,"width",{get:function(){return this.u},set:function(a){var b=this.u,d=this.D;if("string"===typeof a){var h=g.K.Fg(a);if(null===h.value||null===h.Zc)throw"FORGE.DisplayObject.width value "+a+" is incorrect";this.D=h.Zc;this.u=h.value}else if("number"===typeof a)this.u=a;else return;!0===this.$?pd(this,"width",this.u):(this.U=!1,this.c.style.width=this.pixelWidth+"px",this.c.width=this.pixelWidth,b===this.u&&d===this.D&&!0!==this.fa||this.za({property:"width"}))}});
Object.defineProperty(T.prototype,"pixelWidth",{get:function(){if("px"===this.D)return this.u;if("%"===this.D)return this.m?this.m.innerWidth*this.u/100:0},set:function(a){if("number"===typeof a){var b=this.u,d=this.D;this.u=a;this.D="px";!0===this.$?pd(this,"pixelWidth",a):(this.U=!1,this.c.style.width=this.pixelWidth+"px",this.c.width=this.pixelWidth,b===this.u&&"px"===d&&!0!==this.fa||this.za({property:"pixelWidth"}))}}});
Object.defineProperty(T.prototype,"percentWidth",{get:function(){if("%"===this.D)return this.u;if("px"===this.D)return this.m?this.u/this.m.innerWidth*100:0},set:function(a){if("number"===typeof a){var b=this.u,d=this.D;this.u=a;this.D="%";!0===this.$?pd(this,"percentWidth",a):(this.U=!1,this.c.style.width=this.pixelWidth+"px",this.c.width=this.pixelWidth,b===this.u&&"%"===d&&!0!==this.fa||this.za({property:"percentWidth"}))}}});
Object.defineProperty(T.prototype,"unitWidth",{get:function(){return this.D},set:function(a){if("string"===typeof a&&("px"===a||"%"===a)){var b=this.D;this.D=a;!0===this.$?pd(this,"unitWidth",a):(this.U=!1,this.c.style.width=this.pixelWidth+"px",this.c.width=this.pixelWidth,b===this.D&&!0!==this.fa||this.za({property:"unitWidth"}))}}});Object.defineProperty(T.prototype,"innerWidth",{get:function(){return this.pixelWidth-2*this.P}});
Object.defineProperty(T.prototype,"height",{get:function(){return this.o},set:function(a){var b=this.o,d=this.B;if("string"===typeof a){var h=g.K.Fg(a);if(null===h.value||null===h.Zc)throw"FORGE.DisplayObject.height value "+a+" is incorrect";this.B=h.Zc;this.o=h.value}else if("number"===typeof a)this.o=a;else return;!0===this.$?pd(this,"height",this.o):(this.U=!1,this.c.style.height=this.pixelHeight+"px",this.c.height=this.pixelHeight,b===this.o&&d===this.B&&!0!==this.fa||this.za({property:"height"}))}});
Object.defineProperty(T.prototype,"pixelHeight",{get:function(){if("px"===this.B)return this.o;if("%"===this.B)return this.m?this.m.innerHeight*this.o/100:0},set:function(a){if("number"===typeof a){var b=this.o,d=this.B;this.o=a;this.B="px";!0===this.$?pd(this,"pixelHeight",a):(this.U=!1,this.c.style.height=this.pixelHeight+"px",this.c.height=this.pixelHeight,b===this.o&&"px"===d&&!0!==this.fa||this.za({property:"pixelHeight"}))}}});
Object.defineProperty(T.prototype,"percentHeight",{get:function(){if("%"===this.B)return this.o;if("px"===this.B)return this.m?this.o/this.m.innerHeight*100:0},set:function(a){if("number"===typeof a){var b=this.o,d=this.B;this.o=a;this.B="%";!0===this.$?pd(this,"percentHeight",a):(this.U=!1,this.c.style.height=this.pixelHeight+"px",this.c.height=this.pixelHeight,b===this.o&&"%"===d&&!0!==this.fa||this.za({property:"percentHeight"}))}}});
Object.defineProperty(T.prototype,"unitHeight",{get:function(){return this.B},set:function(a){if("string"===typeof a){var b=this.B;this.B=a;!0===this.$?pd(this,"unitHeight",a):(this.U=!1,this.c.style.height=this.pixelHeight+"px",this.c.height=this.pixelHeight,b===this.B&&!0!==this.fa||this.za({property:"unitHeight"}))}}});Object.defineProperty(T.prototype,"innerHeight",{get:function(){return this.pixelHeight-2*this.P}});
Object.defineProperty(T.prototype,"maximized",{get:function(){return this.U},set:function(a){"boolean"===typeof a&&(this.U=a,!0===this.U&&this.Sb(!0))}});Object.defineProperty(T.prototype,"horizontalCenter",{get:function(){return this.Pc},set:function(a){"boolean"===typeof a&&(this.Pc=a,!0===this.Pc&&(this.Da=this.Aa=null),this.m&&(a=this.G,this.G=(this.m.innerWidth-this.pixelWidth)/2,this.c.style.left=this.G+"px",this.M&&a!==this.G&&this.M.F({property:"x"})))}});
Object.defineProperty(T.prototype,"verticalCenter",{get:function(){return this.Rc},set:function(a){"boolean"===typeof a&&(this.Rc=a,!0===this.Rc&&(this.Yb=this.hc=null),this.m&&(a=this.I,this.I=(this.m.innerHeight-this.pixelHeight)/2,this.c.style.top=this.I+"px",this.M&&a!==this.I&&this.M.F({property:"y"})))}});
Object.defineProperty(T.prototype,"top",{get:function(){return this.hc},set:function(a){if("number"===typeof a||null===a)if(this.hc=a,this.Rc=!1,this.m&&null!==this.hc){var b=this.I;this.I=a;this.c.style.top=this.I+"px";this.M&&b!==this.I&&this.M.F({property:"y"})}}});
Object.defineProperty(T.prototype,"right",{get:function(){return this.Da},set:function(a){if("number"===typeof a||null===a)if(this.Da=a,this.Pc=!1,this.m&&null!==this.Da){var b=this.G;this.G=this.m.innerWidth-this.pixelWidth-a;this.c.style.left=this.G+"px";this.M&&b!==this.G&&this.M.F({property:"x"})}}});
Object.defineProperty(T.prototype,"bottom",{get:function(){return this.Yb},set:function(a){if("number"===typeof a||null===a)if(this.Yb=a,this.Rc=!1,this.m&&null!==this.Yb){var b=this.I;this.I=this.m.innerHeight-this.pixelHeight-a;this.c.style.top=this.I+"px";this.M&&b!==this.I&&this.M.F({property:"y"})}}});
Object.defineProperty(T.prototype,"left",{get:function(){return this.Aa},set:function(a){if("number"===typeof a||null===a)if(this.Aa=a,this.Pc=!1,this.m&&null!==this.Aa){var b=this.G;this.G=a;this.c.style.left=this.G+"px";this.M&&b!==this.G&&this.M.F({property:"x"})}}});Object.defineProperty(T.prototype,"alpha",{get:function(){return this.ue},set:function(a){"number"===typeof a&&a!==this.ue&&(this.ue=a,this.c.style.opacity=this.ue)}});
Object.defineProperty(T.prototype,"rotation",{get:function(){return this.xe},set:function(a){"number"===typeof a&&a!==this.xe&&(this.xe=a,this.c.style.transform="rotate("+this.xe+"deg)")}});Object.defineProperty(T.prototype,"background",{get:function(){return this.jd},set:function(a){"string"===typeof a&&a!==this.jd&&(this.jd=a,this.c.style.background=this.jd)}});
Object.defineProperty(T.prototype,"borderStyle",{get:function(){return this.ld},set:function(a){-1!=="none dotted dashed solid double groove ridge inset outset".split(" ").indexOf(a)&&a!==this.ld&&(this.ld=a,!0===this.$?pd(this,"borderStyle",a):this.c.style.borderStyle=this.ld)}});
Object.defineProperty(T.prototype,"borderWidth",{get:function(){return this.P},set:function(a){if("number"===typeof a){var b=this.P;this.P=a;!0===this.$?pd(this,"borderWidth",a):(this.c.style.borderWidth=this.P+"px",b===this.P&&!0!==this.fa||this.Rf())}}});Object.defineProperty(T.prototype,"borderColor",{get:function(){return this.kd},set:function(a){"string"===typeof a&&a!==this.kd&&(this.kd=a,this.c.style.borderColor=this.kd)}});
Object.defineProperty(T.prototype,"borderRadius",{get:function(){return this.Fe},set:function(a){"number"!==typeof a&&"string"!==typeof a||a===this.Fe||("string"===typeof a&&(a=parseInt(a,10)),isNaN(a)||(this.Fe=a,this.c.style.borderRadius=this.Fe+"px"))}});Object.defineProperty(T.prototype,"globalOffset",{get:function(){var a=this.c,b=0,d=0;do b+=a.offsetTop||0,d+=a.offsetLeft||0,a=a.offsetParent;while(a);return{top:b,left:d}}});
Object.defineProperty(T.prototype,"tooltip",{get:function(){return this.Hd},set:function(a){"string"===typeof a&&a!==this.Hd&&(this.Hd=a,this.c.title=this.Hd)}});Object.defineProperty(T.prototype,"index",{get:function(){return this.ve},set:function(a){"number"===typeof a&&a!==this.ve&&(this.ve=a,this.c.style.zIndex=this.ve)}});Object.defineProperty(T.prototype,"fullscreen",{set:function(a){"boolean"===typeof a&&(!0===a?this.Nj():this.Oj())}});
Object.defineProperty(T.prototype,"pointer",{get:function(){this.Qc||(this.Qc=new U(this));return this.Qc}});Object.defineProperty(T.prototype,"drag",{get:function(){this.Oc||(this.Oc=new ed(this));return this.Oc}});Object.defineProperty(T.prototype,"onResize",{get:function(){this.gc||(this.gc=new q(this));return this.gc}});Object.defineProperty(T.prototype,"onBorderResize",{get:function(){this.dc||(this.dc=new q(this));return this.dc}});
Object.defineProperty(T.prototype,"onMove",{get:function(){this.M||(this.M=new q(this));return this.M}});Object.defineProperty(T.prototype,"onReady",{get:function(){this.Ba||(this.Ba=new q(this,!0));return this.Ba}});Object.defineProperty(T.prototype,"onAddedToParent",{get:function(){this.bc||(this.bc=new q(this));return this.bc}});Object.defineProperty(T.prototype,"onAddedToDom",{get:function(){this.ac||(this.ac=new q(this));return this.ac}});
Object.defineProperty(T.prototype,"onShow",{get:function(){this.xd||(this.xd=new q(this));return this.xd}});Object.defineProperty(T.prototype,"onHide",{get:function(){this.ad||(this.ad=new q(this));return this.ad}});Object.defineProperty(T.prototype,"onFullscreenEnter",{get:function(){this.ec||(this.ec=new q(this));return this.ec}});Object.defineProperty(T.prototype,"onFullscreenExit",{get:function(){this.fc||(this.fc=new q(this));return this.fc}});
function v(a,b,d,h){this.f=[];this.O="undefined"!==typeof h?h:null;this.C=null;this.Pf=!1;this.ja="hidden";T.call(this,a,b,d||"DisplayObjectContainer")}v.prototype=Object.create(T.prototype);e=v.prototype;e.constructor=v;
e.La=function(){T.prototype.La.call(this);if("DisplayObjectContainer"===this.fb){var a=!!this.O;!0===a&&(this.C={originalWidth:this.O.clientWidth,originalHeight:this.O.clientHeight,currentWidth:this.O.clientWidth,currentHeight:this.O.clientHeight,scaleWidth:1,scaleHeight:1,frameCount:0,frameInterval:10},this.u=this.C.currentWidth,this.c.style.width=this.pixelWidth+"px",this.o=this.C.currentHeight,this.c.style.height=this.pixelHeight+"px",this.c.style.position="absolute",this.O.appendChild(this.c));
this.i.display.register(this,a);ld(this);md(this)}};e.za=function(a){for(var b=0,d=this.f.length;b<d;b++){var h=this.f[b],k=a;!0===h.U&&h.Sb(h.U);od(h,k.property);nd(h)}T.prototype.za.call(this,a)};e.ae=function(){T.prototype.ae.call(this);for(var a=0,b=this.f.length;a<b;a++)this.f[a].ae()};e.zc=function(){T.prototype.zc.call(this);for(var a=0,b=this.f.length;a<b;a++)this.f[a].zc()};e.be=function(){T.prototype.be.call(this);for(var a=0,b=this.f.length;a<b;a++)this.f[a].be()};
function qd(a,b){if(!a.f)return-1;for(var d=0,h=a.f.length;d<h;d++)if(a.f[d]===b)return d;return-1}
e.update=function(){this.C.frameCount++;if(!(this.C.frameCount<this.C.frameInterval)){this.C.frameCount=0;var a=this.O.clientWidth,b=this.O.clientHeight,d=!1;a!==this.C.currentWidth&&(this.C.currentWidth=a,this.C.scaleWidth=this.C.currentWidth/this.C.originalWidth,d=!0);b!==this.C.currentHeight&&(this.C.currentHeight=b,this.C.scaleHeight=this.C.currentHeight/this.C.scaleHeight,d=!0);!0===d&&this.vh(this.C.currentWidth,this.C.currentHeight)}};
e.mc=function(a){if(a===this)throw"You can't add a FORGE.DisplayObjectContainer to itself!";var b=a;a instanceof Element&&(b=new T(a));this.c.appendChild(b.dom);b.parent=this;a=this.f.push(b)-1;null===b.index&&(b.index=a)};e.Dn=function(a,b){var d=a;a instanceof Element&&(d=new T(a));this.c.appendChild(d.dom);d.parent=this;this.f.splice(b,0,d);d.index=b;b=0;for(d=this.f.length;b<d;b++)a=this.f[b],a.index=b};
e.Mj=function(){var a=this.f;if(0<a.length){this.Pf=!0;for(var b=0,d=a.length;b<d;b++)if(!0===a[b].Ad()&&!0===a[b].visible){var h=Math.max(a[b].width+a[b].x,a[b].width+a[b].left,a[b].width+a[b].right),k=Math.max(a[b].height+a[b].y,a[b].height+a[b].top,a[b].height+a[b].bottom);h>this.pixelWidth&&(this.width=h);k>this.pixelHeight&&(this.height=k)}}null!==this.parent&&!0===g.K.W(this.parent,"DisplayObjectContainer")&&!0===this.parent.Pf&&this.parent.Mj()};
e.removeChild=function(a,b){a=qd(this,a);-1!==a&&this.Gg(a,b)};e.Gg=function(a,b){if(0<=a&&a<this.f.length){var d=this.f[a];this.f.splice(a,1);this.c.removeChild(d.dom);"undefined"!==typeof b&&!0!==b||d.destroy();!0!==this.Pf||this.f.length||(this.height=this.width=0)}};e.uh=function(a){for(var b=this.f.length;b--;)this.Gg(b,a)};e.Xk=function(a){return-1!==qd(this,a)};e.destroy=function(){this.uh(!1);this.C=this.O=this.f=null;T.prototype.destroy.call(this)};
Object.defineProperty(v.prototype,"children",{get:function(){return this.f}});Object.defineProperty(v.prototype,"overflow",{get:function(){return this.ja},set:function(a){-1!==["hidden","visible","scroll"].indexOf(a)&&(this.ja=a,this.c.style.overflow=a)}});
function H(a,b,d){this.xa=b||null;this.na=this.O="";this.ja=!1;this.la=this.ya="";this.C=this.aa=null;this.da=!1;this.ia=this.f=null;this.qa="";this.T=this.pa=!1;this.va=this.wa=!0;this.H=rd;this.L=this.V=this.j=null;T.call(this,a,null,d||"Image")}H.prototype=Object.create(T.prototype);H.prototype.constructor=H;var sd={CSS:"css",Zb:"canvas"},rd=sd.CSS;e=H.prototype;
e.La=function(){T.prototype.La.call(this);this.$b=!0;this.H===sd.CSS?this.c.style.backgroundRepeat="no-repeat":this.H===sd.Zb&&(this.j=document.createElement("canvas"),this.j.style.position="absolute",this.j.style.top="0px",this.j.style.left="0px",this.c.appendChild(this.j));null!==this.xa&&this.load(this.xa);this.i.display.register(this);ld(this)};
e.za=function(a){var b=a.property;-1!==b.toLowerCase().indexOf("width")&&"autoWidth"!==b&&(this.wa=!1);-1!==b.toLowerCase().indexOf("height")&&"autoHeight"!==b&&(this.va=!1);this.C&&(this.H===sd.CSS?(td(this),ud(this)):this.H===sd.Zb&&this.f&&this.qd(this.f),!0===this.$b&&(-1!==b.toLowerCase().indexOf("width")?(b=this.pixelWidth/this.f.w,b!==this.ra&&(this.ra=b,!0===this.$b&&(this.sa=b,this.height=this.f.h*this.sa))):-1!==b.toLowerCase().indexOf("height")&&(b=this.pixelHeight/this.f.h,b!==this.sa&&
(this.sa=b,!0===this.$b&&(this.ra=b,this.width=this.f.w*this.ra)))),T.prototype.za.call(this,a))};e.Rf=function(){this.H===sd.CSS?this.c.style.backgroundPosition=-this.P+"px "+-this.P+"px":this.H===sd.Zb&&(this.j.style.top=-this.P+"px",this.j.style.left=-this.P+"px");T.prototype.Rf.call(this)};e.$e=function(){var a=this.O+"_"+this.i.i18n.locale;if(a!==this.ya&&(this.ya=a,!0===this.i.i18n.Mb(this.la))){var b=this.aa.value;this.T=!1;this.i.load.image(a,b,this.$d,this)}};
function vd(a,b){a.f=b;!0===a.wa&&(a.u=a.f.w,a.D="px",a.c.style.width=a.pixelWidth+"px");!0===a.va&&(a.o=a.f.h,a.B="px",a.c.style.height=a.pixelHeight+"px");a.H===sd.CSS?(td(a),ud(a)):a.H===sd.Zb&&a.qd(a.f)}e.qd=function(a){if(this.C&&!1!==this.da){this.j.width=this.innerWidth;this.j.height=this.innerHeight;var b=this.j.getContext("2d");b.clearRect(0,0,this.innerWidth,this.innerHeight);b.drawImage(this.C,a.x,a.y,a.w,a.h,0,0,this.innerWidth,this.innerHeight)}};
function td(a){a.c.style.backgroundSize=a.pixelWidth/a.f.w*a.C.naturalWidth+"px "+a.pixelHeight/a.f.h*a.C.naturalHeight+"px"}function ud(a){a.c.style.backgroundPosition=a.pixelWidth/a.f.w*(-a.f.x-a.P)+"px "+a.pixelHeight/a.f.h*(-a.f.y-a.P)+"px"}e.$d=function(a){!1!==this.yb&&(this.C=a.data,this.H===sd.CSS&&(this.c.style.backgroundImage="url('"+a.url+"')"),this.da=!0,wd(this))};
e.Fm=function(a){"undefined"!==typeof a.data.frames?this.ia=a.data.frames:this.warn("No frames found in file!");this.pa=!0;wd(this)};function wd(a){if(!0!==a.T&&!0===a.da&&!0===a.pa){a.T=!0;var b;a.f?b=a.f:a.ia?b=a.ia[0].frame:b={x:0,y:0,w:a.C.naturalWidth,h:a.C.naturalHeight};vd(a,b);nd(a);md(a);a.L&&a.L.F()}}
e.load=function(a){this.pa=this.da=this.T=!1;"object"===typeof a&&a?(this.O=a.key||"",this.ja=a.i18n||!1,!0===this.ja?(this.na="",this.la=a.url):this.na=a.url,this.f=a.frame||null,"string"===typeof a.frames?this.qa=a.frames:"object"===typeof a.frames&&null!==a.frames&&(this.ia=a.frames),this.alpha=a.alpha,this.keepRatio=a.keepRatio,this.maximized=a.maximized,this.width=a.width,this.height=a.height):(this.na=this.O="",this.ja=!1,"string"===typeof a&&(this.na=a));a=this.O;var b=this.na;if(!0===this.ja&&
"string"===typeof this.la){this.aa=new D(this.i,this.la);!1===this.i.i18n.onLocaleChangeComplete.has(this.$e,this)&&this.i.i18n.onLocaleChangeComplete.add(this.$e,this);var d=this.i.i18n.locale;""!==d&&(a=this.O+"_"+d);!0===this.i.i18n.Mb(this.la)&&(b=this.aa.value)}""!==b?(this.T=!1,this.i.load.image(a,b,this.$d,this)):this.da=!0;"string"===typeof this.qa&&""!==this.qa?(a=this.qa,this.T=!1,this.i.load.json(this.O+"-frames",a,this.Fm,this)):this.pa=!0};
e.Le=function(){this.c.style.backgroundImage="";this.C=null};e.destroy=function(a){if(!1!==this.yb){this.aa&&(this.aa.destroy(),this.aa=null,this.i.i18n.onLocaleChangeComplete.remove(this.$e,this));this.V&&(this.V.destroy(),this.V=null);this.L&&(this.L.destroy(),this.L=null);this.C=null;if("undefined"===typeof a||!0===a)if(!0===this.ja){a=this.i.i18n.locales;for(var b,d=0,h=a.length;d<h;d++)b=this.O+"_"+a[d],this.i.cache.remove(C.IMAGE,b)}else this.i.cache.remove(C.IMAGE,this.O);T.prototype.destroy.call(this)}};
Object.defineProperty(H.prototype,"loaded",{get:function(){return this.T}});Object.defineProperty(H.prototype,"element",{get:function(){return this.C}});Object.defineProperty(H.prototype,"frame",{get:function(){return this.f},set:function(a){vd(this,a)}});Object.defineProperty(H.prototype,"frames",{get:function(){return this.ia}});Object.defineProperty(H.prototype,"originalWidth",{get:function(){if(this.C)return this.C.naturalWidth}});Object.defineProperty(H.prototype,"originalHeight",{get:function(){if(this.C)return this.C.naturalHeight}});
Object.defineProperty(H.prototype,"onLoadStart",{get:function(){this.V||(this.V=new q(this));return this.V}});Object.defineProperty(H.prototype,"onLoadComplete",{get:function(){this.L||(this.L=new q(this));return this.L}});function Rb(a,b){this.sa=this.ra=1;this.J=null;H.call(this,a,b,"ImageScalable");this.La()}Rb.prototype=Object.create(H.prototype);e=Rb.prototype;e.constructor=Rb;e.La=function(){this.warn(this.fb+" test both render modes");this.H=sd.Zb;H.prototype.La.call(this)};
e.$d=function(a){var b=a.data;this.J=new Ca(b.naturalWidth,b.naturalHeight);H.prototype.$d.call(this,a)};
e.qd=function(a){this.log(a);this.H!==sd.Zb?this.warn("Invalid render mode for "+this.fb):this.C&&!1!==this.da&&(this.u=this.j.width=this.J.width*this.ra,this.c.style.width=this.j.width+"px",this.o=this.j.height=this.J.height*this.sa,this.c.style.height=this.j.height+"px",a=this.j.getContext("2d"),a.clearRect(0,0,this.j.width,this.j.height),a.drawImage(this.C,0,0,this.J.width,this.J.height,0,0,this.j.width,this.j.height))};e.destroy=function(){this.J=null;H.prototype.destroy.call(this)};
Object.defineProperty(Rb.prototype,"scaleWidth",{get:function(){return this.ra},set:function(a){a=Math.max(Number.EPSILON,a);this.ra!==a&&(this.ra=a,this.qd(this.frame))}});Object.defineProperty(Rb.prototype,"scaleHeight",{get:function(){return this.sa},set:function(a){a=Math.max(Number.EPSILON,a);this.sa!==a&&(this.sa=a,this.qd(this.frame))}});function Rc(a,b){this.J=null;H.call(this,a,b,"Sprite")}Rc.prototype=Object.create(H.prototype);e=Rc.prototype;e.constructor=Rc;
e.La=function(){this.H=sd.Zb;H.prototype.La.call(this);this.J=new xd(this);this.i.display.register(this,!0)};e.play=function(a,b,d){this.J.play(a,b,d)};e.pause=function(a){this.J.pause(a)};e.resume=function(a){this.J.resume(a)};e.stop=function(){this.J.stop()};e.update=function(){this.J.update()};e.destroy=function(){!1!==this.yb&&(this.J.destroy(),this.J=null,H.prototype.destroy.call(this))};Object.defineProperty(Rc.prototype,"animations",{get:function(){return this.J}});
Object.defineProperty(Rc.prototype,"animation",{get:function(){return this.J.currentAnimation}});function yd(a,b){this.f=null;this.aa=b||null;this.j="";this.O=!1;this.C="";this.V=this.L=null;this.T=!1;this.H=this.J=null;T.call(this,a,null,"Iframe")}yd.prototype=Object.create(T.prototype);e=yd.prototype;e.constructor=yd;
e.La=function(){T.prototype.La.call(this);this.V=this.Dm.bind(this);this.f=document.createElement("iframe");this.f.style.width="100%";this.f.style.height="100%";this.f.style.border=0;this.f.style.overflow="hidden";this.f.addEventListener("load",this.V,!!this&&!!this);this.f.setAttribute("allowFullScreen","");this.c.appendChild(this.f);null!==this.aa&&this.load(this.aa);this.i.display.register(this);ld(this);md(this)};
e.Ze=function(){this.log("_localeChangeComplete");!0===this.i.i18n.Mb(this.C)&&zd(this,this.L.value)};function zd(a,b){a.log("_loadIframe url: "+b);a.T=!1;a.J&&a.J.F();a.j=b;a.f.src=a.j}e.Dm=function(){""!==this.j&&(this.log("_loadCompleteHandler url: "+this.j),this.T=!0,this.H&&this.H.F())};function Ad(a){!1===a.i.i18n.onLocaleChangeComplete.has(a.Ze,a)&&a.i.i18n.onLocaleChangeComplete.add(a.Ze,a)}
e.load=function(a){"object"===typeof a&&a?(this.O=a.i18n||!1,!0===this.O?(this.j="",this.C=a.url):this.j=a.url):(this.O=!1,this.j="","string"===typeof a&&(this.j=a));var b;!0===this.O&&"string"===typeof this.C&&""!==this.C?(this.L=new D(this.i,this.C),Ad(this),b=this.L.value):"string"===typeof this.j&&""!==this.j&&(b=this.j);"undefined"!==typeof b&&zd(this,b)};
e.destroy=function(){!1!==this.yb&&(this.L&&(this.L.destroy(),this.L=null,this.i.i18n.onLocaleChangeComplete.remove(this.Ze,this)),this.J&&(this.J.destroy(),this.J=null),this.H&&(this.H.destroy(),this.H=null),this.V=this.f=null,T.prototype.destroy.call(this))};
Object.defineProperty(yd.prototype,"i18nUrl",{get:function(){return this.C},set:function(a){if("string"===typeof a){this.O=!0;this.C=a;var b;""!==this.C&&(this.L=new D(this.i,this.C),Ad(this),b=this.L.value);"undefined"!==typeof b&&zd(this,b)}}});Object.defineProperty(yd.prototype,"url",{get:function(){return this.j},set:function(a){"string"===typeof a&&(this.O=!1,zd(this,a))}});Object.defineProperty(yd.prototype,"loaded",{get:function(){return this.T}});
Object.defineProperty(yd.prototype,"onLoadStart",{get:function(){this.J||(this.J=new q(this));return this.J}});Object.defineProperty(yd.prototype,"onLoadComplete",{get:function(){this.H||(this.H=new q(this));return this.H}});
function S(a,b){this.ja=b;this.H="";this.j=!1;this.J=null;this.aa="";this.ia="rgb(0, 0, 0)";this.T=this.V=!0;this.Ja=0;this.O=this.Ka=!1;this.da=null;this.Ya=!1;this.Ga=this.Ea=this.Fa=this.ya=this.xa=this.wa=this.va=this.Xa=this.Ta=this.Va=this.Ua=this.Sa=this.Qa="";this.na=this.pa=this.qa=this.f=this.Na=null;this.la=!1;this.C=this.L=null;T.call(this,a,null,"TextField")}S.prototype=Object.create(T.prototype);e=S.prototype;e.constructor=S;
e.La=function(){T.prototype.La.call(this);this.qa=this.rm.bind(this);this.pa=this.bm.bind(this);this.na=this.am.bind(this);this.Na=document.createElement("span");this.c.appendChild(this.Na);"undefined"!==typeof this.ja&&null!==this.ja&&this.load(this.ja);this.i.display.register(this);ld(this);md(this)};
e.za=function(a){var b=a.property;-1!==b.toLowerCase().indexOf("width")&&"autoWidth"!==b&&(this.V=!1);-1!==b.toLowerCase().indexOf("height")&&"autoHeight"!==b&&(this.T=!1);T.prototype.za.call(this,a)};e.zc=function(){Bd(this);T.prototype.zc.call(this)};function Cd(a,b){b!==a.aa&&(a.aa=String(b),a.Na.innerHTML=b,Bd(a),nd(a),a.L&&a.L.F());if(!1===a.j||!0===a.j&&!0===a.J.loaded)a.la=!0,a.C&&a.C.F()}
function Bd(a){if(!1!==a.Ad()){if(!0===a.V){var b=a.pixelWidth;a.c.style.width="";var d=a.c.offsetWidth;0<d&&(d+=1);a.u=d;a.D="px";a.c.style.width=a.u+"px";b!==a.u&&a.za({property:"autoWidth"})}!0===a.T&&(b=a.pixelHeight,a.c.style.height="",d=a.c.offsetHeight,0<d&&(d+=1),a.o=d,a.B="px",a.c.style.height=a.o+"px",b!==a.o&&a.za({property:"autoHeight"}))}}function Dd(a){a.J||(a.J=new D(a.i,a.H));Cd(a,a.J.value)}
function Ed(a){!1===a.i.i18n.onLocaleChangeComplete.has(a.hf,a)&&a.i.i18n.onLocaleChangeComplete.add(a.hf,a)}e.hf=function(){this.log("_localeChangeComplete");!0===this.i.i18n.Mb(this.H)&&(this.value=this.J.value)};
e.rm=function(){!0!==this.O||this.f||(this.f=document.createElement("textarea"),this.f.style.position="absolute",this.f.style.top="0px",this.f.style.left="0px",this.f.style.width="100%",this.f.style.height="100%",this.f.style.resize="none",this.f.style.margin="0px",this.f.style.padding="0px",this.f.style.overflowX="hidden",this.f.style.overflowY="auto",this.f.style.boxSizing="border-box",this.f.value=this.aa,this.f.addEventListener("input",this.pa,!1),this.f.addEventListener("blur",this.na,!1),this.c.appendChild(this.f),
this.f.focus())};e.bm=function(){Cd(this,this.f.value)};e.am=function(){this.Nf()};e.Nf=function(){this.f&&(this.f.removeEventListener("input",this.pa,!1),this.f.removeEventListener("blur",this.na,!1),this.c.removeChild(this.f),this.f=null)};
e.load=function(a){this.la=!1;"object"===typeof a&&a?(a.color&&(this.color=a.color),a.font&&(this.font=a.font),a.fontFamily&&(this.fontFamily=a.fontFamily),a.fontWeight&&(this.fontWeight=a.fontWeight),a.fontSize&&(this.fontSize=a.fontSize),a.fontStyle&&(this.fontStyle=a.fontStyle),a.fontVariant&&(this.fontVariant=a.fontVariant),a.textAlign&&(this.textAlign=a.textAlign),a.textShadow&&(this.textShadow=a.textShadow),a.textDecoration&&(this.textDecoration=a.textDecoration),a.textOverflow&&(this.textOverflow=
a.textOverflow),a.textTransform&&(this.textTransform=a.textTransform),a.whiteSpace&&(this.whiteSpace=a.whiteSpace),a.wordWrap&&(this.wordWrap=a.wordWrap),a.lineHeight&&(this.lineHeight=a.lineHeight),a.autoWidth&&(this.autoWidth=a.autoWidth),a.autoHeight&&(this.autoHeight=a.autoHeight),a.padding&&(this.padding=a.padding),a.selectable&&(this.selectable=a.selectable),a.editable&&(this.editable=a.editable),this.j=a.i18n||!1,!0===this.j?this.H=a.value:this.value=a.value):"string"===typeof a&&(this.j=!1,
this.value=a);!0===this.j&&"string"===typeof this.H&&""!==this.H&&(Dd(this),Ed(this))};e.destroy=function(){!1!==this.yb&&(this.J&&(this.J.destroy(),this.J=null,this.i.i18n.onLocaleChangeComplete.remove(this.hf,this)),this.Nf(),this.C&&(this.C.destroy(),this.C=null),this.L&&(this.L.destroy(),this.L=null),T.prototype.destroy.call(this))};Object.defineProperty(S.prototype,"i18nValue",{get:function(){return this.H},set:function(a){"string"===typeof a&&(""===this.H&&Ed(this),this.j=!0,this.H=a,Dd(this))}});
Object.defineProperty(S.prototype,"i18n",{get:function(){return this.j}});Object.defineProperty(S.prototype,"value",{get:function(){return this.aa},set:function(a){if("string"===typeof a||"number"===typeof a)this.j=!1,Cd(this,a)}});Object.defineProperty(S.prototype,"color",{get:function(){return this.ia},set:function(a){"string"===typeof a&&(this.ia=a,this.c.style.color=this.ia)}});
Object.defineProperty(S.prototype,"font",{get:function(){return this.va},set:function(a){"string"!==typeof a||2>a.split(" ").toString().length||(this.va=a.replace(/"/g,'"'),this.c.style.font=this.va)}});Object.defineProperty(S.prototype,"fontFamily",{get:function(){return this.wa},set:function(a){"string"===typeof a&&(this.wa=a.replace(/"/g,'"'),this.c.style.fontFamily=this.wa,Bd(this))}});
Object.defineProperty(S.prototype,"fontSize",{get:function(){return this.xa},set:function(a){if("number"===typeof a||"string"===typeof a)"number"===typeof a&&(a+="px"),this.xa=a,this.c.style.fontSize=this.xa}});Object.defineProperty(S.prototype,"fontStyle",{get:function(){return this.ya},set:function(a){"string"===typeof a&&(this.ya=a,this.c.style.fontStyle=this.ya)}});
Object.defineProperty(S.prototype,"fontWeight",{get:function(){return this.Fa},set:function(a){"string"===typeof a&&"number"===typeof a&&(this.Fa=a,this.c.style.fontWeight=this.Fa)}});Object.defineProperty(S.prototype,"fontVariant",{get:function(){return this.Ea},set:function(a){"string"===typeof a&&(this.Ea=a,this.c.style.fontVariant=this.Ea)}});
Object.defineProperty(S.prototype,"lineHeight",{get:function(){return this.Ga},set:function(a){if("number"===typeof a||"string"===typeof a)"number"===typeof a&&(a+="px"),this.Ga=a,this.c.style.lineHeight=this.Ga}});Object.defineProperty(S.prototype,"textAlign",{get:function(){return this.Qa},set:function(a){"string"===typeof a&&(this.Qa=a,this.c.style.textAlign=this.Qa)}});
Object.defineProperty(S.prototype,"textShadow",{get:function(){return this.Ua},set:function(a){"string"===typeof a&&(this.Ua=a,this.c.style.textShadow=this.Ua)}});Object.defineProperty(S.prototype,"textDecoration",{get:function(){return this.Sa},set:function(a){"string"===typeof a&&(this.Sa=a,this.c.style.textDecoration=this.Sa)}});Object.defineProperty(S.prototype,"textTransform",{get:function(){return this.Va},set:function(a){"string"===typeof a&&(this.Va=a,this.c.style.textTransform=this.Va)}});
Object.defineProperty(S.prototype,"autoWidth",{get:function(){return this.V},set:function(a){"boolean"===typeof a&&(this.V=a,Bd(this))}});Object.defineProperty(S.prototype,"autoHeight",{get:function(){return this.T},set:function(a){"boolean"===typeof a&&(this.T=a,Bd(this))}});
Object.defineProperty(S.prototype,"padding",{get:function(){return this.Ja},set:function(a){if("number"===typeof a||"string"===typeof a)this.Ja=a="string"===typeof a?a.split(" ",4).toString().replace(/,/g," "):a+"px",this.c.style.padding=this.Ja}});
Object.defineProperty(S.prototype,"selectable",{get:function(){return this.Ka},set:function(a){"boolean"===typeof a&&(this.Ka=a,!1===this.Ka?(!1===this.O&&!0===this.cb&&(this.cb=this.pointer.enabled=!1),this.c.style.R="none",this.c.style.webkitUserSelect="none",this.c.style.c="none",this.c.style.f="none",this.c.style.j="none"):(!1===this.pointer.enabled&&(this.cb=this.pointer.enabled=!0),this.c.style.R="text",this.c.style.webkitUserSelect="text",this.c.style.c="text",this.c.style.f="text",this.c.style.j=
"inherit"))}});Object.defineProperty(S.prototype,"wordWrap",{get:function(){return this.Ya},set:function(a){"boolean"===typeof a&&(this.Ya=a,this.c.style.wordWrap=!1===this.Ya?"normal":"break-word")}});Object.defineProperty(S.prototype,"whiteSpace",{get:function(){return this.Xa},set:function(a){"string"===typeof a&&(this.Xa=a,this.c.style.whiteSpace=this.Xa)}});
Object.defineProperty(S.prototype,"textOverflow",{get:function(){return this.Ta},set:function(a){"string"===typeof a&&(this.Ta=a,this.c.style.textOverflow=this.Ta)}});
Object.defineProperty(S.prototype,"editable",{get:function(){return this.O},set:function(a){a=!!a;this.O!==a&&(this.O=a,!1===this.O?(this.c.removeEventListener("click",this.qa,!!this&&!!this),this.i.keyboard.He(this.da),this.da=null,this.pointer.enabled=!0,this.c.style.cursor="text"):(this.c.addEventListener("click",this.qa,!!this&&!!this),this.da=new M(this.i,[13,27],this.Nf,null,null,null,this),this.i.keyboard.Wf(this.da),this.c.style.cursor="default"))}});
Object.defineProperty(S.prototype,"loaded",{get:function(){return this.la}});Object.defineProperty(S.prototype,"onLoadComplete",{get:function(){this.C||(this.C=new q(this));return this.C}});Object.defineProperty(S.prototype,"onValueChange",{get:function(){this.L||(this.L=new q(this));return this.L}});function Sc(a,b){this.la=b||null;this.H={};this.da=this.J=this.T="";this.j=this.L=null;this.V=this.aa=!1;this.ia=0;v.call(this,a,null,"Button")}Sc.prototype=Object.create(v.prototype);
Sc.prototype.constructor=Sc;var Fd={Nb:"out",yc:"over",lh:"down"};e=Sc.prototype;
e.La=function(){v.prototype.La.call(this);this.J=Fd.Nb;this.L=new H(this.i);this.L.onLoadComplete.add(this.Yd,this);this.L.onResize.add(this.Zd,this);this.mc(this.L);this.j=new S(this.i);this.j.onLoadComplete.add(this.Yd,this);this.j.onResize.add(this.Zd,this);this.j.autoWidth=!0;this.j.autoHeight=!0;this.mc(this.j);this.pointer.enabled=!0;this.pointer.cursor=gd.kb;this.pointer.onEnter.add(this.Jm,this);this.pointer.onLeave.add(this.Km,this);this.pointer.onPressStart.add(this.Wk,this);this.pointer.onPressEnd.add(this.Vk,
this);this.i.display.register(this);ld(this);md(this);this.i.i18n.onLocaleChangeComplete.add(this.nh,this);this.load(this.la)};e.Jm=function(){Gd(this,Fd.yc)};e.Km=function(){Gd(this,Fd.Nb)};e.Wk=function(){Gd(this,Fd.lh)};e.Vk=function(){Gd(this,Fd.yc)};e.nh=function(){Gd(this,this.J)};e.Yd=function(a){this.log("_itemLoadComplete "+a.emitter.className);this.ia++;2===this.ia&&(this.log("_allItemsLoaded"),Hd(this),Id(this))};e.Zd=function(){Hd(this);Id(this)};function Jd(a,b){a.T=b;Gd(a,a.J)}
function Gd(a,b){a.J=b;b=a.H[a.T];a.ia=0;var d=b.ek(a.J);a.background=b.$a("background",a.J);a.borderStyle=b.$a("borderStyle",a.J);a.borderColor=b.$a("borderColor",a.J);a.borderRadius=b.$a("borderRadius",a.J);a.borderWidth=b.$a("borderWidth",a.J);a.aa=b.$a("autoWidth",a.J);a.V=b.$a("autoHeight",a.J);var h=b.$a("label",a.J);"undefined"!==typeof h&&a.j.load(h);!0===d&&a.L.load(b.$a("image",a.J))}
function Hd(a){a.log("_updateLayout");var b=a.H[a.T],d=b.$a("align",a.J),h=b.$a("padding",a.J),k=b.$a("spacing",a.J);"label"===b.$a("first",a.J)?(b=a.j,a=a.L):(b=a.L,a=a.j);switch(d){case "left":b.left=h;b.verticalCenter=!0;a.left=b.left+k+b.pixelWidth;a.verticalCenter=!0;break;case "right":b.right=h;b.verticalCenter=!0;a.right=b.right+k+b.pixelWidth;a.verticalCenter=!0;break;case "top":b.top=h;b.horizontalCenter=!0;a.top=b.top+b.pixelHeight+k;a.horizontalCenter=!0;break;case "bottom":b.bottom=h;
b.horizontalCenter=!0;a.bottom=b.bottom+k+b.pixelHeight;a.horizontalCenter=!0;break;default:b.horizontalCenter=!0,b.verticalCenter=!0,a.horizontalCenter=!0,a.verticalCenter=!0}}
function Id(a){a.log("_updateAutoSize");if(!1!==a.aa||!1!==a.V){var b=a.H[a.T].$a("padding",a.J);if(!0===a.aa){var d=a.pixelWidth;a.u=Math.max(a.j.x+a.j.pixelWidth,a.L.x+a.L.pixelWidth)-Math.min(a.j.x,a.L.x)+2*b+2*a.P;a.D="px";a.c.style.width=a.u+"px";d!==a.pixelWidth&&a.za({property:"autoWidth"})}!0===a.V&&(d=a.pixelHeight,a.o=Math.max(a.j.y+a.j.pixelHeight,a.L.y+a.L.pixelHeight)-Math.min(a.j.y,a.L.y)+2*b+2*a.P,a.B="px",a.c.style.height=a.o+"px",d!==a.pixelHeight&&a.za({property:"autoHeight"}))}}
e.load=function(a){if("undefined"!==typeof a&&a){if(!0===g.K.Pa(a.skins,"ButtonSkin"))for(var b=0,d=a.skins.length;b<d;b++)this.Bc(a.skins[b]);else if("object"===typeof a.skins&&0<a.skins.length)for(var d=0,h=a.skins.length;d<h;d++)b=new X(a.skins[d].name,a.skins[d].states),this.Bc(b);g.K.W(a.skin,"ButtonSkin")?this.Bc(a.skin):"object"===typeof a.skin&&(b=new X(a.skin.name,a.skin.states),this.Bc(b));!0===g.K.W(a["default"],"string")&&!0===this.fk(a["default"])&&(this.da=a["default"])}a=this.H||{};
Object.keys(a).length||(b=new X("default"),this.Bc(b));""===this.da&&(this.da=this.H[Object.keys(a)[0]].name);Jd(this,this.da)};e.Bc=function(a,b){if(!1===g.K.W(a,"ButtonSkin"))throw"FORGE.Button: Invalid button skin!";a.Mg(Fd.Nb);this.H[a.name]=a;!0===b&&Jd(this,a.name)};e.Ik=function(a){"string"===typeof a&&!0===g.K.W(this.H[a],"ButtonSkin")?Jd(this,a):!0===g.K.W(a,"ButtonSkin")&&(this.H[a.name]===a?Jd(this,a.name):"undefined"!==typeof this.H[a.name]&&null!==this.H[a.name]||this.Bc(a,!0))};
e.fk=function(a){return"undefined"!==typeof this.H[a]};e.yo=function(){this.H[this.T].Mg(Fd.Nb);Jd(this,this.T)};
e.destroy=function(){this.i.i18n.onLocaleChangeComplete.remove(this.nh,this);if("undefined"!==typeof this.H&&0<this.H.length)for(var a in this.H)this.H.hasOwnProperty(a)&&this.H[a].destroy();this.H={};this.L&&(this.L.onLoadComplete.remove(this.Yd,this),this.L.onResize.remove(this.Zd,this),this.removeChild(this.L,!0),this.L=null);this.j&&(this.j.onLoadComplete.remove(this.Yd,this),this.j.onResize.remove(this.Zd,this),this.removeChild(this.j,!0),this.j=null);v.prototype.destroy.call(this)};
Object.defineProperty(Sc.prototype,"skins",{get:function(){return this.H}});Object.defineProperty(Sc.prototype,"skin",{get:function(){return this.H[this.T]},set:function(a){this.Ik(a)}});Object.defineProperty(Sc.prototype,"autoWidth",{get:function(){return this.aa},set:function(a){"boolean"===typeof a&&(this.aa=a,Id(this))}});Object.defineProperty(Sc.prototype,"autoHeight",{get:function(){return this.V},set:function(a){"boolean"===typeof a&&(this.V=a,Id(this))}});
function X(a,b){this.j=a||"";this.f=g.K.Cc(Kd,{});this.c=g.K.Cc(b||{},{out:{},over:{},down:{}});n.call(this,"ButtonSkin")}X.prototype=Object.create(n.prototype);X.prototype.constructor=X;
var Ld={key:"",url:"",i18n:!1,keepRatio:!0,maximized:!1,alpha:1},Md={value:"",i18n:!1,color:"",fontFamily:"",fontWeight:""},Nd={name:"",background:"",borderStyle:"solid",borderColor:"",borderRadius:0,borderWidth:0,autoWidth:!0,autoHeight:!0,align:"center",padding:0,spacing:0,first:"image",image:Ld,label:Md},Od={key:"",url:"",i18n:!1,keepRatio:!0,maximized:!1,alpha:1},Pd={value:"Button",i18n:!1,color:"",fontFamily:"",fontWeight:""},Kd={name:"default",background:"#eee",borderStyle:"solid",borderColor:"#555",
borderRadius:5,borderWidth:2,autoWidth:!0,autoHeight:!0,align:"left",padding:5,spacing:0,first:"image",image:Od,label:Pd};X.prototype.Mg=function(a){"undefined"!==typeof this.c[a]&&(this.f=this.c[a])};X.prototype.$a=function(a,b){b=g.K.re(this.c,b+"."+a,g.K.re(this.f,a,g.K.re(Nd,a)));"object"===typeof b&&(b=g.K.Cc(this.f[a],b));return b};X.prototype.ek=function(a){a=this.$a("image",a);return"undefined"!==typeof a&&"string"===typeof a.url&&""!==a.url};
X.prototype.m=function(a){a=this.$a("label",a);return"undefined"!==typeof a&&"string"===typeof a.value&&""!==a.value};Object.defineProperty(X.prototype,"name",{get:function(){return this.j}});Object.defineProperty(X.prototype,"default",{get:function(){return this.f},set:function(a){this.f=a}});Object.defineProperty(X.prototype,"out",{get:function(){return this.c.out},set:function(a){this.c.out=a}});
Object.defineProperty(X.prototype,"over",{get:function(){return this.c.over},set:function(a){this.c.over=a}});Object.defineProperty(X.prototype,"down",{get:function(){return this.c.down},set:function(a){this.c.down=a}});function fa(a){T.call(this,a,document.createElement("canvas"),"Canvas")}fa.prototype=Object.create(T.prototype);fa.prototype.constructor=fa;fa.prototype.La=function(){T.prototype.La.call(this);this.i.display.register(this);ld(this);md(this)};
Object.defineProperty(fa.prototype,"context2D",{get:function(){return this.c.getContext("2d")}});Object.defineProperty(fa.prototype,"context3D",{get:function(){return this.c.getContext("webgl")}});Object.defineProperty(fa.prototype,"element",{get:function(){return this.c}});
function J(a,b,d,h,k){this.i=a;this.hd=b;this.qc=d||null;this.H=null;this.dd=h||g.Ha.Xb;this.ib="";this.L=null;this.J=this.C=-1;this.Ya=null;this.Fb=!1;this.wb=null;this.rc=!1;this.vb=1;this.cb=!1;this.Jc=0;this.Vb=null;this.Tb=k||!1;this.$c=[0,1,2,3];this.Ic=!1;this.Ka=this.aa=this.Ga=this.Ja=this.Na=this.Ua=this.wa=this.Ea=this.Sa=this.Xa=this.na=this.la=this.Qa=this.Va=this.O=this.Ta=this.xa=this.ya=this.ia=this.da=this.ja=this.Fa=this.qa=this.va=this.pa=null;this.Ub=this.T=!1;this.Hc=this.Kc=
0;this.tc=this.uc=this.j=this.Wb=this.Gb=this.Lb=this.Hb=this.Jb=this.Kb=this.Ib=this.V=null;T.call(this,a,null,"VideoHTML5")}J.prototype=Object.create(T.prototype);e=J.prototype;e.constructor=J;
e.La=function(){T.prototype.La.call(this);!0===this.Tb&&!1===Qd(this)&&(this.log("FORGE.VideoHTML5: can't manage ambisonic sound without Google Chrome Omnitone library and WebAudio API."),this.Tb=!1);this.R=this.hd;aa(this);this.V=this.$m.bind(this);this.Ib=this.an.bind(this);this.Kb=this.cn.bind(this);this.Jb=this.bn.bind(this);this.Hb=this.Zm.bind(this);this.Lb=this.dn.bind(this);this.Gb=this.Ym.bind(this);this.Wb=this.en.bind(this);this.j=this.Pm.bind(this);this.Ya=this.i.clock.create(!1);this.wb=
this.i.clock.create(!1);this.wb.jf(500,this.$l,this);this.i.audio.onVolumeChange.add(this.li,this);this.i.audio.onDisable.add(this.ki,this);this.aa=new q(this,!0);null!==this.qc&&this.load(this.qc);this.i.display.register(this,Qd(this));ld(this);md(this)};e.za=function(a){var b=Rd(this);b&&null!==b.element&&(b.element.setAttribute("width",this.pixelWidth),b.element.setAttribute("height",this.pixelHeight));T.prototype.za.call(this,a)};
function Sd(a,b){for(var d,h=0,k=a.L.length;h<k;h++)if(d=a.L[h],d===b)return h;return-1}function Td(a,b){return a.L?(a=a.L[b])&&"undefined"!==typeof a?a:null:null}function Ud(a){return Td(a,a.C)}function Rd(a){return Td(a,a.J)}function Vd(a,b){return(a=Rd(a))&&null!==a.element?a.element[b]:0}
function Wd(a,b){if(-1!==b){a.log("_destroyVideoAt "+b);b=a.L[b];var d=b.element;if("undefined"!==typeof d&&null!==d){d.removeEventListener("loadstart",a.j,!1);d.removeEventListener("durationchange",a.j,!1);d.removeEventListener("loadedmetadata",a.j,!1);d.removeEventListener("loadeddata",a.j,!1);d.removeEventListener("progress",a.j,!1);d.removeEventListener("canplay",a.j,!1);d.removeEventListener("canplaythrough",a.j,!1);d.removeEventListener("play",a.j,!1);d.removeEventListener("pause",a.j,!1);d.removeEventListener("timeupdate",
a.j,!1);d.removeEventListener("volumechange",a.j,!1);d.removeEventListener("seeked",a.j,!1);d.removeEventListener("ended",a.j,!1);d.removeEventListener("error",a.j,!1);d.removeEventListener("waiting",a.j,!1);d.removeEventListener("stalled",a.j,!1);d.removeEventListener("playing",a.j,!1);d.removeEventListener("error",a.V,!1);d.pause();d.src="";for(var h,k=0,l=d.children.length;k<l;k++)h=d.children[k],h.removeEventListener("error",a.V,!1),h.src="",d.removeChild(h);d.load();d.parentNode===a.c&&a.c.removeChild(d)}b.element=
null;null!==b.buffer&&(b.buffer.destroy(),b.buffer=null);null!==b.played&&(b.played.destroy(),b.played=null)}}
function Xd(a,b,d){a.Fb=d||!1;a.log("Requesting index: "+b+", force: "+a.Fb);-1!==a.C&&a.C!==b&&Yd(a);d=b===a.C?!0:!1;a.C=b;a.Na&&a.Na.F(b);if(b!==a.J&&!0!==d){d=a.C;var h=document.createElement("video");h.setAttribute("webkit-playsinline","webkit-playsinline");h.setAttribute("width",a.pixelWidth);h.setAttribute("height",a.pixelHeight);h.volume=0;h.crossOrigin="anonymous";h.id="FORGE-VideoHTML5-"+a.R+"-"+d;var k=new Zd(h,"buffered"),l=new Zd(h,"played");d=a.L[d];d.element=h;d.buffer=k;d.played=l;
d.lastTimeStamp=0;d.requestCount++;h=a.H[a.C];-1<a.J&&(d.element.addEventListener("loadstart",a.Ib,!1),d.element.addEventListener("error",a.V,!1));k=document.createElement("source");k.addEventListener("error",a.V,!1);k.src=h.url;k.type=h.mimeType;d.element.appendChild(k);a.uc=a.Ii.bind(a);!0===Qd(a)?(a.f=a.i.audio.context,a.Vb=Omnitone.createFOADecoder(a.f,d.element,{channelMap:a.$c}),a.tc=a.tm.bind(a),a.Vb.initialize().then(a.uc,a.tc)):a.Ii();-1===a.J?(a.log("No current video, set directly the current index"),
$d(a,b)):(a.Ya.add(2E4,a.sn,a),a.Ya.start())}}e.Ii=function(){-1===this.C?Rd(this).element.load():Ud(this).element.load()};e.tm=function(){this.log("FOA decoder could not be initialized")};e.an=function(){var a=Ud(this).element;this.log("_onRequestLoadStart [readyState: "+a.readyState+"]");a.removeEventListener("loadstart",this.Ib,!1);a.addEventListener("loadedmetadata",this.Kb,!1)};
e.cn=function(){var a=Ud(this).element;this.log("_onRequestLoadedMetaData [readyState: "+a.readyState+"]");a.removeEventListener("loadedmetadata",this.Kb,!1);a.addEventListener("loadeddata",this.Jb,!1)};e.bn=function(){var a=Ud(this).element;this.log("_onRequestLoadedData [readyState: "+a.readyState+"]");a.removeEventListener("loadeddata",this.Jb,!1);!0===g.A.Vc?(a.addEventListener("play",this.Hb,!1),a.play()):$d(this,this.C,!0)};
e.Zm=function(){var a=Ud(this).element;this.log("_onRequestCanPlayBeforeSeek [readyState: "+a.readyState+"]");a.pause();a.removeEventListener("play",this.Hb,!1);a.addEventListener("seeked",this.Lb,!1);var b=this.currentTime;a.currentTime=!0===this.T&&!1===this.Fb?b+6:b};
e.dn=function(){var a=Ud(this).element;this.log("_onRequestSeeked [readyState: "+a.readyState+"]");a.removeEventListener("seeked",this.Lb,!1);4===a.readyState?(a.removeEventListener("error",this.V,!1),ae(this)):a.addEventListener("canplay",this.Gb,!1)};e.Ym=function(){var a=Ud(this).element;this.log("_onRequestCanPlayAfterSeek [readyState: "+a.readyState+"]");a.removeEventListener("canplay",this.Gb,!1);a.removeEventListener("error",this.V,!1);ae(this)};
function ae(a){var b=Rd(a);b&&null!==b.element&&!1===a.Fb&&(a.log("Current video listen to seek, wait both video to sync"),b.element.addEventListener("seeked",a.Wb,!1),a.Ya.jf(10,a.An,a));for(var b=Ud(a).element,d,h=0,k=b.children.length;h<k;h++)d=b.children[h],d.removeEventListener("error",a.V,!1);!0===a.Fb&&$d(a,a.C)}e.en=function(){this.log("_onRequestSeekedWhileSync "+this.currentTime);var a=this.C;be(this,!1);Xd(this,a)};
e.An=function(){this.log("_videoSyncTimerLoop "+this.C);var a=Ud(this);a&&this.currentTime>=a.element.currentTime&&this.currentTime<a.element.currentTime+.05&&$d(this,this.C)};e.sn=function(){this.log("_requestTimeOutHandler");be(this,!0)};e.$m=function(a){this.log("_onRequestError");this.log(a);be(this,!0)};
function $d(a,b,d){if(b!==a.J){a.c.innerHTML="";var h=Ud(a);!0===a.T&&h.element.play();ce(a,h);h=Rd(a);a.C=-1;a.J=b;b=Rd(a);b.currentCount++;!0===d&&h&&(b.element.currentTime=h.element.currentTime);d=b.element;d.addEventListener("loadstart",a.j,!1);d.addEventListener("durationchange",a.j,!1);d.addEventListener("loadedmetadata",a.j,!1);d.addEventListener("loadeddata",a.j,!1);d.addEventListener("progress",a.j,!1);d.addEventListener("canplay",a.j,!1);d.addEventListener("canplaythrough",a.j,!1);d.addEventListener("play",
a.j,!1);d.addEventListener("pause",a.j,!1);d.addEventListener("timeupdate",a.j,!1);d.addEventListener("volumechange",a.j,!1);d.addEventListener("seeked",a.j,!1);d.addEventListener("ended",a.j,!1);d.addEventListener("error",a.j,!1);d.addEventListener("waiting",a.j,!1);d.addEventListener("stalled",a.j,!1);d.addEventListener("playing",a.j,!1);a.c.appendChild(b.element);h&&null!==h.element&&(h.element.removeEventListener("seeked",a.Wb,!1),d=Sd(a,h),-1!==d&&Wd(a,d));a.Ya.stop(!0);a.Ja&&a.Ja.F(a.J);""===
a.ib&&de(a,a.dd)}}
e.$l=function(){this.log("Auto quality timer loop");if(!1!==this.T&&-1===this.C){var a;a=Rd(this);var b=a.element.currentTime;!1===a.element.playing?a=!1:b===a.lastTimeStamp?(a.lastTimeStamp=0,a=!0):(a.lastTimeStamp=b,a=!1);!0===a?(this.log("AutoQuality downgrade quality"),Rd(this).leaveCount++,0<=this.J-1?Xd(this,this.J-1,!0):this.log("Can't downgrade video quality anymore!")):(a=Rd(this),!0===(a&&null!==a.buffer&&a.buffer.qk(a.element.currentTime,6)?!0:!1)&&this.J!==this.H.length-1&&(a=this.J+1,
this.L[a].abortCount||this.L[a].leaveCount?this.log("AutoQuality do not attempt to load an already aborted video"):(this.log("AutoQuality upgrade quality"),Xd(this,a))))}};function de(a,b){!1===g.A.Vc&&(b=g.Ha.MANUAL,a.warn("Quality mode force to manual, you are not on desktop"));a.ib===b||b!==g.Ha.Xb&&b!==g.Ha.MANUAL||(a.ib=b,a.wb.stop(!1),a.ib===g.Ha.Xb&&a.wb.start(),a.Ka&&a.Ka.F(a.ib))}function be(a,b){var d=Ud(a);d&&(!0===b&&d.abortCount++,Yd(a),a.Ya.stop(!0),a.Ga&&a.Ga.F())}
function Yd(a){var b=Ud(a),d;b&&(d=b.element,d.removeEventListener("loadstart",a.Ib,!1),d.removeEventListener("loadedmetadata",a.Kb,!1),d.removeEventListener("loadeddata",a.Jb,!1),d.removeEventListener("play",a.Hb,!1),d.removeEventListener("seeked",a.Lb,!1),d.removeEventListener("canplay",a.Gb,!1),d.removeEventListener("error",a.V,!1),b=Sd(a,b),-1!==b&&Wd(a,b),a.C=-1)}e.li=function(){ce(this)};
function ce(a,b){(b=b||Rd(a))&&null!==b.element&&!0===a.i.audio.enabled&&(b.element.volume=a.vb*a.i.audio.volume)}e.ki=function(){var a=Rd(this);a&&null!==a.element&&!1===this.i.audio.enabled&&(a.element.volume=0)};
e.Pm=function(a){var b=Rd(this).element;this.log(a.type+" [readyState: "+b.readyState+"]");switch(a.type){case "loadstart":this.pa&&this.pa.F(a);break;case "durationchange":this.ja&&1===b.readyState&&this.ja.F(a);break;case "loadedmetadata":this.Ic=!0;this.va&&this.va.F(a);break;case "loadeddata":this.qa&&this.qa.F(a);break;case "progress":this.Fa&&this.Fa.F(a);break;case "canplay":this.Ub=!0;this.da&&this.da.F(a);break;case "canplaythrough":this.Ub=!0;this.ia&&this.ia.F(a);break;case "play":this.ya&&
this.ya.F(a);break;case "pause":this.T=!1;this.xa&&this.xa.F(a);break;case "timeupdate":this.Ta&&this.Ta.F(a);break;case "volumechange":this.Va&&0!==b.readyState&&this.Va.F(a);break;case "seeked":this.Ub=!1;this.Qa&&this.Qa.F(a);break;case "ended":this.T=!1;this.c.currentTime=0;this.Hc++;!0===this.rc&&this.play(0);this.la&&this.la.F(a);break;case "error":this.na&&this.na.F(a);break;case "waiting":this.Xa&&this.Xa.F(a);break;case "stalled":this.Sa&&this.Sa.F(a);break;case "playing":this.Ea&&this.Ea.F(a);
break;default:this.warn('The event "'+a.type+'" is not handled.')}};function Qd(a){return!0===a.Tb&&!0===a.i.audio.useWebAudio&&"undefined"!==typeof Omnitone}e.update=function(){this.Vb&&!0===this.T&&this.Vb.setRotationMatrixFromCamera(this.i.renderer.camera.modelViewInverse)};
e.load=function(a){if(null!==a)if(!0===g.K.W(a,"string")?a=[a]:!0===g.K.W(a,"VideoQuality")&&(a=[a]),!0===g.K.Pa(a,"string")){for(var b=[],d,h=0,k=a.length;h<k;h++)d=new ee(a[h]),b.push(d);this.H=b}else!0===g.K.Pa(a,"VideoQuality")&&(this.H=a);this.aa&&this.aa.F(this.H);if(!this.H||!this.H.length)throw"FORGE.VideoHTML5.load: Can't create video with no qualities set!";a=this.H.length;b=[];for(h=0;h<a;h++)d={index:h,element:null,buffer:null,played:null,requestCount:0,currentCount:0,abortCount:0,leaveCount:0,
lastTimeStamp:0},b[h]=d;this.L=b;Xd(this,0)};e.play=function(a,b){this.currentTime=a;this.loop=b;(a=Rd(this))&&null!==a.element&&(a.element.play(),this.T=!0,this.Kc++)};e.pause=function(){var a=Rd(this);a&&null!==a.element&&(a.element.pause(),this.T=!1)};e.stop=function(){var a=Rd(this);a&&null!==a.element&&(a.element.pause(),a.element.currentTime=0,this.T=!1)};e.Ol=function(){!0===this.T||!1===this.i.audio.enabled?this.pause():this.play()};
e.qb=function(){!0!==this.cb&&!1!==this.i.audio.enabled&&(this.cb=!0,this.Jc=this.vb,this.vb=0,ce(this),this.wa&&this.wa.F())};e.mi=function(a){!1!==this.cb&&(a="number"===typeof a?a:this.Jc,this.cb=!1,this.vb=g.Math.ca(a,0,1),ce(this),this.Ua&&this.Ua.F())};
e.destroy=function(){Yd(this);this.Ya.destroy();this.Ya=null;this.wb.destroy();this.wb=null;this.pa&&(this.pa.destroy(),this.pa=null);this.va&&(this.va.destroy(),this.va=null);this.qa&&(this.qa.destroy(),this.qa=null);this.Fa&&(this.Fa.destroy(),this.Fa=null);this.ja&&(this.ja.destroy(),this.ja=null);this.da&&(this.da.destroy(),this.da=null);this.ia&&(this.ia.destroy(),this.ia=null);this.ya&&(this.ya.destroy(),this.ya=null);this.xa&&(this.xa.destroy(),this.xa=null);this.Ta&&(this.Ta.destroy(),this.Ta=
null);this.O&&(this.O.destroy(),this.O=null);this.Va&&(this.Va.destroy(),this.Va=null);this.Qa&&(this.Qa.destroy(),this.Qa=null);this.la&&(this.la.destroy(),this.la=null);this.na&&(this.na.destroy(),this.na=null);this.Xa&&(this.Xa.destroy(),this.Xa=null);this.Sa&&(this.Sa.destroy(),this.Sa=null);this.Ea&&(this.Ea.destroy(),this.Ea=null);this.wa&&(this.wa.destroy(),this.wa=null);this.Ua&&(this.Ua.destroy(),this.Ua=null);this.Na&&(this.Na.destroy(),this.Na=null);this.Ja&&(this.Ja.destroy(),this.Ja=
null);this.Ga&&(this.Ga.destroy(),this.Ga=null);this.Ka&&(this.Ka.destroy(),this.Ka=null);this.aa&&(this.aa.destroy(),this.aa=null);for(var a=0,b=this.L.length;a<b;a++)Wd(this,a);this.j=this.Wb=this.Gb=this.Lb=this.Hb=this.Jb=this.Kb=this.Ib=this.V=this.tc=this.uc=null;this.i.audio.onVolumeChange.remove(this.li,this);this.i.audio.onDisable.remove(this.ki,this);this.L=this.H=this.qc=null;T.prototype.destroy.call(this)};
Object.defineProperty(J.prototype,"quality",{get:function(){return this.H[this.J]},set:function(a){if("number"===typeof a&&0<=a&&a<this.H.length)de(this,g.Ha.MANUAL),Xd(this,a);else if(!0===g.K.W(a,"VideoQuality")){a:{for(var b,d=0,h=this.H.length;d<h;d++)if(b=this.H[d],b===a){a=d;break a}a=-1}if(-1!==a)de(this,g.Ha.MANUAL),Xd(this,a);else throw"Unknown quality";}else throw"Video quality "+a+" out of bounds";}});
Object.defineProperty(J.prototype,"qualityMode",{get:function(){return this.ib},set:function(a){a!==g.Ha.Xb&&a!==g.Ha.MANUAL||de(this,a)}});Object.defineProperty(J.prototype,"qualities",{get:function(){return this.H}});Object.defineProperty(J.prototype,"requestIndex",{get:function(){return this.C}});Object.defineProperty(J.prototype,"currentIndex",{get:function(){return this.J}});Object.defineProperty(J.prototype,"videos",{get:function(){return this.L}});
Object.defineProperty(J.prototype,"element",{get:function(){var a=Rd(this);return a&&null!==a.element?a.element:null}});Object.defineProperty(J.prototype,"buffer",{get:function(){var a=Rd(this);return a&&null!==a.buffer?a.buffer:null}});Object.defineProperty(J.prototype,"played",{get:function(){var a=Rd(this);return a&&null!==a.played?a.played:null}});Object.defineProperty(J.prototype,"originalWidth",{get:function(){return Vd(this,"videoWidth")}});
Object.defineProperty(J.prototype,"originalHeight",{get:function(){return Vd(this,"videoHeight")}});Object.defineProperty(J.prototype,"currentTime",{get:function(){return Vd(this,"currentTime")},set:function(a){if("number"===typeof a){var b=Rd(this);b&&null!==b.element&&(b.element.currentTime=a,this.O&&this.O.F(a))}}});Object.defineProperty(J.prototype,"currentTimeMS",{get:function(){return 1E3*this.currentTime},set:function(a){this.currentTime=a/1E3}});
Object.defineProperty(J.prototype,"remainingTime",{get:function(){return this.duration-this.currentTime}});Object.defineProperty(J.prototype,"duration",{get:function(){return Vd(this,"duration")}});Object.defineProperty(J.prototype,"durationMS",{get:function(){return Math.round(1E3*this.duration)}});Object.defineProperty(J.prototype,"playing",{get:function(){return this.T}});Object.defineProperty(J.prototype,"playCount",{get:function(){return this.Kc}});
Object.defineProperty(J.prototype,"canPlay",{get:function(){return this.Ub}});Object.defineProperty(J.prototype,"endCount",{get:function(){return this.Hc}});Object.defineProperty(J.prototype,"metaDataLoaded",{get:function(){return this.Ic}});Object.defineProperty(J.prototype,"loop",{get:function(){return this.rc},set:function(a){"boolean"===typeof a&&(this.rc=a)}});
Object.defineProperty(J.prototype,"volume",{get:function(){return this.vb},set:function(a){"number"===typeof a&&(this.vb=g.Math.ca(a,0,1),this.cb=!1,ce(this))}});Object.defineProperty(J.prototype,"muted",{get:function(){return this.cb},set:function(a){!0===!!a?this.qb():this.mi()}});Object.defineProperty(J.prototype,"ambisonic",{get:function(){return this.Tb}});Object.defineProperty(J.prototype,"onLoadStart",{get:function(){this.pa||(this.pa=new q(this));return this.pa}});
Object.defineProperty(J.prototype,"onLoadedMetaData",{get:function(){this.va||(this.va=new q(this));return this.va}});Object.defineProperty(J.prototype,"onLoadedData",{get:function(){this.qa||(this.qa=new q(this));return this.qa}});Object.defineProperty(J.prototype,"onProgress",{get:function(){this.Fa||(this.Fa=new q(this));return this.Fa}});Object.defineProperty(J.prototype,"onDurationChange",{get:function(){this.ja||(this.ja=new q(this));return this.ja}});
Object.defineProperty(J.prototype,"onCanPlay",{get:function(){this.da||(this.da=new q(this));return this.da}});Object.defineProperty(J.prototype,"onCanPlayThrough",{get:function(){this.ia||(this.ia=new q(this));return this.ia}});Object.defineProperty(J.prototype,"onPlay",{get:function(){this.ya||(this.ya=new q(this));return this.ya}});Object.defineProperty(J.prototype,"onPause",{get:function(){this.xa||(this.xa=new q(this));return this.xa}});
Object.defineProperty(J.prototype,"onTimeUpdate",{get:function(){this.Ta||(this.Ta=new q(this));return this.Ta}});Object.defineProperty(J.prototype,"onCurrentTimeChange",{get:function(){this.O||(this.O=new q(this));return this.O}});Object.defineProperty(J.prototype,"onVolumeChange",{get:function(){this.Va||(this.Va=new q(this));return this.Va}});Object.defineProperty(J.prototype,"onSeeked",{get:function(){this.Qa||(this.Qa=new q(this));return this.Qa}});
Object.defineProperty(J.prototype,"onEnded",{get:function(){this.la||(this.la=new q(this));return this.la}});Object.defineProperty(J.prototype,"onError",{get:function(){this.na||(this.na=new q(this));return this.na}});Object.defineProperty(J.prototype,"onWaiting",{get:function(){this.Xa||(this.Xa=new q(this));return this.Xa}});Object.defineProperty(J.prototype,"onStalled",{get:function(){this.Sa||(this.Sa=new q(this));return this.Sa}});
Object.defineProperty(J.prototype,"onPlaying",{get:function(){this.Ea||(this.Ea=new q(this));return this.Ea}});Object.defineProperty(J.prototype,"onMute",{get:function(){this.wa||(this.wa=new q(this));return this.wa}});Object.defineProperty(J.prototype,"onUnmute",{get:function(){this.Ua||(this.Ua=new q(this));return this.Ua}});Object.defineProperty(J.prototype,"onQualityRequest",{get:function(){this.Na||(this.Na=new q(this));return this.Na}});
Object.defineProperty(J.prototype,"onQualityChange",{get:function(){this.Ja||(this.Ja=new q(this));return this.Ja}});Object.defineProperty(J.prototype,"onQualityAbort",{get:function(){this.Ga||(this.Ga=new q(this));return this.Ga}});Object.defineProperty(J.prototype,"onQualityModeChange",{get:function(){this.Ka||(this.Ka=new q(this));return this.Ka}});Object.defineProperty(J.prototype,"onQualitiesLoaded",{get:function(){this.aa||(this.aa=new q(this,!0));return this.aa}});
function I(a,b,d,h){this.i=a;this.Wl=b;this.dd=d||null;this.cb="";this.Na=null;this.Vl=h||g.Ha.Xb;this.Xa="";this.j=null;this.hd=!1;this.Ta=1;this.Ja=!1;this.si=0;this.oi=!1;this.ib=this.f=null;this.nf=this.mf=this.Qa=this.Ya=0;this.wb=this.Fa=this.Kc=this.$c=null;this.vb=this.Ka=!1;this.ni=this.ti=0;this.Tb=this.qf=this.rc=this.tc=this.Wb=this.Hc=this.Ua=this.Ib=this.uc=this.Jc=this.Ic=this.Ub=this.Vb=this.Gb=this.Fb=this.Hb=this.qc=this.Kb=this.Lb=this.Jb=this.Ga=this.qa=this.C=this.Sa=this.pa=
this.va=this.la=this.xa=this.T=this.O=this.wa=this.Ea=this.Va=this.ya=this.ia=this.ja=this.J=this.H=this.L=this.na=this.aa=this.da=this.V=null;T.call(this,a,null,"VideoDash")}I.prototype=Object.create(T.prototype);I.prototype.constructor=I;var fe={VIDEO:"video",AUDIO:"audio"};e=I.prototype;
e.La=function(){T.prototype.La.call(this);if("undefined"===typeof dashjs)throw"FORGE.VideoDash._boot: Can't create MPEG-DASH video stream without dash.js Media Player.";this.R=this.Wl;aa(this);this.Jb=this.Rm.bind(this);this.Hb=this.Nm.bind(this);this.Lb=this.Jl.bind(this);this.Kb=this.Sm.bind(this);this.qc=this.Vm.bind(this);this.Fb=this.Mm.bind(this);this.Gb=this.Hl.bind(this);this.Vb=this.Ll.bind(this);this.Ub=this.Kl.bind(this);this.Ic=this.kn.bind(this);this.Jc=this.qn.bind(this);this.uc=this.gn.bind(this);
this.Ib=this.Il.bind(this);this.Ua=this.Om.bind(this);this.Hc=this.hn.bind(this);this.Wb=this.Um.bind(this);this.tc=this.Xm.bind(this);this.rc=this.Wm.bind(this);this.qf=this.jn.bind(this);this.Tb=this.Tm.bind(this);this.i.audio.onVolumeChange.add(this.ii,this);this.i.audio.onDisable.add(this.hi,this);this.C=new q(this,!0);null!==this.dd&&this.load(this.dd);this.i.display.register(this);ld(this);md(this)};
e.za=function(a){var b=this.j;b&&null!==b.element&&(b.element.setAttribute("width",this.pixelWidth),b.element.setAttribute("height",this.pixelHeight));T.prototype.za.call(this,a)};function ge(a,b){return(a=a.j)&&null!==a.element?a.element[b]:0}
e.Rm=function(a){this.log("onLoadStart [readyState: "+this.j.element.readyState+"]");var b=this.cb,d=this.f.getBitrateInfoListFor(fe.VIDEO),h=[],k;if(d){for(var l=0,p=d.length;l<p;l++)k=new ee(b),k.id=d[l].qualityIndex,k.bitrate=d[l].bitrate,k.width=d[l].width,k.height=d[l].height,h.push(k);this.Na=h;this.C&&this.C.F(h)}else this.destroy();this.V&&this.V.F(a)};e.jn=function(a){this.log("_onSwitchCompleted [readyState: "+this.j.element.readyState+"]");this.ib=a.toStreamInfo};
e.Tm=function(a){this.log("_onMetricsChangedHandler [readyState: "+this.j.element.readyState+"]");this.$c||(this.$c=this.f.getMetricsFor(fe.VIDEO));this.Kc||(this.Kc=this.f.getMetricsFor(fe.AUDIO));this.Fa||(this.Fa=this.f.getDashMetrics());if(this.Ga){var b;a.mediaType===fe.VIDEO&&(b=he(this,fe.VIDEO,this.$c,this.Fa))&&(this.wb={videoBitrate:b.bitrate,videoIndex:b.index,videoPendingIndex:b.Bk,videoMaxIndex:b.vk,videoBufferLength:b.xj,videoDroppedFrames:b.droppedFrames});a.mediaType===fe.AUDIO&&(b=
he(this,fe.AUDIO,this.Kc,this.Fa))&&(this.wb={audioBitrate:b.bitrate,audioIndex:b.index,audioPendingIndex:b.Bk,audioMaxIndex:b.vk,audioBufferLength:b.xj,audioDroppedFrames:b.droppedFrames});this.Ga.F(a)}};
function he(a,b,d,h){if(d&&h){var k=a.ib.index,l,p,r,u,A,ob;(l=h.getCurrentRepresentationSwitch(d))&&(p=Math.round(h.getBandwidthForRepresentation(l.to,k)/1E3));if(isNaN(p)||void 0===p)p=0;b===fe.VIDEO?(r=a.Ya+1,u=a.Qa+1):b===fe.AUDIO&&(r=a.mf+1,u=a.nf+1);if(isNaN(r)||void 0===r)r=0;if(isNaN(u)||void 0===u)u=0;a=h.getMaxIndexForBufferType(b,k);if(isNaN(a)||void 0===a)a=0;b=h.getCurrentBufferLevel(d);null!==b&&(A=b.toPrecision(5));if(isNaN(A)||void 0===A)A=0;if(d=h.getCurrentDroppedFrames(d))ob=d.droppedFrames;
return{bitrate:p,index:r,Bk:u,vk:a,xj:A,droppedFrames:ob}}return null}e.Wm=function(a){this.log("onQualityChange [readyState: "+this.j.element.readyState+"]");a.mediaType===fe.AUDIO?this.nf=this.mf=a.newQuality:a.mediaType===fe.VIDEO&&(this.Qa=this.Ya=a.newQuality,this.pa&&this.pa.F(this.Qa))};
e.Xm=function(a){this.log("onQualityRequest [readyState: "+this.j.element.readyState+"]");a.mediaType===fe.AUDIO?(this.mf=a.oldQuality,this.nf=a.newQuality):a.mediaType===fe.VIDEO&&(this.Ya=a.oldQuality,this.Qa=a.newQuality,this.va&&this.va.F(this.Qa))};e.Nm=function(a){var b=this.j.element;this.log("onDurationChange [readyState: "+b.readyState+"]");this.L&&1===b.readyState&&this.L.F(a)};
e.Jl=function(a){this.log("onLoadedMetaData [readyState: "+this.j.element.readyState+"]");this.oi=!0;this.da&&this.da.F(a)};e.Sm=function(a){this.log("onLoadedData [readyState: "+this.j.element.readyState+"]");this.aa&&this.aa.F(a)};e.Vm=function(a){this.na&&this.na.F(a)};e.Mm=function(a){this.log("onCanPlay [readyState: "+this.j.element.readyState+"]");this.vb=!0;this.H&&this.H.F(a)};e.Hl=function(a){this.log("onCanPlayThrough [readyState: "+this.j.element.readyState+"]");this.vb=!0;this.J&&this.J.F(a)};
e.Ll=function(a){this.log("onPlay [readyState: "+this.j.element.readyState+"]");this.ja&&this.ja.F(a)};e.Kl=function(a){this.log("onPause [readyState: "+this.j.element.readyState+"]");this.Ka=!1;this.ia&&this.ia.F(a)};e.kn=function(a){this.ya&&this.ya.F(a)};e.qn=function(a){var b=this.j.element;this.log("onVolumeChange [readyState: "+b.readyState+"]");this.Ea&&0!==b.readyState&&this.Ea.F(a)};e.gn=function(a){this.log("onSeeked [readyState: "+this.j.element.readyState+"]");this.vb=!1;this.wa&&this.wa.F(a)};
e.Il=function(a){this.log("onEnded [readyState: "+this.j.element.readyState+"]");this.Ka=!1;this.ni++;!0===this.hd&&this.play();this.O&&this.O.F(a)};e.Om=function(a){this.log("onError [readyState: "+this.j.element.readyState+"]");this.T&&this.T.F(a)};e.hn=function(a){this.log("onStalled [readyState: "+this.j.element.readyState+"]");this.xa&&this.xa.F(a)};e.Um=function(a){this.log("onPlaying [readyState: "+this.j.element.readyState+"]");this.la&&this.la.F(a)};
e.hi=function(){var a=this.j;a&&null!==a.element&&!1===this.i.audio.enabled&&this.f.setVolume(0)};e.ii=function(){ie(this)};function ie(a){var b=a.j;b&&null!==b.element&&!0===a.i.audio.enabled&&(a.f.setVolume(a.Ta*a.i.audio.volume),!0===a.Ja?a.f.setMute(!0):a.f.setMute(!1))}
function je(a,b){a.Qa=b;if(a.ib&&a.f&&!0===a.f.isReady()&&a.Fa){var d=a.ib.index,h=a.Fa.getMaxIndexForBufferType(fe.VIDEO,d),d=a.Fa.getMaxIndexForBufferType(fe.AUDIO,d),k=b;k>=h&&(k=h-1);0>k&&(k=0);b>=d&&(b=d-1);0>b&&(b=0);a.f.setQualityFor(fe.VIDEO,k);a.f.setQualityFor(fe.AUDIO,b)}ie(a)}
function ke(a,b){a.Xa===b||b!==g.Ha.Xb&&b!==g.Ha.MANUAL||(a.Xa=b,a.f&&!0===a.f.isReady()&&(b===g.Ha.MANUAL?(a.f.setAutoSwitchQualityFor(fe.VIDEO,!1),a.f.setAutoSwitchQualityFor(fe.AUDIO,!1)):(a.f.setAutoSwitchQualityFor(fe.VIDEO,!0),a.f.setAutoSwitchQualityFor(fe.AUDIO,!0))),a.qa&&a.qa.F(a.Xa))}
e.load=function(a){null!==a&&(!0===g.K.W(a,"string")?a=[a]:!0===g.K.W(a,"VideoQuality")&&(a=[a]),!0===g.K.Pa(a,"string")?this.cb=a[0]:!0===g.K.Pa(a,"VideoQuality")&&(this.cb=a[0].url));if(""===this.cb)throw"FORGE.VideoDash : Can't create video with no manifest!";this.j={index:0,element:null,buffer:null,played:null};a=document.createElement("video");a.setAttribute("webkit-playsinline","webkit-playsinline");a.setAttribute("width",this.pixelWidth);a.setAttribute("height",this.pixelHeight);a.volume=0;
a.crossOrigin="anonymous";a.id="FORGE-VideoDash-"+this.R;var b=new Zd(a,"buffered"),d=new Zd(a,"played"),h=this.j;h.element=a;h.buffer=b;h.played=d;h.lastTimeStamp=0;this.f=dashjs.MediaPlayer().create();this.f.getDebug().setLogToBrowserConsole(!1);this.f.initialize();this.f.setAutoPlay(!1);this.f.attachView(this.j.element);this.f.attachSource(this.cb);!0===this.f.isReady()&&(this.f.on(dashjs.MediaPlayer.events.CAN_PLAY,this.Fb),this.f.on(dashjs.MediaPlayer.events.ERROR,this.Ua),this.f.on(dashjs.MediaPlayer.events.PLAYBACK_ENDED,
this.Ib),this.f.on(dashjs.MediaPlayer.events.PLAYBACK_ERROR,this.Ua),this.f.on(dashjs.MediaPlayer.events.PLAYBACK_METADATA_LOADED,this.Lb),this.f.on(dashjs.MediaPlayer.events.PLAYBACK_PAUSED,this.Ub),this.f.on(dashjs.MediaPlayer.events.PLAYBACK_PROGRESS,this.qc),this.f.on(dashjs.MediaPlayer.events.PLAYBACK_SEEKED,this.uc),this.f.on(dashjs.MediaPlayer.events.PLAYBACK_STARTED,this.Vb),this.f.on(dashjs.MediaPlayer.events.PLAYBACK_TIME_UPDATED,this.Ic),this.f.on(dashjs.MediaPlayer.events.QUALITY_CHANGE_RENDERED,
this.rc),this.f.on(dashjs.MediaPlayer.events.QUALITY_CHANGE_REQUESTED,this.tc),this.f.on(dashjs.MediaPlayer.events.STREAM_INITIALIZED,this.Jb),this.f.on(dashjs.MediaPlayer.events.PLAYBACK_PLAYING,this.Wb),this.f.on(dashjs.MediaPlayer.events.BUFFER_EMPTY,this.Hc),this.f.on(dashjs.MediaPlayer.events.PERIOD_SWITCH_COMPLETED,this.qf),this.f.on(dashjs.MediaPlayer.events.METRIC_CHANGED,this.Tb),this.j.element.addEventListener("loadeddata",this.Kb,!1),this.j.element.addEventListener("durationchange",this.Hb,
!1),this.j.element.addEventListener("canplaythrough",this.Gb,!1),this.j.element.addEventListener("volumechange",this.Jc,!1),this.c.innerHTML="",this.c.appendChild(this.j.element));""===this.Xa&&ke(this,this.Vl)};e.play=function(a,b){this.currentTime=a;this.loop=b;this.f&&!0===this.f.isReady()&&(this.f.play(),this.Ka=!0,this.ti++)};e.pause=function(){this.f&&!0===this.f.isReady()&&(this.f.pause(),this.Ka=!1)};
e.stop=function(){this.f&&!0===this.f.isReady()&&(this.f.pause(),this.f.seek(0),this.j.element.currentTime=0,this.Ka=!1)};e.Nl=function(){!0===this.Ka||!1===this.i.audio.enabled?this.pause():this.play()};e.qb=function(){!0!==this.Ja&&!1!==this.i.audio.enabled&&(this.Ja=!0,this.si=this.Ta,this.Ta=0,ie(this))};e.ji=function(a){!1!==this.Ja&&(a="number"===typeof a?a:this.si,this.Ja=!1,this.Ta=g.Math.ca(a,0,1),ie(this))};e.Ml=function(a){this.f&&!0===this.f.isReady()&&this.f.enableBufferOccupancyABR(a)};
e.destroy=function(){this.log("_destroyVideo");this.f&&!0===this.f.isReady()&&(this.f.off(dashjs.MediaPlayer.events.CAN_PLAY,this.Fb),this.f.off(dashjs.MediaPlayer.events.ERROR,this.Ua),this.f.off(dashjs.MediaPlayer.events.PLAYBACK_ENDED,this.Ib),this.f.off(dashjs.MediaPlayer.events.PLAYBACK_ERROR,this.Ua),this.f.off(dashjs.MediaPlayer.events.PLAYBACK_METADATA_LOADED,this.Lb),this.f.off(dashjs.MediaPlayer.events.PLAYBACK_PAUSED,this.Ub),this.f.off(dashjs.MediaPlayer.events.PLAYBACK_PROGRESS,this.qc),
this.f.off(dashjs.MediaPlayer.events.PLAYBACK_SEEKED,this.uc),this.f.off(dashjs.MediaPlayer.events.PLAYBACK_STARTED,this.Vb),this.f.off(dashjs.MediaPlayer.events.PLAYBACK_TIME_UPDATED,this.Ic),this.f.off(dashjs.MediaPlayer.events.QUALITY_CHANGE_RENDERED,this.rc),this.f.off(dashjs.MediaPlayer.events.QUALITY_CHANGE_REQUESTED,this.tc),this.f.off(dashjs.MediaPlayer.events.STREAM_INITIALIZED,this.Jb),this.f.off(dashjs.MediaPlayer.events.PLAYBACK_PLAYING,this.Wb),this.f.off(dashjs.MediaPlayer.events.BUFFER_EMPTY,
this.Hc),this.f.off(dashjs.MediaPlayer.events.PERIOD_SWITCH_COMPLETED,this.qf),this.f.off(dashjs.MediaPlayer.events.METRIC_CHANGED,this.Tb),this.j.element.removeEventListener("loadeddata",this.Kb,!1),this.j.element.removeEventListener("durationchange",this.Hb,!1),this.j.element.removeEventListener("canplaythrough",this.Gb,!1),this.j.element.removeEventListener("volumechange",this.Jc,!1),this.f.pause(),this.f.reset());var a=this.j,b=a.element;"undefined"!==typeof b&&null!==b&&b.parentNode===this.c&&
this.c.removeChild(b);a.element=null;null!==a.buffer&&(a.buffer.destroy(),a.buffer=null);null!==a.played&&(a.played.destroy(),a.played=null);this.V&&(this.V.destroy(),this.V=null);this.da&&(this.da.destroy(),this.da=null);this.aa&&(this.aa.destroy(),this.aa=null);this.na&&(this.na.destroy(),this.na=null);this.L&&(this.L.destroy(),this.L=null);this.H&&(this.H.destroy(),this.H=null);this.J&&(this.J.destroy(),this.J=null);this.ja&&(this.ja.destroy(),this.ja=null);this.ia&&(this.ia.destroy(),this.ia=
null);this.ya&&(this.ya.destroy(),this.ya=null);this.Va&&(this.Va.destroy(),this.Va=null);this.Ea&&(this.Ea.destroy(),this.Ea=null);this.wa&&(this.wa.destroy(),this.wa=null);this.O&&(this.O.destroy(),this.O=null);this.T&&(this.T.destroy(),this.T=null);this.xa&&(this.xa.destroy(),this.xa=null);this.la&&(this.la.destroy(),this.la=null);this.va&&(this.va.destroy(),this.va=null);this.pa&&(this.pa.destroy(),this.pa=null);this.Sa&&(this.Sa.destroy(),this.Sa=null);this.C&&(this.C.destroy(),this.C=null);
this.qa&&(this.qa.destroy(),this.qa=null);this.Ga&&(this.Ga.destroy(),this.Ga=null);this.Tb=this.rc=this.tc=this.Hc=this.Wb=this.Ua=this.Ib=this.uc=this.Jc=this.Ic=this.Ub=this.Vb=this.Gb=this.Fb=this.Hb=this.qc=this.Kb=this.Lb=this.Jb=null;this.i.audio.onVolumeChange.remove(this.ii,this);this.i.audio.onDisable.remove(this.hi,this);this.j=this.Na=this.dd=this.ib=this.wb=this.Fa=this.Kc=this.$c=this.f=null;T.prototype.destroy.call(this)};Object.defineProperty(I.prototype,"monitoring",{get:function(){return this.wb}});
Object.defineProperty(I.prototype,"quality",{get:function(){return this.Na[this.Ya]},set:function(a){if("number"===typeof a&&0<=a&&a<this.Na.length)ke(this,g.Ha.MANUAL),je(this,a);else if(!0===g.K.W(a,"VideoQuality")){a:{for(var b,d=0,h=this.Na.length;d<h;d++)if(b=this.Na[d],b===a){a=d;break a}a=-1}if(-1!==a)ke(this,g.Ha.MANUAL),je(this,a);else throw"Unknown quality";}else throw"Video quality "+a+" out of bounds";}});
Object.defineProperty(I.prototype,"qualityMode",{get:function(){return this.Xa},set:function(a){a!==g.Ha.Xb&&a!==g.Ha.MANUAL||ke(this,a)}});Object.defineProperty(I.prototype,"qualities",{get:function(){return this.Na}});Object.defineProperty(I.prototype,"requestIndex",{get:function(){return this.Qa}});Object.defineProperty(I.prototype,"currentIndex",{get:function(){return this.Ya}});Object.defineProperty(I.prototype,"video",{get:function(){return this.j}});
Object.defineProperty(I.prototype,"element",{get:function(){var a=this.j;return a&&null!==a.element?a.element:null}});Object.defineProperty(I.prototype,"buffer",{get:function(){var a=this.j;return a&&null!==a.buffer?a.buffer:null}});Object.defineProperty(I.prototype,"played",{get:function(){var a=this.j;return a&&null!==a.played?a.played:null}});Object.defineProperty(I.prototype,"originalWidth",{get:function(){return ge(this,"videoWidth")}});
Object.defineProperty(I.prototype,"originalHeight",{get:function(){return ge(this,"videoHeight")}});Object.defineProperty(I.prototype,"currentTime",{get:function(){return this.f.time()},set:function(a){"number"===typeof a&&(this.f.seek(a),this.Va&&this.Va.F(a))}});Object.defineProperty(I.prototype,"currentTimeMS",{get:function(){return 1E3*this.currentTime},set:function(a){this.currentTime=a/1E3}});Object.defineProperty(I.prototype,"remainingTime",{get:function(){return this.duration-this.currentTime}});
Object.defineProperty(I.prototype,"duration",{get:function(){return this.f.duration()}});Object.defineProperty(I.prototype,"durationMS",{get:function(){return Math.round(1E3*this.duration)}});Object.defineProperty(I.prototype,"playing",{get:function(){return this.Ka}});Object.defineProperty(I.prototype,"playCount",{get:function(){return this.ti}});Object.defineProperty(I.prototype,"canPlay",{get:function(){return this.vb}});Object.defineProperty(I.prototype,"endCount",{get:function(){return this.ni}});
Object.defineProperty(I.prototype,"metaDataLoaded",{get:function(){return this.oi}});Object.defineProperty(I.prototype,"loop",{get:function(){return this.hd},set:function(a){"boolean"===typeof a&&(this.hd=a)}});Object.defineProperty(I.prototype,"volume",{get:function(){return this.Ta},set:function(a){"number"===typeof a&&(this.Ta=g.Math.ca(a,0,1),this.Ja=!1,ie(this))}});Object.defineProperty(I.prototype,"muted",{get:function(){return this.Ja},set:function(a){!0===!!a?this.qb():this.ji()}});
Object.defineProperty(I.prototype,"onLoadStart",{get:function(){this.V||(this.V=new q(this));return this.V}});Object.defineProperty(I.prototype,"onLoadedMetaData",{get:function(){this.da||(this.da=new q(this));return this.da}});Object.defineProperty(I.prototype,"onLoadedData",{get:function(){this.aa||(this.aa=new q(this));return this.aa}});Object.defineProperty(I.prototype,"onProgress",{get:function(){this.na||(this.na=new q(this));return this.na}});
Object.defineProperty(I.prototype,"onDurationChange",{get:function(){this.L||(this.L=new q(this));return this.L}});Object.defineProperty(I.prototype,"onCanPlay",{get:function(){this.H||(this.H=new q(this));return this.H}});Object.defineProperty(I.prototype,"onCanPlayThrough",{get:function(){this.J||(this.J=new q(this));return this.J}});Object.defineProperty(I.prototype,"onPlay",{get:function(){this.ja||(this.ja=new q(this));return this.ja}});
Object.defineProperty(I.prototype,"onPause",{get:function(){this.ia||(this.ia=new q(this));return this.ia}});Object.defineProperty(I.prototype,"onTimeUpdate",{get:function(){this.ya||(this.ya=new q(this));return this.ya}});Object.defineProperty(I.prototype,"onCurrentTimeChange",{get:function(){this.O||(this.O=new q(this));return this.O}});Object.defineProperty(I.prototype,"onVolumeChange",{get:function(){this.Ea||(this.Ea=new q(this));return this.Ea}});
Object.defineProperty(I.prototype,"onSeeked",{get:function(){this.wa||(this.wa=new q(this));return this.wa}});Object.defineProperty(I.prototype,"onEnded",{get:function(){this.O||(this.O=new q(this));return this.O}});Object.defineProperty(I.prototype,"onError",{get:function(){this.T||(this.T=new q(this));return this.T}});Object.defineProperty(I.prototype,"onStalled",{get:function(){this.xa||(this.xa=new q(this));return this.xa}});Object.defineProperty(I.prototype,"onWaiting",{get:function(){return this.onStalled}});
Object.defineProperty(I.prototype,"onPlaying",{get:function(){this.la||(this.la=new q(this));return this.la}});Object.defineProperty(I.prototype,"onQualityRequest",{get:function(){this.va||(this.va=new q(this));return this.va}});Object.defineProperty(I.prototype,"onQualityChange",{get:function(){this.pa||(this.pa=new q(this));return this.pa}});Object.defineProperty(I.prototype,"onQualityAbort",{get:function(){this.Sa||(this.Sa=new q(this));return this.Sa}});
Object.defineProperty(I.prototype,"onMetricsChanged",{get:function(){this.Ga||(this.Ga=new q(this));return this.Ga}});Object.defineProperty(I.prototype,"onQualitiesLoaded",{get:function(){this.C||(this.C=new q(this,!0));return this.C}});Object.defineProperty(I.prototype,"onQualityModeChange",{get:function(){this.qa||(this.qa=new q(this));return this.qa}});function Zd(a,b){this.c=a;this.f=b;n.call(this,"VideoTimeRanges")}Zd.prototype=Object.create(n.prototype);Zd.prototype.constructor=Zd;
Zd.prototype.j=function(a){var b=this.c[this.f];if(!this.length)return this.warn("No available range for now"),null;if(a>this.length-1)return this.warn("Time range out of bounds, returning the last available range"),this.j(this.length-1);if(0>a)return this.warn("Time range out of bounds, returning the first available range"),this.j(0);var d=b.start(a);a=b.end(a);return{start:d,end:a}};
Zd.prototype.qk=function(a,b){"number"!==typeof b&&(b=0);for(var d=this.c[this.f],h,k,l=this.length;l--;)if(h=d.start(l),k=d.end(l),a>=h&&a+b<=k)return!0;return!1};Object.defineProperty(Zd.prototype,"length",{get:function(){return this.c[this.f].length}});function ee(a){this.m="";this.j=a||"";this.o=this.c="";this.f=this.u=this.B=0;n.call(this,"VideoQuality")}ee.prototype=Object.create(n.prototype);ee.prototype.constructor=ee;
function le(a){var b=["mp4","webm","ogg"];a=ya(a);if(""!==a.extension&&-1!==b.indexOf(a.extension))return"video/"+a.extension;b=["mpd"];return""!==a.extension&&-1!==b.indexOf(a.extension)?"application/dash+xml":""}Object.defineProperty(ee.prototype,"id",{get:function(){return this.m},set:function(a){if("number"===typeof a||"string"===typeof a)this.m=a}});Object.defineProperty(ee.prototype,"url",{get:function(){return this.j},set:function(a){"string"===typeof a&&(this.j=a)}});
Object.defineProperty(ee.prototype,"mimeType",{get:function(){""===this.c&&""!==this.j&&(this.c=le(this.j));return this.c}});Object.defineProperty(ee.prototype,"name",{get:function(){return this.o},set:function(a){"string"===typeof a&&(this.o=a)}});Object.defineProperty(ee.prototype,"framerate",{get:function(){return 0}});Object.defineProperty(ee.prototype,"bitrate",{get:function(){return this.B},set:function(a){"number"===typeof a&&(this.B=a)}});
Object.defineProperty(ee.prototype,"width",{get:function(){return this.u},set:function(a){"number"===typeof a&&(this.u=a)}});Object.defineProperty(ee.prototype,"height",{get:function(){return this.f},set:function(a){"number"===typeof a&&(this.f=a)}});Object.defineProperty(ee.prototype,"speed",{get:function(){return 1}});g.Ha={};g.Ha.Xb="auto";g.Ha.MANUAL="manual";g.nb={};g.nb.Pe="dash";g.nb.Ul="html5";g.nb.Td="unknown";
function xd(a){this.m=a;this.f={};this.c=null;this.j=[];n.call(this,"SpriteAnimationManager");!1===this.m.loaded&&this.m.onLoadComplete.ga(this.xn,this)}xd.prototype=Object.create(n.prototype);e=xd.prototype;e.constructor=xd;e.xn=function(){this.log("_spriteLoadComplete");for(var a,b,d=0,h=this.j.length;d<h;d++)a=this.j[d].method,b=this.j[d].args,xd.prototype[a].apply(this,b);this.j=[]};
e.add=function(a,b,d,h,k){if(!1===this.m.loaded)this.j.push({method:"add",args:arguments});else{this.log("add");"string"!==typeof a&&(a="default");b=parseInt(b,10);d=parseInt(d,10);var l=this.m.frames;if("number"!==typeof b||!0===isNaN(b)||0>b||b>=l.length)b=0;if("number"!==typeof d||!0===isNaN(d)||0>d||d>=l.length)d=l.length;k="undefined"===typeof k?!1:!!k;this.f[a]=new Y(this.m,a,l.slice(b,d),h||60);this.c=this.f[a]}};
e.play=function(a,b,d){if(!1===this.m.loaded)this.j.push({method:"play",args:arguments});else{var h=this.c;"string"===typeof a&&null!==a&&(h=this.get(a));h&&h.play(b,d)}};e.pause=function(a){var b=this.c;b&&b.pause(a)};e.resume=function(a){var b=this.c;b&&b.resume(a)};e.stop=function(){var a=this.c;a&&a.stop()};e.get=function(a){return!0===g.K.W(this.f[a],"SpriteAnimation")?this.f[a]:null};e.update=function(){this.c&&this.c.update()};
e.destroy=function(){for(var a in this.f)this.f[a].destroy(),this.f[a]=null;this.j=this.c=this.f=this.m=null;n.prototype.destroy.call(this)};Object.defineProperty(xd.prototype,"currentAnimation",{get:function(){return this.c},set:function(a){!0===g.K.W(a,"SpriteAnimation")&&(this.c=a)}});
function Y(a,b,d,h){this.C=a;this.O=b;this.D=d||[];this.P=0;this.Z=h||60;this.L=!1;this.$=0;this.G=1E3/h;this.H=this.M=0;this.U=1;this.J=this.c=this.I=!1;this.f=this.B=this.j=this.u=this.m=this.o=null;n.call(this,"SpriteAnimation")}Y.prototype=Object.create(n.prototype);e=Y.prototype;e.constructor=Y;function me(a,b){a.P="number"===typeof b&&0<=b&&b<a.D.length?b:0;a.C.frame=a.D[a.P].frame}
e.play=function(a,b){"boolean"===typeof a&&(this.L=a);this.I=!0;this.c=this.J=!1;this.$=0;this.M=this.C.viewer.clock.time+this.G;me(this,b);this.C.animations.Do=this;this.o&&this.o.F()};e.pause=function(a){!0!==this.c&&(this.c=!0,"number"===typeof a&&me(this,a),this.m&&this.m.F())};e.resume=function(a){!1!==this.c&&(this.c=!1,"number"===typeof a&&me(this,a),this.I&&(this.M=this.C.viewer.clock.time+this.G),this.u&&this.u.F())};e.stop=function(){this.I=!1;this.J=!0;this.c=!1;me(this,0);this.B&&this.B.F()};
e.update=function(){if(!0!==this.c){var a=this.C.viewer.clock.time;!0===this.I&&a>=this.M&&(this.U=1,this.H=a-this.M,this.H>this.G&&(this.U=Math.floor(this.H/this.G),this.H-=this.U*this.G),this.M=a+(this.G-this.H),a=this.P+this.U,a>=this.D.length?!0===this.L?(a%=this.D.length,this.$++,this.j&&this.j.F(),me(this,a)):(me(this,this.D.length-1),this.I=!1,this.J=!0,this.c=!1,this.f&&this.f.F()):me(this,a))}};
e.destroy=function(){this.D=this.C=null;this.o&&(this.o.destroy(),this.o=null);this.m&&(this.m.destroy(),this.m=null);this.u&&(this.u.destroy(),this.u=null);this.f&&(this.f.destroy(),this.f=null);this.j&&(this.j.destroy(),this.j=null);this.B&&(this.B.destroy(),this.B=null);n.prototype.destroy.call(this)};Object.defineProperty(Y.prototype,"name",{get:function(){return this.O}});Object.defineProperty(Y.prototype,"frames",{get:function(){return this.D}});
Object.defineProperty(Y.prototype,"frameIndex",{get:function(){return this.P}});Object.defineProperty(Y.prototype,"frameRate",{get:function(){return this.Z},set:function(a){"number"===typeof a&&(this.Z=a,this.G=1E3/this.Z)}});Object.defineProperty(Y.prototype,"loop",{get:function(){return this.L},set:function(a){this.L=!!a}});Object.defineProperty(Y.prototype,"loopCount",{get:function(){return this.$}});Object.defineProperty(Y.prototype,"playing",{get:function(){return this.I}});
Object.defineProperty(Y.prototype,"paused",{get:function(){return this.c},set:function(a){!0===!!a?this.pause():this.resume()}});Object.defineProperty(Y.prototype,"complete",{get:function(){return this.J}});Object.defineProperty(Y.prototype,"onPlay",{get:function(){this.o||(this.o=new q(this));return this.o}});Object.defineProperty(Y.prototype,"onPause",{get:function(){this.m||(this.m=new q(this));return this.m}});
Object.defineProperty(Y.prototype,"onResume",{get:function(){this.u||(this.u=new q(this));return this.u}});Object.defineProperty(Y.prototype,"onLoop",{get:function(){this.j||(this.j=new q(this));return this.j}});Object.defineProperty(Y.prototype,"onComplete",{get:function(){this.f||(this.f=new q(this));return this.f}});Object.defineProperty(Y.prototype,"onStop",{get:function(){this.B||(this.B=new q(this));return this.B}});
function ra(a){this.i=a;this.R=new ne;this.m=new ne;this.f=new ne;this.c=new ne;this.j=0}var C={JSON:"json",jc:"xml",IMAGE:"image",Eb:"sound"},oe={bd:["forge","forgejs","FORGE"]};oe.JSON=["tour.config"].concat(oe.bd);oe.jc=[].concat(oe.bd);oe.IMAGE=[].concat(oe.bd);oe.Eb=[].concat(oe.bd);function pe(a,b){var d=null;switch(b){case C.JSON:d=a.R;break;case C.jc:d=a.m;break;case C.IMAGE:d=a.f;break;case C.Eb:d=a.c}return d}
function qe(a,b,d){var h=pe(a,b),k=(d||"FORGE-cache")+"-"+a.j;a.j++;return!1===h.has(k)&&!1===re(b,k)?k:qe(a,b,d)}function re(a,b){var d=null;switch(a){case C.JSON:d=oe.JSON;break;case C.jc:d=oe.jc;break;case C.IMAGE:d=oe.IMAGE;break;case C.Eb:d=oe.Eb}return(a=d)?-1!==a.indexOf(b.toLowerCase()):!1}e=ra.prototype;e.has=function(a,b){return(a=pe(this,a))?a.has(b):!1};e.get=function(a,b){return!0===this.has(a,b)&&(a=pe(this,a))?a.get(b):null};
e.add=function(a,b,d){var h;(h="string"!==typeof b||""===b)||(h=pe(this,a),h=!0===(!0===re(a,b)&&!0===h.has(b)));h&&(b=qe(this,a,a+"-cache"));return!1===this.has(b,a)&&(a=pe(this,a))?(a.set(b,d),!0):!1};e.remove=function(a,b){return!0===this.has(a,b)&&(a=pe(this,a))?(a.af(b),!0):!1};e.destroy=function(){this.c=this.f=this.R=this.i=null};function se(){}e=se.prototype;e.key="";e.url="";e.type="";e.data=null;e.Ao=null;e.Rb=!1;e.Zk=!1;e.Yk="";e.constructor=se;
function sa(a){this.i=a;n.call(this,"Loader")}sa.prototype=Object.create(n.prototype);e=sa.prototype;e.constructor=sa;e.json=function(a,b,d,h,k,l){var p=new se;p.type="json";p.key=a;p.url=b;p.c=d;p.f=h;p.R=k;p.j=l;te(this,p,"text",this.zm,this.Am)};
e.zm=function(a,b){if(b.responseText){if(a.data=Object(JSON.parse(b.responseText)),!1===this.i.cache.has(C.JSON,a.key)?this.i.cache.add(C.JSON,a.key,a):this.log("FORGE.Loader.json : JSON file already exists"),"function"===typeof a.c&&null!==a.f){b=a.c;var d=a.f;a.c=null;a.f=null;a.R=null;a.j=null;b.call(d,a)}}else throw"FORGE.Loader.json : JSON file empty ?";};
e.Am=function(a,b){if(b.responseText){if("function"===typeof a.R&&null!==a.j){b=a.R;var d=a.j;a.c=null;a.f=null;a.R=null;a.j=null;b.call(d,a)}}else throw"FORGE.Loader.json : JSON file empty ?";};e.el=function(a,b,d,h,k,l){k=new se;k.type="xml";k.key=a;k.url=b;k.c=d;k.f=h;k.R=d;k.j=l;te(this,k,"document",this.Bn,this.Cn)};
e.Bn=function(a,b){if(b.responseXML){if(a.data=b.responseXML,!1===this.i.cache.has(C.jc,a.key)?this.i.cache.add(C.jc,a.key,a):this.log("FORGE.Loader.xml : XML file already exists"),"function"===typeof a.c&&null!==a.f){b=a.c;var d=a.f;a.c=null;a.f=null;a.R=null;a.j=null;b.call(d,a)}}else throw"FORGE.Loader.xml : XML file empty ?";};
e.Cn=function(a,b){if(b.responseXML){if("function"===typeof a.R&&null!==a.j){b=a.R;var d=a.j;a.c=null;a.f=null;a.R=null;a.j=null;b.call(d,a)}}else throw"FORGE.Loader.xml : JSON file empty ?";};e.sound=function(a,b,d,h,k){var l=new se;l.type="sound";l.key=a;l.url=b;l.c=d;l.f=h;!0===this.i.audio.useWebAudio&&!0!==k?te(this,l,"arraybuffer",this.hj):!0!==this.i.audio.useAudioTag&&!0!==k||ue(l,this.hj,this)};
e.hj=function(a,b){!0===this.i.audio.useWebAudio&&"undefined"!==typeof b&&(a.data=b.response);this.i.cache.add(C.Eb,a.key,a);"function"===typeof a.c&&null!==a.f&&a.c.call(a.f,a)};
function ue(a,b,d){function h(){a.data.removeEventListener(k,h,!1);a.data.onerror=null;"function"===typeof b&&b.call(d,a)}a.data=new Audio;a.data.preload="auto";a.data.crossOrigin="anonymous";a.data.src=a.url;var k="canplaythrough";a.data.onerror=function(){a.data.removeEventListener(k,h,!1);a.data.onerror=null;throw"FORGE.Loader._loadAudioTag : Could not load "+a.url;};"undefined"===typeof a.data.oncanplaythrough&&(k="canplay");a.data.addEventListener(k,h,!1);a.data.load()}
function te(a,b,d,h,k){b.Rb=!0;var l=new XMLHttpRequest;l.open("GET",b.url,!0);l.responseType=d;l.onreadystatechange=function(){if(l.readyState===XMLHttpRequest.DONE){if(200!==l.status&&l.status)throw"FORGE.Loader._xhr : Could not load "+b.url;this.onreadystatechange=null;"function"===typeof h&&(b.loaded=!0,h.call(this,b,l))}}.bind(a);l.onerror=function(){"function"===typeof k&&k.call(this,b,l)}.bind(a);l.send()}
e.image=function(a,b,d,h){var k=new se;k.type="image";k.key=a;k.url=b;k.data=new Image;k.data.crossOrigin="anonymous";k.data.onload=function(){k.data.onload=null;k.data.onerror=null;k.Rb=!1;k.loaded=!0;this.i.cache.add(C.IMAGE,k.key,k);d.call(h,k)}.bind(this);k.data.onerror=function(){k.data.onload=null;k.data.onerror=null;throw"ERROR : FORGE.Loader.image, failed to load image key : "+a+" at url "+b;};k.data.src=k.url;k.Rb=!0};
e.Lg=function(a,b,d){for(var h=document.getElementsByTagName("head")[0],k=h.getElementsByTagName("script"),l=0,p=k.length;l<p;l++)if(k[l].src===a){this.warn("Attempt to load an already loaded script!");b.call(d);return}var r=document.createElement("script");r.type="text/javascript";r.onload=function(){r.onload=null;b.call(d)};r.src=a;h.appendChild(r)};
e.Bj=function(a,b,d){var h=document.createElement("link");h.type="text/css";h.rel="stylesheet";"undefined"!==typeof b&&"undefined"!==typeof d&&(h.onload=function(){h.onload=null;b.call(d)});h.href=a;document.getElementsByTagName("head")[0].appendChild(h)};e.destroy=function(){this.i=null;n.prototype.destroy.call(this)};function ga(a){this.i=a;this.j=this.f=0;this.c=null;n.call(this,"DependencyManager")}ga.prototype=Object.create(n.prototype);ga.prototype.constructor=ga;
ga.prototype.add=function(a){"undefined"!==typeof a&&"string"===typeof a.url&&(this.f++,this.i.load.Lg(a.url,this.m,this))};ga.prototype.m=function(){this.j++;this.f-this.j||(console.log("DependencyManager : all scripts loaded"),this.c&&this.c.F())};ga.prototype.destroy=function(){this.i=null;n.prototype.destroy.call(this)};Object.defineProperty(ga.prototype,"dependencies",{get:function(){return this.f}});
Object.defineProperty(ga.prototype,"onAllScriptsLoaded",{get:function(){this.c||(this.c=new q(this));return this.c}});function ha(a){this.i=a;this.f=0;this.c=null;n.call(this,"Clock");this.f=Date.now();this.c=[]}ha.prototype=Object.create(n.prototype);e=ha.prototype;e.constructor=ha;e.ln=function(a){a:{if(this.c)for(var b,d=0,h=this.c.length;d<h;d++)if(b=this.c[d],b===a.emitter){a=d;break a}a=-1}-1!==a&&this.c.splice(a,1)};e.create=function(a){return this.add(new Z(this.i,a))};
e.add=function(a){this.c.push(a);a.onDestroy.add(this.ln,this);return a};e.update=function(){this.f=Date.now();for(var a=0,b=this.c.length;a<b;a++)this.c[a].update(this.f)};e.destroy=function(){this.i=null;for(var a=this.c.length;a--;)this.c[a].destroy();this.c=null};Object.defineProperty(ha.prototype,"time",{get:function(){return this.f}});
function Z(a,b){this.i=a;this.L="undefined"!==typeof b?b:!0;this.C=0;this.j=!1;this.M=this.J=0;this.m=!1;this.f=0;this.H=!1;this.u=this.I=this.D=this.B=this.G=this.c=null;n.call(this,"Timer");this.c=[];this.f=Date.now()}Z.prototype=Object.create(n.prototype);e=Z.prototype;e.constructor=Z;function ve(a,b){for(var d=0;d<a.c.length;d++){var h=a.c[d];if(!1===h.f){var k=h.c-b;0>k&&(k=0);h.c=a.f+k}}b=a.o-b;a.o=0>b?a.f:a.f+b}function we(a){0<a.c.length&&(a.c.sort(a.wn),a.o=a.c[0].c)}
e.wn=function(a,b){return a.c<b.c?-1:a.c>b.c?1:0};e.create=function(a,b,d,h,k,l){var p=a=Math.round(a);this.f?p+=this.f:p+=this.i.clock.time;a=new xe(0,a,p,d,b,h,k,l);this.c.push(a);we(this);this.H=!1;return a};e.add=function(a,b,d,h){return this.create(a,!1,0,b,d,Array.prototype.splice.call(arguments,3))};e.Cl=function(a,b,d,h){return this.create(a,!1,b,d,h,Array.prototype.splice.call(arguments,4))};e.jf=function(a,b,d){return this.create(a,!0,0,b,d,Array.prototype.splice.call(arguments,3))};
e.remove=function(a){for(var b=0;b<this.c.length;b++)if(this.c[b]===a)return this.c[b].f=!0;return!1};e.start=function(){if(!0!==this.j){this.C=this.i.clock.time;this.j=!0;for(var a,b=0;b<this.c.length;b++)a=this.c[b],a.c=a.delay+this.C;this.G&&this.G.F()}};e.stop=function(a){this.j=!1;!1!==a&&(this.c.length=0);this.I&&this.I.F()};e.pause=function(){!1!==this.j&&!0!==this.m&&(this.J=this.i.clock.time,this.m=!0,this.B&&this.B.F())};
e.resume=function(){if(!1!==this.m){var a=this.i.clock.time;this.M+=a-this.f;this.f=a;ve(this,this.J);this.m=!1;this.D&&this.D.F()}};
e.update=function(a){if(!0!==this.m){var b=a-this.f;this.f=a;1E3<b&&ve(this,a-b);for(a=this.c.length;a--;)!0===this.c[a].f&&this.c.splice(a,1);a=this.c.length;var d=b=0;if(!0===this.j&&this.f>=this.o&&0<a){for(var h;b<a&&!0===this.j;)if(h=this.c[b],this.f>=h.c&&!1===h.f){var k=this.f+h.delay-(this.f-h.c);0>k&&(k=this.f+h.delay);!0===h.loop?h.c=k:0<h.R?(h.R--,h.c=k):(d++,h.f=!0);h.Qb();b++}else break;this.c.length>d?we(this):(this.H=!0,this.j=!1,this.u&&this.u.F())}this.H&&this.L&&this.destroy()}};
e.destroy=function(){this.j=!1;this.c=[];n.prototype.destroy.call(this)};Object.defineProperty(Z.prototype,"autoDestroy",{get:function(){return this.L}});Object.defineProperty(Z.prototype,"running",{get:function(){return this.j}});Object.defineProperty(Z.prototype,"paused",{get:function(){return this.m}});Object.defineProperty(Z.prototype,"next",{get:function(){return this.o}});Object.defineProperty(Z.prototype,"duration",{get:function(){return this.j&&this.o>this.f?this.o-this.f:0}});
Object.defineProperty(Z.prototype,"length",{get:function(){return this.c.length}});Object.defineProperty(Z.prototype,"ms",{get:function(){return this.j?this.f-this.C-this.M:0}});Object.defineProperty(Z.prototype,"seconds",{get:function(){return this.j?.001*this.ms:0}});Object.defineProperty(Z.prototype,"onStart",{get:function(){this.G||(this.G=new q(this));return this.G}});Object.defineProperty(Z.prototype,"onPause",{get:function(){this.B||(this.B=new q(this));return this.B}});
Object.defineProperty(Z.prototype,"onResume",{get:function(){this.D||(this.D=new q(this));return this.D}});Object.defineProperty(Z.prototype,"onStop",{get:function(){this.I||(this.I=new q(this));return this.I}});Object.defineProperty(Z.prototype,"onComplete",{get:function(){this.u||(this.u=new q(this));return this.u}});function xe(a,b,d,h,k,l,p,r){this.delay=b;this.c=d;this.R=h-1;this.loop=k;this.m=l;this.o=p;this.j=r;this.f=!1}xe.prototype.constructor=xe;
xe.prototype.Qb=function(){this.m.apply(this.o,this.j)};function ta(a){this.i=a;this.c=[];n.call(this,"TweenManager")}ta.prototype=Object.create(n.prototype);e=ta.prototype;e.constructor=ta;e.zn=function(a){this.remove(a.emitter)};e.add=function(a){this.c.push(a);a.onDestroy.ga(this.zn,this)};e.remove=function(a){a:{for(var b=0,d=this.c.length;b<d;b++)if(a===this.c[b]){a=b;break a}a=-1}-1!==a&&this.c.splice(a,1)};e.update=function(){for(var a=0,b=this.c.length;a<b;a++)this.c[a].update()};
e.destroy=function(){for(var a=this.c.length;a--;)this.c[a].destroy();this.i=this.c=null;n.prototype.destroy.call(this)};function lb(a,b){this.i=a;this.D=b;this.c=null;this.B=g.X.LINEAR;this.I=null;this.u=this.G=this.C=!1;this.o=this.f=this.j=this.m=null;n.call(this,"Tween")}lb.prototype=Object.create(n.prototype);e=lb.prototype;e.constructor=lb;
e.kf=function(a,b,d){this.c||(this.c={});for(var h in a)this.c[h]={name:h,min:null,max:a[h],duration:"number"===typeof b?b:0,easing:"function"===typeof d?d:null,started:!1,complete:!1,startTime:null};return this};e.start=function(){this.I=Date.now();this.C=!0;this.u=this.G=!1;var a,b;for(b in this.c)a=this.c[b],a.min=this.D[b],a.max="string"===typeof this.c[b].max?a.min+parseInt(this.c[b].max,10):a.max,a.started=!0,a.startTime=this.I;this.m&&this.m.F();return this};
e.stop=function(){this.G=!0;this.o&&this.o.F();return this};e.update=function(){if(!1!==this.C&&!0!==this.u&&!0!==this.G){var a,b=0,d;for(d in this.c){a=this.c[d];if(!1===a.complete){var h=a,k=Date.now()-h.startTime;h.complete=k>=h.duration;!1===h.complete?(k=(null!==h.easing?h.easing:this.B)(k/h.duration),this.D[h.name]=k*(h.max-h.min)+h.min):this.D[h.name]=h.max}!1===a.complete&&b++}this.j&&this.j.F();b||(this.u=!0,this.f&&this.f.F())}};
e.destroy=function(){this.stop();this.B=this.c=this.D=this.i=null;this.m&&(this.m.destroy(),this.m=null);this.j&&(this.j.destroy(),this.j=null);this.f&&(this.f.destroy(),this.f=null);this.o&&(this.o.destroy(),this.o=null);n.prototype.destroy.call(this)};Object.defineProperty(lb.prototype,"easing",{get:function(){return this.B},set:function(a){"function"===typeof a&&(this.B=a)}});Object.defineProperty(lb.prototype,"complete",{get:function(){return this.u}});
Object.defineProperty(lb.prototype,"onStart",{get:function(){this.m||(this.m=new q(this));return this.m}});Object.defineProperty(lb.prototype,"onProgress",{get:function(){this.j||(this.j=new q(this));return this.j}});Object.defineProperty(lb.prototype,"onComplete",{get:function(){this.f||(this.f=new q(this));return this.f}});Object.defineProperty(lb.prototype,"onStop",{get:function(){this.o||(this.o=new q(this));return this.o}});g.X={};g.X.LINEAR=function(a){return g.Math.ca(a,0,1)};
g.X.zi=function(a){return g.Math.ca(1+Math.sin(Math.PI/2*(a-1)),0,1)};g.X.Ai=function(a){return g.Math.ca(.5*(1+Math.sin(Math.PI/2*(2*a-1))),0,1)};g.X.Bi=function(a){return g.Math.ca(Math.sin(Math.PI/2*a),0,1)};g.X.vi=function(a){return g.Math.ca(a*a,0,1)};g.X.wi=function(a){return g.Math.ca(.5>a?2*a*a:1-2*(a-1)*(a-1),0,1)};g.X.xi=function(a){a=1-a;return g.Math.ca(1-a*a,0,1)};g.X.gh=function(a){return g.Math.ca(a*a*a,0,1)};
g.X.hh=function(a){return g.Math.ca(.5>a?4*a*a*a:1+4*(a-1)*(a-1)*(a-1),0,1)};g.X.ih=function(a){a=1-a;return g.Math.ca(1-a*a*a,0,1)};g.X.Oe=function(a){a<1/2.75?a*=7.5625*a:a<2/2.75?(a-=1.5/2.75,a=7.5625*a*a+.75):a<2.5/2.75?(a-=2.25/2.75,a=7.5625*a*a+.9375):(a-=2.625/2.75,a=7.5625*a*a+.984375);return g.Math.ca(a,0,1)};g.X.fh=function(a){return 1-g.X.Oe(1-a)};g.K={};
g.K.Fg=function(a){var b={value:null,Zc:null};if("string"===typeof a){var d=parseInt(a,10);!1===isNaN(d)&&(b.value=d);-1<a.indexOf("%")?b.Zc="%":-1<a.indexOf("px")&&(b.Zc="px")}return b};g.K.Cc=function(a,b,d){var h={};a="undefined"!==typeof a?a:{};b="undefined"!==typeof b?b:{};for(var k in a)a.hasOwnProperty(k)&&(h[k]=a[k]);for(var l in b)b.hasOwnProperty(l)&&(h[l]=!1!==d&&a&&null!==b[l]&&"undefined"!==typeof b[l]&&b[l].constructor===Object?g.K.Cc(a[l],b[l],!0):b[l]);return h};
g.K.pb=function(a){for(var b=arguments,d={},h=0,k=b.length;h<k;h++)d=g.K.Cc(d,b[h],!0);return d};g.K.clone=function(a){if(!(a instanceof Object))return a;var b=new a.constructor,d;for(d in a)b[d]=g.K.clone(a[d]);return b};g.K.co=function(a){return a&&"object"===typeof a&&"string"===typeof a.className&&-1!==kd.indexOf(a.className)?!0:!1};
g.K.W=function(a,b){if("string"===typeof b&&(null!==a&&"object"===typeof a&&"string"===typeof a.className&&a.className.toLowerCase()===b.toLowerCase()||typeof a===b.toLowerCase()))return!0;if(!0===Array.isArray(b)&&!0===g.K.Pa(b,"string"))for(var d=0,h=b.length;d<h;d++)if(!0===g.K.W(a,b[d]))return!0;return!1};g.K.ho=function(a,b,d){b=b.split(".");for(var h=0,k=b.length;h<k;h++){a=a[b[h]];if(h===k-1)return g.K.W(a,d);if("undefined"===typeof a)break}return!1};
g.K.Pa=function(a,b){if("object"===typeof a&&!0===Array.isArray(a)){for(var d=0,h=a.length;d<h;d++)if(!1===g.K.W(a[d],b))return!1;return!0}return!1};g.K.re=function(a,b,d){b=b.split(".");for(var h=0,k=b.length;h<k;h++){a=a[b[h]];if("undefined"===typeof a)break;if(h===k-1)return a}return d};g.K.Gd=function(a,b){var d=b.split("."),h=d.length;a.sort(function(a,b){for(var k=0;k<h;)a=a[d[k]],b=b[d[k]],k++;return a<b?-1:a>b?1:0});return a};
g.K.Dd=function(a){a=a.slice();for(var b,d,h=a.length-1;0<h;h--)d=~~(Math.random()*(h+1)),b=a[h],a[h]=a[d],a[d]=b;return a};g.K.ye=function(a,b,d){for(a=String(a);a.length<d;)a=b+a;return a};g.K.Ak=function(a){a={input:a,hours:0,minutes:0,seconds:0};if("number"!==typeof a.input||isNaN(a.input))return a;a.$n=parseInt(a.input/3600,10)%24;a.jo=parseInt(a.input/60,10)%60;a.seconds=parseInt(a.input%60,10);return a};
g.K.Mn=function(a,b){a=g.K.Ak(a);var d="string"===typeof b?b:"H:M:S";b=0;-1!==d.indexOf("H")?b=2:-1!==d.indexOf("h")&&(b=1);var h=0;-1!==d.indexOf("M")?h=2:-1!==d.indexOf("m")&&(h=1);var k=0;-1!==d.indexOf("S")?k=2:-1!==d.indexOf("s")&&(k=1);d=d.toLowerCase();0<b&&(d=d.replace("h",g.K.ye(a.$n,0,b)));0<h&&(d=d.replace("m",g.K.ye(a.jo,0,h)));0<k&&(d=d.replace("s",g.K.ye(a.seconds,0,k)));return d};g.K.Qg=function(a,b,d){return new THREE.Spherical(a,Math.PI/2-d,b)};
g.K.Pn=function(a){return{radius:a.radius,theta:a.theta,phi:Math.PI/2-a.phi}};g.K.wj=function(a,b){return a.filter(function(a){return 0>b.indexOf(a)})};g.K.mo=function(a,b){return b>=a.length?null:a.splice(b,1)};g.K.endsWith=function(a,b){return"function"!==typeof String.prototype.endsWith?-1!==a.indexOf(b,a.length-b.length):a.endsWith(b)};g.ka={};
g.ka.vd=function(a,b){var d=window.getComputedStyle(a,null).getPropertyValue("display");a.style.display="none";b=window.getComputedStyle(a,null).getPropertyValue(b);a.style.display=d;return b};g.ka.ak=function(a){a=g.ka.vd(a,"width");var b="px";-1<a.indexOf("%")&&(b="%");-1<a.indexOf("px")&&(b="px");return b};g.ka.ck=function(a){a=parseInt(g.ka.vd(a,"width"),10);return isNaN(a)?0:a};g.ka.$j=function(a){a=g.ka.vd(a,"height");var b="px";-1<a.indexOf("%")&&(b="%");-1<a.indexOf("px")&&(b="px");return b};
g.ka.bk=function(a){a=parseInt(g.ka.vd(a,"height"),10);return isNaN(a)?0:a};g.ka.has=function(a){return document.body.contains(a)};g.ka.sg=function(a){return a instanceof HTMLElement};
g.ka.Sn=function(a){var b,d;d=["MouseEvent","PointerEvent","TouchEvent"];"object"===typeof a.srcEvent&&d.indexOf(a.srcEvent.constructor.toString())?(b=a.target.getBoundingClientRect(),d=a.srcEvent.clientX-b.left,a=a.srcEvent.clientY-b.top):(b=(a.currentTarget||a.target||a.srcElement).getBoundingClientRect(),d=a.clientX-b.left,a=a.clientY-b.top);return{x:d,y:a}};function ne(){this.f=0;this.c={}}e=ne.prototype;e.constructor=ne;
e.set=function(a,b){if("undefined"!==typeof a)return void 0===this.c[a]&&this.f++,this.c[a]=b,this.f};e.af=function(a){if("undefined"!==typeof a&&void 0!==this.c[a])return delete this.c[a],--this.f};e.get=function(a){return this.c[a]};e.hl=function(){var a=new Qc,b;for(b in this.c)a.add(b);return a.Je()};e.il=function(){var a=new Qc,b;for(b in this.c)a.add(this.c[b]);return a.Je()};e.gl=function(){var a=new Qc,b;for(b in this.c){var d=[];d.push(b);d.push(this.c[b]);a.add(d)}return a.Je()};e.fl=function(){for(var a in this.c)this.af(a)};
e.has=function(a){return 0<this.f&&void 0!==this.c[a]};Object.defineProperty(ne.prototype,"size",{get:function(){return this.f}});function Qc(){this.c=[]}e=Qc.prototype;e.constructor=Qc;e.add=function(a){this.c.push(a);return this.c.length};e.remove=function(a){for(var b=0,d=this.c.length;b<d;b++)this.c[b]===a&&this.c.splice(b,1)};e.get=function(a){return this.c[a]};e.Je=function(){return this.c};Object.defineProperty(Qc.prototype,"size",{get:function(){return this.c.length}});
function ye(a){this.j=a;this.c=this.G=this.f=this.B=this.u=this.D="";this.o=null;this.m="";n.call(this,"URL")}ye.prototype=Object.create(n.prototype);ye.prototype.constructor=ye;
function ya(a){var b=new ye;"string"!==typeof a&&(a=window.location.toString());b.j=a;a=document.createElement("a");a.href=b.j;b.D=a.protocol;b.u=a.hostname;b.B=a.port;b.f=a.pathname;b.G=a.search;b.c=a.hash;b.m=b.f.substr(b.f.lastIndexOf(".")+1);if(""!==b.c){a=b.c.replace("#","").split("&");var d={};d.slug=a[0];for(var h=1,k=a.length;h<k;h++){var l=a[h].split("=");d[l[0]]=decodeURIComponent(l[1])}b.o=d}return b}Object.defineProperty(ye.prototype,"url",{get:function(){return this.j}});
Object.defineProperty(ye.prototype,"protocol",{get:function(){return this.D}});Object.defineProperty(ye.prototype,"host",{get:function(){return this.u}});Object.defineProperty(ye.prototype,"port",{get:function(){return this.B}});Object.defineProperty(ye.prototype,"path",{get:function(){return this.f}});Object.defineProperty(ye.prototype,"query",{get:function(){return this.G}});Object.defineProperty(ye.prototype,"hash",{get:function(){return this.c}});
Object.defineProperty(ye.prototype,"hashParameters",{get:function(){return this.o}});Object.defineProperty(ye.prototype,"extension",{get:function(){return this.m}});g.Color={};g.Color.oo=function(a,b,d){a/=255;b/=255;d/=255;var h=Math.max(a,b,d),k=Math.min(a,b,d),l,p=(h+k)/2;if(h===k)l=k=0;else{var r=h-k,k=.5<p?r/(2-h-k):r/(h+k);switch(h){case a:l=(b-d)/r+(b<d?6:0);break;case b:l=(d-a)/r+2;break;case d:l=(a-b)/r+4}l/=6}return{h:l,s:k,l:p}};
g.Color.ao=function(a,b,d){if(b){var h=.5>d?d*(1+b):d+b-d*b,k=2*d-h;d=g.Color.te(k,h,a+1/3);b=g.Color.te(k,h,a);a=g.Color.te(k,h,a-1/3)}else d=b=a=d;return{r:255*d,g:255*b,b:255*a}};g.Color.te=function(a,b,d){if(!(0>d||1<d)){if(d<1/6)return a+6*(b-a)*d;if(.5>d)return b;if(d<2/3)return a+(b-a)*(2/3-d)*6}return a};
g.Color.po=function(a,b,d){a/=255;b/=255;d/=255;var h=Math.max(a,b,d),k=Math.min(a,b,d),l,p=h-k;if(h===k)l=0;else{switch(h){case a:l=(b-d)/p+(b<d?6:0);break;case b:l=(d-a)/p+2;break;case d:l=(a-b)/p+4}l/=6}return{h:l,s:h?p/h:0,v:h}};
g.Color.bo=function(a,b,d){var h,k,l,p=Math.floor(6*a),r=6*a-p;a=d*(1-b);var u=d*(1-r*b);b=d*(1-(1-r)*b);switch(p%6){case 0:h=d;k=b;l=a;break;case 1:h=u;k=d;l=a;break;case 2:h=a;k=d;l=b;break;case 3:h=a;k=u;l=d;break;case 4:h=b;k=a;l=d;break;case 5:h=d,k=a,l=u}return{r:255*h,g:255*k,b:255*l}};g.Color.je=function(a){a=a.toString(16);return 1===a.length?"0"+a:a};g.Color.no=function(a,b,d){return"#"+g.Color.je(a)+g.Color.je(b)+g.Color.je(d)};
g.Color.Nn=function(a){a=a.split("(")[1].split(")")[0].split(",");var b={r:parseInt(a[0],10),g:parseInt(a[1],10),b:parseInt(a[2],10)};3<a.length&&(b.a=parseInt(a[3],10));return b};g.Color.Zn=function(a){a=a.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(a,d,h,k){return d+d+h+h+k+k});return(a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a))?{r:parseInt(a[1],16),g:parseInt(a[2],16),b:parseInt(a[3],16)}:null};
g.Color.qo=function(a){a=new THREE.Vector3(a.r,a.g,a.b);var b=(new THREE.Matrix3).set(.299,.587,.114,-.169,-.331,.5,.5,-.419,-.081),d=new THREE.Vector3(0,128,128);a.applyMatrix3(b).add(d);return{Y:a.x,Cr:a.y,Cb:a.z}};g.Color.Co=function(a){a=new THREE.Vector3(a.Y,a.Cr,a.Cb);var b=new THREE.Vector3(0,-128,-128),d=(new THREE.Matrix3).set(1,0,1.4,1,-.343,-.711,1,1.765,0);a.add(b).applyMatrix3(d);return{r:a.x,g:a.y,b:a.z}};
g.Color.Bo=function(a,b){var d=g.Math.ha(b);b=Math.cos(d);d=Math.sin(d);return{Y:a.Y,Cb:a.Cb*b-a.Cr*d,Cr:a.Cb*d+a.Cr*b}};g.Color.distance=function(a,b){return Math.sqrt((a.Cb-b.Cb)*(a.Cb-b.Cb)+(a.Cr-b.Cr)*(a.Cr-b.Cr))};function Ab(a,b,d,h){this.alpha=h}window.FORGE=g;window.FORGE.BaseObject=n;window.FORGE.Viewer=t;window.FORGE.Tags=g.mb;window.FORGE.UID=g.S;window.FORGE.Tour=x;window.FORGE.Group=F;window.FORGE.Scene=E;window.FORGE.SceneParser=G;window.FORGE.Rectangle=Ba;window.FORGE.Size=Ca;
window.FORGE.Media=Da;window.FORGE.RenderManager=y;window.FORGE.RenderScene=Qa;window.FORGE.RenderPipeline=Ha;window.FORGE.RenderDisplay=Fa;window.FORGE.RenderParams=db;window.FORGE.BackgroundRenderer=eb;window.FORGE.BackgroundMeshRenderer=Na;window.FORGE.BackgroundShaderRenderer=Ma;window.FORGE.PostProcessing=pa;window.FORGE.EffectComposer=Ra;window.FORGE.TexturePass=Ta;window.FORGE.ShaderPass=Va;window.FORGE.AdditionPass=Ya;window.FORGE.RenderPass=Sa;window.FORGE.ViewBase=hb;
window.FORGE.ViewGoPro=Pa;window.FORGE.ViewRectilinear=Oa;window.FORGE.Timeline=ib;window.FORGE.Keyframe=jb;window.FORGE.Animation=kb;window.FORGE.MetaAnimation=pb;window.FORGE.Track=sb;window.FORGE.Object3D=tb;window.FORGE.ObjectRenderer=Ga;window.FORGE.Raycaster=xb;window.FORGE.PickingDrawPass=Bb;window.FORGE.PickingManager=Ea;window.FORGE.HotspotManager=ma;window.FORGE.Hotspot3D=Eb;window.FORGE.HotspotSound=Kb;window.FORGE.HotspotMaterial=Ib;window.FORGE.HotspotTransform=Gb;
window.FORGE.HotspotAnimation=Hb;window.FORGE.HotspotAnimationTrack=Fb;window.FORGE.Camera=K;window.FORGE.CameraAnimation=dc;window.FORGE.CameraGaze=Sb;window.FORGE.ControllerManager=la;window.FORGE.ControllerBase=nc;window.FORGE.ControllerPointer=lc;window.FORGE.ControllerKeyboard=mc;window.FORGE.SoundManager=w;window.FORGE.Sound=L;window.FORGE.Playlist=N;window.FORGE.PlaylistManager=z;window.FORGE.PlaylistTrack=O;window.FORGE.Director=oa;window.FORGE.DirectorTrack=cc;
window.FORGE.ActionEventDispatcher=Lb;window.FORGE.Action=Ec;window.FORGE.ActionManager=na;window.FORGE.Plugin=P;window.FORGE.PluginEngine=Jc;window.FORGE.PluginManager=B;window.FORGE.PluginObjectFactory=Q;window.FORGE.Device=g.A;window.FORGE.RequestAnimationFrame=ia;window.FORGE.History=ka;window.FORGE.EventDispatcher=q;window.FORGE.Event=Xc;window.FORGE.Listener=Vc;window.FORGE.LocaleManager=ja;window.FORGE.LocaleString=D;window.FORGE.Locale=Zc;window.FORGE.Keyboard=qa;window.FORGE.KeyBinding=M;
window.FORGE.Drag=ed;window.FORGE.Pointer=U;window.FORGE.DisplayList=ea;window.FORGE.DisplayObject=T;window.FORGE.DisplayObjectContainer=v;window.FORGE.Image=H;window.FORGE.ImageScalable=Rb;window.FORGE.Sprite=Rc;window.FORGE.Iframe=yd;window.FORGE.TextField=S;window.FORGE.Button=Sc;window.FORGE.ButtonSkin=X;window.FORGE.Canvas=fa;window.FORGE.VideoHTML5=J;window.FORGE.VideoDash=I;window.FORGE.VideoTimeRanges=Zd;window.FORGE.VideoQuality=ee;window.FORGE.SpriteAnimationManager=xd;
window.FORGE.SpriteAnimation=Y;window.FORGE.Cache=ra;window.FORGE.File=se;window.FORGE.Loader=sa;window.FORGE.DependencyManager=ga;window.FORGE.Clock=ha;window.FORGE.Timer=Z;window.FORGE.TimerEvent=xe;window.FORGE.TweenManager=ta;window.FORGE.Tween=lb;window.FORGE.Map=ne;window.FORGE.Collection=Qc;window.FORGE.URL=ye;window.FORGE.ColorRGBA=Ab;n.prototype.log=n.prototype.log;n.prototype.warn=n.prototype.warn;n.prototype.destroy=n.prototype.destroy;t.prototype.update=t.prototype.update;
t.prototype.pause=t.prototype.pause;t.prototype.resume=t.prototype.resume;t.prototype.destroy=t.prototype.destroy;x.prototype.boot=x.prototype.boot;x.prototype.load=x.prototype.load;x.prototype.hasScenes=x.prototype.El;x.prototype.hasGroups=x.prototype.Ec;x.prototype.nextScene=x.prototype.Fl;x.prototype.previousScene=x.prototype.Gl;x.prototype.notifySceneConfigLoadComplete=x.prototype.yk;x.prototype.loadScene=x.prototype.Bd;x.prototype.loadGroup=x.prototype.sk;x.prototype.destroy=x.prototype.destroy;
F.prototype.load=F.prototype.load;F.prototype.hasChild=F.prototype.Ve;F.prototype.hasScene=F.prototype.Wc;F.prototype.hasGroup=F.prototype.wd;F.prototype.hasChildren=F.prototype.Vn;F.prototype.hasTypeOfChild=F.prototype.og;F.prototype.hasScenes=F.prototype.We;F.prototype.hasGroups=F.prototype.Ec;F.prototype.getChildrenUids=F.prototype.ud;F.prototype.getChildren=F.prototype.oe;F.prototype.nextScene=F.prototype.$k;F.prototype.previousScene=F.prototype.al;F.prototype.destroy=F.prototype.destroy;
E.prototype.addConfig=E.prototype.ma;E.prototype.load=E.prototype.load;E.prototype.unload=E.prototype.Le;E.prototype.hasGroup=E.prototype.wd;E.prototype.hasGroups=E.prototype.Ec;E.prototype.destroy=E.prototype.destroy;G.prototype.extendConfiguration=G.prototype.Jj;G.prototype.hasSoundSource=G.prototype.gk;G.prototype.hasSoundTarget=G.prototype.hk;G.prototype.isAmbisonic=G.prototype.nk;G.prototype.destroy=G.prototype.destroy;Da.prototype.destroy=Da.prototype.destroy;y.prototype.render=y.prototype.render;
y.prototype.screenToWorld=y.prototype.screenToWorld;y.prototype.worldToScreen=y.prototype.worldToScreen;y.prototype.enableVR=y.prototype.Al;y.prototype.setView=y.prototype.Fd;y.prototype.destroy=y.prototype.destroy;Qa.prototype.setSize=Qa.prototype.setSize;Qa.prototype.destroy=Qa.prototype.destroy;Ha.prototype.enablePicking=Ha.prototype.hg;Ha.prototype.addBackground=Ha.prototype.pj;Ha.prototype.addRenderScenes=Ha.prototype.rj;Ha.prototype.addGlobalFx=Ha.prototype.qj;
Ha.prototype.getShaderPassByUID=Ha.prototype.Tn;Ha.prototype.setSize=Ha.prototype.setSize;Ha.prototype.render=Ha.prototype.render;Ha.prototype.clear=Ha.prototype.gf;Ha.prototype.destroy=Ha.prototype.destroy;Fa.prototype.enableVR=Fa.prototype.Yh;Fa.prototype.getQuaternionFromPose=Fa.prototype.Vj;Fa.prototype.getRenderParams=Fa.prototype.Xj;Fa.prototype.setSize=Fa.prototype.setSize;Fa.prototype.submitFrame=Fa.prototype.Zh;Fa.prototype.destroy=Fa.prototype.destroy;
eb.prototype.updateAfterViewChange=eb.prototype.vc;eb.prototype.setSize=eb.prototype.setSize;eb.prototype.render=eb.prototype.render;eb.prototype.destroy=eb.prototype.destroy;Na.prototype.render=Na.prototype.render;Na.prototype.updateAfterViewChange=Na.prototype.vc;Na.prototype.destroy=Na.prototype.destroy;Ma.prototype.render=Ma.prototype.render;Ma.prototype.updateAfterViewChange=Ma.prototype.vc;Ma.prototype.destroy=Ma.prototype.destroy;pa.prototype.parseShaderPasses=pa.prototype.Ee;
pa.prototype.getFxSetByUID=pa.prototype.pe;pa.prototype.addConfig=pa.prototype.ma;pa.prototype.destroy=pa.prototype.destroy;Ra.prototype.destroy=Ra.prototype.destroy;Va.prototype.render=Va.prototype.render;Ya.prototype.destroy=Ya.prototype.destroy;hb.prototype.shaderSTW=hb.prototype.Yc;hb.prototype.shaderWTS=hb.prototype.sc;hb.prototype.updateScreenToWorld=hb.prototype.Gc;hb.prototype.worldToScreen=hb.prototype.worldToScreen;hb.prototype.screenToWorld=hb.prototype.screenToWorld;
hb.prototype.destroy=hb.prototype.destroy;Pa.prototype.shaderSTW=Pa.prototype.Yc;Pa.prototype.shaderWTS=Pa.prototype.sc;Pa.prototype.updateScreenToWorld=Pa.prototype.Gc;Pa.prototype.destroy=Pa.prototype.destroy;Oa.prototype.shaderSTW=Oa.prototype.Yc;Oa.prototype.shaderWTS=Oa.prototype.sc;Oa.prototype.updateScreenToWorld=Oa.prototype.Gc;Oa.prototype.worldToScreen=Oa.prototype.worldToScreen;Oa.prototype.screenToWorld=Oa.prototype.screenToWorld;Oa.prototype.destroy=Oa.prototype.destroy;
ib.prototype.hasKeyframes=ib.prototype.Wn;ib.prototype.addKeyframe=ib.prototype.Pb;ib.prototype.getKeyframes=ib.prototype.Rn;ib.prototype.getKeyframesIndexes=ib.prototype.qe;ib.prototype.getSideKeyframes=ib.prototype.Yj;ib.prototype.getSideKeyframesIndexes=ib.prototype.Zj;ib.prototype.emptyKeyframes=ib.prototype.Ln;ib.prototype.destroy=ib.prototype.destroy;kb.prototype.play=kb.prototype.play;kb.prototype.stop=kb.prototype.stop;kb.prototype.resume=kb.prototype.resume;kb.prototype.destroy=kb.prototype.destroy;
pb.prototype.stop=pb.prototype.stop;pb.prototype.resume=pb.prototype.resume;pb.prototype.destroy=pb.prototype.destroy;sb.prototype.destroy=sb.prototype.destroy;tb.prototype.click=tb.prototype.click;tb.prototype.over=tb.prototype.cf;tb.prototype.out=tb.prototype.Nd;tb.prototype.destroy=tb.prototype.destroy;Ga.prototype.register=Ga.prototype.register;Ga.prototype.unregister=Ga.prototype.unregister;Ga.prototype.createRenderScenes=Ga.prototype.Aj;Ga.prototype.getRaycastable=Ga.prototype.Wj;
Ga.prototype.getByMesh=Ga.prototype.Tj;Ga.prototype.clear=Ga.prototype.df;Ga.prototype.destroy=Ga.prototype.destroy;xb.prototype.start=xb.prototype.start;xb.prototype.stop=xb.prototype.stop;xb.prototype.click=xb.prototype.click;xb.prototype.clear=xb.prototype.Xh;Bb.prototype.start=Bb.prototype.start;Bb.prototype.stop=Bb.prototype.stop;Bb.prototype.click=Bb.prototype.click;Bb.prototype.setSize=Bb.prototype.setSize;Bb.prototype.clear=Bb.prototype.Hh;Bb.prototype.destroy=Bb.prototype.destroy;
Ea.prototype.updateForViewType=Ea.prototype.Qk;Ea.prototype.clear=Ea.prototype.Ih;Ea.prototype.setSize=Ea.prototype.setSize;Ea.prototype.click=Ea.prototype.click;Ea.prototype.start=Ea.prototype.start;Ea.prototype.stop=Ea.prototype.stop;Ea.prototype.destroy=Ea.prototype.destroy;ma.prototype.boot=ma.prototype.boot;ma.prototype.getByType=ma.prototype.Qn;ma.prototype.addConfig=ma.prototype.ma;ma.prototype.addTracks=ma.prototype.sj;ma.prototype.update=ma.prototype.update;ma.prototype.clear=ma.prototype.Xe;
ma.prototype.destroy=ma.prototype.destroy;Eb.prototype.update=Eb.prototype.update;Eb.prototype.destroy=Eb.prototype.destroy;Kb.prototype.load=Kb.prototype.load;Kb.prototype.update=Kb.prototype.update;Kb.prototype.destroy=Kb.prototype.destroy;Ib.prototype.load=Ib.prototype.load;Ib.prototype.update=Ib.prototype.update;Ib.prototype.destroy=Ib.prototype.destroy;Gb.prototype.computeSizeFromAnglesAndMaterial=Gb.prototype.m;Gb.prototype.load=Gb.prototype.load;Gb.prototype.destroy=Gb.prototype.destroy;
Hb.prototype.load=Hb.prototype.load;Hb.prototype.play=Hb.prototype.play;K.prototype.load=K.prototype.load;K.prototype.lookAt=K.prototype.uk;K.prototype.update=K.prototype.update;K.prototype.destroy=K.prototype.destroy;dc.prototype.play=dc.prototype.play;dc.prototype.destroy=dc.prototype.destroy;Sb.prototype.load=Sb.prototype.load;Sb.prototype.start=Sb.prototype.start;Sb.prototype.stop=Sb.prototype.stop;Sb.prototype.update=Sb.prototype.update;Sb.prototype.destroy=Sb.prototype.destroy;
la.prototype.notifyControlStart=la.prototype.Be;la.prototype.notifyControlEnd=la.prototype.Ae;la.prototype.update=la.prototype.update;la.prototype.addConfig=la.prototype.ma;la.prototype.destroy=la.prototype.destroy;nc.prototype.enable=nc.prototype.enable;nc.prototype.disable=nc.prototype.cc;nc.prototype.destroy=nc.prototype.destroy;lc.prototype.enable=lc.prototype.enable;lc.prototype.disable=lc.prototype.cc;lc.prototype.update=lc.prototype.update;lc.prototype.destroy=lc.prototype.destroy;
mc.prototype.enable=mc.prototype.enable;mc.prototype.disable=mc.prototype.cc;mc.prototype.update=mc.prototype.update;mc.prototype.destroy=mc.prototype.destroy;w.prototype.boot=w.prototype.boot;w.prototype.addConfig=w.prototype.ma;w.prototype.update=w.prototype.update;w.prototype.add=w.prototype.add;w.prototype.remove=w.prototype.remove;w.prototype.autoSuspend=w.prototype.Zf;w.prototype.autoResume=w.prototype.Yf;w.prototype.mute=w.prototype.qb;w.prototype.unmute=w.prototype.ci;
w.prototype.destroy=w.prototype.destroy;L.prototype.update=L.prototype.update;L.prototype.play=L.prototype.play;L.prototype.stop=L.prototype.stop;L.prototype.pause=L.prototype.pause;L.prototype.resume=L.prototype.resume;L.prototype.mute=L.prototype.qb;L.prototype.unmute=L.prototype.gi;L.prototype.destroy=L.prototype.destroy;N.prototype.hasTracks=N.prototype.ul;N.prototype.play=N.prototype.play;N.prototype.stop=N.prototype.stop;N.prototype.pause=N.prototype.pause;N.prototype.resume=N.prototype.resume;
N.prototype.nextTrack=N.prototype.Cd;N.prototype.previousTrack=N.prototype.Ge;N.prototype.destroy=N.prototype.destroy;z.prototype.boot=z.prototype.boot;z.prototype.addConfig=z.prototype.ma;z.prototype.add=z.prototype.add;z.prototype.addTrack=z.prototype.Kh;z.prototype.hasPlaylists=z.prototype.Xn;z.prototype.hasTracks=z.prototype.ol;z.prototype.play=z.prototype.play;z.prototype.stop=z.prototype.stop;z.prototype.pause=z.prototype.pause;z.prototype.resume=z.prototype.resume;z.prototype.nextTrack=z.prototype.Cd;
z.prototype.previousTrack=z.prototype.Ge;z.prototype.destroy=z.prototype.destroy;O.prototype.play=O.prototype.play;O.prototype.stop=O.prototype.stop;O.prototype.pause=O.prototype.pause;O.prototype.resume=O.prototype.resume;O.prototype.destroy=O.prototype.destroy;oa.prototype.load=oa.prototype.load;oa.prototype.play=oa.prototype.play;oa.prototype.stop=oa.prototype.stop;oa.prototype.destroy=oa.prototype.destroy;Lb.prototype.addActions=Lb.prototype.c;Lb.prototype.dispatch=Lb.prototype.F;
Lb.prototype.destroy=Lb.prototype.destroy;Ec.prototype.execute=Ec.prototype.Qb;Ec.prototype.destroy=Ec.prototype.destroy;na.prototype.get=na.prototype.get;na.prototype.addConfig=na.prototype.ma;na.prototype.destroy=na.prototype.destroy;P.prototype.instantiate=P.prototype.mk;P.prototype.notifyInstanceReady=P.prototype.lo;P.prototype.update=P.prototype.update;P.prototype.resetInstance=P.prototype.Ek;P.prototype.destroy=P.prototype.destroy;Jc.prototype.load=Jc.prototype.load;
Jc.prototype.getNewInstance=Jc.prototype.Uj;Jc.prototype.destroy=Jc.prototype.destroy;B.prototype.boot=B.prototype.boot;B.prototype.addConfig=B.prototype.ma;B.prototype.getById=B.prototype.ne;B.prototype.getByIndex=B.prototype.Sj;B.prototype.get=B.prototype.get;B.prototype.remove=B.prototype.remove;B.prototype.update=B.prototype.update;B.prototype.render=B.prototype.render;B.prototype.destroy=B.prototype.destroy;Q.prototype.string=Q.prototype.vo;Q.prototype.textField=Q.prototype.wo;
Q.prototype.sound=Q.prototype.sound;Q.prototype.displayObjectContainer=Q.prototype.Kn;Q.prototype.displayObject=Q.prototype.xl;Q.prototype.image=Q.prototype.image;Q.prototype.sprite=Q.prototype.so;Q.prototype.button=Q.prototype.wl;Q.prototype.video=Q.prototype.zl;Q.prototype.canvas=Q.prototype.canvas;Q.prototype.tween=Q.prototype.yl;Q.prototype.destroyAllObjects=Q.prototype.Fj;Q.prototype.destroy=Q.prototype.destroy;ia.prototype.boot=ia.prototype.boot;ia.prototype.start=ia.prototype.start;
ia.prototype.stop=ia.prototype.stop;ia.prototype.destroy=ia.prototype.destroy;ka.prototype.addConfig=ka.prototype.ma;ka.prototype.destroy=ka.prototype.destroy;q.prototype.add=q.prototype.add;q.prototype.addOnce=q.prototype.ga;q.prototype.remove=q.prototype.remove;q.prototype.has=q.prototype.has;q.prototype.dispatch=q.prototype.F;q.prototype.destroy=q.prototype.destroy;Vc.prototype.execute=Vc.prototype.Qb;Vc.prototype.detach=Vc.prototype.Fh;Vc.prototype.destroy=Vc.prototype.destroy;
ja.prototype.addConfig=ja.prototype.ma;ja.prototype.getValue=ja.prototype.nc;ja.prototype.hasValue=ja.prototype.Mb;ja.prototype.destroy=ja.prototype.destroy;D.prototype.destroy=D.prototype.destroy;Zc.prototype.addConfig=Zc.prototype.ma;Zc.prototype.loadFiles=Zc.prototype.xg;Zc.prototype.getValue=Zc.prototype.nc;Zc.prototype.hasValue=Zc.prototype.Mb;Zc.prototype.getKey=Zc.prototype.Gh;Zc.prototype.destroy=Zc.prototype.destroy;qa.prototype.update=qa.prototype.update;qa.prototype.isKeyPressed=qa.prototype.eo;
qa.prototype.isKeyOut=qa.prototype.ug;qa.prototype.addBinding=qa.prototype.Wf;qa.prototype.removeBinding=qa.prototype.He;qa.prototype.hasBinding=qa.prototype.Un;qa.prototype.getBindings=qa.prototype.kg;qa.prototype.destroy=qa.prototype.destroy;M.prototype.hasKeyIn=M.prototype.se;M.prototype.hasKeyOut=M.prototype.ng;M.prototype.down=M.prototype.Eh;M.prototype.waitToHold=M.prototype.zo;M.prototype.up=M.prototype.Pk;M.prototype.hold=M.prototype.jk;M.prototype.destroy=M.prototype.destroy;
ed.prototype.enable=ed.prototype.enable;ed.prototype.disable=ed.prototype.Ah;ed.prototype.destroy=ed.prototype.destroy;U.prototype.enable=U.prototype.enable;U.prototype.disable=U.prototype.ef;U.prototype.destroy=U.prototype.destroy;ea.prototype.register=ea.prototype.register;ea.prototype.unregister=ea.prototype.unregister;ea.prototype.update=ea.prototype.update;ea.prototype.destroy=ea.prototype.destroy;T.prototype.show=T.prototype.wh;T.prototype.hide=T.prototype.ik;T.prototype.toggleVisibility=T.prototype.xo;
T.prototype.maximize=T.prototype.Sb;T.prototype.isInDom=T.prototype.Ad;T.prototype.resize=T.prototype.vh;T.prototype.fullscreenEnter=T.prototype.Nj;T.prototype.fullscreenExit=T.prototype.Oj;T.prototype.isFullscreen=T.prototype.zd;T.prototype.destroy=T.prototype.destroy;v.prototype.update=v.prototype.update;v.prototype.addChild=v.prototype.mc;v.prototype.addChildAt=v.prototype.Dn;v.prototype.fitToContent=v.prototype.Mj;v.prototype.removeChild=v.prototype.removeChild;v.prototype.removeChildAt=v.prototype.Gg;
v.prototype.empty=v.prototype.uh;v.prototype.hasChild=v.prototype.Xk;v.prototype.destroy=v.prototype.destroy;H.prototype.load=H.prototype.load;H.prototype.unload=H.prototype.Le;H.prototype.destroy=H.prototype.destroy;Rb.prototype.destroy=Rb.prototype.destroy;Rc.prototype.play=Rc.prototype.play;Rc.prototype.pause=Rc.prototype.pause;Rc.prototype.resume=Rc.prototype.resume;Rc.prototype.stop=Rc.prototype.stop;Rc.prototype.update=Rc.prototype.update;Rc.prototype.destroy=Rc.prototype.destroy;
yd.prototype.load=yd.prototype.load;yd.prototype.destroy=yd.prototype.destroy;S.prototype.load=S.prototype.load;S.prototype.destroy=S.prototype.destroy;Sc.prototype.load=Sc.prototype.load;Sc.prototype.addSkin=Sc.prototype.Bc;Sc.prototype.setSkin=Sc.prototype.Ik;Sc.prototype.hasSkin=Sc.prototype.fk;Sc.prototype.updateSkin=Sc.prototype.yo;Sc.prototype.destroy=Sc.prototype.destroy;X.prototype.setDefaultFromState=X.prototype.Mg;X.prototype.getProperty=X.prototype.$a;X.prototype.hasImage=X.prototype.ek;
X.prototype.hasLabel=X.prototype.m;J.prototype.update=J.prototype.update;J.prototype.load=J.prototype.load;J.prototype.play=J.prototype.play;J.prototype.pause=J.prototype.pause;J.prototype.stop=J.prototype.stop;J.prototype.togglePlayback=J.prototype.Ol;J.prototype.mute=J.prototype.qb;J.prototype.unmute=J.prototype.mi;J.prototype.destroy=J.prototype.destroy;I.prototype.load=I.prototype.load;I.prototype.play=I.prototype.play;I.prototype.pause=I.prototype.pause;I.prototype.stop=I.prototype.stop;
I.prototype.togglePlayback=I.prototype.Nl;I.prototype.mute=I.prototype.qb;I.prototype.unmute=I.prototype.ji;I.prototype.enableBufferOccupancyABR=I.prototype.Ml;I.prototype.destroy=I.prototype.destroy;Zd.prototype.getTimeRange=Zd.prototype.j;Zd.prototype.isInRanges=Zd.prototype.qk;xd.prototype.add=xd.prototype.add;xd.prototype.play=xd.prototype.play;xd.prototype.pause=xd.prototype.pause;xd.prototype.resume=xd.prototype.resume;xd.prototype.stop=xd.prototype.stop;xd.prototype.get=xd.prototype.get;
xd.prototype.update=xd.prototype.update;xd.prototype.destroy=xd.prototype.destroy;Y.prototype.play=Y.prototype.play;Y.prototype.pause=Y.prototype.pause;Y.prototype.resume=Y.prototype.resume;Y.prototype.stop=Y.prototype.stop;Y.prototype.update=Y.prototype.update;Y.prototype.destroy=Y.prototype.destroy;ra.prototype.has=ra.prototype.has;ra.prototype.get=ra.prototype.get;ra.prototype.add=ra.prototype.add;ra.prototype.remove=ra.prototype.remove;ra.prototype.destroy=ra.prototype.destroy;
se.prototype.key=se.prototype.key;se.prototype.url=se.prototype.url;se.prototype.type=se.prototype.type;se.prototype.data=se.prototype.data;se.prototype.xhr=se.prototype.Ao;se.prototype.loading=se.prototype.Rb;se.prototype.loaded=se.prototype.Zk;se.prototype.error=se.prototype.Yk;sa.prototype.json=sa.prototype.json;sa.prototype.xml=sa.prototype.el;sa.prototype.sound=sa.prototype.sound;sa.prototype.image=sa.prototype.image;sa.prototype.script=sa.prototype.Lg;sa.prototype.css=sa.prototype.Bj;
sa.prototype.destroy=sa.prototype.destroy;ga.prototype.add=ga.prototype.add;ga.prototype.destroy=ga.prototype.destroy;ha.prototype.create=ha.prototype.create;ha.prototype.add=ha.prototype.add;ha.prototype.update=ha.prototype.update;ha.prototype.destroy=ha.prototype.destroy;Z.prototype.create=Z.prototype.create;Z.prototype.add=Z.prototype.add;Z.prototype.repeat=Z.prototype.Cl;Z.prototype.loop=Z.prototype.jf;Z.prototype.remove=Z.prototype.remove;Z.prototype.start=Z.prototype.start;
Z.prototype.stop=Z.prototype.stop;Z.prototype.pause=Z.prototype.pause;Z.prototype.resume=Z.prototype.resume;Z.prototype.update=Z.prototype.update;Z.prototype.destroy=Z.prototype.destroy;xe.prototype.execute=xe.prototype.Qb;ta.prototype.add=ta.prototype.add;ta.prototype.remove=ta.prototype.remove;ta.prototype.update=ta.prototype.update;ta.prototype.destroy=ta.prototype.destroy;lb.prototype.to=lb.prototype.kf;lb.prototype.start=lb.prototype.start;lb.prototype.stop=lb.prototype.stop;
lb.prototype.update=lb.prototype.update;lb.prototype.destroy=lb.prototype.destroy;ne.prototype.set=ne.prototype.set;ne.prototype["delete"]=ne.prototype.af;ne.prototype.get=ne.prototype.get;ne.prototype.keys=ne.prototype.hl;ne.prototype.values=ne.prototype.il;ne.prototype.entries=ne.prototype.gl;ne.prototype.clear=ne.prototype.fl;ne.prototype.has=ne.prototype.has;Qc.prototype.add=Qc.prototype.add;Qc.prototype.remove=Qc.prototype.remove;Qc.prototype.get=Qc.prototype.get;Qc.prototype.toArray=Qc.prototype.Je;
window.FORGE.Math=g.Math;g.Math.degToRad=g.Math.ha;g.Math.radToDeg=g.Math.pc;g.Math.round10=g.Math.Ed;g.Math.clamp=g.Math.ca;g.Math.wrap=g.Math.eb;g.Math.mix=g.Math.ko;g.Math.smoothStep=g.Math.ro;g.Math.rotationMatrixToEuler=g.Math.Hg;g.Math.eulerToRotationMatrix=g.Math.le;window.FORGE.Quaternion=g.Quaternion;g.Quaternion.toEuler=g.Quaternion.Ke;g.Quaternion.fromEuler=g.Quaternion.Dc;g.Quaternion.toRotationMatrix=g.Quaternion.Lk;g.Quaternion.fromRotationMatrix=g.Quaternion.On;
g.Quaternion.cancelRoll=g.Quaternion.cancelRoll;g.Quaternion.diffBetweenQuaternions=g.Quaternion.Jn;g.Quaternion.angularDistance=g.Quaternion.vj;g.Quaternion.multiplyScalar=g.Quaternion.multiplyScalar;g.Quaternion.add=g.Quaternion.add;g.Quaternion.log=g.Quaternion.log;g.Quaternion.exp=g.Quaternion.exp;g.Quaternion.slerp=g.Quaternion.slerp;g.Quaternion.squad=g.Quaternion.uo;g.Quaternion.nlerpNoInvert=g.Quaternion.xk;g.Quaternion.slerpNoInvert=g.Quaternion.Ie;g.Quaternion.squadNoInvert=g.Quaternion.Jk;
g.Quaternion.spline=g.Quaternion.Og;Ra.getUniqueName=gb;g.ShaderLib.parseIncludes=g.ShaderLib.sb;Bb.colorFrom3DObject=Cb;X.isValid=function(a){return a?!0:!1};ee.mimeTypeFromURL=le;window.FORGE.Easing=g.X;g.X.LINEAR=g.X.LINEAR;g.X.SINE_IN=g.X.zi;g.X.SINE_IN_OUT=g.X.Ai;g.X.SINE_OUT=g.X.Bi;g.X.QUAD_IN=g.X.vi;g.X.QUAD_IN_OUT=g.X.wi;g.X.QUAD_OUT=g.X.xi;g.X.CUBIC_IN=g.X.gh;g.X.CUBIC_IN_OUT=g.X.hh;g.X.CUBIC_OUT=g.X.ih;g.X.BOUNCE_OUT=g.X.Oe;g.X.BOUNCE_IN=g.X.fh;window.FORGE.Utils=g.K;
g.K.parseSizeString=g.K.Fg;g.K.extendSimpleObject=g.K.Cc;g.K.extendMultipleObjects=g.K.pb;g.K.clone=g.K.clone;g.K.isDisplayObject=g.K.co;g.K.isTypeOf=g.K.W;g.K.isTypeOfRecursive=g.K.ho;g.K.isArrayOf=g.K.Pa;g.K.getObjectProperty=g.K.re;g.K.sortArrayByProperty=g.K.Gd;g.K.randomize=g.K.Dd;g.K.leftFill=g.K.ye;g.K.parseTime=g.K.Ak;g.K.formatTime=g.K.Mn;g.K.toTHREESpherical=g.K.Qg;g.K.fromTHREESpherical=g.K.Pn;g.K.arrayByDifference=g.K.wj;g.K.removeItemFromArrayAtIndex=g.K.mo;g.K.endsWith=g.K.endsWith;
window.FORGE.Dom=g.ka;g.ka.getCssProperty=g.ka.vd;g.ka.getUnitWidth=g.ka.ak;g.ka.getValueWidth=g.ka.ck;g.ka.getUnitHeight=g.ka.$j;g.ka.getValueHeight=g.ka.bk;g.ka.has=g.ka.has;g.ka.isHtmlElement=g.ka.sg;g.ka.getMouseEventOffset=g.ka.Sn;ye.parse=ya;
ye.exists=function(a,b,d,h){var k=new XMLHttpRequest,l=null;k.onreadystatechange=function(){4===this.readyState&&200===this.status&&(clearTimeout(l),"function"===typeof b&&b.call(h))};k.onerror=function(a){console.log(a)};k.open("HEAD",a);k.send();l=window.setTimeout(function(){"function"===typeof d&&d.call(h)},500)};
ye.isValid=function(a){return/((([A-Za-z]{3,9}:(?:\/\/)?)(?:[\-;:&=\+\$,\w]+@)?[A-Za-z0-9\.\-]+|(?:www\.|[\-;:&=\+\$,\w]+@)[A-Za-z0-9\.\-]+)((?:\/[\+~%\/\.\w\-]*)?\??(?:[\-\+=&;%@\.\w]*)#?(?:[\.\!\/\\\w]*))?)/.test(a)?!0:!1};window.FORGE.Color=g.Color;g.Color.rgbToHsl=g.Color.oo;g.Color.hslToRgb=g.Color.ao;g.Color.hueToRgb=g.Color.te;g.Color.rgbToHsv=g.Color.po;g.Color.hsvToRgb=g.Color.bo;g.Color.componentToHex=g.Color.je;g.Color.rgbToHex=g.Color.no;g.Color.fromRgbaString=g.Color.Nn;
g.Color.hexToRgb=g.Color.Zn;g.Color.rgbToYcbcr=g.Color.qo;g.Color.ycbcrToRgb=g.Color.Co;g.Color.ycbcrRotate=g.Color.Bo;g.Color.distance=g.Color.distance;g.A.canPlayAudio=g.A.Hn;g.A.canPlayVideo=g.A.In;g.A.isLowBattery=g.A.fo;g.A.os=g.A.rb;g.A.vita=g.A.Tg;g.A.xbox=g.A.dh;g.A.kindle=g.A.vg;g.A.windowsPhone=g.A.Me;g.A.osVersion=g.A.oc;g.A.android=g.A.tj;g.A.chromeOS=g.A.ag;g.A.iOS=g.A.Xc;g.A.linux=g.A.wg;g.A.macOS=g.A.zg;g.A.windows=g.A.bh;g.A.ie=g.A.yd;g.A.edge=g.A.ke;g.A.firefox=g.A.ig;g.A.opera=g.A.opera;
g.A.safari=g.A.Ig;g.A.chrome=g.A.chrome;g.A.browser=g.A.Bb;g.A.browserVersion=g.A.ob;g.A.edgeVersion=g.A.Hj;g.A.chromeVersion=g.A.bg;g.A.firefoxVersion=g.A.Lj;g.A.silk=g.A.Ng;g.A.ieVersion=g.A.rg;g.A.operaVersion=g.A.Ce;g.A.safariVersion=g.A.Gk;g.A.isAndroidStockBrowser=g.A.pk;g.A.androidStockBrowserVersion=g.A.uj;g.A.webApp=g.A.Sk;g.A.quirksMode=g.A.Dk;g.A.pixelRatio=g.A.Fc;g.A.iPhone=g.A.kk;g.A.iPod=g.A.lk;g.A.iPad=g.A.qg;g.A.retina=g.A.Fk;g.A.desktop=g.A.Vc;g.A.mobile=g.A.ze;g.A.tablet=g.A.Pg;
g.A.other=g.A.zk;g.A.oggVideo=g.A.Eg;g.A.h264Video=g.A.mg;g.A.mp4Video=g.A.Cg;g.A.webmVideo=g.A.ah;g.A.vp9Video=g.A.Ug;g.A.hlsVideo=g.A.pg;g.A.audioTag=g.A.Xf;g.A.webAudio=g.A.Wg;g.A.ogg=g.A.Dg;g.A.mp3=g.A.Ag;g.A.opus=g.A.De;g.A.wav=g.A.Vg;g.A.aac=g.A.Vf;g.A.m4a=g.A.yg;g.A.mp4=g.A.Bg;g.A.webm=g.A.$g;g.A.weba=g.A.Zg;g.A.vibrate=g.A.Rg;g.A.battery=g.A.$f;g.A.canvas=g.A.canvas;g.A.canvasText=g.A.yj;g.A.canvasWinding=g.A.zj;g.A.localStorage=g.A.localStorage;g.A.mediaSource=g.A.wk;g.A.encryptedMedia=g.A.Ij;
g.A.applicationCache=g.A.applicationCache;g.A.addEventListener=g.A.addEventListener;g.A.raf=g.A.Fo;g.A.webGL=g.A.Xg;g.A.webVR=g.A.Yg;g.A.geolocation=g.A.geolocation;g.A.history=g.A.history;g.A.svg=g.A.Kk;g.A.contextMenu=g.A.contextMenu;g.A.isSecure=g.A.rk;g.A.isIframe=g.A.tg;g.A.touch=g.A.Mk;g.A.touchForce=g.A.Nk;g.A.gamepad=g.A.Rj;g.A.requestFullscreen=g.A.requestFullscreen;g.A.exitFullscreen=g.A.exitFullscreen;g.A.fullscreenKeyboard=g.A.Pj;g.A.fullscreenElement=g.A.fullscreenElement;
g.A.fullscreenEnabled=g.A.fullscreenEnabled;g.A.visibilityState=g.A.visibilityState;g.A.visibilityChange=g.A.Sg;g.A.orientation=g.A.orientation;g.A.screenOrientation=g.A.Hk;g.A.lockOrientation=g.A.tk;g.A.unlockOrientation=g.A.Ok;g.A.file=g.A.file;g.A.fileSystem=g.A.Kj;g.A.pointerLock=g.A.Ck;g.A.cssPointerEvents=g.A.td;g.A.cssRgba=g.A.Ej;g.A.cssAnimation=g.A.Dj;g.A.css3D=g.A.Cj;g.A.deviceMotionRotationRate=g.A.eg;g.A.deviceMotionAcceleration=g.A.dg;g.A.deviceOrientationMagnetometer=g.A.gg;
g.A.deviceMotion=g.A.cg;g.A.deviceOrientation=g.A.fg;g.A.dpi=g.A.Gj;g.A.screenWidth=g.A.Kg;g.A.screenHeight=g.A.Jg;g.A.ua=g.A.ea;g.A.language=g.A.language;g.A.gyroscope=g.A.dk;g.A.ready=g.A.ready;g.S.generate=g.S.jg;g.S.validate=g.S.Rk;g.S.register=g.S.register;g.S.unregister=g.S.unregister;g.S.getUids=g.S.lg;g.S.filterType=g.S.me;g.S.get=g.S.get;g.S.isTypeOf=g.S.W;g.S.exists=g.S.hb;g.mb.register=g.mb.register;g.mb.getUids=g.mb.lg;g.mb.get=g.mb.get;g.mb.hasTypeOf=g.mb.Yn;g.mb.exists=g.mb.hb;
t.DEFAULT_CONFIG=da;window.FORGE.Cache.types=C;C.JSON=C.JSON;window.FORGE.SoundType=g.lb;g.lb.AMBISONIC=g.lb.Ne;window.FORGE.Math=g.Math;g.Math.DEGREES=g.Math.Wa;g.Math.RADIANS=g.Math.Db;g.Math.DEG2RAD=g.Math.jh;g.Math.RAD2DEG=g.Math.yi;g.Math.TWOPI=g.Math.Fi;window.FORGE.MediaType=g.ub;g.ub.IMAGE=g.ub.IMAGE;g.ub.VIDEO=g.ub.VIDEO;window.FORGE.MediaFormat=g.Oa;g.Oa.EQUIRECTANGULAR=g.Oa.cd;g.Oa.CUBE=g.Oa.Kd;g.Oa.FLAT=g.Oa.mh;g.Oa.HOTSPOT=g.Oa.Tl;window.FORGE.VideoFormat=g.nb;g.nb.DASH=g.nb.Pe;
window.FORGE.BackgroundType=g.Za;g.Za.UNDEFINED=g.Za.Sd;window.FORGE.ViewType=g.Ia;g.Ia.RECTILINEAR=g.Ia.Ob;g.Ia.GOPRO=g.Ia.wc;g.Za.MESH=g.Za.Qd;g.Za.SHADER=g.Za.Rd;window.FORGE.PickingManager.modes=La;La.GAZE=La.Mc;La.POINTER=La.kb;window.FORGE.EffectComposerType=g.ab;g.ab.RENDER=g.ab.ic;window.FORGE.PassPosition=g.Ma;g.Ma.RENDER=g.Ma.ic;g.ab.PICKING=g.ab.xf;g.ab.MAIN=g.ab.pi;g.Ma.BACKGROUND=g.Ma.Id;g.Ma.GLOBAL=g.Ma.lf;g.Ma.UNKNOWN=g.Ma.Td;g.Ia.UNDEFINED=g.Ia.Sd;window.FORGE.HotspotType=g.Nc;
g.Nc.THREE_DIMENSIONAL=g.Nc.Jf;window.FORGE.HotspotMaterial.presets=Jb;Jb.TRANSPARENT=Jb.Ei;Jb.DEBUG=Jb.Ld;Mb.GRAPHICS=Mb.Pd;K.RADIUS=50;Mb.IMAGE=Mb.IMAGE;Mb.PLUGIN=Mb.ui;K.DEFAULT_CONFIG=Tb;window.FORGE.Easing=g.X;g.X.LINEAR=g.X.LINEAR;window.FORGE.ControllerType=g.tb;g.tb.POINTER=g.tb.kb;g.tb.KEYBOARD=g.tb.rf;la.DEFAULT_CONFIG=kc;lc.DEFAULT_OPTIONS=oc;mc.DEFAULT_OPTIONS=pc;g.lb.STEREO=g.lb.Yl;g.lb.SPATIAL=g.lb.Xl;C.SOUND=C.Eb;window.FORGE.Action.operation=Fc;Fc.SET=Fc.Gf;Fc.ADD=Fc.eh;
Fc.SUBSTRACT=Fc.Ci;Fc.MULTIPLY=Fc.ri;Fc.DIVIDE=Fc.kh;Fc.TOGGLE=Fc.Di;window.FORGE.Pointer.cursors=gd;gd.DEFAULT=gd.DEFAULT;window.FORGE.Pointer.listenerTypes=V;V.NATIVE=V.bb;V.HAMMER=V.oa;window.FORGE.Pointer.events=W;W.DOUBLE_TAP=W.Md;W.TAP=W.If;W.PRESS_START=W.Cf;W.PRESS_END=W.Bf;W.PAN_START=W.wf;W.PAN_MOVE=W.vf;W.PAN_END=W.uf;W.PINCH_START=W.Af;W.PINCH_MOVE=W.zf;W.PINCH_END=W.yf;W.ROTATE_START=W.Ff;W.ROTATE_MOVE=W.Ef;W.ROTATE_END=W.Df;W.SWIPE=W.Hf;W.ENTER=W.Re;W.LEAVE=W.sf;W.OVER=W.yc;W.OUT=W.Nb;
W.MOVE=W.tf;W.WHEEL=W.Lf;gd.POINTER=gd.kb;gd.GRAB=gd.Rl;gd.GRABBING=gd.Sl;window.FORGE.Image.renderModes=sd;sd.CSS=sd.CSS;sd.CANVAS=sd.Zb;C.IMAGE=C.IMAGE;window.FORGE.Button.states=Fd;Fd.OUT=Fd.Nb;Fd.OVER=Fd.yc;Fd.DOWN=Fd.lh;X.DEFAULT_STATE=Kd;X.EMPTY_STATE_IMAGE=Ld;X.EMPTY_STATE_LABEL=Md;X.EMPTY_STATE=Nd;X.DEFAULT_STATE_IMAGE=Od;X.DEFAULT_STATE_LABEL=Pd;window.FORGE.VideoQualityMode=g.Ha;g.Ha.AUTO=g.Ha.Xb;g.Ha.MANUAL=g.Ha.MANUAL;window.FORGE.VideoDash.mediaType=fe;fe.VIDEO=fe.VIDEO;fe.AUDIO=fe.AUDIO;
g.nb.HTML5=g.nb.Ul;g.nb.UNKNOWN=g.nb.Td;C.XML=C.jc;window.FORGE.Cache.reserved=oe;oe.COMMON=oe.bd;oe.JSON=oe.JSON;oe.XML=oe.jc;oe.IMAGE=oe.IMAGE;oe.SOUND=oe.Eb;g.X.SINE_IN=g.X.zi;g.X.SINE_IN_OUT=g.X.Ai;g.X.SINE_OUT=g.X.Bi;g.X.QUAD_IN=g.X.vi;g.X.QUAD_IN_OUT=g.X.wi;g.X.QUAD_OUT=g.X.xi;g.X.CUBIC_IN=g.X.gh;g.X.CUBIC_IN_OUT=g.X.hh;g.X.CUBIC_OUT=g.X.ih;g.X.BOUNCE_OUT=g.X.Oe;g.X.BOUNCE_IN=g.X.fh;
  root.FORGE = window.FORGE;
}).call(this);

